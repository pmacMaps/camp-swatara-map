!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("9QPTU",(function(n,i){var a;a=n.exports,Object.defineProperty(a,"__esModule",{value:!0,configurable:!0}),t(n.exports,"default",(function(){return j}));var s=r("8TSCy"),o=r("2TvXO"),u=r("7eJjO"),l=r("34Eys");r("2ILM8");var c=r("bsvXr"),f=r("d2yMj"),d=r("kyj08"),h=r("2VlWd"),p=r("flPLJ"),y=r("jHOLN"),v=r("7qybv"),m=r("10vEZ"),g=r("lKPaD"),b=r("iho5X");r("iJAIC");var _=r("fcwIv"),x=r("9B1Fz"),S=r("krMu9"),k=r("f4h86"),w=r("cRlei"),R=r("4WoSm"),T=r("dIFqf"),C=r("li6vg"),O=r("rIUZZ"),I=r("bPKxZ"),E=r("bTKCC"),V=r("iDjnF"),F=r("9M3e1"),P=r("kvL9S"),L=r("7HdkW"),q=r("30vBn"),A=r("hfthk"),U=r("3NAox"),z=r("gINRd");function M(e){return e&&"openPorts"in e}var N=y.default.getLogger("esri.views.2d.layers.FeatureLayerView2D"),G=function(t){"use strict";s.inherits(n,t);var r=s.createSuper(n);function n(){var t;s.classCallCheck(this,n);var i=s.assertThisInitialized(t);return(t=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._pipelineIsUpdating=!0,t._commandsQueue=new(0,E.default)({process:function(e){switch(e.type){case"processed-edit":return t._doEdit(e);case"refresh":return t._doRefresh(e.dataChanged);case"update":return t._doUpdate()}}}),t._visibilityOverrides=new Set,t._highlightIds=new Map,t._updateHighlight=(0,m.debounce)(s.asyncToGenerator(e(o).mark((function t(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i._proxy.setHighlight(Array.from(i._highlightIds.keys())));case 1:case"end":return e.stop()}}),t)})))),t._uploadsLocked=!1,t._needsClusterSizeUpdate=!1,t.featureEffectView=new(0,x.default),t._lastDefinitionExpression=null,s.possibleConstructorReturn(t)}return s.createClass(n,[{key:"destroy",value:function(){var e;(0,v.applySome)(this._updateClusterSizeTask,(function(e){return e.remove()})),null==(e=this._proxy)||e.destroy(),this._commandsQueue.destroy()}},{key:"initialize",value:function(){var e=this;this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on("valueRangesChanged",(function(t){e._set("_aggregateValueRanges",t.valueRanges)})),(0,g.watch)((function(){return e.featureEffect}),(function(t){e.featureEffectView.featureEffect=t}),{initial:!0,sync:!0})])}},{key:"_initProxy",value:function(){var t=this;return s.asyncToGenerator(e(o).mark((function r(){var n;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("isTable"in t.layer)||!t.layer.isTable){e.next=2;break}throw new(0,d.default)("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:t.layer});case 2:return t._proxy&&t._proxy.destroy(),n=t._createClientOptions(),e.abrupt("return",(t._set("_proxy",new(0,V.default)({client:n})),t._proxy.when()));case 5:case"end":return e.stop()}}),r)})))()}},{key:"_initServiceOptions",value:function(){var t=this;return s.asyncToGenerator(e(o).mark((function r(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,t._createServiceOptions();case 3:return e.t1=e.sent,e.t0._set.call(e.t0,"_serviceOptions",e.t1),e.abrupt("return",t._serviceOptions);case 6:case"end":return e.stop()}}),r)})))()}},{key:"orderByFields",get:function(){return"stream"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}},{key:"labelsVisible",get:function(){var e="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&e.some((function(e){return e.labelingInfo&&e.labelsVisible}))}},{key:"queryMode",get:function(){return this._serviceOptions.type}},{key:"renderingConfigHash",get:function(){if(!this.layer)return null;var e=this.availableFields,t=this.layer,r=this.view.floors,n=t.definitionExpression,i="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,a="renderer"in t&&t.renderer,s="feature"===t.type?t.gdbVersion:void 0,o="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,u=this.timeExtent,l="customParameters"in t?JSON.stringify(t.customParameters):void 0,c="apiKey"in t?t.apiKey:void 0,f="stream"===t.type?"".concat(JSON.stringify(t.geometryDefinition)).concat(t.definitionExpression):null,d=JSON.stringify(this.clips),h=t.featureReduction&&t.featureReduction.toJSON(),p="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),y="sublayers"in this.layer&&this.layer.sublayers.items.reduce((function(e,t){return e+"".concat(t.visible?1:0,".").concat(JSON.stringify(t.renderer),".").concat(t.labelsVisible,"\n.").concat(JSON.stringify(t.labelingInfo))}),"");return JSON.stringify({orderBy:p,sublayerHash:y,filterHash:(0,v.isSome)(this.filter)&&this.filter.toJSON(),effectHash:(0,v.isSome)(this.featureEffect)&&this.featureEffect.toJSON(),streamFilter:f,gdbVersion:s,definitionExpression:n,historicMoment:o,availableFields:e,renderer:a,labelingInfo:i,timeExtent:u,floors:r,clipsHash:d,featureReduction:h,customParameters:l,apiKey:c})}},{key:"highlight",value:function(e){var t,r,n=this;return e instanceof c.default?r=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?r=[e]:Array.isArray(e)&&e.length>0?r="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((function(e){return null==e?void 0:e.getObjectId()})):f.default.isCollection(e)&&e.length>0&&(r=e.map((function(e){return null==e?void 0:e.getObjectId()})).toArray()),(r=null==(t=r)?void 0:t.filter((function(e){return null!=e})))&&r.length?(this._addHighlight(r),{remove:function(){return n._removeHighlight(r)}}):{remove:function(){}}}},{key:"hasHighlight",value:function(){return!!this._highlightIds.size}},{key:"hitTest",value:function(t,r){var n=this;return s.asyncToGenerator(e(o).mark((function t(){var i,a,u,f;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.tileRenderer){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,n.tileRenderer.hitTest(r);case 4:if(0!==(i=e.sent).length){e.next=7;break}return e.abrupt("return",null);case 7:return e.next=9,n._proxy.getFeatures(i);case 9:return a=e.sent,u=a.features,f=a.aggregates,e.abrupt("return",s.toConsumableArray(f.map((function(e){return n._createHittestResult(l.default.fromJSON(e))}))).concat(s.toConsumableArray(u.map((function(e){return n._createHittestResult(c.default.fromJSON(e))})))));case 13:case"end":return e.stop()}}),t)})))()}},{key:"queryAggregates",value:function(){var t=this;return s.asyncToGenerator(e(o).mark((function r(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._proxy.getAggregates();case 2:return e.abrupt("return",e.sent.map((function(e){return l.default.fromJSON(e)})));case 3:case"end":return e.stop()}}),r)})))()}},{key:"queryStatistics",value:function(){return this._proxy.queryStatistics()}},{key:"querySummaryStatistics",value:function(t,r,n){var i=this;return s.asyncToGenerator(e(o).mark((function a(){var u;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=s.objectSpread({},r,{scale:i.view.scale}),e.abrupt("return",i._proxy.querySummaryStatistics(i._cleanUpQuery(t),u,n));case 2:case"end":return e.stop()}}),a)})))()}},{key:"queryUniqueValues",value:function(t,r,n){var i=this;return s.asyncToGenerator(e(o).mark((function a(){var u;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=s.objectSpread({},r,{scale:i.view.scale}),e.abrupt("return",i._proxy.queryUniqueValues(i._cleanUpQuery(t),u,n));case 2:case"end":return e.stop()}}),a)})))()}},{key:"queryClassBreaks",value:function(t,r,n){var i=this;return s.asyncToGenerator(e(o).mark((function a(){var u;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=s.objectSpread({},r,{scale:i.view.scale}),e.abrupt("return",i._proxy.queryClassBreaks(i._cleanUpQuery(t),u,n));case 2:case"end":return e.stop()}}),a)})))()}},{key:"queryHistogram",value:function(t,r,n){var i=this;return s.asyncToGenerator(e(o).mark((function a(){var u;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=s.objectSpread({},r,{scale:i.view.scale}),e.abrupt("return",i._proxy.queryHistogram(i._cleanUpQuery(t),u,n));case 2:case"end":return e.stop()}}),a)})))()}},{key:"queryFeatures",value:function(e,t){var r=this;return this.queryFeaturesJSON(e,t).then((function(e){var t=r,n=k.default.fromJSON(e);return n.features.forEach((function(e){return t._setLayersForFeature(e)})),n}))}},{key:"queryVisibleFeatures",value:function(e,t){var r=this;return this._proxy.queryVisibleFeatures(this._cleanUpQuery(e),t).then((function(e){var t=r,n=k.default.fromJSON(e);return n.features.forEach((function(e){return t._setLayersForFeature(e)})),n}))}},{key:"queryFeaturesJSON",value:function(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}},{key:"queryObjectIds",value:function(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}},{key:"queryFeatureCount",value:function(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}},{key:"queryExtent",value:function(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((function(e){return{count:e.count,extent:z.default.fromJSON(e.extent)}}))}},{key:"setVisibility",value:function(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}},{key:"update",value:function(e){if(this._tileStrategy&&this.tileRenderer){var t=this._tileStrategy.update(e),r=t.hasMissingTiles,n=t.added,i=t.removed;(n.length||i.length)&&this._proxy.updateTiles({added:n,removed:i}),r&&this.requestUpdate(),this.notifyChange("updating")}}},{key:"attach",value:function(){var e=this;this.view.timeline.record("".concat(this.layer.title," (FeatureLayer) Attach")),this._tileStrategy=new(0,P.TileManager)({acquireTile:function(t){return e._acquireTile(t)},releaseTile:function(t){return e._releaseTile(t)},tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add((0,g.watch)((function(){return e.renderingConfigHash}),(function(){return e._update()}),g.initial),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",(function(t){return e._edit(t)})),"attach")}},{key:"detach",value:function(){var e;this._commandsQueue.clear(),null==(e=this._proxy)||e.stop(),this.container.removeAllChildren(),this.handles.remove("attach"),this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"isUpdating",value:function(){var e,t="renderer"in this.layer&&null!=this.layer.renderer,r=this._commandsQueue.updating,n=null!=this._updatingRequiredFieldsPromise,i=!this._proxy||!this._proxy.isReady,a=this._pipelineIsUpdating,s=null==this.tileRenderer||(null==(e=this.tileRenderer)?void 0:e.updating),o=t&&(r||n||i||a||s);return(0,h.default)("esri-2d-log-updating")&&console.log("Updating FLV2D: ".concat(o,"\n  -> hasRenderer ").concat(t,"\n  -> hasPendingCommand ").concat(r,"\n  -> updatingRequiredFields ").concat(n,"\n  -> updatingProxy ").concat(i,"\n  -> updatingPipeline ").concat(a,"\n  -> updatingTileRenderer ").concat(s,"\n")),o}},{key:"_createClientOptions",value:function(){var e=this;return{setUpdating:function(t){e._set("_pipelineIsUpdating",t)},emitEvent:function(t){e.emit(t.name,t.event)}}}},{key:"_detectQueryMode",value:function(t){var r=this;return s.asyncToGenerator(e(o).mark((function n(){var i,a,s,u,l,c,f,d,p,y,m,g,b,_;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="path"in t,s="editingInfo"in r.layer&&(null==(i=r.layer.editingInfo)?void 0:i.lastEditDate),u=!!r.layer.refreshInterval,l=!s&&u,!a||"feature"!==r.layer.type&&"subtype-group"!==r.layer.type||"point"!==r.layer.geometryType||!r.layer.capabilities.query.supportsPagination||r.layer.capabilities.operations.supportsEditing||l||!(0,h.default)("featurelayer-snapshot-enabled")){e.next=17;break}return e.prev=3,e.next=6,r.layer.queryFeatureCount();case 6:if(!((c=e.sent)<=(0,h.default)("featurelayer-snapshot-point-min-threshold"))){e.next=9;break}return e.abrupt("return",{mode:"snapshot",featureCount:c});case 9:if(f=(0,h.default)("featurelayer-snapshot-point-max-threshold"),d=(0,h.default)("featurelayer-snapshot-point-coverage"),p=r.view.extent,y=(0,v.unwrap)(r.layer.fullExtent),m=null==y?void 0:y.clone().intersection(p),g=(0,v.isSome)(m)?m.width*m.height:0,b=(null==y?void 0:y.width)*(null==y?void 0:y.height),_=0===b?0:g/b,!(c<=f&&_>=d)){e.next=12;break}return e.abrupt("return",{mode:"snapshot",featureCount:c});case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),N.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:e.t0});case 17:return e.abrupt("return",{mode:"on-demand"});case 18:case"end":return e.stop()}}),n,null,[[3,14]])})))()}},{key:"_createServiceOptions",value:function(){var t=this;return s.asyncToGenerator(e(o).mark((function r(){var n,i,a,s,u,l,c,f,d,h,y,m,g,b,_,x,S,k;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("stream"!==(i=t.layer).type){e.next=4;break}return e.abrupt("return",null);case 4:if(a=i.capabilities,s=i.objectIdField,u=i.fields.map((function(e){return e.toJSON()})),l=(0,v.isSome)(i.fullExtent)&&i.fullExtent.toJSON(),c=(0,F.toJSONGeometryType)(i.geometryType),f=i.timeInfo&&i.timeInfo.toJSON()||null,d=i.spatialReference?i.spatialReference.toJSON():null,h="feature"===i.type?i.globalIdField:null,"ogc-feature"!==i.type){e.next=10;break}y=i.source.getFeatureDefinition(),e.next=17;break;case 10:if(!M(i.source)){e.next=16;break}return e.next=13,i.source.openPorts();case 13:y=e.sent,e.next=17;break;case 16:i.parsedUrl&&(y=(0,p.clone)(i.parsedUrl),"dynamicDataSource"in i&&i.dynamicDataSource&&(y.query={layer:JSON.stringify({source:i.dynamicDataSource})}));case 17:return m="datesInUnknownTimezone"in t.layer&&t.layer.datesInUnknownTimezone,g=null!=(n="subtypeField"in t.layer&&t.layer.subtypeField)?n:null,e.next=21,t._detectQueryMode(y);case 21:return b=e.sent,_=b.mode,x=b.featureCount,S=t.layer.objectIdField,"feature"===t.layer.type&&(0,v.isSome)(t.layer.orderBy)&&t.layer.orderBy.length&&(k=!t.layer.orderBy[0].valueExpression&&t.layer.orderBy[0].field)&&(S=k),e.abrupt("return",{type:_,timeReferenceUnknownClient:m,subtypeField:g,featureCount:x,globalIdField:h,maxRecordCount:a.query.maxRecordCount,tileMaxRecordCount:a.query.tileMaxRecordCount,capabilities:a,fields:u,fullExtent:l,geometryType:c,objectIdField:s,source:y,timeInfo:f,spatialReference:d,orderByFields:S});case 27:case"end":return e.stop()}}),r)})))()}},{key:"_createMemoryServiceOptions",value:function(t){var r=this;return s.asyncToGenerator(e(o).mark((function n(){var i;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.openPorts();case 2:return i=e.sent,e.abrupt("return",s.objectSpread({},r._createServiceOptions(),{type:"memory",source:i}));case 4:case"end":return e.stop()}}),n)})))()}},{key:"_cleanUpQuery",value:function(e){var t=w.default.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}},{key:"_update",value:function(){var t=this;return s.asyncToGenerator(e(o).mark((function r(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._commandsQueue.push({type:"update"}));case 1:case"end":return e.stop()}}),r)})))()}},{key:"_edit",value:function(t){var r=this;return s.asyncToGenerator(e(o).mark((function n(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.suspended){e.next=2;break}return e.abrupt("return",void r._clearTiles());case 2:return e.abrupt("return",r._validateEdit(t)?r._commandsQueue.push({type:"edit",edits:t}):void 0);case 3:case"end":return e.stop()}}),n)})))()}},{key:"doRefresh",value:function(t){var r=this;return s.asyncToGenerator(e(o).mark((function n(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r._tileStrategy.tileKeys().length){e.next=2;break}return e.abrupt("return",r.suspended&&t?void r._clearTiles():r._commandsQueue.push({type:"refresh",dataChanged:t}));case 2:case"end":return e.stop()}}),n)})))()}},{key:"_clearTiles",value:function(){this._tileStrategy.tileKeys().length&&(this._proxy.updateTiles({added:[],removed:this._tileStrategy.tileKeys()}),this._tileStrategy.clear(),this.requestUpdate(),this._commandsQueue.clear(),this._update())}},{key:"_validateEdit",value:function(e){var t="globalIdField"in this.layer&&this.layer.globalIdField,r=e.deletedFeatures.some((function(e){return-1===e.objectId||!e.objectId})),n=t&&this.availableFields.includes(t);return r&&!n?(N.error(new(0,d.default)("mapview-apply-edits","Editing the specified service requires the layer's globalIdField, ".concat(t," to be included the layer's outFields for updates to be reflected on the map"))),null):e}},{key:"_doUpdate",value:function(){var t=this;return s.asyncToGenerator(e(o).mark((function r(){var n,i,a,s,u,l,c,f,d,h,p,y;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t.destroyed&&t._hasRequiredSupport(t.layer)&&t._tileStrategy){e.next=3;break}return e.abrupt("return");case 3:return n=t.featureEffectView,i=t.filter,e.next=6,t._updateRequiredFields();case 6:if(a=t._getEffectiveRenderer(),s=a.renderer,t._set("_effectiveRenderer",s),u=t._createSchemaConfig(),l=t._createConfiguration(u,i,n.filter),c=t._lastDefinitionExpression!==l.definitionExpression,t._lastDefinitionExpression=l.definitionExpression,f=t._createTileRendererHash(s),"snapshot"===t._serviceOptions.type&&(l.schema.source.featureCount=t._serviceOptions.featureCount),f===t._tileRendererHash){e.next=41;break}return e.next=14,t._initTileRenderer(s);case 14:if("stream"!==(d=t.layer).type){e.next=21;break}return e.next=18,t._initServiceOptions();case 18:e.t0=e.sent,e.next=22;break;case 21:e.t0=t._serviceOptions;case 22:if(h=e.t0,t.tileRenderer.onConfigUpdate(s),e.t1="stream"!==d.type&&M(d.source),!e.t1){e.next=29;break}return e.next=28,d.source.openPorts();case 28:h.source=e.sent;case 29:return p={added:t._tileStrategy.tileKeys(),removed:[]},e.next=32,t._proxy.startup(t.view.featuresTilingScheme,l,h,p);case 32:if(e.t2=t.hasHighlight(),!e.t2){e.next=36;break}return e.next=36,t._proxy.setHighlight(Array.from(t._highlightIds.keys()));case 36:return e.next=38,t._onceTilesUpdated();case 38:t.tileRenderer.onConfigUpdate(s),e.next=59;break;case 41:if(e.t3="snapshot"===t._serviceOptions.type&&c,!e.t3){e.next=46;break}return e.next=45,t.layer.queryFeatureCount();case 45:l.schema.source.featureCount=e.sent;case 46:return e.next=48,t._proxy.update(l);case 48:return((y=e.sent).mesh||y.targets.aggregate)&&t._lockGPUUploads(),e.prev=50,e.next=53,t._proxy.applyUpdate(y);case 53:e.next=58;break;case 55:e.prev=55,e.t4=e.catch(50),(0,m.isAbortError)(e.t4)||N.error(e.t4);case 58:(y.mesh||y.targets.aggregate)&&t._unlockGPUUploads(),t.tileRenderer.onConfigUpdate(s),t._updateClusterSizeVariable(),t._forceAttributeTextureUpload();case 59:t._tileRendererHash=f,t.tileRenderer.invalidateLabels(),t.requestUpdate(),e.next=64;break;case 62:e.prev=62,e.t5=e.catch(0);case 64:case"end":return e.stop()}}),r,null,[[0,62],[50,55]])})))()}},{key:"_doEdit",value:function(t){var r=this;return s.asyncToGenerator(e(o).mark((function n(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r._proxy.onEdits(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,m.isAbortError)(e.t0);case 8:case"end":return e.stop()}}),n,null,[[0,5]])})))()}},{key:"_doRefresh",value:function(t){var r=this;return s.asyncToGenerator(e(o).mark((function n(){var i;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r._lockGPUUploads(),e.prev=2,e.next=5,r._proxy.refresh(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),(0,m.isAbortError)(e.t0);case 10:r._unlockGPUUploads(),null!=(i=r.layer)&&i.featureReduction&&r._updateClusterSizeVariable();case 11:case"end":return e.stop()}}),n,null,[[2,7]])})))()}},{key:"_updateClusterSizeVariable",value:function(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}},{key:"_createUpdateClusterSizeTask",value:function(t,r){var n,i=this;return this.watch("_aggregateValueRanges",(n=s.asyncToGenerator(e(o).mark((function n(a){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i._updateClusterEffectiveRendererSizeVariable(t,r,a),i._needsClusterSizeUpdate=!0,i._uploadsLocked||i._updateClusterSizeVariable();case 1:case"end":return e.stop()}}),n)}))),function(e){return n.apply(this,arguments)}))}},{key:"_updateClusterEffectiveRendererSizeVariable",value:function(t,r,n){var i=this;return s.asyncToGenerator(e(o).mark((function a(){var s,u,l;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.dynamicClusterSize&&"visualVariables"in t&&t.visualVariables&&(s=(0,I.findSizeVV)(t.visualVariables),(0,v.isSome)(s)&&"cluster_count"===s.field&&(u=t.visualVariables.indexOf(s),t.visualVariables[u]=(0,I.createClusterCountSizeVariable)(r,n),(l=t.clone()).dynamicClusterSize=!0,i._set("_effectiveRenderer",l)));case 1:case"end":return e.stop()}}),a)})))()}},{key:"_getEffectiveRenderer",value:function(){var e="renderer"in this.layer&&this.layer.renderer,t=this.layer.featureReduction;if((0,v.isSome)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"cluster"===t.type&&(0,I.isClusterCompatibleRenderer)(e)){var r=t,n=[],i=(0,I.createClusterRenderer)(n,e,r,this._aggregateValueRanges);return(0,v.applySome)(this._updateClusterSizeTask,(function(e){return e.remove()})),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(i,r),{renderer:i,aggregateFields:n,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}},{key:"_acquireTile",value:function(e){var t=this,r=this.tileRenderer.acquireTile(e);return r.once("attach",(function(){t.requestUpdate()})),r}},{key:"_releaseTile",value:function(e){this.tileRenderer.releaseTile(e)}},{key:"_initTileRenderer",value:function(t){var r=this;return s.asyncToGenerator(e(o).mark((function n(){var i;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,O.createOrReuseTileRenderer)(t,{layerView:r,tileInfoView:r.view.featuresTilingScheme,layer:r.layer});case 2:return i=e.sent,e.abrupt("return",(r.tileRenderer&&(r._tileStrategy.clear(),r.tileRenderer.uninstall(r.container),r.tileRenderer.destroy(),r.tileRenderer=null),r.destroyed?null:(r._proxy.tileRenderer=i,r._set("tileRenderer",i),r.tileRenderer.install(r.container),r.tileRenderer.onConfigUpdate(t),r.requestUpdate(),r.tileRenderer)));case 4:case"end":return e.stop()}}),n)})))()}},{key:"_createTileRendererHash",value:function(e){return"".concat("heatmap"===e.type?"heatmap":"symbol")}},{key:"hasFilter",get:function(){var e=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||e||!!this._visibilityOverrides.size||!!this.timeExtent}},{key:"_injectOverrides",value:function(e){var t=(0,v.isSome)(e)?e.timeExtent:null,r=(0,v.isSome)(this.timeExtent)&&(0,v.isSome)(t)?this.timeExtent.intersection(t):this.timeExtent||t,n=null,i="floorInfo"in this.layer&&this.layer.floorInfo;if(i){var a=(0,v.isSome)(e)&&e.where;n=this._addFloorFilterClause(a)}if(!this._visibilityOverrides.size&&!r&&!i)return(0,v.isSome)(e)?e.toJSON():null;(e=(0,v.isSome)(e)&&e.clone()||new(0,S.default)).timeExtent=r,n&&(e.where=n);var s=e.toJSON();return s.hiddenIds=Array.from(this._visibilityOverrides),s}},{key:"_addFloorFilterClause",value:function(e){var t=this.layer,r=e||"";if("floorInfo"in t&&t.floorInfo){var n,i=this.view.floors;if(!i||!i.length)return r;null!=(n=t.floorInfo.viewAllLevelIds)&&n.length&&(i=t.floorInfo.viewAllLevelIds);var a=i.filter((function(e){return""!==e})).map((function(e){return"'"+e+"'"}));a.push("''");var s=t.floorInfo.floorField,o="("+s+" IN ({ids}) OR "+s+" IS NULL)";if(o=o.replace("{ids}",a.join(", ")),(0,v.isSome)(r)&&r.includes(s)){var u=new RegExp("AND \\("+s+".*NULL\\)","g");r=r.replace(u,""),u=new RegExp("\\("+s+".*NULL\\)","g"),r=(r=r.replace(u,"")).replace(/\s+/g," ").trim()}r=""!==r?"("+r+") AND "+o:o}return""!==r?r:null}},{key:"_createConfiguration",value:function(e,t,r){var n="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,i="feature"===this.layer.type?this.layer.gdbVersion:void 0,a=new Array(R.MAX_FILTERS),s=this._injectOverrides(t);a[0]=s,a[1]=(0,v.isSome)(r)?r.toJSON():null;var o=(0,C.createSchema)(e);if((0,v.isNone)(o))return null;var u=(0,U.getWebGL1Capabilities)();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:i,historicMoment:n,devicePixelRatio:window.devicePixelRatio||1,filters:a,schema:o,supportsTextureFloat:u.supportsTextureFloat,maxTextureSize:u.maxTextureSize}}},{key:"_hasRequiredSupport",value:function(e){var t;return!("renderer"in e&&"dot-density"===(null==(t=e.renderer)?void 0:t.type)&&!(0,U.getWebGL1Capabilities)().supportsTextureFloat&&(N.error(new(0,d.default)("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))}},{key:"_onceTilesUpdated",value:function(){var e=this;return this.requestUpdate(),(0,g.whenOnce)((function(){return!e._pipelineIsUpdating}))}},{key:"_lockGPUUploads",value:function(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())}},{key:"_unlockGPUUploads",value:function(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}},{key:"_forceAttributeTextureUpload",value:function(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}},{key:"_createSchemaConfig",value:function(){var e="feature"===this.layer.type?this.layer.historicMoment:null,t="feature"===this.layer.type?this.layer.gdbVersion:null;return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:e,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:t,pixelBuffer:0,orderBy:"orderBy"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:s.objectSpread({},"customParameters"in this.layer?this.layer.customParameters:void 0,{token:"apiKey"in this.layer?this.layer.apiKey:void 0})}}},{key:"_addHighlight",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;if(this._highlightIds.has(s)){var o=this._highlightIds.get(s);this._highlightIds.set(s,o+1)}else this._highlightIds.set(s,1)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}this._updateHighlight().catch((function(e){(0,m.isAbortError)(e)||N.error(e)}))}},{key:"_removeHighlight",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;if(this._highlightIds.has(s)){var o=this._highlightIds.get(s)-1;0===o?this._highlightIds.delete(s):this._highlightIds.set(s,o)}}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}this._updateHighlight().catch((function(e){(0,m.isAbortError)(e)||N.error(e)}))}},{key:"_setLayersForFeature",value:function(e){var t=this.layer;e.layer=t,e.sourceLayer=t}},{key:"_createHittestResult",value:function(e){return this._setLayersForFeature(e),(0,v.isSome)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}}]),n}((0,L.FeatureLayerView)((0,A.RefreshableLayerView)((0,T.LayerView2DMixin)(q.default))));(0,u._)([(0,b.property)()],G.prototype,"_serviceOptions",void 0),(0,u._)([(0,b.property)()],G.prototype,"_proxy",void 0),(0,u._)([(0,b.property)()],G.prototype,"_pipelineIsUpdating",void 0),(0,u._)([(0,b.property)()],G.prototype,"_effectiveRenderer",void 0),(0,u._)([(0,b.property)()],G.prototype,"_aggregateValueRanges",void 0),(0,u._)([(0,b.property)()],G.prototype,"_commandsQueue",void 0),(0,u._)([(0,b.property)()],G.prototype,"featureEffectView",void 0),(0,u._)([(0,b.property)()],G.prototype,"labelsVisible",null),(0,u._)([(0,b.property)({readOnly:!0})],G.prototype,"queryMode",null),(0,u._)([(0,b.property)()],G.prototype,"renderingConfigHash",null),(0,u._)([(0,b.property)()],G.prototype,"tileRenderer",void 0),(0,u._)([(0,b.property)()],G.prototype,"updating",void 0);var j=G=(0,u._)([(0,_.subclass)("esri.views.2d.layers.FeatureLayerView2D")],G)})),r.register("9M3e1",(function(e,n){t(e.exports,"toJSONGeometryType",(function(){return a})),t(e.exports,"canUseMajorityInterpolationOnDataSource",(function(){return s}));var i=new(0,r("79ASa").JSONMap)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function a(e){return i.toJSON(e)}function s(e){var t=e.rasterInfo,r=t.bandCount,n=t.attributeTable,i=t.colormap,a=t.pixelType;return 1===r&&(null!=n||null!=i||"u8"===a||"s8"===a)}})),r.register("hfthk",(function(e,n){t(e.exports,"RefreshableLayerView",(function(){return f}));var i=r("8TSCy"),a=r("7eJjO"),s=r("jHOLN"),o=r("10vEZ"),u=r("lKPaD"),l=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var c=r("fcwIv"),f=function(e){var t=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(){return i.classCallCheck(this,r),t.apply(this,arguments)}return i.createClass(r,[{key:"initialize",value:function(){var e=this;this.handles.add((0,u.on)((function(){return e.layer}),"refresh",(function(t){var r=e;e.doRefresh(t.dataChanged).catch((function(e){(0,o.isAbortError)(e)||s.default.getLogger(r.declaredClass).error(e)}))})),"RefreshableLayerView")}}]),r}(e);return(0,a._)([(0,l.property)()],t.prototype,"layer",void 0),t=(0,a._)([(0,c.subclass)("esri.layers.mixins.RefreshableLayerView")],t)}})),r.register("ibKgR",(function(e,n){t(e.exports,"toQuantizationTransform",(function(){return c})),t(e.exports,"quantizePoint",(function(){return b})),t(e.exports,"quantizeGeometry",(function(){return S})),t(e.exports,"unquantizeMultipoint",(function(){return k})),t(e.exports,"unquantizePoint",(function(){return w})),t(e.exports,"unquantizePolygon",(function(){return R})),t(e.exports,"unquantizePolyline",(function(){return T}));var i=r("8TSCy"),a=r("7qybv"),s=r("79LpT");var o=function(e,t,r){return[t,r]},u=function(e,t,r){return[t,r,e[2]]},l=function(e,t,r){return[t,r,e[2],e[3]]};function c(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:(0,a.isSome)(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function f(e,t){var r=e.scale,n=e.translate;return Math.round((t-n[0])/r[0])}function d(e,t){var r=e.scale,n=e.translate;return Math.round((n[1]-t)/r[1])}function h(e,t,r){for(var n,i,a,s,o=[],u=0;u<r.length;u++){var l=r[u];u>0?(a=f(e,l[0]),s=d(e,l[1]),a===n&&s===i||(o.push(t(l,a-n,s-i)),n=a,i=s)):(n=f(e,l[0]),i=d(e,l[1]),o.push(t(l,n,i)))}return o.length>0?o:null}function p(e,t){var r=e.scale,n=e.translate;return t*r[0]+n[0]}function y(e,t){var r=e.scale;return e.translate[1]-t*r[1]}function v(e,t,r){var n=new Array(r.length);if(!r.length)return n;var a=i.slicedToArray(e.scale,2),s=a[0],o=a[1],u=p(e,r[0][0]),l=y(e,r[0][1]);n[0]=t(r[0],u,l);for(var c=1;c<r.length;c++){var f=r[c];u+=f[0]*s,l-=f[1]*o,n[c]=t(f,u,l)}return n}function m(e,t,r){for(var n=new Array(r.length),i=0;i<r.length;i++)n[i]=v(e,t,r[i]);return n}function g(e,t,r,n,i){return t.points=(a=e,s=r.points,c=i,h(a,n?c?l:u:c?u:o,s)),t;var a,s,c}function b(e,t,r,n,i){return t.x=f(e,r.x),t.y=d(e,r.y),t!==r&&(n&&(t.z=r.z),i&&(t.m=r.m)),t}function _(e,t,r,n,i){var a=function(e,t,r,n){for(var i=[],a=r?n?l:u:n?u:o,s=0;s<t.length;s++){var c=h(e,a,t[s]);c&&c.length>=3&&i.push(c)}return i.length?i:null}(e,r.rings,n,i);return a?(t.rings=a,t):null}function x(e,t,r,n,i){var a=function(e,t,r,n){for(var i=[],a=r?n?l:u:n?u:o,s=0;s<t.length;s++){var c=h(e,a,t[s]);c&&c.length>=2&&i.push(c)}return i.length?i:null}(e,r.paths,n,i);return a?(t.paths=a,t):null}function S(e,t){return e&&t?(0,s.isPoint)(t)?b(e,{},t,!1,!1):(0,s.isPolyline)(t)?x(e,{},t,!1,!1):(0,s.isPolygon)(t)?_(e,{},t,!1,!1):(0,s.isMultipoint)(t)?g(e,{},t,!1,!1):(0,s.isExtent)(t)?(a=!1,o=!1,(n={}).xmin=f(r=e,(i=t).xmin),n.ymin=d(r,i.ymin),n.xmax=f(r,i.xmax),n.ymax=d(r,i.ymax),n!==i&&(a&&(n.zmin=i.zmin,n.zmax=i.zmax),o&&(n.mmin=i.mmin,n.mmax=i.mmax)),n):null:null;var r,n,i,a,o}function k(e,t,r,n,i){return(0,a.isSome)(r)&&(t.points=(s=e,c=r.points,f=i,v(s,n?f?l:u:f?u:o,c))),t;var s,c,f}function w(e,t,r,n,i){return(0,a.isNone)(r)||(t.x=p(e,r.x),t.y=y(e,r.y),t!==r&&(n&&(t.z=r.z),i&&(t.m=r.m))),t}function R(e,t,r,n,i){return(0,a.isSome)(r)&&(t.rings=(s=e,c=r.rings,f=i,m(s,n?f?l:u:f?u:o,c))),t;var s,c,f}function T(e,t,r,n,i){return(0,a.isSome)(r)&&(t.paths=(s=e,c=r.paths,f=i,m(s,n?f?l:u:f?u:o,c))),t;var s,c,f}})),r.register("8lbQw",(function(e,r){t(e.exports,"u32to4Xu8",(function(){return i})),t(e.exports,"i1616to32",(function(){return a})),t(e.exports,"i8888to32",(function(){return s}));var n=new Float32Array(1);new Uint32Array(n.buffer);function i(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function a(e,t){return 65535&e|t<<16}function s(e,t,r,n){return 255&e|(255&t)<<8|(255&r)<<16|n<<24}})),r.register("6S0qa",(function(e,r){var n,i,a,s;function o(e){switch(e){case"left":return n.Left;case"right":return n.Right;case"center":case"justify":return n.Center}}function u(e){switch(e){case"top":return i.Top;case"middle":return i.Center;case"baseline":return i.Baseline;case"bottom":return i.Bottom}}function l(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return[n.Right,i.Bottom];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return[n.Center,i.Bottom];case"above-right":case"esriServerPointLabelPlacementAboveRight":return[n.Left,i.Bottom];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return[n.Right,i.Center];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return[n.Center,i.Center];case"center-right":case"esriServerPointLabelPlacementCenterRight":return[n.Left,i.Center];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return[n.Right,i.Top];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return[n.Center,i.Top];case"below-right":case"esriServerPointLabelPlacementBelowRight":return[n.Left,i.Top];default:return console.debug("Found invalid placement type ".concat(e)),[n.Center,i.Center]}}function c(e){switch(e){case n.Right:return-1;case n.Center:return 0;case n.Left:return 1;default:return console.debug("Found invalid horizontal alignment ".concat(e)),0}}function f(e){switch(e){case i.Top:return 1;case i.Center:return 0;case i.Bottom:case i.Baseline:return-1;default:return console.debug("Found invalid vertical alignment ".concat(e)),0}}function d(e){switch(e){case"left":return n.Left;case"right":return n.Right;case"center":case"justify":return n.Center}}function h(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}t(e.exports,"HAlign",(function(){return n})),t(e.exports,"VAlign",(function(){return i})),t(e.exports,"getXAnchorDirection",(function(){return o})),t(e.exports,"getYAnchorDirection",(function(){return u})),t(e.exports,"getAlignmentFromPlacement",(function(){return l})),t(e.exports,"getXDirection",(function(){return c})),t(e.exports,"getYDirection",(function(){return f})),t(e.exports,"getJustification",(function(){return d})),t(e.exports,"isMapAligned",(function(){return h})),(s=n||(n={}))[s.Left=-1]="Left",s[s.Center=0]="Center",s[s.Right=1]="Right",(a=i||(i={}))[a.Top=1]="Top",a[a.Center=0]="Center",a[a.Bottom=-1]="Bottom",a[a.Baseline=2]="Baseline"})),r.register("2rjRQ",(function(n,i){t(n.exports,"expandSymbol",(function(){return d})),t(n.exports,"cimLayerToRasterizationInfo",(function(){return h}));var a,s=r("8TSCy"),o=r("2TvXO"),u=r("aNOUb"),l=r("f7bFM"),c=r("jfLVm"),f=(a=s.asyncToGenerator(e(o).mark((function t(r,n,i,a){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(r.map((function(e){return d(e,n,i,a)}))));case 1:case"end":return e.stop()}}),t)}))),function(){var t=s.asyncToGenerator(e(o).mark((function t(r,n,i){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=l.ExpandedCIM,e.next=3,(0,u.analyzeCIMSymbol)(r.data,n,i);case 3:return e.t1=e.sent,e.t2=r.data,e.t3=r.rendererKey,e.t4=r.maxVVSize,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3,e.t4));case 8:case"end":return e.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}()),d=function(){var t=s.asyncToGenerator(e(o).mark((function t(r,n,i,a){var s;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",null);case 2:if("cim"!==r.type){e.next=4;break}return e.abrupt("return",f(r,n,i));case 4:if("web-style"!==r.type){e.next=12;break}return e.next=7,(0,c.fetchCIMSymbolReference)(r,null,a);case 7:return e.t0=e.sent,e.t1=r.rendererKey,e.t2=r.maxVVSize,s={type:"cim",data:e.t0,rendererKey:e.t1,maxVVSize:e.t2},e.abrupt("return",f(s,n,i));case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),t)})));return function(e,r,n,i){return t.apply(this,arguments)}}();function h(e){if(!e)return null;var t=e.type,r=e.cim,n=e.url,i={cim:r,type:t,mosaicHash:e.materialHash,url:n,size:null,dashTemplate:null,path:null,text:null,fontName:null};switch(t){case"marker":i.size=e.size,i.path=e.path;break;case"line":i.dashTemplate=e.dashTemplate;break;case"text":i.text=e.text,i.fontName=e.fontName}return i}})),r.register("f7bFM",(function(e,n){t(e.exports,"ExpandedCIM",(function(){return u}));var i=r("8TSCy"),a=r("66IJZ"),s=r("ktHf8"),o={marker:a.WGLGeometryType.MARKER,fill:a.WGLGeometryType.FILL,line:a.WGLGeometryType.LINE,text:a.WGLGeometryType.TEXT},u=function(){"use strict";function e(t,r,n,a){i.classCallCheck(this,e);var u,l={minScale:null==r?void 0:r.minScale,maxScale:null==r?void 0:r.maxScale},c=(u=l).minScale||u.maxScale?u.minScale+"-"+u.maxScale:"";this.layers=t,this.data=r,this.hash=this._createHash()+c,this.rendererKey=n;var f={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:n},d=!0,h=!1,p=void 0;try{for(var y,v=t[Symbol.iterator]();!(d=(y=v.next()).done);d=!0){var m=y.value,g=o[m.type];m.materialKey=(0,s.createMaterialKey)(g,f),m.maxVVSize=a,m.scaleInfo=l,m.templateHash+=c}}catch(e){h=!0,p=e}finally{try{d||null==v.return||v.return()}finally{if(h)throw p}}}return i.createClass(e,[{key:"type",get:function(){return"expanded-cim"}},{key:"_createHash",value:function(){var e="",t=!0,r=!1,n=void 0;try{for(var i,a=this.layers[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){e+=i.value.templateHash}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return e}}]),e}()})),r.register("jfLVm",(function(n,i){t(n.exports,"fetchCIMSymbolReference",(function(){return p}));var a=r("8TSCy"),s=r("2TvXO"),o=r("3gVHR"),u=r("kyj08"),l=r("10vEZ"),c=r("kYueh"),f=r("ajJOT"),d=r("9ELaA"),h=r("dmPQi");function p(e,t,r){return y.apply(this,arguments)}function y(){return(y=a.asyncToGenerator(e(s).mark((function t(r,n,i){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.name){e.next=2;break}return e.abrupt("return",Promise.reject(new(0,u.default)("style-symbol-reference-name-missing","Missing name in style symbol reference")));case 2:if(!r.styleName||"Esri2DPointSymbolsStyle"!==r.styleName){e.next=4;break}return e.abrupt("return",v(r,i));case 4:return e.prev=4,e.t0=g,e.next=8,(0,h.fetchStyle)(r,n,i);case 8:return e.t1=e.sent,e.t2=r.name,e.t3=n,e.t4=i,e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3,e.t4));case 15:return e.prev=15,e.t5=e.catch(4),e.abrupt("return",((0,l.throwIfAborted)(e.t5),null));case 18:case"end":return e.stop()}}),t,null,[[4,15]])})))).apply(this,arguments)}function v(e,t){return m.apply(this,arguments)}function m(){return(m=a.asyncToGenerator(e(s).mark((function t(r,n){var i,a;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=h.Style2DUrlTemplate.replace(/\{SymbolName\}/gi,r.name),e.prev=1,e.next=4,(0,h.requestJSON)(i,n);case 4:return a=e.sent,e.abrupt("return",(0,h.makeCIMSymbolRef)(a.data));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",((0,l.throwIfAborted)(e.t0),null));case 11:case"end":return e.stop()}}),t,null,[[1,8]])})))).apply(this,arguments)}function g(e,t,r,n){return b.apply(this,arguments)}function b(){return(b=a.asyncToGenerator(e(s).mark((function t(r,n,i,a){var p,y,v,m,g;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=r.data,y={portal:i&&i.portal||f.default.getDefault(),url:(0,c.urlToObject)(r.baseUrl),origin:"portal-item"},v=p.items.find((function(e){return e.name===n}))){e.next=3;break}throw new(0,u.default)("symbolstyleutils:symbol-name-not-found","The symbol name '".concat(n,"' could not be found"),{symbolName:n});case 3:return m=(0,d.f)((0,h.symbolUrlFromStyleItem)(v,"cimRef"),y),(0,o.isDevEnvironment)()&&(m=(0,o.adjustStaticAGOUrl)(m)),e.prev=5,e.next=8,(0,h.requestJSON)(m,a);case 8:return g=e.sent,e.abrupt("return",(0,h.makeCIMSymbolRef)(g.data));case 12:return e.prev=12,e.t0=e.catch(5),e.abrupt("return",((0,l.throwIfAborted)(e.t0),null));case 15:case"end":return e.stop()}}),t,null,[[5,12]])})))).apply(this,arguments)}})),r.register("2VOK9",(function(e,n){t(e.exports,"getTypeOfSizeVisualVariable",(function(){return l}));var i=r("kyj08"),a=r("jHOLN"),s=r("66IJZ"),o=r("5WctK"),u=a.default.getLogger("esri.views.2d.engine.webgl");function l(e){return(0,o.isNumber)(e.minDataValue)&&(0,o.isNumber)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?s.WGLVVFlag.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?s.WGLVVFlag.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?s.WGLVVFlag.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?s.WGLVVFlag.SIZE_UNIT_VALUE:(u.error(new(0,i.default)("mapview-bad-type","Found invalid size VisualVariable",e)),s.WGLVVFlag.NONE)}})),r.register("fsJts",(function(e,r){t(e.exports,"outputTypes",(function(){return n})),t(e.exports,"createMD5Hash",(function(){return y}));var n={Base64:0,Hex:1,String:2,Raw:3};function i(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function a(e){for(var t=[],r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function s(e){for(var t=[],r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}function o(e){for(var t="0123456789abcdef",r=[],n=0,i=4*e.length;n<i;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}function u(e){for(var t=[],r=0,n=4*e.length;r<n;r+=3)for(var i=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,a=0;a<4;a++)8*r+6*a>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-a)&63));return t.join("")}function l(e,t,r,n,a,s){return i((o=i(i(t,e),i(n,s)))<<(u=a)|o>>>32-u,r);var o,u}function c(e,t,r,n,i,a,s){return l(t&r|~t&n,e,t,i,a,s)}function f(e,t,r,n,i,a,s){return l(t&n|r&~n,e,t,i,a,s)}function d(e,t,r,n,i,a,s){return l(t^r^n,e,t,i,a,s)}function h(e,t,r,n,i,a,s){return l(r^(t|~n),e,t,i,a,s)}function p(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,n=-271733879,a=-1732584194,s=271733878,o=0;o<e.length;o+=16){var u=r,l=n,p=a,y=s;r=c(r,n,a,s,e[o+0],7,-680876936),s=c(s,r,n,a,e[o+1],12,-389564586),a=c(a,s,r,n,e[o+2],17,606105819),n=c(n,a,s,r,e[o+3],22,-1044525330),r=c(r,n,a,s,e[o+4],7,-176418897),s=c(s,r,n,a,e[o+5],12,1200080426),a=c(a,s,r,n,e[o+6],17,-1473231341),n=c(n,a,s,r,e[o+7],22,-45705983),r=c(r,n,a,s,e[o+8],7,1770035416),s=c(s,r,n,a,e[o+9],12,-1958414417),a=c(a,s,r,n,e[o+10],17,-42063),n=c(n,a,s,r,e[o+11],22,-1990404162),r=c(r,n,a,s,e[o+12],7,1804603682),s=c(s,r,n,a,e[o+13],12,-40341101),a=c(a,s,r,n,e[o+14],17,-1502002290),r=f(r,n=c(n,a,s,r,e[o+15],22,1236535329),a,s,e[o+1],5,-165796510),s=f(s,r,n,a,e[o+6],9,-1069501632),a=f(a,s,r,n,e[o+11],14,643717713),n=f(n,a,s,r,e[o+0],20,-373897302),r=f(r,n,a,s,e[o+5],5,-701558691),s=f(s,r,n,a,e[o+10],9,38016083),a=f(a,s,r,n,e[o+15],14,-660478335),n=f(n,a,s,r,e[o+4],20,-405537848),r=f(r,n,a,s,e[o+9],5,568446438),s=f(s,r,n,a,e[o+14],9,-1019803690),a=f(a,s,r,n,e[o+3],14,-187363961),n=f(n,a,s,r,e[o+8],20,1163531501),r=f(r,n,a,s,e[o+13],5,-1444681467),s=f(s,r,n,a,e[o+2],9,-51403784),a=f(a,s,r,n,e[o+7],14,1735328473),r=d(r,n=f(n,a,s,r,e[o+12],20,-1926607734),a,s,e[o+5],4,-378558),s=d(s,r,n,a,e[o+8],11,-2022574463),a=d(a,s,r,n,e[o+11],16,1839030562),n=d(n,a,s,r,e[o+14],23,-35309556),r=d(r,n,a,s,e[o+1],4,-1530992060),s=d(s,r,n,a,e[o+4],11,1272893353),a=d(a,s,r,n,e[o+7],16,-155497632),n=d(n,a,s,r,e[o+10],23,-1094730640),r=d(r,n,a,s,e[o+13],4,681279174),s=d(s,r,n,a,e[o+0],11,-358537222),a=d(a,s,r,n,e[o+3],16,-722521979),n=d(n,a,s,r,e[o+6],23,76029189),r=d(r,n,a,s,e[o+9],4,-640364487),s=d(s,r,n,a,e[o+12],11,-421815835),a=d(a,s,r,n,e[o+15],16,530742520),r=h(r,n=d(n,a,s,r,e[o+2],23,-995338651),a,s,e[o+0],6,-198630844),s=h(s,r,n,a,e[o+7],10,1126891415),a=h(a,s,r,n,e[o+14],15,-1416354905),n=h(n,a,s,r,e[o+5],21,-57434055),r=h(r,n,a,s,e[o+12],6,1700485571),s=h(s,r,n,a,e[o+3],10,-1894986606),a=h(a,s,r,n,e[o+10],15,-1051523),n=h(n,a,s,r,e[o+1],21,-2054922799),r=h(r,n,a,s,e[o+8],6,1873313359),s=h(s,r,n,a,e[o+15],10,-30611744),a=h(a,s,r,n,e[o+6],15,-1560198380),n=h(n,a,s,r,e[o+13],21,1309151649),r=h(r,n,a,s,e[o+4],6,-145523070),s=h(s,r,n,a,e[o+11],10,-1120210379),a=h(a,s,r,n,e[o+2],15,718787259),n=h(n,a,s,r,e[o+9],21,-343485551),r=i(r,u),n=i(n,l),a=i(a,p),s=i(s,y)}return[r,n,a,s]}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Hex,r=t||n.Base64,i=p(a(e),8*e.length);switch(r){case n.Raw:return i;case n.Hex:return o(i);case n.String:return s(i);case n.Base64:return u(i)}}})),r.register("cOrC4",(function(e,n){t(e.exports,"Container",(function(){return o}));var i=r("8TSCy"),a=r("eYrMi"),s=r("a4nX6"),o=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(){var e;return i.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))))._childrenSet=new Set,e._needsSort=!1,e.children=[],e._effectView=null,i.possibleConstructorReturn(e)}return i.createClass(r,[{key:"blendMode",get:function(){return this._blendMode},set:function(e){this._blendMode=e,this.requestRender()}},{key:"clips",get:function(){return this._clips},set:function(e){this._clips=e,this.children.forEach((function(t){return t.clips=e}))}},{key:"computedEffects",get:function(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effects)?e:null}},{key:"effect",get:function(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effect)?e:""},set:function(e){(this._effectView||e)&&(this._effectView||(this._effectView=new(0,s.EffectView)),this._effectView.effect=e,this.requestRender())}},{key:"updateTransitionProperties",value:function(e,t){i.get(i.getPrototypeOf(r.prototype),"updateTransitionProperties",this).call(this,e,t),this._effectView&&(this._effectView.transitionStep(e,t),this._effectView.transitioning&&this.requestRender())}},{key:"doRender",value:function(e){var t=this.createRenderParams(e);this.renderChildren(t)}},{key:"addChild",value:function(e){return this.addChildAt(e,this.children.length)}},{key:"addChildAt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.children.length;if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;var r=e.parent;return r&&r!==this&&r.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}},{key:"contains",value:function(e){return this._childrenSet.has(e)}},{key:"removeAllChildren",value:function(){this._childrenSet.clear(),this._needsSort=!0;var e=!0,t=!1,r=void 0;try{for(var n,i=this.children[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var a=n.value;this!==this.stage&&(a.clips=null),a.stage=null,a.parent=null}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this.children.length=0}},{key:"removeChild",value:function(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}},{key:"removeChildAt",value:function(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;var t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}},{key:"sortChildren",value:function(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}},{key:"_createTransforms",value:function(){return{dvs:(0,a.c)()}}},{key:"onAttach",value:function(){i.get(i.getPrototypeOf(r.prototype),"onAttach",this).call(this);var e=this.stage,t=!0,n=!1,a=void 0;try{for(var s,o=this.children[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){s.value.stage=e}}catch(e){n=!0,a=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}}},{key:"onDetach",value:function(){i.get(i.getPrototypeOf(r.prototype),"onDetach",this).call(this);var e=!0,t=!1,n=void 0;try{for(var a,s=this.children[Symbol.iterator]();!(e=(a=s.next()).done);e=!0){a.value.stage=null}}catch(e){t=!0,n=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}}},{key:"renderChildren",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this.children[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.beforeRender(e)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var s=!0,o=!1,u=void 0;try{for(var l,c=this.children[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){l.value.processRender(e)}}catch(e){o=!0,u=e}finally{try{s||null==c.return||c.return()}finally{if(o)throw u}}var f=!0,d=!1,h=void 0;try{for(var p,y=this.children[Symbol.iterator]();!(f=(p=y.next()).done);f=!0){p.value.afterRender(e)}}catch(e){d=!0,h=e}finally{try{f||null==y.return||y.return()}finally{if(d)throw h}}}},{key:"createRenderParams",value:function(e){return i.objectSpread({},e,{blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition})}}]),r}(r("2qlsz").DisplayObject)})),r.register("2qlsz",(function(e,n){t(e.exports,"DisplayObject",(function(){return c}));var i=r("8TSCy"),a=r("amfHf"),s=r("2VlWd"),o=r("7qybv"),u=r("10vEZ"),l=1/(0,s.default)("mapview-transitions-duration"),c=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(){var e;return i.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))))._fadeOutResolver=null,e._fadeInResolver=null,e._clips=null,e.computedVisible=!0,e.computedOpacity=1,e.fadeTransitionEnabled=!1,e.inFadeTransition=!1,e._isReady=!1,e._opacity=1,e._stage=null,e._visible=!0,i.possibleConstructorReturn(e)}return i.createClass(r,[{key:"clips",get:function(){return this._clips},set:function(e){this._clips=e,this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(e){if(this._stage!==e){var t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}}},{key:"transforms",get:function(){return this._getTransforms()}},{key:"_getTransforms",value:function(){return(0,o.isNone)(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible!==e&&(this._visible=e,this.requestRender())}},{key:"fadeIn",value:function(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=(0,u.createResolver)(),this.requestRender()),this._fadeInResolver.promise}},{key:"fadeOut",value:function(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=(0,u.createResolver)(),this.requestRender()),this._fadeOutResolver.promise}},{key:"beforeRender",value:function(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}},{key:"afterRender",value:function(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}},{key:"remove",value:function(){var e;null==(e=this.parent)||e.removeChild(this)}},{key:"setTransform",value:function(e){}},{key:"processRender",value:function(e){this.stage&&this.computedVisible&&this.doRender(e)}},{key:"requestRender",value:function(){this.stage&&this.stage.requestRender()}},{key:"processDetach",value:function(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}},{key:"updateTransitionProperties",value:function(e,t){if(this.fadeTransitionEnabled){var r=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===r)this.computedVisible=this.visible;else{var i=e*l;this.computedOpacity=n>r?Math.max(r,n-i):Math.min(r,n+i),this.computedVisible=this.computedOpacity>0;var a=r===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}},{key:"onAttach",value:function(){}},{key:"onDetach",value:function(){}},{key:"doRender",value:function(e){}},{key:"ready",value:function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}]),r}(a.default)})),r.register("dB39e",(function(n,i){t(n.exports,"getRequiredFields",(function(){return l})),t(n.exports,"getFetchPopupTemplate",(function(){return f}));var a=r("8TSCy"),s=r("2TvXO"),o=r("7qybv"),u=r("7vTUY");function l(e){return c.apply(this,arguments)}function c(){return c=a.asyncToGenerator(e(s).mark((function t(r){var n,i,l,c,f,d,h,p,y,v=arguments;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v.length>1&&void 0!==v[1]?v[1]:r.popupTemplate,(0,o.isSome)(n)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,n.getRequiredFields(r.fieldsIndex);case 5:if(i=e.sent,l=n.lastEditInfoEnabled,c=r.objectIdField,f=r.typeIdField,d=r.globalIdField,h=r.relationships,!i.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!l){e.next=19;break}return e.next=16,(0,u.getFeatureEditFields)(r);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return p=e.t0,y=(0,u.fixFields)(r.fieldsIndex,a.toConsumableArray(i).concat(a.toConsumableArray(p))),e.abrupt("return",(f&&y.push(f),y&&c&&r.fieldsIndex.has(c)&&-1===y.indexOf(c)&&y.push(c),y&&d&&r.fieldsIndex.has(d)&&-1===y.indexOf(d)&&y.push(d),h&&h.forEach((function(e){var t=e.keyField;y&&t&&r.fieldsIndex.has(t)&&-1===y.indexOf(t)&&y.push(t)})),y));case 23:case"end":return e.stop()}}),t)}))),c.apply(this,arguments)}function f(e,t){return e.popupTemplate?e.popupTemplate:(0,o.isSome)(t)&&t.defaultPopupTemplateEnabled&&(0,o.isSome)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}))}();
//# sourceMappingURL=FeatureLayerView2D.73ef3d87.js.map
