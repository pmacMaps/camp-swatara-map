function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("4vCM3",(function(n,r){e(n.exports,"registerFunctions",(function(){return R}));var a=t("blknR"),i=t("7e1Ja"),o=t("lz1nc"),l=t("li6NP"),s=t("2mxq8"),u=t("dkJvZ"),c=t("4kTC4"),d=t("gnHjs"),f=t("hyHkL"),m=t("bRYh6"),E=t("wX5Cx"),p=t("bl77A"),y=t("6Ds9D"),h=t("7uexG"),g=t("ibJf1"),x=t("aF5xI"),w=t("fJDU4"),F=t("axKjD"),A=t("e4OKu"),I=t("lRAbM"),C=t("lHg4e"),D=t("jKVXg"),S=t("iaM5n"),b=t("4VorL"),N=t("39WmQ");async function T(e,t,n){const r=e.getVariables();if(r.length>0){const a=[];for(let e=0;e<r.length;e++){const i={name:r[e]};a.push(await t.evaluateIdentifier(n,i))}const i={};for(let e=0;e<r.length;e++)i[r[e]]=a[e];return e.parameters=i,e}return e}function P(e,t,n=null){for(const n in e)if(n.toLowerCase()===t.toLowerCase())return e[n];return n}function v(e){if(null===e)return null;const t={type:P(e,"type",""),name:P(e,"name","")};if("range"===t.type)t.range=P(e,"range",[]);else{t.codedValues=[];for(const n of P(e,"codedValues",[]))t.codedValues.push({name:P(n,"name",""),code:P(n,"code",null)})}return t}function L(e){if(null===e)return null;const t={},n=P(e,"wkt",null);null!==n&&(t.wkt=n);const r=P(e,"wkid",null);return null!==r&&(t.wkid=r),t}function $(e){if(null===e)return null;const t={hasZ:P(e,"hasz",!1),hasM:P(e,"hasm",!1)},n=P(e,"spatialreference",null);n&&(t.spatialReference=L(n));const r=P(e,"x",null);if(null!==r)return t.x=r,t.y=P(e,"y",null),t;const a=P(e,"rings",null);if(null!==a)return t.rings=a,t;const i=P(e,"paths",null);if(null!==i)return t.paths=i,t;const o=P(e,"points",null);if(null!==o)return t.points=o,t;for(const n of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const r=P(e,n,null);null!==r&&(t[n]=r)}return t}function R(e){"async"===e.mode&&(e.functions.timezone=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,i)=>{if((0,f.C)(i,1,2,t,n),(0,f.r)(i[0])){if(await i[0].load(),1===i.length||null===i[1])return i[0].dateTimeReferenceFieldIndex.layerDateFieldsTimeZone;if(!(i[1]instanceof o.default)||!1===i[1].hasField("type"))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);const e=i[1].field("type");if(!1===(0,f.c)(e))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);switch((0,f.j)(e).toLowerCase()){case"preferredtimezone":return i[0].dateTimeReferenceFieldIndex.layerPreferredTimeZone;case"editfieldsinfo":return i[0].dateTimeReferenceFieldIndex.layerEditFieldsTimeZone;case"timeinfo":return i[0].dateTimeReferenceFieldIndex.layerTimeInfoTimeZone;case"field":if(i[1].hasField("fieldname")&&(0,f.c)(i[1].field("fieldname")))return i[0].dateTimeReferenceFieldIndex.fieldTimeZone((0,f.j)(i[1].field("fieldname")))}throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n)}const s=(0,f.l)(i[0],(0,f.G)(t));if(null===s)return null;const u=s.timeZone;return"system"===u?a.ArcadeDate.systemTimeZoneCanonicalName:u}))},e.functions.sqltimestamp=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,a)=>{(0,f.C)(a,1,3,t,n);const i=a[0];if((0,f.k)(i)){if(1===a.length)return i.toSQLString();if(2===a.length)return i.changeTimeZone((0,f.j)(a[1])).toSQLString();throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n)}if((0,f.r)(i)){if(3!==a.length)throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);await i.load();const e=(0,f.j)(a[1]);if(!1===(0,f.k)(a[2]))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);const r=i.fieldTimeZone(e);return null===r?a[2].toSQLString():a[2].changeTimeZone(r).toSQLString()}throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n)}))},e.signatures.push({name:"sqltimestamp",min:2,max:4}),e.functions.featuresetbyid=function(t,n){return e.standardFunctionAsync(t,n,((e,r,a)=>{if((0,f.C)(a,2,4,t,n),a[0]instanceof u.default){const e=(0,f.j)(a[1]);let r=(0,f.D)(a[2],null);const i=(0,f.h)((0,f.D)(a[3],!0));if(null===r&&(r=["*"]),!1===(0,f.m)(r))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);return a[0].featureSetById(e,i,r)}throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n)}))},e.signatures.push({name:"featuresetbyid",min:2,max:4}),e.functions.getfeatureset=function(t,n){return e.standardFunctionAsync(t,n,((e,r,a)=>{if((0,f.C)(a,1,2,t,n),(0,f.p)(a[0])){let e=(0,f.D)(a[1],"datasource");return null===e&&(e="datasource"),e=(0,f.j)(e).toLowerCase(),(0,c.convertToFeatureSet)(a[0].fullSchema(),e,t.lrucache,t.interceptor,t.spatialReference)}throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n)}))},e.signatures.push({name:"getfeatureset",min:1,max:2}),e.functions.featuresetbyportalitem=function(t,n){return e.standardFunctionAsync(t,n,((e,r,a)=>{if((0,f.C)(a,2,5,t,n),null===a[0])throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.PortalRequired,n);if(a[0]instanceof i.default){const e=(0,f.j)(a[1]),r=(0,f.j)(a[2]);let i=(0,f.D)(a[3],null);const o=(0,f.h)((0,f.D)(a[4],!0));if(null===i&&(i=["*"]),!1===(0,f.m)(i))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);let s=null;return s=t.services&&t.services.portal?t.services.portal:N.default.getDefault(),s=(0,m.getPortal)(a[0],s),(0,c.constructFeatureSetFromPortalItem)(e,r,t.spatialReference,i,o,s,t.lrucache,t.interceptor)}if(!1===(0,f.c)(a[0]))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.PortalRequired,n);const o=(0,f.j)(a[0]),s=(0,f.j)(a[1]);let u=(0,f.D)(a[2],null);const d=(0,f.h)((0,f.D)(a[3],!0));if(null===u&&(u=["*"]),!1===(0,f.m)(u))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);return(0,c.constructFeatureSetFromPortalItem)(o,s,t.spatialReference,u,d,t.services?.portal??N.default.getDefault(),t.lrucache,t.interceptor)}))},e.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),e.functions.featuresetbyname=function(t,n){return e.standardFunctionAsync(t,n,((e,r,a)=>{if((0,f.C)(a,2,4,t,n),a[0]instanceof u.default){const e=(0,f.j)(a[1]);let r=(0,f.D)(a[2],null);const i=(0,f.h)((0,f.D)(a[3],!0));if(null===r&&(r=["*"]),!1===(0,f.m)(r))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);return a[0].featureSetByName(e,i,r)}throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n)}))},e.signatures.push({name:"featuresetbyname",min:2,max:4}),e.functions.featureset=function(t,n){return e.standardFunction(t,n,((e,r,a)=>{(0,f.C)(a,1,1,t,n);let i=a[0];const s={layerDefinition:{geometryType:"",objectIdField:"",hasM:!1,hasZ:!1,globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,f.c)(i))i=JSON.parse(i),void 0!==i.layerDefinition?(s.layerDefinition=i.layerDefinition,s.featureSet=i.featureSet,i.layerDefinition.spatialReference&&(s.layerDefinition.spatialReference=i.layerDefinition.spatialReference)):(s.featureSet.features=i.features,s.featureSet.geometryType=i.geometryType,s.layerDefinition.geometryType=s.featureSet.geometryType,s.layerDefinition.objectIdField=i.objectIdFieldName??"",s.layerDefinition.typeIdField=i.typeIdFieldName,s.layerDefinition.globalIdField=i.globalIdFieldName,s.layerDefinition.fields=i.fields,i.spatialReference&&(s.layerDefinition.spatialReference=i.spatialReference));else{if(!(a[0]instanceof o.default))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);{i=JSON.parse(a[0].castToText(!0));const e=P(i,"layerdefinition");if(null!==e){s.layerDefinition.geometryType=P(e,"geometrytype",""),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.globalIdField=P(e,"globalidfield",""),s.layerDefinition.objectIdField=P(e,"objectidfield",""),s.layerDefinition.typeIdField=P(e,"typeidfield",""),s.layerDefinition.hasZ=!0===P(e,"hasz",!1),s.layerDefinition.hasM=!0===P(e,"hasm",!1);const t=P(e,"spatialreference",null);t&&(s.layerDefinition.spatialReference=L(t));for(const t of P(e,"fields",[])){const e={name:P(t,"name",""),alias:P(t,"alias",""),type:P(t,"type",""),nullable:P(t,"nullable",!0),editable:P(t,"editable",!0),length:P(t,"length",null),domain:v(P(t,"domain"))};s.layerDefinition.fields.push(e)}const n=P(i,"featureset",null);if(n){const e={};for(const t of s.layerDefinition.fields)e[t.name.toLowerCase()]=t.name;for(const t of P(n,"features",[])){const n={},r=P(t,"attributes",{});for(const t in r)n[e[t.toLowerCase()]]=r[t];s.featureSet.features.push({attributes:n,geometry:$(P(t,"geometry",null))})}}}else{s.layerDefinition.hasZ=!0===P(i,"hasz",!1),s.layerDefinition.hasM=!0===P(i,"hasm",!1),s.layerDefinition.geometryType=P(i,"geometrytype",""),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.objectIdField=P(i,"objectidfieldname",""),s.layerDefinition.typeIdField=P(i,"typeidfieldname","");const e=P(i,"spatialreference",null);e&&(s.layerDefinition.spatialReference=L(e));let t=P(i,"fields",null);if((0,f.m)(t))for(const e of t){const t={name:P(e,"name",""),alias:P(e,"alias",""),type:P(e,"type",""),nullable:P(e,"nullable",!0),editable:P(e,"editable",!0),length:P(e,"length",null),domain:v(P(e,"domain"))};s.layerDefinition.fields.push(t)}else t=null,s.layerDefinition.fields=t;const n={};for(const e of s.layerDefinition.fields)n[e.name.toLowerCase()]=e.name;let r=P(i,"features",null);if((0,f.m)(r))for(const e of r){const t={},r=P(e,"attributes",{});for(const e in r)t[n[e.toLowerCase()]]=r[e];s.featureSet.features.push({attributes:t,geometry:$(P(e,"geometry",null))})}else r=null,s.featureSet.features=r}}}if(!1===function(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,t){for(const n of t)if(n===e)return!0;return!1}(e.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&!1!==(0,f.m)(e.layerDefinition.fields)&&!1!==(0,f.m)(e.featureSet.features)}(s))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);return""===(s?.layerDefinition?.geometryType||"")&&(s.layerDefinition.geometryType="esriGeometryNull"),x.default.create(s,t.spatialReference)}))},e.signatures.push({name:"featureset",min:1,max:1}),e.functions.filter=function(t,n){return e.standardFunctionAsync(t,n,(async(r,a,i)=>{if((0,f.C)(i,2,2,t,n),(0,f.m)(i[0])||(0,f.o)(i[0])){const e=[];let r=i[0];r instanceof d.default&&(r=r.toArray());let a=null;if(!(0,f.i)(i[1]))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);a=i[1].createFunction(t);for(const t of r){const n=a(t);(0,C.isPromiseLike)(n)?!0===await n&&e.push(t):!0===n&&e.push(t)}return e}if((0,f.r)(i[0])){const n=await i[0].load(),r=D.WhereClause.create(i[1],n.getFieldsIndex()),a=r.getVariables();if(a.length>0){const n=[];for(let r=0;r<a.length;r++){const i={name:a[r]};n.push(await e.evaluateIdentifier(t,i))}const o={};for(let e=0;e<a.length;e++)o[a[e]]=n[e];return r.parameters=o,new(0,p.default)({parentfeatureset:i[0],whereclause:r})}return new(0,p.default)({parentfeatureset:i[0],whereclause:r})}throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n)}))},e.signatures.push({name:"filter",min:2,max:2}),e.functions.orderby=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,a)=>{if((0,f.C)(a,2,2,t,n),(0,f.r)(a[0])){const e=new(0,w.default)(a[1]);return new(0,y.default)({parentfeatureset:a[0],orderbyclause:e})}throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n)}))},e.signatures.push({name:"orderby",min:2,max:2}),e.functions.top=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,a)=>{if((0,f.C)(a,2,2,t,n),(0,f.r)(a[0]))return new(0,h.default)({parentfeatureset:a[0],topnum:a[1]});if((0,f.m)(a[0]))return(0,f.g)(a[1])>=a[0].length?a[0].slice(0):a[0].slice(0,(0,f.g)(a[1]));if((0,f.o)(a[0]))return(0,f.g)(a[1])>=a[0].length()?a[0].slice(0):a[0].slice(0,(0,f.g)(a[1]));throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n)}))},e.signatures.push({name:"top",min:2,max:2}),e.functions.first=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,a)=>{if((0,f.C)(a,1,1,t,n),(0,f.r)(a[0])){const n=await a[0].first(e.abortSignal);if(null!==n){const e=s.default.createFromGraphicLikeObject(n.geometry,n.attributes,a[0],t.timeReference);return e._underlyingGraphic=n,e}return n}return(0,f.m)(a[0])?0===a[0].length?null:a[0][0]:(0,f.o)(a[0])?0===a[0].length()?null:a[0].get(0):null}))},e.signatures.push({name:"first",min:1,max:1}),e.functions.attachments=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,a)=>{(0,f.C)(a,1,2,t,n);const i={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(a.length>1)if(a[1]instanceof o.default){if(a[1].hasField("minsize")&&(i.minsize=(0,f.g)(a[1].field("minsize"))),a[1].hasField("metadata")&&(i.returnMetadata=(0,f.h)(a[1].field("metadata"))),a[1].hasField("maxsize")&&(i.maxsize=(0,f.g)(a[1].field("maxsize"))),a[1].hasField("types")){const e=(0,f.a0)(a[1].field("types"),!1);e.length>0&&(i.types=e)}}else if(null!==a[1])throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);if((0,f.p)(a[0])){let e=a[0]._layer;return e instanceof S.default&&(e=(0,c.constructFeatureSet)(e,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===e||!1===(0,f.r)(e)?[]:(await e.load(),e.queryAttachments(a[0].field(e.objectIdField),i.minsize,i.maxsize,i.types,i.returnMetadata))}if(null===a[0])return[];throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n)}))},e.signatures.push({name:"attachments",min:1,max:2}),e.functions.featuresetbyrelationshipname=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,a)=>{(0,f.C)(a,2,4,t,n);const i=a[0],o=(0,f.j)(a[1]);let s=(0,f.D)(a[2],null);const u=(0,f.h)((0,f.D)(a[3],!0));if(null===s&&(s=["*"]),!1===(0,f.m)(s))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);if(null===a[0])return null;if(!(0,f.p)(a[0]))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);let d=i._layer;if(d instanceof S.default&&(d=(0,c.constructFeatureSet)(d,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===d)return null;if(!1===(0,f.r)(d))return null;d=await d.load();const m=d.relationshipMetaData().filter((e=>e.name===o));if(0===m.length)return null;if(void 0!==m[0].relationshipTableId&&null!==m[0].relationshipTableId&&m[0].relationshipTableId>-1)return(0,c.constructFeatureSetFromRelationship)(d,m[0],i.field(d.objectIdField),d.spatialReference,s,u,t.lrucache,t.interceptor);let E=d.serviceUrl();if(!E)return null;E="/"===E.charAt(E.length-1)?E+m[0].relatedTableId.toString():E+"/"+m[0].relatedTableId.toString();const p=await(0,c.constructFeatureSetFromUrl)(E,d.spatialReference,s,u,t.lrucache,t.interceptor);await p.load();let y=p.relationshipMetaData();if(y=y.filter((e=>e.id===m[0].id)),!1===i.hasField(m[0].keyField)||null===i.field(m[0].keyField)){const e=await d.getFeatureByObjectId(i.field(d.objectIdField),[m[0].keyField]);if(e){const t=D.WhereClause.create(y[0].keyField+"= @id",p.getFieldsIndex());return t.parameters={id:e.attributes[m[0].keyField]},p.filter(t)}return new(0,g.default)({parentfeatureset:p})}const h=D.WhereClause.create(y[0].keyField+"= @id",p.getFieldsIndex());return h.parameters={id:i.field(m[0].keyField)},p.filter(h)}))},e.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),e.functions.featuresetbyassociation=function(t,n){return e.standardFunctionAsync(t,n,(async(e,r,a)=>{(0,f.C)(a,2,3,t,n);const i=a[0],o=(0,f.j)((0,f.D)(a[1],"")).toLowerCase(),s=(0,f.c)(a[2])?(0,f.j)(a[2]):null;if(null===a[0])return null;if(!(0,f.p)(a[0]))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);let u=i._layer;if(u instanceof S.default&&(u=(0,c.constructFeatureSet)(u,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===u)return null;if(!1===(0,f.r)(u))return null;await u.load();const d=u.serviceUrl(),m=await(0,c.constructAssociationMetaDataFeatureSetFromUrl)(d,t.spatialReference);let p=null,y=null,h=!1;if(null!==s&&""!==s&&void 0!==s){for(const e of m.terminals)e.terminalName===s&&(y=e.terminalId);null===y&&(h=!0)}const g=m.associations.getFieldsIndex(),x=g.get("TOGLOBALID").name,w=g.get("FROMGLOBALID").name,A=g.get("TOTERMINALID").name,I=g.get("FROMTERMINALID").name,C=g.get("FROMNETWORKSOURCEID").name,N=g.get("TONETWORKSOURCEID").name,T=g.get("ASSOCIATIONTYPE").name,P=g.get("ISCONTENTVISIBLE").name,v=g.get("OBJECTID").name;for(const e of u.fields)if("global-id"===e.type){p=i.field(e.name);break}let L=null,$=new(0,E.SqlExpressionAdapted)(new(0,b.default)({name:"percentalong",alias:"percentalong",type:"double"}),D.WhereClause.create("0",m.associations.getFieldsIndex())),R=new(0,E.SqlExpressionAdapted)(new(0,b.default)({name:"side",alias:"side",type:"string"}),D.WhereClause.create("''",m.associations.getFieldsIndex()));const j="globalid",M="globalId",O={};for(const e in m.lkp)O[e]=m.lkp[e].sourceId;const k=new(0,E.StringToCodeAdapted)(new(0,b.default)({name:"classname",alias:"classname",type:"string"}),null,O);let W="";switch(o){case"midspan":{W=`((${x}='${p}') OR ( ${w}='${p}')) AND (${T} IN (5))`,k.codefield=D.WhereClause.create(`CASE WHEN (${x}='${p}') THEN ${C} ELSE ${N} END`,m.associations.getFieldsIndex());const e=(0,F.cloneField)(E.AdaptedFeatureSet.findField(m.associations.fields,w));e.name=j,e.alias=j,L=new(0,E.SqlExpressionAdapted)(e,D.WhereClause.create(`CASE WHEN (${w}='${p}') THEN ${x} ELSE ${w} END`,m.associations.getFieldsIndex())),$=m.unVersion>=4?new(0,E.OriginalField)(E.AdaptedFeatureSet.findField(m.associations.fields,g.get("PERCENTALONG").name)):new(0,E.SqlExpressionAdapted)(new(0,b.default)({name:"percentalong",alias:"percentalong",type:"double"}),D.WhereClause.create("0",m.associations.getFieldsIndex()));break}case"junctionedge":{W=`((${x}='${p}') OR ( ${w}='${p}')) AND (${T} IN (4,6))`,k.codefield=D.WhereClause.create(`CASE WHEN (${x}='${p}') THEN ${C} ELSE ${N} END`,m.associations.getFieldsIndex());const e=(0,F.cloneField)(E.AdaptedFeatureSet.findField(m.associations.fields,w));e.name=j,e.alias=j,L=new(0,E.SqlExpressionAdapted)(e,D.WhereClause.create(`CASE WHEN (${w}='${p}') THEN ${x} ELSE ${w} END`,m.associations.getFieldsIndex())),R=new(0,E.SqlExpressionAdapted)(new(0,b.default)({name:"side",alias:"side",type:"string"}),D.WhereClause.create(`CASE WHEN (${T}=4) THEN 'from' ELSE 'to' END`,m.associations.getFieldsIndex()));break}case"connected":{let e=`${x}='@T'`,t=`${w}='@T'`;null!==y&&(e+=` AND ${A}=@A`,t+=` AND ${I}=@A`),W="(("+e+") OR ("+t+"))",W=(0,f.P)(W,"@T",p??""),e=(0,f.P)(e,"@T",p??""),null!==y&&(e=(0,f.P)(e,"@A",y.toString()),W=(0,f.P)(W,"@A",y.toString())),k.codefield=D.WhereClause.create("CASE WHEN "+e+` THEN ${C} ELSE ${N} END`,m.associations.getFieldsIndex());const n=(0,F.cloneField)(E.AdaptedFeatureSet.findField(m.associations.fields,w));n.name=j,n.alias=j,L=new(0,E.SqlExpressionAdapted)(n,D.WhereClause.create("CASE WHEN "+e+` THEN ${w} ELSE ${x} END`,m.associations.getFieldsIndex()));break}case"container":W=`${x}='${p}' AND ${T} = 2`,null!==y&&(W+=` AND ${A} = `+y.toString()),k.codefield=C,W="( "+W+" )",L=new(0,E.FieldRename)(E.AdaptedFeatureSet.findField(m.associations.fields,w),j,j);break;case"content":W=`(${w}='${p}' AND ${T} = 2)`,null!==y&&(W+=` AND ${I} = `+y.toString()),k.codefield=N,W="( "+W+" )",L=new(0,E.FieldRename)(E.AdaptedFeatureSet.findField(m.associations.fields,x),j,j);break;case"structure":W=`(${x}='${p}' AND ${T} = 3)`,null!==y&&(W+=` AND ${A} = `+y.toString()),k.codefield=C,W="( "+W+" )",L=new(0,E.FieldRename)(E.AdaptedFeatureSet.findField(m.associations.fields,w),j,M);break;case"attached":W=`(${w}='${p}' AND ${T} = 3)`,null!==y&&(W+=` AND ${I} = `+y.toString()),k.codefield=N,W="( "+W+" )",L=new(0,E.FieldRename)(E.AdaptedFeatureSet.findField(m.associations.fields,x),j,M);break;default:throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n)}return h&&(W="1 <> 1"),new(0,E.AdaptedFeatureSet)({parentfeatureset:m.associations,adaptedFields:[new(0,E.OriginalField)(E.AdaptedFeatureSet.findField(m.associations.fields,v)),new(0,E.OriginalField)(E.AdaptedFeatureSet.findField(m.associations.fields,P)),L,R,k,$],extraFilter:W?D.WhereClause.create(W,m.associations.getFieldsIndex()):null})}))},e.signatures.push({name:"featuresetbyassociation",min:2,max:6}),e.functions.groupby=function(t,n){return e.standardFunctionAsync(t,n,(async(r,a,i)=>{if((0,f.C)(i,3,3,t,n),!(0,f.r)(i[0]))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);const s=await i[0].load(),u=[],c=[];let d=!1,m=[];if((0,f.c)(i[1]))m.push(i[1]);else if(i[1]instanceof o.default)m.push(i[1]);else if((0,f.m)(i[1]))m=i[1];else{if(!(0,f.o)(i[1]))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);m=i[1].toArray()}for(const e of m)if((0,f.c)(e)){const t=D.WhereClause.create((0,f.j)(e),s.getFieldsIndex()),n=!0===(0,A.isSingleField)(t)?(0,f.j)(e):"%%%%FIELDNAME";u.push({name:n,expression:t}),"%%%%FIELDNAME"===n&&(d=!0)}else{if(!(e instanceof o.default))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);{const r=e.hasField("name")?e.field("name"):"%%%%FIELDNAME",a=e.hasField("expression")?e.field("expression"):"";if("%%%%FIELDNAME"===r&&(d=!0),!r)throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);u.push({name:r,expression:D.WhereClause.create(a||r,s.getFieldsIndex())})}}if(m=[],(0,f.c)(i[2]))m.push(i[2]);else if((0,f.m)(i[2]))m=i[2];else if((0,f.o)(i[2]))m=i[2].toArray();else{if(!(i[2]instanceof o.default))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);m.push(i[2])}for(const e of m){if(!(e instanceof o.default))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);{const r=e.hasField("name")?e.field("name"):"",a=e.hasField("statistic")?e.field("statistic"):"",i=e.hasField("expression")?e.field("expression"):"";if(!r||!a||!i)throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);c.push({name:r,statistic:a.toLowerCase(),expression:D.WhereClause.create(i,s.getFieldsIndex())})}}if(d){const e={};for(const t of s.fields)e[t.name.toLowerCase()]=1;for(const t of u)"%%%%FIELDNAME"!==t.name&&(e[t.name.toLowerCase()]=1);for(const t of c)"%%%%FIELDNAME"!==t.name&&(e[t.name.toLowerCase()]=1);let t=0;for(const n of u)if("%%%%FIELDNAME"===n.name){for(;1===e["field_"+t.toString()];)t++;e["field_"+t.toString()]=1,n.name="FIELD_"+t.toString()}}for(const n of u)await T(n.expression,e,t);for(const n of c)await T(n.expression,e,t);return i[0].groupby(u,c)}))},e.signatures.push({name:"groupby",min:3,max:3}),e.functions.distinct=function(t,n){return e.standardFunctionAsync(t,n,(async(r,a,i)=>{if((0,f.r)(i[0])){(0,f.C)(i,2,2,t,n);const r=await i[0].load(),a=[];let s=[];if((0,f.c)(i[1]))s.push(i[1]);else if(i[1]instanceof o.default)s.push(i[1]);else if((0,f.m)(i[1]))s=i[1];else{if(!(0,f.o)(i[1]))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);s=i[1].toArray()}let u=!1;for(const e of s)if((0,f.c)(e)){const t=D.WhereClause.create((0,f.j)(e),r.getFieldsIndex()),n=!0===(0,A.isSingleField)(t)?(0,f.j)(e):"%%%%FIELDNAME";a.push({name:n,expression:t}),"%%%%FIELDNAME"===n&&(u=!0)}else{if(!(e instanceof o.default))throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);{const i=e.hasField("name")?e.field("name"):"%%%%FIELDNAME",o=e.hasField("expression")?e.field("expression"):"";if("%%%%FIELDNAME"===i&&(u=!0),!i)throw new(0,l.ArcadeExecutionError)(t,l.ExecutionErrorCodes.InvalidParameter,n);a.push({name:i,expression:D.WhereClause.create(o||i,r.getFieldsIndex())})}}if(u){const e={};for(const t of r.fields)e[t.name.toLowerCase()]=1;for(const t of a)"%%%%FIELDNAME"!==t.name&&(e[t.name.toLowerCase()]=1);let t=0;for(const n of a)if("%%%%FIELDNAME"===n.name){for(;1===e["field_"+t.toString()];)t++;e["field_"+t.toString()]=1,n.name="FIELD_"+t.toString()}}for(const n of a)await T(n.expression,e,t);return i[0].groupby(a,[])}return function(e,t,n,r){if(1===r.length){if((0,f.m)(r[0]))return(0,I.calculateStat)(e,r[0],-1);if((0,f.o)(r[0]))return(0,I.calculateStat)(e,r[0].toArray(),-1)}return(0,I.calculateStat)(e,r,-1)}("distinct",0,0,i)}))})}})),t.register("bRYh6",(function(n,r){e(n.exports,"getPortal",(function(){return l})),e(n.exports,"lookupUser",(function(){return s}));var a=t("1mmm2"),i=t("bYA0c"),o=t("39WmQ");function l(e,t){return null===e?t:new(0,o.default)({url:e.field("url")})}async function s(e,t,n){const r=a.id?.findCredential(e.restUrl);if(!r)return null;if("loaded"===e.loadStatus&&""===t&&e.user&&e.user.sourceJSON&&!1===n)return e.user.sourceJSON;if(""===t){const t=await(0,i.default)(e.restUrl+"/community/self",{responseType:"json",query:{f:"json",...!1===n?{}:{returnUserLicenseTypeExtensions:!0}}});if(t.data){const e=t.data;if(e&&e.username)return e}return null}const o=await(0,i.default)(e.restUrl+"/community/users/"+t,{responseType:"json",query:{f:"json"}});if(o.data){const e=o.data;return e.error?null:e}return null}}));
//# sourceMappingURL=featuresetbase.8ad74ddd.js.map
