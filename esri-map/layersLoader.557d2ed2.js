!function(){function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("j0Uz9",(function(r,n){e(r.exports,"load",(function(){return f})),e(r.exports,"preprocessFSItemData",(function(){return g})),e(r.exports,"getSubtypeGroupLayerIds",(function(){return I})),e(r.exports,"getNumLayersAndTables",(function(){return w})),e(r.exports,"getFirstLayerOrTableId",(function(){return h}));var a=t("kyj08"),l=t("4LDxK"),o=t("lmu5w"),i=t("Hse1P"),u=t("ajJOT"),s=t("iYaGG"),c=t("UdTKD"),d=t("7Kuhs"),y=t("2TQQP"),p=t("8I1KP");async function f(e,t){const r=e.instance.portalItem;if(r&&r.id)return await r.load(t),function(e){const t=e.instance.portalItem;if(!(null==t?void 0:t.type)||!e.supportedTypes.includes(t.type))throw new(0,a.default)("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:null==t?void 0:t.type,expectedType:e.supportedTypes.join(", ")})}(e),async function(e,t){const r=e.instance,n=r.portalItem;if(!n)return;const{url:l,title:o}=n,u=(0,c.createForItemRead)(n);if("group"===r.type)return r.read({title:o},u),async function(e,t){let r;const{portalItem:n}=e;if(!n)return;var l;const o=n.type,u=t.layerModuleTypeMap,s=null!==(l=(0,d.hasTypeKeyword)(n,"Oriented Imagery Layer"))&&void 0!==l&&l;switch(o){case"Feature Service":r=s?u.OrientedImageryLayer:u.FeatureLayer;break;case"Stream Service":r=u.StreamLayer;break;case"Scene Service":r=u.SceneLayer;break;case"Feature Collection":r=u.FeatureLayer;break;default:throw new(0,a.default)("portal:unsupported-item-type-as-group",`The item type '${o}' is not supported as a 'IGroupLayer'`)}let[c,y]=await Promise.all([r(),S(t)]),f=()=>c;if("Feature Service"===o){if(y=n.url?await g(y,n.url):{},I(y).length){const e=u.SubtypeGroupLayer,t=await e();f=e=>"SubtypeGroupLayer"===e.layerType?t:c}return m(e,f,y,await async function(e){const{layersJSON:t}=await(0,i.fetchFeatureService)(e);if(!t)return null;const r=[...t.layers,...t.tables];return e=>r.find((t=>t.id===e.id))}(n.url))}return w(y)>0?m(e,f,y):async function(e,t){var r,n;const{portalItem:a}=e;if(!(null==a?void 0:a.url))return;const l=await(0,p.fetchArcGISServiceJSON)(a.url);l&&m(e,t,{layers:null===(r=l.layers)||void 0===r?void 0:r.map(v),tables:null===(n=l.tables)||void 0===n?void 0:n.map(v)})}(e,f)}(r,e);l&&r.read({url:l},u);const s=await S(e,t);var f;return s&&r.read(s,u),r.resourceReferences={portalItem:n,paths:null!==(f=u.readResourcePaths)&&void 0!==f?f:[]},"subtype-group"!==r.type&&r.read({title:o},u),(0,y.loadStyleRenderer)(r,u)}(e,t)}function v(e){return{id:e.id,name:e.name}}function m(e,t,r,n){var i;let u=r.layers||[];const c=r.tables||[];if("Feature Collection"===(null===(i=e.portalItem)||void 0===i?void 0:i.type)&&(u.forEach((e=>{var t;"Table"===(null==e||null===(t=e.layerDefinition)||void 0===t?void 0:t.type)&&c.push(e)})),u=u.filter((e=>{var t;return"Table"!==(null==e||null===(t=e.layerDefinition)||void 0===t?void 0:t.type)}))),"coverage"in r){const t=function(e){const{coverage:t}=e;if(!t)return null;const r=new URL(t);if(t.toLowerCase().includes("item.html")){const e=r.searchParams.get("id"),t=r.origin;return l.default.fromPortalItem({portalItem:new(0,s.default)({id:e,url:t})})}if((0,o.isArcGISUrl)(t))return l.default.fromArcGISServerUrl({url:t});throw new(0,a.default)("portal:oriented-imagery-layer-coverage","the provided coverage url couldn't be loaded as a layer")}(r);t&&e.add(t)}u.reverse().forEach((a=>{const l=null==n?void 0:n(a);if(l||!n){const n=b(e,t(a),r,a,l);e.add(n)}})),c.reverse().forEach((a=>{const l=null==n?void 0:n(a);if(l||!n){const n=b(e,t(a),r,a,l);e.tables.add(n)}}))}function b(e,t,r,n,a){const l=e.portalItem,o=new t({portalItem:l.clone(),layerId:n.id});if("sourceJSON"in o&&(o.sourceJSON=a),"subtype-group"!==o.type&&(o.sublayerTitleMode="service-name"),"Feature Collection"===l.type){const e={origin:"portal-item",portal:l.portal||u.default.getDefault()};o.read(n,e);const t=r.showLegend;null!=t&&o.read({showLegend:t},e)}return o}async function S(e,t){if(!1===e.supportsData)return;const r=e.instance,n=r.portalItem;if(!n)return;let a=null;try{a=await n.fetchData("json",t)}catch(e){}if(function(e){return"stream"!==e.type&&"oriented-imagery"!==e.type&&"layerId"in e}(r)){let e=null,t=!0;if(a&&w(a)>0){if(null==r.layerId){const e=I(a);r.layerId="subtype-group"===r.type?null==e?void 0:e[0]:h(a)}e=function(e,t){var r,n;const{layerId:a}=t,l=(null===(r=e.layers)||void 0===r?void 0:r.find((e=>e.id===a)))||(null===(n=e.tables)||void 0===n?void 0:n.find((e=>e.id===a)));return l&&function(e,t){return!("feature"===t.type&&"layerType"in e&&"SubtypeGroupLayer"===e.layerType||"subtype-group"===t.type&&!("layerType"in e))}(l,t)?l:null}(a,r),e&&(1===w(a)&&(t=!1),null!=a.showLegend&&(e.showLegend=a.showLegend))}return t&&"sublayerTitleMode"in r&&"service-name"!==r.sublayerTitleMode&&(r.sublayerTitleMode="item-title-and-service-name"),e}return a}async function g(e,t){if(null==(null==e?void 0:e.layers)||null==(null==e?void 0:e.tables)){const r=await(0,p.fetchArcGISServiceJSON)(t);(e=e||{}).layers=e.layers||(null==r?void 0:r.layers),e.tables=e.tables||(null==r?void 0:r.tables)}return e}function h(e){const t=e.layers;if(t&&t.length)return t[0].id;const r=e.tables;return r&&r.length?r[0].id:null}function w(e){var t,r,n,a;return(null!==(n=null==e||null===(t=e.layers)||void 0===t?void 0:t.length)&&void 0!==n?n:0)+(null!==(a=null==e||null===(r=e.tables)||void 0===r?void 0:r.length)&&void 0!==a?a:0)}function I(e){var t;const r=[];return null==e||null===(t=e.layers)||void 0===t||t.forEach((e=>{"SubtypeGroupLayer"===e.layerType&&r.push(e.id)})),r}})),t.register("Hse1P",(function(r,n){e(r.exports,"fetchFeatureService",(function(){return l}));var a=t("8I1KP");async function l(e,t){const r=await(0,a.fetchArcGISServiceJSON)(e,t);r.layers=r.layers.filter(o);const n={serviceJSON:r};var l;if((null!==(l=r.currentVersion)&&void 0!==l?l:0)<10.5)return n;const i=await(0,a.fetchArcGISServiceJSON)(e+"/layers",t);return n.layersJSON={layers:i.layers.filter(o),tables:i.tables},n}function o(e){return!e.type||"Feature Layer"===e.type}})),t.register("8I1KP",(function(r,n){e(r.exports,"fetchArcGISServiceJSON",(function(){return l}));var a=t("9pNSx");async function l(e,t){const{data:r}=await(0,a.default)(e,{responseType:"json",query:{f:"json",...null==t?void 0:t.customParameters,token:null==t?void 0:t.apiKey}});return r}}))}();
//# sourceMappingURL=layersLoader.557d2ed2.js.map
