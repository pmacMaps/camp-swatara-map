function e(e,t,r,o){Object.defineProperty(e,t,{get:r,set:o,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("46pKY",(function(r,o){var s;s=r.exports,Object.defineProperty(s,"__esModule",{value:!0,configurable:!0}),e(r.exports,"default",(function(){return h}));var i=t("j6uz9");t("5HTPH");var n=t("1CpCt");t("6TszD"),t("gHCNy"),t("aX9sh"),t("bPmsI");var a=t("qA6zg"),l=t("lDoe3"),d=t("4xw97"),p=t("aPQ4T"),c=t("lyPWm"),y=t("9F6Dg");class u{constructor(e,t){this.offset=e,this.extent=t}}let f=class extends c.default{initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}async update(e,t){const r=t.schema.processors[0];"heatmap"===r.type&&(0,l.diff)(this._schema,r)&&(e.mesh=!0,this._schema=r)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}async onTileMessage(e,t,r){this._tileKeyToFeatureSets.has(e.key.id)||this._tileKeyToFeatureSets.set(e.key.id,new Map);const o=this._tileKeyToFeatureSets.get(e.key.id);if(o&&null!=t.addOrUpdate&&t.addOrUpdate.hasFeatures&&o.set(t.addOrUpdate.instance,t),t.end){const t=[],o=function(e){const t=e.key,r=new Map,o=256,s=p.TILE_SIZE,i=e.tileInfoView.tileInfo.isWrappable;return r.set((0,y.getPow2NeighborKey)(t,-1,-1,i).id,new u([-s,-s],[s-o,s-o,s,s])),r.set((0,y.getPow2NeighborKey)(t,0,-1,i).id,new u([0,-s],[0,s-o,s,s])),r.set((0,y.getPow2NeighborKey)(t,1,-1,i).id,new u([s,-s],[0,s-o,o,s])),r.set((0,y.getPow2NeighborKey)(t,-1,0,i).id,new u([-s,0],[s-o,0,s,s])),r.set((0,y.getPow2NeighborKey)(t,1,0,i).id,new u([s,0],[0,0,o,s])),r.set((0,y.getPow2NeighborKey)(t,-1,1,i).id,new u([-s,s],[s-o,0,s,o])),r.set((0,y.getPow2NeighborKey)(t,0,1,i).id,new u([0,s],[0,0,s,o])),r.set((0,y.getPow2NeighborKey)(t,1,1,i).id,new u([s,s],[0,0,o,o])),r}(e);this._tileKeyToFeatureSets.forEach(((r,s)=>{if(s===e.key.id)r.forEach((e=>(0,n.applySome)(e.addOrUpdate,(e=>t.push(e)))));else if(o.has(s)){const e=o.get(s),[i,a]=e.offset;r.forEach((e=>(0,n.applySome)(e.addOrUpdate,(e=>{const r=e.transform(i,a,1,1);t.push(r)}))))}}));const s=(0,d.calculateHeatmapIntensityInfoReaders)(t,this._schema.mesh,512,512),i={tileKey:e.key.id,intensityInfo:s},a=[s.matrix];return this.remoteClient.invoke("tileRenderer.onTileData",i,{...r,transferList:a})}}onTileError(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},r)}constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}};f=(0,i._)([(0,a.subclass)("esri.views.2d.layers.features.processors.HeatmapProcessor")],f);const h=f})),t.register("lyPWm",(function(r,o){e(r.exports,"default",(function(){return d}));var s=t("j6uz9"),i=t("8Y9g8"),n=t("hTI69");t("gHCNy"),t("aX9sh"),t("5HTPH");var a=t("qA6zg");let l=class extends i.HandleOwner{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};(0,s._)([(0,n.property)({readOnly:!0})],l.prototype,"supportsTileUpdates",null),(0,s._)([(0,n.property)({constructOnly:!0})],l.prototype,"remoteClient",void 0),(0,s._)([(0,n.property)({constructOnly:!0})],l.prototype,"service",void 0),(0,s._)([(0,n.property)()],l.prototype,"spatialReference",null),(0,s._)([(0,n.property)({constructOnly:!0})],l.prototype,"tileInfo",void 0),(0,s._)([(0,n.property)({constructOnly:!0})],l.prototype,"tileStore",void 0),l=(0,s._)([(0,a.subclass)("esri.views.2d.layers.features.processors.BaseProcessor")],l);const d=l})),t.register("9F6Dg",(function(t,r){function o(e,t,r,o){const s=e.clone(),i=1<<s.level,n=s.col+t,a=s.row+r;return o&&n<0?(s.col=n+i,s.world-=1):n>=i?(s.col=n-i,s.world+=1):s.col=n,s.row=a,s}e(t.exports,"getPow2NeighborKey",(function(){return o}))}));
//# sourceMappingURL=HeatmapProcessor.90f69554.js.map
