!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("891yq",(function(n,a){var i;i=n.exports,Object.defineProperty(i,"__esModule",{value:!0,configurable:!0}),t(n.exports,"default",(function(){return D}));var o=r("8TSCy"),s=r("2TvXO"),l=r("7eJjO"),u=r("3MVX3"),c=r("3uTA1"),f=r("kyj08"),p=r("7qybv"),d=r("8NioF"),m=r("10vEZ"),h=r("iho5X");r("lNwWH"),r("2VlWd");var y=r("iJAIC"),v=r("bSafx"),x=r("eB8sj"),g=r("fcwIv"),b=r("4LDxK"),k=r("gIXJ2"),w=r("cv2jJ"),I=r("8lxwi"),S=r("5N5S1"),T=r("9bAYR"),C=r("13Qxf"),_=r("3GzOb"),R=r("2t08e"),M=r("gRgX5"),O=r("buMuJ"),P=r("5Lo1P"),N=r("4ZD9O"),E=r("37qRo"),F=function(t){"use strict";o.inherits(n,t);var r=o.createSuper(n);function n(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var i;return o.classCallCheck(this,n),(i=r.call.apply(r,[this].concat(o.toConsumableArray(t)))).bandIds=null,i.interpolation=null,i.legendEnabled=!0,i.isReference=null,i.listMode="show",i.sourceJSON=null,i.version=null,i.title=null,i.type="imagery-tile",i.operationalLayerType="ArcGISTiledImageServiceLayer",i.popupEnabled=!0,i.popupTemplate=null,i.fields=null,o.possibleConstructorReturn(i)}return o.createClass(n,[{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?o.objectSpread({url:e},t):e}},{key:"load",value:function(e){var t=this,r=(0,p.isSome)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).catch(m.throwIfAbortError).then((function(){return t._openRaster(r)}))),Promise.resolve(this)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"rasterFields",get:function(){var e,t,r=[new(0,O.default)({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})],n=null==(e=this.rasterInfo)||null==(t=e.attributeTable)?void 0:t.fields;if(n){var a=n.filter((function(e){return"oid"!==e.type&&"value"!==e.name.toLowerCase()})).map((function(e){var t=e.clone();return t.name="Raster."+e.name,t}));r=r.concat(a)}var i=this.rasterInfo.dataType;if(("vector-magdir"===i||"vector-uv"===i)&&(0,p.isSome)(this.rasterInfo.multidimensionalInfo)){var o,s=null==(o=this.rasterInfo.multidimensionalInfo.variables[0].unit)?void 0:o.trim(),l="Magnitude"+(s?" (".concat(s,")"):"");r.push(new(0,O.default)({name:"Raster.Magnitude",alias:l,domain:null,editable:!1,type:"double"})),r.push(new(0,O.default)({name:"Raster.Direction",alias:"Direction (Â°)",domain:null,editable:!1,type:"double"}))}return r}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}},{key:"readRenderer",value:function(e,t,r){var n=t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,a=(0,c.read)(n,r)||void 0;if(null!=a)return a}},{key:"createPopupTemplate",value:function(e){return(0,E.createPopupTemplate)({fields:this.rasterFields,title:this.title},e)}},{key:"write",value:function(e,t){var r=this.raster;if(this.loaded?"RasterTileServer"===r.datasetFormat&&("Raster"===r.tileType||"Map"===r.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))return o.get(o.getPrototypeOf(n.prototype),"write",this).call(this,e,t);if(t&&t.messages){var a="".concat(t.origin,"/").concat(t.layerContainerType||"operational-layers");t.messages.push(new(0,f.default)("layer:unsupported","Layers (".concat(this.title,", ").concat(this.id,") of type '").concat(this.declaredClass,"' are not supported in the context of '").concat(a,"'"),{layer:this}))}return null}},{key:"_openRaster",value:function(t){var r=this;return o.asyncToGenerator(e(s).mark((function n(){var a,i;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.raster){e.next=8;break}if(e.t0=r.raster.rasterInfo,e.t0){e.next=5;break}return e.next=5,r.raster.open();case 5:r.url=r.raster.url,e.next=11;break;case 8:return e.next=10,N.default.open({url:r.url,sourceJSON:r.sourceJSON,ioConfig:o.objectSpread({sampling:"closest"},r.ioConfig,{customFetchParameters:r.customParameters}),signal:t});case 10:r.raster=e.sent;case 11:if(a=r.raster,a.rasterInfo){e.next=14;break}throw new(0,f.default)("imagery-tile-layer:load","cannot load resources on "+r.url);case 14:r.sourceJSON=r.sourceJSON||r.raster.sourceJSON,null!=r.sourceJSON&&(i="Map"===r.raster.tileType&&null!=r.sourceJSON.minLOD&&null!=r.sourceJSON.maxLOD?r.sourceJSON:o.objectSpread({},r.sourceJSON,{minScale:0,maxScale:0}),r.read(i,{origin:"service"})),null==r.title&&(r.title=r.raster.datasetName),"Map"===r.raster.tileType&&(r.popupEnabled=!1),r._configDefaultSettings(),r.watch("customParameters",(function(e){return r.raster.ioConfig.customFetchParameters=e}));case 16:case"end":return e.stop()}}),n)})))()}}]),n}((0,k.BlendLayer)((0,_.ScaleRangeLayer)((0,S.OperationalLayer)((0,T.PortalLayer)((0,w.CustomParametersMixin)((0,I.ImageryTileMixin)((0,R.TemporalLayer)((0,C.RefreshableLayer)((0,d.MultiOriginJSONMixin)(b.default))))))))));(0,l._)([(0,h.property)({type:[y.Integer],json:{write:{overridePolicy:function(){var e;return{enabled:!this.loaded||"Raster"===this.raster.tileType||"0,1,2"!==(null==(e=this.bandIds)?void 0:e.join(","))}}}}})],F.prototype,"bandIds",void 0),(0,l._)([(0,h.property)({json:{write:{overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType||"bilinear"!==this.interpolation}}}}}),(0,v.enumeration)(P.interpolationKebab)],F.prototype,"interpolation",void 0),(0,l._)([(0,h.property)({json:{write:!0}})],F.prototype,"multidimensionalDefinition",void 0),(0,l._)([(0,h.property)(M.legendEnabled)],F.prototype,"legendEnabled",void 0),(0,l._)([(0,h.property)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],F.prototype,"isReference",void 0),(0,l._)([(0,h.property)({type:["show","hide"]})],F.prototype,"listMode",void 0),(0,l._)([(0,h.property)()],F.prototype,"sourceJSON",void 0),(0,l._)([(0,h.property)({readOnly:!0,json:{origins:{service:{read:{source:"currentVersion"}}}}})],F.prototype,"version",void 0),(0,l._)([(0,h.property)()],F.prototype,"title",void 0),(0,l._)([(0,h.property)({readOnly:!0,json:{read:!1}})],F.prototype,"type",void 0),(0,l._)([(0,h.property)({type:["ArcGISTiledImageServiceLayer"]})],F.prototype,"operationalLayerType",void 0),(0,l._)([(0,h.property)({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}},writer:function(e,t,r){t[r]=!e}}}})],F.prototype,"popupEnabled",void 0),(0,l._)([(0,h.property)({type:u.default,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}}}}})],F.prototype,"popupTemplate",void 0),(0,l._)([(0,h.property)({readOnly:!0})],F.prototype,"defaultPopupTemplate",null),(0,l._)([(0,h.property)({readOnly:!0,type:[O.default]})],F.prototype,"fields",void 0),(0,l._)([(0,h.property)({readOnly:!0,type:[O.default]})],F.prototype,"rasterFields",null),(0,l._)([(0,h.property)({types:c.rasterRendererTypes,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:function(){var e,t="raster-stretch"===(null==(e=this.renderer)?void 0:e.type)&&"none"===this.renderer.stretchType&&!this.renderer.useGamma;return{enabled:!this.loaded||"Raster"===this.raster.tileType||!t}}},origins:{"web-scene":{types:c.websceneRasterRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:function(e){return{enabled:e&&"vector-field"!==e.type&&"flow"!==e.type}}}}}}})],F.prototype,"renderer",null),(0,l._)([(0,x.reader)("renderer")],F.prototype,"readRenderer",null);var D=F=(0,l._)([(0,g.subclass)("esri.layers.ImageryTileLayer")],F)})),r.register("8lxwi",(function(n,a){t(n.exports,"ImageryTileMixin",(function(){return R}));var i=r("8TSCy"),o=r("2TvXO"),s=r("7eJjO");r("2ILM8");var l=r("3uTA1"),u=r("9pNSx"),c=r("jHOLN"),f=r("7qybv"),p=r("kDa5L");r("lNwWH"),r("2VlWd"),r("iJAIC");var d=r("iho5X"),m=r("fcwIv"),h=r("eY5Yp"),y=r("lmu5w"),v=r("gRgX5"),x=r("d3QQf"),g=r("1399j"),b=r("xQ42o"),k=r("2hwKJ"),w=r("hlKjZ"),I=r("frUQM"),S=r("k8DEI"),T=r("gINRd"),C=r("j40xv"),_=c.default.getLogger("esri.layers.mixins.ImageryTileMixin"),R=function(t){var r=function(t){"use strict";i.inherits(n,t);var r=i.createSuper(n);function n(){var e;return i.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},e.bandIds=null,e.copyright=null,e.fullExtent=null,e.interpolation="nearest",e.multidimensionalDefinition=null,e.raster=null,e.rasterInfo=null,e.sourceJSON=null,e.spatialReference=null,e.tileInfo=null,e.symbolizer=null,i.possibleConstructorReturn(e)}return i.createClass(n,[{key:"url",set:function(e){this._set("url",(0,y.sanitizeUrl)(e,_))}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}},{key:"convertVectorFieldData",value:function(t,r){var n=this;return i.asyncToGenerator(e(o).mark((function a(){var i,s;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,f.isNone)(t)){e.next=2;break}return e.abrupt("return",null);case 2:return i=n._rasterJobHandler.instance,s=n.rasterInfo.dataType,e.abrupt("return",i?i.convertVectorFieldData({pixelBlock:t,dataType:s},r):(0,k.convertVectorFieldData)(t,s));case 4:case"end":return e.stop()}}),a)})))()}},{key:"createStreamlinesMesh",value:function(t,r){var n=this;return i.asyncToGenerator(e(o).mark((function a(){var i;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n._rasterJobHandler.instance,e.abrupt("return",i?i.createStreamlinesMesh(t,r):(0,S.createStreamlinesMesh)(t.rendererSettings,t.flowData,(0,f.isSome)(r.signal)?r.signal:(new AbortController).signal));case 2:case"end":return e.stop()}}),a)})))()}},{key:"normalizeRasterFetchOptions",value:function(e){var t=this.rasterInfo.multidimensionalInfo;if((0,f.isNone)(t))return e;var r=e.multidimensionalDefinition||this.multidimensionalDefinition;!(0,f.isNone)(r)&&r.length||(r=this._getDefaultSlice());var n=e.timeExtent||this.timeExtent;if((0,f.isSome)(r)&&(0,f.isSome)(n)&&((0,f.isSome)(n.start)||(0,f.isSome)(n.end))){var a,o;r=r.map((function(e){return e.clone()}));var s=null==(a=t.variables.find((function(e){return e.name===r[0].variableName})))||null==(o=a.dimensions)?void 0:o.find((function(e){return"StdTime"===e.name})),l=r.find((function(e){return"StdTime"===e.dimensionName}));if(!s||!l)return i.objectSpread({},e,{multidimensionalDefinition:null});var u=n.start,c=n.end,p=(0,f.isNone)(u)?null:u.getTime(),d=(0,f.isNone)(c)?null:c.getTime(),m=null!=p?p:d,h=null!=d?d:p;if((0,f.isSome)(s.values)){var y=s.values.filter((function(e){if(Array.isArray(e)){if(m===h)return e[0]<=m&&e[1]>=m;var t=e[0]<=m&&e[1]>m||e[0]<h&&e[1]>=h,r=e[0]>=m&&e[1]<=h||e[0]<m&&e[1]>h;return t||r}return m===h?e===m:e>=m&&e<=h}));if(y.length){var v=y.sort((function(e,t){var r,n,a,i;return m===h?(null!=(a=e[0])?a:e)-(null!=(i=t[0])?i:t):Math.abs((null!=(r=e[1])?r:e)-h)-Math.abs((null!=(n=t[1])?n:t)-h)}))[0];l.values=[v]}else r=null}else if(s.hasRegularIntervals&&s.extent){var x=i.slicedToArray(s.extent,2),g=x[0],b=x[1];m>b||h<g?r=null:l.values=m===h?[m]:[Math.max(g,m),Math.min(b,h)]}}return i.objectSpread({},e,{multidimensionalDefinition:r})}},{key:"updateRenderer",value:function(){var t=this;return i.asyncToGenerator(e(o).mark((function r(){var n;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.loaded){e.next=2;break}return e.abrupt("return");case 2:if(JSON.stringify(t._cachedRendererJson)!==JSON.stringify(t.renderer)){e.next=4;break}return e.abrupt("return");case 4:if(n=t._rasterJobHandler.instance,e.t0=n,!e.t0){e.next=12;break}return t.symbolizer.rendererJSON=(0,w.normalizeRendererJSON)(t.renderer.toJSON()),t.symbolizer.bind(),e.next=11,n.updateSymbolizer(t.symbolizer);case 11:t._cachedRendererJson=t.renderer.toJSON();case 12:case"end":return e.stop()}}),r)})))()}},{key:"applyRenderer",value:function(t,r){var n=this;return i.asyncToGenerator(e(o).mark((function a(){var s,l,u,c;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t&&t.pixelBlock,(0,f.isSome)(s)&&s.pixels&&s.pixels.length>0){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=6,n.updateRenderer();case 6:if(u=n._rasterJobHandler.instance,c=n.bandIds,!u){e.next=13;break}return e.next=10,u.symbolize(i.objectSpread({},t,{simpleStretchParams:r,bandIds:c}));case 10:e.t0=e.sent,e.next=14;break;case 13:e.t0=n.symbolizer.symbolize(i.objectSpread({},t,{simpleStretchParams:r,bandIds:c}));case 14:return l=e.t0,e.abrupt("return",l);case 16:case"end":return e.stop()}}),a)})))()}},{key:"getTileUrl",value:function(e,t,r){return"RasterTileServer"===this.raster.datasetFormat?"".concat(this.url,"/tile/").concat(e,"/").concat(t,"/").concat(r):""}},{key:"getCompatibleTileInfo",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.loaded||(0,f.isNone)(t))return null;if(r&&e.equals(this.spatialReference))return this.tileInfo;var n=(0,h.getInfo)(e);return b.default.create({size:256,spatialReference:e,origin:n?{x:n.origin[0],y:n.origin[1]}:{x:t.xmin,y:t.ymax}})}},{key:"getCompatibleFullExtent",value:function(e){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(e)||(this._compatibleFullExtent=this.raster.computeExtent(e)),this._compatibleFullExtent):null}},{key:"fetchTile",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this;return i.asyncToGenerator(e(o).mark((function l(){var c,p;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.requestAsImageElement){e.next=3;break}return c=s.getTileUrl(t,r,n),e.abrupt("return",(0,u.default)(c,{responseType:"image",query:i.objectSpread({},s.refreshParameters,s.raster.ioConfig.customFetchParameters),signal:a.signal}).then((function(e){return e.data})));case 3:if(!(0,f.isSome)(s.rasterInfo.multidimensionalInfo)||(a=s.normalizeRasterFetchOptions(a),!(0,f.isNone)(a.multidimensionalDefinition))){e.next=6;break}return p=a.tileInfo||s.rasterInfo.storageInfo.tileInfo,e.abrupt("return",{extent:s.raster.getTileExtentFromTileInfo(t,r,n,p),pixelBlock:null});case 6:return e.next=8,s._initJobHandler();case 8:return"raster-shaded-relief"===s.renderer.type&&(a=i.objectSpread({},a,{buffer:{cols:1,rows:1}})),e.abrupt("return",(e.sent,s.raster.fetchTile(t,r,n,a)));case 10:case"end":return e.stop()}}),l)})))()}},{key:"fetchPixels",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this;return i.asyncToGenerator(e(o).mark((function i(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,f.isSome)(s.rasterInfo.multidimensionalInfo)||(a=s.normalizeRasterFetchOptions(a),!(0,f.isNone)(a.multidimensionalDefinition))){e.next=4;break}e.t0={extent:t,pixelBlock:null},e.next=7;break;case 4:return e.next=6,s._initJobHandler();case 6:e.t0=(e.sent,s.raster.fetchPixels(t,r,n,a));case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),i)})))()}},{key:"identify",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this;return i.asyncToGenerator(e(o).mark((function a(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,f.isSome)(n.rasterInfo.multidimensionalInfo)&&(r=n.normalizeRasterFetchOptions(r),(0,f.isNone)(r.multidimensionalDefinition))?{location:t,value:null}:n.raster.identify(t,r));case 1:case"end":return e.stop()}}),a)})))()}},{key:"increaseRasterJobHandlerUsage",value:function(){this._rasterJobHandler.refCount++}},{key:"decreaseRasterJobHandlerUsage",value:function(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()}},{key:"hasStandardTime",value:function(){var e,t=this.rasterInfo.multidimensionalInfo;if(!(0,f.isSome)(t)||"standard-time"!==this.rasterInfo.dataType)return!1;var r=null==(e=this.multidimensionalDefinition[0])?void 0:e.variableName;return t.variables.some((function(e){return e.name===r&&e.dimensions.some((function(e){return"StdTime"===e.name}))}))}},{key:"getStandardTimeValue",value:function(e){return new Date(24*(e-25569)*36e5).toString()}},{key:"_configDefaultSettings",value:function(){this._configDefaultInterpolation(),this.multidimensionalDefinition||(this.multidimensionalDefinition=this._getDefaultSlice()),this._configDefaultRenderer()}},{key:"_initJobHandler",value:function(){var e=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;var t=new(0,g.default);return this._rasterJobHandler.connectionPromise=t.initialize().then((function(){e._rasterJobHandler.instance=t,e.raster.rasterJobHandler=t,e.renderer&&e.updateRenderer()})).catch((function(){return null})),this._rasterJobHandler.connectionPromise}},{key:"_shutdownJobHandler",value:function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null}},{key:"_configDefaultInterpolation",value:function(){if(null==this.interpolation){var e,t=(0,w.getDefaultInterpolation)(this.rasterInfo,this.raster.tileType,null==(e=this.sourceJSON)?void 0:e.defaultResamplingMethod);this._set("interpolation",t)}}},{key:"_getDefaultSlice",value:function(){var e=this.raster.rasterInfo.multidimensionalInfo;if(!(0,f.isSome)(e))return null;var t=e.variables[0];return t.dimensions.map((function(e){var r,n;return new(0,x.default)({variableName:t.name,dimensionName:e.name,values:[null!=(r=null==(n=e.values)?void 0:n[0])?r:e.extent[0]],isSlice:!0})}))}},{key:"_configDefaultRenderer",value:function(){var e,t=this.raster.rasterInfo;this.bandIds||(this.bandIds=(0,w.getDefaultBandCombination)(t)),this.renderer||(this.renderer=(0,w.createDefaultRenderer)(t,{bandIds:this.bandIds,variableName:(0,f.isSome)(this.multidimensionalDefinition)?null==(e=this.multidimensionalDefinition[0])?void 0:e.variableName:null})),this.symbolizer?(this.symbolizer.rendererJSON=(0,w.normalizeRendererJSON)(this.renderer.toJSON()),this.symbolizer.rasterInfo=t):this.symbolizer=new(0,I.default)({rendererJSON:this.renderer.toJSON(),rasterInfo:t});var r=this.symbolizer.bind();r.success||_.warn("imagery-tile-mixin",r.error||"The given renderer is not supported by the layer.")}}]),n}(t);return(0,s._)([(0,d.property)()],r.prototype,"_cachedRendererJson",void 0),(0,s._)([(0,d.property)()],r.prototype,"_compatibleFullExtent",void 0),(0,s._)([(0,d.property)()],r.prototype,"_rasterJobHandler",void 0),(0,s._)([(0,d.property)()],r.prototype,"bandIds",void 0),(0,s._)([(0,d.property)({json:{origins:{service:{read:{source:"copyrightText"}}}}})],r.prototype,"copyright",void 0),(0,s._)([(0,d.property)({type:T.default,json:{read:!1}}),(0,p.aliasOf)("rasterInfo.extent")],r.prototype,"fullExtent",void 0),(0,s._)([(0,d.property)()],r.prototype,"interpolation",void 0),(0,s._)([(0,d.property)()],r.prototype,"ioConfig",void 0),(0,s._)([(0,d.property)({type:[x.default]})],r.prototype,"multidimensionalDefinition",void 0),(0,s._)([(0,d.property)()],r.prototype,"raster",void 0),(0,s._)([(0,d.property)({readOnly:!0}),(0,p.aliasOf)("raster.rasterInfo")],r.prototype,"rasterInfo",void 0),(0,s._)([(0,d.property)()],r.prototype,"sourceJSON",void 0),(0,s._)([(0,d.property)({type:C.default,json:{read:!1}}),(0,p.aliasOf)("rasterInfo.spatialReference")],r.prototype,"spatialReference",void 0),(0,s._)([(0,d.property)({type:b.default,json:{read:!1}}),(0,p.aliasOf)("rasterInfo.storageInfo.tileInfo")],r.prototype,"tileInfo",void 0),(0,s._)([(0,d.property)(v.url)],r.prototype,"url",null),(0,s._)([(0,d.property)({types:l.rasterRendererTypes})],r.prototype,"renderer",null),(0,s._)([(0,d.property)()],r.prototype,"symbolizer",void 0),r=(0,s._)([(0,m.subclass)("esri.layers.ImageryTileMixin")],r)}})),r.register("4ZD9O",(function(n,a){t(n.exports,"default",(function(){return m}));var i=r("8TSCy"),o=r("2TvXO"),s=r("kyj08"),l=r("1NZtp"),u=r("5K49h"),c=r("jbz8w"),f=r("ljwGu"),p=r("9Ybm2"),d=new Map;d.set("CRF",{desc:"Cloud Raster Format",constructor:l.default}),d.set("MRF",{desc:"Meta Raster Format",constructor:f.default}),d.set("TIFF",{desc:"GeoTIFF",constructor:p.default}),d.set("RasterTileServer",{desc:"Raster Tile Server",constructor:c.default}),d.set("JPG",{desc:"JPG Raster Format",constructor:u.default}),d.set("PNG",{desc:"PNG Raster Format",constructor:u.default}),d.set("GIF",{desc:"GIF Raster Format",constructor:u.default}),d.set("BMP",{desc:"BMP Raster Format",constructor:u.default});var m=function(){"use strict";function t(){i.classCallCheck(this,t)}return i.createClass(t,null,[{key:"supportedFormats",get:function(){var e=new Set;return d.forEach((function(t,r){return e.add(r)})),e}},{key:"open",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i,l,u,c,f,p,m,h,y;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.url,i=t.ioConfig,l=t.sourceJSON,null==(u=t.datasetFormat)&&a.lastIndexOf(".")&&(u=a.slice(a.lastIndexOf(".")+1).toUpperCase()),"OVR"===u||"TIF"===u?u="TIFF":"JPG"!==u&&"JPEG"!==u&&"JFIF"!==u||(u="JPG"),a.toLowerCase().indexOf("/imageserver")>-1&&-1===a.toLowerCase().indexOf("/wcsserver")&&(u="RasterTileServer"),c={url:a,sourceJSON:l,datasetFormat:u,ioConfig:i||{bandIds:null,sampling:null}},!r.supportedFormats.has(u)){e.next=11;break}return f=d.get(u).constructor,p=new f(c),e.next=10,p.open({signal:t.signal});case 10:return e.abrupt("return",(e.sent,p));case 11:if(!u){e.next=13;break}throw new(0,s.default)("rasterfactory:open","not a supported format "+u);case 13:return m=Array.from(d.keys()),h=0,y=function(){return(u=m[h++])?(f=d.get(u).constructor,(p=new f(c)).open({signal:t.signal}).then((function(){return p})).catch((function(){return y()}))):null},e.abrupt("return",y());case 17:case"end":return e.stop()}}),n)})))()}},{key:"register",value:function(e,t,r){d.has(e.toUpperCase())||d.set(e.toUpperCase(),{desc:t,constructor:r})}}]),t}()})),r.register("1NZtp",(function(n,a){t(n.exports,"default",(function(){return S}));var i=r("8TSCy"),o=r("2TvXO"),s=r("7eJjO");r("2ILM8");var l=r("kyj08"),u=r("7qybv"),c=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var f=r("fcwIv"),p=r("d0bii"),d=r("cQADC"),m=r("xQ42o"),h=r("5EhGd"),y=r("0fPji"),v=r("gzPy2"),x=r("f4h86"),g=r("j40xv"),b=r("gINRd"),k=r("d1Fqh"),w=new Map;w.set("int16","esriFieldTypeSmallInteger"),w.set("int32","esriFieldTypeInteger"),w.set("int64","esriFieldTypeInteger"),w.set("float32","esriFieldTypeSingle"),w.set("float64","esriFieldTypeDouble"),w.set("text","esriFieldTypeString");var I=function(t){"use strict";i.inherits(n,t);var r=i.createSuper(n);function n(){var e;return i.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments)))).storageInfo=null,e.datasetFormat="CRF",i.possibleConstructorReturn(e)}return i.createClass(n,[{key:"open",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i,s,u,c,f;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.init();case 2:return e.next=4,r.request(r.url+"/conf.json",{signal:null==t?void 0:t.signal});case 4:if(a=e.sent,i=a.data,r._validateHeader(i)){e.next=8;break}throw new(0,l.default)("cloudraster:open","Invalid or unsupported conf.json.");case 8:if(r.datasetName=r.url.slice(r.url.lastIndexOf("/")+1),s=r._parseHeader(i),u=s.storageInfo,"thematic"!==(c=s.rasterInfo).dataType){e.next=15;break}return e.next=13,r._fetchAuxiliaryInformation();case 13:f=e.sent,c.attributeTable=f;case 15:r._set("storageInfo",u),r._set("rasterInfo",c),r.ioConfig.retryCount=r.ioConfig.retryCount||0;case 16:case"end":return e.stop()}}),n)})))()}},{key:"fetchRawTile",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this;return i.asyncToGenerator(e(o).mark((function i(){var l,u,c,f,p,d,m;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((l=s.rasterInfo.storageInfo.maximumPyramidLevel-t)<0)){e.next=3;break}return e.abrupt("return",null);case 3:return u=s._buildCacheFilePath(l,r,n,a.multidimensionalDefinition),c=s._getIndexRecordFromBundle(r,n),e.next=7,s.request(u,{range:{from:0,to:s.storageInfo.headerSize-1},responseType:"array-buffer",signal:a.signal});case 7:if(f=e.sent){e.next=10;break}return e.abrupt("return",null);case 10:if(p=new Uint8Array(f.data),0!==(d=s._getTileEndAndContentType(p,c)).recordSize){e.next=13;break}return e.abrupt("return",null);case 13:return e.next=15,s.request(u,{range:{from:d.position,to:d.position+d.recordSize},responseType:"array-buffer",signal:a.signal});case 15:return m=e.sent,e.abrupt("return",m?s.decodePixelBlock(m.data,{width:s.rasterInfo.storageInfo.tileInfo.size[0],height:s.rasterInfo.storageInfo.tileInfo.size[1],planes:null,pixelType:null}):null);case 17:case"end":return e.stop()}}),i)})))()}},{key:"_validateHeader",value:function(e){return e&&"RasterInfo"===e.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some((function(t){return!e[t]}))}},{key:"_parseHeader",value:function(e){var t,r,n=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][e.pixelType],a=e.bandCount,i=e.histograms,o=e.colormap,s=e.blockWidth,l=e.blockHeight,u=e.firstPyramidLevel,c=e.maximumPyramidLevel,f=e.statistics&&e.statistics.map((function(e){return{min:e.min,max:e.max,avg:e.mean,stddev:e.standardDeviation,median:e.median,mode:e.mode}})),h=e.extent.spatialReference,y=null==(t=e.geodataXform)?void 0:t.spatialReference,v=new(0,g.default)(null!=h&&h.wkid||null!=h&&h.wkt?h:y),x=new(0,b.default)({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:v}),w=new(0,k.default)({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:v}),I=Math.round((x.xmax-x.xmin)/w.x),S=Math.round((x.ymax-x.ymin)/w.y),T=this._parseTransform(e.geodataXform),C=T?x:null;T&&(x=T.forwardTransform(x),w.x=(x.xmax-x.xmin)/I,w.y=(x.ymax-x.ymin)/S);var _,R,M,O,P=null!=(r=e.properties)?r:{},N=e.format.toLowerCase().replace("cache/",""),E=new(0,k.default)(e.origin.x,e.origin.y,v);if(o&&o.colors)for(_=[],R=0;R<o.colors.length;R++)M=o.colors[R],O=o.values?o.values[R]:R,_.push([O,255&M,M<<16>>>24,M<<8>>>24,M>>>24]);var F=e.LODInfos,D=[];for(R=0;R<F.levels.length;R++)D.push({level:F.levels[R],resolution:F.resolutions[R],scale:96/.0254*F.resolutions[R]});var B=new(0,m.default)({dpi:96,lods:D,format:N,origin:E,size:[s,l],spatialReference:v}),A={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64},J=[{maxCol:Math.ceil(I/s)-1,maxRow:Math.ceil(S/l)-1,minCol:0,minRow:0}],j=2;if(c>0)for(R=0;R<c;R++)J.push({maxCol:Math.ceil(I/j/s)-1,maxRow:Math.ceil(S/j/l)-1,minCol:0,minRow:0}),j*=2;var z=e.mdInfo;return{storageInfo:A,rasterInfo:new(0,p.default)({width:I,height:S,pixelType:n,bandCount:a,extent:x,nativeExtent:C,transform:T,spatialReference:v,pixelSize:w,keyProperties:P,statistics:f,histograms:i,multidimensionalInfo:z,colormap:_,storageInfo:new(0,d.default)({blockWidth:s,blockHeight:l,pyramidBlockWidth:s,pyramidBlockHeight:l,origin:E,tileInfo:B,firstPyramidLevel:u,maximumPyramidLevel:c,blockBoundary:J})})}}},{key:"_parseTransform",value:function(e){var t,r;if(!(0,v.isTransformSupported)(e))throw new(0,l.default)("cloudraster:open","the data contains unsupported geodata transform types");var n=(0,v.readTransform)(e);if("identity"===n.type)return null;if("polynomial"!==n.type||null==(t=n.forwardCoefficients)||!t.length||null==(r=n.inverseCoefficients)||!r.length)throw new(0,l.default)("cloudraster:open","the data contains unsupported geodata transforms - both forward and inverse coefficients are required currently");return n}},{key:"_fetchAuxiliaryInformation",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i,s,l,u,c,f;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.request(r.url+"/conf.vat.json",{signal:t}).then((function(e){return e.data})).catch((function(){return null})),i=r.request(r.url+"/conf.vat.dbf",{responseType:"array-buffer",signal:t}).then((function(e){return e.data})).catch((function(){return null})),e.next=4,Promise.all([a,i]);case 4:return(s=e.sent)[0]&&(u=s[0].fields,c=s[0].values,u&&c&&(u=u.map((function(e){return{type:"OID"===e.name?"esriFieldTypeOID":w.get(e.type),name:e.name,alias:e.alias||e.name}})),f=c.map((function(e){return{attributes:e}})),u&&c&&(l={fields:u,features:f}))),!l&&s[1]&&(l=y.default.parse(s[1]).recordSet),e.abrupt("return",x.default.fromJSON(l));case 9:case"end":return e.stop()}}),n)})))()}},{key:"_buildCacheFilePath",value:function(e,t,r,n){var a=this.storageInfo.packetSize,i=Math.floor(t/a)*a,o=Math.floor(r/a)*a,s="R"+this._toHexString4(i)+"C"+this._toHexString4(o),l="L";l+=e>=10?e.toString():"0"+e.toString();var c=this.rasterInfo.multidimensionalInfo,f=null==n?void 0:n[0];if(!(0,u.isSome)(c)||!f)return"".concat(this.url,"/_alllayers/").concat(l,"/").concat(s,".bundle");for(var p=c.variables.find((function(e){return e.name===f.variableName})).dimensions[0].values.indexOf(f.values[0]).toString(16),d=4-p.length,m=0;m<d;m++)p="0"+p;return p="S"+p,"".concat(this.url,"/_alllayers/").concat(f.variableName,"/").concat(p,"/").concat(l,"/").concat(s,".bundle")}},{key:"_getIndexRecordFromBundle",value:function(e,t){var r=this.storageInfo.packetSize,n=r*(e%r)+t%r;if(n<0)throw"Invalid level / row / col";return 20+n*this.storageInfo.recordSize+44}},{key:"_getTileEndAndContentType",value:function(e,t){var r,n=e.subarray(t,t+8),a=0;for(r=0;r<5;r++)a|=(255&n[r])<<8*r;var i=0xffffffffff&a;for(a=0,r=5;r<8;r++)a|=(255&n[r])<<8*(r-5);return{position:i,recordSize:0xffffffffff&a}}},{key:"_toHexString4",value:function(e){var t=e.toString(16);if(4!==t.length)for(var r=4-t.length;r-- >0;)t="0"+t;return t}}]),n}(h.default);(0,s._)([(0,c.property)({readOnly:!0})],I.prototype,"storageInfo",void 0),(0,s._)([(0,c.property)({type:String,json:{write:!0}})],I.prototype,"datasetFormat",void 0);var S=I=(0,s._)([(0,f.subclass)("esri.layers.support.rasterDatasets.CloudRaster")],I)})),r.register("5EhGd",(function(n,a){t(n.exports,"default",(function(){return M}));var i=r("8TSCy"),o=r("2TvXO"),s=r("7eJjO");r("2ILM8");var l=r("9pNSx"),u=r("kyj08"),c=r("1XAcN"),f=r("jHOLN"),p=r("7qybv"),d=r("hmHbS"),m=r("10vEZ"),h=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var y=r("fcwIv"),v=r("lmu5w"),x=r("gRgX5"),g=r("cQADC"),b=r("xQ42o"),k=r("4IP7o"),w=r("2G55A"),I=r("alctY"),S=r("jxAFe"),T=r("2hwKJ"),C=r("gINRd"),_=r("d1Fqh"),R=function(t){"use strict";i.inherits(n,t);var r=i.createSuper(n);function n(){var e;return i.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments)))).rasterJobHandler=null,e.datasetName=null,e.datasetFormat=null,e.rasterInfo=null,e.ioConfig={sampling:"closest"},i.possibleConstructorReturn(e)}return i.createClass(n,[{key:"init",value:function(){var t=this;return i.asyncToGenerator(e(o).mark((function r(){var n;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,S.load)(),t.addResolvingPromise(n),e.next=4,t.when();case 4:case"end":return e.stop()}}),r)})))()}},{key:"normalizeCtorArgs",value:function(e){return e&&e.ioConfig&&(e=i.objectSpread({},e,{ioConfig:i.objectSpread({resolution:null,bandIds:null,sampling:"closest",tileInfo:b.default.create()},e.ioConfig)})),e}},{key:"_isGlobalWrappableSource",get:function(){var e=this.rasterInfo,t=(0,S.getWorldWidth)(e.spatialReference);return(0,p.isSome)(t)&&e.extent.width>=t/2}},{key:"url",set:function(e){this._set("url",(0,v.sanitizeUrl)(e,f.default.getLogger(this.declaredClass)))}},{key:"open",value:function(t){return i.asyncToGenerator(e(o).mark((function t(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new(0,u.default)("BaseRaster:open-not-implemented","open() is not implemented");case 1:case"end":return e.stop()}}),t)})))()}},{key:"fetchTile",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this;return i.asyncToGenerator(e(o).mark((function i(){var l,u;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=a.tileInfo||s.rasterInfo.storageInfo.tileInfo,u=s.getTileExtentFromTileInfo(t,r,n,l),e.abrupt("return",s.fetchPixels(u,l.size[0],l.size[1],a));case 2:case"end":return e.stop()}}),i)})))()}},{key:"identify",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this;return i.asyncToGenerator(e(o).mark((function a(){var i,s,l,u,c,f,d,m,h,y,v,x,g,b,w,I,C,_,R;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n._getRequestOptionsWithSliceId(r),i=n.rasterInfo,s=i.spatialReference,l=i.extent,u=r.datumTransformation,c=(0,S.projectPoint)(t,s,u),l.intersects(c)){e.next=5;break}return e.abrupt("return",{location:c,value:null});case 5:if(!(0,p.isSome)(n.rasterInfo.transform)){e.next=10;break}if(f=n.rasterInfo.transform.inverseTransform(c),n.rasterInfo.nativeExtent.intersects(f)){e.next=9;break}return e.abrupt("return",{location:f,value:null});case 9:c=f;case 10:if(d=0,!r.srcResolution){e.next=15;break}d=(0,S.snapPyramid)(r.srcResolution,n.rasterInfo,n.ioConfig.sampling).pyramidLevel,e.next=20;break;case 15:return e.next=17,n.computeBestPyramidLevelForLocation(t,r);case 17:if(null!=(d=e.sent)){e.next=20;break}return e.abrupt("return",{location:c,value:null});case 20:if(null!==(m=n.identifyPixelLocation(c,d,null))){e.next=23;break}return e.abrupt("return",{location:c,value:null});case 23:return h=m.row,y=m.col,v=m.rowOffset,x=m.colOffset,g=(0,k.getRasterId)(n.url,r.sliceId),b="".concat(d,"/").concat(h,"/").concat(y),w=(0,k.getBlock)(g,null,b),(0,p.isNone)(w)&&(w=n.fetchRawTile(d,h,y,r),(0,k.putBlock)(g,null,b,w)),e.next=28,w;case 28:if(I=e.sent,!(0,p.isNone)(I)&&I.pixels&&0!==I.pixels.length){e.next=31;break}return e.abrupt("return",{location:c,value:null});case 31:if(C=v*n.rasterInfo.storageInfo.blockHeight+x,_=!I.mask||I.mask[C]?I.pixels.map((function(e){return e[C]})):null,"vector-magdir"!==(R=n.rasterInfo.dataType)&&"vector-uv"!==R||!((null==_?void 0:_.length)>1)){e.next=34;break}return e.abrupt("return",{location:c,value:_,magdirValue:"vector-magdir"===R?[_[0],_[1]]:(0,T.uvComponentToVector)([_[0],_[1]]),pyramidLevel:d});case 34:return e.abrupt("return",{location:c,value:_,pyramidLevel:d});case 35:case"end":return e.stop()}}),a)})))()}},{key:"fetchPixels",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this;return i.asyncToGenerator(e(o).mark((function i(){var l,u,c,f,d,m,h,y,v,x,g,b,k,w,T,_;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,S.snapExtent)(t),!(a=s._getRequestOptionsWithSliceId(a)).requestRawData){e.next=2;break}return e.abrupt("return",s._fetchPixels(t,r,n,a));case 2:if(l=(0,S.getWorldWidth)(t.spatialReference),u=(0,S.getWorldWrapCount)(t),!((0,p.isNone)(l)||0===u||1===u&&s._isGlobalWrappableSource)){e.next=5;break}return e.abrupt("return",s._fetchPixels(t,r,n,a));case 5:if(!(u>=3)){e.next=7;break}return e.abrupt("return",{extent:t,pixelBlock:null});case 7:for(c=[],f=t.xmin,d=t.xmax,m=Math.round(l/(d-f)*r),h=m-Math.round((l/2-f)/(d-f)*r),y=0,v=[],x=0;x<=u;x++)g=new(0,C.default)({xmin:0===x?f:-l/2,xmax:x===u?d-l*x:l/2,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference}),y+=b=0===x?m-h:x===u?r-y:m,v.push(b),k=a.disableWrapAround&&x>0?null:s._fetchPixels(g,b,n,a),c.push(k);return e.next=13,Promise.all(c);case 13:if(w=e.sent.map((function(e){return null==e?void 0:e.pixelBlock})),T=null,_={width:r,height:n},!s.rasterJobHandler){e.next=22;break}return e.next=19,s.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:w,srcMosaicSize:_,destDimension:null,coefs:null,sampleSpacing:null,interpolation:"nearest",alignmentInfo:null,blockWidths:v},a);case 19:T=e.sent.pixelBlock,e.next=23;break;case 22:T=(0,I.mosaic)(w,_,{blockWidths:v});case 23:return e.abrupt("return",{extent:t,srcExtent:(0,S.projectExtent)(t,s.rasterInfo.spatialReference,a.datumTransformation),pixelBlock:T});case 24:case"end":return e.stop()}}),i)})))()}},{key:"fetchRawPixels",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this;return i.asyncToGenerator(e(o).mark((function i(){var l,u,c,f,d,m,h,y,v,x,g,b,k,w,S;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={x:Math.floor(r.x),y:Math.floor(r.y)},e.next=3,s._fetchRawTiles(t,r,n,a);case 3:if(l=e.sent,u=s.rasterInfo,c=u.nativeExtent,f=u.nativePixelSize,d=u.storageInfo,m=Math.pow(2,t),h=f.x*m,y=f.y*m,v=new(0,C.default)({xmin:c.xmin+h*r.x,xmax:c.xmin+h*(r.x+n.width-1),ymin:c.ymax-y*(r.y+n.height-1),ymax:c.ymax-y*r.y,spatialReference:c.spatialReference}),l){e.next=14;break}return e.abrupt("return",{extent:v,srcExtent:v,pixelBlock:null});case 14:if(x=l.pixelBlocks,g=l.mosaicSize,1!==x.length||!(0,p.isSome)(x[0])||x[0].width!==n.width||x[0].height!==n.height){e.next=17;break}return e.abrupt("return",{extent:v,srcExtent:v,pixelBlock:l.pixelBlocks[0]});case 17:if(b=t>0?d.pyramidBlockWidth:d.blockWidth,k=t>0?d.pyramidBlockHeight:d.blockHeight,w={x:r.x%b,y:r.y%k},!s.rasterJobHandler){e.next=25;break}return e.next=22,s.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:x,srcMosaicSize:g,destDimension:n,clipOffset:w,clipSize:n,coefs:null,sampleSpacing:null,interpolation:a.interpolation,alignmentInfo:null,blockWidths:null},a);case 22:S=e.sent.pixelBlock,e.next=26;break;case 25:S=(0,I.mosaic)(x,g,{clipOffset:w,clipSize:n});case 26:return e.abrupt("return",{extent:v,srcExtent:v,pixelBlock:S});case 27:case"end":return e.stop()}}),i)})))()}},{key:"fetchRawTile",value:function(e,t,r,n){throw new(0,u.default)("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}},{key:"computeExtent",value:function(e){return(0,S.projectExtent)(this.rasterInfo.extent,e)}},{key:"decodePixelBlock",value:function(e,t){return!this.rasterJobHandler||t.useCanvas?(0,w.decode)(e,t):this.rasterJobHandler.decode({data:e,options:t})}},{key:"request",value:function(t,r,n){var a=this;return i.asyncToGenerator(e(o).mark((function s(){var u,c,f,p,d,m,h,y;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f=a.ioConfig,p=f.customFetchParameters,d=r.range,m=r.query,h=r.headers,n=null!=(u=null!=(c=n)?c:r.retryCount)?u:a.ioConfig.retryCount,y=d?{Range:"bytes=".concat(d.from,"-").concat(d.to)}:null,e.prev=4,e.next=7,(0,l.default)(t,i.objectSpread({},r,{query:i.objectSpread({},m,p),headers:i.objectSpread({},h,y)}));case 7:return e.abrupt("return",e.sent);case 10:if(e.prev=10,e.t0=e.catch(4),!(n>0)){e.next=14;break}return e.abrupt("return",(n--,a.request(t,r,n)));case 14:throw e.t0;case 15:case"end":return e.stop()}}),s,null,[[4,10]])})))()}},{key:"getSliceIndex",value:function(e){var t=this,r=function(r){var s=t,l=function(t){var r=e.find((function(e){return e.dimensionName===f[t].name}));if(null==r)return{v:null};var n=Array.isArray(r.values[0])?r.values[0][0]:r.values[0],i=s._getIndexFromDimensions(n,f[t]);if(-1===i)return{v:null};d.shift(),a+=t===m-1?i:i*d.reduce((function(e,t){return e+t}))},u=t,c=n.variables[r],f=c.dimensions;if(c.name!==o){var p=t;return a+=f.map((function(e){return p._getDimensionValuesCount(e)})).reduce((function(e,t){return e+t})),"break"}for(var d=f.map((function(e){return u._getDimensionValuesCount(e)})),m=f.length,h=0;h<m;h++){var y=l(h);if("object"===i.typeOf(y))return{v:y.v}}},n=this.rasterInfo.multidimensionalInfo;if(!(0,p.isSome)(n))return null;if(!(0,p.isSome)(e)||0===e.length)return null;for(var a=0,o=e[0].variableName,s=0;s<n.variables.length;s++){var l=r(s);if("object"===i.typeOf(l))return l.v;if("break"===l)break}return a}},{key:"getTileExtentFromTileInfo",value:function(e,t,r,n){var a=n.lodAt(e);return this.getTileExtent({x:a.resolution,y:a.resolution},t,r,n.origin,n.spatialReference,n.size)}},{key:"updateTileInfo",value:function(){var e=this.rasterInfo,t=e.storageInfo,r=e.spatialReference,n=e.extent,a=e.pixelSize;if(!t.tileInfo){for(var i=[],o=t.maximumPyramidLevel||0,s=Math.max(a.x,a.y),l=1/.0254*96*s,u=0;u<=o;u++)i.push({level:o-u,resolution:s,scale:l}),s*=2,l*=2;var c=new(0,_.default)({x:n.xmin,y:n.ymax,spatialReference:r});t.tileInfo=new(0,b.default)({origin:c,size:[t.blockWidth,t.blockHeight],spatialReference:r,lods:i}),t.isVirtualTileInfo=!0}}},{key:"createRemoteDatasetStorageInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,n=arguments.length>3?arguments[3]:void 0,a=e.width,i=e.height,o=e.nativeExtent,s=e.pixelSize,l=e.spatialReference,u=new(0,_.default)({x:o.xmin,y:o.ymax,spatialReference:l});null==n&&(n=Math.max(0,Math.round(Math.log(Math.max(a,i))/Math.LN2-8)));var c=this.computeBlockBoundary(o,512,512,{x:o.xmin,y:o.ymax},[s],n);e.storageInfo=new(0,g.default)({blockWidth:t,blockHeight:r,pyramidBlockWidth:t,pyramidBlockHeight:r,origin:u,firstPyramidLevel:1,maximumPyramidLevel:n,blockBoundary:c})}},{key:"computeBestPyramidLevelForLocation",value:function(t){return i.asyncToGenerator(e(o).mark((function t(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",0);case 1:case"end":return e.stop()}}),t)})))()}},{key:"computeBlockBoundary",value:function(e,t,r,n,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2;if(1===a.length&&o>0)for(var l=(a=i.toConsumableArray(a))[0],u=l.x,c=l.y,f=0;f<o;f++)u*=s,c*=s,a.push({x:u,y:c});for(var p=[],d=n.x,m=n.y,h=0;h<a.length;h++){var y=a[h],v=y.x,x=y.y;p.push({minCol:Math.floor((e.xmin-d+.1*v)/t/v),maxCol:Math.floor((e.xmax-d-.1*v)/t/v),minRow:Math.floor((m-e.ymax+.1*x)/r/x),maxRow:Math.floor((m-e.ymin-.1*x)/r/x)})}return p}},{key:"getPyramidPixelSize",value:function(e){var t=this.rasterInfo.nativePixelSize,r=this.rasterInfo.storageInfo,n=r.pyramidResolutions,a=r.pyramidScalingFactor;if(0===e)return t;if((0,p.isSome)(n)&&n.length)return n[e-1];var i=Math.pow(a,e);return{x:t.x*i,y:t.y*i}}},{key:"identifyPixelLocation",value:function(e,t,r){var n=this.rasterInfo,a=n.spatialReference,i=n.nativeExtent,o=this.rasterInfo.storageInfo,s=o.blockWidth,l=o.blockHeight,u=o.maximumPyramidLevel,c=o.origin,f=(0,S.projectPoint)(e,a,r);if(!i.intersects(f))return null;if(t<0||t>u)return null;var p=this.getPyramidPixelSize(t),d=p.x,m=p.y,h=(c.y-f.y)/m/l,y=(f.x-c.x)/d/s,v=Math.min(l-1,Math.floor((h-Math.floor(h))*l)),x=Math.min(s-1,Math.floor((y-Math.floor(y))*s));return{pyramidLevel:t,row:Math.floor(h),col:Math.floor(y),rowOffset:v,colOffset:x,srcLocation:f}}},{key:"getTileExtent",value:function(e,t,r,n,a,o){var s=i.slicedToArray(o,2),l=s[0],u=s[1],c=n.x+r*l*e.x,f=c+l*e.x,p=n.y-t*u*e.y,d=p-u*e.y;return new(0,C.default)({xmin:c,xmax:f,ymin:d,ymax:p,spatialReference:a})}},{key:"getBlockWidthHeight",value:function(e){return{blockWidth:e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,blockHeight:e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight}}},{key:"isBlockOutside",value:function(e,t,r){var n=this.rasterInfo.storageInfo.blockBoundary[e];return!n||n.maxRow<t||n.maxCol<r||n.minRow>t||n.minCol>r}},{key:"_fetchPixels",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this;return i.asyncToGenerator(e(o).mark((function i(){var l,u,c,f,d,m,h,y,v,x,g,b,k,w,C,R,M,O,P,N,E,F,D,B,A,J,j,z,H,L,W,G,V,q;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((l=(0,S.getWorldWrapCount)(t))>=2)){e.next=3;break}return e.abrupt("return",{extent:t,pixelBlock:null});case 3:if(u=s._getSourceDataInfo(t,r,n,a),c=u.pyramidLevel,f=u.pyramidResolution,d=u.srcResolution,m=u.srcExtent,h=u.srcWidth,y=u.srcHeight,0!==h&&0!==y){e.next=6;break}return e.abrupt("return",{extent:t,srcExtent:m,pixelBlock:null});case 6:return v=(0,p.unwrap)(s.rasterInfo.transform),x="gcs-shift"===(null==v?void 0:v.type),g=(0,p.isSome)((0,S.getWorldWidth)(t.spatialReference)),!x&&g||(l=(0,S.getWorldWrapCount)(u.srcExtent,x)),b=s.rasterInfo.storageInfo,k={x:Math.floor((m.xmin-b.origin.x)/f.x+.1),y:Math.floor((b.origin.y-m.ymax)/f.y+.1)},e.next=12,s._fetchRawTiles(c,k,{width:h,height:y,wrapCount:l},a);case 12:if(w=e.sent){e.next=15;break}return e.abrupt("return",{extent:t,srcExtent:m,pixelBlock:null});case 15:if(C=c>0?b.pyramidBlockWidth:b.blockWidth,R=c>0?b.pyramidBlockHeight:b.blockHeight,M=C===h&&R===y&&k.x%C==0&&k.y%R==0,O=new(0,_.default)({x:(t.xmax-t.xmin)/r,y:(t.ymax-t.ymin)/n,spatialReference:t.spatialReference}),P=!t.spatialReference.equals(s.rasterInfo.spatialReference),N=a.datumTransformation,P||!M||1!==w.pixelBlocks.length||C!==r||R!==n||d.x!==O.x||d.y!==O.y){e.next=18;break}return e.abrupt("return",{extent:t,srcExtent:m,pixelBlock:w.pixelBlocks[0]});case 18:if(E=g&&(0,p.isSome)((0,S.getWorldWidth)(m.spatialReference)),F=a.requestProjectedLocalDirections&&s.rasterInfo.dataType.startsWith("vector"),e.t0=F&&!s.rasterJobHandler,!e.t0){e.next=23;break}return e.next=23,(0,S.load)();case 23:if(!s.rasterJobHandler){e.next=29;break}return e.next=26,s.rasterJobHandler.getProjectionOffsetGrid({projectedExtent:t,srcBufferExtent:w.extent,pixelSize:O.toJSON(),datumTransformation:N,rasterTransform:v,hasWrapAround:l>0||E,isAdaptive:!1!==s.ioConfig.optimizeProjectionAccuracy,includeGCSGrid:F},a);case 26:e.t1=e.sent,e.next=30;break;case 29:e.t1=(0,S.getProjectionOffsetGrid)({projectedExtent:t,srcBufferExtent:w.extent,pixelSize:O,datumTransformation:N,rasterTransform:v,hasWrapAround:l>0||E,isAdaptive:!1,includeGCSGrid:F});case 30:if(D=e.t1,A=!a.requestRawData,J={rows:D.spacing[0],cols:D.spacing[1]},j=(0,p.unwrap)(s._getRasterTileAlignmentInfo(c,w.extent.xmin)),z=w.pixelBlocks,H=w.mosaicSize,L=w.isPartiallyFilled,W=null,!s.rasterJobHandler){e.next=42;break}return e.next=37,s.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:z,srcMosaicSize:H,destDimension:A?{width:r,height:n}:null,coefs:A?D.coefficients:null,sampleSpacing:A?J:null,projectDirections:F,gcsGrid:F?D.gcsGrid:null,isUV:"vector-uv"===s.rasterInfo.dataType,interpolation:a.interpolation,alignmentInfo:j,blockWidths:null},a);case 37:G=e.sent,B=(V=G).pixelBlock,W=V.localNorthDirections,e.next=43;break;case 42:q=(0,I.mosaic)(z,H,{alignmentInfo:j}),B=A?(0,I.approximateTransform)(q,{width:r,height:n},D.coefficients,J,a.interpolation):q,F&&D.gcsGrid&&(W=(0,I.getLocalArithmeticNorthRotations)({width:r,height:n},D.gcsGrid),B=(0,T.convertToLocalDirections)(B,s.rasterInfo.dataType,W));case 43:return e.abrupt("return",a.requestRawData||F?{srcExtent:m,pixelBlock:B,transformGrid:D,localNorthDirections:W,extent:t,isPartiallyFilled:L}:{srcExtent:m,extent:t,pixelBlock:B});case 44:case"end":return e.stop()}}),i)})))()}},{key:"_fetchRawTiles",value:function(t,r,n,a){var s=this;return i.asyncToGenerator(e(o).mark((function i(){var l,u,c,f,d,m,h,y,v,x,g,b,k,w,I,S,T,_,R,M,O,P,N,E,F,D,B,A,J,j,z,H,L,W,G,V,q,U,X;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=s.rasterInfo.storageInfo,u=l.origin,c=l.blockBoundary,f=s.getBlockWidthHeight(t),d=f.blockWidth,m=f.blockHeight,h=r.x,y=r.y,v=n.width,x=n.height,g=n.wrapCount,b=s._getRasterTileAlignmentInfo(t,0),a.buffer&&(h-=a.buffer.cols,y-=a.buffer.rows,v+=2*a.buffer.cols,x+=2*a.buffer.rows),k=0,w=0,I=0,g&&(0,p.isSome)(b)&&(w=(S=b).worldColumnCountFromOrigin,I=S.originColumnOffset,k=S.rightPadding,w*b.blockWidth-k>=h+v&&(k=0)),T=Math.floor(h/d),_=Math.floor(y/m),R=Math.floor((h+v+k-1)/d),M=Math.floor((y+x+k-1)/m),O=c[t]){e.next=9;break}return e.abrupt("return",null);case 9:if(P=O.minRow,N=O.minCol,E=O.maxCol,F=O.maxRow,0!==g||!(M<P||R<N||_>F||T>E)){e.next=12;break}return e.abrupt("return",null);case 12:for(D=new Array,B=!1,A=null==s.ioConfig.allowPartialFill?a.allowPartialFill:s.ioConfig.allowPartialFill,J=_;J<=M;J++)for(j=T;j<=R;j++)z=j,!a.disableWrapAround&&g&&(0,p.isSome)(b)&&w<=j&&(z=j-w-I),J>=P&&z>=N&&F>=J&&E>=z?(H=s._fetchRawTile(t,J,z,a),A?D.push(new Promise((function(e){H.then((function(t){return e(t)})).catch((function(){B=!0,e(null)}))}))):D.push(H)):D.push(null);if(0!==D.length){e.next=18;break}return e.abrupt("return",null);case 18:return e.next=20,Promise.all(D);case 20:return L=e.sent,W={height:(M-_+1)*m,width:(R-T+1)*d},G=s.rasterInfo,V=G.spatialReference,q=s.getPyramidPixelSize(t),U=q.x,X=q.y,e.abrupt("return",{extent:new(0,C.default)({xmin:u.x+T*d*U,xmax:u.x+(R+1)*d*U,ymin:u.y-(M+1)*m*X,ymax:u.y-_*m*X,spatialReference:V}),pixelBlocks:L,mosaicSize:W,isPartiallyFilled:B});case 28:case"end":return e.stop()}}),i)})))()}},{key:"_fetchRawTile",value:function(e,t,r,n){var a=this.rasterInfo.storageInfo.blockBoundary[e];if(!a)return Promise.resolve(null);var o=a.minRow,s=a.minCol,l=a.maxCol,u=a.maxRow;if(t<o||r<s||t>u||r>l)return Promise.resolve(null);var c=(0,k.getRasterId)(this.url,n.sliceId),f="".concat(e,"/").concat(t,"/").concat(r),d=(0,k.getBlock)(c,n.registryId,f);if((0,p.isNone)(d)){var h=new AbortController;d=this.fetchRawTile(e,t,r,i.objectSpread({},n,{signal:h.signal})),(0,k.putBlock)(c,n.registryId,f,d,h),d.catch((function(){return(0,k.deleteBlock)(c,n.registryId,f)}))}return n.signal&&(0,m.onAbort)(n,(function(){(0,k.decreaseRefCount)(c,n.registryId,f)})),d}},{key:"_getIndexFromDimensions",value:function(e,t){var r=t.extent,n=t.interval,a=t.unit,i=t.values;if(null!=i&&i.length)return Array.isArray(i[0])?i.findIndex((function(t){return t[0]<=e&&t[1]>=e})):i.indexOf(e);if(e>r[1])return-1;var o=r[0],s=-1;if("ISO8601"===a){var l;switch((null==(l=t.intervalUnit)?void 0:l.toLowerCase())||"seconds"){case"seconds":s=Math.round((e-o)/1e3/n);break;case"minutes":s=Math.round((e-o)/6e4/n);break;case"hours":s=Math.round((e-o)/36e5/n);break;case"days":s=Math.round((e-o)/864e5/n);break;case"years":s=Math.round((new Date(e).getUTCFullYear()-new Date(o).getUTCFullYear())/n);break;case"decades":s=Math.round((new Date(e).getUTCFullYear()-new Date(o).getUTCFullYear())/10/n)}return s}return Math.round((e-o)/n)}},{key:"_getDimensionValuesCount",value:function(e){var t=e.extent,r=e.interval,n=e.unit,a=e.values,i=(null==a?void 0:a.length)||0;if(i)return i;var o=t[0];if(0===i&&"ISO8601"===n){var s;switch((null==(s=e.intervalUnit)?void 0:s.toLowerCase())||"seconds"){case"seconds":i=Math.round((t[1]-t[0])/1e3/r);break;case"minutes":i=Math.round((t[1]-t[0])/6e4/r);break;case"hours":i=Math.round((t[1]-t[0])/36e5/r);break;case"days":i=Math.round((t[1]-t[0])/864e5/r);break;case"years":i=Math.round((new Date(t[1]).getUTCFullYear()-new Date(o).getUTCFullYear())/r);break;case"decades":i=Math.round((new Date(t[1]).getUTCFullYear()-new Date(o).getUTCFullYear())/10/r)}return i}return Math.round((t[1]-t[0])/r)}},{key:"_getRasterTileAlignmentInfo",value:function(e,t){return null==this._rasterTileAlighmentInfo&&(this._rasterTileAlighmentInfo=(0,S.getRasterDatasetAlignmentInfo)(this.rasterInfo)),(0,p.isSome)(this._rasterTileAlighmentInfo.pyramidsInfo)?i.objectSpread({startX:t,halfWorldWidth:this._rasterTileAlighmentInfo.halfWorldWidth,hasGCSSShiftTransform:this._rasterTileAlighmentInfo.hasGCSSShiftTransform},this._rasterTileAlighmentInfo.pyramidsInfo[e]):null}},{key:"_getSourceDataInfo",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a={datumTransformation:n.datumTransformation,pyramidLevel:0,pyramidResolution:null,srcExtent:null,srcHeight:0,srcResolution:null,srcWidth:0};n.srcResolution&&(a.srcResolution=n.srcResolution,this._updateSourceDataInfo(e,a));var i=this.rasterInfo.storageInfo.maximumPyramidLevel||0,o=a.srcWidth,s=a.srcHeight,l=a.pyramidLevel,u=o/t,c=s/r,f=l<i&&u*c>=16;if(f||l===i&&(u>8||c>8)||0===o||0===s){var p=new(0,_.default)({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/r,spatialReference:e.spatialReference}),d=(0,S.projectResolution)(p,this.rasterInfo.spatialReference,e,a.datumTransformation),m=!d||n.srcResolution&&d.x+d.y<n.srcResolution.x+n.srcResolution.y;if(f&&n.srcResolution&&m){var h=Math.round(Math.log(Math.max(u,c))/Math.LN2)-1;if(i-l+3>=h){var y=Math.pow(2,h);d={x:n.srcResolution.x*y,y:n.srcResolution.y*y}}}d&&(a.srcResolution=d,this._updateSourceDataInfo(e,a))}return(a.srcWidth/t>8||a.srcHeight/r>8)&&(a.srcWidth=0,a.srcHeight=0),a}},{key:"_updateSourceDataInfo",value:function(e,t){t.srcWidth=0,t.srcHeight=0;var r=this.rasterInfo.spatialReference,n=t.srcResolution,a=t.datumTransformation,i=(0,S.snapPyramid)(n,this.rasterInfo,this.ioConfig.sampling),o=i.pyramidLevel,s=i.pyramidResolution;if(!i.excessiveReading){var l=t.srcExtent||(0,S.projectExtent)(e,r,a);if(null!=l){var u=(0,p.unwrap)(this.rasterInfo.transform);u&&(l=u.inverseTransform(l)),t.srcExtent=l;var c=Math.ceil((l.xmax-l.xmin)/s.x-.1),f=Math.ceil((l.ymax-l.ymin)/s.y-.1);t.pyramidLevel=o,t.pyramidResolution=s,t.srcWidth=c,t.srcHeight=f}}}},{key:"_getRequestOptionsWithSliceId",value:function(e){return(0,p.isSome)(this.rasterInfo.multidimensionalInfo)&&null==e.sliceId&&(e=i.objectSpread({},e,{sliceId:this.getSliceIndex(e.multidimensionalDefinition)})),e}}]),n}((0,d.EsriPromiseMixin)(c.JSONSupport));(0,s._)([(0,h.property)()],R.prototype,"_rasterTileAlighmentInfo",void 0),(0,s._)([(0,h.property)({readOnly:!0})],R.prototype,"_isGlobalWrappableSource",null),(0,s._)([(0,h.property)(x.url)],R.prototype,"url",null),(0,s._)([(0,h.property)({type:String,json:{write:!0}})],R.prototype,"datasetName",void 0),(0,s._)([(0,h.property)({type:String,json:{write:!0}})],R.prototype,"datasetFormat",void 0),(0,s._)([(0,h.property)()],R.prototype,"rasterInfo",void 0),(0,s._)([(0,h.property)()],R.prototype,"ioConfig",void 0),(0,s._)([(0,h.property)()],R.prototype,"sourceJSON",void 0);var M=R=(0,s._)([(0,y.subclass)("esri.layers.support.rasterDatasets.BaseRaster")],R)})),r.register("4IP7o",(function(e,n){t(e.exports,"getRasterId",(function(){return c})),t(e.exports,"register",(function(){return f})),t(e.exports,"unregister",(function(){return p})),t(e.exports,"decreaseRefCount",(function(){return d})),t(e.exports,"getBlock",(function(){return m})),t(e.exports,"putBlock",(function(){return h})),t(e.exports,"deleteBlock",(function(){return y})),t(e.exports,"update",(function(){return x})),r("2ILM8");var a=r("7qybv"),i=r("kynKe"),o=r("jxAFe"),s=r("d1Fqh"),l=new Map,u=new(0,i.default);function c(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function f(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(l.has(e)){var n=l.get(e);return n.push(r),n.length-1}return l.set(e,[r]),0}function p(e,t){if(l.has(e)){var r=l.get(e);r[t]=null,r.some((function(e){return null!=e}))||l.delete(e)}}function d(e,t,r){if(!l.has(e))return null==t?u.decreaseRefCount(e,r):0;var n=l.get(e);if(null==n[t])return u.decreaseRefCount(e,r);var a=n[t].cache;if(a.has(r)){var i=a.get(r);if(i.refCount--,0===i.refCount){a.delete(r);for(var o=0;o<n.length;o++)n[o]&&n[o].cache.has(r)&&n[o].cache.delete(r);i.controller&&i.controller.abort()}return i.refCount}return 0}function m(e,t,r){if(!l.has(e))return null==t?u.getBlock(e,r):null;var n=l.get(e);if(null==n[t]){for(var a=0;a<n.length;a++)if(n[a]&&n[a].cache.has(r)){var i=n[a].cache.get(r);return i.refCount++,i.block}return u.getBlock(e,r)}var o=n[t].cache;if(o.has(r)){var s=o.get(r);return s.refCount++,s.block}for(var c=0;c<n.length;c++)if(c!==t&&n[c]&&n[c]&&n[c].cache.has(r)){var f=n[c].cache.get(r);return f.refCount++,o.set(r,f),f.block}return null}function h(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(l.has(e)){var i=l.get(e);if(null!=i[t]){var o={refCount:1,block:n,isResolved:!1,isRejected:!1,controller:a};n.then((function(){return o.isResolved=!0})).catch((function(){return o.isRejected=!0})),i[t].cache.set(r,o)}else u.putBlock(e,r,n,a)}else null==t&&u.putBlock(e,r,n,a)}function y(e,t,r){if(l.has(e)){var n=l.get(e);null!=n[t]?n[t].cache.delete(r):u.deleteBlock(e,r)}else null==t&&u.deleteBlock(e,r)}function v(e,t){if(!l.has(e))return null;var r=l.get(e);return null==r[t]?null:r[t]}function x(e,t,r,n,i,l){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=v(e,t),f=c.extent,p=c.cache,d=c.rasterInfo;if(!f||f.xmin!==r.xmin||f.xmax!==r.xmax||f.ymin!==r.ymin||f.ymax!==r.ymax){for(var m=r.clone().normalize(),h=d.spatialReference,y=d.transform,x=new Set,g=0;g<m.length;g++){var b=m[g];if(!(b.xmax-b.xmin<=n||b.ymax-b.ymin<=n)){var k=(0,o.projectExtent)(b,h,u);(0,a.isSome)(y)&&(k=y.inverseTransform(k));var w=new(0,s.default)({x:n,y:n,spatialReference:b.spatialReference});if(null==i&&!(i=(0,o.projectResolution)(w,h,b,u)))return;var I=(0,o.snapPyramid)(i,d,l||"closest"),S=I.pyramidLevel,T=I.pyramidResolution,C=I.excessiveReading;if(C)return;for(var _=d.storageInfo,R=_.origin,M={x:Math.max(0,Math.floor((k.xmin-R.x)/T.x)),y:Math.max(0,Math.floor((R.y-k.ymax)/T.y))},O=Math.ceil((k.xmax-k.xmin)/T.x-.1),P=Math.ceil((k.ymax-k.ymin)/T.y-.1),N=S>0?_.pyramidBlockWidth:_.blockWidth,E=S>0?_.pyramidBlockHeight:_.blockHeight,F=1,D=Math.max(0,Math.floor(M.x/N)-F),B=Math.max(0,Math.floor(M.y/E)-F),A=Math.floor((M.x+O-1)/N)+F,J=Math.floor((M.y+P-1)/E)+F,j=B;j<=J;j++)for(var z=D;z<=A;z++)x.add("".concat(S,"/").concat(j,"/").concat(z))}}p.forEach((function(e,t){if(!x.has(t)){var r=p.get(t);(null==r||r.isResolved||r.isRejected)&&p.delete(t)}})),c.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}}})),r.register("kynKe",(function(e,n){t(e.exports,"default",(function(){return i}));var a=r("8TSCy"),i=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;a.classCallCheck(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,r)}return a.createClass(e,[{key:"decreaseRefCount",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var a=n.get(r);return a.refCount--,a.refCount<=0&&(n.delete(r),a.controller&&a.controller.abort()),a.refCount}return 0}},{key:"getBlock",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var a=n.get(r);return a.ts=Date.now(),a.refCount++,n.delete(r),n.set(r,a),a.block}return null}},{key:"putBlock",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=this._cachedBlocks,i=e+"/"+t;if(a.has(i)){var o=a.get(i);o.ts=Date.now(),o.refCount++}else a.set(i,{block:r,ts:Date.now(),refCount:1,controller:n});this._trim(),this._updateTimer()}},{key:"deleteBlock",value:function(e,t){var r=this._cachedBlocks,n=e+"/"+t;r.has(n)&&r.delete(n)}},{key:"updateMaxSize",value:function(e){this._size=e,this._trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this._clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"_updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var r=Array.from(t),n=Date.now(),a=0;a<r.length&&r[a][1].ts<=n-e._duration;a++)t.delete(r[a][0]);0===t.size&&e._clearTimer()}),this._interval)}}},{key:"_trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),r=0;r<t.length-this._size;r++)e.delete(t[r][0])}},{key:"_clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}()})),r.register("0fPji",(function(e,n){t(e.exports,"default",(function(){return s}));var a=r("8TSCy"),i=r("bN8ex");function o(e){var t=e.fields,r=e.records,n=t.some((function(e){return"oid"===e.name.toLowerCase()}))?"OBJECTID":"OID",a=[{name:n,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((function(e){return{name:e.name,type:"esriFieldType"+e.typeName,alias:e.name}}))),i=a.map((function(e){return e.name})),o=[],s=0,l=0;return r.forEach((function(e){var t={};for(t[n]=s++,l=1;l<i.length;l++)t[i[l]]=e[l-1];o.push({attributes:t})})),{displayFieldName:"",fields:a,features:o}}var s=function(){"use strict";function e(){a.classCallCheck(this,e)}return a.createClass(e,null,[{key:"supportedVersions",get:function(){return[5]}},{key:"parse",value:function(e){var t=new DataView(e),r=3&t.getUint8(0);if(3!==r)return{header:{version:r},recordSet:null};var n,a=t.getUint32(4,!0),s=t.getUint16(8,!0),l=t.getUint16(10,!0),u={version:r,recordCount:a,headerByteCount:s,recordByteCount:l},c=32,f=[],p=[];if(3===r){for(;13!==t.getUint8(c);)n=String.fromCharCode(t.getUint8(c+11)).trim(),f.push({name:(0,i.bytesToUTF8)(new Uint8Array(e,c,11)),type:n,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(n)],length:t.getUint8(c+16)}),c+=32;if(c+=1,f.length>0)for(;p.length<a&&e.byteLength-c>l;){var d=[];32===t.getUint8(c)?(c+=1,f.forEach((function(t){if("C"===t.type)d.push((0,i.bytesToUTF8)(new Uint8Array(e,c,t.length)).trim());else if("N"===t.type)d.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,c,t.length)).trim(),10));else if("F"===t.type)d.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,c,t.length)).trim()));else if("D"===t.type){var r=String.fromCharCode.apply(null,new Uint8Array(e,c,t.length)).trim();d.push(new Date(parseInt(r.substring(0,4),10),parseInt(r.substring(4,6),10)-1,parseInt(r.substring(6,8),10)))}c+=t.length})),p.push(d)):c+=l}}return{header:u,fields:f,records:p,recordSet:o({fields:f,records:p})}}}]),e}()})),r.register("gzPy2",(function(e,n){t(e.exports,"isTransformSupported",(function(){return u})),t(e.exports,"readTransform",(function(){return c}));var a=r("h5QJK"),i=r("87TLR"),o=r("kSbmb"),s={GCSShiftXform:a.default,IdentityXform:i.default,PolynomialXform:o.default},l=Object.keys(s);function u(e){var t=null==e?void 0:e.type;return!e||l.includes(t)}function c(e){if(!(null==e?void 0:e.type))return null;var t=s[null==e?void 0:e.type];if(t){var r=new t;return r.read(e),r}return null}})),r.register("h5QJK",(function(e,n){t(e.exports,"default",(function(){return c}));var a=r("8TSCy"),i=r("7eJjO"),o=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var s=r("bSafx"),l=r("fcwIv"),u=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){var e;return a.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))).type="gcs-shift",e.tolerance=1e-8,a.possibleConstructorReturn(e)}return a.createClass(r,[{key:"forwardTransform",value:function(e){return"point"===(e=e.clone()).type?(e.x>180+this.tolerance&&(e.x-=360),e):(e.xmin>=180-this.tolerance?(e.xmax-=360,e.xmin-=360):e.xmax>180+this.tolerance&&(e.xmin=-180,e.xmax=180),e)}},{key:"inverseTransform",value:function(e){return"point"===(e=e.clone()).type?(e.x<-this.tolerance&&(e.x+=360),e):(e.xmin<-this.tolerance&&(e.xmin+=360,e.xmax+=360),e)}}]),r}(r("gD7nb").default);(0,i._)([(0,s.enumeration)({GCSShiftXform:"gcs-shift"})],u.prototype,"type",void 0),(0,i._)([(0,o.property)()],u.prototype,"tolerance",void 0);var c=u=(0,i._)([(0,l.subclass)("esri.layers.support.rasterTransforms.GCSShiftTransform")],u)})),r.register("gD7nb",(function(e,n){t(e.exports,"default",(function(){return c}));var a=r("8TSCy"),i=r("7eJjO"),o=r("1XAcN"),s=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var l=r("fcwIv"),u=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){return a.classCallCheck(this,r),t.apply(this,arguments)}return a.createClass(r,[{key:"affectsPixelSize",get:function(){return!1}},{key:"forwardTransform",value:function(e){return e}},{key:"inverseTransform",value:function(e){return e}}]),r}(o.JSONSupport);(0,i._)([(0,s.property)()],u.prototype,"affectsPixelSize",null),(0,i._)([(0,s.property)({json:{write:!0}})],u.prototype,"spatialReference",void 0);var c=u=(0,i._)([(0,l.subclass)("esri.layers.support.rasterTransforms.BaseRasterTransform")],u)})),r.register("87TLR",(function(e,n){t(e.exports,"default",(function(){return u}));var a=r("8TSCy"),i=r("7eJjO");r("jHOLN"),r("iJAIC"),r("lNwWH"),r("2VlWd"),r("62edV");var o=r("bSafx"),s=r("fcwIv"),l=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){var e;return a.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))).type="identity",a.possibleConstructorReturn(e)}return r}(r("gD7nb").default);(0,i._)([(0,o.enumeration)({IdentityXform:"identity"})],l.prototype,"type",void 0);var u=l=(0,i._)([(0,s.subclass)("esri.layers.support.rasterTransforms.IdentityTransform")],l)})),r.register("kSbmb",(function(e,n){t(e.exports,"default",(function(){return v}));var a=r("8TSCy"),i=r("7eJjO");r("2ILM8");var o=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var s=r("bSafx"),l=r("eB8sj"),u=r("fcwIv"),c=r("kced1"),f=r("gD7nb"),p=r("d1Fqh"),d=r("gINRd");function m(e,t,r){var n=t.x,a=t.y;if(r<2)return{x:e[0]+n*e[2]+a*e[4],y:e[1]+n*e[3]+a*e[5]};if(2===r){var i=n*n,o=a*a,s=n*a;return{x:e[0]+n*e[2]+a*e[4]+i*e[6]+s*e[8]+o*e[10],y:e[1]+n*e[3]+a*e[5]+i*e[7]+s*e[9]+o*e[11]}}var l=n*n,u=a*a,c=n*a,f=l*n,p=l*a,d=n*u,m=a*u;return{x:e[0]+n*e[2]+a*e[4]+l*e[6]+c*e[8]+u*e[10]+f*e[12]+p*e[14]+d*e[16]+m*e[18],y:e[1]+n*e[3]+a*e[5]+l*e[7]+c*e[9]+u*e[11]+f*e[13]+p*e[15]+d*e[17]+m*e[19]}}function h(e,t,r){var n=t.xmin,a=t.ymin,i=t.xmax,o=t.ymax,s=t.spatialReference,l=[];if(r<2)l.push({x:n,y:o}),l.push({x:i,y:o}),l.push({x:n,y:a}),l.push({x:i,y:a});else{for(var u=10,c=0;c<u;c++)l.push({x:n,y:a+(o-a)*c/(u-1)}),l.push({x:i,y:a+(o-a)*c/(u-1)});u=8;for(var f=1;f<=u;f++)l.push({x:n+(i-n)*f/u,y:a}),l.push({x:n+(i-n)*f/u,y:o})}var p=(l=l.map((function(t){return m(e,t,r)}))).map((function(e){return e.x})),h=l.map((function(e){return e.y}));return new(0,d.default)({xmin:Math.min.apply(null,p),xmax:Math.max.apply(null,p),ymin:Math.min.apply(null,h),ymax:Math.max.apply(null,h),spatialReference:s})}var y=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){var e;return a.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))).polynomialOrder=1,e.type="polynomial",a.possibleConstructorReturn(e)}return a.createClass(r,[{key:"readForwardCoefficients",value:function(e,t){var r=t.coeffX,n=t.coeffY;if(null==r||!r.length||null==n||!n.length||r.length!==n.length)return null;for(var a=[],i=0;i<r.length;i++)a.push(r[i]),a.push(n[i]);return a}},{key:"writeForwardCoefficients",value:function(e,t,r){for(var n=[],a=[],i=0;i<(null==e?void 0:e.length);i++)i%2==0?n.push(e[i]):a.push(e[i]);t.coeffX=n,t.coeffY=a}},{key:"inverseCoefficients",get:function(){var e=this._get("inverseCoefficients"),t=this._get("forwardCoefficients");return!e&&t&&this.polynomialOrder<2&&(e=function(e){var t=a.slicedToArray(e,6),r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],l=t[5],u=i*l-s*o,c=s*o-i*l;return[(s*n-r*l)/u,(i*n-r*o)/c,l/u,o/c,-s/u,-i/c]}(t)),e},set:function(e){this._set("inverseCoefficients",e)}},{key:"readInverseCoefficients",value:function(e,t){var r=t.inverseCoeffX,n=t.inverseCoeffY;if(null==r||!r.length||null==n||!n.length||r.length!==n.length)return null;for(var a=[],i=0;i<r.length;i++)a.push(r[i]),a.push(n[i]);return a}},{key:"writeInverseCoefficients",value:function(e,t,r){for(var n=[],a=[],i=0;i<(null==e?void 0:e.length);i++)i%2==0?n.push(e[i]):a.push(e[i]);t.inverseCoeffX=n,t.inverseCoeffY=a}},{key:"affectsPixelSize",get:function(){return this.polynomialOrder>0}},{key:"forwardTransform",value:function(e){if("point"===e.type){var t=m(this.forwardCoefficients,e,this.polynomialOrder);return new(0,p.default)({x:t.x,y:t.y,spatialReference:e.spatialReference})}return h(this.forwardCoefficients,e,this.polynomialOrder)}},{key:"inverseTransform",value:function(e){if("point"===e.type){var t=m(this.inverseCoefficients,e,this.polynomialOrder);return new(0,p.default)({x:t.x,y:t.y,spatialReference:e.spatialReference})}return h(this.inverseCoefficients,e,this.polynomialOrder)}}]),r}(f.default);(0,i._)([(0,o.property)({json:{write:!0}})],y.prototype,"polynomialOrder",void 0),(0,i._)([(0,o.property)()],y.prototype,"forwardCoefficients",void 0),(0,i._)([(0,l.reader)("forwardCoefficients",["coeffX","coeffY"])],y.prototype,"readForwardCoefficients",null),(0,i._)([(0,c.writer)("forwardCoefficients")],y.prototype,"writeForwardCoefficients",null),(0,i._)([(0,o.property)({json:{write:!0}})],y.prototype,"inverseCoefficients",null),(0,i._)([(0,l.reader)("inverseCoefficients",["inverseCoeffX","inverseCoeffY"])],y.prototype,"readInverseCoefficients",null),(0,i._)([(0,c.writer)("inverseCoefficients")],y.prototype,"writeInverseCoefficients",null),(0,i._)([(0,o.property)()],y.prototype,"affectsPixelSize",null),(0,i._)([(0,s.enumeration)({PolynomialXform:"polynomial"})],y.prototype,"type",void 0);var v=y=(0,i._)([(0,u.subclass)("esri.layers.support.rasterTransforms.PolynomialTransform")],y)})),r.register("5K49h",(function(n,a){t(n.exports,"default",(function(){return w}));var i=r("8TSCy"),o=r("2TvXO"),s=r("7eJjO");r("2ILM8");var l=r("kyj08"),u=r("7qybv"),c=r("10vEZ"),f=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var p=r("fcwIv"),d=r("5EhGd"),m=r("7pJ9D"),h=r("iIUME"),y=r("2G55A"),v=r("alctY"),x=r("kSbmb"),g=r("j40xv"),b=r("gINRd"),k=function(t){"use strict";i.inherits(n,t);var r=i.createSuper(n);function n(){return i.classCallCheck(this,n),r.apply(this,arguments)}return i.createClass(n,[{key:"open",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i,s,l,u,c,f,p,d,h,y,x,k;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.init();case 2:return e.next=4,r._fetchData(t);case 4:return a=e.sent,e.next=7,r._fetchAuxiliaryData(t);case 7:return i=e.sent,s=i.spatialReference,l=i.statistics,u=i.histograms,c=i.transform,(f=!s)&&(s=new(0,g.default)({wkid:3857})),null!=u&&u.length&&null==l&&(l=(0,v.estimateStatisticsFromHistograms)(u)),p=a.width,d=a.height,h=new(0,b.default)({xmin:-.5,ymin:.5-d,xmax:p-.5,ymax:.5,spatialReference:s}),y=c?c.forwardTransform(h):h,!0,c&&(x=c.forwardCoefficients,x&&0===x[1]&&0===x[2]&&(c=null,h=y)),k=new(0,m.default)({data:{extent:y,nativeExtent:h,transform:c,pixelBlock:a,statistics:l,histograms:u,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:f}}),e.next=22,k.open();case 22:r._set("rasterInfo",k.rasterInfo),r._inMemoryRaster=k;case 24:case"end":return e.stop()}}),n)})))()}},{key:"fetchRawTile",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._inMemoryRaster.fetchRawTile(e,t,r,n)}},{key:"_fetchData",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i,s;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.request(r.url,{responseType:"array-buffer",signal:null==t?void 0:t.signal});case 2:if(a=e.sent,i=a.data,"JPG"===(s=(0,y.getFormat)(i).toUpperCase())||"PNG"===s||"GIF"===s||"BMP"===s){e.next=7;break}throw new(0,l.default)("image-aux-raster:open","the data is not a supported format");case 7:return r._set("datasetFormat",s),e.next=10,r.decodePixelBlock(i,{format:"jpg",width:1,height:1,useCanvas:!0});case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),n)})))()}},{key:"_fetchAuxiliaryData",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i,s,l,f,p,d,m,y,v,g;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,u.unwrap)(null==t?void 0:t.signal),l=null!=(a=r.ioConfig.skipExtensions)?a:[],f=l.indexOf("aux.xml")>-1?null:r.request(r.url+".aux.xml",{responseType:"xml",signal:s}),p=r.datasetFormat,d="JPG"===p?"jgw":"PNG"===p?"pgw":"BMP"===p?"bpw":null,m=l.indexOf(d)>-1?null:r.request(r.url.slice(0,r.url.lastIndexOf("."))+"."+d,{responseType:"text",signal:s}),e.next=9,(0,c.eachAlways)([f,m]);case 9:if(y=e.sent,null==s||!s.aborted){e.next=12;break}throw(0,c.createAbortError)();case 12:return(v=(0,h.parsePAMInfo)(null==(i=y[0].value)?void 0:i.data)).transform||(g=y[1].value?y[1].value.data.split("\n").slice(0,6).map((function(e){return Number(e)})):null,v.transform=6===(null==g?void 0:g.length)?new(0,x.default)({forwardCoefficients:[g[4],g[5],g[0],-g[1],g[2],-g[3]]}):null),e.abrupt("return",v);case 15:case"end":return e.stop()}}),n)})))()}}]),n}(d.default);(0,s._)([(0,f.property)({type:String,json:{write:!0}})],k.prototype,"datasetFormat",void 0);var w=k=(0,s._)([(0,p.subclass)("esri.layers.support.rasterDatasets.ImageAuxRaster")],k)})),r.register("7pJ9D",(function(n,a){t(n.exports,"default",(function(){return g}));var i=r("8TSCy"),o=r("2TvXO"),s=r("7eJjO");r("2ILM8");var l=r("kyj08"),u=r("7qybv"),c=r("10vEZ"),f=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var p=r("fcwIv"),d=r("d0bii"),m=r("5EhGd"),h=r("alctY"),y=r("gINRd"),v=r("j40xv"),x=function(t){"use strict";i.inherits(n,t);var r=i.createSuper(n);function n(){var e;return i.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments)))).datasetFormat="MEMORY",i.possibleConstructorReturn(e)}return i.createClass(n,[{key:"open",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i,s,l,u,c,f,p,m,h,x,g,b,k,w,I;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,r.init();case 3:return i=r.data,s=i.pixelBlock,l=i.statistics,u=i.histograms,c=i.name,f=i.keyProperties,p=i.nativeExtent,m=i.transform,h=s.width,x=s.height,g=s.pixelType,b=r.data.extent||new(0,y.default)({xmin:-.5,ymin:.5,xmax:h-.5,ymax:x-.5,spatialReference:new(0,v.default)({wkid:3857})}),k=null!=(a=r.data.isPseudoSpatialReference)?a:!r.data.extent,w={x:b.width/h,y:b.height/x},I=new(0,d.default)({width:h,height:x,pixelType:g,extent:b,nativeExtent:p,transform:m,pixelSize:w,spatialReference:b.spatialReference,bandCount:3,keyProperties:f||{},statistics:l,isPseudoSpatialReference:k,histograms:u}),r.createRemoteDatasetStorageInfo(I,512,512),r._set("rasterInfo",I),r.updateTileInfo(),e.next=9,r._buildInMemoryRaster(s,{width:512,height:512},t);case 9:r.datasetName=c,r.url="/InMemory/"+c;case 11:case"end":return e.stop()}}),n)})))()}},{key:"fetchRawTile",value:function(e,t,r){var n=this._pixelBlockTiles.get("".concat(e,"/").concat(t,"/").concat(r));return Promise.resolve(n)}},{key:"_buildInMemoryRaster",value:function(t,r,n){var a=this;return i.asyncToGenerator(e(o).mark((function i(){var s,f,p,d,m,y,v,x;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a.rasterInfo.storageInfo.maximumPyramidLevel,f=a.rasterJobHandler?a.rasterJobHandler.split({pixelBlock:t,tileSize:r,maximumPyramidLevel:s},n):Promise.resolve((0,h.split)(t,r,s)),p=(0,u.isSome)(a.rasterInfo.statistics),d=(0,u.isSome)(a.rasterInfo.histograms),m=p&&d?Promise.resolve({statistics:null,histograms:null}):a.rasterJobHandler?a.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:t},n):Promise.resolve((0,h.estimateStatisticsHistograms)(t)),e.next=7,(0,c.eachAlways)([f,m]);case 7:if((y=e.sent)[0].value||!y[1].value){e.next=10;break}throw new(0,l.default)("inmemory-raster:open","failed to build in memory raster");case 10:a._pixelBlockTiles=y[0].value,p||(a.rasterInfo.statistics=null==(v=y[1].value)?void 0:v.statistics),d&&(a.rasterInfo.histograms=null==(x=y[1].value)?void 0:x.histograms);case 13:case"end":return e.stop()}}),i)})))()}}]),n}(m.default);(0,s._)([(0,f.property)({type:String,json:{write:!0}})],x.prototype,"datasetFormat",void 0),(0,s._)([(0,f.property)()],x.prototype,"data",void 0);var g=x=(0,s._)([(0,p.subclass)("esri.layers.support.rasterDatasets.InMemoryRaster")],x)})),r.register("iIUME",(function(e,n){t(e.exports,"parseSpatialReference",(function(){return l})),t(e.exports,"parsePAMInfo",(function(){return c})),r("2ILM8");var a=r("6RP1g"),i=r("kSbmb"),o=r("j40xv");function s(e,t){if(!e||!t)return null;for(var r=[],n=0;n<e.length;n++)r.push(e[n]),r.push(t[n]);return r}function l(e){if(!e)return null;var t=Number(e);if(!isNaN(t)&&0!==t)return new(0,o.default)({wkid:t});if((e=String(e)).startsWith("COMPD_CS")){if(!e.includes("VERTCS")||!e.includes("GEOGCS")&&!e.startsWith("PROJCS"))return null;var r=e.indexOf("VERTCS"),n=e.indexOf("PROJCS"),a=n>-1?n:e.indexOf("GEOGCS");if(-1===a)return null;var i=e.slice(a,e.lastIndexOf("]",r)+1).trim(),s=e.slice(r,e.lastIndexOf("]")).trim();t=u(i);var l=new(0,o.default)(t?{wkid:t}:{wkt:i}),c=u(s);return c&&(l.vcsWkid=c),l}return e.startsWith("GEOGCS")||e.startsWith("PROJCS")?(t=u(e),new(0,o.default)(0!==t?{wkid:t}:{wkt:e})):null}function u(e){var t,r=e.replace(/\]/g,"[").replace(/\"/g,"").split("[").map((function(e){return e.trim()})).filter((function(e){return""!==e})),n=r[r.length-1].split(","),a=null==(t=n[0])?void 0:t.toLowerCase();if(("epsg"===a||"esri"===a)&&e.endsWith('"]]')){var i=Number(n[1]);if(!isNaN(i)&&0!==i)return i}return 0}function c(e){var t;if("pamdataset"!==(null==e||null==(t=e.documentElement.tagName)?void 0:t.toLowerCase()))return{};var r={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};e.documentElement.childNodes.forEach((function(e){if(1===e.nodeType)if((0,a.isSameTagIgnoreNS)(e,"SRS")){if(!r.spatialReference){var t=(0,a.getElementValue)(e);r.spatialReference=l(t)}}else if((0,a.isSameTagIgnoreNS)(e,"Metadata"))if("xml:ESRI"===e.getAttribute("domain")){var n=function(e){var t,r=(0,a.getElement)(e,"GeodataXform"),n=l((0,a.getElementNumericValue)(r,"SpatialReference/WKID")||(0,a.getElementValue)(r,"SpatialReference/WKT"));if("typens:PolynomialXform"!==r.getAttribute("xsi:type"))return{spatialReference:n,transform:null};var o=null!=(t=(0,a.getElementNumericValue)(r,"PolynomialOrder"))?t:1,u=(0,a.getElementNumericValues)(r,"CoeffX/Double"),c=(0,a.getElementNumericValues)(r,"CoeffY/Double"),f=(0,a.getElementNumericValues)(r,"InverseCoeffX/Double"),p=(0,a.getElementNumericValues)(r,"InverseCoeffY/Double"),d=s(u,c),m=s(f,p);return{spatialReference:n,transform:new(0,i.default)({spatialReference:n,polynomialOrder:o,forwardCoefficients:d,inverseCoefficients:m})}}(e),o=n.spatialReference,u=n.transform;r.transform=u,r.spatialReference||(r.spatialReference=o)}else(0,a.getElements)(e,"MDI").forEach((function(e){return r.metadata[e.getAttribute("key")]=(0,a.getElementValue)(e)}));else if((0,a.isSameTagIgnoreNS)(e,"PAMRasterBand")){var c=function(e){var t,r,n,i,o,s=(0,a.getElementNumericValue)(e,"NoDataValue"),l=(0,a.getElement)(e,"Histograms/HistItem"),u=(0,a.getElementNumericValue)(l,"HistMin"),c=(0,a.getElementNumericValue)(l,"HistMax"),f=(0,a.getElementNumericValue)(l,"BucketCount"),p=null==(t=(0,a.getElementValue)(l,"HistCounts"))?void 0:t.split("|").map((function(e){return Number(e)}));(0,a.getElements)(e,"Metadata/MDI").forEach((function(e){var t,a=Number(null!=(t=e.textContent)?t:e.nodeValue);switch(e.getAttribute("key").toUpperCase()){case"STATISTICS_MINIMUM":r=a;break;case"STATISTICS_MAXIMUM":n=a;break;case"STATISTICS_MEAN":i=a;break;case"STATISTICS_STDDEV":o=a}}));var d=(0,a.getElementNumericValue)(e,"Metadata/SourceBandIndex");return{noDataValue:s,histogram:null!=p&&p.length&&null!=r&&null!=n?{min:u,max:c,size:f||p.length,counts:p}:null,sourceBandIndex:d,statistics:null!=r&&null!=n?{min:r,max:n,avg:i,stddev:o}:null}}(e);null!=c.sourceBandIndex&&null==r.rasterBands[c.sourceBandIndex]?r.rasterBands[c.sourceBandIndex]=c:r.rasterBands.push(c)}}));var n=r.rasterBands;if(n){var o=!!n[0].statistics;r.statistics=o?n.map((function(e){return e.statistics})):null;var u=!!n[0].histogram;r.histograms=u?n.map((function(e){return e.histogram})):null}return r}})),r.register("6RP1g",(function(e,r){function n(e,t){if(!e||!t)return[];var r=t;t.indexOf("/")>-1?(r=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var a=[];if(t){for(var i=n(e,r),o=0;o<i.length;o++)n(i[o],t).forEach((function(e){return a.push(e)}));return a}var s=e.getElementsByTagNameNS("*",r);if(!s||0===s.length)return[];for(var l=0;l<s.length;l++)a.push(s[l]||s.item[l]);return a}function a(e,t){if(!e||!t)return null;var r=t;t.indexOf("/")>-1?(r=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var i=n(e,r);return i.length>0?t?a(i[0],t):i[0]:null}function i(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=r?a(e,r):e;return n?(t=n.textContent||n.nodeValue)?t.trim():null:null}function o(e,t){return function(e,t){for(var r,a=n(e,t),i=[],o=0;o<a.length;o++)(r=a[o].textContent||a[o].nodeValue)&&""!==(r=r.trim())&&i.push(r);return i}(e,t).map((function(e){return Number(e)}))}function s(e,t){var r=i(e,t);return Number(r)}function l(e,t){var r,n=null==e||null==(r=e.nodeName)?void 0:r.toLowerCase(),a=t.toLowerCase();return n.slice(n.lastIndexOf(":")+1)===a}t(e.exports,"getElements",(function(){return n})),t(e.exports,"getElement",(function(){return a})),t(e.exports,"getElementValue",(function(){return i})),t(e.exports,"getElementNumericValues",(function(){return o})),t(e.exports,"getElementNumericValue",(function(){return s})),t(e.exports,"isSameTagIgnoreNS",(function(){return l}))})),r.register("jbz8w",(function(n,a){t(n.exports,"default",(function(){return C}));var i=r("8TSCy"),o=r("2TvXO"),s=r("7eJjO");r("2ILM8");var l=r("kyj08"),u=r("7qybv"),c=r("kYueh"),f=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var p=r("fcwIv"),d=r("d0bii"),m=r("cQADC"),h=r("hf36P"),y=r("xQ42o"),v=r("9UGCQ"),x=r("5EhGd"),g=r("alctY"),b=r("h5QJK"),k=r("f4h86"),w=r("j40xv"),I=r("gINRd"),S=r("d1Fqh"),T=function(t){"use strict";i.inherits(n,t);var r=i.createSuper(n);function n(){var e;return i.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._levelOffset=0,e._slices=null,e._tilemapCache=null,e.datasetFormat="RasterTileServer",i.possibleConstructorReturn(e)}return i.createClass(n,[{key:"open",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,s,f,p,d,x,g,b,k,w,I,S,T,C,_,R,M,O,P,N,E,F;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.init();case 2:if(a=t&&t.signal,!r.sourceJSON){e.next=7;break}e.t0={data:r.sourceJSON},e.next=10;break;case 7:return e.next=9,r.request(r.url,{query:{f:"json"},signal:a});case 9:e.t0=e.sent;case 10:if((s=e.t0).ssl&&(r.url=r.url.replace(/^http:/i,"https:")),f=s.data,r.sourceJSON=f,f){e.next=15;break}throw new(0,l.default)("imageserverraster:open","cannot initialize tiled image service, missing service info");case 15:if(f.tileInfo){e.next=17;break}throw new(0,l.default)("imageserverraster:open","use ImageryLayer to open non-tiled image services");case 17:return r._fixScaleInServiceInfo(),p=["jpg","jpeg","png","png8","png24","png32","mixed"],r.tileType=f.cacheType,null==r.tileType&&(p.indexOf(f.tileInfo.format.toLowerCase())>-1?r.tileType="Map":"lerc"===f.tileInfo.format.toLowerCase()?r.tileType="Elevation":r.tileType="Raster"),r.datasetName=f.name.slice(f.name.indexOf("/")+1),e.next=22,r._fetchRasterInfo({signal:a});case 22:if(d=e.sent,(0,u.isSome)(d)){e.next=25;break}throw new(0,l.default)("image-server-raster:open","cannot initialize image service");case 25:x="Map"===r.tileType?(0,h.readServiceTileInfo)(f.tileInfo,f):y.default.fromJSON(f.tileInfo),g=d.extent,b=d.pixelSize,k=.5/d.width*b.x,S=x.lodAt(Math.max.apply(null,x.lods.map((function(e){return e.level})))),"Map"!==r.tileType&&0!==f.maxScale&&("Raster"===r.tileType?(w=x.lods.find((function(e){return e.resolution===b.x})))||(w=x.lods[x.lods.length-1]):(w=x.lods.find((function(e){return Math.abs(e.scale-f.maxScale)<k})))||(w=x.lods.filter((function(e){return e.scale>f.maxScale})).sort((function(e,t){return e.scale>t.scale?1:-1}))[0]),b.x=b.y=w.resolution,d.width=Math.ceil((g.xmax-g.xmin)/b.x-.1),d.height=Math.ceil((g.ymax-g.ymin)/b.y-.1)),w||(w=S),T=x.lodAt(Math.min.apply(null,x.lods.map((function(e){return e.level})))),"Map"===r.tileType?r._levelOffset=x.lods[0].level:0!==f.minScale&&"Elevation"===r.tileType&&(I=x.lods.find((function(e){return Math.abs(e.scale-f.minScale)<k})),r._levelOffset=I.level-T.level),I||(I=T),C=Math.max(b.x,b.y),(Math.abs(b.x-b.y)>k||!x.lods.some((function(e){return Math.abs(e.resolution-C)<k})))&&(b.x=b.y=w.resolution,d.width=Math.ceil((g.xmax-g.xmin)/b.x-.1),d.height=Math.ceil((g.ymax-g.ymin)/b.y-.1)),_=w.level-I.level,R=i.slicedToArray(x.size,2),M=R[0],O=R[1],P=[],x.lods.forEach((function(e){e.level>=I.level&&e.level<=w.level&&P.push({x:e.resolution,y:e.resolution})})),P.sort((function(e,t){return e.x-t.x})),N=r.computeBlockBoundary(g,M,O,x.origin,P,_),E=P.length>1?P.slice(1):null,d.storageInfo=new(0,m.default)({blockWidth:x.size[0],blockHeight:x.size[1],pyramidBlockWidth:x.size[0],pyramidBlockHeight:x.size[1],pyramidResolutions:E,compression:x.format,origin:x.origin,firstPyramidLevel:1,maximumPyramidLevel:_,tileInfo:x,blockBoundary:N}),r._fixGCSShift(d),r._set("rasterInfo",d),f.capabilities.toLowerCase().indexOf("tilemap")>-1&&(F={tileInfo:d.storageInfo.tileInfo,parsedUrl:(0,c.urlToObject)(r.url),url:r.url,tileServers:[],type:"tile"},r._tilemapCache=new(0,v.TilemapCache)({layer:F}));case 27:case"end":return e.stop()}}),n)})))()}},{key:"fetchRawTile",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this;return i.asyncToGenerator(e(o).mark((function i(){var l,u,c,f,p,d,m,h,y,v,x,b,k,w,I,S,T,C,_,R,M,O,P,N;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s._slices||null!=a.sliceId){e.next=2;break}return e.abrupt("return",null);case 2:return l=s.rasterInfo,u=l.storageInfo,c=l.extent,f=u.maximumPyramidLevel-t+s._levelOffset,p="".concat(s.url,"/tile/").concat(f,"/").concat(r,"/").concat(n),d=s._slices?{sliceId:a.sliceId||0}:null,e.next=10,s.request(p,{query:d,responseType:"array-buffer",signal:a.signal});case 10:if(m=e.sent,h=m.data){e.next=14;break}return e.abrupt("return",null);case 14:return e.next=16,s.decodePixelBlock(h,{width:u.tileInfo.size[0],height:u.tileInfo.size[1],planes:null,pixelType:null,isPoint:"Elevation"===s.tileType});case 16:if(y=e.sent,v=u.blockBoundary[t],!("jpg"!==u.compression||n>v.minCol&&n<v.maxCol&&r>v.minRow&&r<v.maxRow)){e.next=20;break}return e.abrupt("return",y);case 20:return x=u.origin,b=u.blockWidth,k=u.blockHeight,w=s.getPyramidPixelSize(t),I=w.x,S=w.y,T=Math.round((c.xmin-x.x)/I)%b,C=Math.round((c.xmax-x.x)/I)%b||b,_=Math.round((x.y-c.ymax)/S)%k,R=Math.round((x.y-c.ymin)/S)%k||k,M=n===v.minCol?T:0,O=r===v.minRow?_:0,P=n===v.maxCol?C:b,N=r===v.maxRow?R:k,e.abrupt("return",((0,g.setValidBoundary)(y,{x:M,y:O},{width:P-M,height:N-O}),y));case 22:case"end":return e.stop()}}),i)})))()}},{key:"getSliceIndex",value:function(e){if(!this._slices||(0,u.isNone)(e)||0===e.length)return null;for(var t=e,r=0;r<this._slices.length;r++){var n=this._slices[r].multidimensionalDefinition;if(n.length===t.length&&!n.some((function(e){var r=t.find((function(t){return e.variableName===t.variableName&&t.dimensionName===e.dimensionName}));return!r||(Array.isArray(e.values[0])?"".concat(e.values[0][0],"-").concat(e.values[0][1]):e.values[0])!==(Array.isArray(r.values[0])?"".concat(r.values[0][0],"-").concat(r.values[0][1]):r.values[0])})))return r}return null}},{key:"fetchVariableStatisticsHistograms",value:function(t,r){var n=this;return i.asyncToGenerator(e(o).mark((function a(){var i,s,l;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.request(n.url+"/statistics",{query:{variable:t,f:"json"},signal:r}).then((function(e){var t;return null==(t=e.data)?void 0:t.statistics})),s=n.request(n.url+"/histograms",{query:{variable:t,f:"json"},signal:r}).then((function(e){var t;return null==(t=e.data)?void 0:t.histograms})),e.next=4,Promise.all([i,s]);case 4:return l=e.sent,e.abrupt("return",(l[0]&&l[0].forEach((function(e){e.avg=e.mean,e.stddev=e.standardDeviation})),{statistics:l[0]||null,histograms:l[1]||null}));case 6:case"end":return e.stop()}}),a)})))()}},{key:"computeBestPyramidLevelForLocation",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this;return i.asyncToGenerator(e(o).mark((function a(){var i,s,l,c,f,p;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n._tilemapCache){e.next=2;break}return e.abrupt("return",0);case 2:if(null!==(i=n.identifyPixelLocation(t,0,(0,u.unwrap)(r.datumTransformation)))){e.next=5;break}return e.abrupt("return",null);case 5:s=0,l=n.rasterInfo.storageInfo,c=l.maximumPyramidLevel,f=c-s+n._levelOffset,p=i.srcLocation;case 9:if(!(f>=0)){e.next=24;break}return e.prev=10,e.next=13,n._tilemapCache.fetchAvailability(f,i.row,i.col,r);case 13:if(e.t0=e.sent,"available"!==e.t0){e.next=16;break}return e.abrupt("break",24);case 16:e.next=20;break;case 18:e.prev=18,e.t1=e.catch(10);case 20:if(f--,s++,null!==(i=n.identifyPixelLocation(p,s,(0,u.unwrap)(r.datumTransformation)))){e.next=22;break}return e.abrupt("return",null);case 22:e.next=9;break;case 24:return e.abrupt("return",-1===f||null==i?null:s);case 25:case"end":return e.stop()}}),a,null,[[10,18]])})))()}},{key:"_fetchRasterInfo",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i,s,l,u,c,f,p,m,h,y,v;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.sourceJSON,i=Math.ceil((a.extent.xmax-a.extent.xmin)/a.pixelSizeX-.1),s=Math.ceil((a.extent.ymax-a.extent.ymin)/a.pixelSizeY-.1),l=w.default.fromJSON(a.spatialReference||a.extent.spatialReference),"Map"!==r.tileType){e.next=3;break}return e.abrupt("return",new(0,d.default)({width:i,height:s,bandCount:3,extent:I.default.fromJSON(a.extent),spatialReference:l,pixelSize:new(0,S.default)({x:a.pixelSizeX,y:a.pixelSizeY,spatialReference:l}),pixelType:"u8",statistics:null,keyProperties:{DataType:"processed"}}));case 3:return u=t.slice,c=t.signal,f=!!a.hasRasterAttributeTable&&r.request(r.url+"/rasterAttributeTable",{query:{slice:u,f:"json"},signal:c}).then((function(e){return k.default.fromJSON(e.data)})).catch((function(){return null})),p=!!a.hasColormap&&r.request(r.url+"/colormap",{query:{slice:u,f:"json"},signal:c}).then((function(e){var t;return null==(t=e.data)?void 0:t.colormap})),m=!!a.hasHistograms&&r.request(r.url+"/histograms",{query:{slice:u,f:"json"},signal:c}).then((function(e){var t;return null==(t=e.data)?void 0:t.histograms})),h=r.request(r.url+"/keyProperties",{query:{f:"json"},signal:c}).then((function(e){return e.data})).catch((function(){})),y=!!a.hasMultidimensions&&r._fetchMultidimensionalInfo(),v=!!a.hasMultidimensions&&r.request(r.url+"/slices",{query:{f:"json"},signal:c}).then((function(e){return e.data&&e.data.slices})).catch((function(){})),e.abrupt("return",Promise.all([f,p,m,h,y,v]).then((function(e){var t=null;if(a.minValues&&a.minValues.length===a.bandCount){t=[];for(var n=0;n<a.minValues.length;n++)t.push({min:a.minValues[n],max:a.maxValues[n],avg:a.meanValues[n],stddev:a.stdvValues[n]})}return r._slices=e[5]||null,new(0,d.default)({width:i,height:s,bandCount:a.bandCount,extent:I.default.fromJSON(a.extent),spatialReference:l,pixelSize:new(0,S.default)({x:a.pixelSizeX,y:a.pixelSizeY,spatialReference:l}),pixelType:a.pixelType.toLowerCase(),statistics:t,attributeTable:e[0]||null,colormap:e[1]||null,histograms:e[2]||null,keyProperties:e[3]||{},multidimensionalInfo:e[4]||null})})));case 5:case"end":return e.stop()}}),n)})))()}},{key:"_fetchMultidimensionalInfo",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,r.request(r.url+"/multidimensionalInfo",{query:{f:"json"},signal:t}).then((function(e){var t;return null==(t=e.data)?void 0:t.multidimensionalInfo}));case 3:return i=e.sent,e.abrupt("return",(null!=(a=i.variables)&&a.length&&i.variables.forEach((function(e){var t;null!=(t=e.statistics)&&t.length&&e.statistics.forEach((function(e){e.avg=e.mean,e.stddev=e.standardDeviation}))})),i));case 5:case"end":return e.stop()}}),n)})))()}},{key:"_fixScaleInServiceInfo",value:function(){var e=this.sourceJSON;e.minScale&&e.minScale<0&&(e.minScale=0),e.maxScale&&e.maxScale<0&&(e.maxScale=0)}},{key:"_fixGCSShift",value:function(e){var t=e.extent,r=e.spatialReference;0===t.xmin&&360===t.xmax&&r.wkid&&r.isGeographic&&(e.nativeExtent=e.extent,e.transform=new(0,b.default),e.extent=e.transform.forwardTransform(t))}}]),n}(x.default);(0,s._)([(0,f.property)({type:String,json:{write:!0}})],T.prototype,"datasetFormat",void 0),(0,s._)([(0,f.property)()],T.prototype,"tileType",void 0);var C=T=(0,s._)([(0,p.subclass)("esri.layers.support.rasterDatasets.ImageServerRaster")],T)})),r.register("ljwGu",(function(n,a){t(n.exports,"default",(function(){return C}));var i=r("8TSCy"),o=r("2TvXO"),s=r("7eJjO");r("2ILM8");var l=r("kyj08"),u=r("7qybv"),c=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var f=r("fcwIv"),p=r("idX6c"),d=r("d0bii"),m=r("cQADC"),h=r("5EhGd"),y=r("iIUME"),v=r("6RP1g"),x=r("ldsnl"),g=r("alctY"),b=r("j40xv"),k=r("gINRd"),w=r("d1Fqh"),I=new Map;I.set("Int8","s8"),I.set("UInt8","u8"),I.set("Int16","s16"),I.set("UInt16","u16"),I.set("Int32","s32"),I.set("UInt32","u32"),I.set("Float32","f32"),I.set("Float64","f32"),I.set("Double64","f32");var S=new Map;S.set("none",{blobExtension:".til",isOneSegment:!0,decoderFormat:"bip"}),S.set("lerc",{blobExtension:".lrc",isOneSegment:!1,decoderFormat:"lerc"}),S.set("deflate",{blobExtension:".pzp",isOneSegment:!0,decoderFormat:"deflate"}),S.set("jpeg",{blobExtension:".pjg",isOneSegment:!0,decoderFormat:"jpg"});var T=function(t){"use strict";i.inherits(n,t);var r=i.createSuper(n);function n(){var e;return i.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._files=null,e._storageIndex=null,e.datasetFormat="MRF",i.possibleConstructorReturn(e)}return i.createClass(n,[{key:"open",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i,s,l,c,f,p,d,m,h,y,v,x,b,k,w,I,S,T,C,_,R;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,r.init();case 3:return r.datasetName=r.url.slice(r.url.lastIndexOf("/")+1),i=t?(0,u.unwrap)(t.signal):null,e.next=7,r.request(r.url,{responseType:"xml",signal:i});case 7:if(s=e.sent,l=r._parseHeader(s.data),c=l.rasterInfo,f=l.files,-1!==(null==(a=r.ioConfig.skipExtensions)?void 0:a.indexOf("aux.xml"))){e.next=17;break}return e.next=14,r._fetchAuxiliaryData(t);case 14:null!=(p=e.sent)&&(c.statistics=null!=(d=p.statistics)?d:c.statistics,c.histograms=p.histograms,p.histograms&&!(0,u.isSome)(c.statistics)&&(c.statistics=(0,g.estimateStatisticsFromHistograms)(p.histograms)));case 17:return r._set("rasterInfo",c),r._files=f,e.next=20,r.request(f.index,{responseType:"array-buffer",signal:i});case 20:for(m=e.sent,r._storageIndex=r._parseIndex(m.data),h=r.rasterInfo.storageInfo,y=h.blockWidth,v=h.blockHeight,x=r.rasterInfo.storageInfo.pyramidScalingFactor,b=r.rasterInfo,k=b.width,w=b.height,I=[],S=r._getBandSegmentCount(),T=0,C=-1;T<r._storageIndex.length;)C++,_=Math.ceil(k/y/Math.pow(x,C))-1,R=Math.ceil(w/v/Math.pow(x,C))-1,T+=(_+1)*(R+1)*S*4,I.push({maxRow:R,maxCol:_,minCol:0,minRow:0});r.rasterInfo.storageInfo.blockBoundary=I,C>0&&(r.rasterInfo.storageInfo.firstPyramidLevel=1,r.rasterInfo.storageInfo.maximumPyramidLevel=C),r.updateTileInfo();case 26:case"end":return e.stop()}}),n)})))()}},{key:"fetchRawTile",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this;return i.asyncToGenerator(e(o).mark((function i(){var l,c,f,d,m,h,y,v,x,g,b,k,w,I,T,C,_,R,M,O,P,N,E,F,D,B,A,J,j,z;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=s.rasterInfo.storageInfo,c=l.blockWidth,f=l.blockHeight,d=l.blockBoundary,!(!(m=d[t])||m.maxRow<r||m.maxCol<n||m.minRow>r||m.minCol>n)){e.next=3;break}return e.abrupt("return",null);case 3:if(h=s.rasterInfo,y=h.bandCount,v=h.pixelType,x=s._getTileLocation(t,r,n),g=x.ranges,b=x.actualTileWidth,k=x.actualTileHeight,g&&0!==g.length){e.next=6;break}return e.abrupt("return",null);case 6:if(0!==g[0].from||0!==g[0].to){e.next=9;break}return w=new Uint8Array(c*f),e.abrupt("return",new(0,p.default)({width:c,height:f,pixels:null,mask:w,validPixelCount:0}));case 9:for(I=s.ioConfig,T=I.bandIds,C=s._getBandSegmentCount(),_=[],R=0,R=0;R<C;R++)(!T||T.indexOf[R]>-1)&&_.push(s.request(s._files.data,{range:{from:g[R].from,to:g[R].to},responseType:"array-buffer",signal:a.signal}));return e.next=14,Promise.all(_);case 14:for(M=e.sent,O=M.map((function(e){return e.data.byteLength})).reduce((function(e,t){return e+t})),P=new Uint8Array(O),N=0,R=0;R<C;R++)P.set(new Uint8Array(M[R].data),N),N+=M[R].data.byteLength;return E=S.get(s.rasterInfo.storageInfo.compression).decoderFormat,e.next=22,s.decodePixelBlock(P.buffer,{width:c,height:f,format:E,planes:(null==T?void 0:T.length)||y,pixelType:v});case 22:if(F=e.sent,(0,u.isSome)(s.rasterInfo.noDataValue)&&"lerc"!==E&&!F.mask&&null!=(D=s.rasterInfo.noDataValue[0])){if(B=F.width*F.height,A=new Uint8Array(B),Math.abs(D)>1e24)for(R=0;R<B;R++)Math.abs((F.pixels[0][R]-D)/D)>1e-6&&(A[R]=1);else for(R=0;R<B;R++)F.pixels[0][R]!==D&&(A[R]=1);F.mask=A}if(J=0,j=0,b!==c||k!==f)if(z=F.mask)for(R=0;R<f;R++)if(j=R*c,R<k)for(J=b;J<c;J++)z[j+J]=0;else for(J=0;J<c;J++)z[j+J]=0;else for(z=new Uint8Array(c*f),F.mask=z,R=0;R<k;R++)for(j=R*c,J=0;J<b;J++)z[j+J]=1;return e.abrupt("return",F);case 27:case"end":return e.stop()}}),i)})))()}},{key:"_parseIndex",value:function(e){if(e.byteLength%16>0)throw"invalid array buffer must be multiples of 16";var t,r,n,a,i,o;if(x.isPlatformLittleEndian){for(r=new Uint8Array(e),a=new ArrayBuffer(e.byteLength),n=new Uint8Array(a),i=0;i<e.byteLength/4;i++)for(o=0;o<4;o++)n[4*i+o]=r[4*i+3-o];t=new Uint32Array(a)}else t=new Uint32Array(e);return t}},{key:"_getBandSegmentCount",value:function(){return S.get(this.rasterInfo.storageInfo.compression).isOneSegment?1:this.rasterInfo.bandCount}},{key:"_getTileLocation",value:function(e,t,r){var n,a,i,o=this.rasterInfo.storageInfo,s=o.blockWidth,l=o.blockHeight,u=o.pyramidScalingFactor,c=this.rasterInfo,f=c.width,p=c.height,d=this._getBandSegmentCount(),m=0,h=0;for(i=0;i<e;i++)h=Math.pow(u,i),m+=(n=Math.ceil(f/s/h))*(a=Math.ceil(p/l/h));h=Math.pow(u,e),n=Math.ceil(f/s/h),a=Math.ceil(p/l/h),m+=t*n+r,m*=4*d;for(var y=this._storageIndex.subarray(m,m+4*d),v=0,x=0,g=[],b=0;b<d;b++)x=(v=y[4*b+0]*Math.pow(2,32)+y[4*b+1])+y[4*b+2]*Math.pow(2,32)+y[4*b+3],g.push({from:v,to:x});return{ranges:g,actualTileWidth:r<n-1?s:Math.ceil(f/h)-s*(n-1),actualTileHeight:t<a-1?l:Math.ceil(p/h)-l*(a-1)}}},{key:"_parseHeader",value:function(e){var t=(0,v.getElement)(e,"MRF_META/Raster");if(!t)throw new(0,l.default)("mrf:open","not a valid MRF format");var r=(0,v.getElement)(t,"Size"),n=parseInt(r.getAttribute("x"),10),a=parseInt(r.getAttribute("y"),10),i=parseInt(r.getAttribute("c"),10),o=((0,v.getElementValue)(t,"Compression")||"none").toLowerCase();if(!S.has(o))throw new(0,l.default)("mrf:open","currently does not support compression "+o);var s=(0,v.getElementValue)(t,"DataType")||"UInt8",u=I.get(s);if(null==u)throw new(0,l.default)("mrf:open","currently does not support pixel type "+s);var c,f,p=(0,v.getElement)(t,"PageSize"),h=parseInt(p.getAttribute("x"),10),x=parseInt(p.getAttribute("y"),10),g=(0,v.getElement)(t,"DataValues");if(g&&(null!=(f=g.getAttribute("NoData"))&&(c=f.trim().split(" ").map((function(e){return parseFloat(e)})))),(0,v.getElement)(e,"MRF_META/CachedSource"))throw new(0,l.default)("mrf:open","currently does not support MRF referencing other data files");var T,C=(0,v.getElement)(e,"MRF_META/GeoTags"),_=(0,v.getElement)(C,"BoundingBox"),R=!1;if(null!=_){var M,O=parseFloat(_.getAttribute("minx")),P=parseFloat(_.getAttribute("miny")),N=parseFloat(_.getAttribute("maxx")),E=parseFloat(_.getAttribute("maxy")),F=(0,v.getElementValue)(C,"Projection")||"";if("LOCAL_CS[]"!==F)if(F.toLowerCase().startsWith("epsg:")){var D=Number(F.slice(5));isNaN(D)||0===D||(M=new(0,b.default)({wkid:D}))}else M=(0,y.parseSpatialReference)(F);else R=!0,M=new(0,b.default)({wkid:3857});(T=new(0,k.default)(O,P,N,E)).spatialReference=M}else R=!0,T=new(0,k.default)({xmin:-.5,ymin:.5-a,xmax:n-.5,ymax:.5,spatialReference:new(0,b.default)({wkid:3857})});var B=(0,v.getElement)(e,"MRF_META/Rsets"),A=parseInt(B&&B.getAttribute("scale")||"2",10),J=T.spatialReference,j=new(0,m.default)({origin:new(0,w.default)({x:T.xmin,y:T.ymax,spatialReference:J}),blockWidth:h,blockHeight:x,pyramidBlockWidth:h,pyramidBlockHeight:x,compression:o,pyramidScalingFactor:A}),z=new(0,w.default)({x:T.width/n,y:T.height/a,spatialReference:J}),H=new(0,d.default)({width:n,height:a,extent:T,isPseudoSpatialReference:R,spatialReference:J,bandCount:i,pixelType:u,pixelSize:z,noDataValue:c,storageInfo:j}),L=(0,v.getElementValue)(e,"datafile"),W=(0,v.getElementValue)(e,"IndexFile");return{rasterInfo:H,files:{mrf:this.url,index:W||this.url.replace(".mrf",".idx"),data:L||this.url.replace(".mrf",S.get(o).blobExtension)}}}},{key:"_fetchAuxiliaryData",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.request(r.url+".aux.xml",{responseType:"xml",signal:null==t?void 0:t.signal});case 3:return a=e.sent,i=a.data,e.abrupt("return",(0,y.parsePAMInfo)(i));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),n,null,[[0,8]])})))()}}]),n}(h.default);(0,s._)([(0,c.property)()],T.prototype,"_files",void 0),(0,s._)([(0,c.property)()],T.prototype,"_storageIndex",void 0),(0,s._)([(0,c.property)({type:String,json:{write:!0}})],T.prototype,"datasetFormat",void 0);var C=T=(0,s._)([(0,f.subclass)("esri.layers.support.rasterIO.MRFRaster")],T)})),r.register("9Ybm2",(function(n,a){t(n.exports,"default",(function(){return C}));var i=r("8TSCy"),o=r("2TvXO"),s=r("7eJjO");r("2ILM8");var l=r("kyj08"),u=r("7qybv"),c=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var f=r("fcwIv"),p=r("d0bii"),d=r("cQADC"),m=r("5EhGd"),h=r("iIUME"),y=r("3pd1I"),v=r("hP3N4"),x=r("alctY"),g=r("kSbmb"),b=r("j40xv"),k=r("gINRd"),w=r("d1Fqh"),I=function(e,t){var r=e.get(t);return r&&r.values},S=function(e,t){var r=e.get(t);return r&&r.values[0]},T=function(t){"use strict";i.inherits(n,t);var r=i.createSuper(n);function n(){var e;return i.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._files=null,e._headerInfo=null,e._bufferSize=1048576,e.datasetFormat="TIFF",i.possibleConstructorReturn(e)}return i.createClass(n,[{key:"open",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,s,c,f,m,v,I,S,T,C,_,R,M,O,P,N,E,F,D,B,A,J,j,z,H,L,W,G,V,q,U,X,Y,Q,K,Z,$,ee;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,r.init();case 3:return f=t?(0,u.unwrap)(t.signal):null,e.next=6,r.request(r.url,{range:{from:0,to:r._bufferSize},responseType:"array-buffer",signal:f});case 6:if(m=e.sent,v=m.data){e.next=10;break}throw new(0,l.default)("tiffraster:open","failed to open url "+r.url);case 10:return r.datasetName=r.url.slice(r.url.lastIndexOf("/")+1),I=(0,y.parseSignature)(v),S=I.littleEndian,T=I.firstIFD,C=I.isBigTiff,_=[],e.next=14,r._readIFDs(_,v,S,T,0,C?8:4,f);case 14:if(R=(0,y.getImageInfo)(_),M=R.width,O=R.height,P=R.tileWidth,N=R.tileHeight,E=R.planes,F=R.pixelType,D=R.compression,B=R.firstPyramidLevel,A=R.maximumPyramidLevel,J=R.pyramidBlockWidth,j=R.pyramidBlockHeight,z=R.tileBoundary,H=R.affine,L=R.metadata,W=(null==(a=R.extent.spatialReference)?void 0:a.wkt)||(null==(s=R.extent.spatialReference)?void 0:s.wkid),G=(0,h.parseSpatialReference)(W),V=!1,null==G&&(V=!0,G=new(0,b.default)({wkid:3857})),q=new(0,k.default)(i.objectSpread({},R.extent,{spatialReference:G})),U=new(0,w.default)(q?{x:q.xmin,y:q.ymax,spatialReference:G}:{x:0,y:0}),X=new(0,d.default)({blockWidth:P,blockHeight:N,pyramidBlockWidth:J,pyramidBlockHeight:j,compression:D,origin:U,firstPyramidLevel:B,maximumPyramidLevel:A,blockBoundary:z}),Y=new(0,w.default)({x:(q.xmax-q.xmin)/M,y:(q.ymax-q.ymin)/O,spatialReference:G}),Q=L?{BandProperties:L.bandProperties,DataType:L.dataType}:{},K=new(0,p.default)({width:M,height:O,bandCount:E,pixelType:F,compression:D,pixelSize:Y,storageInfo:X,spatialReference:G,isPseudoSpatialReference:V,keyProperties:Q,extent:q,statistics:L?L.statistics:null}),null!=H&&H.length&&(K.nativeExtent=new(0,k.default)({xmin:-.5,ymin:.5-O,xmax:M-.5,ymax:.5,spatialReference:G}),K.transform=new(0,g.default)({polynomialOrder:1,forwardCoefficients:[H[2]+H[0]/2,H[5]-H[3]/2,H[0],H[3],-H[1],-H[4]]}),K.extent=K.transform.forwardTransform(K.nativeExtent),K.pixelSize=new(0,w.default)({x:(q.xmax-q.xmin)/M,y:(q.ymax-q.ymin)/O,spatialReference:G}),X.origin.x=-.5,X.origin.y=.5),null!=(c=r.ioConfig.skipExtensions)&&c.includes("aux.xml")){e.next=23;break}return e.next=21,r._fetchAuxiliaryData(t);case 21:null!=(Z=e.sent)&&(K.statistics=null!=($=Z.statistics)?$:K.statistics,K.histograms=Z.histograms,Z.histograms&&!(0,u.isSome)(K.statistics)&&(K.statistics=(0,x.estimateStatisticsFromHistograms)(Z.histograms)),Z.transform&&!H&&(K.transform=Z.transform,K.nativeExtent=K.extent,ee=K.transform.forwardTransform(K.nativeExtent),K.pixelSize=new(0,w.default)({x:(ee.xmax-ee.xmin)/M,y:(ee.ymax-ee.ymin)/O,spatialReference:G}),K.extent=ee),K.spatialReference||(K.spatialReference=Z.spatialReference));case 23:if(r._set("rasterInfo",K),r._headerInfo=i.objectSpread({littleEndian:S,isBigTiff:C,ifds:_},R),r._headerInfo.isSupported){e.next=25;break}throw new(0,l.default)("tiffraster:open","this tiff is not supported: "+r._headerInfo.message);case 25:r.updateTileInfo();case 26:case"end":return e.stop()}}),n)})))()}},{key:"fetchRawTile",value:function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this;return i.asyncToGenerator(e(o).mark((function i(){var l,u,c,f,p,d,m,h,y,v,x,g,b,k,w,I,S,T,C,_,R,M,O,P;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(l=s._headerInfo)&&l.isSupported&&!s.isBlockOutside(t,r,n)){e.next=3;break}return e.abrupt("return",null);case 3:if(u=s._getTileLocation(t,r,n)){e.next=6;break}return e.abrupt("return",null);case 6:return c=u.ranges,f=u.actualTileWidth,p=u.actualTileHeight,d=u.ifd,m=c.map((function(e){return s.request(s.url,{range:e,responseType:"array-buffer",signal:a.signal})})),e.next=13,Promise.all(m);case 13:if(h=e.sent,y=h.map((function(e){return e.data.byteLength})).reduce((function(e,t){return e+t})),v=1===h.length?h[0].data:new ArrayBuffer(y),x=[0],g=[0],h.length>1)for(b=new Uint8Array(v),k=0,w=0;k<h.length;k++)I=h[k].data,b.set(new Uint8Array(I),w),x[k]=w,w+=I.byteLength,g[k]=I.byteLength;return S=s.getBlockWidthHeight(t),T=S.blockWidth,C=S.blockHeight,e.next=24,s.decodePixelBlock(v,{format:"tiff",customOptions:{headerInfo:s._headerInfo,ifd:d,offsets:x,sizes:g},width:T,height:C,planes:null,pixelType:null});case 24:if(_=e.sent,f!==T||p!==C)if(P=_.mask)for(R=0;R<C;R++)if(O=R*T,R<p)for(M=f;M<T;M++)P[O+M]=0;else for(M=0;M<T;M++)P[O+M]=0;else for(P=new Uint8Array(T*C),_.mask=P,R=0;R<p;R++)for(O=R*T,M=0;M<f;M++)P[O+M]=1;return e.abrupt("return",_);case 28:case"end":return e.stop()}}),i)})))()}},{key:"_readIFDs",value:function(t,r,n,a,s){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4,u=arguments.length>6?arguments[6]:void 0,c=this;return i.asyncToGenerator(e(o).mark((function i(){var f;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",null);case 2:if(!(a>=r.byteLength||a<0)){e.next=8;break}return e.next=5,c.request(c.url,{range:{from:a+s,to:a+s+c._bufferSize},responseType:"array-buffer",signal:u});case 5:r=e.sent.data,s=a+s,a=0;case 8:return e.next=10,c._readIFD(r,n,a,s,v.default.TIFF_TAGS,l,u);case 10:if(f=e.sent,t.push(f.ifd),f.nextIFD){e.next=13;break}return e.abrupt("return",null);case 13:return e.next=15,c._readIFDs(t,r,n,f.nextIFD-s,s,l,u);case 15:case"end":return e.stop()}}),i)})))()}},{key:"_readIFD",value:function(t,r,n,a){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:v.default.TIFF_TAGS,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4,u=arguments.length>6?arguments[6]:void 0,c=this;return i.asyncToGenerator(e(o).mark((function i(){var f,p,d,m,h,x,g,b,k,w,I;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if(!(f=(0,y.parseIFD)(t,r,n,a,s,l)).success){e.next=22;break}if(p=[],f.ifd.forEach((function(e){e.values||p.push(e)})),!(p.length>0)){e.next=13;break}if(d=p.map((function(e){return e.offlineOffsetSize})),m=Math.min.apply(null,d.map((function(e){return e[0]}))),!(Math.min.apply(null,d.map((function(e){return e[0]+e[1]})))-m<=c._bufferSize)){e.next=13;break}return e.next=10,c.request(c.url,{range:{from:m,to:m+c._bufferSize},responseType:"array-buffer",signal:u});case 10:h=e.sent,x=h.data,t=x,a=m,p.forEach((function(e){return(0,y.parseFieldValues)(t,r,e,a)}));case 13:if(!f.ifd.has("GEOKEYDIRECTORY")){e.next=21;break}if(g=f.ifd.get("GEOKEYDIRECTORY"),!((b=g.values)&&b.length>4)){e.next=21;break}return k=b[0]+"."+b[1]+"."+b[2],e.next=19,c._readIFD(t,r,g.valueOffset+6-a,a,v.default.GEO_KEYS,2,u);case 19:w=e.sent,g.data=w.ifd,g.data&&g.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[k]});case 21:return e.abrupt("return",f);case 22:if(!f.requiredBufferSize||f.requiredBufferSize===t.byteLength){e.next=27;break}return e.next=25,c.request(c.url,{range:{from:a,to:a+f.requiredBufferSize+4},responseType:"array-buffer",signal:u});case 25:return I=e.sent,e.abrupt("return",(t=I.data).byteLength<f.requiredBufferSize?null:c._readIFD(t,r,0,a,v.default.TIFF_TAGS,4,u));case 27:case"end":return e.stop()}}),i)})))()}},{key:"_getTileLocation",value:function(e,t,r){var n=this.rasterInfo.storageInfo,a=n.firstPyramidLevel,i=n.blockBoundary,o=0===e?0:e-(a-1),s=this._headerInfo.ifds[o];if(!s)return null;var l=(0,y.isBSQConfig)(s,this._headerInfo),u=I(s,"TILEOFFSETS");if(void 0===u)return null;var c=I(s,"TILEBYTECOUNTS"),f=i[o],p=f.minRow,d=f.minCol,m=f.maxRow,h=f.maxCol;if(t>m||r>h||t<p||r<d)return null;var v=S(s,"IMAGEWIDTH"),x=S(s,"IMAGELENGTH"),g=S(s,"TILEWIDTH"),b=S(s,"TILELENGTH"),k=l?this.rasterInfo.bandCount:1,w=k*t*(h+1)+r,T=[{from:u[w],to:u[w+k-1]+c[w+k-1]-1}];if(l){for(var C=!0,_=0;_<k;_++)if(u[w+_]+c[w+_]!==u[w+_+1]){C=!1;break}if(!C)for(var R=0;R<k;R++)T[R]={from:u[w+R],to:u[w+R]+c[w+R]-1}}var M=u[w],O=c[w];return null==M||null==O?null:{ranges:T,ifd:s,actualTileWidth:r===h?v%g:g,actualTileHeight:t===m?x%b:b}}},{key:"_fetchAuxiliaryData",value:function(t){var r=this;return i.asyncToGenerator(e(o).mark((function n(){var a,i;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.request(r.url+".aux.xml",{responseType:"xml",signal:null==t?void 0:t.signal});case 3:return a=e.sent,i=a.data,e.abrupt("return",(0,h.parsePAMInfo)(i));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),n,null,[[0,8]])})))()}}]),n}(m.default);(0,s._)([(0,c.property)()],T.prototype,"_files",void 0),(0,s._)([(0,c.property)()],T.prototype,"_headerInfo",void 0),(0,s._)([(0,c.property)()],T.prototype,"_bufferSize",void 0),(0,s._)([(0,c.property)({type:String,json:{write:!0}})],T.prototype,"datasetFormat",void 0);var C=T=(0,s._)([(0,f.subclass)("esri.layers.support.rasterDatasets.TIFFRaster")],T)})),r.register("59jTx",(function(e,n){t(e.exports,"default",(function(){return d}));var a=r("8TSCy"),i=r("7eJjO"),o=r("79ASa"),s=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var l=r("fcwIv"),u=r("kt6hM"),c=new(0,o.JSONMap)({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),f=new(0,o.JSONMap)({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"}),p=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){var e;return a.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))).breakCount=null,e.classificationField=null,e.classificationMethod=null,e.normalizationField=null,e.normalizationType=null,e.type="class-breaks-definition",a.possibleConstructorReturn(e)}return a.createClass(r,[{key:"standardDeviationInterval",set:function(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}},{key:"definedInterval",set:function(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}}]),r}(u.default);(0,i._)([(0,s.property)({json:{write:!0}})],p.prototype,"breakCount",void 0),(0,i._)([(0,s.property)({json:{write:!0}})],p.prototype,"classificationField",void 0),(0,i._)([(0,s.property)({type:String,json:{read:c.read,write:c.write}})],p.prototype,"classificationMethod",void 0),(0,i._)([(0,s.property)({json:{write:!0}})],p.prototype,"normalizationField",void 0),(0,i._)([(0,s.property)({json:{read:f.read,write:f.write}})],p.prototype,"normalizationType",void 0),(0,i._)([(0,s.property)({value:null,json:{write:!0}})],p.prototype,"standardDeviationInterval",null),(0,i._)([(0,s.property)({value:null,json:{write:!0}})],p.prototype,"definedInterval",null),(0,i._)([(0,s.property)()],p.prototype,"type",void 0);var d=p=(0,i._)([(0,l.subclass)("esri.rest.support.ClassBreaksDefinition")],p)})),r.register("kt6hM",(function(e,n){t(e.exports,"default",(function(){return m}));var a=r("8TSCy"),i=r("7eJjO"),o=r("79ASa"),s=r("1XAcN"),l=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var u=r("fcwIv"),c=r("1DHtQ"),f=r("j9ZJv"),p=new(0,o.JSONMap)({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"}),d=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){var e;return a.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))).baseSymbol=null,e.colorRamp=null,e.type=null,a.possibleConstructorReturn(e)}return r}(s.JSONSupport);(0,i._)([(0,l.property)({type:f.default,json:{write:!0}})],d.prototype,"baseSymbol",void 0),(0,i._)([(0,l.property)({types:c.types,json:{read:{reader:c.fromJSON},write:!0}})],d.prototype,"colorRamp",void 0),(0,i._)([(0,l.property)({json:{read:p.read,write:p.write}})],d.prototype,"type",void 0);var m=d=(0,i._)([(0,u.subclass)("esri.rest.support.ClassificationDefinition")],d)})),r.register("hxmJW",(function(e,r){function n(e,t){return Number(e.toFixed(t))}function a(e){var t=e.normalizationTotal;return{classBreaks:i(e),normalizationTotal:t}}function i(e){var t=e.definition,r=t.classificationMethod,a=t.breakCount,i=t.normalizationType,c=t.definedInterval,f=[],p=e.values;if(0===p.length)return[];var d,m,h,y,v,x,g=(p=p.sort((function(e,t){return e-t})))[0],b=p[p.length-1];if("equal-interval"===r)if(p.length>=a){for(var k=(b-g)/a,w=g,I=1;I<a;I++){var S=n(g+I*k,6);f.push({minValue:w,maxValue:S,label:o(w,S,i)}),w=S}f.push({minValue:w,maxValue:b,label:o(w,b,i)})}else p.forEach((function(e){f.push({minValue:e,maxValue:e,label:o(e,e,i)})}));else if("natural-breaks"===r){for(var T=s(p),C=e.valueFrequency||T.valueFrequency,_=function(e,t,r){var n=e.length,a=[];r>n&&(r=n);for(var i=0;i<r;i++)a.push(Math.round(i*n/r-1));a.push(n-1);var o=l(a,e,t,r);return function(e,t,r,n,a,i){for(var o=0,s=0,l=0,c=0,f=!0,p=0;p<2&&f;p++){0===p&&(f=!1);for(var d=0;d<i-1;d++)for(;r[d+1]+1!==r[d+2];){r[d+1]=r[d+1]+1;var m=u(d,r,n,a);l=m.sbMean,o=m.sbSdcm;var h=u(d+1,r,n,a);if(c=h.sbMean,!(o+(s=h.sbSdcm)<t[d]+t[d+1])){r[d+1]=r[d+1]-1;break}t[d]=o,t[d+1]=s,e[d]=l,e[d+1]=c,f=!0}for(var y=i-1;y>0;y--)for(;r[y]!==r[y-1]+1;){r[y]=r[y]-1;var v=u(y-1,r,n,a);l=v.sbMean,o=v.sbSdcm;var x=u(y,r,n,a);if(c=x.sbMean,!(o+(s=x.sbSdcm)<t[y-1]+t[y])){r[y]=r[y]+1;break}t[y-1]=o,t[y]=s,e[y-1]=l,e[y]=c,f=!0}}return f}(o.mean,o.sdcm,a,e,t,r)&&(o=l(a,e,t,r)),a}(T.uniqueValues,C,a),R=g,M=1;M<a;M++)if(T.uniqueValues.length>M){var O=n(T.uniqueValues[_[M]],6);f.push({minValue:R,maxValue:O,label:o(R,O,i)}),R=O}f.push({minValue:R,maxValue:b,label:o(R,b,i)})}else if("quantile"===r)if(p.length>=a&&g!==b){for(var P=g,N=Math.ceil(p.length/a),E=0,F=1;F<a;F++){var D=N+E-1;D>p.length&&(D=p.length-1),D<0&&(D=0),f.push({minValue:P,maxValue:p[D],label:o(P,p[D],i)}),P=p[D],E+=N,N=Math.ceil((p.length-E)/(a-F))}f.push({minValue:P,maxValue:b,label:o(P,b,i)})}else for(var B=-1,A=0;A<p.length;A++){var J=p[A];J!==B&&(B=J,f.push({minValue:B,maxValue:J,label:o(B,J,i)}),B=J)}else if("standard-deviation"===r){var j=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}(p),z=function(e,t){for(var r=0,n=0;n<e.length;n++){var a=e[n];r+=(a-t)*(a-t)}return r/=e.length,Math.sqrt(r)}(p,j);if(0===z)f.push({minValue:p[0],maxValue:p[0],label:o(p[0],p[0],i)});else{for(var H=(d=g,m=b,h=a,y=j,v=z,((x=Math.max(y-d,m-y)/v/h)>=1?1:x>=.5?.5:.25)*z),L=0,W=g,G=a;G>=1;G--){var V=n(j-(G-.5)*H,6);f.push({minValue:W,maxValue:V,label:o(W,V,i)}),W=V,L++}var q=n(j+.5*H,6);f.push({minValue:W,maxValue:q,label:o(W,q,i)}),W=q,L++;for(var U=1;U<=a;U++)q=L===2*a?b:n(j+(U+.5)*H,6),f.push({minValue:W,maxValue:q,label:o(W,q,i)}),W=q,L++}}else if("defined-interval"===r){if(!c)return f;for(var X=p[0],Y=p[p.length-1],Q=Math.ceil((Y-X)/c),K=X,Z=1;Z<Q;Z++){var $=n(X+Z*c,6);f.push({minValue:K,maxValue:$,label:o(K,$,i)}),K=$}f.push({minValue:K,maxValue:Y,label:o(K,Y,i)})}return f}function o(e,t,r){return e===t?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+t+"%":e+" - "+t}function s(e){for(var t=[],r=[],n=Number.MIN_VALUE,a=1,i=-1,o=0;o<e.length;o++){var s=e[o];s===n?(a++,r[i]=a):null!==s&&(t.push(s),n=s,a=1,r.push(a),i++)}return{uniqueValues:t,valueFrequency:r}}function l(e,t,r,n){for(var a=[],i=[],o=[],s=0,l=[],c=[],f=0;f<n;f++){var p=u(f,e,t,r);l.push(p.sbMean),c.push(p.sbSdcm),s+=c[f]}for(var d,m=s,h=!0;h||s<m;){h=!1,a=[];for(var y=0;y<n;y++)a.push(e[y]);for(var v=0;v<n;v++)for(var x=e[v]+1;x<=e[v+1];x++)if(d=t[x],v>0&&x!==e[v+1]&&Math.abs(d-l[v])>Math.abs(d-l[v-1]))e[v]=x;else if(v<n-1&&e[v]!==x-1&&Math.abs(d-l[v])>Math.abs(d-l[v+1])){e[v+1]=x-1;break}m=s,s=0,i=[],o=[];for(var g=0;g<n;g++){i.push(l[g]),o.push(c[g]);var b=u(g,e,t,r);l[g]=b.sbMean,c[g]=b.sbSdcm,s+=c[g]}}if(s>m){for(var k=0;k<n;k++)e[k]=a[k],l[k]=i[k],c[k]=o[k];s=m}return{mean:l,sdcm:c}}function u(e,t,r,n){for(var a=0,i=0,o=t[e]+1;o<=t[e+1];o++){var s=n[o];a+=r[o]*s,i+=s}i<=0&&console.log("Exception in Natural Breaks calculation");for(var l=a/i,u=0,c=t[e]+1;c<=t[e+1];c++)u+=n[c]*Math.pow(r[c]-l,2);return{sbMean:l,sbSdcm:u}}t(e.exports,"createGenerateRendererClassBreaks",(function(){return a}))}))}();
//# sourceMappingURL=ImageryTileLayer.943159d4.js.map
