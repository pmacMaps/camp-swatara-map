var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;e.register("ghsda",(function(t,r){var a,s,o,i;a=t.exports,s="default",o=function(){return F},Object.defineProperty(a,s,{get:o,set:i,enumerable:!0,configurable:!0});var n=e("j6uz9"),l=e("26zvD"),p=e("4cIQk"),c=e("ks23W"),d=e("hO0an"),u=e("itGIg"),y=e("lEAUW"),h=e("lq7ZL"),f=e("6TszD"),m=e("1CpCt"),b=e("lHg4e"),g=e("7dRCe"),L=e("hTI69");e("gHCNy");var w,I=e("qA6zg"),v=e("g9601"),_=e("jaaCV"),S=e("39WmQ"),R=e("h7Mrf"),O=e("5AVM7"),x=e("enVEV");let M=0;const A=f.default.getLogger("esri.Basemap");let T=w=class extends((0,d.JSONSupportMixin)(y.default)){initialize(){this.when().catch((e=>{A.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,e)})),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var e;const t=this.baseLayers.removeAll();for(const e of t)e.destroy();const r=this.referenceLayers.removeAll();for(const e of r)e.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),null==(e=this.portalItem)||e.destroy(),this.portalItem=null}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set baseLayers(e){this._set("baseLayers",(0,p.referenceSetter)(e,this._get("baseLayers")))}_writeBaseLayers(e,t,r){const a=[];e?(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach((e=>{const t=(0,x.getLayerJSON)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);(0,m.isSome)(t)&&a.push(t)})),this.referenceLayers.forEach((e=>{const t=(0,x.getLayerJSON)(e,r.webmap?r.webmap.getLayerJSONFromResourceInfo(e):null,r);(0,m.isSome)(t)&&(t.isReference=!0,a.push(t))})),t.baseMapLayers=a):t.baseMapLayers=a}set referenceLayers(e){this._set("referenceLayers",(0,p.referenceSetter)(e,this._get("referenceLayers")))}writeTitle(e,t){t.title=e||"Basemap"}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return(0,h.loadAll)(this,(e=>{e(this.baseLayers,this.referenceLayers)}))}clone(){const e={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(e.loadStatus="loaded"),new w({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}write(e,t){return e=e||{},t&&t.origin||(t={origin:"web-map",...t}),super.write(e,t),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(e.baseMapLayers=this.resourceInfo.data.baseMapLayers.map((e=>{const t=(0,u.clone)(e);return t.url&&(0,g.isProtocolRelative)(t.url)&&(t.url=`https:${t.url}`),t.templateUrl&&(0,g.isProtocolRelative)(t.templateUrl)&&(t.templateUrl=`https:${t.templateUrl}`),t}))),e}async _loadFromSource(e){const{resourceInfo:t,portalItem:r}=this;(0,b.throwIfAborted)(e);const a=[];if(t){const r=t.context?t.context.url:null;if(a.push(this._loadLayersFromJSON(t.data,r,e)),t.data.id&&!t.data.title){const e=t.data.id;a.push((0,O.getBasemapTitle)(e).then((e=>{e&&this.read({title:e},t.context)})))}}else r&&a.push(this._loadFromItem(r,e));await Promise.all(a)}async _loadLayersFromJSON(t,r,a){const s=this.resourceInfo&&this.resourceInfo.context,o=this.portalItem&&this.portalItem.portal||s&&s.portal||null,i=s&&"web-scene"===s.origin?"web-scene":"web-map",{populateOperationalLayers:n}=await e("5aCpR"),l=[];if((0,b.throwIfAborted)(a),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const e={context:{origin:i,url:r,portal:o,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},a=n(this.baseLayers,t.baseMapLayers.filter((e=>!e.isReference)),e);l.push(a);const s=n(this.referenceLayers,t.baseMapLayers.filter((e=>e.isReference)),e);l.push(s)}await(0,b.eachAlways)(l)}async _loadFromItem(e,t){const r=await e.load(t),a=await r.fetchData("json",t),s=(0,g.urlToObject)(e.itemUrl);return this._set("resourceInfo",{data:a.baseMap,context:{origin:"web-map",portal:e.portal||S.default.getDefault(),url:s}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:a.spatialReference},this.resourceInfo.context),this.read({title:e.title,thumbnailUrl:e.thumbnailUrl},{origin:"portal-item",portal:e.portal||S.default.getDefault(),url:s}),this._loadLayersFromJSON(this.resourceInfo.data,s,t)}static fromId(e){const t=O.esriBasemapDefinitions[e];if(t){if(t.deprecated){let t=null;"dark-gray"===e?t="dark-gray-vector":"gray"===e?t="gray-vector":"streets"===e?t="streets-vector":"topo"===e&&(t="topo-vector"),(0,c.deprecated)(A,`The ${e} basemap has entered mature support and is no longer being updated.`,{replacement:t,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return w.fromJSON(t)}return null}constructor(e){super(e),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+M++,this.baseLayers=new(0,l.default),this.referenceLayers=new(0,l.default);const t=e=>{e.parent&&e.parent!==this&&"remove"in e.parent&&e.parent.remove(e),e.parent=this,"elevation"===e.type&&A.error(`Layer '${e.title}, id:${e.id}' of type '${e.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=e=>{e.parent=null};this.baseLayers.on("after-add",(e=>t(e.item))),this.referenceLayers.on("after-add",(e=>t(e.item))),this.baseLayers.on("after-remove",(e=>r(e.item))),this.referenceLayers.on("after-remove",(e=>r(e.item)))}};(0,n._)([(0,L.property)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(e,t,r,a){this._writeBaseLayers(e,t,a)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:l.default}},writer(e,t,r,a){this._writeBaseLayers(e,t,a)}}}}}})],T.prototype,"baseLayers",null),(0,n._)([(0,L.property)({type:String,json:{origins:{"web-scene":{write:!0}}}})],T.prototype,"id",void 0),(0,n._)([(0,L.property)({type:R.default})],T.prototype,"portalItem",void 0),(0,n._)([(0,L.property)()],T.prototype,"referenceLayers",null),(0,n._)([(0,L.property)({readOnly:!0})],T.prototype,"resourceInfo",void 0),(0,n._)([(0,L.property)({type:_.default})],T.prototype,"spatialReference",void 0),(0,n._)([(0,L.property)()],T.prototype,"thumbnailUrl",void 0),(0,n._)([(0,L.property)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],T.prototype,"title",void 0),(0,n._)([(0,v.writer)("title")],T.prototype,"writeTitle",null),T=w=(0,n._)([(0,I.subclass)("esri.Basemap")],T);const F=T})),e.register("5aCpR",(function(t,r){t.exports=import("./"+e("kyEFX").resolve("5lexw")).then((()=>e("gAlR3")))}));
//# sourceMappingURL=Basemap.a4b95e45.js.map
