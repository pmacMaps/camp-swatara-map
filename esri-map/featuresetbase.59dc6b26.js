!function(){function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("5NlMV",(function(r,n){e(r.exports,"registerFunctions",(function(){return _}));var a=t("8TSCy"),l=t("iwIpP"),i=t("3UOnP"),o=t("3TgtC"),u=t("jvSuk"),s=t("c4SkA"),f=t("1xq6U"),c=t("4aVVd"),d=t("e8oaX"),y=t("jeRSU"),h=t("fJC97"),v=t("k1hID"),p=t("6ILB7"),m=t("cHwtI"),g=t("2ANni"),S=t("aZgek"),F=t("9yzf5"),I=t("jA3R1"),w=t("hRH8E"),b=t("10vEZ"),E=t("9AqbE"),A=t("g15Jq"),x=t("buMuJ");function D(e,t,r){var n=e.getVariables();if(n.length>0){for(var a=[],l=0;l<n.length;l++){var i={name:n[l]};a.push(t.evaluateIdentifier(r,i))}return(0,b.all)(a).then((function(t){for(var r={},a=0;a<n.length;a++)r[n[a]]=t[a];return e.parameters=r,e}))}return(0,b.resolve)(e)}function C(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;for(var n in e)if(n.toLowerCase()===t.toLowerCase())return e[n];return r}function N(e){if(null===e)return null;var t={type:C(e,"type",""),name:C(e,"name","")};if("range"===t.type)t.range=C(e,"range",[]);else{t.codedValues=[];var r=!0,n=!1,a=void 0;try{for(var l,i=C(e,"codedValues",[])[Symbol.iterator]();!(r=(l=i.next()).done);r=!0){var o=l.value;t.codedValues.push({name:C(o,"name",""),code:C(o,"code",null)})}}catch(e){n=!0,a=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}}return t}function L(e){if(null===e)return null;var t={},r=C(e,"wkt",null);null!==r&&(t.wkt=r);var n=C(e,"wkid",null);return null!==n&&(t.wkid=n),t}function T(e){if(null===e)return null;var t={hasZ:C(e,"hasz",!1),hasM:C(e,"hasm",!1)},r=C(e,"spatialreference",null);r&&(t.spatialReference=L(r));var n=C(e,"x",null);if(null!==n)return t.x=n,t.y=C(e,"y",null),t;var a=C(e,"rings",null);if(null!==a)return t.rings=a,t;var l=C(e,"paths",null);if(null!==l)return t.paths=l,t;var i=C(e,"points",null);if(null!==i)return t.points=i,t;var o=!0,u=!1,s=void 0;try{for(var f,c=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"][Symbol.iterator]();!(o=(f=c.next()).done);o=!0){var d=f.value,y=C(e,d,null);null!==y&&(t[d]=y)}}catch(e){u=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(u)throw s}}return t}function k(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,t){var r=!0,n=!1,a=void 0;try{for(var l,i=t[Symbol.iterator]();!(r=(l=i.next()).done);r=!0)if(l.value===e)return!0}catch(e){n=!0,a=e}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return!1}(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==(0,d.a)(e.layerDefinition.fields)&&!1!==(0,d.a)(e.featureSet.features)}function _(e){"async"===e.mode&&(e.functions.getuser=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){(0,d.p)(n,1,2);var a=(0,d.C)(n[1],""),o=!0===a;if(a=!0===a||!1===a?"":(0,d.d)(a),n[0]instanceof l.default){var u=null;return t.services&&t.services.portal&&(u=t.services.portal),u=(0,s.getPortal)(n[0],u),(0,s.lookupUser)(u,a,o).then((function(e){if(e){var t=JSON.parse(JSON.stringify(e)),r=!0,n=!1,a=void 0;try{for(var l,o=["lastLogin","created","modified"][Symbol.iterator]();!(r=(l=o.next()).done);r=!0){var u=l.value;void 0!==t[u]&&null!==t[u]&&(t[u]=new Date(t[u]))}}catch(e){n=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw a}}return i.default.convertObjectToArcadeDictionary(t)}return null}))}var f=null;if((0,d.q)(n[0])&&(f=n[0]),f)return o=!1,a?null:f.load().then((function(){return f.getOwningSystemUrl()})).then((function(e){if(!e)return a?null:f.getIdentityUser().then((function(e){return e?i.default.convertObjectToArcadeDictionary({username:e}):null}));var r=null;return t.services&&t.services.portal&&(r=t.services.portal),r=(0,s.getPortal)(new(0,l.default)(e),r),(0,s.lookupUser)(r,a,o).then((function(e){if(e){var t=JSON.parse(JSON.stringify(e)),r=!0,n=!1,a=void 0;try{for(var l,o=["lastLogin","created","modified"][Symbol.iterator]();!(r=(l=o.next()).done);r=!0){var u=l.value;void 0!==t[u]&&null!==t[u]&&(t[u]=new Date(t[u]))}}catch(e){n=!0,a=e}finally{try{r||null==o.return||o.return()}finally{if(n)throw a}}return i.default.convertObjectToArcadeDictionary(t)}return null}))}));throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getuser",min:"1",max:"2"}),e.functions.featuresetbyid=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if((0,d.p)(r,2,4),r[0]instanceof u.default){var n=(0,d.d)(r[1]),a=(0,d.C)(r[2],null),l=(0,d.z)((0,d.C)(r[3],!0));if(null===a&&(a=["*"]),!1===(0,d.a)(a))throw new Error("Invalid Parameter");return r[0].featureSetById(n,l,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.getfeatureset=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){if((0,d.p)(n,1,2),(0,d.k)(n[0])){var a=(0,d.C)(n[1],"datasource");return null===a&&(a="datasource"),a=(0,d.d)(a).toLowerCase(),(0,s.convertToFeatureSet)(n[0].fullSchema(),a,t.lrucache,t.interceptor,t.spatialReference)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getfeatureset",min:"1",max:"2"}),e.functions.featuresetbyportalitem=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){if((0,d.p)(n,2,5),null===n[0])throw new Error("Portal is required");if(n[0]instanceof l.default){var a=(0,d.d)(n[1]),i=(0,d.d)(n[2]),o=(0,d.C)(n[3],null),u=(0,d.z)((0,d.C)(n[4],!0));if(null===o&&(o=["*"]),!1===(0,d.a)(o))throw new Error("Invalid Parameter");var f=null;return t.services&&t.services.portal&&(f=t.services.portal),f=(0,s.getPortal)(n[0],f),(0,s.constructFeatureSetFromPortalItem)(a,i,t.spatialReference,o,u,f,t.lrucache,t.interceptor)}if(!1===(0,d.f)(n[0]))throw new Error("Portal is required");var c=(0,d.d)(n[0]),y=(0,d.d)(n[1]),h=(0,d.C)(n[2],null),v=(0,d.z)((0,d.C)(n[3],!0));if(null===h&&(h=["*"]),!1===(0,d.a)(h))throw new Error("Invalid Parameter");if(t.services&&t.services.portal)return(0,s.constructFeatureSetFromPortalItem)(c,y,t.spatialReference,h,v,t.services.portal,t.lrucache,t.interceptor);throw new Error("Portal is required")}))},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),e.functions.featuresetbyname=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){if((0,d.p)(r,2,4),r[0]instanceof u.default){var n=(0,d.d)(r[1]),a=(0,d.C)(r[2],null),l=(0,d.z)((0,d.C)(r[3],!0));if(null===a&&(a=["*"]),!1===(0,d.a)(a))throw new Error("Invalid Parameter");return r[0].featureSetByName(n,l,a)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(t,r){return e.standardFunction(t,r,(function(e,r,n){(0,d.p)(n,1,1);var a=n[0],l={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,d.f)(a))void 0!==(a=JSON.parse(a)).layerDefinition?(l.layerDefinition=a.layerDefinition,l.featureSet=a.featureSet,a.layerDefinition.spatialReference&&(l.layerDefinition.spatialReference=a.layerDefinition.spatialReference)):(l.featureSet.features=a.features,l.featureSet.geometryType=a.geometryType,l.layerDefinition.geometryType=l.featureSet.geometryType,l.layerDefinition.objectIdField=a.objectIdFieldName,l.layerDefinition.typeIdField=a.typeIdFieldName,l.layerDefinition.globalIdField=a.globalIdFieldName,l.layerDefinition.fields=a.fields,a.spatialReference&&(l.layerDefinition.spatialReference=a.spatialReference));else{if(!(n[0]instanceof i.default))throw new Error("Invalid Parameter");var o=C(a=JSON.parse(n[0].castToText()),"layerdefinition");if(null!==o){l.layerDefinition.geometryType=C(o,"geometrytype",""),l.featureSet.geometryType=l.layerDefinition.geometryType,l.layerDefinition.globalIdField=C(o,"globalidfield",""),l.layerDefinition.objectIdField=C(o,"objectidfield",""),l.layerDefinition.typeIdField=C(o,"typeidfield","");var u=C(o,"spatialreference",null);u&&(l.layerDefinition.spatialReference=L(u));var s=!0,f=!1,c=void 0;try{for(var y,h=C(o,"fields",[])[Symbol.iterator]();!(s=(y=h.next()).done);s=!0){var v=y.value,p={name:C(v,"name",""),alias:C(v,"alias",""),type:C(v,"type",""),nullable:C(v,"nullable",!0),editable:C(v,"editable",!0),length:C(v,"length",null),domain:N(C(v,"domain"))};l.layerDefinition.fields.push(p)}}catch(e){f=!0,c=e}finally{try{s||null==h.return||h.return()}finally{if(f)throw c}}var m=C(a,"featureset",null);if(m){var S={},F=!0,I=!1,w=void 0;try{for(var b,E=l.layerDefinition.fields[Symbol.iterator]();!(F=(b=E.next()).done);F=!0){var A=b.value;S[A.name.toLowerCase()]=A.name}}catch(e){I=!0,w=e}finally{try{F||null==E.return||E.return()}finally{if(I)throw w}}var x=!0,D=!1,_=void 0;try{for(var O,R=C(m,"features",[])[Symbol.iterator]();!(x=(O=R.next()).done);x=!0){var P=O.value,j={},M=C(P,"attributes",{});for(var q in M)j[S[q.toLowerCase()]]=M[q];l.featureSet.features.push({attributes:j,geometry:T(C(P,"geometry",null))})}}catch(e){D=!0,_=e}finally{try{x||null==R.return||R.return()}finally{if(D)throw _}}}}else{l.layerDefinition.geometryType=C(a,"geometrytype",""),l.featureSet.geometryType=l.layerDefinition.geometryType,l.layerDefinition.objectIdField=C(a,"objectidfieldname",""),l.layerDefinition.typeIdField=C(a,"typeidfieldname","");var G=C(a,"spatialreference",null);G&&(l.layerDefinition.spatialReference=L(G));var B=!0,V=!1,W=void 0;try{for(var z,U=C(a,"fields",[])[Symbol.iterator]();!(B=(z=U.next()).done);B=!0){var J=z.value,H={name:C(J,"name",""),alias:C(J,"alias",""),type:C(J,"type",""),nullable:C(J,"nullable",!0),editable:C(J,"editable",!0),length:C(J,"length",null),domain:N(C(J,"domain"))};l.layerDefinition.fields.push(H)}}catch(e){V=!0,W=e}finally{try{B||null==U.return||U.return()}finally{if(V)throw W}}var K={},Y=!0,Z=!1,Q=void 0;try{for(var X,$=l.layerDefinition.fields[Symbol.iterator]();!(Y=(X=$.next()).done);Y=!0){var ee=X.value;K[ee.name.toLowerCase()]=ee.name}}catch(e){Z=!0,Q=e}finally{try{Y||null==$.return||$.return()}finally{if(Z)throw Q}}var te=!0,re=!1,ne=void 0;try{for(var ae,le=C(a,"features",[])[Symbol.iterator]();!(te=(ae=le.next()).done);te=!0){var ie=ae.value,oe={},ue=C(ie,"attributes",{});for(var se in ue)oe[K[se.toLowerCase()]]=ue[se];l.featureSet.features.push({attributes:oe,geometry:T(C(ie,"geometry",null))})}}catch(e){re=!0,ne=e}finally{try{te||null==le.return||le.return()}finally{if(re)throw ne}}}}if(!1===k(l))throw new Error("Invalid Parameter");return g.default.create(l,t.spatialReference)}))},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,l){if((0,d.p)(l,2,2),(0,d.a)(l[0])||(0,d.b)(l[0])){var i=[],o=l[0];o instanceof c.default&&(o=o.toArray());var u=null;if(l[1]instanceof f.default)u=e.arcadeCustomFunctionHandler(l[1]);else if(l[1]instanceof d.N)u=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return l[1].fn(t,{preparsed:!0,arguments:r})};else{if(!(l[1]instanceof d.S))throw new Error("Invalid Parameter");u=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;if(t.length!==l[1].paramCount)throw new Error("Invalid parameters");return(n=l[1]).fn.apply(n,a.toConsumableArray(t))}}return o.reduce((function(e,t,r){return e.then((function(e){r>0&&!0===e&&i.push(o[r-1]);var n=u(t);return(0,b.isPromiseLike)(n)?n:(0,b.resolve)(n)}))}),Promise.resolve(!1)).then((function(e){return!0===e&&o.length>0&&i.push(o[o.length-1]),i}))}return(0,d.q)(l[0])?l[0].load().then((function(r){var n=E.WhereClause.create(l[1],r.getFieldsIndex()),a=n.getVariables();if(a.length>0){for(var i=[],o=0;o<a.length;o++){var u={name:a[o]};i.push(e.evaluateIdentifier(t,u))}return(0,b.all)(i).then((function(e){for(var t={},r=0;r<a.length;r++)t[a[r]]=e[r];return n.parameters=t,new(0,h.default)({parentfeatureset:l[0],whereclause:n})}))}return(0,b.resolve)(new(0,h.default)({parentfeatureset:l[0],whereclause:n}))})):e.failDefferred("Filter cannot accept this parameter type")}))},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(t,r){return e.standardFunctionAsync(t,r,(function(t,r,n){if((0,d.p)(n,2,2),(0,d.q)(n[0])){var a=new(0,S.default)(n[1]);return(0,b.resolve)(new(0,v.default)({parentfeatureset:n[0],orderbyclause:a}))}return e.failDefferred("Order cannot accept this parameter type")}))},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(t,r){return e.standardFunctionAsync(t,r,(function(t,r,n){return(0,d.p)(n,2,2),(0,d.q)(n[0])?(0,b.resolve)(new(0,p.default)({parentfeatureset:n[0],topnum:n[1]})):(0,d.a)(n[0])?(0,d.t)(n[1])>=n[0].length?n[0].slice(0):n[0].slice(0,(0,d.t)(n[1])):(0,d.b)(n[0])?(0,d.t)(n[1])>=n[0].length()?n[0].slice(0):n[0].slice(0,(0,d.t)(n[1])):e.failDefferred("Top cannot accept this parameter type")}))},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(t,r){return e.standardFunctionAsync(t,r,(function(e,t,r){return(0,d.p)(r,1,1),(0,d.q)(r[0])?r[0].first(e.abortSignal).then((function(e){if(null!==e){var t=o.default.createFromGraphicLikeObject(e.geometry,e.attributes,r[0]);t._underlyingGraphic=e,e=t}return e})):(0,d.a)(r[0])?0===r[0].length?(0,b.resolve)(null):(0,b.resolve)(r[0][0]):(0,d.b)(r[0])?0===r[0].length()?(0,b.resolve)(null):(0,b.resolve)(r[0].get(0)):null}))},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){(0,d.p)(n,1,2);var a={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(n.length>1)if(n[1]instanceof i.default){if(n[1].hasField("minsize")&&(a.minsize=(0,d.t)(n[1].field("minsize"))),n[1].hasField("metadata")&&(a.returnMetadata=(0,d.z)(n[1].field("metadata"))),n[1].hasField("maxsize")&&(a.maxsize=(0,d.t)(n[1].field("maxsize"))),n[1].hasField("types")){var l=(0,d.Y)(n[1].field("types"),!1);l.length>0&&(a.types=l)}}else if(null!==n[1])throw new Error("Invalid Parameter");if((0,d.k)(n[0])){var o=n[0]._layer;return o instanceof A.default&&(o=(0,s.constructFeatureSet)(o,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===o||!1===(0,d.q)(o)?[]:o.load().then((function(){return o.queryAttachments(n[0].field(o.objectIdField),a.minsize,a.maxsize,a.types,a.returnMetadata)}))}if(null===n[0])return[];throw new Error("Invalid Parameter")}))},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationshipname=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){(0,d.p)(n,2,4);var a=n[0],l=(0,d.d)(n[1]),i=(0,d.C)(n[2],null),o=(0,d.z)((0,d.C)(n[3],!0));if(null===i&&(i=["*"]),!1===(0,d.a)(i))throw new Error("Invalid Parameter");if(null===n[0])return null;if(!(0,d.k)(n[0]))throw new Error("Invalid Parameter");var u=a._layer;return u instanceof A.default&&(u=(0,s.constructFeatureSet)(u,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===u||!1===(0,d.q)(u)?null:u.load().then((function(e){var r=e.relationshipMetaData().filter((function(e){return e.name===l}));if(0===r.length)return null;if(void 0!==r[0].relationshipTableId&&null!==r[0].relationshipTableId&&r[0].relationshipTableId>-1)return(0,s.constructFeatureSetFromRelationship)(e,r[0],a.field(e.objectIdField),e.spatialReference,i,o,t.lrucache,t.interceptor);var n=e.serviceUrl();return n?(n="/"===n.charAt(n.length-1)?n+r[0].relatedTableId.toString():n+"/"+r[0].relatedTableId.toString(),(0,s.constructFeatureSetFromUrl)(n,e.spatialReference,i,o,t.lrucache,t.interceptor).then((function(t){return t.load().then((function(){return t.relationshipMetaData()})).then((function(n){if(n=n.filter((function(e){return e.id===r[0].id})),!1===a.hasField(r[0].keyField)||null===a.field(r[0].keyField))return e.getFeatureByObjectId(a.field(e.objectIdField),[r[0].keyField]).then((function(e){if(e){var a=E.WhereClause.create(n[0].keyField+"= @id",t.getFieldsIndex());return a.parameters={id:e.attributes[r[0].keyField]},t.filter(a)}return new(0,m.default)({parentfeatureset:t})}));var l=E.WhereClause.create(n[0].keyField+"= @id",t.getFieldsIndex());return l.parameters={id:a.field(r[0].keyField)},t.filter(l)}))}))):null}))}))},e.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),e.functions.featuresetbyassociation=function(t,r){return e.standardFunctionAsync(t,r,(function(e,r,n){(0,d.p)(n,2,3);var a=n[0],l=(0,d.d)((0,d.C)(n[1],"")).toLowerCase(),i=(0,d.f)(n[2])?(0,d.d)(n[2]):null;if(null===n[0])return null;if(!(0,d.k)(n[0]))throw new Error("Invalid Parameter");var o=a._layer;return o instanceof A.default&&(o=(0,s.constructFeatureSet)(o,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===o||!1===(0,d.q)(o)?null:o.load().then((function(){var e=o.serviceUrl();return(0,s.constructAssociationMetaDataFeatureSetFromUrl)(e,t.spatialReference)})).then((function(e){var t=null,r=null,n=!1;if(null!==i&&""!==i&&void 0!==i){var u=!0,s=!1,f=void 0;try{for(var c,h=e.terminals[Symbol.iterator]();!(u=(c=h.next()).done);u=!0){var v=c.value;v.terminalName===i&&(r=v.terminalId)}}catch(e){s=!0,f=e}finally{try{u||null==h.return||h.return()}finally{if(s)throw f}}null===r&&(n=!0)}var p=e.associations.getFieldsIndex(),m=p.get("TOGLOBALID").name,g=p.get("FROMGLOBALID").name,S=p.get("TOTERMINALID").name,I=p.get("FROMTERMINALID").name,w=p.get("FROMNETWORKSOURCEID").name,b=p.get("TONETWORKSOURCEID").name,A=p.get("ASSOCIATIONTYPE").name,D=p.get("ISCONTENTVISIBLE").name,C=p.get("OBJECTID").name,N=!0,L=!1,T=void 0;try{for(var k,_=o.fields[Symbol.iterator]();!(N=(k=_.next()).done);N=!0){var O=k.value;if("global-id"===O.type){t=a.field(O.name);break}}}catch(e){L=!0,T=e}finally{try{N||null==_.return||_.return()}finally{if(L)throw T}}var R=null,P=new(0,y.SqlExpressionAdapted)(new(0,x.default)({name:"percentalong",alias:"percentalong",type:"double"}),E.WhereClause.create("0",e.associations.getFieldsIndex())),j=new(0,y.SqlExpressionAdapted)(new(0,x.default)({name:"side",alias:"side",type:"string"}),E.WhereClause.create("''",e.associations.getFieldsIndex())),M="globalid",q="globalId",G={};for(var B in e.lkp)G[B]=e.lkp[B].sourceId;var V=new(0,y.StringToCodeAdapted)(new(0,x.default)({name:"classname",alias:"classname",type:"string"}),null,G),W="";switch(l){case"midspan":W="((".concat(m,"='").concat(t,"') OR ( ").concat(g,"='").concat(t,"')) AND (").concat(A," IN (5))"),V.codefield=E.WhereClause.create("CASE WHEN (".concat(m,"='").concat(t,"') THEN ").concat(w," ELSE ").concat(b," END"),e.associations.getFieldsIndex());var z=(0,F.cloneField)(y.AdaptedFeatureSet.findField(e.associations.fields,g));z.name=M,z.alias=M,R=new(0,y.SqlExpressionAdapted)(z,E.WhereClause.create("CASE WHEN (".concat(g,"='").concat(t,"') THEN ").concat(m," ELSE ").concat(g," END"),e.associations.getFieldsIndex())),P=e.unVersion>=4?new(0,y.OriginalField)(y.AdaptedFeatureSet.findField(e.associations.fields,p.get("PERCENTALONG").name)):new(0,y.SqlExpressionAdapted)(new(0,x.default)({name:"percentalong",alias:"percentalong",type:"double"}),E.WhereClause.create("0",e.associations.getFieldsIndex()));break;case"junctionedge":W="((".concat(m,"='").concat(t,"') OR ( ").concat(g,"='").concat(t,"')) AND (").concat(A," IN (4,6))"),V.codefield=E.WhereClause.create("CASE WHEN (".concat(m,"='").concat(t,"') THEN ").concat(w," ELSE ").concat(b," END"),e.associations.getFieldsIndex());var U=(0,F.cloneField)(y.AdaptedFeatureSet.findField(e.associations.fields,g));U.name=M,U.alias=M,R=new(0,y.SqlExpressionAdapted)(U,E.WhereClause.create("CASE WHEN (".concat(g,"='").concat(t,"') THEN ").concat(m," ELSE ").concat(g," END"),e.associations.getFieldsIndex())),j=new(0,y.SqlExpressionAdapted)(new(0,x.default)({name:"side",alias:"side",type:"string"}),E.WhereClause.create("CASE WHEN (".concat(A,"=4) THEN 'from' ELSE 'to' END"),e.associations.getFieldsIndex()));break;case"connected":var J="".concat(m,"='@T'"),H="".concat(g,"='@T'");null!==r&&(J+=" AND ".concat(S,"=@A"),H+=" AND ".concat(I,"=@A")),W="(("+J+") OR ("+H+"))",W=(0,d.M)(W,"@T",t),J=(0,d.M)(J,"@T",t),null!==r&&(J=(0,d.M)(J,"@A",r.toString()),W=(0,d.M)(W,"@A",r.toString())),V.codefield=E.WhereClause.create("CASE WHEN "+J+" THEN ".concat(w," ELSE ").concat(b," END"),e.associations.getFieldsIndex());var K=(0,F.cloneField)(y.AdaptedFeatureSet.findField(e.associations.fields,g));K.name=M,K.alias=M,R=new(0,y.SqlExpressionAdapted)(K,E.WhereClause.create("CASE WHEN "+J+" THEN ".concat(g," ELSE ").concat(m," END"),e.associations.getFieldsIndex()));break;case"container":W="".concat(m,"='").concat(t,"' AND ").concat(A," = 2"),null!==r&&(W+=" AND ".concat(S," = ")+r.toString()),V.codefield=w,W="( "+W+" )",R=new(0,y.FieldRename)(y.AdaptedFeatureSet.findField(e.associations.fields,g),M,M);case"content":W="(".concat(g,"='").concat(t,"' AND ").concat(A," = 2)"),null!==r&&(W+=" AND ".concat(I," = ")+r.toString()),V.codefield=b,W="( "+W+" )",R=new(0,y.FieldRename)(y.AdaptedFeatureSet.findField(e.associations.fields,m),M,M);break;case"structure":W="(".concat(m,"='").concat(t,"' AND ").concat(A," = 3)"),null!==r&&(W+=" AND ".concat(S," = ")+r.toString()),V.codefield=w,W="( "+W+" )",R=new(0,y.FieldRename)(y.AdaptedFeatureSet.findField(e.associations.fields,g),M,q);break;case"attached":W="(".concat(g,"='").concat(t,"' AND ").concat(A," = 3)"),null!==r&&(W+=" AND ".concat(I," = ")+r.toString()),V.codefield=b,W="( "+W+" )",R=new(0,y.FieldRename)(y.AdaptedFeatureSet.findField(e.associations.fields,m),M,q);break;default:throw new Error("Invalid Parameter")}return n&&(W="1 <> 1"),new(0,y.AdaptedFeatureSet)({parentfeatureset:e.associations,adaptedFields:[new(0,y.OriginalField)(y.AdaptedFeatureSet.findField(e.associations.fields,C)),new(0,y.OriginalField)(y.AdaptedFeatureSet.findField(e.associations.fields,D)),R,j,V,P],extraFilter:W?E.WhereClause.create(W,e.associations.getFieldsIndex()):null})}))}))},e.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),e.functions.groupby=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,a){return(0,d.p)(a,3,3),(0,d.q)(a[0])?a[0].load().then((function(r){var n=[],l=[],o=!1,u=[];if((0,d.f)(a[1]))u.push(a[1]);else if(a[1]instanceof i.default)u.push(a[1]);else if((0,d.a)(a[1]))u=a[1];else{if(!(0,d.b)(a[1]))return e.failDefferred("Illegal Value: GroupBy");u=a[1].toArray()}var s=!0,f=!1,c=void 0;try{for(var y,h=u[Symbol.iterator]();!(s=(y=h.next()).done);s=!0){var v=y.value;if((0,d.f)(v)){var p=E.WhereClause.create((0,d.d)(v),r.getFieldsIndex()),m=!0===(0,I.isSingleField)(p)?(0,d.d)(v):"%%%%FIELDNAME";n.push({name:m,expression:p}),"%%%%FIELDNAME"===m&&(o=!0)}else{if(!(v instanceof i.default))return e.failDefferred("Illegal Value: GroupBy");var g=v.hasField("name")?v.field("name"):"%%%%FIELDNAME",S=v.hasField("expression")?v.field("expression"):"";if("%%%%FIELDNAME"===g&&(o=!0),!g)return e.failDefferred("Illegal Value: GroupBy");n.push({name:g,expression:E.WhereClause.create(S||g,r.getFieldsIndex())})}}}catch(e){f=!0,c=e}finally{try{s||null==h.return||h.return()}finally{if(f)throw c}}if(u=[],(0,d.f)(a[2]))u.push(a[2]);else if((0,d.a)(a[2]))u=a[2];else if((0,d.b)(a[2]))u=a[2].toArray();else{if(!(a[2]instanceof i.default))return e.failDefferred("Illegal Value: GroupBy");u.push(a[2])}var F=!0,w=!1,A=void 0;try{for(var x,C=u[Symbol.iterator]();!(F=(x=C.next()).done);F=!0){var N=x.value;if(!(N instanceof i.default))return e.failDefferred("Illegal Value: GroupBy");var L=N.hasField("name")?N.field("name"):"",T=N.hasField("statistic")?N.field("statistic"):"",k=N.hasField("expression")?N.field("expression"):"";if(!L||!T||!k)return e.failDefferred("Illegal Value: GroupBy");l.push({name:L,statistic:T.toLowerCase(),expression:E.WhereClause.create(k,r.getFieldsIndex())})}}catch(e){w=!0,A=e}finally{try{F||null==C.return||C.return()}finally{if(w)throw A}}if(o){var _={},O=!0,R=!1,P=void 0;try{for(var j,M=r.fields[Symbol.iterator]();!(O=(j=M.next()).done);O=!0){_[j.value.name.toLowerCase()]=1}}catch(e){R=!0,P=e}finally{try{O||null==M.return||M.return()}finally{if(R)throw P}}var q=!0,G=!1,B=void 0;try{for(var V,W=n[Symbol.iterator]();!(q=(V=W.next()).done);q=!0){var z=V.value;"%%%%FIELDNAME"!==z.name&&(_[z.name.toLowerCase()]=1)}}catch(e){G=!0,B=e}finally{try{q||null==W.return||W.return()}finally{if(G)throw B}}var U=!0,J=!1,H=void 0;try{for(var K,Y=l[Symbol.iterator]();!(U=(K=Y.next()).done);U=!0){var Z=K.value;"%%%%FIELDNAME"!==Z.name&&(_[Z.name.toLowerCase()]=1)}}catch(e){J=!0,H=e}finally{try{U||null==Y.return||Y.return()}finally{if(J)throw H}}var Q=0,X=!0,$=!1,ee=void 0;try{for(var te,re=n[Symbol.iterator]();!(X=(te=re.next()).done);X=!0){var ne=te.value;if("%%%%FIELDNAME"===ne.name){for(;1===_["field_"+Q.toString()];)Q++;_["field_"+Q.toString()]=1,ne.name="FIELD_"+Q.toString()}}}catch(e){$=!0,ee=e}finally{try{X||null==re.return||re.return()}finally{if($)throw ee}}}var ae=[],le=!0,ie=!1,oe=void 0;try{for(var ue,se=n[Symbol.iterator]();!(le=(ue=se.next()).done);le=!0){var fe=ue.value;ae.push(D(fe.expression,e,t))}}catch(e){ie=!0,oe=e}finally{try{le||null==se.return||se.return()}finally{if(ie)throw oe}}var ce=!0,de=!1,ye=void 0;try{for(var he,ve=l[Symbol.iterator]();!(ce=(he=ve.next()).done);ce=!0){var pe=he.value;ae.push(D(pe.expression,e,t))}}catch(e){de=!0,ye=e}finally{try{ce||null==ve.return||ve.return()}finally{if(de)throw ye}}return ae.length>0?(0,b.all)(ae).then((function(){return(0,b.resolve)(a[0].groupby(n,l))})):(0,b.resolve)(a[0].groupby(n,l))})):e.failDefferred("Illegal Value: GroupBy")}))},e.signatures.push({name:"groupby",min:"3",max:"3"}),e.functions.distinct=function(t,r){return e.standardFunctionAsync(t,r,(function(r,n,a){return(0,d.q)(a[0])?((0,d.p)(a,2,2),a[0].load().then((function(r){var n=[],l=[];if((0,d.f)(a[1]))l.push(a[1]);else if(a[1]instanceof i.default)l.push(a[1]);else if((0,d.a)(a[1]))l=a[1];else{if(!(0,d.b)(a[1]))return e.failDefferred("Illegal Value: GroupBy");l=a[1].toArray()}var o=!1,u=!0,s=!1,f=void 0;try{for(var c,y=l[Symbol.iterator]();!(u=(c=y.next()).done);u=!0){var h=c.value;if((0,d.f)(h)){var v=E.WhereClause.create((0,d.d)(h),r.getFieldsIndex()),p=!0===(0,I.isSingleField)(v)?(0,d.d)(h):"%%%%FIELDNAME";n.push({name:p,expression:v}),"%%%%FIELDNAME"===p&&(o=!0)}else{if(!(h instanceof i.default))return e.failDefferred("Illegal Value: GroupBy");var m=h.hasField("name")?h.field("name"):"%%%%FIELDNAME",g=h.hasField("expression")?h.field("expression"):"";if("%%%%FIELDNAME"===m&&(o=!0),!m)return e.failDefferred("Illegal Value: GroupBy");n.push({name:m,expression:E.WhereClause.create(g||m,r.getFieldsIndex())})}}}catch(e){s=!0,f=e}finally{try{u||null==y.return||y.return()}finally{if(s)throw f}}if(o){var S={},F=!0,w=!1,A=void 0;try{for(var x,C=r.fields[Symbol.iterator]();!(F=(x=C.next()).done);F=!0){S[x.value.name.toLowerCase()]=1}}catch(e){w=!0,A=e}finally{try{F||null==C.return||C.return()}finally{if(w)throw A}}var N=!0,L=!1,T=void 0;try{for(var k,_=n[Symbol.iterator]();!(N=(k=_.next()).done);N=!0){var O=k.value;"%%%%FIELDNAME"!==O.name&&(S[O.name.toLowerCase()]=1)}}catch(e){L=!0,T=e}finally{try{N||null==_.return||_.return()}finally{if(L)throw T}}var R=0,P=!0,j=!1,M=void 0;try{for(var q,G=n[Symbol.iterator]();!(P=(q=G.next()).done);P=!0){var B=q.value;if("%%%%FIELDNAME"===B.name){for(;1===S["field_"+R.toString()];)R++;S["field_"+R.toString()]=1,B.name="FIELD_"+R.toString()}}}catch(e){j=!0,M=e}finally{try{P||null==G.return||G.return()}finally{if(j)throw M}}}var V=[],W=!0,z=!1,U=void 0;try{for(var J,H=n[Symbol.iterator]();!(W=(J=H.next()).done);W=!0){var K=J.value;V.push(D(K.expression,e,t))}}catch(e){z=!0,U=e}finally{try{W||null==H.return||H.return()}finally{if(z)throw U}}return V.length>0?(0,b.all)(V).then((function(){return(0,b.resolve)(a[0].groupby(n,[]))})):(0,b.resolve)(a[0].groupby(n,[]))}))):function(e,t,r,n){if(1===n.length){if((0,d.a)(n[0]))return(0,w.calculateStat)(e,n[0],-1);if((0,d.b)(n[0]))return(0,w.calculateStat)(e,n[0].toArray(),-1)}return(0,w.calculateStat)(e,n,-1)}("distinct",0,0,a)}))})}})),t.register("c4SkA",(function(r,n){e(r.exports,"initialiseMetaDataCache",(function(){return E})),e(r.exports,"constructFeatureSetFromUrl",(function(){return x})),e(r.exports,"constructFeatureSet",(function(){return D})),e(r.exports,"constructAssociationMetaDataFeatureSetFromUrl",(function(){return N})),e(r.exports,"constructFeatureSetFromRelationship",(function(){return L})),e(r.exports,"createFeatureSetCollectionFromMap",(function(){return _})),e(r.exports,"createFeatureSetCollectionFromService",(function(){return O})),e(r.exports,"getPortal",(function(){return R})),e(r.exports,"lookupUser",(function(){return P})),e(r.exports,"convertToFeatureSet",(function(){return j})),e(r.exports,"constructFeatureSetFromPortalItem",(function(){return M}));var a=t("8TSCy"),l=t("dLARP"),i=t("9pNSx"),o=t("jvSuk"),u=t("fJC97"),s=t("bILeR"),f=t("k1hID"),c=t("bfO0j"),d=t("6ILB7"),y=t("9eCQE"),h=t("2ANni"),v=t("fqkMK"),p=t("gwuml"),m=t("ct6g2"),g=t("9yzf5"),S=t("10vEZ"),F=t("9AqbE"),I=t("g15Jq"),w=t("ajJOT"),b=t("iYaGG");function E(){null===p.default.applicationCache&&(p.default.applicationCache=new(0,p.default))}function A(e,t){if(p.default.applicationCache){var r=p.default.applicationCache.getLayerInfo(e);if(r)return r.then((function(r){return(0,S.resolve)(new(0,I.default)({url:e,outFields:t,sourceJSON:r}))}));var n=new(0,I.default)({url:e,outFields:t}),a=(0,S.create)((function(e,t){n.load().then((function(){e(n.sourceJSON)}),(function(e){t(e)}))}));return p.default.applicationCache&&(p.default.applicationCache.setLayerInfo(e,a),a=a.catch((function(t){throw p.default.applicationCache.clearLayerInfo(e),t}))),a.then((function(){return(0,S.resolve)(n)}))}return(0,S.resolve)(new(0,I.default)({url:e,outFields:t}))}function x(e,t,r,n,a){var l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return A(e,["*"]).then((function(e){return(0,S.resolve)(D(e,t,r,n,a,l))}))}function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return!0===e._hasMemorySource()?new(0,h.default)({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a,interceptor:l}):new(0,y.default)({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a,interceptor:l})}function C(e){if(null!==p.default.applicationCache){var t=p.default.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=(0,i.default)(e,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),(0,S.resolve)(t)}return(0,S.resolve)({layers:[],tables:[]})}));return null!==p.default.applicationCache&&(p.default.applicationCache.setLayerInfo(e,r),r=r.catch((function(t){throw p.default.applicationCache.clearLayerInfo(e),t}))),r}function N(e,t){var r={metadata:null,networkId:-1,unVersion:3,terminals:[],queryelem:null,layerNameLkp:{},lkp:null};return C(e).then((function(n){if(r.metadata=n,n.controllerDatasetLayers&&void 0!==n.controllerDatasetLayers.utilityNetworkLayerId&&null!==n.controllerDatasetLayers.utilityNetworkLayerId){var l=!0,o=!1,u=void 0;if(n.layers)try{for(var s,f=n.layers[Symbol.iterator]();!(l=(s=f.next()).done);l=!0){var c=s.value;r.layerNameLkp[c.id]=c.name}}catch(e){o=!0,u=e}finally{try{l||null==f.return||f.return()}finally{if(o)throw u}}var d=!0,y=!1,h=void 0;if(n.tables)try{for(var v,m=n.tables[Symbol.iterator]();!(d=(v=m.next()).done);d=!0){var g=v.value;r.layerNameLkp[g.id]=g.name}}catch(e){y=!0,h=e}finally{try{d||null==m.return||m.return()}finally{if(y)throw h}}var I=n.controllerDatasetLayers.utilityNetworkLayerId;return r.networkId=I,function(e,t){var r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==p.default.applicationCache){var n=p.default.applicationCache.getLayerInfo(r);if(null!==n)return n}var a=(0,i.default)(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then((function(e){if(e.data){var t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")}));return null!==p.default.applicationCache&&(p.default.applicationCache.setLayerInfo(r,a),a=a.catch((function(e){throw p.default.applicationCache.clearLayerInfo(r),e}))),a}(e,I).then((function(n){if(n){r.queryelem=n,r.queryelem&&r.queryelem.dataElement&&void 0!==r.queryelem.dataElement.schemaGeneration&&(r.unVersion=r.queryelem.dataElement.schemaGeneration),r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);var l=!0,o=!1,u=void 0;try{for(var s,f=r.queryelem.dataElement.domainNetworks[Symbol.iterator]();!(l=(s=f.next()).done);l=!0){var c=s.value,d=!0,y=!1,h=void 0;try{for(var v,m=(c.edgeSources?c.edgeSources:[])[Symbol.iterator]();!(d=(v=m.next()).done);d=!0){var g=v.value,w={layerId:g.layerId,sourceId:g.sourceId,className:r.layerNameLkp[g.layerId]?r.layerNameLkp[g.layerId]:null};w.className&&(r.lkp[w.className]=w)}}catch(e){y=!0,h=e}finally{try{d||null==m.return||m.return()}finally{if(y)throw h}}var b=!0,E=!1,A=void 0;try{for(var D,C=(c.junctionSources?c.junctionSources:[])[Symbol.iterator]();!(b=(D=C.next()).done);b=!0){var N=D.value,L={layerId:N.layerId,sourceId:N.sourceId,className:r.layerNameLkp[N.layerId]?r.layerNameLkp[N.layerId]:null};L.className&&(r.lkp[L.className]=L)}}catch(e){E=!0,A=e}finally{try{b||null==C.return||C.return()}finally{if(E)throw A}}}}catch(e){o=!0,u=e}finally{try{l||null==f.return||f.return()}finally{if(o)throw u}}var T=!0,k=!1,_=void 0,O=!0,R=!1,P=void 0;if(r.queryelem.dataElement.terminalConfigurations)try{for(var j,M=r.queryelem.dataElement.terminalConfigurations[Symbol.iterator]();!(O=(j=M.next()).done);O=!0){var q=j.value;try{for(var G,B=q.terminals[Symbol.iterator]();!(T=(G=B.next()).done);T=!0){var V=G.value;r.terminals.push({terminalId:V.terminalId,terminalName:V.terminalName})}}catch(e){k=!0,_=e}finally{try{T||null==B.return||B.return()}finally{if(k)throw _}}}}catch(e){R=!0,P=e}finally{try{O||null==M.return||M.return()}finally{if(R)throw P}}return function(e){if(null!==p.default.applicationCache){var t=p.default.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=(0,i.default)(e,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return(0,S.resolve)(t)}return(0,S.resolve)(null)}));return null!==p.default.applicationCache&&(p.default.applicationCache.setLayerInfo(e,r),r=r.catch((function(t){throw p.default.applicationCache.clearLayerInfo(e),t}))),r}(e+"/"+I).then((function(n){if(n.systemLayers&&void 0!==n.systemLayers.associationsTableId&&null!==n.systemLayers.associationsTableId){var l=[];return r.unVersion>=4&&(l.push("STATUS"),l.push("PERCENTALONG")),x(e+"/"+n.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID"].concat(a.toConsumableArray(l)),!1,null,null).then((function(e){return e.load()})).then((function(e){return r.unVersion>=4?(e=e.filter(F.WhereClause.create("STATUS NOT IN (1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 17, 18, 19, 20, 21, 22, 23, 25, 26, 27, 28, 29, 30, 31, 33, 34, 35, 36, 37, 38, 39, 41, 42, 43, 44, 45, 46, 47, 49, 50, 51, 52, 53, 54, 55, 57, 58, 59, 60, 61, 62,63)",e.getFieldsIndex()))).load():e})).then((function(e){return{lkp:r.lkp,associations:e,unVersion:r.unVersion,terminals:r.terminals}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}return{associations:null,unVersion:r.unVersion,lkp:null,terminals:[]}}))}function L(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=e.serviceUrl();return u?x(u="/"===u.charAt(u.length-1)?u+t.relatedTableId.toString():u+"/"+t.relatedTableId.toString(),n,a,l,i,o).then((function(u){return new(0,v.default)({layer:e,relatedLayer:u,relationship:t,objectId:r,spatialReference:n,outFields:a,includeGeometry:l,lrucache:i,interceptor:o})})):null}u.default.registerAction(),s.default.registerAction(),f.default.registerAction(),c.default.registerAction(),d.default.registerAction();var T=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(e){var n,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return a.classCallCheck(this,r),(n=t.call(this))._map=e,n._overridespref=l,n.lrucache=i,n.interceptor=o,n._instantLayers=[],a.possibleConstructorReturn(n)}return a.createClass(r,[{key:"_makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=D(e,this._overridespref,null===r?["*"]:r,t,this.lrucache,this.interceptor);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}},{key:"featureSetByName",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this;if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((function(){try{return n.featureSetByName(e,t,r)}catch(e){return(0,S.reject)(e)}}));null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var l=JSON.stringify(r),i=0;i<this._instantLayers.length;i++){var o=this._instantLayers[i];if(o.opitem.title===e&&o.includeGeometry===t&&o.outFields===l)return this.resolvePromise(this._instantLayers[i].featureset)}var u=this._map.allLayers.find((function(t){return t instanceof I.default&&t.title===e}));if(u)return this.resolvePromise(this._makeAndAddFeatureSet(u,t,r));if(this._map.tables){var s=this._map.tables.find((function(t){return!!(t.title&&t.title===e||t.title&&t.title===e)}));if(s){var f=this;if(s instanceof I.default)return this.resolvePromise(this._makeAndAddFeatureSet(s,t,r));if(s._materializedTable);else{var c=s.outFields?s:a.objectSpread({},s,{outFields:["*"]});s._materializedTable=new(0,I.default)(c)}return s._materializedTable.load().then((function(){return f.resolvePromise(f._makeAndAddFeatureSet(s._materializedTable,t,r))}))}}return this.resolvePromise(null)}},{key:"featureSetById",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["*"],n=this;if(void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then((function(){try{return n.featureSetById(e,t,r)}catch(e){return(0,S.reject)(e)}}));null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var l=JSON.stringify(r),i=0;i<this._instantLayers.length;i++){var o=this._instantLayers[i];if(o.opitem.id===e&&o.includeGeometry===t&&o.outFields===l)return this.resolvePromise(this._instantLayers[i].featureset)}var u=this._map.allLayers.find((function(t){return t instanceof I.default&&t.id===e}));if(u)return this.resolvePromise(this._makeAndAddFeatureSet(u,t,r));if(this._map.tables){var s=this._map.tables.find((function(t){return t.id===e}));if(s){var f=this;if(s instanceof I.default)return this.resolvePromise(this._makeAndAddFeatureSet(s,t,r));if(s._materializedTable);else{var c=a.objectSpread({},s,{outFields:["*"]});s._materializedTable=new(0,I.default)(c)}return s._materializedTable.load().then((function(){return f.resolvePromise(f._makeAndAddFeatureSet(s._materializedTable,t,r))}))}}return this.resolvePromise(null)}}]),r}(o.default),k=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(e){var n,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return a.classCallCheck(this,r),(n=t.call(this))._url=e,n._overridespref=l,n.lrucache=i,n.interceptor=o,n.metadata=null,n._instantLayers=[],a.possibleConstructorReturn(n)}return a.createClass(r,[{key:"url",get:function(){return this._url}},{key:"_makeAndAddFeatureSet",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=D(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n}},{key:"_loadMetaData",value:function(){var e=this;return C(this._url).then((function(t){return e.metadata=t,t}))}},{key:"load",value:function(){return this._loadMetaData()}},{key:"clone",value:function(){return new r(this._url,this._overridespref,this.lrucache,this.interceptor)}},{key:"featureSetByName",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this;null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var a=JSON.stringify(r),l=0;l<this._instantLayers.length;l++){var i=this._instantLayers[l];if(i.opitem.title===e&&i.includeGeometry===t&&i.outFields===a)return this.resolvePromise(this._instantLayers[l].featureset)}return this._loadMetaData().then((function(a){var l=n,i=null,o=!0,u=!1,s=void 0;try{for(var f,c=(a.layers?a.layers:[])[Symbol.iterator]();!(o=(f=c.next()).done);o=!0){var d=f.value;d.name===e&&(i=d)}}catch(e){u=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(u)throw s}}var y=!0,h=!1,v=void 0;if(!i)try{for(var p,m=(a.tables?a.tables:[])[Symbol.iterator]();!(y=(p=m.next()).done);y=!0){var g=p.value;g.name===e&&(i=g)}}catch(e){h=!0,v=e}finally{try{y||null==m.return||m.return()}finally{if(h)throw v}}return i?A(n._url+"/"+i.id,["*"]).then((function(e){return l._makeAndAddFeatureSet(e,t,r)})):n.resolvePromise(null)}))}},{key:"featureSetById",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["*"],n=this;null===r&&(r=["*"]),r=(r=r.slice(0)).sort();var a=JSON.stringify(r);e=null!=e?e.toString():"";for(var l=0;l<this._instantLayers.length;l++){var i=this._instantLayers[l];if(i.opitem.id===e&&i.includeGeometry===t&&i.outFields===a)return this.resolvePromise(this._instantLayers[l].featureset)}return this._loadMetaData().then((function(a){var l=n,i=null,o=!0,u=!1,s=void 0;try{for(var f,c=(a.layers?a.layers:[])[Symbol.iterator]();!(o=(f=c.next()).done);o=!0){var d=f.value;null!==d.id&&void 0!==d.id&&d.id.toString()===e&&(i=d)}}catch(e){u=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(u)throw s}}var y=!0,h=!1,v=void 0;if(!i)try{for(var p,m=(a.tables?a.tables:[])[Symbol.iterator]();!(y=(p=m.next()).done);y=!0){var g=p.value;null!==g.id&&void 0!==g.id&&g.id.toString()===e&&(i=g)}}catch(e){h=!0,v=e}finally{try{y||null==m.return||m.return()}finally{if(h)throw v}}return i?A(n._url+"/"+i.id,["*"]).then((function(e){return l._makeAndAddFeatureSet(e,t,r)})):n.resolvePromise(null)}))}}]),r}(o.default);function _(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new T(e,t,r,n)}function O(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new k(e,t,r,n)}function R(e,t){return null===e?t:new(0,w.default)({url:e.field("url")})}function P(e,t,r){return l.id.findCredential(e.restUrl)?"loaded"===e.loadStatus&&""===t&&e.user&&e.user.sourceJSON&&!1===r?(0,S.resolve)(e.user.sourceJSON):""===t?(0,i.default)(e.restUrl+"/community/self",{responseType:"json",query:a.objectSpread({f:"json"},!1===r?{}:{returnUserLicenseTypeExtensions:!0})}).then((function(e){if(e.data){var t=e.data;if(t&&t.username)return(0,S.resolve)(t)}return(0,S.resolve)(null)})):(0,i.default)(e.restUrl+"/community/users/"+t,{responseType:"json",query:{f:"json"}}).then((function(e){if(e.data){var t=e.data;return t.error?null:(0,S.resolve)(t)}return(0,S.resolve)(null)})):(0,S.resolve)(null)}function j(e,t,r,n,a){if(null===e)return null;if(e instanceof I.default){switch(t){case"datasource":return D(e,a,e.outFields,!0,r,n).getDataSourceFeatureSet();case"parent":case"root":return D(e,a,e.outFields,!0,r,n)}return null}if(e instanceof m.default)switch(t){case"datasource":return e.getDataSourceFeatureSet();case"parent":return e;case"root":return e.getRootFeatureSet()}return null}function M(e,t,r,n,a,l,i){var o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(p.default.applicationCache){var u=p.default.applicationCache.getLayerInfo(e+":"+l.url);if(u)return u.then((function(e){try{var l=new(0,I.default)({url:(0,g.extractServiceUrl)(e.url)+"/"+t,outFields:["*"]});return(0,S.resolve)(D(l,r,n,a,i,o))}catch(e){return(0,S.reject)(e)}}),(function(e){return(0,S.reject)(e)}))}return(0,S.create)((function(u,s){var f=new(0,b.default)({id:e,portal:l}).load();p.default.applicationCache&&p.default.applicationCache.setLayerInfo(e+":"+l.url,f),f.then((function(e){try{var l=new(0,I.default)({url:(0,g.extractServiceUrl)(e.url)+"/"+t,outFields:["*"]});u(D(l,r,n,a,i,o))}catch(e){s(e)}}),(function(t){p.default.applicationCache&&p.default.applicationCache.clearLayerInfo(e+":"+l.url),s(t)}))}))}})),t.register("fsJts",(function(t,r){e(t.exports,"outputTypes",(function(){return n})),e(t.exports,"createMD5Hash",(function(){return v}));var n={Base64:0,Hex:1,String:2,Raw:3};function a(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function l(e){for(var t=[],r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function i(e){for(var t=[],r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}function o(e){for(var t="0123456789abcdef",r=[],n=0,a=4*e.length;n<a;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}function u(e){for(var t=[],r=0,n=4*e.length;r<n;r+=3)for(var a=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,l=0;l<4;l++)8*r+6*l>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>6*(3-l)&63));return t.join("")}function s(e,t,r,n,l,i){return a((o=a(a(t,e),a(n,i)))<<(u=l)|o>>>32-u,r);var o,u}function f(e,t,r,n,a,l,i){return s(t&r|~t&n,e,t,a,l,i)}function c(e,t,r,n,a,l,i){return s(t&n|r&~n,e,t,a,l,i)}function d(e,t,r,n,a,l,i){return s(t^r^n,e,t,a,l,i)}function y(e,t,r,n,a,l,i){return s(r^(t|~n),e,t,a,l,i)}function h(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,n=-271733879,l=-1732584194,i=271733878,o=0;o<e.length;o+=16){var u=r,s=n,h=l,v=i;r=f(r,n,l,i,e[o+0],7,-680876936),i=f(i,r,n,l,e[o+1],12,-389564586),l=f(l,i,r,n,e[o+2],17,606105819),n=f(n,l,i,r,e[o+3],22,-1044525330),r=f(r,n,l,i,e[o+4],7,-176418897),i=f(i,r,n,l,e[o+5],12,1200080426),l=f(l,i,r,n,e[o+6],17,-1473231341),n=f(n,l,i,r,e[o+7],22,-45705983),r=f(r,n,l,i,e[o+8],7,1770035416),i=f(i,r,n,l,e[o+9],12,-1958414417),l=f(l,i,r,n,e[o+10],17,-42063),n=f(n,l,i,r,e[o+11],22,-1990404162),r=f(r,n,l,i,e[o+12],7,1804603682),i=f(i,r,n,l,e[o+13],12,-40341101),l=f(l,i,r,n,e[o+14],17,-1502002290),r=c(r,n=f(n,l,i,r,e[o+15],22,1236535329),l,i,e[o+1],5,-165796510),i=c(i,r,n,l,e[o+6],9,-1069501632),l=c(l,i,r,n,e[o+11],14,643717713),n=c(n,l,i,r,e[o+0],20,-373897302),r=c(r,n,l,i,e[o+5],5,-701558691),i=c(i,r,n,l,e[o+10],9,38016083),l=c(l,i,r,n,e[o+15],14,-660478335),n=c(n,l,i,r,e[o+4],20,-405537848),r=c(r,n,l,i,e[o+9],5,568446438),i=c(i,r,n,l,e[o+14],9,-1019803690),l=c(l,i,r,n,e[o+3],14,-187363961),n=c(n,l,i,r,e[o+8],20,1163531501),r=c(r,n,l,i,e[o+13],5,-1444681467),i=c(i,r,n,l,e[o+2],9,-51403784),l=c(l,i,r,n,e[o+7],14,1735328473),r=d(r,n=c(n,l,i,r,e[o+12],20,-1926607734),l,i,e[o+5],4,-378558),i=d(i,r,n,l,e[o+8],11,-2022574463),l=d(l,i,r,n,e[o+11],16,1839030562),n=d(n,l,i,r,e[o+14],23,-35309556),r=d(r,n,l,i,e[o+1],4,-1530992060),i=d(i,r,n,l,e[o+4],11,1272893353),l=d(l,i,r,n,e[o+7],16,-155497632),n=d(n,l,i,r,e[o+10],23,-1094730640),r=d(r,n,l,i,e[o+13],4,681279174),i=d(i,r,n,l,e[o+0],11,-358537222),l=d(l,i,r,n,e[o+3],16,-722521979),n=d(n,l,i,r,e[o+6],23,76029189),r=d(r,n,l,i,e[o+9],4,-640364487),i=d(i,r,n,l,e[o+12],11,-421815835),l=d(l,i,r,n,e[o+15],16,530742520),r=y(r,n=d(n,l,i,r,e[o+2],23,-995338651),l,i,e[o+0],6,-198630844),i=y(i,r,n,l,e[o+7],10,1126891415),l=y(l,i,r,n,e[o+14],15,-1416354905),n=y(n,l,i,r,e[o+5],21,-57434055),r=y(r,n,l,i,e[o+12],6,1700485571),i=y(i,r,n,l,e[o+3],10,-1894986606),l=y(l,i,r,n,e[o+10],15,-1051523),n=y(n,l,i,r,e[o+1],21,-2054922799),r=y(r,n,l,i,e[o+8],6,1873313359),i=y(i,r,n,l,e[o+15],10,-30611744),l=y(l,i,r,n,e[o+6],15,-1560198380),n=y(n,l,i,r,e[o+13],21,1309151649),r=y(r,n,l,i,e[o+4],6,-145523070),i=y(i,r,n,l,e[o+11],10,-1120210379),l=y(l,i,r,n,e[o+2],15,718787259),n=y(n,l,i,r,e[o+9],21,-343485551),r=a(r,u),n=a(n,s),l=a(l,h),i=a(i,v)}return[r,n,l,i]}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Hex,r=t||n.Base64,a=h(l(e),8*e.length);switch(r){case n.Raw:return a;case n.Hex:return o(a);case n.String:return i(a);case n.Base64:return u(a)}}}))}();
//# sourceMappingURL=featuresetbase.59dc6b26.js.map
