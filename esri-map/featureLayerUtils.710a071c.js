function e(e,t,r,a){Object.defineProperty(e,t,{get:r,set:a,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("ca9Sn",(function(r,a){e(r.exports,"save",(function(){return F})),e(r.exports,"saveAs",(function(){return P}));var n=t("aX9sh"),i=t("bPmsI"),o=t("6TszD"),l=t("lHg4e"),s=t("iYitI"),u=t("iaM5n"),d=t("c8U9w"),c=t("f369A"),f=t("1TI7x"),y=t("39WmQ"),p=t("h7Mrf"),m=t("7zHk6"),w=t("g0k3L");const v=o.default.getLogger("esri.layers.FeatureLayer"),g="Feature Service";function h(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function S(e,t){if(t.type!==g)throw new(0,i.default)("feature-layer:portal-item-wrong-type",h(e,'should have portal item of type "Feature Service"'))}async function b(e){if(await e.load(),(0,f.isFeatureCollectionLayer)(e))throw new(0,i.default)("feature-layer:save",h(e,"using an in-memory source cannot be saved to a portal item"))}async function I(e,t,r){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const a=e.write({},t);return function(e,t){let r=(e.messages??[]).filter((({type:e})=>"error"===e)).map((({name:e,message:t,details:r})=>new(0,i.default)(e,t,r)));if(t?.ignoreUnsupported&&(r=r.filter((({name:e})=>"layer:unsupported"!==e&&"symbol:unsupported"!==e&&"symbol-layer:unsupported"!==e&&"property:unsupported"!==e&&"url:unsupported"!==e))),r.length>0)throw new(0,i.default)("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}(t,r),a}function O(e){const{layer:t,layerJSON:r}=e;return t.isTable?{layers:[],tables:[r]}:{layers:[r],tables:[]}}function T(e){(0,w.addTypeKeyword)(e,w.TypeKeyword.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}async function N(e,t){return/\/\d+\/?$/.test(e.url??"")?O(t[0]):async function(e,t){const{layer:{url:r,customParameters:a,apiKey:n}}=t[0];let i=await e.fetchData("json");i&&null!=i.layers&&null!=i.tables||(i=await async function(e,t,r){e||={},e.layers||=[],e.tables||=[];const{url:a,customParameters:n,apiKey:i}=t,{serviceJSON:o,layersJSON:s}=await(0,c.fetchFeatureService)(a,{customParameters:n,apiKey:i}),d=x(e.layers,o.layers,r),f=x(e.tables,o.tables,r);e.layers=d.itemResources,e.tables=f.itemResources;const y=[...d.added,...f.added],p=s?[...s.layers,...s.tables]:[];return await async function(e,t,r,a){const n=t.map((({id:e})=>new(0,u.default)({url:r,layerId:e,sourceJSON:a.find((({id:t})=>t===e))})));await(0,l.eachAlways)(n.map((e=>e.load()))),n.forEach((t=>{const{layerId:r,loaded:a,defaultPopupTemplate:n}=t;a&&null!=n&&K(t,{id:r,popupInfo:n.toJSON()},e)}))}(e,y,a,p),e}(i,{url:r??"",customParameters:a,apiKey:n},t.map((e=>e.layer.layerId))));for(const e of t)K(e.layer,e.layerJSON,i);return i}(e,t)}function x(e,t,r){const a=(0,n.difference)(e,t,((e,t)=>e.id===t.id));e=e.filter((e=>!a.removed.some((t=>t.id===e.id))));const i=a.added.map((({id:e})=>({id:e})));return i.forEach((({id:t})=>{e.push({id:t})})),{itemResources:e,added:i.filter((({id:e})=>!r.includes(e)))}}function K(e,t,r){e.isTable?A(r.tables,t):A(r.layers,t)}function A(e,t){if(!e)return;const r=e.findIndex((({id:e})=>e===t.id));-1===r?e.push(t):e[r]=t}function J(e){const{portalItem:t}=e;return(0,f.isFeatureServiceLayer)(e)&&!e.dynamicDataSource&&!!t?.loaded&&t.type===g}const F=(0,l.debounce)((async function(e,t){await b(e),function(e){const t=e.portalItem;if(!t)throw v.error("save: requires the portalItem property to be set"),new(0,i.default)("feature-layer:portal-item-not-set",h(e,"requires the portalItem property to be set"));if(!t.loaded)throw new(0,i.default)("feature-layer:portal-item-not-loaded",h(e,"cannot be saved to a portal item that does not exist or is inaccessible"));S(e,t)}(e);const r=e.portalItem,a=(0,m.createForItemWrite)(r),n=await I(e,a,t),o=await N(r,[{layer:e,layerJSON:n}]);return T(r),await r.update({data:o}),(0,s.updateOrigins)(a),r}));(0,l.debounce)((async(e,t)=>{await async function(e){if(!e?.length)throw new(0,i.default)("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");await Promise.all(e.map((e=>e.load())));for(const t of e)if(!J(t))throw new(0,i.default)("feature-layer-utils-saveall:invalid-parameters",`'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ${h(t,"does not conform")}`,{layer:t});const t=e.map((e=>e.portalItem.id));if(new Set(t).size>1)throw new(0,i.default)("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");const r=e.map((e=>e.layerId));if(new Set(r).size!==r.length)throw new(0,i.default)("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service")}(e);const r=e[0].portalItem,a=(0,m.createForItemWrite)(r),n=await Promise.all(e.map((e=>I(e,a,t)))),o=await N(r,e.map(((e,t)=>({layer:e,layerJSON:n[t]}))));return T(r),await r.update({data:o}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),(0,s.updateOrigins)(a),r.clone()}));const P=(0,l.debounce)((async function(e,t,r){await b(e);const a=function(e,t){let r=p.default.from(t);return r.id&&(r=r.clone(),r.id=null),r.type??=g,r.portal??=y.default.getDefault(),S(e,r),r}(e,t),n=(0,m.createForItemWrite)(a),i=O({layer:e,layerJSON:await I(e,n,r)});return await async function(e,t){const{url:r,layerId:a,title:n,fullExtent:i,isTable:o}=e,l=(0,d.parse)(r),s=null!=l&&"FeatureServer"===l.serverType;t.url=s?r:`${r}/${a}`,t.title||=n,t.extent=null,o||null==i||(t.extent=await(0,w.getWGS84ExtentForItem)(i)),(0,w.removeTypeKeyword)(t,w.TypeKeyword.METADATA),(0,w.removeTypeKeyword)(t,w.TypeKeyword.MULTI_LAYER),(0,w.addTypeKeyword)(t,w.TypeKeyword.SINGLE_LAYER),o&&(0,w.addTypeKeyword)(t,w.TypeKeyword.TABLE),T(t)}(e,a),await async function(e,t,r){const a=e.portal;await(a?.signIn()),await(a?.user?.addItem({item:e,data:t,folder:r?.folder}))}(a,i,r),e.portalItem=a,(0,s.updateOrigins)(n),a}))})),t.register("iYitI",(function(r,a){e(r.exports,"updateOrigins",(function(){return i}));var n=t("fMNx8");function i(e){e&&e.writtenProperties&&e.writtenProperties.forEach((({target:e,propName:t,newOrigin:r})=>{(0,n.isMultiOriginJSONMixin)(e)&&r&&e.originOf(t)!==r&&e.updateOrigin(t,r)}))}})),t.register("fMNx8",(function(t,r){function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}e(t.exports,"isMultiOriginJSONMixin",(function(){return a}))})),t.register("f369A",(function(r,a){e(r.exports,"fetchFeatureService",(function(){return i}));var n=t("7TC5p");async function i(e,t){const r=await(0,n.fetchArcGISServiceJSON)(e,t);r.layers=r.layers.filter(o);const a={serviceJSON:r};if((r.currentVersion??0)<10.5)return a;const i=await(0,n.fetchArcGISServiceJSON)(e+"/layers",t);return a.layersJSON={layers:i.layers.filter(o),tables:i.tables},a}function o(e){return!e.type||"Feature Layer"===e.type}})),t.register("7TC5p",(function(r,a){e(r.exports,"fetchArcGISServiceJSON",(function(){return i}));var n=t("bYA0c");async function i(e,t){const{data:r}=await(0,n.default)(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}});return r}}));
//# sourceMappingURL=featureLayerUtils.710a071c.js.map
