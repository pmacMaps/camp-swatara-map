function e(e,a,i,n){Object.defineProperty(e,a,{get:i,set:n,enumerable:!0,configurable:!0})}var a=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;a.register("64Tjv",(function(i,n){e(i.exports,"viewScaleRE",(function(){return b})),e(i.exports,"getColor",(function(){return v})),e(i.exports,"getOpacity",(function(){return m})),e(i.exports,"getRotationAngle",(function(){return h})),e(i.exports,"getSize",(function(){return V})),e(i.exports,"getSizeForValue",(function(){return g})),e(i.exports,"getSizeFromNumberOrVariable",(function(){return x})),e(i.exports,"getSizeRangeAtScale",(function(){return S})),e(i.exports,"getVisualVariableValues",(function(){return T})),e(i.exports,"getAllSizes",(function(){return z}));var r=a("hJt7u"),t=a("EvxpF"),s=a("cL2Ua"),o=a("6TszD"),l=a("1CpCt"),c=a("88Eiv"),u=a("iHSuM");const f=o.default.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),p=new(0,t.default),d=Math.PI,b=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function v(e,a,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"color"===e.type)):e;if(!n)return;if("esri.renderers.visualVariables.ColorVariable"!==n.declaredClass)return void f.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const t="number"==typeof a,s=t?null:a,o=s&&s.attributes;let c=t?a:null;const u=n.field,{ipData:p,hasExpression:d}=n.cache;let b=n.cache.compiledFunc;if(!u&&!d){const e=n.stops;return e&&e[0]&&e[0].color}if("number"!=typeof c)if(d){if(!(0,l.isSome)(i)||!(0,l.isSome)(i.arcade))return void f.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},a=i.arcade.arcadeUtils,r=a.getViewInfo(e),t=a.createExecContext(s,r);if(!b){const e=a.createSyntaxTree(n.valueExpression);b=a.createFunction(e),n.cache.compiledFunc=b}c=a.executeFunction(b,t)}else o&&(c=o[u]);const v=n.normalizationField,m=o?parseFloat(o[v]):void 0;if(null!=c&&(!v||t||!isNaN(m)&&0!==m)){isNaN(m)||t||(c/=m);const e=w(c,p);if(e){const a=e[0],t=e[1],s=a===t?n.stops[a].color:r.default.blendColors(n.stops[a].color,n.stops[t].color,e[2],(0,l.isSome)(i)?i.color:void 0);return new(0,r.default)(s)}}}function m(e,a,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"opacity"===e.type)):e;if(!n)return;if("esri.renderers.visualVariables.OpacityVariable"!==n.declaredClass)return void f.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const r="number"==typeof a,t=r?null:a,s=t&&t.attributes;let o=r?a:null;const c=n.field,{ipData:u,hasExpression:p}=n.cache;let d=n.cache.compiledFunc;if(!c&&!p){const e=n.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof o)if(p){if((0,l.isNone)(i)||(0,l.isNone)(i.arcade))return void f.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},a=i.arcade.arcadeUtils,r=a.getViewInfo(e),s=a.createExecContext(t,r);if(!d){const e=a.createSyntaxTree(n.valueExpression);d=a.createFunction(e),n.cache.compiledFunc=d}o=a.executeFunction(d,s)}else s&&(o=s[c]);const b=n.normalizationField,v=s?parseFloat(s[b]):void 0;if(null!=o&&(!b||r||!isNaN(v)&&0!==v)){isNaN(v)||r||(o/=v);const e=w(o,u);if(e){const a=e[0],i=e[1];if(a===i)return n.stops[a].opacity;{const r=n.stops[a].opacity;return r+(n.stops[i].opacity-r)*e[2]}}}}function h(e,a,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"rotation"===e.type)):e;if(!n)return;if("esri.renderers.visualVariables.RotationVariable"!==n.declaredClass)return void f.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const r=n.axis||"heading",t="heading"===r&&"arithmetic"===n.rotationType?90:0,s="heading"===r&&"arithmetic"===n.rotationType?-1:1,o="number"==typeof a?null:a,c=o&&o.attributes,u=n.field,{hasExpression:p}=n.cache;let d=n.cache.compiledFunc,b=0;if(!u&&!p)return b;if(p){if((0,l.isNone)(i)||(0,l.isNone)(i.arcade))return void f.error("Use of arcade expressions requires an arcade context");const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},a=i.arcade.arcadeUtils,r=a.getViewInfo(e),t=a.createExecContext(o,r);if(!d){const e=a.createSyntaxTree(n.valueExpression);d=a.createFunction(e),n.cache.compiledFunc=d}b=a.executeFunction(d,t)}else c&&(b=c[u]||0);return b="number"!=typeof b||isNaN(b)?null:t+s*b,b}function V(e,a,i){const n="visualVariables"in e&&e.visualVariables?e.visualVariables.find((e=>"size"===e.type)):e;if(!n)return;if("esri.renderers.visualVariables.SizeVariable"!==n.declaredClass)return void f.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const r=g(function(e,a,i){const n="number"==typeof a,r=n?null:a,t=r&&r.attributes;let s=n?a:null;const{isScaleDriven:o}=e.cache;let c=e.cache.compiledFunc;if(o){const a=(0,l.isSome)(i)?i.scale:void 0,n=(0,l.isSome)(i)?i.view:void 0;s=null==a||"3d"===n?function(e){let a=null,i=null;const n=e.stops;return n?(a=n[0].value,i=n[n.length-1].value):(a=e.minDataValue||0,i=e.maxDataValue||0),(a+i)/2}(e):a}else if(!n)switch(e.inputValueType){case u.InputValueType.Expression:{if((0,l.isNone)(i)||(0,l.isNone)(i.arcade))return void f.error("Use of arcade expressions requires an arcade context");const a={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},n=i.arcade.arcadeUtils,t=n.getViewInfo(a),o=n.createExecContext(r,t);if(!c){const a=n.createSyntaxTree(e.valueExpression);c=n.createFunction(a),e.cache.compiledFunc=c}s=n.executeFunction(c,o);break}case u.InputValueType.Field:t&&(s=t[e.field]);break;case u.InputValueType.Unknown:s=null}if(!(0,u.isValidNumber)(s))return null;if(n||!e.normalizationField)return s;const p=t?parseFloat(t[e.normalizationField]):null;return(0,u.isValidNumber)(p)&&0!==p?s/p:null}(n,a,i),n,a,i,n.cache.ipData);return null==r||isNaN(r)?0:r}function x(e,a,i){return null==e?null:(0,u.isSizeVariable)(e)?V(e,a,i):(0,u.isValidNumber)(e)?e:null}function y(e,a,i){return(0,u.isValidNumber)(i)&&e>i?i:(0,u.isValidNumber)(a)&&e<a?a:e}function g(e,a,i,n,r){switch(a.transformationType){case u.TransformationType.Additive:return s=i,o=n,e+(x((t=a).minSize,s,o)||t.minDataValue);case u.TransformationType.Constant:return function(e,a,i){const n=e.stops;let r=n&&n.length&&n[0].size;return null==r&&(r=e.minSize),x(r,a,i)}(a,i,n);case u.TransformationType.ClampedLinear:return function(e,a,i,n){const r=(e-a.minDataValue)/(a.maxDataValue-a.minDataValue),t=x(a.minSize,i,n),s=x(a.maxSize,i,n),o=(0,l.isSome)(n)?n.shape:void 0;if(e<=a.minDataValue)return t;if(e>=a.maxDataValue)return s;if("area"===a.scaleBy&&o){const e="circle"===o,a=e?d*(t/2)**2:t*t,i=a+r*((e?d*(s/2)**2:s*s)-a);return e?2*Math.sqrt(i/d):Math.sqrt(i)}return t+r*(s-t)}(e,a,i,n);case u.TransformationType.Proportional:return function(e,a,i,n){const r=(0,l.isSome)(n)?n.shape:void 0,t=e/a.minDataValue,s=x(a.minSize,i,n),o=x(a.maxSize,i,n);let c=null;return c="circle"===r?2*Math.sqrt(t*(s/2)**2):"square"===r||"diamond"===r||"image"===r?Math.sqrt(t*s**2):t*s,y(c,s,o)}(e,a,i,n);case u.TransformationType.Stops:return function(e,a,i,n,r){const[t,s,o]=w(e,r);if(t===s)return x(a.stops[t].size,i,n);{const e=x(a.stops[t].size,i,n);return e+(x(a.stops[s].size,i,n)-e)*o}}(e,a,i,n,r);case u.TransformationType.RealWorldSize:return function(e,a,i,n){const r=((0,l.isSome)(n)&&n.resolution?n.resolution:1)*c.meterIn[a.valueUnit],t=x(a.minSize,i,n),s=x(a.maxSize,i,n),{valueRepresentation:o}=a;let u=null;return u="area"===o?2*Math.sqrt(e/d)/r:"radius"===o||"distance"===o?2*e/r:e/r,y(u,t,s)}(e,a,i,n);case u.TransformationType.Identity:return e;case u.TransformationType.Unknown:return null}var t,s,o}function S(e,a,i){const{isScaleDriven:n}=e.cache;if(!(n&&"3d"===i||a))return null;const r={scale:a,view:i};let t=x(e.minSize,p,r),s=x(e.maxSize,p,r);if(null!=t||null!=s){if(t>s){const e=s;s=t,t=e}return{minSize:t,maxSize:s}}}function T(e,a,i){if(!e.visualVariables)return;const n=[],r=[],t=[],s=[],o=[];for(const a of e.visualVariables)switch(a.type){case"color":r.push(a);break;case"opacity":t.push(a);break;case"rotation":o.push(a);break;case"size":s.push(a)}return r.forEach((e=>{const r=v(e,a,i);n.push({variable:e,value:r})})),t.forEach((e=>{const r=m(e,a,i);n.push({variable:e,value:r})})),o.forEach((e=>{const r=h(e,a,i);n.push({variable:e,value:r})})),s.forEach((e=>{const r=V(e,a,i);n.push({variable:e,value:r})})),n.filter((e=>null!=e.value))}function w(e,a){if(!a)return;let i=0,n=a.length-1;return a.some(((a,r)=>e<a?(n=r,!0):(i=r,!1))),[i,n,(e-a[i])/(a[n]-a[i])]}function z(e,a,i){const n=["proportional","proportional","proportional"];for(const r of e){const e=r.useSymbolValue?"symbol-value":V(r,a,i);switch(r.axis){case"width":n[0]=e;break;case"depth":n[1]=e;break;case"height":n[2]=e;break;case"width-and-depth":n[0]=e,n[1]=e;break;case"all":case void 0:case null:n[0]=e,n[1]=e,n[2]=e;break;default:(0,s.neverReached)(r.axis)}}return n}}));
//# sourceMappingURL=visualVariableUtils.72c05279.js.map
