function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("8Fpda",(function(t,n){function r(){const e=new Float32Array(4);return e[3]=1,e}function o(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function i(e,t){return new Float32Array(e,t,4)}e(t.exports,"c",(function(){return r})),e(t.exports,"b",(function(){return o})),e(t.exports,"a",(function(){return i}));Object.freeze(Object.defineProperty({__proto__:null,clone:o,create:r,createView:i,fromValues:function(e,t,n,r){const o=new Float32Array(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=r,o}},Symbol.toStringTag,{value:"Module"}))})),t.register("1hJFm",(function(n,r){e(n.exports,"createTypedView",(function(){return g})),e(n.exports,"createGeometryIndexFromSchema",(function(){return y})),e(n.exports,"readBinaryAttribute",(function(){return p}));var o=t("bPmsI"),i=t("itGIg"),c=t("6TszD"),u=t("grZKR"),a=t("44Q9I");const f=c.default.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function s(e,t,n){let r="",i=0;for(;i<n;){const c=e[t+i];if(c<128)r+=String.fromCharCode(c),i++;else if(c>=192&&c<224){if(i+1>=n)throw new(0,o.default)("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const u=(31&c)<<6|63&e[t+i+1];r+=String.fromCharCode(u),i+=2}else if(c>=224&&c<240){if(i+2>=n)throw new(0,o.default)("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const u=(15&c)<<12|(63&e[t+i+1])<<6|63&e[t+i+2];r+=String.fromCharCode(u),i+=3}else{if(!(c>=240&&c<248))throw new(0,o.default)("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(i+3>=n)throw new(0,o.default)("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const u=(7&c)<<18|(63&e[t+i+1])<<12|(63&e[t+i+2])<<6|63&e[t+i+3];if(u>=65536){const e=55296+(u-65536>>10),t=56320+(1023&u);r+=String.fromCharCode(e,t)}else r+=String.fromCharCode(u);i+=4}}}return r}function l(e,t){const n={byteOffset:0,byteCount:0,fields:Object.create(null)};let r=0;for(let o=0;o<t.length;o++){const i=t[o],c=i.valueType||i.type,u=U[c];n.fields[i.property]=u(e,r),r+=h[c].BYTES_PER_ELEMENT}return n.byteCount=r,n}function d(e,t,n){const r=[];let i,c,u=0;for(c=0;c<e;c+=1){if(i=t[c],i>0){if(r.push(s(n,u,i-1)),0!==n[u+i-1])throw new(0,o.default)("string-array-error","Invalid string array: missing null termination.")}else r.push(null);u+=i}return r}function g(e,t){return new h[t.valueType](e,t.byteOffset,t.count*t.valuesPerElement)}function w(e,t,n){if(t!==e&&f.error(`Invalid ${n} buffer size\n expected: ${e}, actual: ${t})`),t<e)throw new(0,o.default)("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function y(e,t){const n=l(e,t&&t.header);let r=n.byteCount;const o={isDraco:!1,header:n,byteOffset:n.byteCount,byteCount:0,vertexAttributes:{}},i=n.fields,c=null!=i.vertexCount?i.vertexCount:i.count;for(const e of t.ordering){if(!t.vertexAttributes[e])continue;const n={...t.vertexAttributes[e],byteOffset:r,count:c},i=b[e]||"_"+e;o.vertexAttributes[i]=n,r+=C(n.valueType)*n.valuesPerElement*c}const u=i.faceCount;if(t.faces&&u){o.faces={};for(const e of t.ordering){if(!t.faces[e])continue;const n={...t.faces[e],byteOffset:r,count:u};o.faces[e]=n,r+=C(n.valueType)*n.valuesPerElement*u}}const a=i.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&a){o.featureAttributes={};for(const e of t.featureAttributeOrder){if(!t.featureAttributes[e])continue;const n={...t.featureAttributes[e],byteOffset:r,count:a};o.featureAttributes[e]=n,r+=("UInt64"===n.valueType?8:C(n.valueType))*n.valuesPerElement*a}}return w(r,e.byteLength,"geometry"),o.byteCount=r-o.byteOffset,o}const b={position:a.VertexAttribute.POSITION,normal:a.VertexAttribute.NORMAL,color:a.VertexAttribute.COLOR,uv0:a.VertexAttribute.UV0,region:a.VertexAttribute.UVREGION};function p(e,t,n){if("lepcc-rgb"===e.encoding)return(0,u.decodeRGB)(t);if("lepcc-intensity"===e.encoding)return(0,u.decodeIntensity)(t);if(null!=e.encoding&&""!==e.encoding)throw new(0,o.default)("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(f.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),"ObjectIds"===e.ordering[0]&&e.hasOwnProperty("objectIds")&&(f.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");const r=function(e,t,n){const r=null!=t.header?l(e,t.header):{byteOffset:0,byteCount:0,fields:{count:n}},c={header:r,byteOffset:r.byteCount,byteCount:0,entries:Object.create(null)};let u=r.byteCount;for(let e=0;e<t.ordering.length;e++){const n=t.ordering[e],a=(0,i.clone)(t[n]);if(a.count=r.fields.count??0,"String"===a.valueType){if(a.byteOffset=u,a.byteCount=r.fields[n+"ByteCount"],"UTF-8"!==a.encoding)throw new(0,o.default)("unsupported-encoding","Unsupported String encoding.",{encoding:a.encoding});if(a.timeEncoding&&"ECMA_ISO8601"!==a.timeEncoding)throw new(0,o.default)("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:a.timeEncoding})}else{if(!m(a.valueType))throw new(0,o.default)("unsupported-value-type","Unsupported binary valueType",{valueType:a.valueType});{const e=C(a.valueType);u+=u%e!=0?e-u%e:0,a.byteOffset=u,a.byteCount=e*a.valuesPerElement*a.count}}u+=a.byteCount??0,c.entries[n]=a}return c.byteCount=u-c.byteOffset,c}(t,e,n);w(r.byteOffset+r.byteCount,t.byteLength,"attribute");const c=r.entries.attributeValues||r.entries.objectIds;if(c){if("String"===c.valueType){const e=r.entries.attributeByteCounts,n=g(t,e),o=function(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}(t,c);return c.timeEncoding?function(e,t,n){return d(e,t,n).map((e=>{const t=e?Date.parse(e):null;return t&&!Number.isNaN(t)?t:null}))}(e.count,n,o):d(e.count,n,o)}return g(t,c)}throw new(0,o.default)("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const h={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},U={Float32:(e,t)=>new DataView(e,0).getFloat32(t,!0),Float64:(e,t)=>new DataView(e,0).getFloat64(t,!0),UInt8:(e,t)=>new DataView(e,0).getUint8(t),Int8:(e,t)=>new DataView(e,0).getInt8(t),UInt16:(e,t)=>new DataView(e,0).getUint16(t,!0),Int16:(e,t)=>new DataView(e,0).getInt16(t,!0),UInt32:(e,t)=>new DataView(e,0).getUint32(t,!0),Int32:(e,t)=>new DataView(e,0).getInt32(t,!0)};function m(e){return h.hasOwnProperty(e)}function C(e){return m(e)?h[e].BYTES_PER_ELEMENT:0}})),t.register("grZKR",(function(n,r){e(n.exports,"decodeXYZ",(function(){return B})),e(n.exports,"decodeRGB",(function(){return S})),e(n.exports,"decodeIntensity",(function(){return X}));var o=t("bPmsI");const i=!0,c=0,u=10,a=10,f=12,s=16;function l(e,t,n){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,n+c,u)),version:t.getUint16(n+a,i),checksum:t.getUint32(n+f,i)}}const d=0,g=4,w=8,y=16,b=24,p=32,h=40,U=48,m=56,C=64,v=72,A=80,I=84,F=88;function B(e){const t=new DataView(e,0);let n=0;const{identifier:r,version:c}=l(e,t,n);if(n+=s,"LEPCC     "!==r)throw new(0,o.default)("lepcc-decode-error","Bad identifier");if(c>1)throw new(0,o.default)("lepcc-decode-error","Unknown version");const u=(f=n,{sizeLo:(a=t).getUint32(f+d,i),sizeHi:a.getUint32(f+g,i),minX:a.getFloat64(f+w,i),minY:a.getFloat64(f+y,i),minZ:a.getFloat64(f+b,i),maxX:a.getFloat64(f+p,i),maxY:a.getFloat64(f+h,i),maxZ:a.getFloat64(f+U,i),errorX:a.getFloat64(f+m,i),errorY:a.getFloat64(f+C,i),errorZ:a.getFloat64(f+v,i),count:a.getUint32(f+A,i),reserved:a.getUint32(f+I,i)});var a,f;if(n+=F,u.sizeHi*2**32+u.sizeLo!==e.byteLength)throw new(0,o.default)("lepcc-decode-error","Bad size");const B=new Float64Array(3*u.count),T=[],x=[],M=[],L=[];if(n=O(e,n,T),n=O(e,n,x),n=O(e,n,M),n=O(e,n,L),n!==e.byteLength)throw new(0,o.default)("lepcc-decode-error","Bad length");let E=0,z=0;for(let e=0;e<T.length;e++){z+=T[e];let t=0;for(let n=0;n<x[e];n++){t+=M[E];const e=L[E];B[3*E]=Math.min(u.maxX,u.minX+2*u.errorX*t),B[3*E+1]=Math.min(u.maxY,u.minY+2*u.errorY*z),B[3*E+2]=Math.min(u.maxZ,u.minZ+2*u.errorZ*e),E++}}return{errorX:u.errorX,errorY:u.errorY,errorZ:u.errorZ,result:B}}function O(e,t,n){const r=[];t=T(e,t,r);const o=[];for(let i=0;i<r.length;i++){o.length=0,t=T(e,t,o);for(let e=0;e<o.length;e++)n.push(o[e]+r[i])}return t}function T(e,t,n){const r=new DataView(e,t),c=r.getUint8(0),u=31&c,a=!!(32&c),f=(192&c)>>6;let s=0;if(0===f)s=r.getUint32(1,i),t+=5;else if(1===f)s=r.getUint16(1,i),t+=3;else{if(2!==f)throw new(0,o.default)("lepcc-decode-error","Bad count type");s=r.getUint8(1),t+=2}if(a)throw new(0,o.default)("lepcc-decode-error","LUT not implemented");const l=Math.ceil(s*u/8),d=new Uint8Array(e,t,l);let g=0,w=0,y=0;const b=-1>>>32-u;for(let e=0;e<s;e++){for(;w<u;)g|=d[y]<<w,w+=8,y+=1;n[e]=g&b,g>>>=u,w-=u,w+u>32&&(g|=d[y-1]>>8-w)}return t+y}const x=0,M=4,L=8,E=12,z=14,V=15,P=16;function S(e){const t=new DataView(e,0);let n=0;const{identifier:r,version:c}=l(e,t,n);if(n+=s,"ClusterRGB"!==r)throw new(0,o.default)("lepcc-decode-error","Bad identifier");if(c>1)throw new(0,o.default)("lepcc-decode-error","Unknown version");const u=(f=n,{sizeLo:(a=t).getUint32(f+x,i),sizeHi:a.getUint32(f+M,i),count:a.getUint32(f+L,i),colorMapCount:a.getUint16(f+E,i),lookupMethod:a.getUint8(f+z),compressionMethod:a.getUint8(f+V)});var a,f;if(n+=P,u.sizeHi*2**32+u.sizeLo!==e.byteLength)throw new(0,o.default)("lepcc-decode-error","Bad size");if((2===u.lookupMethod||1===u.lookupMethod)&&0===u.compressionMethod){if(3*u.colorMapCount+u.count+n!==e.byteLength||u.colorMapCount>256)throw new(0,o.default)("lepcc-decode-error","Bad count");const t=new Uint8Array(e,n,3*u.colorMapCount),r=new Uint8Array(e,n+3*u.colorMapCount,u.count),i=new Uint8Array(3*u.count);for(let e=0;e<u.count;e++){const n=r[e];i[3*e]=t[3*n],i[3*e+1]=t[3*n+1],i[3*e+2]=t[3*n+2]}return i}if(0===u.lookupMethod&&0===u.compressionMethod){if(3*u.count+n!==e.byteLength||0!==u.colorMapCount)throw new(0,o.default)("lepcc-decode-error","Bad count");return new Uint8Array(e,n).slice()}if(u.lookupMethod<=2&&1===u.compressionMethod){if(n+3!==e.byteLength||1!==u.colorMapCount)throw new(0,o.default)("lepcc-decode-error","Bad count");const r=t.getUint8(n),i=t.getUint8(n+1),c=t.getUint8(n+2),a=new Uint8Array(3*u.count);for(let e=0;e<u.count;e++)a[3*e]=r,a[3*e+1]=i,a[3*e+2]=c;return a}throw new(0,o.default)("lepcc-decode-error","Bad method "+u.lookupMethod+","+u.compressionMethod)}const D=0,k=4,R=8,Y=12,Z=14,j=15,_=16;function X(e){const t=new DataView(e,0);let n=0;const{identifier:r,version:c}=l(e,t,n);if(n+=s,"Intensity "!==r)throw new(0,o.default)("lepcc-decode-error","Bad identifier");if(c>1)throw new(0,o.default)("lepcc-decode-error","Unknown version");const u=(f=n,{sizeLo:(a=t).getUint32(f+D,i),sizeHi:a.getUint32(f+k,i),count:a.getUint32(f+R,i),scaleFactor:a.getUint16(f+Y,i),bitsPerPoint:a.getUint8(f+Z),reserved:a.getUint8(f+j)});var a,f;if(n+=_,u.sizeHi*2**32+u.sizeLo!==e.byteLength)throw new(0,o.default)("lepcc-decode-error","Bad size");const d=new Uint16Array(u.count);if(8===u.bitsPerPoint){if(u.count+n!==e.byteLength)throw new(0,o.default)("lepcc-decode-error","Bad size");const t=new Uint8Array(e,n,u.count);for(let e=0;e<u.count;e++)d[e]=t[e]*u.scaleFactor}else if(16===u.bitsPerPoint){if(2*u.count+n!==e.byteLength)throw new(0,o.default)("lepcc-decode-error","Bad size");const t=new Uint16Array(e,n,u.count);for(let e=0;e<u.count;e++)d[e]=t[e]*u.scaleFactor}else{const t=[];if(T(e,n,t)!==e.byteLength)throw new(0,o.default)("lepcc-decode-error","Bad size");for(let e=0;e<u.count;e++)d[e]=t[e]*u.scaleFactor}return d}}));
//# sourceMappingURL=PointCloudWorker.cf07351f.js.map
