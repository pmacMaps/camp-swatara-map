!function(){function e(e){return e&&e.__esModule?e.default:e}function r(e,r,t,n){Object.defineProperty(e,r,{get:t,set:n,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("09uM9",(function(n,o){var l;l=n.exports,Object.defineProperty(l,"__esModule",{value:!0,configurable:!0}),r(n.exports,"default",(function(){return T}));var a=t("8TSCy"),i=t("2TvXO"),u=t("7eJjO");t("2ILM8");var s=t("d2yMj"),y=t("7FmYA"),f=t("7qybv"),p=t("8NioF"),c=t("10vEZ"),d=t("kYueh"),v=t("iho5X");t("lNwWH"),t("2VlWd"),t("iJAIC");var h=t("eB8sj"),b=t("fcwIv"),m=t("kced1"),g=t("j40xv"),S=t("4LDxK"),x=t("gIXJ2"),w=t("5N5S1"),_=t("9bAYR"),k=t("13Qxf"),I=t("3GzOb"),E=t("gRgX5"),O=t("iWuB2"),L=t("bhSoB"),N=t("gINRd"),M=["kml","xml"],P=function(r){"use strict";a.inherits(n,r);var t=a.createSuper(n);function n(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];var l;return a.classCallCheck(this,n),(l=t.call.apply(t,[this].concat(a.toConsumableArray(r))))._visibleFolders=[],l.allSublayers=new(0,y.default)({getCollections:function(){return[l.sublayers]},getChildrenFunction:function(e){return e.sublayers}}),l.outSpatialReference=g.default.WGS84,l.path=null,l.legendEnabled=!1,l.operationalLayerType="KML",l.sublayers=null,l.type="kml",l.url=null,a.possibleConstructorReturn(l)}return a.createClass(n,[{key:"initialize",value:function(){var e=this;this.watch("sublayers",(function(r,t){var n=e;t&&t.forEach((function(e){e.parent=null,e.layer=null})),r&&r.forEach((function(e){e.parent=n,e.layer=n}))}),!0),this.on("sublayer-update",(function(){return e.notifyChange("fullExtent")}))}},{key:"normalizeCtorArgs",value:function(e,r){return"string"==typeof e?a.objectSpread({url:e},r):e}},{key:"readSublayersFromItemOrWebMap",value:function(e,r){this._visibleFolders=r.visibleFolders}},{key:"readSublayers",value:function(e,r,t){return(0,L.sublayersFromJSON)(O.default,r,t,this._visibleFolders)}},{key:"writeSublayers",value:function(e,r){for(var t=[],n=e.toArray();n.length;){var o,l=n[0];l.networkLink||(l.visible&&t.push(l.id),l.sublayers&&(o=n).push.apply(o,a.toConsumableArray(l.sublayers.toArray()))),n.shift()}r.visibleFolders=t}},{key:"title",get:function(){var e=this._get("title");return e&&"defaults"!==this.originOf("title")?e:this.url?(0,d.getFilename)(this.url,M)||"KML":e||""},set:function(e){this._set("title",e)}},{key:"visibleSublayers",get:function(){var e=this.sublayers,r=[],t=function(e){e.visible&&(r.push(e),e.sublayers&&e.sublayers.forEach(t))};return e&&e.forEach(t),r}},{key:"fullExtent",get:function(){return this._recomputeFullExtent()}},{key:"load",value:function(e){var r=this,t=(0,f.isSome)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["KML"]},e).catch(c.throwIfAbortError).then((function(){return r._fetchService(t)}))),Promise.resolve(this)}},{key:"destroy",value:function(){a.get(a.getPrototypeOf(n.prototype),"destroy",this).call(this),this.allSublayers.destroy()}},{key:"_fetchService",value:function(r){var t=this;return a.asyncToGenerator(e(i).mark((function n(){var o,l;return e(i).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then((function(){return t.resourceInfo?{ssl:!1,data:t.resourceInfo}:(0,L.fetchService)(t.url,t.outSpatialReference,t.refreshInterval,r)}));case 2:o=e.sent,(l=(0,L.parseKML)(o.data))&&t.read(l,{origin:"service"});case 5:case"end":return e.stop()}}),n)})))()}},{key:"_recomputeFullExtent",value:function(){var e=null;(0,f.isSome)(this.extent)&&(e=this.extent.clone());var r=function(t){var n=!0,o=!1,l=void 0;if(t.sublayers)try{for(var a,i=t.sublayers.items[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var u=a.value;r(u),u.visible&&u.fullExtent&&((0,f.isSome)(e)?e.union(u.fullExtent):e=u.fullExtent.clone())}}catch(e){o=!0,l=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw l}}};return r(this),e}}]),n}((0,x.BlendLayer)((0,k.RefreshableLayer)((0,I.ScaleRangeLayer)((0,w.OperationalLayer)((0,_.PortalLayer)((0,p.MultiOriginJSONMixin)(S.default)))))));(0,u._)([(0,v.property)({readOnly:!0})],P.prototype,"allSublayers",void 0),(0,u._)([(0,v.property)({type:g.default})],P.prototype,"outSpatialReference",void 0),(0,u._)([(0,v.property)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],P.prototype,"path",void 0),(0,u._)([(0,v.property)({readOnly:!0,json:{read:!1,write:!1}})],P.prototype,"legendEnabled",void 0),(0,u._)([(0,v.property)({type:["show","hide","hide-children"]})],P.prototype,"listMode",void 0),(0,u._)([(0,v.property)({type:["KML"]})],P.prototype,"operationalLayerType",void 0),(0,u._)([(0,v.property)({})],P.prototype,"resourceInfo",void 0),(0,u._)([(0,v.property)({type:s.default.ofType(O.default),json:{write:{ignoreOrigin:!0}}})],P.prototype,"sublayers",void 0),(0,u._)([(0,h.reader)(["web-map","portal-item"],"sublayers",["visibleFolders"])],P.prototype,"readSublayersFromItemOrWebMap",null),(0,u._)([(0,h.reader)("service","sublayers",["sublayers"])],P.prototype,"readSublayers",null),(0,u._)([(0,m.writer)("sublayers")],P.prototype,"writeSublayers",null),(0,u._)([(0,v.property)({readOnly:!0,json:{read:!1}})],P.prototype,"type",void 0),(0,u._)([(0,v.property)({json:{origins:{"web-map":{read:{source:"title"}}},write:{ignoreOrigin:!0}}})],P.prototype,"title",null),(0,u._)([(0,v.property)(E.url)],P.prototype,"url",void 0),(0,u._)([(0,v.property)({readOnly:!0})],P.prototype,"visibleSublayers",null),(0,u._)([(0,v.property)({type:N.default})],P.prototype,"extent",void 0),(0,u._)([(0,v.property)()],P.prototype,"fullExtent",null);var T=P=(0,u._)([(0,b.subclass)("esri.layers.KMLLayer")],P)})),t.register("iWuB2",(function(e,n){r(e.exports,"default",(function(){return w}));var o=t("8TSCy"),l=t("7eJjO");t("2ILM8");var a=t("d2yMj"),i=t("amfHf"),u=t("1XAcN"),s=t("bQCqB"),y=t("7qybv"),f=t("lKPaD"),p=t("1TSdR"),c=t("iho5X");t("lNwWH"),t("2VlWd");var d,v=t("ba18L"),h=t("eB8sj"),b=t("fcwIv"),m=t("iJAIC"),g=t("bhSoB"),S=t("gINRd"),x=d=function(e){"use strict";o.inherits(t,e);var r=o.createSuper(t);function t(){var e;return o.classCallCheck(this,t),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._sublayersHandles=null,e.description=null,e.id=null,e.networkLink=null,e.title=null,e.sourceJSON=null,e.fullExtent=null,o.possibleConstructorReturn(e)}return o.createClass(t,[{key:"initialize",value:function(){var e=this;(0,f.whenOnce)((function(){return e.networkLink})).then((function(){return(0,f.whenOnce)((function(){return!0===e.visible}))})).then((function(){return e.load()}))}},{key:"load",value:function(e){var r=this;if(this.networkLink&&!this.networkLink.viewFormat){var t=(0,y.isSome)(e)?e.signal:null,n=this._fetchService(this._get("networkLink").href,t).then((function(e){var t=(0,g.computeExtent)(e.sublayers);r.fullExtent=S.default.fromJSON(t),r.sourceJSON=e;var n=(0,m.ensureType)(a.default.ofType(d),(0,g.sublayersFromJSON)(d,e));r.sublayers?r.sublayers.addMany(n):r.sublayers=n,r.layer.emit("sublayer-update"),r.layer&&r.layer.notifyChange("visibleSublayers")}));return this.addResolvingPromise(n),Promise.resolve(this)}}},{key:"sublayers",set:function(e){var r=this,t=this._get("sublayers");t&&(t.forEach((function(e){e.parent=null,e.layer=null})),this._sublayersHandles.forEach((function(e){return e.remove()})),this._sublayersHandles=null),e&&(e.forEach((function(e){e.parent=r,e.layer=r.layer})),this._sublayersHandles=[e.on("after-add",(function(e){var t=e.item;t.parent=r,t.layer=r.layer})),e.on("after-remove",(function(e){var r=e.item;r.parent=null,r.layer=null}))]),this._set("sublayers",e)}},{key:"castSublayers",value:function(e){return(0,m.ensureType)(a.default.ofType(d),e)}},{key:"visible",get:function(){return this._get("visible")},set:function(e){this._get("visible")!==e&&(this._set("visible",e),this.layer&&this.layer.notifyChange("visibleSublayers"))}},{key:"readVisible",value:function(e,r){return!!r.visibility}},{key:"layer",set:function(e){this._set("layer",e),this.sublayers&&this.sublayers.forEach((function(r){return r.layer=e}))}},{key:"_fetchService",value:function(e,r){return(0,g.fetchService)(e,this.layer.outSpatialReference,this.layer.refreshInterval,r).then((function(e){return(0,g.parseKML)(e.data)}))}}]),t}(i.default.EventedMixin((0,u.JSONSupportMixin)(s.default)));(0,l._)([(0,c.property)()],x.prototype,"description",void 0),(0,l._)([(0,c.property)()],x.prototype,"id",void 0),(0,l._)([(0,c.property)({readOnly:!0,value:null})],x.prototype,"networkLink",void 0),(0,l._)([(0,c.property)({json:{write:{allowNull:!0}}})],x.prototype,"parent",void 0),(0,l._)([(0,c.property)({value:null,json:{write:{allowNull:!0}}})],x.prototype,"sublayers",null),(0,l._)([(0,v.cast)("sublayers")],x.prototype,"castSublayers",null),(0,l._)([(0,c.property)({value:null,json:{read:{source:"name",reader:function(e){return(0,p.stripHTML)(e)}}}})],x.prototype,"title",void 0),(0,l._)([(0,c.property)({value:!0})],x.prototype,"visible",null),(0,l._)([(0,h.reader)("visible",["visibility"])],x.prototype,"readVisible",null),(0,l._)([(0,c.property)()],x.prototype,"sourceJSON",void 0),(0,l._)([(0,c.property)({value:null})],x.prototype,"layer",null),(0,l._)([(0,c.property)({type:S.default})],x.prototype,"fullExtent",void 0);var w=x=d=(0,l._)([(0,b.subclass)("esri.layers.support.KMLSublayer")],x)})),t.register("bhSoB",(function(n,o){r(n.exports,"parseKML",(function(){return g})),r(n.exports,"computeExtent",(function(){return I})),r(n.exports,"fetchService",(function(){return S})),r(n.exports,"sublayersFromJSON",(function(){return x})),r(n.exports,"getGraphics",(function(){return _}));var l=t("8TSCy"),a=t("2TvXO"),i=t("cu9iz"),u=t("dLARP"),s=t("3MVX3"),y=t("9pNSx"),f=t("flPLJ"),p=t("kYueh"),c=t("j40xv"),d=t("ayLat"),v=t("5Hy9K"),h=t("lubf9"),b=t("f4h86"),m={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function g(e){var r=e.folders||[],t=r.slice(),n=new Map,o=new Map,l=new Map,a=new Map,i=new Map,u={esriGeometryPoint:o,esriGeometryPolyline:l,esriGeometryPolygon:a};(e.featureCollection&&e.featureCollection.layers||[]).forEach((function(e){var r=(0,f.clone)(e);r.featureSet.features=[];var t=e.featureSet.geometryType;n.set(t,r);var i=e.layerDefinition.objectIdField;"esriGeometryPoint"===t?w(o,i,e.featureSet.features):"esriGeometryPolyline"===t?w(l,i,e.featureSet.features):"esriGeometryPolygon"===t&&w(a,i,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((function(e){i.set(e.id,e)})),r.forEach((function(r){r.networkLinkIds.forEach((function(n){var o,l,a,i,u,s,y=(o=n,l=r.id,a=e.networkLinks,u=o,a.some((function(e){return e.id===u&&(s=e,!0)})),(i=s)&&(i.parentFolderId=l,i.networkLink=i),i);y&&t.push(y)}))})),t.forEach((function(e){if(e.featureInfos){e.points=(0,f.clone)(n.get("esriGeometryPoint")),e.polylines=(0,f.clone)(n.get("esriGeometryPolyline")),e.polygons=(0,f.clone)(n.get("esriGeometryPolygon")),e.mapImages=[];var r=!0,t=!1,o=void 0;try{for(var l,a=e.featureInfos[Symbol.iterator]();!(r=(l=a.next()).done);r=!0){var s=l.value;switch(s.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":var y=u[s.type].get(s.id);y&&e[m[s.type]].featureSet.features.push(y);break;case"GroundOverlay":var p=i.get(s.id);p&&e.mapImages.push(p)}}}catch(e){t=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(t)throw o}}e.fullExtent=I([e])}}));var s=I(t);return{folders:r,sublayers:t,extent:s}}function S(e,r,t,n){var o=u.id&&u.id.findCredential(e);e=(0,p.addQueryParameters)(e,{token:o&&o.token});var l=i.default.kmlServiceUrl;return(0,y.default)(l,{query:{url:e,model:"simple",folders:"",refresh:0!==t||void 0,outSR:JSON.stringify(r)},responseType:"json",signal:n})}function x(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=[],l={},a=r.sublayers,i=r.folders.map((function(e){return e.id}));return a.forEach((function(r){var a=new e;if(t?a.read(r,t):a.read(r),n.length&&i.indexOf(a.id)>-1&&(a.visible=-1!==n.indexOf(a.id)),l[r.id]=a,null!=r.parentFolderId&&-1!==r.parentFolderId){var u=l[r.parentFolderId];u.sublayers||(u.sublayers=[]),u.sublayers.unshift(a)}else o.unshift(a)})),o}function w(e,r,t){t.forEach((function(t){e.set(t.attributes[r],t)}))}function _(e){return k.apply(this,arguments)}function k(){return(k=l.asyncToGenerator(e(a).mark((function r(t){var n,o,l,i,u,y,f,p,c,d,v,m;return e(a).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=b.default.fromJSON(t.featureSet).features,o=t.layerDefinition,l=(0,h.fromJSON)(o.drawingInfo.renderer),i=s.default.fromJSON(t.popupInfo),u=[],y=!0,f=!1,p=void 0,e.prev=2,c=n[Symbol.iterator]();case 4:if(y=(d=c.next()).done){e.next=13;break}return v=d.value,e.next=8,l.getSymbolAsync(v);case 8:m=e.sent,v.symbol=m,v.popupTemplate=i,v.visible=!0,u.push(v);case 10:y=!0,e.next=4;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),f=!0,p=e.t0;case 19:e.prev=19,e.prev=20,y||null==c.return||c.return();case 22:if(e.prev=22,!f){e.next=25;break}throw p;case 25:return e.finish(22);case 26:return e.finish(19);case 27:return e.abrupt("return",u);case 28:case"end":return e.stop()}}),r,null,[[2,15,19,27],[20,,22,26]])})))).apply(this,arguments)}function I(e){var r=(0,d.create)(d.NEGATIVE_INFINITY),t=(0,d.create)(d.NEGATIVE_INFINITY),n=!0,o=!1,l=void 0;try{for(var a,i=e[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var u=a.value,s=!0,y=!1,f=void 0;if(u.polygons&&u.polygons.featureSet&&u.polygons.featureSet.features)try{for(var p,h=u.polygons.featureSet.features[Symbol.iterator]();!(s=(p=h.next()).done);s=!0){var b=p.value;(0,v.getBoundsXYZ)(r,b.geometry),(0,d.expandWithAABB)(t,r)}}catch(e){y=!0,f=e}finally{try{s||null==h.return||h.return()}finally{if(y)throw f}}var m=!0,g=!1,S=void 0;if(u.polylines&&u.polylines.featureSet&&u.polylines.featureSet.features)try{for(var x,w=u.polylines.featureSet.features[Symbol.iterator]();!(m=(x=w.next()).done);m=!0){var _=x.value;(0,v.getBoundsXYZ)(r,_.geometry),(0,d.expandWithAABB)(t,r)}}catch(e){g=!0,S=e}finally{try{m||null==w.return||w.return()}finally{if(g)throw S}}var k=!0,I=!1,E=void 0;if(u.points&&u.points.featureSet&&u.points.featureSet.features)try{for(var O,L=u.points.featureSet.features[Symbol.iterator]();!(k=(O=L.next()).done);k=!0){var N=O.value;(0,v.getBoundsXYZ)(r,N.geometry),(0,d.expandWithAABB)(t,r)}}catch(e){I=!0,E=e}finally{try{k||null==L.return||L.return()}finally{if(I)throw E}}var M=!0,P=!1,T=void 0;if(u.mapImages)try{for(var F,A=u.mapImages[Symbol.iterator]();!(M=(F=A.next()).done);M=!0){var C=F.value;(0,v.getBoundsXYZ)(r,C.extent),(0,d.expandWithAABB)(t,r)}}catch(e){P=!0,T=e}finally{try{M||null==A.return||A.return()}finally{if(P)throw T}}}}catch(e){o=!0,l=e}finally{try{n||null==i.return||i.return()}finally{if(o)throw l}}return(0,d.equals)(t,d.NEGATIVE_INFINITY)?null:{xmin:t[0],ymin:t[1],zmin:t[2],xmax:t[3],ymax:t[4],zmax:t[5],spatialReference:c.default.WGS84}}}))}();
//# sourceMappingURL=KMLLayer.61cc80f8.js.map
