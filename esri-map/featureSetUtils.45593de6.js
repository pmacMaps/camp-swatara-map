!function(){function e(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("ct6g2",(function(n,r){e(n.exports,"default",(function(){return p}));var a=t("8TSCy"),i=t("f7ryN"),s=t("3khKC"),u=t("9yzf5"),l=t("gwuml"),o=t("hyZZn"),c=t("10vEZ"),h=t("9AqbE"),f=t("absvu"),d=t("j40xv"),_=t("4nMX7"),p=function(){"use strict";function e(t){a.classCallCheck(this,e),this.recentlyUsedQueries=null,this.featureSetQueryInterceptor=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=u.FeatureServiceDatabaseType.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.globalIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,t&&t.lrucache&&(this.recentlyUsedQueries=t.lrucache),t&&t.interceptor&&(this.featureSetQueryInterceptor=t.interceptor)}return a.createClass(e,[{key:"optimisePagingFeatureQueries",value:function(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)}},{key:"_hasMemorySource",value:function(){return!0}},{key:"prop",value:function(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)}},{key:"end",value:function(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent}},{key:"_ensureLoaded",value:function(){return this.load()}},{key:"load",value:function(){var e=this;return null===this._loadPromise&&(this._loadPromise=(0,c.create)((function(t,n){var r=e;if(!0===e._parent.loaded)return e._initialiseFeatureSet(),void t(e);e._parent.load().then((function(){try{r._initialiseFeatureSet(),t(r)}catch(e){n(e)}}),n)}))),this._loadPromise}},{key:"_initialiseFeatureSet",value:function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.globalIdField=this._parent.globalIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.globalIdField="",this.spatialReference=new(0,d.default)({wkid:4326}),this.geometryType=u.layerGeometryEsriConstants.point)}},{key:"getField",value:function(e,t){var n;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some((function(t){return t&&t.name.toLowerCase()===e&&(n=t),!!n}))),n}},{key:"getFieldsIndex",value:function(){return null===this._fieldsIndex&&(this._fieldsIndex=new(0,_.default)(this.fields)),this._fieldsIndex}},{key:"_maxProcessingRate",value:function(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())}},{key:"_maxQueryRate",value:function(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery}},{key:"_checkCancelled",value:function(e){if(null!==e&&e.aborted)throw new Error("Operation has been cancelled.")}},{key:"nativeCapabilities",value:function(){return this._parent.nativeCapabilities()}},{key:"_canDoAggregates",value:function(e,t,n,r,a){return null===this._parent?(0,c.resolve)(!1):this._parent._canDoAggregates(e,t,n,r,a)}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,n,r,a,i,s){return null===this._parent?(0,c.reject)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,n,r,a,i,s)}},{key:"_getAgregagtePhysicalPage",value:function(e,t,n){return null===this._parent?(0,c.reject)(new Error("Should never be called")):this._parent._getAgregagtePhysicalPage(e,t,n)}},{key:"databaseType",value:function(){if(this._databaseType===u.FeatureServiceDatabaseType.NotEvaluated){var e=this;if(null!==l.default.applicationCache){var t=l.default.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==t)return t}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;var n=[{thetype:u.FeatureServiceDatabaseType.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:u.FeatureServiceDatabaseType.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:u.FeatureServiceDatabaseType.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}],r=(0,c.create)((function(t,r){var a=e;e._getDatabaseTypeImpl(n,0).then((function(e){a._databaseType=e,t(a._databaseType)}),(function(e){r(e)}))}));return null!==l.default.applicationCache&&(l.default.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),r),r=r.catch((function(t){throw l.default.applicationCache.clearDatabaseType(e._cacheableFeatureSetSourceKey()),t}))),this._databaseTypeProbed=r,this._databaseTypeProbed}return(0,c.resolve)(this._databaseType)}},{key:"_cacheableFeatureSetSourceKey",value:function(){return"MUSTBESET"}},{key:"_getDatabaseTypeImpl",value:function(e,t){var n=this;return t>=e.length?(0,c.resolve)(u.FeatureServiceDatabaseType.StandardisedNoInterval):this._runDatabaseProbe(e[t].testwhere).then((function(r){return!0===r?e[t].thetype:n._getDatabaseTypeImpl(e,t+1)}))}},{key:"_runDatabaseProbe",value:function(e){return null!==this._parent?this._parent._runDatabaseProbe(e):(0,c.reject)(new Error("Not Implemented"))}},{key:"isTable",value:function(){return this._parent.isTable()}},{key:"_featureFromCache",value:function(e){if(void 0!==this._featureCache[e])return this._featureCache[e]}},{key:"_isInFeatureSet",value:function(e){return u.IdState.Unknown}},{key:"_getSet",value:function(e){throw new Error("Not implemented in abstract class")}},{key:"_getFeature",value:function(e,t,n){try{var r=this;return this._checkCancelled(n),void 0!==this._featureFromCache(t)?(0,c.resolve)(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),n).then((function(){return r._checkCancelled(n),void 0!==r._featureFromCache(t)?r._featureFromCache(t):(0,c.reject)(new Error("Feature Not Found"))}))}catch(e){return(0,c.reject)(e)}}},{key:"_getFeatureBatch",value:function(e,t){try{var n=this;this._checkCancelled(t);var r=new(0,s.default)([],e,!1,null),a=[];return this._getFeatures(r,-1,e.length,t).then((function(){n._checkCancelled(t);var r=!0,i=!1,s=void 0;try{for(var u,l=e[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var o=u.value;void 0!==n._featureFromCache(o)&&a.push(n._featureFromCache(o))}}catch(e){i=!0,s=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw s}}return a}))}catch(e){return(0,c.reject)(e)}}},{key:"_getFeatures",value:function(e,t,n,r){return(0,c.resolve)("success")}},{key:"_getFilteredSet",value:function(e,t,n,r,a){throw new Error("Not implemented in abstract class")}},{key:"_refineSetBlock",value:function(e,t,n){try{var r=this;if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate()))return this._expandPagedSet(e,this._maxQueryRate(),0,0,n).then((function(){return r._refineSetBlock(e,t,n)}));this._checkCancelled(n);var a=e._candidates.length;this._refineKnowns(e,t);var i=a-e._candidates.length;return 0===e._candidates.length||i>=t?(0,c.resolve)(e):this._refineIfParentKnown(e,t-i,n).then((function(){if(r._checkCancelled(n),r._refineKnowns(e,t-i),(i=a-e._candidates.length)<t&&e._candidates.length>0){var s=r,u=t-i,l=r._prepareFetchAndRefineSet(e._candidates);return r._fetchAndRefineFeatures(l,l.length>u?u:e._candidates.length,n).then((function(){return s._checkCancelled(n),s._refineKnowns(e,t-i),e}))}return e}))}catch(e){return(0,c.reject)(e)}}},{key:"_fetchAndRefineFeatures",value:function(e,t,n){return null}},{key:"_prepareFetchAndRefineSet",value:function(e){for(var t=[],n=0;n<e.length;n++)this._isPhysicalFeature(e[n])&&t.push(e[n]);return t}},{key:"_isPhysicalFeature",value:function(e){return null===this._parent||this._parent._isPhysicalFeature(e)}},{key:"_refineKnowns",value:function(e,t){var n=0,r=null,a=[];t=this._maxQueryRate();for(var i=0;i<e._candidates.length&&"GETPAGES"!==e._candidates[i];i++){var s=!1,l=this._candidateIdTransform(e._candidates[i]);l!==e._candidates[i]&&(s=!0);var o=this._isInFeatureSet(l);if(o===u.IdState.InFeatureSet)!0===s?e._known.indexOf(l)<0&&(e._known.push(l),n+=1):(e._known.push(e._candidates[i]),n+=1),null===r?r={start:i,end:i}:r.end===i-1?r.end=i:(a.push(r),r={start:i,end:i});else if(o===u.IdState.NotInFeatureSet)null===r?r={start:i,end:i}:r.end===i-1?r.end=i:(a.push(r),r={start:i,end:i}),n+=1;else if(o===u.IdState.Unknown&&(n+=1,!0===e._ordered))break;if(n>=t)break}null!==r&&a.push(r);for(var c=a.length-1;c>=0;c--)e._candidates.splice(a[c].start,a[c].end-a[c].start+1)}},{key:"_refineIfParentKnown",value:function(e,t,n){var r=new(0,s.default)([],[],e._ordered,null);return r._candidates=e._candidates.slice(0),this._parent._refineSetBlock(r,t,n)}},{key:"_candidateIdTransform",value:function(e){return this._parent._candidateIdTransform(e)}},{key:"_checkIfNeedToExpandKnownPage",value:function(e,t){if(null===e.pagesDefinition)return!1;for(var n=0,r=e._lastFetchedIndex;r<e._known.length;r++){if("GETPAGES"===e._known[r])return!0;if(void 0===this._featureCache[e._known[r]]&&(n+=1)>=t)break}return!1}},{key:"_checkIfNeedToExpandCandidatePage",value:function(e,t){if(null===e.pagesDefinition)return!1;for(var n=0,r=0;r<e._candidates.length;r++){if("GETPAGES"===e._candidates[r])return!0;if((n+=1)>=t)break}return!1}},{key:"_expandPagedSet",value:function(e,t,n,r,a){return null===this._parent?(0,c.reject)(new Error("Parent Paging not implemented")):this._parent._expandPagedSet(e,t,n,r,a)}},{key:"_expandPagedSetFeatureSet",value:function(e,t,n,r,a){var i=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(r=1),0===r&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(r=2),0===r?(0,c.resolve)("finished"):this._getPage(e,r,a).then((function(r){return n+r<t?i._expandPagedSet(e,t,n+r,0,a):"success"}))}},{key:"_getPage",value:function(e,t,n){var r=this,a=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){a.length=a.length-1;for(var i=0,s=0;s<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+s>=e.pagesDefinition.internal.set.length);s++)a[a.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+s],i++;e.pagesDefinition.resultOffset+=i;var u=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(u=!0),!1===u&&a.push("GETPAGES"),(0,c.resolve)(i)}return this._getPhysicalPage(e,t,n).then((function(){return r._getPage(e,t,n)}))}},{key:"_getPhysicalPage",value:function(e,t,n){return null}},{key:"_clonePageDefinition",value:function(e){return null===this._parent?null:this._parent._clonePageDefinition(e)}},{key:"_first",value:function(e){return this.iterator(e).next()}},{key:"first",value:function(e){return this._first(e)}},{key:"calculateStatistic",value:function(e,t,n,r){var a=this;return this._ensureLoaded().then((function(){return a._stat(e,t,"",null,null,n,r).then((function(i){return!1===i.calculated?a._manualStat(e,t,n,r).then((function(e){return e.result})):i.result}))}))}},{key:"_manualStat",value:function(e,t,n,r){switch(e.toLowerCase()){case"count":return(0,o.count)(this,r).then((function(e){return{calculated:!0,result:e}}));case"distinct":return(0,o.distinct)(this,t,n).then((function(e){return{calculated:!0,result:e}}));case"avg":case"mean":return(0,o.mean)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"stdev":return(0,o.stdev)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"variance":return(0,o.variance)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"sum":return(0,o.sum)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"min":return(0,o.min)(this,t,r).then((function(e){return{calculated:!0,result:e}}));case"max":return(0,o.max)(this,t,r).then((function(e){return{calculated:!0,result:e}}));default:return(0,c.resolve)({calculated:!0,result:0})}}},{key:"_stat",value:function(e,t,n,r,a,i,s){var u=this;return this._parent._stat(e,t,n,r,a,i,s).then((function(l){return!1===l.calculated?null===a&&""===n&&null===r?u._manualStat(e,t,i,s):{calculated:!1}:l}))}},{key:"_unionAllGeomSelf",value:function(e){var t=this,n=this.iterator(this._defaultTracker(e)),r=[];return(0,c.create)((function(e,a){t._unionShapeInBatches(r,n,e,a)}))}},{key:"_unionAllGeom",value:function(e){var t=this;return(0,c.create)((function(n,r){var a=t.iterator(t._defaultTracker(e));t._unionShapeInBatches([],a,n,r)}))}},{key:"_unionShapeInBatches",value:function(e,t,n,r){var a=this;t.next().then((function(i){try{var s=a;null!==i&&null!==i.geometry&&e.push(i.geometry),e.length>30||null===i&&e.length>1?(0,f.union)(e).then((function(a){try{null===i?n(a):(e=[a],s._unionShapeInBatches(e,t,n,r))}catch(e){r(e)}}),r):null===i?1===e.length?n(e[0]):n(null):a._unionShapeInBatches(e,t,n,r)}catch(e){r(e)}}),r)}},{key:"iterator",value:function(e){return new(0,i.default)(this,e)}},{key:"intersection",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e._featuresetFunctions.intersection.bind(this)(t,n)}},{key:"difference",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._featuresetFunctions.difference.bind(this)(t,n,r)}},{key:"symmetricDifference",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._featuresetFunctions.symmetricDifference.bind(this)(t,n,r)}},{key:"morphShape",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return e._featuresetFunctions.morphShape.bind(this)(t,n,r,a)}},{key:"morphShapeAndAttributes",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"unknown";return e._featuresetFunctions.morphShapeAndAttributes.bind(this)(t,n,r)}},{key:"union",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e._featuresetFunctions.union.bind(this)(t,n)}},{key:"intersects",value:function(t){return e._featuresetFunctions.intersects.bind(this)(t)}},{key:"envelopeIntersects",value:function(t){return e._featuresetFunctions.envelopeIntersects.bind(this)(t)}},{key:"contains",value:function(t){return e._featuresetFunctions.contains.bind(this)(t)}},{key:"overlaps",value:function(t){return e._featuresetFunctions.overlaps.bind(this)(t)}},{key:"relate",value:function(t,n){return e._featuresetFunctions.relate.bind(this)(t,n)}},{key:"within",value:function(t){return e._featuresetFunctions.within.bind(this)(t)}},{key:"touches",value:function(t){return e._featuresetFunctions.touches.bind(this)(t)}},{key:"top",value:function(t){return e._featuresetFunctions.top.bind(this)(t)}},{key:"crosses",value:function(t){return e._featuresetFunctions.crosses.bind(this)(t)}},{key:"buffer",value:function(t,n,r){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e._featuresetFunctions.buffer.bind(this)(t,n,r,a)}},{key:"filter",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e._featuresetFunctions.filter.bind(this)(t,n)}},{key:"orderBy",value:function(t){return e._featuresetFunctions.orderBy.bind(this)(t)}},{key:"dissolve",value:function(t,n){return e._featuresetFunctions.dissolve.bind(this)(t,n)}},{key:"groupby",value:function(t,n){return e._featuresetFunctions.groupby.bind(this)(t,n)}},{key:"reduce",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=this;return(0,c.create)((function(a,i){r._reduceImpl(r.iterator(r._defaultTracker(n)),e,t,0,a,i,0)}))}},{key:"_reduceImpl",value:function(e,t,n,r,a,i,s){try{var u=this;if(++s>1e3)return void setTimeout((function(){s=0,u._reduceImpl(e,t,n,r,a,i,s)}));e.next().then((function(l){try{if(null===l)a(n);else{var o=u,h=t(n,l,r,u);(0,c.isPromiseLike)(h)?h.then((function(n){o._reduceImpl(e,t,n,r+1,a,i,s)}),i):u._reduceImpl(e,t,h,r+1,a,i,s)}}catch(e){i(e)}}),i)}catch(e){i(e)}}},{key:"removeField",value:function(t){return e._featuresetFunctions.removeField.bind(this)(t)}},{key:"addField",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e._featuresetFunctions.addField.bind(this)(t,n,r)}},{key:"sumArea",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=(0,u.convertSquareUnitsToCode)(e);return this.reduce((function(e,n){return null===n.geometry?0:t?(0,f.geodesicArea)(n.geometry,r).then((function(t){return e+t})):(0,f.planarArea)(n.geometry,r).then((function(t){return e+t}))}),0,n)}},{key:"sumLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=(0,u.convertLinearUnitsToCode)(e);return this.reduce((function(e,n){return null===n.geometry?0:t?(0,f.geodesicLength)(n.geometry,r).then((function(t){return e+t})):(0,f.planarLength)(n.geometry,r).then((function(t){return e+t}))}),0,n)}},{key:"_substituteVars",value:function(e,t){if(null!==t){var n={};for(var r in t)n[r.toLowerCase()]=t[r];e.parameters=n}}},{key:"distinct",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,a=this;return this.load().then((function(){var i=h.WhereClause.create(e,a.getFieldsIndex());return a._substituteVars(i,n),a.calculateStatistic("distinct",i,t,a._defaultTracker(r))}))}},{key:"min",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=this;return this.load().then((function(){var a=h.WhereClause.create(e,r.getFieldsIndex());return r._substituteVars(a,t),r.calculateStatistic("min",a,-1,r._defaultTracker(n))}))}},{key:"max",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=this;return this.load().then((function(){var a=h.WhereClause.create(e,r.getFieldsIndex());return r._substituteVars(a,t),r.calculateStatistic("max",a,-1,r._defaultTracker(n))}))}},{key:"avg",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=this;return this.load().then((function(){var a=h.WhereClause.create(e,r.getFieldsIndex());return r._substituteVars(a,t),r.calculateStatistic("avg",a,-1,r._defaultTracker(n))}))}},{key:"sum",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=this;return this.load().then((function(){var a=h.WhereClause.create(e,r.getFieldsIndex());return r._substituteVars(a,t),r.calculateStatistic("sum",a,-1,r._defaultTracker(n))}))}},{key:"stdev",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=this;return this.load().then((function(){var a=h.WhereClause.create(e,r.getFieldsIndex());return r._substituteVars(a,t),r.calculateStatistic("stdev",a,-1,r._defaultTracker(n))}))}},{key:"variance",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0,r=this;return this.load().then((function(){var a=h.WhereClause.create(e,r.getFieldsIndex());return r._substituteVars(a,t),r.calculateStatistic("variance",a,-1,r._defaultTracker(n))}))}},{key:"count",value:function(e){var t=this;return this.load().then((function(){return t.calculateStatistic("count",h.WhereClause.create("1",t.getFieldsIndex()),-1,t._defaultTracker(e))}))}},{key:"_defaultTracker",value:function(e){return e||{aborted:!1}}},{key:"forEach",value:function(e,t){var n=this;return(0,c.create)((function(r,a){n._forEachImpl(n.iterator(n._defaultTracker(t)),e,n,r,a,0)}))}},{key:"_forEachImpl",value:function(e,t,n,r,a,i){try{var s=this;if(++i>1e3)return void setTimeout((function(){i=0,s._forEachImpl(e,t,n,r,a,i)}),0);e.next().then((function(u){try{if(null===u)r(n);else{var l=s,o=t(u);null==o?s._forEachImpl(e,t,n,r,a,i):(0,c.isPromiseLike)(o)?o.then((function(){try{l._forEachImpl(e,t,n,r,a,i)}catch(e){a(e)}}),a):s._forEachImpl(e,t,n,r,a,i)}}catch(e){a(e)}}),a)}catch(e){a(e)}}},{key:"convertToJSON",value:function(e){for(var t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}},n=0;n<this.fields.length;n++)t.layerDefinition.fields.push((0,u.esriFieldToJson)(this.fields[n]));return this.reduce((function(e,n){var r={geometry:n.geometry&&n.geometry.toJSON(),attributes:{}};for(var a in n.attributes)r.attributes[a]=n.attributes[a];return t.featureSet.features.push(r),1}),0,e).then((function(){return t}))}},{key:"castToText",value:function(){return"object, FeatureSet"}},{key:"queryAttachments",value:function(e,t,n,r,a){return this._parent.queryAttachments(e,t,n,r,a)}},{key:"serviceUrl",value:function(){return this._parent.serviceUrl()}},{key:"subtypes",value:function(){return this.typeIdField?{subtypeField:this.typeIdField,subtypes:this.types?this.types.map((function(e){return{name:e.name,code:e.id}})):[]}:null}},{key:"relationshipMetaData",value:function(){return this._parent.relationshipMetaData()}},{key:"gdbVersion",get:function(){return this._parent?this._parent.gdbVersion:""}},{key:"schema",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var a,i=this.fields[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;e.push((0,u.esriFieldToJson)(s))}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}return{objectIdField:this.objectIdField,globalIdField:this.globalIdField,geometryType:void 0===u.layerGeometryEsriRestConstants[this.geometryType]?"":u.layerGeometryEsriRestConstants[this.geometryType],fields:e}}},{key:"convertToText",value:function(e,t){var n=this;return"schema"===e?this._ensureLoaded().then((function(){return JSON.stringify(n.schema())})):"featureset"===e?this._ensureLoaded().then((function(){var e=n,r=[];return n.reduce((function(e,t){var n={geometry:t.geometry?t.geometry.toJSON():null,attributes:t.attributes};return null!==n.geometry&&n.geometry.spatialReference&&delete n.geometry.spatialReference,r.push(n),1}),0,t).then((function(){var t=e.schema();return t.features=r,t.spatialReference=e.spatialReference.toJSON(),JSON.stringify(t)}))})):(0,c.resolve)(this.castToText())}},{key:"getFeatureByObjectId",value:function(e,t){return this._parent.getFeatureByObjectId(e,t)}},{key:"getOwningSystemUrl",value:function(){return this._parent.getOwningSystemUrl()}},{key:"getIdentityUser",value:function(){return this._parent.getIdentityUser()}},{key:"getRootFeatureSet",value:function(){return null!==this._parent?this._parent.getRootFeatureSet():this}},{key:"getDataSourceFeatureSet",value:function(){return null!==this._parent?this._parent.getDataSourceFeatureSet():this}},{key:"castAsJson",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return"keeptype"===(null==e?void 0:e.featureset)?this:"none"===(null==e?void 0:e.featureset)?null:{type:"FeatureSet"}}},{key:"castAsJsonAsync",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this;return"keeptype"===(null==t?void 0:t.featureset)?(0,c.resolve)(this):"schema"===(null==t?void 0:t.featureset)?this._ensureLoaded().then((function(){return JSON.parse(JSON.stringify(n.schema()))})):"none"===(null==t?void 0:t.featureset)?(0,c.resolve)(null):this._ensureLoaded().then((function(){var r=n,a=[];return n.reduce((function(e,n){var r={geometry:n.geometry?!0===(null==t?void 0:t.keepGeometryType)?n.geometry:n.geometry.toJSON():null,attributes:n.attributes};return null!==r.geometry&&r.geometry.spatialReference&&!0!==(null==t?void 0:t.keepGeometryType)&&delete r.geometry.spatialReference,a.push(r),1}),0,e).then((function(){var e=r.schema();return e.features=a,e.spatialReference=!0===(null==t?void 0:t.keepGeometryType)?r.spatialReference:r.spatialReference.toJSON(),e}))}))}}]),e}();p._featuresetFunctions={}})),t.register("f7ryN",(function(n,r){e(n.exports,"default",(function(){return s}));var a=t("8TSCy"),i=t("10vEZ"),s=function(){"use strict";function e(t,n){a.classCallCheck(this,e),this._lastId=-1,this._progress=n,this._parent=t}return a.createClass(e,[{key:"reset",value:function(){this._lastId=-1}},{key:"nextBatch",value:function(e){var t=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(n){return t.nextBatch(e)}),(function(n){return t.nextBatch(e)}));var n={returnpromise:null,hasset:!1},r=[];return n.returnpromise=(0,i.create)((function(a,i){var s=t;t._parent._getSet(t._progress).then((function(t){var u=s,l=t._known.length-1;if("GETPAGES"===t._known[t._known.length-1]&&(l-=1),s._lastId+e>l&&t._known.length>0&&"GETPAGES"===t._known[t._known.length-1])s._parent._expandPagedSet(t,s._parent._maxQueryRate(),0,0,s._progress).then((function(t){n.hasset=!0,u._parent._mainSetInUse=null,u.nextBatch(e).then(a,i)}),(function(e){n.hasset=!0,u._parent._mainSetInUse=null,i(e)}));else{var o=s;if(l>=s._lastId+e||0===t._candidates.length){for(var c=s,h=0;h<e;h++){var f=h+s._lastId+1;if(f>=t._known.length)break;r[h]=t._known[f]}return s._lastId+=r.length,0===r.length&&(n.hasset=!0,s._parent._mainSetInUse=null,a([])),void s._parent._getFeatureBatch(r,s._progress).then((function(e){n.hasset=!0,c._parent._mainSetInUse=null,a(e)}),(function(e){n.hasset=!0,c._parent._mainSetInUse=null,i(e)}))}s._parent._refineSetBlock(t,s._parent._maxProcessingRate(),s._progress).then((function(){n.hasset=!0,o._parent._mainSetInUse=null,o.nextBatch(e).then(a,i)}),(function(e){n.hasset=!0,o._parent._mainSetInUse=null,i(e)}))}}),(function(e){n.hasset=!0,s._parent._mainSetInUse=null,i(e)}))})),!1===n.hasset&&(this._parent._mainSetInUse=n.returnpromise,n.hasset=!0),n.returnpromise}},{key:"next",value:function(){var e=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then((function(t){return e.next()}),(function(t){return e.next()}));var t={returnpromise:null,hasset:!1};return t.returnpromise=(0,i.create)((function(n,r){var a=e;e._parent._getSet(e._progress).then((function(e){var i=a;a._lastId<e._known.length-1?"GETPAGES"===e._known[a._lastId+1]?a._parent._expandPagedSet(e,a._parent._maxQueryRate(),0,0,a._progress).then((function(e){return t.hasset=!0,i._parent._mainSetInUse=null,i.next()})).then(n,r):(a._lastId+=1,a._parent._getFeature(e,e._known[a._lastId],a._progress).then((function(e){t.hasset=!0,i._parent._mainSetInUse=null,n(e)}),(function(e){t.hasset=!0,i._parent._mainSetInUse=null,r(e)}))):e._candidates.length>0?a._parent._refineSetBlock(e,a._parent._maxProcessingRate(),a._progress).then((function(){t.hasset=!0,i._parent._mainSetInUse=null,i.next().then(n,r)}),(function(e){t.hasset=!0,i._parent._mainSetInUse=null,r(e)})):(t.hasset=!0,a._parent._mainSetInUse=null,n(null))}),(function(e){t.hasset=!0,a._parent._mainSetInUse=null,r(e)}))})),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise}},{key:"count",value:function(){var e=this;return-1!==this._parent._totalCount?(0,i.resolve)(this._parent._totalCount):this._parent._getSet(this._progress).then((function(t){return e._refineAllSets(t)})).then((function(t){return e._parent._totalCount=t._known.length,(0,i.resolve)(e._parent._totalCount)}))}},{key:"_refineAllSets",value:function(e){var t=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress).then((function(n){return t._refineAllSets(e)})).then((function(e){return(0,i.resolve)(e)})):e._candidates.length>0?"GETPAGES"===e._known[e._candidates.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress).then((function(n){return t._refineAllSets(e)})).then((function(e){return(0,i.resolve)(e)})):this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress).then((function(e){return e._candidates.length>0?t._refineAllSets(e):(0,i.resolve)(e)})):(0,i.resolve)(e)}}]),e}()})),t.register("3khKC",(function(n,r){e(n.exports,"default",(function(){return i}));var a=t("8TSCy"),i=function e(t,n,r,i){"use strict";a.classCallCheck(this,e),this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=t,this._known=n,this._ordered=r,this.pagesDefinition=i}})),t.register("gwuml",(function(n,r){e(n.exports,"default",(function(){return i}));var a=t("8TSCy"),i=function(){"use strict";function e(){a.classCallCheck(this,e),this._databaseTypeMetaData={},this._layerInfo={}}return a.createClass(e,[{key:"clearDatabaseType",value:function(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]}},{key:"getDatabaseType",value:function(e){return"MUSTBESET"===e||void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]}},{key:"setDatabaseType",value:function(e,t){this._databaseTypeMetaData[e]=t}},{key:"getLayerInfo",value:function(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]}},{key:"setLayerInfo",value:function(e,t){this._layerInfo[e]=t}},{key:"clearLayerInfo",value:function(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]}}]),e}();i.applicationCache=null})),t.register("hyZZn",(function(n,r){e(n.exports,"decodeStatType",(function(){return d})),e(n.exports,"calculateStat",(function(){return _})),e(n.exports,"min",(function(){return p})),e(n.exports,"max",(function(){return v})),e(n.exports,"mean",(function(){return y})),e(n.exports,"variance",(function(){return g})),e(n.exports,"stdev",(function(){return m})),e(n.exports,"sum",(function(){return S})),e(n.exports,"count",(function(){return k})),e(n.exports,"distinct",(function(){return F}));var a=t("e8oaX"),i=t("9yzf5"),s=t("jA3R1"),u=t("10vEZ");function l(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t/e.length}function o(e){for(var t=l(e),n=0,r=0;r<e.length;r++)n+=Math.pow(t-e[r],2);return n/e.length}function c(e){for(var t=l(e),n=0,r=0;r<e.length;r++)n+=Math.pow(t-e[r],2);return n/(e.length-1)}function h(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function f(e,t){for(var n=[],r={},a=[],s=0;s<e.length;s++){if(void 0!==e[s]&&null!==e[s]){var u=e[s];if((0,i.isNumber)(u)||(0,i.isString)(u))void 0===r[u]&&(n.push(u),r[u]=1);else{for(var l=!1,o=0;o<a.length;o++)!0===(0,i.equalityTest)(a[o],u)&&(l=!0);!1===l&&(a.push(u),n.push(u))}}if(n.length>=t&&-1!==t)return n}return n}function d(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""}function _(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;switch(e.toLowerCase()){case"distinct":return f(t,n);case"avg":case"mean":return l(t);case"min":return Math.min.apply(Math,t);case"sum":return h(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(o(t));case"var":case"variance":return o(t);case"count":return t.length}return 0}function p(e,t,n){return T(e,t,n,!0).then((function(e){return 0===e.length?null:Math.min.apply(Math,e)}))}function v(e,t,n){return T(e,t,n,!0).then((function(e){return 0===e.length?null:Math.max.apply(Math,e)}))}function y(e,t,n){var r="";return!1===(0,s.isSingleField)(t)&&(r=(0,s.predictType)(t,e.fields,null)),T(e,t,n,!0).then((function(e){if(0===e.length)return null;var t,n=l(e);return null===n?n:"integer"===r?(t=+(t=n),isFinite(t)?t-t%1||(t<0?-0:0===t?t:0):t):n}))}function g(e,t,n){return T(e,t,n,!0).then((function(e){return 0===e.length?null:c(e)}))}function m(e,t,n){return T(e,t,n,!0).then((function(e){return 0===e.length?null:Math.sqrt(c(e))}))}function S(e,t,n){return T(e,t,n,!0).then((function(e){return 0===e.length?null:h(e)}))}function k(e,t){try{return e.iterator(t).count()}catch(e){return(0,u.reject)(e)}}function T(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{var a=e.iterator(n);return(0,u.create)((function(e,n){b(a,[],t,r,e,n)}))}catch(e){return(0,u.reject)(e)}}function b(e,t,n,r,i,s){(0,a.X)(e.next().then((function(a){try{if(null!==a){var u=n.calculateValue(a);return null===u?!1===r&&(t[t.length]=u):t[t.length]=u,b(e,t,n,r,i,s)}i(t)}catch(e){s(e)}}),s))}function F(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return I(e,t,n,r)}function I(e,t,n,r){try{return w(e.iterator(r),{},[],t,n)}catch(e){return(0,u.reject)(e)}}function w(e,t,n,r,a){return e.next().then((function(i){if(null!==i){var s=r.calculateValue(i);return null!=s&&void 0===t[s]&&(n.push(s),t[s]=1),n.length>=a&&-1!==a?n:w(e,t,n,r,a)}return n}))}})),t.register("jA3R1",(function(n,r){e(n.exports,"toWhereClause",(function(){return u})),e(n.exports,"toWhereClauseFromTree",(function(){return l})),e(n.exports,"reformulateWithoutField",(function(){return o})),e(n.exports,"combine",(function(){return c})),e(n.exports,"convertIntervalToSql",(function(){return b})),e(n.exports,"makeDateString",(function(){return d})),e(n.exports,"makeToday",(function(){return _})),e(n.exports,"translateFunctionToDatabaseSpecific",(function(){return f})),e(n.exports,"predictType",(function(){return p})),e(n.exports,"scanForField",(function(){return m})),e(n.exports,"isSingleField",(function(){return S}));var a=t("9yzf5"),i=t("9AqbE"),s=t("abR4U");function u(e,t){return h(e.parseTree,t,e.parameters)}function l(e,t,n){return h(e,t,n)}function o(e,t,n,r){return i.WhereClause.create(h(e.parseTree,a.FeatureServiceDatabaseType.Standardised,e.parameters,t,n),r)}function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"AND";return i.WhereClause.create("(("+u(e,a.FeatureServiceDatabaseType.Standardised)+")"+n+"("+u(t,a.FeatureServiceDatabaseType.Standardised)+"))",e.fieldsIndex)}function h(e,t,n){var r,a,i,s,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;switch(e.type){case"interval":return b(h(e.value,t,n,u,l),e.qualifier,e.op);case"case_expression":var o=" CASE ";"simple"===e.format&&(o+=h(e.operand,t,n,u,l));for(var c=0;c<e.clauses.length;c++)o+=" WHEN "+h(e.clauses[c].operand,t,n,u,l)+" THEN "+h(e.clauses[c].value,t,n,u,l);return null!==e.else&&(o+=" ELSE "+h(e.else,t,n,u,l)),o+=" END ";case"param":var p=n[e.value.toLowerCase()];if("string"==typeof p)return"'"+n[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(p instanceof Date)return d(p,t);if(p instanceof Array){for(var v=[],y=0;y<p.length;y++)"string"==typeof p[y]?v.push("'"+p[y].toString().replace(/'/g,"''")+"'"):p[y]instanceof Date?v.push(d(p[y],t)):v.push(p[y].toString());return v}return p.toString();case"expr_list":a=[];var g=!0,m=!1,S=void 0;try{for(var k,T=e.value[Symbol.iterator]();!(g=(k=T.next()).done);g=!0){var F=k.value;a.push(h(F,t,n,u,l))}}catch(e){m=!0,S=e}finally{try{g||null==T.return||T.return()}finally{if(m)throw S}}return a;case"unary_expr":return" ( NOT "+h(e.expr,t,n,u,l)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+h(e.left,t,n,u,l)+" AND "+h(e.right,t,n,u,l)+") ";case"OR":return" ("+h(e.left,t,n,u,l)+" OR "+h(e.right,t,n,u,l)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+h(e.left,t,n,u,l)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+h(e.left,t,n,u,l)+" IS NOT NULL )";case"IN":return r=[],"expr_list"===e.right.type?(r=h(e.right,t,n,u,l)," ("+h(e.left,t,n,u,l)+" IN ("+r.join(",")+")) "):(s=h(e.right,t,n,u,l))instanceof Array?" ("+h(e.left,t,n,u,l)+" IN ("+s.join(",")+")) ":" ("+h(e.left,t,n,u,l)+" IN ("+s+")) ";case"NOT IN":return r=[],"expr_list"===e.right.type?(r=h(e.right,t,n,u,l)," ("+h(e.left,t,n,u,l)+" NOT IN ("+r.join(",")+")) "):(s=h(e.right,t,n,u,l))instanceof Array?" ("+h(e.left,t,n,u,l)+" NOT IN ("+s.join(",")+")) ":" ("+h(e.left,t,n,u,l)+" NOT IN ("+s+")) ";case"BETWEEN":return i=h(e.right,t,n,u,l)," ("+h(e.left,t,n,u,l)+" BETWEEN "+i[0]+" AND "+i[1]+" ) ";case"NOTBETWEEN":return i=h(e.right,t,n,u,l)," ("+h(e.left,t,n,u,l)+" NOT BETWEEN "+i[0]+" AND "+i[1]+" ) ";case"LIKE":return""!==e.escape?" ("+h(e.left,t,n,u,l)+" LIKE "+h(e.right,t,n,u,l)+" ESCAPE '"+e.escape+"') ":" ("+h(e.left,t,n,u,l)+" LIKE "+h(e.right,t,n,u,l)+") ";case"NOT LIKE":return""!==e.escape?" ("+h(e.left,t,n,u,l)+" NOT LIKE "+h(e.right,t,n,u,l)+" ESCAPE '"+e.escape+"') ":" ("+h(e.left,t,n,u,l)+" NOT LIKE "+h(e.right,t,n,u,l)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+h(e.left,t,n,u,l)+" "+e.operator+" "+h(e.right,t,n,u,l)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return d(e.value,t);case"number":return e.value.toString();case"current_time":return _("date"===e.mode,t);case"column_ref":return u&&u.toLowerCase()===e.column.toLowerCase()?"("+l+")":e.column;case"function":var I=h(e.args,t,n,u,l);return f(e.name,I,t)}throw new Error("Unsupported sql syntax "+e.type)}function f(e,t,n){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(n){case a.FeatureServiceDatabaseType.Standardised:case a.FeatureServiceDatabaseType.StandardisedNoInterval:}return"CEILING("+t[0]+")";case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||t.length>2)throw new Error("Invalid Parameter for TRUNCATE function");return n===a.FeatureServiceDatabaseType.SqlServer?"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)":"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")");case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(n){case a.FeatureServiceDatabaseType.SqlServer:return"LEN("+t[0]+")";case a.FeatureServiceDatabaseType.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");for(var r="CONCAT(",i=0;i<t.length;i++)0!==i&&(r+=","),r+=t[i];return r+=")";case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":var s="";switch(n){case a.FeatureServiceDatabaseType.Oracle:return s="SUBSTR("+t[0]+","+t[1],3===t.length&&(s+=","+t[2]),s+=")";case a.FeatureServiceDatabaseType.SqlServer:return s=3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")";default:return s="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(s+=" FOR "+t[2]),s+=")"}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")}function d(e,t){var n=s.DateTime.fromJSDate(e),r=0===n.hour&&0===n.minute&&0===n.second&&0===n.millisecond;switch(t){case a.FeatureServiceDatabaseType.FILEGDB:case a.FeatureServiceDatabaseType.Standardised:case a.FeatureServiceDatabaseType.StandardisedNoInterval:return"date '".concat(r?n.toFormat("yyyy-LL-dd"):n.toFormat("yyyy-LL-dd HH:mm:ss"),"'");case a.FeatureServiceDatabaseType.Oracle:return r?"TO_DATE('".concat(n.toFormat("yyyy-LL-dd"),"','YYYY-MM-DD')"):"TO_DATE('".concat(n.toFormat("yyyy-LL-dd HH:mm:ss"),"','YYYY-MM-DD HH24:MI:SS')");case a.FeatureServiceDatabaseType.SqlServer:return"'".concat(n.toFormat(r?"yyyy-LL-dd":"yyyy-LL-dd HH:mm:ss"),"'");case a.FeatureServiceDatabaseType.PGDB:return"#".concat(n.toFormat(r?"LL-dd-yyyy":"LL-dd-yyyy HH:mm:ss"),"#");case a.FeatureServiceDatabaseType.Postgres:return"TIMESTAMP '".concat(n.toFormat(r?"yyyy-LL-dd":"yyyy-LL-dd HH:mm:ss"),"'");default:return"date '".concat(n.toFormat("yyyy-LL-dd HH:mm:ss"),"'")}}function _(e,t){switch(t){case a.FeatureServiceDatabaseType.FILEGDB:case a.FeatureServiceDatabaseType.Standardised:case a.FeatureServiceDatabaseType.StandardisedNoInterval:case a.FeatureServiceDatabaseType.Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case a.FeatureServiceDatabaseType.SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case a.FeatureServiceDatabaseType.PGDB:case a.FeatureServiceDatabaseType.Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r={},a={},i={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"},s=!0,u=!1,l=void 0;try{for(var o,c=t[Symbol.iterator]();!(s=(o=c.next()).done);s=!0){var h=o.value,f=i[h.type];r[h.name.toLowerCase()]=void 0===f?"":f}}catch(e){u=!0,l=e}finally{try{s||null==c.return||c.return()}finally{if(u)throw l}}for(var d in n){var _=i[n[d]];a[d.toLowerCase()]=void 0===_?"":_}switch(v(r,e.parseTree,e.parameters,a)){case"double":return"double";case"integer":return"integer";case"date":return"date";case"string":return"string"}return""}function v(e,t,n,r){var a;switch(t.type){case"interval":return"integer";case"case_expression":var i=[];if("simple"===t.format){for(var s=0;s<t.clauses.length;s++)i.push(v(e,t.clauses[s].value,n,r));null!==t.else&&i.push(v(e,t.else,n,r))}else{for(var u=0;u<t.clauses.length;u++)i.push(v(e,t.else,n,r));null!==t.else&&i.push(v(e,t.else,n,r))}return g(i);case"param":var l=r[t.value.toLowerCase()];if(void 0===l&&n){var o=n[t.value.toLowerCase()];if(void 0===o)return"";if(null===o)return"";if("string"==typeof o||o instanceof String)return"string";if("boolean"==typeof o)return"boolean";if(o instanceof Date)return"date";if("number"==typeof o)return o%1==0?"integer":"double"}return void 0===l?"":l;case"expr_list":var c=[],h=!0,f=!1,d=void 0;try{for(var _,p=t.value[Symbol.iterator]();!(h=(_=p.next()).done);h=!0){var y=_.value;c.push(v(e,y,n,r))}}catch(e){f=!0,d=e}finally{try{h||null==p.return||p.return()}finally{if(f)throw d}}return c;case"unary_expr":return"boolean";case"binary_expr":switch(t.operator){case"AND":case"OR":case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"IS":case"ISNOT":if("null"!==t.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"*":case"-":case"+":case"/":return g([v(e,t.left,n,r),v(e,t.right,n,r)]);default:throw new Error("Not Supported Operator "+t.operator)}case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===t.value?"":t.value%1==0?"integer":"double";case"date":case"timestamp":case"current_time":return"date";case"column_ref":var m=e[t.column.toLowerCase()];return void 0===m?"":m;case"function":switch(t.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":return(a=v(e,t.args,n,r))instanceof Array?a.length>0?a[0]:"":a;case"sign":return(a=v(e,t.args,n,r))instanceof Array&&(a=g(a)),"integer"===a||"double"===a?a:"double";case"ceiling":case"floor":case"abs":var S=v(e,t.args,n,r);return S instanceof Array?g(S):S;case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":case"truncate":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string"}return""}throw new Error("Unsupported sql syntax "+t.type)}var y={boolean:1,string:2,integer:3,double:4,date:5};function g(e){if(e){var t="",n=!0,r=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var u=i.value;""!==u&&(t=""===t||y[t]<y[u]?u:t)}}catch(e){r=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}return t}return""}function m(e,t){return k(e.parseTree,t)}function S(e){return"column_ref"===e.parseTree.type}function k(e,t){if(null==e)return!1;switch(e.type){case"when_clause":return k(e.operand,t)||k(e.value,t);case"case_expression":var n=!0,r=!1,a=void 0;try{for(var i,s=e.clauses[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){if(k(i.value,t))return!0}}catch(e){r=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}return!("simple"!==e.format||!k(e.operand,t))||!(null===e.else||!k(e.else,t));case"param":case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"expr_list":var u=!0,l=!1,o=void 0;try{for(var c,h=e.value[Symbol.iterator]();!(u=(c=h.next()).done);u=!0){if(k(c.value,t))return!0}}catch(e){l=!0,o=e}finally{try{u||null==h.return||h.return()}finally{if(l)throw o}}return!1;case"unary_expr":return k(e.expr,t);case"binary_expr":return k(e.left,t)||k(e.right,t);case"column_ref":return t.toLowerCase()===e.column.toLowerCase();case"function":return k(e.args,t)}return!1}function T(e){var t="";return t+=e.period.toUpperCase()}function b(e,t,n){return"INTERVAL "+n+" "+e+" "+("interval-period"===t.type?T(t):T(t.start)+" TO "+T(t.end))}})),t.register("bfO0j",(function(n,r){e(n.exports,"default",(function(){return h}));var a=t("8TSCy"),i=t("cHwtI"),s=t("ct6g2"),u=t("3khKC"),l=t("9yzf5"),o=t("10vEZ"),c=t("absvu"),h=function(e){"use strict";a.inherits(n,e);var t=a.createSuper(n);function n(e){var r;return a.classCallCheck(this,n),(r=t.call(this,e))._relation="",r._relationGeom=null,r._relationString="",r.declaredClass="esri.arcade.featureset.actions.SpatialFilter",r._relationString=e.relationString,r._parent=e.parentfeatureset,r._maxProcessing=40,r._relation=e.relation,r._relationGeom=e.relationGeom,a.possibleConstructorReturn(r)}return a.createClass(n,[{key:"_getSet",value:function(e){var t=this;return null===this._wset?this._ensureLoaded().then((function(){return t._parent._getFilteredSet("esriSpatialRelRelation"!==t._relation?t._relation:t._relation+":"+t._relationString,t._relationGeom,null,null,e)})).then((function(n){return t._checkCancelled(e),t._wset=new(0,u.default)(n._candidates.slice(0),n._known.slice(0),n._ordered,t._clonePageDefinition(n.pagesDefinition)),t._wset})):(0,o.resolve)(this._wset)}},{key:"_isInFeatureSet",value:function(e){var t=this._parent._isInFeatureSet(e);return t===l.IdState.NotInFeatureSet?t:void 0===(t=this._idstates[e])?l.IdState.Unknown:t}},{key:"_getFeature",value:function(e,t,n){return this._parent._getFeature(e,t,n)}},{key:"_getFeatures",value:function(e,t,n,r){return this._parent._getFeatures(e,t,n,r)}},{key:"_featureFromCache",value:function(e){return this._parent._featureFromCache(e)}},{key:"executeSpatialRelationTest",value:function(e){if(null===e.geometry)return(0,o.resolve)(!1);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":var t=(0,l.shapeExtent)(this._relationGeom),n=(0,l.shapeExtent)(e.geometry);return(0,c.intersects)(t,n);case"esriSpatialRelIntersects":return(0,c.intersects)(this._relationGeom,e.geometry);case"esriSpatialRelContains":return(0,c.contains)(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return(0,c.overlaps)(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return(0,c.within)(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return(0,c.touches)(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return(0,c.crosses)(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return(0,c.relate)(this._relationGeom,e.geometry,this._relationString)}}},{key:"_fetchAndRefineFeatures",value:function(e,t,n){var r=this,a=new(0,u.default)([],e,!1,null),i=Math.min(t,e.length);return this._parent._getFeatures(a,-1,i,n).then((function(){r._checkCancelled(n);for(var t=[],a=0;a<i;a++){var s=r._parent._featureFromCache(e[a]);t.push(r.executeSpatialRelationTest(s))}return(0,o.all)(t)})).then((function(n){for(var a=0;a<t;a++)!0===n[a]?r._idstates[e[a]]=l.IdState.InFeatureSet:r._idstates[e[a]]=l.IdState.NotInFeatureSet;return"success"}))}},{key:"_getFilteredSet",value:function(e,t,n,r,a){var i=this;return this._ensureLoaded().then((function(){return i._parent._getFilteredSet("esriSpatialRelRelation"!==i._relation?i._relation:i._relation+":"+i._relationString,i._relationGeom,n,r,a)})).then((function(e){return i._checkCancelled(a),null!==t?new(0,u.default)(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,i._clonePageDefinition(e.pagesDefinition)):new(0,u.default)(e._candidates.slice(0),e._known.slice(0),e._ordered,i._clonePageDefinition(e.pagesDefinition))}))}},{key:"_stat",value:function(e,t,n,r,a,i,s){var u=this;return""!==n?(0,o.resolve)({calculated:!1}):this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,s).then((function(l){return!1===l.calculated?null===a&&""===n&&null===r?u._manualStat(e,t,i,s):{calculated:!1}:l}))}},{key:"_canDoAggregates",value:function(e,t,n,r,a){return""!==n||null!==r||null===this._parent?(0,o.resolve)(!1):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a)}},{key:"_getAggregatePagesDataSourceDefinition",value:function(e,t,n,r,a,i,s){return null===this._parent?(0,o.reject)(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,s)}}],[{key:"registerAction",value:function(){s.default._featuresetFunctions.intersects=function(e){return null==e?new(0,i.default)({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},s.default._featuresetFunctions.envelopeIntersects=function(e){return null==e?new(0,i.default)({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},s.default._featuresetFunctions.contains=function(e){return null==e?new(0,i.default)({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},s.default._featuresetFunctions.overlaps=function(e){return null==e?new(0,i.default)({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},s.default._featuresetFunctions.within=function(e){return null==e?new(0,i.default)({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},s.default._featuresetFunctions.touches=function(e){return null==e?new(0,i.default)({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},s.default._featuresetFunctions.crosses=function(e){return null==e?new(0,i.default)({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},s.default._featuresetFunctions.relate=function(e,t){return null==e?new(0,i.default)({parentfeatureset:this}):new n({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})}}}]),n}(s.default)})),t.register("cHwtI",(function(n,r){e(n.exports,"default",(function(){return o}));var a=t("8TSCy"),i=t("ct6g2"),s=t("3khKC"),u=t("9yzf5"),l=t("10vEZ"),o=function(e){"use strict";a.inherits(n,e);var t=a.createSuper(n);function n(e){var r;return a.classCallCheck(this,n),(r=t.call(this,e)).declaredClass="esri.layers.featureset.sources.Empty",r._maxProcessing=1e3,r._wset=new(0,s.default)([],[],!1,null),r._parent=e.parentfeatureset,r._databaseType=u.FeatureServiceDatabaseType.Standardised,a.possibleConstructorReturn(r)}return a.createClass(n,[{key:"_getSet",value:function(){return(0,l.resolve)(this._wset)}},{key:"optimisePagingFeatureQueries",value:function(){}},{key:"_isInFeatureSet",value:function(){return u.IdState.NotInFeatureSet}},{key:"_getFeature",value:function(){return(0,l.reject)(new Error("No Feature Found in EmptySet"))}},{key:"queryAttachments",value:function(){return(0,l.resolve)([])}},{key:"_getFeatures",value:function(){return(0,l.resolve)("success")}},{key:"_featureFromCache",value:function(){return null}},{key:"_fetchAndRefineFeatures",value:function(){return(0,l.reject)(new Error("Fetch and Refine should not be called in this featureset"))}},{key:"_getFilteredSet",value:function(){return(0,l.resolve)(new(0,s.default)([],[],!1,null))}},{key:"_stat",value:function(e,t,n,r,a,i,s){return this._manualStat(e,t,i,s)}},{key:"_canDoAggregates",value:function(){return(0,l.resolve)(!1)}}]),n}(i.default)}))}();
//# sourceMappingURL=featureSetUtils.45593de6.js.map
