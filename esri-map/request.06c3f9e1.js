!function(){function e(e){return e&&e.__esModule?e.default:e}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("9pNSx",(function(t,n){var a,s,o,i,u;a=t.exports,Object.defineProperty(a,"__esModule",{value:!0,configurable:!0}),s=t.exports,o="default",i=function(){return v},Object.defineProperty(s,o,{get:i,set:u,enumerable:!0,configurable:!0});var c,l=r("8TSCy"),p=r("2TvXO"),d=r("cu9iz"),f=r("dLARP"),b=r("kyj08"),h=r("2VlWd"),x=r("flPLJ"),m=r("7qybv"),y=r("10vEZ"),k=r("kYueh"),g=r("7bIfi"),w=r("gpND0");function v(e,r){return T.apply(this,arguments)}function T(){return(T=l.asyncToGenerator(e(p).mark((function r(t,n){var a,s,o,i,u,d,f,b,x;return e(p).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=(0,k.isDataProtocol)(t),(o=(0,k.isBlobProtocol)(t))||s||(t=(0,k.normalize)(t)),i={url:t,requestOptions:l.objectSpread({},(0,m.unwrap)(n))},!(u=(0,k.getInterceptor)(t))){e.next=12;break}return e.next=8,N(u,i);case 8:if(null==(d=e.sent)){e.next=11;break}return e.abrupt("return",{data:d,getHeader:C,requestOptions:i.requestOptions,url:i.url});case 11:u.after||u.error||(u=null);case 12:if(t=i.url,"image"!==(n=i.requestOptions).responseType){e.next=17;break}if(!(0,h.default)("host-webworker")&&!(0,h.default)("host-node")){e.next=15;break}throw R("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),i);case 15:e.next=19;break;case 17:if(!s){e.next=19;break}throw R("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+n.responseType),i);case 19:if("head"!==n.method){e.next=24;break}if(!n.body){e.next=22;break}throw R("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),i);case 22:if(!s&&!o){e.next=24;break}throw R("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),i);case 24:return e.next=26,_();case 26:if(e.sent,!c){e.next=28;break}return e.abrupt("return",c.execute(t,n));case 28:return f=new AbortController,(0,y.onAbort)(n,(function(){return f.abort()})),b={controller:f,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:u,params:i,redoRequest:!1,useIdentity:q.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},e.next=33,J(b);case 33:return x=e.sent,e.abrupt("return",(null==(a=u)||null==a.after||a.after(x),x));case 35:case"end":return e.stop()}}),r)})))).apply(this,arguments)}var q=d.default.request,S="FormData"in globalThis,O=[499,498,403,401],E=["COM_0056","COM_0057","SB_0008"],P=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],C=function(){return null},L=Symbol();function U(e){var r=(0,k.getOrigin)(e);r&&!v._corsServers.includes(r)&&v._corsServers.push(r)}function j(e){var r=(0,k.getOrigin)(e);return!r||r.endsWith(".arcgis.com")||v._corsServers.includes(r)||(0,k.isTrustedServer)(r)}function R(e,r,t,n){var a="Error",s={url:t.url,requestOptions:t.requestOptions,getHeader:C,ssl:!1};if(r instanceof b.default)return r.details?(r.details=(0,x.clone)(r.details),r.details.url=t.url,r.details.requestOptions=t.requestOptions):r.details=s,r;if(r){var o=n&&function(e){return n.headers.get(e)},i=n&&n.status,u=r.message;u&&(a=u),o&&(s.getHeader=o),s.httpStatus=(null!=r.httpCode?r.httpCode:r.code)||i||0,s.subCode=r.subcode,s.messageCode=r.messageCode,"string"==typeof r.details?s.messages=[r.details]:s.messages=r.details,s.raw=L in r?r[L]:r}return(0,y.isAbortError)(r)?(0,y.createAbortError)():new(0,b.default)(e,a,s)}function _(){return A.apply(this,arguments)}function A(){return(A=l.asyncToGenerator(e(p).mark((function t(){return e(p).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,h.default)("host-webworker")){e.next=8;break}if(e.t0=c,e.t0){e.next=6;break}return e.next=5,r("gKV4P");case 5:c=e.sent;case 6:e.next=9;break;case 8:v._abortableFetch||(v._abortableFetch=globalThis.fetch.bind(globalThis));case 9:case"end":return e.stop()}}),t)})))).apply(this,arguments)}function D(){return I.apply(this,arguments)}function I(){return(I=l.asyncToGenerator(e(p).mark((function t(){return e(p).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=f.id,e.t0){e.next=4;break}return e.next=4,r("3lsuL");case 4:case"end":return e.stop()}}),t)})))).apply(this,arguments)}function F(e){return H.apply(this,arguments)}function H(){return(H=l.asyncToGenerator(e(p).mark((function r(t){var n,a,s,o,i,u,c,l;return e(p).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params.url,a=t.params.requestOptions,s=t.controller.signal,o=a.body,i=null,u=null,c=null,S&&"HTMLFormElement"in globalThis&&(o instanceof FormData?i=o:o instanceof HTMLFormElement&&(u=o,i=new FormData(u))),"string"==typeof o&&(c=o),t.fetchOptions={cache:a.cacheBust&&!v._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:a.headers||{},method:"head"===a.method?"HEAD":"GET",mode:"cors",redirect:"follow",signal:s},(i||c)&&(t.fetchOptions.body=i||c),"anonymous"===a.authMode&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(n)||a.query&&a.query.token||i&&i.get&&i.get("token")||u&&u.elements.token),!t.hasToken&&d.default.apiKey&&(0,g.supportsApiKey)(n)&&(a.query||(a.query={}),a.query.token=d.default.apiKey,t.hasToken=!0),!t.useIdentity||t.hasToken||t.credentialToken||M(n)||(0,y.isAborted)(s)){e.next=24;break}if("immediate"!==a.authMode){e.next=13;break}return e.next=7,D();case 7:return e.next=9,f.id.getCredential(n,{signal:s});case 9:l=e.sent,t.credential=l,e.next=23;break;case 13:if("no-prompt"!==a.authMode){e.next=22;break}return e.next=16,D();case 16:return e.next=18,f.id.getCredential(n,{prompt:!1,signal:s}).catch((function(){}));case 18:l=e.sent,t.credential=l,e.next=23;break;case 22:f.id&&(l=f.id.findCredential(n));case 23:l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl);case 24:case"end":return e.stop()}}),r)})))).apply(this,arguments)}function M(e){return P.some((function(r){return r.test(e)}))}function B(e){return G.apply(this,arguments)}function G(){return(G=l.asyncToGenerator(e(p).mark((function r(t){var n,a,s,o,i,u,c,d,b,x,m,g,w,T,O,E,P,C,L,_,A;return e(p).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params.url,a=t.params.requestOptions,s=t.fetchOptions,o=(0,k.isBlobProtocol)(n)||(0,k.isDataProtocol)(n),i=a.responseType||"json",u=o?0:null!=a.timeout?a.timeout:q.timeout,c=!1,o){e.next=24;break}if(t.useSSL&&(n=(0,k.toHTTPS)(n)),a.cacheBust&&"default"===s.cache&&(n=(0,k.addQueryParameter)(n,"request.preventCache",Date.now())),d=l.objectSpread({},a.query),t.credentialToken&&(d.token=t.credentialToken),b=(0,k.objectToQuery)(d),(0,h.default)("esri-url-encodes-apostrophe")&&(b=b.replace(/'/g,"%27")),x=n.length+1+b.length,c="delete"===a.method||"post"===a.method||"put"===a.method||!!a.body||x>q.maxUrlLength,(g=a.useProxy||!!(0,k.getProxyRule)(n))&&(w=(0,k.getProxyUrl)(n),m=w.path,!c&&m.length+1+x>q.maxUrlLength&&(c=!0),w.query&&(d=l.objectSpread({},w.query,d))),"HEAD"!==s.method||!c&&!g){e.next=21;break}if(!c){e.next=19;break}if(!(x>q.maxUrlLength)){e.next=18;break}throw R("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params);case 18:throw R("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);case 19:if(!g){e.next=21;break}throw R("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params);case 21:c?(s.method="delete"===a.method?"DELETE":"put"===a.method?"PUT":"POST",a.body?n=(0,k.addQueryParameters)(n,d):(s.body=(0,k.objectToQuery)(d),s.headers["Content-Type"]="application/x-www-form-urlencoded")):n=(0,k.addQueryParameters)(n,d),g&&(t.useProxy=!0,n="".concat(m,"?").concat(n)),d.token&&S&&s.body instanceof FormData&&((T=s.body).set?T.set("token",d.token):T.append("token",d.token)),a.hasOwnProperty("withCredentials")?t.withCredentials=a.withCredentials:(0,k.hasSameOrigin)(n,(0,k.getAppUrl)())||((0,k.isTrustedServer)(n)||f.id&&(O=f.id.findServerInfo(n))&&O.webTierAuth)&&(t.withCredentials=!0),t.withCredentials&&(s.credentials="include");case 24:if(C=0,L=!1,u>0&&(C=setTimeout((function(){L=!0,t.controller.abort()}),u)),e.prev=26,"native-request-init"!==a.responseType){e.next=31;break}(P=s).url=n,e.next=97;break;case 31:if("image"===a.responseType&&"default"===s.cache&&"GET"===s.method&&!c&&!W(a.headers)&&(o||t.useProxy||!q.proxyUrl||j(n))){e.next=94;break}return e.next=34,v._abortableFetch(n,s);case 34:if(E=e.sent,t.useProxy||U(n),"native"!==a.responseType){e.next=40;break}P=E,e.next=92;break;case 40:if("HEAD"===s.method){e.next=92;break}if(!E.ok){e.next=89;break}e.t0=i,e.next="array-buffer"===e.t0?45:"blob"===e.t0||"image"===e.t0?49:53;break;case 45:return e.next=47,E.arrayBuffer();case 47:return P=e.sent,e.abrupt("break",56);case 49:return e.next=51,E.blob();case 51:return P=e.sent,e.abrupt("break",56);case 53:return e.next=55,E.text();case 55:P=e.sent;case 56:if(C&&(clearTimeout(C),C=0),"json"!==i&&"xml"!==i&&"document"!==i){e.next=69;break}if(!P){e.next=68;break}e.t1=i,e.next="json"===e.t1?61:"xml"===e.t1?63:"document"===e.t1?65:66;break;case 61:return P=JSON.parse(P),e.abrupt("break",66);case 63:return P=X(P,"application/xml"),e.abrupt("break",66);case 65:P=X(P,"text/html");case 66:e.next=69;break;case 68:P=null;case 69:if(!P){e.next=87;break}if("array-buffer"!==i&&"blob"!==i){e.next=82;break}if(_=E.headers.get("Content-Type"),!(/application\/json|text\/plain/i.test(_)&&P["blob"===i?"size":"byteLength"]<=750)){e.next=82;break}return e.prev=73,e.next=76,new Response(P).json();case 76:(A=e.sent).error&&(P=A),e.next=82;break;case 80:e.prev=80,e.t2=e.catch(73);case 82:if(e.t3="image"===i&&P instanceof Blob,!e.t3){e.next=87;break}return e.next=86,Z(URL.createObjectURL(P),t,!0);case 86:P=e.sent;case 87:e.next=92;break;case 89:return e.next=91,E.text();case 91:P=e.sent;case 92:e.next=97;break;case 94:return e.next=96,Z(n,t);case 96:P=e.sent;case 97:e.next=108;break;case 99:if(e.prev=99,e.t4=e.catch(26),"AbortError"!==e.t4.name){e.next=105;break}if(!L){e.next=104;break}throw new Error("Timeout exceeded");case 104:throw(0,y.createAbortError)("Request canceled");case 105:if(!E&&e.t4 instanceof TypeError&&q.proxyUrl&&!a.body&&"delete"!==a.method&&"head"!==a.method&&"post"!==a.method&&"put"!==a.method&&!t.useProxy&&!j(n)){e.next=107;break}throw e.t4;case 107:t.redoRequest=!0,(0,k.addProxyRule)({proxyUrl:q.proxyUrl,urlPrefix:(0,k.getOrigin)(n)});case 108:return e.prev=108,C&&clearTimeout(C),e.finish(108);case 111:return e.abrupt("return",[E,P]);case 112:case"end":return e.stop()}}),r,null,[[26,99,108,111],[73,80]])})))).apply(this,arguments)}function N(e,r){return K.apply(this,arguments)}function K(){return(K=l.asyncToGenerator(e(p).mark((function r(t,n){var a,s;return e(p).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t.responseData){e.next=2;break}return e.abrupt("return",t.responseData);case 2:if(t.headers&&(n.requestOptions.headers=l.objectSpread({},n.requestOptions.headers,t.headers)),t.query&&(n.requestOptions.query=l.objectSpread({},n.requestOptions.query,t.query)),!t.before){e.next=16;break}return e.prev=4,e.next=7,t.before(n);case 7:s=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),a=R("request:interceptor",e.t0,n);case 13:if((s instanceof Error||s instanceof b.default)&&(a=R("request:interceptor",s,n)),!a){e.next=15;break}throw t.error&&t.error(a),a;case 15:return e.abrupt("return",s);case 16:case"end":return e.stop()}}),r,null,[[4,10]])})))).apply(this,arguments)}function W(e){if(e){var r=!0,t=!1,n=void 0;try{for(var a,s=Object.getOwnPropertyNames(e)[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){if(e[a.value])return!0}}catch(e){t=!0,n=e}finally{try{r||null==s.return||s.return()}finally{if(t)throw n}}}return!1}function X(e,r){var t;try{t=(new DOMParser).parseFromString(e,r)}catch(e){}if(!t||t.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return t}function J(e){return Q.apply(this,arguments)}function Q(){return(Q=l.asyncToGenerator(e(p).mark((function r(t){var n,a,s,o,i,u,c,d,b,h,x,m;return e(p).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=4,F(t);case 4:e.prev=4;case 6:return e.t0=l,e.next=9,B(t);case 9:e.t1=e.sent,i=e.t0.slicedToArray.call(e.t0,e.t1,2),s=i[0],o=i[1];case 14:return e.next=16,z(t,s,o);case 16:if(!e.sent){e.next=6;break}case 17:e.next=23;break;case 19:throw e.prev=19,e.t2=e.catch(4),(u=R("request:server",e.t2,t.params,s)).details.ssl=t.useSSL,t.interceptor&&t.interceptor.error&&t.interceptor.error(u),u;case 23:return c=t.params.url,!/\/sharing\/rest\/(accounts|portals)\/self/i.test(c)||t.hasToken||t.credentialToken||null==(n=o)||null==(a=n.user)||!a.username||(0,k.isTrustedServer)(c)||(d=(0,k.getOrigin)(c,!0))&&q.trustedServers.push(d),(b=t.credential)&&f.id&&(h=f.id.findServerInfo(b.server),(x=h&&h.owningSystemUrl)&&(x=x.replace(/\/?$/,"/sharing"),(m=f.id.findCredential(x,b.userId))&&-1===f.id._getIdenticalSvcIdx(x,m)&&m.resources.unshift(x))),e.abrupt("return",{data:o,getHeader:s?function(e){return s.headers.get(e)}:C,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url});case 28:case"end":return e.stop()}}),r,null,[[4,19]])})))).apply(this,arguments)}function z(e,r,t){return V.apply(this,arguments)}function V(){return(V=l.asyncToGenerator(e(p).mark((function r(t,n,a){var s,o,i,u,c,l,d;return e(p).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.redoRequest){e.next=2;break}return e.abrupt("return",(t.redoRequest=!1,!1));case 2:if(s=t.params.requestOptions,n&&"native"!==s.responseType&&"native-request-init"!==s.responseType){e.next=5;break}return e.abrupt("return",!0);case 5:if(n.ok){e.next=8;break}throw(o=new Error("Unable to load ".concat(n.url," status: ").concat(n.status)))[L]=a,o;case 8:if(null!=a&&a.error&&(o=a.error),o&&(i=Number(o.code),u=o.hasOwnProperty("subcode")?Number(o.subcode):null,c=(c=o.messageCode)&&c.toUpperCase()),l=s.authMode,403!==i||!(4===u||o.message&&o.message.toLowerCase().indexOf("ssl")>-1&&-1===o.message.toLowerCase().indexOf("permission"))){e.next=15;break}if(t.useSSL){e.next=13;break}return e.abrupt("return",(t.useSSL=!0,!1));case 13:e.next=30;break;case 15:if(t.hasToken||!t.useIdentity||"no-prompt"===l&&498!==i||-1===O.indexOf(i)||M(t.params.url)||!(403!==i||-1===E.indexOf(c)&&(null==u||2===u&&t.credentialToken))){e.next=30;break}return e.next=18,D();case 18:return e.prev=18,e.next=21,f.id.getCredential(t.params.url,{error:R("request:server",o,t.params),prompt:"no-prompt"!==l,signal:t.controller.signal,token:t.credentialToken});case 21:return d=e.sent,e.abrupt("return",(t.credential=d,t.credentialToken=d.token,t.useSSL=t.useSSL||d.ssl,!1));case 25:if(e.prev=25,e.t0=e.catch(18),"no-prompt"!==l){e.next=29;break}return e.abrupt("return",(t.credential=null,t.credentialToken=null,!1));case 29:o=e.t0;case 30:if(!o){e.next=32;break}throw o;case 32:return e.abrupt("return",!0);case 33:case"end":return e.stop()}}),r,null,[[18,25]])})))).apply(this,arguments)}function Z(e,r){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=r.controller.signal,a=new Image;return r.withCredentials?a.crossOrigin="use-credentials":a.crossOrigin="anonymous",a.alt="",a.src=e,(0,w.loadImageAsync)(a,e,t,n)}v._abortableFetch=null,v._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"]})),r.register("gKV4P",(function(e,t){e.exports=r("4WKyX")(r("aNJCr").getBundleURL("3EXx4")+r("iE7OH").resolve("al1SC")).then((function(){return r("wscz2")}))})),r.register("3lsuL",(function(e,t){e.exports=r("4WKyX")(r("aNJCr").getBundleURL("3EXx4")+r("iE7OH").resolve("fhBiJ")).then((function(){return r("jZi8f")}))}))}();
//# sourceMappingURL=request.06c3f9e1.js.map
