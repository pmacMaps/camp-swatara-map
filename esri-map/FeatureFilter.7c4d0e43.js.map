{"mappings":"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","sources":["node_modules/@arcgis/core/views/2d/layers/features/support/FeatureFilter.js","node_modules/@arcgis/core/views/2d/layers/features/support/whereUtils.js","node_modules/@parcel/runtime-js/lib/runtime-814c707e396576e8.js","node_modules/@arcgis/core/core/CircularArray.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport t from\"../../../../../core/Error.js\";import e from\"../../../../../core/Logger.js\";import{isSome as i}from\"../../../../../core/maybe.js\";import{create as s}from\"../../../../../geometry/support/aaBoundingRect.js\";import{getBoundsXY as r}from\"../../../../../geometry/support/boundsUtils.js\";import{getSpatialQueryOperator as o}from\"../../../../../layers/graphics/data/spatialQuerySupport.js\";import{getTimeOperator as h}from\"../../../../../layers/graphics/data/timeSupport.js\";import{normalizeQueryLike as a}from\"../../../../../layers/graphics/data/utils.js\";import l from\"../../../../../rest/support/Query.js\";import{featureAdapter as n}from\"../FeatureStore2D.js\";import{createWhereClause as d}from\"./whereUtils.js\";const m=e.getLogger(\"esri.views.2d.layers.features.controllers.FeatureFilter\"),_=1,p=2;class y{constructor(t){this._geometryBounds=s(),this._idToVisibility=new Map,this._serviceInfo=t}get hash(){return this._hash}check(t){return this._applyFilter(t)}clear(){const t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}}invalidate(){this._idToVisibility.forEach(((t,e)=>{this._idToVisibility.set(e,0)}))}setKnownIds(t){for(const e of t)this._idToVisibility.set(e,_)}setTrue(t){const e=[],i=[],s=new Set(t);return this._idToVisibility.forEach(((t,r)=>{const o=!!(this._idToVisibility.get(r)&_),h=s.has(r);!o&&h?e.push(r):o&&!h&&i.push(r),this._idToVisibility.set(r,h?_|p:0)})),{show:e,hide:i}}createQuery(){const{geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r}=this;return l.fromJSON({geometry:t,spatialRel:e,where:i,timeExtent:s,objectIds:r})}async update(t,e){this._hash=JSON.stringify(t);const i=await a(t,null,e);await Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(t){if(!t||!t.where)return this._clause=null,void(this.where=null);this._clause=await d(t.where,this._serviceInfo.fieldsIndex),this.where=t.where}_setIdFilter(t){this._idsToShow=t&&t.objectIds&&new Set(t.objectIds),this._idsToHide=t&&t.hiddenIds&&new Set(t.hiddenIds),this.objectIds=t&&t.objectIds}async _setGeometryFilter(t){if(!t||!t.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const e=t.geometry,i=t.spatialRel||\"esriSpatialRelIntersects\",s=await o(i,e,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);r(this._geometryBounds,e),this._spatialQueryOperator=s,this.geometry=e,this.spatialRel=i}_setTimeFilter(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=h(this._serviceInfo.timeInfo,e.timeExtent,n);else{const i=new t(\"feature-layer-view:time-filter-not-available\",\"Unable to apply time filter, as layer doesn't have time metadata.\",e.timeExtent);m.error(i)}}_applyFilter(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)}_filterByExpression(t){return!this.where||this._clause(t)}_filterById(t){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(t.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(t.getObjectId()))}_filterByGeometry(t){if(!this.geometry)return!0;const e=t.readHydratedGeometry();return!!e&&this._spatialQueryOperator(e)}_filterByTime(t){return!i(this._timeOperator)||this._timeOperator(t)}_resetAllHiddenIds(){const t=[];return this._idToVisibility.forEach(((e,i)=>{e&_||(this._idToVisibility.set(i,_),t.push(i))})),t}}export{y as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../../../../core/Error.js\";import r from\"../../../../../core/Logger.js\";const t=r.getLogger(\"esri.views.2d.layers.features.support.whereUtils\"),a={getAttribute:(e,r)=>e.field(r)};async function s(r,s){const n=await import(\"../../../../../core/sql/WhereClause.js\");try{const o=n.WhereClause.create(r,s);if(!o.isStandardized){const r=new e(\"mapview - bad input\",\"Unable to apply filter's definition expression, as expression is not standardized.\",o);t.error(r)}return e=>{const r=e.readArcadeFeature();return o.testFeature(r,a)}}catch(o){return t.warn(\"mapview-bad-where-clause\",\"Encountered an error when evaluating where clause\",r),e=>!0}}export{s as createWhereClause};\n","module.exports = Promise.all([require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('1NzFX') + require('./helpers/bundle-manifest').resolve(\"j5U2t\")), require(\"./helpers/browser/js-loader\")(require('./helpers/bundle-url').getBundleURL('1NzFX') + require('./helpers/bundle-manifest').resolve(\"cgD2M\"))]).then(() => parcelRequire('9AqbE'));","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"./maybe.js\";class s{constructor(t){this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}get entries(){return this._buffer}enqueue(t){if(this.size===this.maxSize){const s=this._buffer[this._start];return this._buffer[this._start]=t,this._start=(this._start+1)%this.maxSize,s}return this._buffer[(this._start+this.size++)%this.maxSize]=t,null}dequeue(){if(0===this.size)return null;const t=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,t}peek(){return 0===this.size?null:this._buffer[this._start]}find(s){if(0===this.size)return null;for(const e of this._buffer)if(t(e)&&s(e))return e;return null}clear(s){let e=this.dequeue();for(;t(e);)s&&s(e),e=this.dequeue()}}export{s as default};\n"],"names":["$8TSCy","parcelRequire","$f6185ca01a835b74$var$m","$jHOLN","default","getLogger","$f6185ca01a835b74$export$2e2bcd8739ae039","t1","this","_geometryBounds","$8TwEW","create","_idToVisibility","Map","_serviceInfo","key","_hash","t2","_applyFilter","t3","_resetAllHiddenIds","update","show","hide","forEach","t","e1","_this","set","t4","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","_$e","value","err","return","t5","i1","s1","Set","r1","o1","get","h1","has","push","$f6185ca01a835b74$var$_","ref","t6","geometry","spatialRel","i2","where","s2","timeExtent","r2","objectIds","$cRlei","fromJSON","t7","e2","asyncToGenerator","$parcel$interopDefault","$2TvXO","mark","_callee","i3","JSON","stringify","$emniL","normalizeQueryLike","_ctx","sent","Promise","all","_setGeometryFilter","_setIdFilter","_setAttributeFilter","_setTimeFilter","t8","_clause","$3FUW6","createWhereClause","fieldsIndex","t9","_idsToShow","_idsToHide","hiddenIds","t10","i4","s3","_spatialQueryOperator","$iNIOS","getSpatialQueryOperator","geometryType","hasZ","hasM","$5Hy9K","getBoundsXY","e3","_timeOperator","timeInfo","$17eId","getTimeOperator","$dEIm1","featureAdapter","i5","$kyj08","error","t11","_filterByGeometry","_filterById","_filterByTime","_filterByExpression","t12","t13","size","getObjectId","t14","readHydratedGeometry","t15","$7qybv","isSome","t16","e4","i6","$2ad15dc5364b76c9$var$t","$2ad15dc5364b76c9$var$a","getAttribute","field","$2ad15dc5364b76c9$export$836dbdcd386cbf54","$2ad15dc5364b76c9$var$_s","apply","arguments","n","o","_$r1","WhereClause","isStandardized","_$r","readArcadeFeature","testFeature","warn","e","module","exports","getBundleURL","resolve","then","$c1c36ab65db3ddcc$export$2e2bcd8739ae039","_start","maxSize","_buffer","Array","s","dequeue"],"version":3,"file":"FeatureFilter.7c4d0e43.js.map"}