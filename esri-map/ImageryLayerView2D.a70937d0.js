function e(e,t,i,r){Object.defineProperty(e,t,{get:i,set:r,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("ceRhn",(function(i,r){e(i.exports,"default",(function(){return g}));var s=t("j6uz9"),a=t("EvxpF"),n=t("8Y9g8"),o=t("cc23H"),l=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var d=t("qA6zg"),h=t("fDLIP"),c=t("kjhDk"),u=t("eYUjf"),p=t("kUbzA");let y=class extends n.HandleOwner{get updating(){return!this._strategy||this._strategy.updating}attach(){const{layer:e}=this,t=()=>{this._loadImagery=(t,i,r,s,a)=>(0,h.loadImagery)(e,t,i,r,s,a),this._updateVisualization()};"multidimensionalDefinition"in e?this.handles.add((0,o.watch)((()=>e.multidimensionalDefinition),t)):this.handles.add([(0,o.watch)((()=>e.mosaicRule),t),(0,o.watch)((()=>e.renderingRule),t),(0,o.watch)((()=>e.definitionExpression),t)]),this.container=new(0,c.default),this._strategy=new(0,u.default)({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container.removeAllChildren(),this.container=null,this.handles.removeAll()}update(e){e.stationary?this._strategy.update(e):this.layerView.requestUpdate()}hitTest(e){return new(0,a.default)({attributes:{},geometry:e.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){if("flow"!==this.layer.renderer.type)return;const e=new(0,p.default)(this._loadImagery,this._createStreamlinesMesh,this.layer.renderer,this.timeExtent);this.container.flowStyle=e,this.layerView.requestUpdate()}constructor(){super(...arguments),this._loadImagery=(e,t,i,r,s)=>(0,h.loadImagery)(this.layer,e,t,i,r,s),this._createStreamlinesMesh=(e,t,i)=>this.layer.createStreamlinesMesh({flowData:t,rendererSettings:e},{signal:i}),this.attached=!1,this.container=null,this.layer=null,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}};(0,s._)([(0,l.property)()],y.prototype,"_strategy",void 0),(0,s._)([(0,l.property)()],y.prototype,"attached",void 0),(0,s._)([(0,l.property)()],y.prototype,"container",void 0),(0,s._)([(0,l.property)()],y.prototype,"layer",void 0),(0,s._)([(0,l.property)()],y.prototype,"layerView",void 0),(0,s._)([(0,l.property)()],y.prototype,"type",void 0),(0,s._)([(0,l.property)()],y.prototype,"updating",null),(0,s._)([(0,l.property)()],y.prototype,"timeExtent",void 0),y=(0,s._)([(0,d.subclass)("esri.views.2d.engine.flow.FlowView2D")],y);const g=y})),t.register("kjhDk",(function(i,r){e(i.exports,"default",(function(){return o}));var s=t("itWlV"),a=t("eyQUy"),n=t("eqJSJ");class o extends n.default{get requiresDedicatedFBO(){return!1}doRender(e){super.doRender(e)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"flow",brushes:[s.default],target:()=>this.children,drawPhase:a.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(e),t]}constructor(){super(...arguments),this.flowStyle=null}}})),t.register("eYUjf",(function(i,r){e(i.exports,"default",(function(){return _}));var s=t("j6uz9");t("ixrNB");var a=t("27btt"),n=t("6TszD"),o=t("8TN87"),l=t("1CpCt"),d=t("lHg4e"),h=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var c=t("qA6zg"),u=t("dZxPT"),p=t("iIVyQ"),y=t("jGcRa"),g=t("2WnyR");const f=n.default.getLogger("esri.views.2d.engine.flow.FlowStrategy");let m=class extends a.default{initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(e){const{flowStyle:t}=this.flowContainer;if((0,l.isNone)(t))return void this._clear();const{extent:i,rotation:r,resolution:s,pixelRatio:a}=e.state,n=function(e,t){const i=new(0,u.default)({x:(e.xmax+e.xmin)/2,y:(e.ymax+e.ymin)/2,spatialReference:e.spatialReference}),r=e.xmax-e.xmin,s=e.ymax-e.ymin,a=Math.abs(Math.cos((0,o.deg2rad)(t))),n=Math.abs(Math.sin((0,o.deg2rad)(t))),l=a*r+n*s,d=n*r+a*s,h=new(0,g.default)({xmin:i.x-l/2,ymin:i.y-d/2,xmax:i.x+l/2,ymax:i.y+d/2,spatialReference:e.spatialReference});return h.centerAt(i),h}(i,r);n.expand(1.15);const h=[Math.round((n.xmax-n.xmin)/s),Math.round((n.ymax-n.ymin)/s)],c=new(0,p.default)(t,n,h,a);if((0,l.isSome)(this._loading)){if(this._loading.update(c))return;this._loading.destroy(),this._loading=null}!(0,l.isNone)(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(c)||(c.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(e=>{(0,d.isAbortError)(e)||(f.error("A resource failed to load.",e),this._loading=null)})),this._loading=c)}_clear(){this._flowDisplayObject.clear(),(0,l.isSome)(this._loading)&&(this._loading.destroy(),this._loading=null)}constructor(e){super(e),this._flowDisplayObject=new(0,y.FlowDisplayObject),this._loading=null}};(0,s._)([(0,h.property)()],m.prototype,"_loading",void 0),(0,s._)([(0,h.property)()],m.prototype,"flowContainer",void 0),(0,s._)([(0,h.property)()],m.prototype,"updating",null),m=(0,s._)([(0,c.subclass)("esri.views.2d.engine.flow.FlowStrategy")],m);const _=m})),t.register("iIVyQ",(function(i,r){e(i.exports,"default",(function(){return a}));const s=t("6TszD").default.getLogger("esri.views.2d.engine.flow.FlowDisplayData");class a{async load(){const e=new AbortController;this.state={name:"loading",abortController:e};const t=await this.flowStyle.loadResources({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},e.signal);this.state={name:"loaded",resources:t}}prepareForRendering(e){if("loaded"!==this.state.name)return void s.error("Only loaded resources can be attached.");const t=this.state.resources;t.prepareForRendering(e),this.state={name:"attached",resources:t}}destroy(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(e){return!!this.flowStyle.areResourcesCompatible(e.flowStyle)&&!(!this.extent.equals(e.extent)||this.size[0]!==e.size[0]||this.size[1]!==e.size[1]||this.pixelRatio!==e.pixelRatio||(this.flowStyle=e.flowStyle,0))}constructor(e,t,i,r){this.state={name:"created"},this.flowStyle=e,this.extent=t,this.size=i,this.pixelRatio=r}}})),t.register("jGcRa",(function(i,r){e(i.exports,"FlowDisplayObject",(function(){return d}));var s=t("8TN87"),a=t("1CpCt"),n=t("52822"),o=t("jsolS"),l=t("5aS5k");class d extends l.DisplayObject{get displayData(){return this._displayData}set displayData(e){this._displayData=e,this.requestRender()}clear(){(0,a.isSome)(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())}setTransform(e){const{displayData:t}=this;if((0,a.isNone)(t))return;const i=t.extent.xmin,r=t.extent.ymax,o=[0,0];e.toScreen(o,[i,r]);const l=(t.extent.xmax-t.extent.xmin)/t.size[0]/e.resolution,d=(0,s.deg2rad)(e.rotation),{dvs:h}=this.transforms;(0,n.l)(h,[-1,1,0]),(0,n.d)(h,h,[2/(e.size[0]*e.pixelRatio),-2/(e.size[1]*e.pixelRatio),1]),(0,n.c)(h,h,[o[0],o[1],0]),(0,n.r)(h,h,d),(0,n.d)(h,h,[l*e.pixelRatio,l*e.pixelRatio,1])}_createTransforms(){return{dvs:(0,o.c)()}}constructor(){super(...arguments),this._displayData=null}}})),t.register("kUbzA",(function(i,r){e(i.exports,"default",(function(){return l}));var s=t("1CpCt"),a=t("lHg4e"),n=t("fIZGo"),o=t("7O4F9");class l{get animated(){return this._rendererSettings.lineSpeed>0}get renderSettings(){return this._rendererSettings}areResourcesCompatible(e){let t=!0;return t=t&&e._loadImagery===this._loadImagery,t=t&&e._createStreamlinesMesh===this._createStreamlinesMesh,t=t&&e._rendererSettings.verticesPerLine===this._rendererSettings.verticesPerLine,t=t&&e._rendererSettings.segmentLength===this._rendererSettings.segmentLength,t=t&&e._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing,t=t&&e._rendererSettings.density===this._rendererSettings.density,t=t&&e._rendererSettings.smoothing===this._rendererSettings.smoothing,t=t&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale,t=t&&e._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold,t=t&&e._rendererSettings.minSpeedThreshold===this._rendererSettings.minSpeedThreshold,t=t&&e._rendererSettings.mergeLines===this._rendererSettings.mergeLines,t=t&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale,t=t&&e._rendererSettings.interpolate===this._rendererSettings.interpolate,t=t&&e._rendererSettings.lineColor.kind===this._rendererSettings.lineColor.kind,t=t&&e._rendererSettings.lineOpacity.kind===this._rendererSettings.lineOpacity.kind,t=t&&e._rendererSettings.lineRenderWidth.kind===this._rendererSettings.lineRenderWidth.kind,t&&this._rendererSettings.mergeLines&&(t=e._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth),t&&e._timeExtent!==this._timeExtent&&(t=!(!(0,s.isSome)(e._timeExtent)||!(0,s.isSome)(this._timeExtent))&&e._timeExtent.equals(this._timeExtent)),t}async loadResources(e,t){const{extent:i,size:r}=e;(0,a.throwIfAborted)(t);const s=await this._loadImagery(i,r[0],r[1],this._timeExtent,t),{vertexData:o,indexData:l}=await this._createStreamlinesMesh(this._rendererSettings,s,t);return new(0,n.default)(o,l,{lineColor:this._rendererSettings.lineColor,lineOpacity:this._rendererSettings.lineOpacity,lineRenderWidth:this._rendererSettings.lineRenderWidth})}constructor(e,t,i,r){this._loadImagery=e,this._createStreamlinesMesh=t,this._timeExtent=r,this._rendererSettings=(0,o.createFlowRendererSettings)(i)}}})),t.register("fIZGo",(function(i,r){e(i.exports,"default",(function(){return h}));var s=t("g0mVO"),a=t("l3QXd"),n=t("4radX"),o=t("hSAA2");const l=new Map;l.set("a_positionAndSide",0),l.set("a_timeInfo",1),l.set("a_extrude",2),l.set("a_speed",3);const d={geometry:[new(0,o.VertexElementDescriptor)("a_positionAndSide",3,a.DataType.FLOAT,0,36),new(0,o.VertexElementDescriptor)("a_timeInfo",3,a.DataType.FLOAT,12,36),new(0,o.VertexElementDescriptor)("a_extrude",2,a.DataType.FLOAT,24,36),new(0,o.VertexElementDescriptor)("a_speed",1,a.DataType.FLOAT,32,36)]};class h{prepareForRendering(e){const t=s.BufferObject.createVertex(e,a.Usage.STATIC_DRAW,this._vertexData),i=s.BufferObject.createIndex(e,a.Usage.STATIC_DRAW,this._indexData),r=new(0,n.VertexArrayObject)(e,l,d,{geometry:t},i);this.vertexBuffer=t,this.indexBuffer=i,this.vertexArray=r,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose(),this.vertexBuffer.dispose(),this.indexBuffer.dispose()}get locations(){return l}constructor(e,t,i){this.values=i,this._vertexData=e,this._indexData=t}}})),t.register("7O4F9",(function(i,r){e(i.exports,"createFlowRendererSettings",(function(){return a}));var s=t("jCR4P");function a(e){const t=function(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[(0,s.pt2px)(e.trailWidth)]};const t=e.getVisualVariablesForType("size")[0],i=[],r=[];let a;if(t.stops){for(const e of t.stops)i.push(e.value),r.push(e.size);a=t.stops.length}else i.push(t.minDataValue,t.maxDataValue),r.push(t.minSize,t.maxSize),a=2;return{kind:"ramp",stops:i,values:r,count:a}}(e),i="constant"===(p=t).kind?p.value[0]:p.values[p.values.length-1],r=2*i,a=Math.round((0,s.pt2px)(e.maxPathLength)/r)+1,o=i,l=function(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:n(e.color)};const t=e.getVisualVariablesForType("color")[0],i=[],r=[];for(const e of t.stops)i.push(e.value),Array.prototype.push.apply(r,n(e.color));return{kind:"ramp",stops:i,values:r,count:t.stops.length}}(e),d=function(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=e.getVisualVariablesForType("opacity")[0],i=[],r=[];for(const e of t.stops)i.push(e.value),r.push(e.opacity);return{kind:"ramp",stops:i,values:r,count:t.stops.length}}(e),{flowSpeed:h,trailLength:c,density:u}=e;var p;return{lineRenderWidth:t,segmentLength:r,verticesPerLine:a,lineCollisionWidth:o,lineSpacing:10,lineColor:l,lineOpacity:d,lineSpeed:h,fadeDuration:c,density:u,smoothing:(0,s.pt2px)(e.smoothing),velocityScale:"flow-from"===e.flowRepresentation?1:-1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}}function n(e){const t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}})),t.register("fYJER",(function(i,r){e(i.exports,"RasterVFDisplayObject",(function(){return y})),t("5HTPH");var s=t("1CpCt"),a=t("52822"),n=t("jsolS"),o=t("gLni9"),l=t("dqihR"),d=t("5aS5k"),h=t("cPgEa"),c=t("g0mVO"),u=t("l3QXd"),p=t("4radX");class y extends d.DisplayObject{destroy(){var e,t;(0,s.isSome)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}get source(){return this._source}set source(e){this._source=e,this.invalidateVAO()}invalidateVAO(){var e,t;!this._vaoInvalidated&&(0,s.isSome)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,s.isSome)(this.source)&&!(0,s.isSome)(this.vaoData)){const{style:t}=this.symbolizerParameters;switch(t){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const t=(0,l.createVFMesh)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:i}}break;case"simple_scalar":{const t=(0,l.createVFMeshScalar)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={scalar:i}}break;case"wind_speed":{const t=(0,l.createVFMesh)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t),r=(0,l.createVFMeshScalar)(this.source,this.symbolizerParameters),s=this._createVectorFieldVAO(e.context,r);this.vaoData={magdir:i,scalar:s}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:(0,n.c)()}}setTransform(e){const t=(0,a.b)(this.transforms.dvs),[i,r]=e.toScreenNoRotation([0,0],[this.x,this.y]),s=this.resolution/this.pixelRatio/e.resolution,n=s*this.width,l=s*this.height,d=Math.PI*this.rotation/180;(0,a.c)(t,t,(0,o.f)(i,r)),(0,a.c)(t,t,(0,o.f)(n/2,l/2)),(0,a.r)(t,t,-d),(0,a.c)(t,t,(0,o.f)(-n/2,-l/2)),(0,a.j)(t,t,(0,o.f)(n,l)),(0,a.m)(this.transforms.dvs,e.displayViewMat3,t)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(e,t){const{vertexData:i,indexData:r}=t,s=c.BufferObject.createVertex(e,u.Usage.STATIC_DRAW,new Float32Array(i)),a=c.BufferObject.createIndex(e,u.Usage.STATIC_DRAW,new Uint32Array(r)),n=(0,h.createProgramDescriptor)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:u.DataType.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:u.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:u.DataType.FLOAT,normalized:!1}]});return{vao:new(0,p.VertexArrayObject)(e,n.attributes,n.bufferLayouts,{geometry:s},a),elementCount:r.length}}constructor(e=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.width=null,this.source=e}}}));
//# sourceMappingURL=ImageryLayerView2D.a70937d0.js.map
