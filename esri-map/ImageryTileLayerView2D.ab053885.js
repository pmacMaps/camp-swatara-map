!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("firbt",(function(n,i){var a;a=n.exports,Object.defineProperty(a,"__esModule",{value:!0,configurable:!0}),t(n.exports,"default",(function(){return C}));var s=r("8TSCy"),o=r("2TvXO"),l=r("7eJjO"),u=r("bsvXr"),c=r("jHOLN"),h=r("10vEZ"),f=r("lKPaD"),y=r("5qZXj"),p=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var d=r("fcwIv"),v=r("bmS2f"),g=r("dIFqf"),m=r("24w4l"),x=r("cvwLd"),b=r("9M3e1"),w=r("afdWM"),_=r("30vBn"),k=r("hfthk"),R=c.default.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),T=function(t){"use strict";s.inherits(n,t);var r=s.createSuper(n);function n(){var e;return s.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._useWebGLForProcessing=!0,e._useProgressiveUpdate=!0,e.subview=null,s.possibleConstructorReturn(e)}return s.createClass(n,[{key:"useWebGLForProcessing",get:function(){return this._useWebGLForProcessing},set:function(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}},{key:"useProgressiveUpdate",get:function(){return this._useWebGLForProcessing},set:function(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}},{key:"update",value:function(e){this.subview.update(e),this.notifyChange("updating")}},{key:"isUpdating",value:function(){return!this.subview||this.subview.updating}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.handles.add([(0,y.watch)(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],(function(t,r,n){var i="multidimensionalDefinition"===n,a="interpolation"===n&&("majority"===t||"majority"===r)&&(0,b.canUseMajorityInterpolationOnDataSource)(e.layer),s="renderer"===n&&r.type!==t.type;s&&e._updateSubview();var o=i||a||s;e.subview.redrawOrRefetch(o).catch((function(e){(0,h.isAbortError)(e)||R.error(e)})),e.notifyChange("updating")})),(0,f.watch)((function(){var t;return null!=(t=e.layer.blendMode)?t:"normal"}),(function(t){e.subview.container.blendMode=t}),f.syncAndInitial),(0,f.watch)((function(){var t;return null!=(t=e.layer.effect)?t:null}),(function(t){e.subview.container.effect=t}),f.syncAndInitial),(0,f.watch)((function(){return e.timeExtent}),(function(){e.subview.timeExtent=e.timeExtent,e.subview.redrawOrRefetch(!0).catch((function(e){(0,h.isAbortError)(e)||R.error(e)}))}),f.initial)],"attach")}},{key:"detach",value:function(){var e;this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),null==(e=this.subview)||e.destroy(),this.subview=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.subview.moveEnd()}},{key:"hitTest",value:function(t,r){return s.asyncToGenerator(e(o).mark((function r(){return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[new(0,u.default)({attributes:{},geometry:t.clone()})]);case 1:case"end":return e.stop()}}),r)})))()}},{key:"doRefresh",value:function(){return this.subview.doRefresh()}},{key:"_updateSubview",value:function(){var e="vector-field"===this.layer.renderer.type?"rasterVF":"flow"===this.layer.renderer.type?"flow":"raster";if(this.subview){var t;if(this.subview.type===e)return void this._attachSubview(this.subview);this._detachSubview(this.subview),null==(t=this.subview)||t.destroy(),this.subview=null}var r,n=this.layer;"useWebGLForProcessing"in(r="rasterVF"===e?new(0,x.default)({layer:n,layerView:this}):"flow"===e?new(0,v.default)({layer:n,layerView:this}):new(0,m.default)({layer:n,layerView:this}))&&(r.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in r&&(r.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in r&&(r.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD),this._attachSubview(r),this.subview=r,this.requestUpdate()}},{key:"_attachSubview",value:function(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0),e.container.blendMode=this.layer.blendMode,e.container.effect=this.layer.effect)}},{key:"_detachSubview",value:function(e){null!=e&&e.attached&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}}]),n}((0,w.ImageryTileLayerView)((0,k.RefreshableLayerView)((0,g.LayerView2DMixin)(_.default))));(0,l._)([(0,p.property)()],T.prototype,"subview",void 0),(0,l._)([(0,p.property)()],T.prototype,"useWebGLForProcessing",null),(0,l._)([(0,p.property)()],T.prototype,"useProgressiveUpdate",null);var C=T=(0,l._)([(0,d.subclass)("esri.views.2d.layers.ImageryTileLayerView2D")],T)})),r.register("24w4l",(function(n,i){t(n.exports,"default",(function(){return d}));var a=r("8TSCy"),s=r("2TvXO"),o=r("7eJjO"),l=r("7qybv"),u=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var c=r("fcwIv"),h=r("3ygTk"),f=r("5QZs5"),y=r("9M3e1"),p=function(t){"use strict";a.inherits(n,t);var r=a.createSuper(n);function n(){var e;return a.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments)))).container=null,e.layer=null,e.type="raster",a.possibleConstructorReturn(e)}return a.createClass(n,[{key:"attach",value:function(){a.get(a.getPrototypeOf(n.prototype),"attach",this).call(this),this.container=new(0,h.RasterTileContainer)(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme}},{key:"detach",value:function(){a.get(a.getPrototypeOf(n.prototype),"detach",this).call(this),this.container.removeAllChildren(),this.container=null}},{key:"canUseWebGLForProcessing",value:function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&(0,y.canUseMajorityInterpolationOnDataSource)(this.layer))}},{key:"fetchTile",value:function(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}},{key:"updateTileSource",value:function(t,r){var n=this;return a.asyncToGenerator(e(s).mark((function i(){var o,u,c,h,f,y,p,d,v,g,m,x,b,w,_;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.layer,u=o.bandIds,c=n._getLayerInterpolation(),h=n.canUseWebGLForProcessing(),f=r.source,y=r.symbolizerParams,p=r.globalSymbolizerParams,d=r.suspended,v=r.coords,g=r.resolution,m=t.bitmap,x=a.slicedToArray(v,2),m.x=x[0],m.y=x[1],m.resolution=g,!(f&&(0,l.isSome)(f)&&(0,l.isSome)(f.pixelBlock))){e.next=15;break}if(b={extent:f.extent,pixelBlock:f.pixelBlock},m.rawPixelData=b,!h){e.next=8;break}m.source=f.pixelBlock,m.isRendereredSource=!1,e.next=12;break;case 8:return e.next=10,n.layer.applyRenderer(b,"stretch"===(null==p?void 0:p.type)?p:null);case 10:w=e.sent,m.source=w,m.isRendereredSource=!0;case 12:m.symbolizerParameters=h?y:null,h?m.transformGrid||(m.transformGrid=f.transformGrid):m.transformGrid=null,e.next=16;break;case 15:_=n.createEmptyTilePixelBlock(),m.source=_,m.symbolizerParameters=h?y:null,m.transformGrid=null;case 16:m.bandIds=h?u:null,m.width=n._tileInfoView.tileInfo.size[0],m.height=n._tileInfoView.tileInfo.size[1],m.interpolation=c,m.suspended=d,m.invalidateTexture();case 17:case"end":return e.stop()}}),i)})))()}},{key:"updateTileSymbolizerParameters",value:function(t,r){var n=this;return a.asyncToGenerator(e(s).mark((function i(){var a,o,u,c,h,f,y,p;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.local,o=r.global,u=n.layer,c=u.bandIds,h=n._getLayerInterpolation(),f=n.canUseWebGLForProcessing(),y=t.bitmap,p=y.rawPixelData,f||!(0,l.isSome)(p)){e.next=8;break}return e.next=4,n.layer.applyRenderer(p,"stretch"===(null==o?void 0:o.type)?o:null);case 4:y.source=e.sent,y.isRendereredSource=!0,e.next=9;break;case 8:y.isRendereredSource&&(0,l.isSome)(p)&&(y.source=p.pixelBlock),y.isRendereredSource=!1;case 9:y.symbolizerParameters=f?o||a:null,y.bandIds=f?c:null,y.interpolation=h,y.suspended=!1;case 13:case"end":return e.stop()}}),i)})))()}},{key:"_getLayerInterpolation",value:function(){var e=this.layer.renderer.type;if("raster-colormap"===e||"unique-value"===e||"class-breaks"===e)return"nearest";var t=this.layer.interpolation,r=this.layer.renderer;return"raster-stretch"===r.type&&null!=r.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}}]),n}(f.BaseImageryTileSubView2D);(0,o._)([(0,u.property)()],p.prototype,"container",void 0),(0,o._)([(0,u.property)()],p.prototype,"layer",void 0),(0,o._)([(0,u.property)()],p.prototype,"type",void 0);var d=p=(0,o._)([(0,c.subclass)("esri.views.2d.layers.imagery.ImageryTileView2D")],p)})),r.register("3ygTk",(function(e,n){t(e.exports,"RasterTileContainer",(function(){return c}));var i=r("8TSCy"),a=r("8TwEW"),s=r("hgO8t"),o=r("jhrt5"),l=r("9Qv38"),u=r("66IJZ"),c=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(){var e;return i.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))).isCustomTilingScheme=!1,i.possibleConstructorReturn(e)}return i.createClass(r,[{key:"createTile",value:function(e){var t=this._getTileBounds(e),r=i.slicedToArray(this._tileInfoView.tileInfo.size,2),n=r[0],a=r[1];return new(0,l.RasterTile)(e,t[0],t[3],n,a)}},{key:"prepareRenderPasses",value:function(e){var t=this,n=e.registerRenderPass({name:"imagery (tile)",brushes:[o.brushes.raster],target:function(){return t.children.map((function(e){return e.bitmap}))},drawPhase:u.WGLDrawPhase.MAP});return i.toConsumableArray(i.get(i.getPrototypeOf(r.prototype),"prepareRenderPasses",this).call(this,e)).concat([n])}},{key:"doRender",value:function(e){this.visible&&e.drawPhase===u.WGLDrawPhase.MAP&&i.get(i.getPrototypeOf(r.prototype),"doRender",this).call(this,e)}},{key:"_getTileBounds",value:function(e){var t=this._tileInfoView.getTileBounds((0,a.create)(),e);if(this.isCustomTilingScheme&&e.world){var r=this._tileInfoView.tileInfo,n=(0,s.getWorldWidth)(r.spatialReference);if(n){var i=r.lodAt(e.level).resolution,o=n/i%r.size[0],l=o?(r.size[0]-o)*i:0;t[0]-=l*e.world,t[2]-=l*e.world}}return t}}]),r}(r("3v0eQ").default)})),r.register("9Qv38",(function(e,n){t(e.exports,"RasterTile",(function(){return o}));var i=r("8TSCy"),a=r("eYrMi"),s=r("cz22x"),o=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(e,n,a,o,l){var u,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return i.classCallCheck(this,r),(u=t.call(this,e,n,a,o,l)).bitmap=new(0,s.RasterBitmap)(c,null,null),u.bitmap.coordScale=[o,l],u.bitmap.once("isReady",(function(){return u.ready()})),i.possibleConstructorReturn(u)}return i.createClass(r,[{key:"destroy",value:function(){i.get(i.getPrototypeOf(r.prototype),"destroy",this).call(this),this.bitmap.destroy(),this.bitmap=null,this.stage=null}},{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(e){this.bitmap.stencilRef=e}},{key:"setTransform",value:function(e,t){i.get(i.getPrototypeOf(r.prototype),"setTransform",this).call(this,e,t),this.bitmap.transforms.dvs=this.transforms.dvs}},{key:"_createTransforms",value:function(){return{dvs:(0,a.c)(),tileMat3:(0,a.c)()}}},{key:"onAttach",value:function(){this.bitmap.stage=this.stage}},{key:"onDetach",value:function(){this.bitmap.stage=null}}]),r}(r("8eM7H").TiledDisplayObject)})),r.register("8eM7H",(function(e,n){t(e.exports,"TiledDisplayObject",(function(){return l}));var i=r("8TSCy"),a=r("j3x2p"),s=r("2qlsz"),o=r("i90gL"),l=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(e,n,a,s,l){var u,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:s,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l;return i.classCallCheck(this,r),(u=t.call(this)).triangleCountReportedInDebug=0,u.triangleCount=0,u.texture=null,u.key=new(0,o.default)(e),u.x=n,u.y=a,u.width=s,u.height=l,u.rangeX=c,u.rangeY=h,i.possibleConstructorReturn(u)}return i.createClass(r,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"setTransform",value:function(e,t){var r=t/(e.resolution*e.pixelRatio),n=this.transforms.tileMat3,s=i.slicedToArray(e.toScreenNoRotation([0,0],[this.x,this.y]),2),o=s[0],l=s[1],u=this.width/this.rangeX*r,c=this.height/this.rangeY*r;(0,a.s)(n,u,0,0,0,c,0,o,l,1),(0,a.m)(this.transforms.dvs,e.displayViewMat3,n)}}]),r}(s.DisplayObject)})),r.register("2qlsz",(function(e,n){t(e.exports,"DisplayObject",(function(){return c}));var i=r("8TSCy"),a=r("amfHf"),s=r("2VlWd"),o=r("7qybv"),l=r("10vEZ"),u=1/(0,s.default)("mapview-transitions-duration"),c=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(){var e;return i.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))))._fadeOutResolver=null,e._fadeInResolver=null,e._clips=null,e.computedVisible=!0,e.computedOpacity=1,e.fadeTransitionEnabled=!1,e.inFadeTransition=!1,e._isReady=!1,e._opacity=1,e._stage=null,e._visible=!0,i.possibleConstructorReturn(e)}return i.createClass(r,[{key:"clips",get:function(){return this._clips},set:function(e){this._clips=e,this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(e){if(this._stage!==e){var t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}}},{key:"transforms",get:function(){return this._getTransforms()}},{key:"_getTransforms",value:function(){return(0,o.isNone)(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible!==e&&(this._visible=e,this.requestRender())}},{key:"fadeIn",value:function(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=(0,l.createResolver)(),this.requestRender()),this._fadeInResolver.promise}},{key:"fadeOut",value:function(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=(0,l.createResolver)(),this.requestRender()),this._fadeOutResolver.promise}},{key:"beforeRender",value:function(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}},{key:"afterRender",value:function(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}},{key:"remove",value:function(){var e;null==(e=this.parent)||e.removeChild(this)}},{key:"setTransform",value:function(e){}},{key:"processRender",value:function(e){this.stage&&this.computedVisible&&this.doRender(e)}},{key:"requestRender",value:function(){this.stage&&this.stage.requestRender()}},{key:"processDetach",value:function(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}},{key:"updateTransitionProperties",value:function(e,t){if(this.fadeTransitionEnabled){var r=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===r)this.computedVisible=this.visible;else{var i=e*u;this.computedOpacity=n>r?Math.max(r,n-i):Math.min(r,n+i),this.computedVisible=this.computedOpacity>0;var a=r===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}},{key:"onAttach",value:function(){}},{key:"onDetach",value:function(){}},{key:"doRender",value:function(e){}},{key:"ready",value:function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}]),r}(a.default)})),r.register("3v0eQ",(function(e,n){t(e.exports,"default",(function(){return h}));var i=r("8TSCy"),a=r("2VlWd"),s=r("66IJZ"),o=r("3FBIK"),l=r("cq8Fg"),u=r("ht01f"),c=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},h=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(e){var n;return i.classCallCheck(this,r),(n=t.call(this))._tileInfoView=e,i.possibleConstructorReturn(n)}return i.createClass(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(c),this.setStencilReference(e),i.get(i.getPrototypeOf(r.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,n=i.get(i.getPrototypeOf(r.prototype),"createRenderParams",this).call(this,e);return n.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,n.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),n}},{key:"prepareRenderPasses",value:function(e){var t=this,n=i.get(i.getPrototypeOf(r.prototype),"prepareRenderPasses",this).call(this,e);return n.push(e.registerRenderPass({name:"stencil",brushes:[u.default],drawPhase:s.WGLDrawPhase.DEBUG|s.WGLDrawPhase.MAP|s.WGLDrawPhase.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),(0,a.default)("esri-tiles-debug")&&n.push(e.registerRenderPass({name:"tileInfo",brushes:[l.default],drawPhase:s.WGLDrawPhase.DEBUG,target:function(){return t.children}})),n}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this.children[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value,o=this._tileInfoView.getTileResolution(s.key);s.setTransform(e,o)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{key:"setStencilReference",value:function(e){var t=1,r=!0,n=!1,i=void 0;try{for(var a,s=this.children[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){a.value.stencilRef=t++}}catch(e){n=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}}}]),r}(o.default)})),r.register("5QZs5",(function(n,i){t(n.exports,"BaseImageryTileSubView2D",(function(){return P}));var a=r("8TSCy"),s=r("2TvXO"),o=r("7eJjO");r("2ILM8");var l=r("6dXDO"),u=r("jHOLN"),c=r("7qybv"),h=r("10vEZ"),f=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var y=r("fcwIv"),p=r("d1Fqh"),d=r("idX6c"),v=r("xQ42o"),g=r("4IP7o"),m=r("alctY"),x=r("jxAFe");r("3yhCg");var b=r("cqGfY");r("i90gL");var w=r("eX6AZ"),_=r("gZ2KV"),k=r("3NAox"),R=r("gINRd"),T=[0,0],C=u.default.getLogger("esri.views.2d.layers.ImageryTileLayerView2D"),P=function(t){"use strict";a.inherits(n,t);var r=a.createSuper(n);function n(){var e;return a.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._emptyTilePixelBlock=null,e._tileStrategy=null,e._tileInfoView=null,e._fetchQueue=null,e._blockCacheRegistryUrl=null,e._blockCacheRegistryId=null,e._srcResolutions=null,e.previousLOD=null,e._needBlockCacheUpdate=!1,e._globalSymbolizerParams=null,e._symbolizerParams=null,e._abortController=null,e._isCustomTilingScheme=!1,e._globalUpdateRequested=!1,e.attached=!1,e.container=null,e.layer=null,e.timeExtent=null,e.redrawOrRefetch=(0,h.debounce)((function(t,r){return!e.previousLOD||e.layerView.suspended?Promise.resolve():t?e.doRefresh():e._redrawImage(r)})),a.possibleConstructorReturn(e)}return a.createClass(n,[{key:"useWebGLForProcessing",get:function(){var e;return null==(e=this._get("useWebGLForProcessing"))||e},set:function(e){this._set("useWebGLForProcessing",e)}},{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")},set:function(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){var t=this;this._tileStrategy.destroy(),this.container.removeAllChildren();var r=this._getCacheSize(e);this._tileStrategy=new(0,_.default)({cachePolicy:"purge",acquireTile:function(e){return t.acquireTile(e)},releaseTile:function(e){return t.releaseTile(e)},cacheSize:r,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var t=e.state,r=t.extent,n=t.resolution,i=t.scale,a=this._tileInfoView.getClosestInfoForScale(i);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var o=this._srcResolutions[a.level],l=r.toJSON?r:R.default.fromJSON(r);(0,g.update)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,l,n,o,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(s=this.previousLOD)?void 0:s.level)!==a.level&&(this.previousLOD=a,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}},{key:"moveEnd",value:function(){var e=this;!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((function(){e._globalUpdateRequested=!1,e.layerView.requestUpdate()})));var t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(t),this.layerView.requestUpdate()}},{key:"updating",get:function(){return this._fetchQueue.updating||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}},{key:"attach",value:function(){var e=this;(0,k.getWebGL1Capabilities)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new(0,b.default)(this.layerView.tileInfo,this.layerView.fullExtent);var t=this._computeFetchConcurrency();this._fetchQueue=new(0,w.default)({tileInfoView:this._tileInfoView,concurrency:t,process:function(t,r){return e._fetchTile1(t,r)}});var r=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new(0,_.default)({cachePolicy:"purge",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},cacheSize:r,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}},{key:"detach",value:function(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,g.unregister)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}},{key:"acquireTile",value:function(e){var t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}},{key:"releaseTile",value:function(e){var t=this;this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",(function(){e.destroy(),t.layerView.requestUpdate()})),this.layerView.requestUpdate()}},{key:"createEmptyTilePixelBlock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&(0,c.isSome)(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;var r=a.slicedToArray(e,2),n=r[0],i=r[1],s=new(0,d.default)({width:n,height:i,pixels:[new Uint8Array(n*i)],mask:new Uint8Array(n*i),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=s),s}},{key:"_fetchTile1",value:function(e,t){var r=!(0,c.isNone)(t)&&t.signal,n=this.canUseWebGLForProcessing(),i=this.layerView,a=!i.tileInfo.isWrappable&&(0,c.isSome)((0,x.getWorldWidth)(i.view.spatialReference)),s={allowPartialFill:!0,datumTransformation:i.datumTransformation,interpolation:n?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:n,signal:(0,c.unwrap)(r),srcResolution:this._srcResolutions[e.level],timeExtent:i.timeExtent,tileInfo:i.tileInfo,disableWrapAround:a};return this.fetchTile(e,s)}},{key:"_getCacheSize",value:function(e){return e?40:0}},{key:"_initializeTileInfo",value:function(){var e=this.layerView.view.spatialReference,t=new(0,p.default)({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:e}),r=(0,x.computeProjectedScales)(this.layer.rasterInfo,e),n=r.scales,i=r.srcResolutions,a=r.isCustomTilingScheme,s=v.default.create({spatialReference:e,size:512,scales:n});(0===s.origin.x||s.origin.x>t.x)&&(s.origin=t),this._isCustomTilingScheme=a,this.layerView.set("tileInfo",s),this._srcResolutions=null!=i?i:[]}},{key:"_computeFetchConcurrency",value:function(){var e=this.layer.rasterInfo.storageInfo.blockBoundary,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}},{key:"_enqueueTileFetch",value:function(t,r){var n=this;return a.asyncToGenerator(e(s).mark((function r(){var i,a,o,l,u,c;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n._fetchQueue.has(t.key.id)){e.next=31;break}return e.prev=1,e.next=4,n._fetchQueue.push(t.key);case 4:if(i=e.sent,a=n.layer,o=a.bandIds,l=!n.useProgressiveUpdate||n.layerView.hasTilingEffects&&!n._globalSymbolizerParams,!n._globalUpdateRequested||n.layerView.moving||0!==n._fetchQueue.length){e.next=19;break}return l=!1,e.prev=10,e.next=13,n._redrawImage(n._abortController&&n._abortController.signal);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(10),(0,h.isAbortError)(e.t0)&&C.error(e.t0);case 18:n._globalUpdateRequested=!1;case 19:return!n.canUseWebGLForProcessing()&&"rasterVF"!==n.type||n.layerView.hasTilingEffects||null!=n._symbolizerParams||n._updateSymbolizerParams(),u=n._tileInfoView.getTileCoords(T,t.key),c=n._tileInfoView.getTileResolution(t.key),e.next=23,n.updateTileSource(t,{source:i,symbolizerParams:n._symbolizerParams,globalSymbolizerParams:n._globalSymbolizerParams,suspended:l,bandIds:o,coords:u,resolution:c});case 23:t.once("attach",(function(){return n.layerView.requestUpdate()})),n.container.addChild(t),e.next=30;break;case 27:e.prev=27,e.t1=e.catch(1),(0,h.isAbortError)(e.t1)||C.error(e.t1);case 30:n.layerView.requestUpdate();case 31:case"end":return e.stop()}}),r,null,[[1,27],[10,15]])})))()}},{key:"_redrawImage",value:function(t){var r=this;return a.asyncToGenerator(e(s).mark((function n(){var i;return e(s).wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==r.container.children.length){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,r.updatingHandles.addPromise(r.layer.updateRenderer());case 4:if(!r.layerView.hasTilingEffects){n.next=9;break}return n.next=7,r._updateGlobalSymbolizerParams(t);case 7:n.next=10;break;case 9:r._updateSymbolizerParams(),r._globalSymbolizerParams=null;case 10:return i=r.container.children.map(function(){var t=a.asyncToGenerator(e(s).mark((function t(n){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",r.updateTileSymbolizerParameters(n,{local:r._symbolizerParams,global:r._globalSymbolizerParams}));case 1:case"end":return e.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n.next=13,(0,h.eachAlways)(i);case 13:r.container.requestRender();case 14:case"end":return n.stop()}}),n)})))()}},{key:"_updateGlobalSymbolizerParams",value:function(t){var r=this;return a.asyncToGenerator(e(s).mark((function n(){var i,a,o;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={srcResolution:r._srcResolutions[r.previousLOD.level],registryId:r._blockCacheRegistryId,signal:t},e.next=3,r.layer.fetchPixels(r.layerView.view.extent,r.layerView.view.width,r.layerView.view.height,i);case 3:if((a=e.sent)&&a.pixelBlock){e.next=6;break}return e.abrupt("return");case 6:o=r.layer.symbolizer.generateWebGLParameters({pixelBlock:(0,m.extractBands)(a.pixelBlock,r.layer.bandIds),isGCS:r.layerView.view.spatialReference.isGeographic,resolution:{x:r.previousLOD.resolution,y:r.previousLOD.resolution},bandIds:r.layer.bandIds}),!r.canUseWebGLForProcessing()&&o&&"stretch"===o.type&&r.layer.renderer&&"raster-stretch"===r.layer.renderer.type&&(o.factor=o.factor.map((function(e){return 255*e})),o.outMin=Math.round(255*o.outMin),o.outMax=Math.round(255*o.outMax)),r._globalSymbolizerParams=o;case 8:case"end":return e.stop()}}),n)})))()}},{key:"_updateSymbolizerParams",value:function(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})}},{key:"_updateBlockCacheRegistry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.layer,r=t.url,n=t.rasterInfo,i=t.raster,a=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent}),s=a.multidimensionalDefinition,o=null!=n&&n.multidimensionalInfo?i.getSliceIndex(s):null,l=(0,g.getRasterId)(r,o);if(l!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,g.unregister)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,g.register)(l,this.layer.raster.rasterInfo),e){var u=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),c=this._srcResolutions[u.level];(0,g.update)(l,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,c,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=l}}},{key:"doRefresh",value:function(){var t=this;return a.asyncToGenerator(e(s).mark((function r(){var n;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.updatingHandles.addPromise(t.layer.updateRenderer());case 2:return t.layerView.hasTilingEffects||t._updateSymbolizerParams(),t._updateBlockCacheRegistry(!0),t._fetchQueue.reset(),n=[],t._tileStrategy.tiles.forEach((function(e){return n.push(t._enqueueTileFetch(e))})),e.next=9,(0,h.eachAlways)(n);case 9:case"end":return e.stop()}}),r)})))()}}]),n}(l.HandleOwner);(0,o._)([(0,f.property)()],P.prototype,"_fetchQueue",void 0),(0,o._)([(0,f.property)()],P.prototype,"_globalUpdateRequested",void 0),(0,o._)([(0,f.property)()],P.prototype,"attached",void 0),(0,o._)([(0,f.property)()],P.prototype,"container",void 0),(0,o._)([(0,f.property)()],P.prototype,"layer",void 0),(0,o._)([(0,f.property)()],P.prototype,"layerView",void 0),(0,o._)([(0,f.property)()],P.prototype,"type",void 0),(0,o._)([(0,f.property)()],P.prototype,"useWebGLForProcessing",null),(0,o._)([(0,f.property)()],P.prototype,"useProgressiveUpdate",null),(0,o._)([(0,f.property)()],P.prototype,"timeExtent",void 0),(0,o._)([(0,f.property)()],P.prototype,"updating",null),P=(0,o._)([(0,y.subclass)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],P)})),r.register("4IP7o",(function(e,n){t(e.exports,"getRasterId",(function(){return c})),t(e.exports,"register",(function(){return h})),t(e.exports,"unregister",(function(){return f})),t(e.exports,"decreaseRefCount",(function(){return y})),t(e.exports,"getBlock",(function(){return p})),t(e.exports,"putBlock",(function(){return d})),t(e.exports,"deleteBlock",(function(){return v})),t(e.exports,"update",(function(){return m})),r("2ILM8");var i=r("7qybv"),a=r("kynKe"),s=r("jxAFe"),o=r("d1Fqh"),l=new Map,u=new(0,a.default);function c(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function h(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(l.has(e)){var n=l.get(e);return n.push(r),n.length-1}return l.set(e,[r]),0}function f(e,t){if(l.has(e)){var r=l.get(e);r[t]=null,r.some((function(e){return null!=e}))||l.delete(e)}}function y(e,t,r){if(!l.has(e))return null==t?u.decreaseRefCount(e,r):0;var n=l.get(e);if(null==n[t])return u.decreaseRefCount(e,r);var i=n[t].cache;if(i.has(r)){var a=i.get(r);if(a.refCount--,0===a.refCount){i.delete(r);for(var s=0;s<n.length;s++)n[s]&&n[s].cache.has(r)&&n[s].cache.delete(r);a.controller&&a.controller.abort()}return a.refCount}return 0}function p(e,t,r){if(!l.has(e))return null==t?u.getBlock(e,r):null;var n=l.get(e);if(null==n[t]){for(var i=0;i<n.length;i++)if(n[i]&&n[i].cache.has(r)){var a=n[i].cache.get(r);return a.refCount++,a.block}return u.getBlock(e,r)}var s=n[t].cache;if(s.has(r)){var o=s.get(r);return o.refCount++,o.block}for(var c=0;c<n.length;c++)if(c!==t&&n[c]&&n[c]&&n[c].cache.has(r)){var h=n[c].cache.get(r);return h.refCount++,s.set(r,h),h.block}return null}function d(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(l.has(e)){var a=l.get(e);if(null!=a[t]){var s={refCount:1,block:n,isResolved:!1,isRejected:!1,controller:i};n.then((function(){return s.isResolved=!0})).catch((function(){return s.isRejected=!0})),a[t].cache.set(r,s)}else u.putBlock(e,r,n,i)}else null==t&&u.putBlock(e,r,n,i)}function v(e,t,r){if(l.has(e)){var n=l.get(e);null!=n[t]?n[t].cache.delete(r):u.deleteBlock(e,r)}else null==t&&u.deleteBlock(e,r)}function g(e,t){if(!l.has(e))return null;var r=l.get(e);return null==r[t]?null:r[t]}function m(e,t,r,n,a,l){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=g(e,t),h=c.extent,f=c.cache,y=c.rasterInfo;if(!h||h.xmin!==r.xmin||h.xmax!==r.xmax||h.ymin!==r.ymin||h.ymax!==r.ymax){for(var p=r.clone().normalize(),d=y.spatialReference,v=y.transform,m=new Set,x=0;x<p.length;x++){var b=p[x];if(!(b.xmax-b.xmin<=n||b.ymax-b.ymin<=n)){var w=(0,s.projectExtent)(b,d,u);(0,i.isSome)(v)&&(w=v.inverseTransform(w));var _=new(0,o.default)({x:n,y:n,spatialReference:b.spatialReference});if(null==a&&!(a=(0,s.projectResolution)(_,d,b,u)))return;var k=(0,s.snapPyramid)(a,y,l||"closest"),R=k.pyramidLevel,T=k.pyramidResolution,C=k.excessiveReading;if(C)return;for(var P=y.storageInfo,S=P.origin,I={x:Math.max(0,Math.floor((w.xmin-S.x)/T.x)),y:Math.max(0,Math.floor((S.y-w.ymax)/T.y))},V=Math.ceil((w.xmax-w.xmin)/T.x-.1),L=Math.ceil((w.ymax-w.ymin)/T.y-.1),O=R>0?P.pyramidBlockWidth:P.blockWidth,D=R>0?P.pyramidBlockHeight:P.blockHeight,z=1,A=Math.max(0,Math.floor(I.x/O)-z),F=Math.max(0,Math.floor(I.y/D)-z),B=Math.floor((I.x+V-1)/O)+z,M=Math.floor((I.y+L-1)/D)+z,E=F;E<=M;E++)for(var U=A;U<=B;U++)m.add("".concat(R,"/").concat(E,"/").concat(U))}}f.forEach((function(e,t){if(!m.has(t)){var r=f.get(t);(null==r||r.isResolved||r.isRejected)&&f.delete(t)}})),c.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}}})),r.register("kynKe",(function(e,n){t(e.exports,"default",(function(){return a}));var i=r("8TSCy"),a=function(){"use strict";function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;i.classCallCheck(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,r)}return i.createClass(e,[{key:"decreaseRefCount",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.refCount--,i.refCount<=0&&(n.delete(r),i.controller&&i.controller.abort()),i.refCount}return 0}},{key:"getBlock",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.ts=Date.now(),i.refCount++,n.delete(r),n.set(r,i),i.block}return null}},{key:"putBlock",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this._cachedBlocks,a=e+"/"+t;if(i.has(a)){var s=i.get(a);s.ts=Date.now(),s.refCount++}else i.set(a,{block:r,ts:Date.now(),refCount:1,controller:n});this._trim(),this._updateTimer()}},{key:"deleteBlock",value:function(e,t){var r=this._cachedBlocks,n=e+"/"+t;r.has(n)&&r.delete(n)}},{key:"updateMaxSize",value:function(e){this._size=e,this._trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this._clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"_updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var r=Array.from(t),n=Date.now(),i=0;i<r.length&&r[i][1].ts<=n-e._duration;i++)t.delete(r[i][0]);0===t.size&&e._clearTimer()}),this._interval)}}},{key:"_trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),r=0;r<t.length-this._size;r++)e.delete(t[r][0])}},{key:"_clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}()})),r.register("9M3e1",(function(e,n){t(e.exports,"toJSONGeometryType",(function(){return a})),t(e.exports,"canUseMajorityInterpolationOnDataSource",(function(){return s}));var i=new(0,r("79ASa").JSONMap)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function a(e){return i.toJSON(e)}function s(e){var t=e.rasterInfo,r=t.bandCount,n=t.attributeTable,i=t.colormap,a=t.pixelType;return 1===r&&(null!=n||null!=i||"u8"===a||"s8"===a)}})),r.register("cvwLd",(function(n,i){t(n.exports,"default",(function(){return d}));var a=r("8TSCy"),s=r("2TvXO"),o=r("7eJjO"),l=r("7qybv"),u=r("lKPaD"),c=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var h=r("fcwIv"),f=r("2hwKJ"),y=r("92Lzu"),p=function(t){"use strict";a.inherits(n,t);var r=a.createSuper(n);function n(){var e;return a.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._handle=null,e.container=null,e.layer=null,e.type="rasterVF",a.possibleConstructorReturn(e)}return a.createClass(n,[{key:"canUseWebGLForProcessing",value:function(){return!1}},{key:"fetchTile",value:function(t,r){var n=this;return a.asyncToGenerator(e(s).mark((function i(){var o;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.objectSpread({},r,{interpolation:"nearest",requestProjectedLocalDirections:!0}),e.next=3,n.layer.fetchTile(t.level,t.row,t.col,r);case 3:if(o=e.sent,e.t0="vector-magdir"===n.layer.rasterInfo.dataType&&null!=o&&o.pixelBlock,!e.t0){e.next=9;break}return e.next=8,n.layer.convertVectorFieldData(o.pixelBlock,r);case 8:o.pixelBlock=e.sent;case 9:return e.abrupt("return",(e.t0,o));case 10:case"end":return e.stop()}}),i)})))()}},{key:"updateTileSource",value:function(e,t){var r=t.symbolizerParams,n=e.tileData;n.key=e.key,n.width=this._tileInfoView.tileInfo.size[0],n.height=this._tileInfoView.tileInfo.size[1];var i=r.symbolTileSize,a=t.source;if(n.offset=this._getTileSymbolOffset(n.key,i),(0,l.isSome)(a)&&(0,l.isSome)(a.pixelBlock)){var s={extent:a.extent,pixelBlock:a.pixelBlock};n.rawPixelData=s,n.symbolizerParameters=r,n.source=this._sampleVectorFieldData(a.pixelBlock,r,n.offset)}else{var o=[Math.round((this._tileInfoView.tileInfo[0]-n.offset[0])/i),Math.round((this._tileInfoView.tileInfo[1]-n.offset[1])/i)],u=this.createEmptyTilePixelBlock(o);n.source=u,n.symbolizerParameters=r}return n.invalidateVAO(),Promise.resolve(null)}},{key:"updateTileSymbolizerParameters",value:function(e,t){var r,n=t.local,i=n.symbolTileSize,a=e.tileData;a.offset=this._getTileSymbolOffset(a.key,i);var s=a.symbolizerParameters.symbolTileSize;return a.symbolizerParameters=n,(0,l.isSome)(null==(r=a.rawPixelData)?void 0:r.pixelBlock)&&s!==i&&(a.source=this._sampleVectorFieldData(a.rawPixelData.pixelBlock,a.symbolizerParameters,a.offset)),Promise.resolve(null)}},{key:"attach",value:function(){var e=this;a.get(a.getPrototypeOf(n.prototype),"attach",this).call(this),this.container=new(0,y.RasterVFTileContainer)(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=(0,u.watch)((function(){return e.layer.renderer}),(function(t){return e._updateSymbolType(t)}))}},{key:"detach",value:function(){a.get(a.getPrototypeOf(n.prototype),"detach",this).call(this),this.container.removeAllChildren(),this._handle.remove(),this._handle=null}},{key:"_getTileSymbolOffset",value:function(e,t){var r=e.col*this._tileInfoView.tileInfo.size[0]%t,n=e.row*this._tileInfoView.tileInfo.size[1]%t;return[r>t/2?t-r:-r,n>t/2?t-n:-n]}},{key:"_sampleVectorFieldData",value:function(e,t,r){var n=t.symbolTileSize;return(0,f.sampleVectorField)(e,"vector-uv",n,r)}},{key:"_updateSymbolType",value:function(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}}]),n}(r("5QZs5").BaseImageryTileSubView2D);(0,o._)([(0,c.property)()],p.prototype,"container",void 0),(0,o._)([(0,c.property)()],p.prototype,"layer",void 0),(0,o._)([(0,c.property)()],p.prototype,"type",void 0);var d=p=(0,o._)([(0,h.subclass)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],p)})),r.register("92Lzu",(function(e,n){t(e.exports,"RasterVFTileContainer",(function(){return u}));var i=r("8TSCy"),a=r("8TwEW"),s=r("lysbb"),o=r("4KFRm"),l=r("66IJZ"),u=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(){var e;return i.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))).isCustomTilingScheme=!1,e.symbolTypes=["triangle"],i.possibleConstructorReturn(e)}return i.createClass(r,[{key:"createTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,a.create)(),e),r=i.slicedToArray(this._tileInfoView.tileInfo.size,2),n=r[0],s=r[1];return new(0,o.RasterVFTile)(e,t[0],t[3],n,s)}},{key:"prepareRenderPasses",value:function(e){var t=this,n=e.registerRenderPass({name:"imagery (vf tile)",brushes:[s.default],target:function(){return t.children.map((function(e){return e.tileData}))},drawPhase:l.WGLDrawPhase.MAP});return i.toConsumableArray(i.get(i.getPrototypeOf(r.prototype),"prepareRenderPasses",this).call(this,e)).concat([n])}},{key:"doRender",value:function(e){var t=this;this.visible&&e.drawPhase===l.WGLDrawPhase.MAP&&this.symbolTypes.forEach((function(n){e.renderPass=n,i.get(i.getPrototypeOf(r.prototype),"doRender",t).call(t,e)}))}}]),r}(r("3v0eQ").default)})),r.register("4KFRm",(function(e,n){t(e.exports,"RasterVFTile",(function(){return l}));var i=r("8TSCy"),a=r("j3x2p"),s=r("eYrMi"),o=r("9q7kD"),l=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(e,n,a,s,l){var u,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return i.classCallCheck(this,r),(u=t.call(this,e,n,a,s,l)).tileData=new(0,o.RasterVFDisplayObject)(c),u.tileData.coordScale=[s,l],u.tileData.once("isReady",(function(){return u.ready()})),i.possibleConstructorReturn(u)}return i.createClass(r,[{key:"destroy",value:function(){i.get(i.getPrototypeOf(r.prototype),"destroy",this).call(this),this.tileData.destroy(),this.tileData=null,this.stage=null}},{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(e){this.tileData.stencilRef=e}},{key:"_createTransforms",value:function(){return{dvs:(0,s.c)(),tileMat3:(0,s.c)()}}},{key:"setTransform",value:function(e,t){i.get(i.getPrototypeOf(r.prototype),"setTransform",this).call(this,e,t);var n=t/(e.resolution*e.pixelRatio),s=this.transforms.tileMat3,o=i.slicedToArray(this.tileData.offset,2),l=o[0],u=o[1],c=[this.x+l*t,this.y-u*t],h=i.slicedToArray(e.toScreenNoRotation([0,0],c),2),f=h[0],y=h[1],p=this.tileData.symbolizerParameters.symbolTileSize,d=Math.round((this.width-this.tileData.offset[0])/p)*p,v=Math.round((this.height-this.tileData.offset[1])/p)*p,g=d/this.rangeX*n,m=v/this.rangeY*n;(0,a.s)(s,g,0,0,0,m,0,f,y,1),(0,a.m)(this.transforms.dvs,e.displayViewMat3,s),this.tileData.transforms.dvs=this.transforms.dvs}},{key:"onAttach",value:function(){this.tileData.stage=this.stage}},{key:"onDetach",value:function(){this.tileData.stage=null}}]),r}(r("8eM7H").TiledDisplayObject)})),r.register("afdWM",(function(n,i){t(n.exports,"ImageryTileLayerView",(function(){return v}));var a=r("8TSCy"),s=r("2TvXO"),o=r("7eJjO"),l=r("bsvXr"),u=r("kyj08"),c=r("7qybv"),h=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var f=r("fcwIv"),y=r("gRgX5"),p=r("jxAFe"),d=r("dB39e"),v=function(t){var r=function(t){"use strict";a.inherits(n,t);var r=a.createSuper(n);function n(){var e;return a.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._rasterFieldPrefix="Raster.",e.layer=null,e.view=null,e.tileInfo=null,a.possibleConstructorReturn(e)}return a.createClass(n,[{key:"fullExtent",get:function(){return this._getfullExtent()}},{key:"_getfullExtent",value:function(){return this.projectFullExtent(this.view.spatialReference)}},{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"datumTransformation",get:function(){return(0,p.getDefaultDatumTransformationForDataset)((0,c.unwrap)(this.layer.fullExtent),this.view.spatialReference,!0)}},{key:"supportsSpatialReference",value:function(e){return!!this.projectFullExtent(e)}},{key:"projectFullExtent",value:function(e){var t=(0,c.unwrap)(this.layer.fullExtent),r=(0,p.getDefaultDatumTransformationForDataset)(t,e,!1);return(0,p.projectExtent)(t,e,r)}},{key:"fetchPopupFeatures",value:function(t,r){var n=this;return a.asyncToGenerator(e(s).mark((function i(){var a,o,h,f,y,p,v,g,m,x,b,w,_,k,R,T,C,P,S;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.layer,t){e.next=3;break}return e.abrupt("return",Promise.reject(new(0,u.default)("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:a})));case 3:if(o=a.popupEnabled,h=(0,d.getFetchPopupTemplate)(a,r),o&&(0,c.isSome)(h)){e.next=6;break}throw new(0,u.default)("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:o,popupTemplate:h});case 6:return f=[],e.next=9,a.identify(t,{timeExtent:n.timeExtent});case 9:if(y=e.sent,p=y.value,v=y.magdirValue,g="",p&&p.length){if(g="imagery-tile"===a.type&&a.hasStandardTime()&&null!=p[0]?p.map((function(e){return a.getStandardTimeValue(e)})).join(", "):p.join(", "),(b={ObjectId:0})[w="Raster.ServicePixelValue"]=n._formatAttributeValue(g,w),(_=null==(m=a.rasterInfo)||null==(x=m.attributeTable)?void 0:x.features)&&_.length>0&&(k=_.filter((function(e){var t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===g}))).length>0&&(R=k[0]))for(T in R.attributes)R.attributes.hasOwnProperty(T)&&(C=n._rasterFieldPrefix+T,b[C]=n._formatAttributeValue(R.attributes[T],C));"vector-magdir"!==(P=a.rasterInfo.dataType)&&"vector-uv"!==P||(b["Raster.Magnitude"]=null==v?void 0:v[0],b["Raster.Direction"]=null==v?void 0:v[1]),(S=new(0,l.default)(n.fullExtent.clone(),null,b)).layer=a,S.sourceLayer=S.layer,f.push(S)}return e.abrupt("return",f);case 15:case"end":return e.stop()}}),i)})))()}},{key:"_formatAttributeValue",value:function(e,t){if("string"==typeof e){var r,n,i=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,a=this._getFieldInfo(i,t),s=a&&a.format;if(s)return e.trim().indexOf(",")>-1?(n=(r=",")+" ",this._formatDelimitedString(e,r,n,s)):e.trim().indexOf(" ")>-1?(r=n=" ",this._formatDelimitedString(e,r,n,s)):this._formatNumberFromString(e,s)}return e}},{key:"_getFieldInfo",value:function(e,t){if(e&&e.length&&t){var r,n=t.toLowerCase();return e.some((function(e){return!(!e.fieldName||e.fieldName.toLowerCase()!==n&&e.fieldName.toLowerCase()!==n.replace(/ /g,"_")||(r=e,0))})),r}}},{key:"_formatDelimitedString",value:function(e,t,r,n){var i=this;return e&&t&&r&&n?e.trim().split(t).map((function(e){return i._formatNumberFromString(e,n)})).join(r):e}},{key:"_formatNumberFromString",value:function(e,t){if(!e||!t)return e;var r=Number(e);return isNaN(r)?e:t.format(r)}}]),n}(t);return(0,o._)([(0,h.property)()],r.prototype,"layer",void 0),(0,o._)([(0,h.property)(y.combinedViewLayerTimeExtentProperty)],r.prototype,"timeExtent",void 0),(0,o._)([(0,h.property)()],r.prototype,"view",void 0),(0,o._)([(0,h.property)()],r.prototype,"fullExtent",null),(0,o._)([(0,h.property)()],r.prototype,"tileInfo",void 0),(0,o._)([(0,h.property)({readOnly:!0})],r.prototype,"hasTilingEffects",null),r=(0,o._)([(0,f.subclass)("esri.views.layers.ImageryTileLayerView")],r)}})),r.register("dB39e",(function(n,i){t(n.exports,"getRequiredFields",(function(){return u})),t(n.exports,"getFetchPopupTemplate",(function(){return h}));var a=r("8TSCy"),s=r("2TvXO"),o=r("7qybv"),l=r("7vTUY");function u(e){return c.apply(this,arguments)}function c(){return c=a.asyncToGenerator(e(s).mark((function t(r){var n,i,u,c,h,f,y,p,d,v=arguments;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v.length>1&&void 0!==v[1]?v[1]:r.popupTemplate,(0,o.isSome)(n)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,n.getRequiredFields(r.fieldsIndex);case 5:if(i=e.sent,u=n.lastEditInfoEnabled,c=r.objectIdField,h=r.typeIdField,f=r.globalIdField,y=r.relationships,!i.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!u){e.next=19;break}return e.next=16,(0,l.getFeatureEditFields)(r);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return p=e.t0,d=(0,l.fixFields)(r.fieldsIndex,a.toConsumableArray(i).concat(a.toConsumableArray(p))),e.abrupt("return",(h&&d.push(h),d&&c&&r.fieldsIndex.has(c)&&-1===d.indexOf(c)&&d.push(c),d&&f&&r.fieldsIndex.has(f)&&-1===d.indexOf(f)&&d.push(f),y&&y.forEach((function(e){var t=e.keyField;d&&t&&r.fieldsIndex.has(t)&&-1===d.indexOf(t)&&d.push(t)})),d));case 23:case"end":return e.stop()}}),t)}))),c.apply(this,arguments)}function h(e,t){return e.popupTemplate?e.popupTemplate:(0,o.isSome)(t)&&t.defaultPopupTemplateEnabled&&(0,o.isSome)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}})),r.register("hfthk",(function(e,n){t(e.exports,"RefreshableLayerView",(function(){return h}));var i=r("8TSCy"),a=r("7eJjO"),s=r("jHOLN"),o=r("10vEZ"),l=r("lKPaD"),u=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var c=r("fcwIv"),h=function(e){var t=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(){return i.classCallCheck(this,r),t.apply(this,arguments)}return i.createClass(r,[{key:"initialize",value:function(){var e=this;this.handles.add((0,l.on)((function(){return e.layer}),"refresh",(function(t){var r=e;e.doRefresh(t.dataChanged).catch((function(e){(0,o.isAbortError)(e)||s.default.getLogger(r.declaredClass).error(e)}))})),"RefreshableLayerView")}}]),r}(e);return(0,a._)([(0,u.property)()],t.prototype,"layer",void 0),t=(0,a._)([(0,c.subclass)("esri.layers.mixins.RefreshableLayerView")],t)}})),r.register("8lbQw",(function(e,r){t(e.exports,"u32to4Xu8",(function(){return i})),t(e.exports,"i1616to32",(function(){return a})),t(e.exports,"i8888to32",(function(){return s}));var n=new Float32Array(1);new Uint32Array(n.buffer);function i(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function a(e,t){return 65535&e|t<<16}function s(e,t,r,n){return 255&e|(255&t)<<8|(255&r)<<16|n<<24}})),r.register("6S0qa",(function(e,r){var n,i,a,s;function o(e){switch(e){case"left":return n.Left;case"right":return n.Right;case"center":case"justify":return n.Center}}function l(e){switch(e){case"top":return i.Top;case"middle":return i.Center;case"baseline":return i.Baseline;case"bottom":return i.Bottom}}function u(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return[n.Right,i.Bottom];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return[n.Center,i.Bottom];case"above-right":case"esriServerPointLabelPlacementAboveRight":return[n.Left,i.Bottom];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return[n.Right,i.Center];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return[n.Center,i.Center];case"center-right":case"esriServerPointLabelPlacementCenterRight":return[n.Left,i.Center];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return[n.Right,i.Top];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return[n.Center,i.Top];case"below-right":case"esriServerPointLabelPlacementBelowRight":return[n.Left,i.Top];default:return console.debug("Found invalid placement type ".concat(e)),[n.Center,i.Center]}}function c(e){switch(e){case n.Right:return-1;case n.Center:return 0;case n.Left:return 1;default:return console.debug("Found invalid horizontal alignment ".concat(e)),0}}function h(e){switch(e){case i.Top:return 1;case i.Center:return 0;case i.Bottom:case i.Baseline:return-1;default:return console.debug("Found invalid vertical alignment ".concat(e)),0}}function f(e){switch(e){case"left":return n.Left;case"right":return n.Right;case"center":case"justify":return n.Center}}function y(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}t(e.exports,"HAlign",(function(){return n})),t(e.exports,"VAlign",(function(){return i})),t(e.exports,"getXAnchorDirection",(function(){return o})),t(e.exports,"getYAnchorDirection",(function(){return l})),t(e.exports,"getAlignmentFromPlacement",(function(){return u})),t(e.exports,"getXDirection",(function(){return c})),t(e.exports,"getYDirection",(function(){return h})),t(e.exports,"getJustification",(function(){return f})),t(e.exports,"isMapAligned",(function(){return y})),(s=n||(n={}))[s.Left=-1]="Left",s[s.Center=0]="Center",s[s.Right=1]="Right",(a=i||(i={}))[a.Top=1]="Top",a[a.Center=0]="Center",a[a.Bottom=-1]="Bottom",a[a.Baseline=2]="Baseline"})),r.register("iTfMY",(function(e,r){t(e.exports,"radToByte",(function(){return o})),t(e.exports,"degToByte",(function(){return l})),t(e.exports,"log2",(function(){return u})),t(e.exports,"between",(function(){return c}));Number.POSITIVE_INFINITY;var n=Math.PI,i=128/n,a=1/Math.LN2;function s(e,t){return(e%=t)>=0?e:e+t}function o(e){return s(e*i,256)}function l(e){return s(.7111111111111111*e,256)}function u(e){return Math.log(e)*a}function c(e,t,r){return e>=t&&e<=r||e>=r&&e<=t}})),r.register("2ndsO",(function(e,r){t(e.exports,"e",(function(){return s}));var n,i,a={exports:{}};n=a,void 0!==(i=function(){function e(e,i,a){a=a||2;var s,o,u,h,f,p,d,v=i&&i.length,g=v?i[0]*a:e.length,m=t(e,0,g,a,!0),x=[];if(!m||m.next===m.prev)return x;if(v&&(m=function(e,n,i,a){var s,o,u,h=[];for(s=0,o=n.length;s<o;s++)(u=t(e,n[s]*a,s<o-1?n[s+1]*a:e.length,a,!1))===u.next&&(u.steiner=!0),h.push(y(u));for(h.sort(l),s=0;s<h.length;s++)i=r(i=c(h[s],i),i.next);return i}(e,i,m,a)),e.length>80*a){s=u=e[0],o=h=e[1];for(var b=a;b<g;b+=a)(f=e[b])<s&&(s=f),(p=e[b+1])<o&&(o=p),f>u&&(u=f),p>h&&(h=p);d=0!==(d=Math.max(u-s,h-o))?1/d:0}return n(m,x,a,s,o,d),x}function t(e,t,r,n,i){var a,s;if(i===C(e,t,r,n)>0)for(a=t;a<r;a+=n)s=k(a,e[a],e[a+1],s);else for(a=r-n;a>=t;a-=n)s=k(a,e[a],e[a+1],s);if(s&&g(s,s.next)){var o=s.next;R(s),s=o}return s}function r(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!g(n,n.next)&&0!==v(n.prev,n,n.next))n=n.next;else{var i=n.prev;if(R(n),(n=t=i)===n.next)break;r=!0}}while(r||n!==t);return t}function n(e,t,l,u,c,h,y){if(e){!y&&h&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=f(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,s,o,l,u=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,n=r,o=0,t=0;t<u&&(o++,n=n.nextZ);t++);for(l=u;o>0||l>0&&n;)0!==o&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,u*=2}while(s>1)}(i)}(e,u,c,h);for(var p,d,v=e;e.prev!==e.next;)if(p=e.prev,d=e.next,h?a(e,u,c,h):i(e))t.push(p.i/l),t.push(e.i/l),t.push(d.i/l),R(e),e=d.next,v=d.next;else if((e=d)===v){y?1===y?n(e=s(r(e),t,l),t,l,u,c,h,2):2===y&&o(e,t,l,u,c,h):n(r(e),t,l,u,c,h,1);break}}}function i(e){var t=e.prev,r=e,n=e.next;if(v(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(p(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&v(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function a(e,t,r,n){var i=e.prev,a=e,s=e.next;if(v(i,a,s)>=0)return!1;for(var o=i.x<a.x?i.x<s.x?i.x:s.x:a.x<s.x?a.x:s.x,l=i.y<a.y?i.y<s.y?i.y:s.y:a.y<s.y?a.y:s.y,u=i.x>a.x?i.x>s.x?i.x:s.x:a.x>s.x?a.x:s.x,c=i.y>a.y?i.y>s.y?i.y:s.y:a.y>s.y?a.y:s.y,h=f(o,l,t,r,n),y=f(u,c,t,r,n),d=e.prevZ,g=e.nextZ;d&&d.z>=h&&g&&g.z<=y;){if(d!==e.prev&&d!==e.next&&p(i.x,i.y,a.x,a.y,s.x,s.y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,g!==e.prev&&g!==e.next&&p(i.x,i.y,a.x,a.y,s.x,s.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&p(i.x,i.y,a.x,a.y,s.x,s.y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;g&&g.z<=y;){if(g!==e.prev&&g!==e.next&&p(i.x,i.y,a.x,a.y,s.x,s.y,g.x,g.y)&&v(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function s(e,t,n){var i=e;do{var a=i.prev,s=i.next.next;!g(a,s)&&m(a,i,i.next,s)&&w(a,s)&&w(s,a)&&(t.push(a.i/n),t.push(i.i/n),t.push(s.i/n),R(i),R(i.next),i=e=s),i=i.next}while(i!==e);return r(i)}function o(e,t,i,a,s,o){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&d(l,u)){var c=_(l,u);return l=r(l,l.next),c=r(c,c.next),n(l,t,i,a,s,o),void n(c,t,i,a,s,o)}u=u.next}l=l.next}while(l!==e)}function l(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;for(var t=e;;){var r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function c(e,t){var n=function(e,t){var r,n=t,i=e.x,a=e.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var o=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=i&&o>s){if(s=o,o===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r;var l,u=r,c=r.x,f=r.y,y=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&p(a<f?i:s,a,c,f,a<f?s:i,a,n.x,n.y)&&(l=Math.abs(a-n.y)/(i-n.x),w(n,e)&&(l<y||l===y&&(n.x>r.x||n.x===r.x&&h(r,n)))&&(r=n,y=l)),n=n.next}while(n!==u);return r}(e,t);if(!n)return t;var i=_(n,e),a=r(n,n.next),s=u(i);return r(s,s.next),a=u(a),u(t===n?a:t)}function h(e,t){return v(e.prev,e,t.prev)<0&&v(t.next,e,e.next)<0}function f(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function p(e,t,r,n,i,a,s,o){return(i-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(n-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(i-s)*(n-o)>=0}function d(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&m(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(w(e,t)&&w(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(v(e.prev,e,t.prev)||v(e,t.prev,t))||g(e,t)&&v(e.prev,e,e.next)>0&&v(t.prev,t,t.next)>0)}function v(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function g(e,t){return e.x===t.x&&e.y===t.y}function m(e,t,r,n){var i=b(v(e,t,r)),a=b(v(e,t,n)),s=b(v(r,n,e)),o=b(v(r,n,t));return i!==a&&s!==o||!(0!==i||!x(e,r,t))||!(0!==a||!x(e,n,t))||!(0!==s||!x(r,e,n))||!(0!==o||!x(r,t,n))}function x(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function b(e){return e>0?1:e<0?-1:0}function w(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function _(e,t){var r=new T(e.i,e.x,e.y),n=new T(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function k(e,t,r,n){var i=new T(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function R(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,r,n){for(var i=0,a=t,s=r-n;a<r;a+=n)i+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return i}return e.deviation=function(e,t,r,n){var i=t&&t.length,a=i?t[0]*r:e.length,s=Math.abs(C(e,0,a,r));if(i)for(var o=0,l=t.length;o<l;o++){var u=t[o]*r,c=o<l-1?t[o+1]*r:e.length;s-=Math.abs(C(e,u,c,r))}var h=0;for(o=0;o<n.length;o+=3){var f=n[o]*r,y=n[o+1]*r,p=n[o+2]*r;h+=Math.abs((e[f]-e[p])*(e[y+1]-e[f+1])-(e[f]-e[y])*(e[p+1]-e[f+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var s=0;s<t;s++)r.vertices.push(e[i][a][s]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r},e}())&&(n.exports=i);var s=a.exports})),r.register("ebEEs",(function(e,r){t(e.exports,"DECLUTTER_TILES",(function(){return n})),t(e.exports,"COLLISION_GRID_CELL_SIZE",(function(){return i})),t(e.exports,"DECLUTTER_BUDGET",(function(){return a})),t(e.exports,"FADE_DURATION",(function(){return s}));var n=!0,i=32,a=1.5,s=200})),r.register("cOrC4",(function(e,n){t(e.exports,"Container",(function(){return o}));var i=r("8TSCy"),a=r("eYrMi"),s=r("a4nX6"),o=function(e){"use strict";i.inherits(r,e);var t=i.createSuper(r);function r(){var e;return i.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))))._childrenSet=new Set,e._needsSort=!1,e.children=[],e._effectView=null,i.possibleConstructorReturn(e)}return i.createClass(r,[{key:"blendMode",get:function(){return this._blendMode},set:function(e){this._blendMode=e,this.requestRender()}},{key:"clips",get:function(){return this._clips},set:function(e){this._clips=e,this.children.forEach((function(t){return t.clips=e}))}},{key:"computedEffects",get:function(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effects)?e:null}},{key:"effect",get:function(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effect)?e:""},set:function(e){(this._effectView||e)&&(this._effectView||(this._effectView=new(0,s.EffectView)),this._effectView.effect=e,this.requestRender())}},{key:"updateTransitionProperties",value:function(e,t){i.get(i.getPrototypeOf(r.prototype),"updateTransitionProperties",this).call(this,e,t),this._effectView&&(this._effectView.transitionStep(e,t),this._effectView.transitioning&&this.requestRender())}},{key:"doRender",value:function(e){var t=this.createRenderParams(e);this.renderChildren(t)}},{key:"addChild",value:function(e){return this.addChildAt(e,this.children.length)}},{key:"addChildAt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.children.length;if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;var r=e.parent;return r&&r!==this&&r.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}},{key:"contains",value:function(e){return this._childrenSet.has(e)}},{key:"removeAllChildren",value:function(){this._childrenSet.clear(),this._needsSort=!0;var e=!0,t=!1,r=void 0;try{for(var n,i=this.children[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var a=n.value;this!==this.stage&&(a.clips=null),a.stage=null,a.parent=null}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this.children.length=0}},{key:"removeChild",value:function(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}},{key:"removeChildAt",value:function(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;var t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}},{key:"sortChildren",value:function(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}},{key:"_createTransforms",value:function(){return{dvs:(0,a.c)()}}},{key:"onAttach",value:function(){i.get(i.getPrototypeOf(r.prototype),"onAttach",this).call(this);var e=this.stage,t=!0,n=!1,a=void 0;try{for(var s,o=this.children[Symbol.iterator]();!(t=(s=o.next()).done);t=!0){s.value.stage=e}}catch(e){n=!0,a=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}}},{key:"onDetach",value:function(){i.get(i.getPrototypeOf(r.prototype),"onDetach",this).call(this);var e=!0,t=!1,n=void 0;try{for(var a,s=this.children[Symbol.iterator]();!(e=(a=s.next()).done);e=!0){a.value.stage=null}}catch(e){t=!0,n=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}}},{key:"renderChildren",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this.children[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.beforeRender(e)}}catch(e){r=!0,n=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}var s=!0,o=!1,l=void 0;try{for(var u,c=this.children[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){u.value.processRender(e)}}catch(e){o=!0,l=e}finally{try{s||null==c.return||c.return()}finally{if(o)throw l}}var h=!0,f=!1,y=void 0;try{for(var p,d=this.children[Symbol.iterator]();!(h=(p=d.next()).done);h=!0){p.value.afterRender(e)}}catch(e){f=!0,y=e}finally{try{h||null==d.return||d.return()}finally{if(f)throw y}}}},{key:"createRenderParams",value:function(e){return i.objectSpread({},e,{blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition})}}]),r}(r("2qlsz").DisplayObject)}))}();
//# sourceMappingURL=ImageryTileLayerView2D.ab053885.js.map
