!function(){function e(e,t,r,s){Object.defineProperty(e,t,{get:r,set:s,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("fXPOl",(function(r,s){var n;n=r.exports,Object.defineProperty(n,"__esModule",{value:!0,configurable:!0}),e(r.exports,"default",(function(){return _}));var i=t("7eJjO"),a=t("6dXDO");t("2VlWd");var o=t("lKPaD"),u=t("iho5X");t("iJAIC"),t("lNwWH");var l=t("fcwIv"),c=t("eY5Yp"),d=t("xQ42o"),h=t("kLL2y"),f=t("5fErK"),p=t("887rD"),g=t("8LcfB"),m=t("cqGfY");let y=class extends a.HandleOwner{initialize(){this.handles.add((0,o.watch)((()=>this.updating),(e=>{this.remoteClient.invoke("setUpdating",e).catch((e=>{}))})))}destroy(){var e,t;this.stop(),null===(e=this.controller)||void 0===e||e.destroy(),null===(t=this.processor)||void 0===t||t.destroy(),this.controller=this.processor=this.tileStore=this.remoteClient=null}get updating(){return!this.controller||this.controller.updating}stop(){var e,t,r;this._paused=!0,Array.isArray(null===(e=this.service)||void 0===e?void 0:e.source)&&(this.service.source.forEach((e=>e.close())),this.service.source.length=0),null===(t=this.tileStore)||void 0===t||t.updateTiles({added:[],removed:this.tileStore.tiles.map((e=>e.id))}),null===(r=this.tileStore)||void 0===r||r.destroy(),this.tileStore=null,this._pendingTileUpdates.length=0}async startup({service:e,config:t,tileInfo:r,tiles:s}){var n;if(this._paused=!0,Array.isArray(null===(n=this.service)||void 0===n?void 0:n.source)&&(this.service.source.forEach((e=>e.close())),this.service.source.length=0),this.service=e,!this.tileStore||!(0,c.equals)(this.tileStore.tileScheme.spatialReference,r.spatialReference)){var i,a;const e=new(0,m.default)(d.default.fromJSON(r));s.added.length=s.removed.length=0,null===(i=this.tileStore)||void 0===i||i.updateTiles({added:[],removed:this.tileStore.tiles.map((e=>e.id))}),null===(a=this.tileStore)||void 0===a||a.destroy(),this.tileStore=new(0,p.default)(e),this._pendingTileUpdates.length=0}for(await this._createProcessorAndController(t),await this.update({config:t}),this.controller.resume(),this.tileStore.clear(),this.tileStore.updateTiles(s),this._paused=!1;this._pendingTileUpdates.length;)this.tileStore.updateTiles(this._pendingTileUpdates.pop())}async updateTiles(e){var t;this._paused?this._pendingTileUpdates.push(e):null===(t=this.tileStore)||void 0===t||t.updateTiles(e)}async update({config:e}){const t=g.UpdateToken.empty();return await Promise.all([this.processor.update(t,e),this.controller.update(t,e)]),t.toJSON()}async applyUpdate(e){return this.controller.applyUpdate(g.UpdateToken.create(e))}async _createProcessorAndController(e){await Promise.all([this._handleControllerConfig(e),this._handleProcessorConfig(e)]),this.controller.processor=this.processor}async _handleControllerConfig(e){return this._createController(this.service,e)}async _handleProcessorConfig(e){return this._createProcessor(this.service,e)}async _createController(e,t){this.controller&&this.controller.destroy();const{tileStore:r,remoteClient:s}=this,n=new(0,f.default)({service:e,tileStore:r,remoteClient:s});return this.controller=n,n}async _createProcessor(e,t){const r=t.schema.processors[0].type,s=(await(0,h.loadProcessorModule)(r)).default,{remoteClient:n,tileStore:i}=this,a=new s({service:e,config:t,tileStore:i,remoteClient:n});return this.processor&&this.processor.destroy(),this.processor=a,a}constructor(){super(...arguments),this.controller=null,this.processor=null,this.remoteClient=null,this.tileStore=null,this.service=null,this.viewState=null,this._paused=!1,this._pendingTileUpdates=[]}};(0,i._)([(0,u.property)()],y.prototype,"controller",void 0),(0,i._)([(0,u.property)()],y.prototype,"processor",void 0),(0,i._)([(0,u.property)()],y.prototype,"updating",null),(0,i._)([(0,u.property)()],y.prototype,"viewState",void 0),y=(0,i._)([(0,l.subclass)("esri.views.2d.layers.features.Pipeline")],y);const _=y})),t.register("kLL2y",(function(r,s){function n(e){return t("heatmap"===e?"kaphY":"fA7lp")}e(r.exports,"loadProcessorModule",(function(){return n}))})),t.register("kaphY",(function(e,r){e.exports=t("4WKyX")(t("aNJCr").getBundleURL("b3gJV")+t("iE7OH").resolve("ef3zG")).then((()=>t("8hKBq")))})),t.register("fA7lp",(function(e,r){e.exports=Promise.all([t("4WKyX")(t("aNJCr").getBundleURL("b3gJV")+t("iE7OH").resolve("enYtM")),t("4WKyX")(t("aNJCr").getBundleURL("b3gJV")+t("iE7OH").resolve("ktoAc")),t("4WKyX")(t("aNJCr").getBundleURL("b3gJV")+t("iE7OH").resolve("6AOLD")),t("4WKyX")(t("aNJCr").getBundleURL("b3gJV")+t("iE7OH").resolve("iT6wT"))]).then((()=>t("9Mf0w")))})),t.register("5fErK",(function(r,s){e(r.exports,"default",(function(){return A}));var n=t("7eJjO"),i=t("lNwWH"),a=t("6dXDO"),o=t("2VlWd"),u=t("7qybv"),l=t("10vEZ"),c=t("lKPaD"),d=t("iho5X");t("iJAIC");var h=t("fcwIv"),f=t("akQYU"),p=t("f3b5K"),g=t("4nMX7"),m=t("dEIm1"),y=t("7GExb"),_=t("8c8ji"),v=t("9Ic5L"),I=t("eJHSv"),S=t("angIQ"),x=t("5STKO"),b=t("8LcfB"),T=t("incs0");function w(e){if(!(0,l.isAbortError)(e)&&!function(e){return"worker:port-closed"===e.name}(e))throw e}function F(e){return"feature"===e.type&&"snapshot"===e.mode}let E=class extends a.HandleOwner{initialize(){this._initStores(),this._initSource(),this._updateQueue=new(0,T.QueueProcessor)({concurrency:"stream"===this._source.type?1:4,process:(e,t)=>this._onTileMessage(e,{signal:t})}),this.addHandles([this.tileStore.on("update",this.onTileUpdate.bind(this)),(0,c.when)((()=>!this.updating),(()=>this.onIdle()))])}_initSource(){const e=this.tileStore.tileScheme;this._source=(0,y.createSource)(this.service,this.spatialReference,e,((e,t)=>(this._invalidated=!0,this._patchTile(e,t))),(()=>this._updateQueue&&this._updateQueue.length<50),this.featureStore),this._proxyEvents()}_setStreamClientProperty(e,t){this.remoteClient.invoke("setProperty",{propertyName:e,value:t}).catch(w)}_proxyEvents(){if("stream"===this._source.type){const e=this._source.events,t=this._source;this.addHandles([(0,c.watch)((()=>t.connectionStatus),(e=>this._setStreamClientProperty("pipelineConnectionStatus",e)),{initial:!0}),(0,c.watch)((()=>t.errorString),(e=>this._setStreamClientProperty("pipelineErrorString",e)),{initial:!0}),e.on("data-received",(e=>this.remoteClient.invoke("emitEvent",{name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}}).catch(w))),e.on("message-received",(e=>this.remoteClient.invoke("emitEvent",{name:"message-received",event:e}).catch(w))),e.on("updateRate",(e=>this.remoteClient.invoke("emitEvent",{name:"update-rate",event:{...e}}).catch(w)))])}}_initAttributeStore(e){this.attributeStore||(this.attributeStore=new(0,_.default)({type:"remote",initialize:(e,t)=>(0,l.ignoreAbortErrors)(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.initialize",e,{signal:t}).catch(w)),update:(e,t)=>(0,l.ignoreAbortErrors)(this.remoteClient.invoke("tileRenderer.featuresView.attributeView.requestUpdate",e,{signal:t}).catch(w)),render:e=>(0,l.ignoreAbortErrors)(this.remoteClient.invoke("tileRenderer.featuresView.requestRender",void 0,{signal:e}).catch(w))},e))}_initStores(){const e="snapshot"===this.service.type?"snapshot":"on-demand",t={geometryInfo:{geometryType:this.service.geometryType,hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.featureStore=new(0,m.FeatureStore2D)(t,this._storage,e)}_initQueryEngine(e){var t;const r=this;var s;null===(t=this.featureQueryEngine)||void 0===t||t.destroy(),this.featureQueryEngine=new(0,p.QueryEngine)({definitionExpression:null!==(s=e.schema.source.definitionExpression)&&void 0!==s?s:void 0,fields:this.service.fields,geometryType:this.service.geometryType,objectIdField:this.service.objectIdField,hasM:!1,hasZ:!1,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!0,featureStore:this.featureStore,aggregateAdapter:{getFeatureObjectIds:e=>null==r.aggregateStore?[]:r.aggregateStore.getFeatureDisplayIdsForAggregate(e).map((e=>r.getObjectId(e)))},timeInfo:this.service.timeInfo})}_initAggregateQueryEngine(e,t){var r;if(null===(r=this.aggregateQueryEngine)||void 0===r||r.destroy(),null==e)return;const s=t.targets.aggregate.params.fields.slice();this.aggregateQueryEngine=new(0,p.QueryEngine)({definitionExpression:void 0,fields:s,geometryType:e.geometryInfo.geometryType,objectIdField:e.objectIdField,hasM:e.geometryInfo.hasM,hasZ:e.geometryInfo.hasZ,spatialReference:this.spatialReference.toJSON(),cacheSpatialQueries:!1,featureStore:e,aggregateAdapter:{getFeatureObjectIds:e=>[]}})}destroy(){var e,t,r;this._updateQueue.destroy(),this._source.destroy(),null===(e=this.featureQueryEngine)||void 0===e||e.destroy(),null===(t=this.aggregateQueryEngine)||void 0===t||t.destroy(),null===(r=this.attributeStore)||void 0===r||r.destroy();for(const e of this.tileStore.tiles)this._source.unsubscribe(e);clearInterval(this._checkUpdating)}get fieldsIndex(){return new(0,g.default)(this.service.fields)}get spatialReference(){return this.tileStore.tileScheme.spatialReference}get updating(){return this.isUpdating()}isUpdating(){const e=this._source.updatingHandles.updating,t=!this.attributeStore||this.attributeStore.updatingHandles.updating,r=e||t||this.updatingHandles.updating;if((0,o.default)("esri-2d-log-updating")){let s=`Updating FeatureController2D: ${r}\n`;s+=`  -> updatingSource ${e}\n`;for(const e of this._source.subscriptions)s+=`     ${e.tile.id} ${e.isDone}\n`;s+=`  -> updatingAttributeStore ${t}\n`,s+=`  -> updatingHandles ${this.updatingHandles.updating} (queue: ${this._updateQueue.length})\n`,console.log(s)}return r}updateCustomParameters(e){"stream"===this._source.type&&this._source.updateCustomParameters(e)}enableEvent(e){this._source.enableEvent(e.name,e.value)}pause(){this._updateQueue.pause(),this._updateQueue.clear()}resume(){this._updateQueue.resume()}pauseStream(){"stream"===this._source.type&&this._source.pauseStream()}resumeStream(){"stream"===this._source.type&&this._source.resumeStream()}sendMessageToSocket(e){"stream"===this._source.type&&this._source.sendMessageToSocket(e)}sendMessageToClient(e){"stream"===this._source.type&&this._source.sendMessageToClient(e)}_initAggregateStore(e){var t,r;const s=null===(t=e.schema.targets)||void 0===t||null===(r=t.aggregate)||void 0===r?void 0:r.type,n=(0,u.applySome)(this.config,(e=>{var t,r;return null===(t=e.schema.targets)||void 0===t||null===(r=t.aggregate)||void 0===r?void 0:r.type}));if(n!==s&&(null!=this.aggregateStore&&(this.removeHandles("valueRangesChanged"),this.aggregateStore.destroy(),this.aggregateStore=null),s)){switch(s){case"cluster":{const e={geometryInfo:{geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.aggregateStore=new(0,I.ClusterStore)(e,this.spatialReference,this._storage,this.service),this.addHandles(this.aggregateStore.events.on("valueRangesChanged",(e=>{this.remoteClient.invoke("emitEvent",{name:"valueRangesChanged",event:{valueRanges:e.valueRanges}}).catch(w)})),"valueRangesChanged");break}case"bin":{const e={geometryInfo:{geometryType:"esriGeometryPolygon",hasM:!1,hasZ:!1},spatialReference:this.spatialReference,fieldsIndex:this.fieldsIndex,fields:this.service.fields};this.aggregateStore=new(0,v.BinStore)(e,this.spatialReference,this._storage,this.service);break}}this.aggregateStore.onTileUpdate({added:this.tileStore.tiles,removed:[]})}}async update(e,t){this._updateVersion++,(0,o.default)("esri-2d-update-debug")&&console.debug(`FeatureController2D::update: Token version ${this._updateVersion}`),this._initQueryEngine(t),this._initAttributeStore(t),this.pause(),await Promise.all([this._source.update(e,t.schema.source),this.featureStore.updateSchema(e,t.schema.targets.feature),this.attributeStore.update(e,t),this.attributeStore.updateFilters(e,t,this)]),this._initAggregateStore(t),null!=this.aggregateStore&&await this.aggregateStore.updateSchema(e,t.schema.targets.aggregate),this._initAggregateQueryEngine(this.aggregateStore,t.schema),(0,o.default)("esri-2d-update-debug")&&e.describe(),this._set("config",t)}async applyUpdate(e){e.version=this._updateVersion,(0,o.default)("esri-2d-update-debug")&&console.debug(`FeatureController2D::applyUpdate: Token version ${e.version}`),e.mesh&&this.clearTiles(),this._updateQueue.resume(),await this._source.applyUpdate(e),(0,o.default)("esri-2d-update-debug")&&console.debug("FeatureController2D::applyUpdate Waiting for source update to finish"),this.notifyChange("updating"),await(0,c.whenOnce)((()=>!this.updating)),(0,o.default)("esri-2d-update-debug")&&console.debug("FeatureController2D::applyUpdate Source update finsihed"),null!=this.aggregateStore&&(await(0,l.after)(10),(0,o.default)("esri-2d-update-debug")&&console.debug("FeatureController2D::applyUpdate Waiting for aggregate idle call"),await(0,c.whenOnce)((()=>!this.updating)),(0,o.default)("esri-2d-update-debug")&&console.debug("FeatureController2D::applyUpdate Aggregate idle called")),(0,o.default)("esri-2d-update-debug")&&console.debug("FeatureController2D::applyUpdate Update finished")}async onEdits({edits:e}){(0,o.default)("esri-2d-update-debug")&&console.debug("Applying Edit:",e),this._didEdit=!0;try{const t=e.removed.map((e=>e.objectId&&-1!==e.objectId?e.objectId:this._lookupObjectIdByGlobalId(e.globalId))),r=e.addOrModified.map((({objectId:e})=>e));this.featureStore.invalidate(),await this._source.edit(r,t),this.clearTiles(),this.notifyChange("updating"),null!=this.aggregateStore&&this.aggregateStore.clear(),await this._source.resend(),await(0,c.whenOnce)((()=>!this.updating))}catch(e){}}async refresh(e){if(!e.dataChanged){const e=b.UpdateToken.empty();return e.storage.filters=!0,this.applyUpdate(e)}this.featureStore.invalidate(),this.clearTiles(),this._source.refresh(this._updateVersion,e),this._cleanupNeeded=!0,this.notifyChange("updating"),await(0,c.whenOnce)((()=>!this.updating))}clearTiles(){for(const e of this.tileStore.tiles)this.processor.onTileClear(e,!1)}onTileUpdate(e){null!=this.aggregateStore&&this.aggregateStore.onTileUpdate(e);for(const t of e.added)this._source.subscribe(t,this._updateVersion),this._level=t.level;for(const t of e.removed)this._source.unsubscribe(t),this._cleanupNeeded=!0,this._tileToResolver.has(t.id)&&(this._tileToResolver.get(t.id).resolve(),this._tileToResolver.delete(t.id));this.notifyChange("updating")}async onIdle(){this._invalidated&&(this._invalidated=!1,null==this.aggregateStore&&"heatmap"!==this.processor.type||await this._repushCurrentLevelTiles()),this._markAndSweep()}async querySummaryStatistics({query:e,params:t}){return this.featureQueryEngine.executeQueryForSummaryStatistics(e,t)}async queryAggregateSummaryStatistics({query:e,params:t}){return this.aggregateQueryEngine.executeQueryForSummaryStatistics(this._normalizeAggregateQuery(e),t)}async queryUniqueValues({query:e,params:t}){return this.featureQueryEngine.executeQueryForUniqueValues(e,t)}async queryAggregateUniqueValues({query:e,params:t}){return this.aggregateQueryEngine.executeQueryForUniqueValues(this._normalizeAggregateQuery(e),t)}async queryClassBreaks({query:e,params:t}){return this.featureQueryEngine.executeQueryForClassBreaks(e,t)}async queryAggregateClassBreaks({query:e,params:t}){return this.aggregateQueryEngine.executeQueryForClassBreaks(this._normalizeAggregateQuery(e),t)}async queryHistogram({query:e,params:t}){return this.featureQueryEngine.executeQueryForHistogram(e,t)}async queryAggregateHistogram({query:e,params:t}){return this.aggregateQueryEngine.executeQueryForHistogram(this._normalizeAggregateQuery(e),t)}queryExtent(e){return this.featureQueryEngine.executeQueryForExtent(e)}queryAggregates(e){return this.aggregateQueryEngine.executeQuery(this._normalizeAggregateQuery(e))}queryAggregateCount(e){return this.aggregateQueryEngine.executeQueryForCount(this._normalizeAggregateQuery(e))}queryAggregateIds(e){return this.aggregateQueryEngine.executeQueryForIds(this._normalizeAggregateQuery(e))}queryFeatures(e){return this.featureQueryEngine.executeQuery(e)}async queryVisibleFeatures(e){const t=await this.featureQueryEngine.executeQuery(e),r=t.objectIdFieldName;return t.features=t.features.filter((e=>{const t=e.attributes[r],s=this.getDisplayId(t);return(0,u.applySome)(s,(e=>this.attributeStore.isVisible(e)))})),t}queryFeatureCount(e){return this.featureQueryEngine.executeQueryForCount(e)}queryLatestObservations(e){return this.featureQueryEngine.executeQueryForLatestObservations(e)}queryObjectIds(e){return this.featureQueryEngine.executeQueryForIds(e)}async queryStatistics(){return this.featureStore.storeStatistics}getObjectId(e){return this.featureStore.lookupObjectId(e,this._storage)}getDisplayId(e){if(null!=this.aggregateStore){const t=this.aggregateStore.getDisplayId(e);if(null==t){const t=this.featureStore.lookupDisplayId(e);return this.aggregateStore.getDisplayIdForReferenceId(t)}return t}return this.featureStore.lookupDisplayId(e)}getFeatures(e){const t=[],r=[];for(const s of e){const e=null!=this.aggregateStore?this.getAggregate(s):null;if(null!=e)if(null!=e.attributes.referenceId){const r=this.getFeature(e.attributes.referenceId);null!=r&&t.push(r)}else r.push(e);else{const e=this.getFeature(s);null!=e&&t.push(e)}}return{features:t,aggregates:r}}getFeature(e){const t=this.featureStore.lookupFeatureByDisplayId(e,this._storage);if(null==t)return null;const r=t.readHydratedGeometry(),s=(0,f.convertToGeometry)(r,t.geometryType,t.hasZ,t.hasM);return{attributes:t.readAttributes(),geometry:s}}getAggregate(e){return null==this.aggregateStore?null:this.aggregateStore.getAggregate(e)}getAggregates(){return null==this.aggregateStore?[]:this.aggregateStore.getAggregates()}async setHighlight(e){const t=e.map((e=>this.getDisplayId(e))).filter(i.isSome);return this.attributeStore.setHighlight(e,t)}_normalizeAggregateQuery(e){var t;const r=null!==(t=e.objectIds)&&void 0!==t?t:[];var s;for(const t of null!==(s=e.aggregateIds)&&void 0!==s?s:[])r.push(t);return e.objectIds=r,e.aggregateIds=[],e}_lookupObjectIdByGlobalId(e){const t=this.service.globalIdField;if(null==t)throw new Error("Expected globalIdField to be defined");let r=null;if(this.featureStore.forEach((s=>{e===s.readAttribute(t)&&(r=s.getObjectId())})),null==r)throw new Error(`Expected to find a feature with globalId ${e}`);return r}async _repushCurrentLevelTiles(){const e=this.tileStore.tiles.filter((e=>e.level===this._level));e.map((async e=>this._patchTile({type:"append",id:e.key.id,clear:!0,addOrUpdate:null,end:!1})));const t=e.map((async e=>this._patchTile({type:"append",id:e.key.id,addOrUpdate:x.FeatureSetReaderJSON.fromOptimizedFeatures([],this.service),remove:[],end:!0,isRepush:!0,status:b.UpdateToken.empty()})));await Promise.all(t)}_maybeForceCleanup(){performance.now()-this._lastCleanup>5e3&&this._markAndSweep()}_patchTile(e,t){const r=this._updateQueue.push(e,t).catch((e=>{}));return this.updatingHandles.addPromise(r)}async _onTileMessage(e,t){if((0,l.throwIfAborted)(t),(0,o.default)("esri-2d-update-debug")){const t=(0,u.applySome)(e.addOrUpdate,(e=>e.hasFeatures));console.debug(e.id,`FeatureController:onTileMessage: [clear:${e.clear}, end:${e.end}, features: ${t}]`)}const r=this.tileStore.get(e.id);if(!r)return;if(e.clear)return this.processor.onTileClear(r,e.end);const s=e.status;this._cleanupNeeded=!0;const n=[];var i;for(const t of null!==(i=e.remove)&&void 0!==i?i:[]){const e=this.featureStore.lookupDisplayId(t);e&&n.push(e)}e.remove=n;try{if(null==e.addOrUpdate)return void this.processor.onTileMessage(r,{...e,addOrUpdate:null},null!=this.aggregateStore,t).catch(l.throwIfNotAbortError);if(e.addOrUpdate.setArcadeSpatialReference(this.spatialReference),this.featureStore.hasInstance(e.addOrUpdate.instance)&&s.targets.feature||(s.targets.feature=!0,this.featureStore.onTileData(r,e)),s.storage.data&&s.storage.filters||(s.storage.data=!0,s.storage.filters=!0,this.attributeStore.onTileData(r,e),"stream"===this._source.type||this._didEdit?(await this.attributeStore.sendUpdates(),(0,l.throwIfAborted)(t)):this.attributeStore.sendUpdates()),null!=this.aggregateStore&&!s.targets.aggregate){s.targets.aggregate=!0;const t=F(this._source)&&this._source.loading,n=!F(this._source)||t||e.end;if(this.aggregateStore.onTileData(r,e,this._storage,this.attributeStore,n),!n)return;s.mesh||(this.attributeStore.onTileData(r,e),await this.attributeStore.sendUpdates())}if(!s.mesh){s.mesh=!0;const n=null!=this.aggregateStore&&"cluster"===this.aggregateStore.type;await this.processor.onTileMessage(r,e,n,t),(0,l.throwIfAborted)(t)}this._maybeForceCleanup()}catch(e){(0,l.throwIfNotAbortError)(e)}}_mark(e,t,r){const s=(4294901760&this._storage.getInstanceId(e))>>>16;e&&(t.add(s),r.set(e))}_markAndSweep(){if(this._lastCleanup=performance.now(),"feature"===this._source.type&&"snapshot"===this._source.mode||"stream"!==this._source.type&&!this._cleanupNeeded)return;this._cleanupNeeded=!1;const e=this._storage.getBitset(this._markedIdsBufId),t=new Set;e.clear();for(const r of this.tileStore.tiles)for(const s of this._source.readers(r.id)){const r=s.getCursor();for(;r.next();){let s=r.getDisplayId();if(!s){const e=r.getObjectId();s=this.featureStore.lookupDisplayId(e)}this._mark(s,t,e)}}"symbol"===this.processor.type&&this.processor.forEachBufferId((r=>{this._mark(r,t,e)})),this._updateQueue.forEach((r=>{var s;for(const n of null!==(s=r.remove)&&void 0!==s?s:[]){const r=this.featureStore.lookupDisplayId(n);this._mark(r,t,e)}})),null!=this.aggregateStore&&(this.aggregateStore.sweepFeatures(e,this.featureStore),"sweepAggregates"in this.aggregateStore&&this.aggregateStore.sweepAggregates(this._storage,this.attributeStore,this._level)),this.featureStore.sweepFeatures(e,this._storage,this.attributeStore),this.featureStore.sweepFeatureSets(t)}constructor(){super(...arguments),this._storage=new(0,S.ComputedAttributeStorage),this._markedIdsBufId=this._storage.createBitset(),this._lastCleanup=performance.now(),this._cleanupNeeded=!1,this._invalidated=!1,this._tileToResolver=new Map,this._didEdit=!1,this._updateVersion=1,this.tileStore=null,this.config=null,this.processor=null,this.remoteClient=null,this.service=null}};(0,n._)([(0,d.property)({constructOnly:!0})],E.prototype,"tileStore",void 0),(0,n._)([(0,d.property)()],E.prototype,"config",void 0),(0,n._)([(0,d.property)({readOnly:!0})],E.prototype,"fieldsIndex",null),(0,n._)([(0,d.property)()],E.prototype,"processor",void 0),(0,n._)([(0,d.property)({constructOnly:!0})],E.prototype,"remoteClient",void 0),(0,n._)([(0,d.property)({constructOnly:!0})],E.prototype,"service",void 0),(0,n._)([(0,d.property)()],E.prototype,"spatialReference",null),(0,n._)([(0,d.property)()],E.prototype,"updating",null),E=(0,n._)([(0,h.subclass)("esri.views.2d.layers.features.controllers.FeatureController2D")],E);const A=E})),t.register("dEIm1",(function(r,s){e(r.exports,"featureAdapter",(function(){return p})),e(r.exports,"FeatureStore2D",(function(){return g}));var n=t("gDoEW"),i=t("amfHf");t("2VlWd");var a=t("38gAI"),o=t("ayLat"),u=t("eOTSy"),l=t("esg0R");const c=(0,o.create)();function d(e,t){return e<<16|t}function h(e){return(4294901760&e)>>>16}function f(e){return 65535&e}const p={getObjectId:e=>e.getObjectId(),getAttributes:e=>e.readAttributes(),getAttribute:(e,t)=>e.readAttribute(t),cloneWithGeometry:(e,t)=>e,getGeometry:e=>e.readHydratedGeometry(),getCentroid:(e,t)=>e.readCentroid()};class g extends u.Store2D{get storeStatistics(){let e=0,t=0,r=0;return this.forEach((s=>{const n=s.readGeometry();n&&(t+=n.isPoint?1:n.lengths.reduce(((e,t)=>e+t),0),r+=n.isPoint?1:n.lengths.length,e+=1)})),{featureCount:e,vertexCount:t,ringCount:r}}hasInstance(e){return this._featureSetsByInstance.has(e)}onTileData(e,t){if(null==t.addOrUpdate)return t;if(t.addOrUpdate.attachStorage(this._storage),"snapshot"===this.mode){const r=t.addOrUpdate.getCursor();for(;r.next();){const t=r.getDisplayId();this.setComputedAttributes(this._storage,r,t,e.scale)}return t}this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate);const r=t.addOrUpdate.getCursor();for(;r.next();)this._insertFeature(r,e.scale);return this._spatialIndexInvalid=!0,this.events.emit("changed"),t}search(e){this._rebuildIndex();const t=e.id,r=this._indexSearchCache.find((e=>e.tileId===t));if(null!=r)return r.readers;const s=new Map,n=this._searchIndex(e.bounds),i=[];for(const e of n){const t=this._storage.getInstanceId(e),r=h(t),n=f(t);s.has(r)||s.set(r,[]),s.get(r).push(n)}return s.forEach(((e,t)=>{const r=this._featureSetsByInstance.get(t);i.push(l.FeatureSetReaderIndirect.from(r,e))})),this._indexSearchCache.enqueue({tileId:t,readers:i}),i}insert(e){const t=e.getCursor(),r=this._storage;for(;t.next();){var s;const e=d(t.instance,t.getIndex()),n=t.getObjectId(),i=null!==(s=this._objectIdToDisplayId.get(n))&&void 0!==s?s:this._storage.createDisplayId();t.setDisplayId(i),r.setInstanceId(i,e),this._objectIdToDisplayId.set(n,i)}this._featureSetsByInstance.set(e.instance,e),this._spatialIndexInvalid=!0}remove(e){const t=this._objectIdToDisplayId.get(e);if(!t)return;const r=this._storage.getInstanceId(t),s=f(r),n=h(r),i=this._featureSetsByInstance.get(n);this._objectIdToDisplayId.delete(e),this._storage.releaseDisplayId(t),i.removeAtIndex(s),i.isEmpty&&this._featureSetsByInstance.delete(n),this._spatialIndexInvalid=!0}forEach(e){this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t),s=this._lookupFeature(r);e(s)}))}forEachUnsafe(e){this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t),s=h(r),n=f(r),i=this._getFeatureSet(s);i.setIndex(n),e(i)}))}forEachInBounds(e,t){const r=this._searchIndex(e);for(const e of r)t(this.lookupFeatureByDisplayId(e,this._storage))}forEachBounds(e,t){this._rebuildIndex();for(const r of e){if(!r.readGeometry())continue;const e=r.getDisplayId();(0,o.fromRectValues)(c,this._storage.getXMin(e),this._storage.getYMin(e),this._storage.getXMax(e),this._storage.getYMax(e)),t(c)}}sweepFeatures(e,t,r){this._spatialIndexInvalid=!0,this._objectIdToDisplayId.forEach(((s,n)=>{e.has(s)||(t.releaseDisplayId(s),r&&r.unsetAttributeData(s),this._objectIdToDisplayId.delete(n))})),this.events.emit("changed")}sweepFeatureSets(e){this._spatialIndexInvalid=!0,this._featureSetsByInstance.forEach(((t,r)=>{e.has(r)||this._featureSetsByInstance.delete(r)}))}lookupObjectId(e,t){const r=this.lookupFeatureByDisplayId(e,t);return null==r?null:r.getObjectId()}lookupDisplayId(e){return this._objectIdToDisplayId.get(e)}lookupFeatureByDisplayId(e,t){const r=t.getInstanceId(e);return this._lookupFeature(r)}lookupByDisplayIdUnsafe(e){const t=this._storage.getInstanceId(e),r=h(t),s=f(t),n=this._getFeatureSet(r);return n?(n.setIndex(s),n):null}_insertFeature(e,t){const r=this._storage,s=e.getObjectId(),n=d(e.instance,e.getIndex());r.getInstanceId(e.getDisplayId());let i=this._objectIdToDisplayId.get(s);i||(i=r.createDisplayId(),this._objectIdToDisplayId.set(s,i),this._spatialIndexInvalid=!0),e.setDisplayId(i),r.setInstanceId(i,n),this.setComputedAttributes(r,e,i,t)}_searchIndex(e){this._rebuildIndex();const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}_rebuildIndex(){if(!this._spatialIndexInvalid)return;const e=[];"snapshot"===this.mode?this._featureSetsByInstance.forEach((t=>{const r=t.getCursor();for(;r.next();){const t=r.getDisplayId();this._storage.setBounds(t,r)&&e.push(t)}})):this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t);this._storage.setBounds(t,this._lookupFeature(r))&&e.push(t)})),this._index.clear(),this._index.load(e),this._indexSearchCache.clear(),this._spatialIndexInvalid=!1}_lookupFeature(e){const t=h(e),r=this._getFeatureSet(t);if(!r)return;const s=r.getCursor(),n=f(e);return s.setIndex(n),s}_getFeatureSet(e){return this._featureSetsByInstance.get(e)}constructor(e,t,r){super(e,t),this.featureAdapter=p,this.events=new(0,i.default),this._featureSetsByInstance=new Map,this._objectIdToDisplayId=new Map,this._spatialIndexInvalid=!0,this._indexSearchCache=new(0,n.default)(50),this._index=(0,a.r)(9,(e=>({minX:this._storage.getXMin(e),minY:this._storage.getYMin(e),maxX:this._storage.getXMax(e),maxY:this._storage.getYMax(e)}))),this.mode=r}}})),t.register("gDoEW",(function(t,r){e(t.exports,"default",(function(){return s}));class s{get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}dequeue(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}peek(){return 0===this.size?null:this._buffer[this._start]}find(e){if(0===this.size)return null;for(const t of this._buffer)if(null!=t&&e(t))return t;return null}clear(e){let t=this.dequeue();for(;null!=t;)e&&e(t),t=this.dequeue()}constructor(e){this.size=0,this._start=0,this.maxSize=e,this._buffer=new Array(e)}}})),t.register("eOTSy",(function(r,s){e(r.exports,"Store2D",(function(){return u}));var n=t("2VlWd"),i=t("9doMy"),a=t("3nnTb"),o=t("6v4Fw");class u{get storage(){return this._storage}invalidate(){this._bitsets.computed.clear()}async updateSchema(e,t){const r=(0,i.diff)(this._schema,t);if(this._schema=t,!t||null==r||!(0,i.hasDiff)(r,"attributes"))return;(0,n.default)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",r),this._bitsets.computed.clear(),e.targets[t.name]=!0;const s=t.attributes,a=[],o=[];for(const e in s){const t=s[e];switch(t.type){case"field":break;case"expression":a.push(this._createArcadeComputedField(t));break;case"label-expression":a.push(this._createLabelArcadeComputedField(t));break;case"statistic":o.push(t)}}this._computedFields=await Promise.all(a),this._canCacheExpressionValue=!this._computedFields.some((e=>"expression"===e.type&&null!=e.expression&&e.expression.referencesScale())),this._statisticFields=o}setComputedAttributes(e,t,r,s){const n=this._bitsets.computed;if(!this._canCacheExpressionValue||!n.has(r)){n.set(r);for(const n of this._computedFields){const i=this._evaluateField(t,n,s);switch(n.resultType){case"numeric":e.setComputedNumericAtIndex(r,n.fieldIndex,i);break;case"string":e.setComputedStringAtIndex(r,n.fieldIndex,i)}}}}async _createArcadeComputedField(e){const t=this._sourceInfo.spatialReference,r=this._sourceInfo.fieldsIndex;return{...e,expression:await(0,a.createRendererExpression)(e.valueExpression,t,r)}}async _createLabelArcadeComputedField(e){const r=this._sourceInfo.spatialReference,s=this._sourceInfo.fieldsIndex,{createLabelFunction:n}=await t("6V5uk"),i=await n(e.label,s,r);return{...e,builder:i}}_evaluateField(e,t,r){switch(t.type){case"label-expression":{const r=e.readArcadeFeature();return t.builder.evaluate(r)||""}case"expression":{const{expression:s}=t;return(0,o.default)(s,e,{$view:{scale:r}})}}}constructor(e,t){this._canCacheExpressionValue=!1,this._sourceInfo=e,this._storage=t,this._bitsets={computed:t.getBitset(t.createBitset())}}}})),t.register("6v4Fw",(function(r,s){e(r.exports,"default",(function(){return i}));var n=t("jHOLN");function i(e,t,r){if(null==e)return null;const s=t.readArcadeFeature();try{return e.evaluate({...r,$feature:s},e.services)}catch(e){return n.default.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}})),t.register("6V5uk",(function(e,r){e.exports=t("4WKyX")(t("aNJCr").getBundleURL("b3gJV")+t("iE7OH").resolve("eeyk4")).then((()=>t("gZc4S")))})),t.register("esg0R",(function(r,s){e(r.exports,"FeatureSetReaderIndirect",(function(){return i}));var n=t("jBcNl");class i extends n.FeatureSetReader{static from(e,t){return new i(e.copy(),t)}get fields(){return this._reader.fields}get hasNext(){return this._currentIndex+1<this._indices.length}getSize(){return this._indices.length}getCursor(){return this.copy()}copy(){const e=new i(this._reader.copy(),this._indices);return e._currentIndex=this._currentIndex,e}next(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}_nextIndex(){return++this._currentIndex<this._indices.length&&(this._reader.setIndex(this._indices[this._currentIndex]),!0)}setArcadeSpatialReference(e){this._reader.setArcadeSpatialReference(e)}attachStorage(e){this._reader.attachStorage(e)}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}getStorage(){return this._reader.getStorage()}getComputedNumeric(e){return this._reader.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this._reader.setComputedNumericAtIndex(t,0)}getComputedString(e){return this._reader.getComputedStringAtIndex(0)}setComputedString(e,t){return this._reader.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._reader.getComputedNumericAtIndex(e)}setComputedNumericAtIndex(e,t){this._reader.setComputedNumericAtIndex(e,t)}getComputedStringAtIndex(e){return this._reader.getComputedStringAtIndex(e)}setComputedStringAtIndex(e,t){return this._reader.setComputedStringAtIndex(e,t)}transform(e,t,r,s){const n=this.copy();return n._reader=this._reader.transform(e,t,r,s),n}readAttribute(e,t=!1){return this._reader.readAttribute(e,t)}readAttributes(){return this._reader.readAttributes()}joinAttributes(e){return this._reader.joinAttributes(e)}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(e){return this.readAttribute(e,!0)}hasField(e){return this._reader.hasField(e)}setField(e,t){return this._reader.setField(e,t)}keys(){return this._reader.keys()}castToText(e=!1){return this._reader.castToText(e)}getQuantizationTransform(){return this._reader.getQuantizationTransform()}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(e){return this._reader.setDisplayId(e)}getGroupId(){return this._reader.getGroupId()}setGroupId(e){return this._reader.setGroupId(e)}getXHydrated(){return this._reader.getXHydrated()}getYHydrated(){return this._reader.getYHydrated()}getX(){return this._reader.getX()}getY(){return this._reader.getY()}setIndex(e){return this._reader.setIndex(e)}getIndex(){return this._reader.getIndex()}readLegacyFeature(){return this._reader.readLegacyFeature()}readOptimizedFeature(){return this._reader.readOptimizedFeature()}readLegacyPointGeometry(){return this._reader.readLegacyPointGeometry()}readLegacyGeometry(){return this._reader.readLegacyGeometry()}readLegacyCentroid(){return this._reader.readLegacyCentroid()}readGeometryArea(){return this._reader.readGeometryArea()}readUnquantizedGeometry(){return this._reader.readUnquantizedGeometry()}readHydratedGeometry(){return this._reader.readHydratedGeometry()}readGeometry(){return this._reader.readGeometry()}readCentroid(){return this._reader.readCentroid()}_readAttribute(e,t){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}_readAttributes(){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}constructor(e,t){super(n.FeatureSetReader.createInstance(),e.fullSchema()),this._currentIndex=-1,this._reader=e,this._indices=t}}})),t.register("7GExb",(function(r,s){e(r.exports,"createSource",(function(){return l}));var n=t("lmu5w"),i=t("am3mk"),a=t("aVi46"),o=t("hSjjm"),u=t("fMY8t");function l(e,t,r,s,l,c){const d=function(e,t,r,s,i,a){switch(e.type){case"snapshot":var o;return{type:"feature",origin:"snapshot",featureCount:null!==(o=e.featureCount)&&void 0!==o?o:0,serviceInfo:e,onMessage:s,outSR:t,tileInfoView:r,canAcceptRequest:i,store:a};case"stream":return{type:"stream",serviceInfo:e,onMessage:s,outSR:t,canAcceptRequest:i};case"memory":case"on-demand":return{type:"feature",serviceInfo:e,onMessage:s,outSR:t,origin:u(e.source),tileInfoView:r,canAcceptRequest:i}}function u(e){return Array.isArray(e)?"local":"path"in e&&(0,n.isHostedAgolService)(e.path)?"hosted":"unknown"}}(e,t,r,s,l,c);switch(d.type){case"feature":switch(d.origin){case"hosted":case"local":return new(0,a.PagedFeatureSource)(d);case"snapshot":return new(0,o.SnapshotFeatureSource)(d);default:return new(0,i.DrillDownFeatureSource)(d)}case"stream":return new(0,u.StreamSource)(d)}}})),t.register("am3mk",(function(r,s){e(r.exports,"DrillDownFeatureSource",(function(){return l}));var n=t("2VlWd"),i=t("10vEZ"),a=t("NMQPz");const o=(0,n.default)("esri-mobile"),u={maxDrillLevel:o?1:4,maxRecordCountFactor:o?1:3};class l extends a.BaseFeatureSource{async _fetchDataTile(e){const t=this._serviceInfo.capabilities.query.supportsMaxRecordCountFactor,r=this._subscriptions.get(e.key.id),s=r.signal,n=e.getQuantizationParameters();let a=0;const o=async(l,c)=>{const d=this._queryInfo,h=this.createTileQuery(l,{maxRecordCountFactor:t?u.maxRecordCountFactor:void 0,returnExceededLimitFeatures:!1,quantizationParameters:n});a++;try{const t=await this.enqueueQuery({tile:e,query:h,signal:s,depth:c});if(a--,(0,i.throwIfAborted)(s),!t)return;if(d!==this._queryInfo)return void o(l,c);if(t.exceededTransferLimit&&c<u.maxDrillLevel){for(const e of l.createChildTiles())o(e,c+1);return}const n={id:e.id,addOrUpdate:t,end:0===a,type:"append"};r.add({query:h,message:n}),this._onMessage(n)}catch(t){if(!(0,i.isAbortError)(t)){const t={id:e.id,addOrUpdate:null,end:!0,type:"append"};r.add({query:h,message:t}),this._onMessage(t)}}};o(e,0)}constructor(e){super(e)}}})),t.register("NMQPz",(function(r,s){e(r.exports,"BaseFeatureSource",(function(){return h}));var n=t("9pNSx"),i=t("kyj08"),a=t("2VlWd"),o=t("jHOLN"),u=t("10vEZ"),l=t("cCtf4"),c=t("23qU2"),d=t("incs0");class h extends c.DataTileSource{destroy(){super.destroy(),this._adapter.destroy(),this._queue.destroy(),this._patchQueue.destroy()}enqueueQuery(e,t){return this.updatingHandles.addPromise(this._queue.push(e,t))}enqueuePatchQuery(e,t){return this.updatingHandles.addPromise(this._patchQueue.push(e,t))}get maxRecordCountFactor(){const{query:e}=this._serviceInfo.capabilities;return e.supportsMaxRecordCountFactor?4:null}get maxPageSize(){const{query:e}=this._serviceInfo.capabilities;var t,r;return(null!==(t=e.maxRecordCount)&&void 0!==t?t:8e3)*(null!==(r=this.maxRecordCountFactor)&&void 0!==r?r:1)}get pageSize(){return Math.min(8e3,this.maxPageSize)}enableEvent(e,t){}subscribe(e,t){super.subscribe(e,t),this._fetchDataTile(e).catch((t=>{(0,u.isAbortError)(t)||o.default.getLogger("esri.views.2d.layers.features.sources.BaseFeatureSource").error(new(0,i.default)("mapview-query-error","Encountered error when fetching tile",{tile:e,error:t}))}))}unsubscribe(e){super.unsubscribe(e)}readers(e){return this._subscriptions.get(e).readers()}async query(e,t={}){var r,s;const n=null!==(s=t.query)&&void 0!==s?s:{};return this._adapter.executeQuery(e,{...t,query:{...n,...null===(r=this._schema)||void 0===r?void 0:r.customParameters}})}async queryLastEditDate(){const e=this._serviceInfo.source,t={...e.query,f:"json"};return(await(0,n.default)(e.path,{query:t,responseType:"json"})).data.editingInfo.lastEditDate}createTileQuery(e,t={}){const r=this._serviceInfo.geometryType,s=this.createQuery(t);var n;s.quantizationParameters=null!==(n=t.quantizationParameters)&&void 0!==n?n:e.getQuantizationParameters(),s.resultType="tile",s.geometry=e.extent,this._serviceInfo.capabilities.query.supportsQuantization?"esriGeometryPolyline"===r&&(s.maxAllowableOffset=e.resolution*(0,a.default)("feature-polyline-generalization-factor")):"esriGeometryPolyline"!==r&&"esriGeometryPolygon"!==r||(s.maxAllowableOffset=e.resolution,"esriGeometryPolyline"===r&&(s.maxAllowableOffset*=(0,a.default)("feature-polyline-generalization-factor")));const i=this._serviceInfo.capabilities.query;return s.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference,s.compactGeometryEnabled=i.supportsCompactGeometry,s}async _executePatchQuery(e,t,r,s){const n=t.clone();n.outFields=[this._serviceInfo.objectIdField,...r],n.returnCentroid=!1,n.returnGeometry=!1;const i=null!=n.start?n.start/8e3:0,a=s.signal;return await this.enqueuePatchQuery({tile:e,query:n,signal:a,depth:i})}async _resend(e,t){const{query:r,message:s}=e,n=null!=r.outFields?r.outFields:[],i=this._queryInfo.outFields,a=i.filter((e=>!n.includes(e)));if(null!=s.addOrUpdate)if(a.length)try{const e=this._subscriptions.get(s.id).tile,n=await this._executePatchQuery(e,r,a,t);(0,u.throwIfAborted)(t),r.outFields=i,s.addOrUpdate.joinAttributes(n),this._onMessage({...s,end:s.end,type:"append"})}catch(e){}else this._onMessage({...s,type:"append"});else this._onMessage({...s,type:"append"})}async _resendSubscription(e){if((0,a.default)("esri-2d-update-debug")&&console.debug(e.tile.id,"Resend Subscription"),e.empty)return this._onMessage({id:e.tile.id,addOrUpdate:null,end:!1,type:"append"});const t=e.signal;for(const r of e.requests.done)await this._resend(r,{signal:t});return null!=e.edits?this._onMessage(e.edits):void 0}async resend(){const e=Array.from(this._subscriptions.values());await Promise.all(e.map((e=>this._resendSubscription(e))))}constructor(e){super(e),this.type="feature",this.mode="on-demand",this._adapter=(0,l.createSourceAdapter)(e.serviceInfo),this._queue=new(0,d.QueueProcessor)({concurrency:8,process:async e=>{var t;if((0,u.throwIfAborted)(e),null!=e.tile){var r;const t=e.tile.key.id,{signal:s}=e,n=(0,a.default)("esri-tiles-debug")?{tile:t.replaceAll("/","."),depth:e.depth}:void 0,i=await this._adapter.executeQuery(e.query,{signal:s,query:{...n,...null===(r=this._schema)||void 0===r?void 0:r.customParameters}});return i.level=e.tile.key.level,i}return this._adapter.executeQuery(e.query,{...e,query:null===(t=this._schema)||void 0===t?void 0:t.customParameters})}}),this._patchQueue=new(0,d.QueueProcessor)({concurrency:8,process:async e=>{var t;if((0,u.throwIfAborted)(e),null!=e.tile){var r;const t=e.tile.key.id,{signal:s}=e,n=(0,a.default)("esri-tiles-debug")?{tile:t.replaceAll("/","."),depth:e.depth}:void 0,i=await this._adapter.executeQuery(e.query,{signal:s,query:{...n,...null===(r=this._schema)||void 0===r?void 0:r.customParameters}});return i.level=e.tile.key.level,i}return this._adapter.executeQuery(e.query,{...e,query:null===(t=this._schema)||void 0===t?void 0:t.customParameters})}})}}})),t.register("cCtf4",(function(r,s){e(r.exports,"createSourceAdapter",(function(){return f}));var n=t("2VlWd"),i=t("hl4M0"),a=t("ibKgR"),o=t("akQYU"),u=t("1xeva"),l=t("j6c7r"),c=t("5STKO"),d=t("lkLpJ");class h{destroy(){}constructor(e){this.service=e}}function f(e){const{capabilities:t}=e;return function(e){return"ogc-source"===(null==e?void 0:e.type)}(e.source)?new y(e):function(e){return Array.isArray(e.source)}(e)?new p(e):t.query.supportsFormatPBF&&(0,n.default)("featurelayer-pbf")?new g(e):new m(e)}class p extends h{destroy(){this.client.close(),this.client=null}async executeQuery(e,t){await this._portsOpen;const r=await this.client.invoke("queryFeatures",e.toJSON(),t);return c.FeatureSetReaderJSON.fromFeatureSet(r,this.service)}constructor(e){super(e),this._portsOpen=async function(e){const t=new(0,i.default);return await t.open(e,{}),t}(e.source).then((e=>this.client=e))}}class g extends h{async executeQuery(e,t){const{data:r}=await(0,l.executeQueryPBFBuffer)(this.service.source,e,t),s=!e.quantizationParameters;return d.FeatureSetReaderPBF.fromBuffer(r,this.service,s)}}class m extends h{async executeQuery(e,t){var r;const{source:s,capabilities:n,spatialReference:i,objectIdField:u,geometryType:d}=this.service;if(null!=e.quantizationParameters&&!n.query.supportsQuantization){const r=e.clone(),n=(0,a.toQuantizationTransform)(r.quantizationParameters);r.quantizationParameters=null;const{data:d}=await(0,l.executeQuery)(s,r,i,t),h=(0,o.convertFromFeatureSet)(d,u);return(0,o.quantizeOptimizedFeatureSet)(n,h),c.FeatureSetReaderJSON.fromOptimizedFeatureSet(h,this.service)}const{data:h}=await(0,l.executeQuery)(s,e,this.service.spatialReference,t);return"esriGeometryPoint"===d&&(h.features=null===(r=h.features)||void 0===r?void 0:r.filter((e=>{if(null!=e.geometry){const t=e.geometry;return Number.isFinite(t.x)&&Number.isFinite(t.y)}return!0}))),c.FeatureSetReaderJSON.fromFeatureSet(h,this.service)}}class y extends h{async executeQuery(e,t){const{capabilities:r}=this.service;if(e.quantizationParameters&&!r.query.supportsQuantization){const r=e.clone(),s=(0,a.toQuantizationTransform)(r.quantizationParameters);r.quantizationParameters=null;const n=await(0,u.queryOptimizedFeatureSet)(this.service.source,e,t);return(0,o.quantizeOptimizedFeatureSet)(s,n),c.FeatureSetReaderJSON.fromOptimizedFeatureSet(n,this.service)}const s=await(0,u.queryOptimizedFeatureSet)(this.service.source,e,t);return c.FeatureSetReaderJSON.fromOptimizedFeatureSet(s,this.service)}}})),t.register("ibKgR",(function(r,s){e(r.exports,"toQuantizationTransform",(function(){return u})),e(r.exports,"quantizePoint",(function(){return y})),e(r.exports,"quantizeGeometry",(function(){return I})),e(r.exports,"unquantizeMultipoint",(function(){return S})),e(r.exports,"unquantizePoint",(function(){return x})),e(r.exports,"unquantizePolygon",(function(){return b})),e(r.exports,"unquantizePolyline",(function(){return T}));var n=t("79LpT");const i=(e,t,r)=>[t,r],a=(e,t,r)=>[t,r,e[2]],o=(e,t,r)=>[t,r,e[2],e[3]];function u(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function l({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function c({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function d(e,t,r){const s=[];let n,i,a,o;for(let u=0;u<r.length;u++){const d=r[u];u>0?(a=l(e,d[0]),o=c(e,d[1]),a===n&&o===i||(s.push(t(d,a-n,o-i)),n=a,i=o)):(n=l(e,d[0]),i=c(e,d[1]),s.push(t(d,n,i)))}return s.length>0?s:null}function h({scale:e,translate:t},r){return r*e[0]+t[0]}function f({scale:e,translate:t},r){return t[1]-r*e[1]}function p(e,t,r){const s=new Array(r.length);if(!r.length)return s;const[n,i]=e.scale;let a=h(e,r[0][0]),o=f(e,r[0][1]);s[0]=t(r[0],a,o);for(let e=1;e<r.length;e++){const u=r[e];a+=u[0]*n,o-=u[1]*i,s[e]=t(u,a,o)}return s}function g(e,t,r){const s=new Array(r.length);for(let n=0;n<r.length;n++)s[n]=p(e,t,r[n]);return s}function m(e,t,r,s,n){var u;return t.points=null!==(u=function(e,t,r,s){return d(e,r?s?o:a:s?a:i,t)}(e,r.points,s,n))&&void 0!==u?u:[],t}function y(e,t,r,s,n){return t.x=l(e,r.x),t.y=c(e,r.y),t!==r&&(s&&(t.z=r.z),n&&(t.m=r.m)),t}function _(e,t,r,s,n){const u=function(e,t,r,s){const n=[],u=r?s?o:a:s?a:i;for(let r=0;r<t.length;r++){const s=d(e,u,t[r]);s&&s.length>=3&&n.push(s)}return n.length?n:null}(e,r.rings,s,n);return u?(t.rings=u,t):null}function v(e,t,r,s,n){const u=function(e,t,r,s){const n=[],u=r?s?o:a:s?a:i;for(let r=0;r<t.length;r++){const s=d(e,u,t[r]);s&&s.length>=2&&n.push(s)}return n.length?n:null}(e,r.paths,s,n);return u?(t.paths=u,t):null}function I(e,t){return e&&t?(0,n.isPoint)(t)?y(e,{},t,!1,!1):(0,n.isPolyline)(t)?v(e,{},t,!1,!1):(0,n.isPolygon)(t)?_(e,{},t,!1,!1):(0,n.isMultipoint)(t)?m(e,{},t,!1,!1):(0,n.isExtent)(t)?(a=!1,o=!1,(s={}).xmin=l(r=e,(i=t).xmin),s.ymin=c(r,i.ymin),s.xmax=l(r,i.xmax),s.ymax=c(r,i.ymax),s!==i&&(a&&(s.zmin=i.zmin,s.zmax=i.zmax),o&&(s.mmin=i.mmin,s.mmax=i.mmax)),s):null:null;var r,s,i,a,o}function S(e,t,r,s,n){return null!=r&&(t.points=function(e,t,r,s){return p(e,r?s?o:a:s?a:i,t)}(e,r.points,s,n)),t}function x(e,t,r,s,n){return null==r||(t.x=h(e,r.x),t.y=f(e,r.y),t!==r&&(s&&(t.z=r.z),n&&(t.m=r.m))),t}function b(e,t,r,s,n){return null!=r&&(t.rings=function(e,t,r,s){return g(e,r?s?o:a:s?a:i,t)}(e,r.rings,s,n)),t}function T(e,t,r,s,n){return null!=r&&(t.paths=function(e,t,r,s){return g(e,r?s?o:a:s?a:i,t)}(e,r.paths,s,n)),t}})),t.register("1xeva",(function(r,s){e(r.exports,"crsPrefix",(function(){return y})),e(r.exports,"crsDefault",(function(){return _})),e(r.exports,"getCollectionDefinition",(function(){return v})),e(r.exports,"getServerCollections",(function(){return I})),e(r.exports,"getServerConformance",(function(){return S})),e(r.exports,"getServerLandingPage",(function(){return x})),e(r.exports,"getServerOpenApi",(function(){return b})),e(r.exports,"getSpatialReferenceWkid",(function(){return T})),e(r.exports,"queryFeatureSetJSON",(function(){return w})),e(r.exports,"queryOptimizedFeatureSet",(function(){return F})),t("2ILM8");var n=t("9pNSx"),i=t("kyj08"),a=t("jHOLN"),o=t("eY5Yp"),u=t("eF88h"),l=t("akQYU"),c=t("awJRz"),d=t("4shxe"),h=t("dxhdj"),f=t("4nMX7"),p=t("82Efb"),g=t("j40xv");const m=a.default.getLogger("esri.layers.graphics.sources.ogcfeature"),y="http://www.opengis.net/def/crs/",_=`${y}OGC/1.3/CRS84`;async function v(e,t,r={},s=5){const{links:a}=e,o=C(a,"items","application/geo+json")||C(a,"http://www.opengis.net/def/rel/ogc/1.0/items","application/geo+json");if(null==o)throw new(0,i.default)("ogc-feature-layer:missing-items-page","Missing items url");const{data:u}=await(0,n.default)(o.href,{signal:r.signal,query:{limit:s,...r.customParameters,token:r.apiKey},headers:{accept:"application/geo+json"}});await(0,d.validateGeoJSON)(u);const l=(0,d.inferLayerProperties)(u,{geometryType:t.geometryType}),c=t.fields||l.fields||[],g=null!=t.hasZ?t.hasZ:l.hasZ,y=l.geometryType,_=t.objectIdField||l.objectIdFieldName||"OBJECTID";let v=t.timeInfo;const I=c.find((({name:e})=>e===_));if(I)I.editable=!1,I.nullable=!1;else{if(!l.objectIdFieldType)throw new(0,i.default)("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");c.unshift({name:_,alias:_,type:"number"===l.objectIdFieldType?"esriFieldTypeOID":"esriFieldTypeString",editable:!1,nullable:!1})}if(_!==l.objectIdFieldName){const e=c.find((({name:e})=>e===l.objectIdFieldName));e&&(e.type="esriFieldTypeInteger")}c===l.fields&&l.unknownFields.length>0&&m.warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:l.unknownFields}});for(const e of c){if(null==e.name&&(e.name=e.alias),null==e.alias&&(e.alias=e.name),"esriFieldTypeOID"!==e.type&&"esriFieldTypeGlobalID"!==e.type&&(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable),!e.name)throw new(0,i.default)("ogc-feature-layer:invalid-field-name","field name is missing",{field:e});if(!p.kebabDict.jsonValues.includes(e.type))throw new(0,i.default)("ogc-feature-layer:invalid-field-type",`invalid type for field "${e.name}"`,{field:e})}if(v){const e=new(0,f.default)(c);if(v.startTimeField){const t=e.get(v.startTimeField);t?(v.startTimeField=t.name,t.type="esriFieldTypeDate"):v.startTimeField=null}if(v.endTimeField){const t=e.get(v.endTimeField);t?(v.endTimeField=t.name,t.type="esriFieldTypeDate"):v.endTimeField=null}if(v.trackIdField){const t=e.get(v.trackIdField);t?v.trackIdField=t.name:(v.trackIdField=null,m.warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:v}}))}v.startTimeField||v.endTimeField||(m.warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:v}}),v=null)}return{drawingInfo:y?(0,h.createDrawingInfo)(y):null,extent:M(e),geometryType:y,fields:c,hasZ:!!g,objectIdField:_,timeInfo:v}}async function I(e,t={}){const{links:r}=e,s=C(r,"data","application/json")||C(r,"http://www.opengis.net/def/rel/ogc/1.0/data","application/json");if(null==s)throw new(0,i.default)("ogc-feature-layer:missing-collections-page","Missing collections url");const{apiKey:a,customParameters:o,signal:u}=t,{data:l}=await(0,n.default)(s.href,{signal:u,headers:{accept:"application/json"},query:{...o,token:a}});return l}async function S(e,t={}){const{links:r}=e,s=C(r,"conformance","application/json")||C(r,"http://www.opengis.net/def/rel/ogc/1.0/conformance","application/json");if(null==s)throw new(0,i.default)("ogc-feature-layer:missing-conformance-page","Missing conformance url");const{apiKey:a,customParameters:o,signal:u}=t,{data:l}=await(0,n.default)(s.href,{signal:u,headers:{accept:"application/json"},query:{...o,token:a}});return l}async function x(e,t={}){const{apiKey:r,customParameters:s,signal:i}=t,{data:a}=await(0,n.default)(e,{signal:i,headers:{accept:"application/json"},query:{...s,token:r}});return a}async function b(e,t={}){const r="application/vnd.oai.openapi+json;version=3.0",s=C(e.links,"service-desc",r);if(null==s)return m.warn("ogc-feature-layer:missing-openapi-page","The OGC API-Features server does not have an OpenAPI page."),null;const{apiKey:i,customParameters:a,signal:o}=t,{data:u}=await(0,n.default)(s.href,{signal:o,headers:{accept:r},query:{...a,token:i}});return u}function T(e){const t=/^http:\/\/www\.opengis.net\/def\/crs\/(?<authority>.*)\/(?<version>.*)\/(?<code>.*)$/i.exec(e),r=null==t?void 0:t.groups;if(!r)return null;const{authority:s,code:n}=r;switch(s.toLowerCase()){case"ogc":switch(n.toLowerCase()){case"crs27":return g.default.GCS_NAD_1927.wkid;case"crs83":return 4269;case"crs84":case"crs84h":return g.default.WGS84.wkid;default:return null}case"esri":case"epsg":{const e=Number.parseInt(n,10);return Number.isNaN(e)?null:e}default:return null}}async function w(e,t,r){const s=await F(e,t,r);return(0,l.convertToFeatureSet)(s)}async function F(e,t,r){const{collection:s,layerDefinition:a,maxRecordCount:h,queryParameters:{apiKey:f,customParameters:p},spatialReference:m,supportedCrs:y}=e,{links:_}=s,v=C(_,"items","application/geo+json")||C(_,"http://www.opengis.net/def/rel/ogc/1.0/items","application/geo+json");if(null==v)throw new(0,i.default)("ogc-feature-layer:missing-items-page","Missing items url");const{geometry:I,num:S,start:x,timeExtent:b,where:T}=t;if(t.objectIds)throw new(0,i.default)("ogc-feature-layer:query-by-objectids-not-supported","Queries with objectids are not supported");var w;const F=g.default.fromJSON(m),M=null!==(w=t.outSpatialReference)&&void 0!==w?w:F,R=M.isWGS84?null:E(M,y),O=function(e,t){if(!function(e){return null!=e&&"extent"===e.type}(e))return null;const{spatialReference:r}=e;if(!r||r.isWGS84)return{bbox:A(e)};const s=E(r,t);return null!=s?{bbox:A(e),"bbox-crs":s}:r.isWebMercator?{bbox:A((0,u.project)(e,g.default.WGS84))}:null}(I,y),L=function(e){if(null==e)return null;const{start:t,end:r}=e;return`${null!=t?t.toISOString():".."}/${null!=r?r.toISOString():".."}`}(b),N=null!=(P=T)&&P&&"1=1"!==P?P:null,D=null!=S?S:null!=x&&void 0!==x?10:h,{data:k}=await(0,n.default)(v.href,{...r,query:{...p,...O,crs:R,datetime:L,query:N,limit:D,startindex:x,token:f},headers:{accept:"application/geo+json"}});var P;let G=!1;if(k.links){const e=k.links.find((e=>"next"===e.rel));G=!!e}!G&&Number.isInteger(k.numberMatched)&&Number.isInteger(k.numberReturned)&&(G=k.numberReturned<k.numberMatched);const{fields:U,geometryType:z,hasZ:q,objectIdField:V}=a,j=(0,d.createOptimizedFeatures)(k,{geometryType:z,hasZ:q,objectIdField:V});if(!R&&M.isWebMercator)for(const e of j)if(null!=e.geometry&&null!=z){const t=(0,l.convertToGeometry)(e.geometry,z,q,!1);t.spatialReference=g.default.WGS84,e.geometry=(0,l.convertFromGeometry)((0,u.project)(t,M))}for(const e of j)e.objectId=e.attributes[V];const B=R||!R&&M.isWebMercator?M.toJSON():o.WGS84,Q=new(0,c.default);return Q.exceededTransferLimit=G,Q.features=j,Q.fields=U,Q.geometryType=z,Q.hasZ=q,Q.objectIdFieldName=V,Q.spatialReference=B,Q}function E(e,t){const{isWebMercator:r,wkid:s}=e;if(!s)return null;var n,i,a;const o=r?null!==(a=null!==(i=null!==(n=t[3857])&&void 0!==n?n:t[102100])&&void 0!==i?i:t[102113])&&void 0!==a?a:t[900913]:t[e.wkid];return o?`${y}${o}`:null}function A(e){if(null==e)return"";const{xmin:t,ymin:r,xmax:s,ymax:n}=e;return`${t},${r},${s},${n}`}function M(e){var t;const r=null===(t=e.extent)||void 0===t?void 0:t.spatial;if(!r)return null;const s=r.bbox[0],n=4===s.length,i=s[0],a=s[1],o=n?void 0:s[2];return{xmin:i,ymin:a,xmax:n?s[2]:s[3],ymax:n?s[3]:s[4],zmin:o,zmax:n?void 0:s[5],spatialReference:g.default.WGS84.toJSON()}}function C(e,t,r){return e.find((e=>e.rel===t&&e.type===r))||e.find((e=>e.rel===t&&!e.type))}})),t.register("4shxe",(function(r,s){e(r.exports,"getGeometryType",(function(){return l})),e(r.exports,"validateGeoJSON",(function(){return x})),e(r.exports,"inferLayerProperties",(function(){return b})),e(r.exports,"createOptimizedFeatures",(function(){return T}));var n=t("kyj08"),i=t("ft2bT"),a=t("awxBI"),o=t("7vTUY");const u={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function l(e){return u[e]}function*c(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*d(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function h(e){for(const t of e)if(t.length>2)return!0;return!1}function f(e){let t=0;for(let r=0;r<e.length;r++){const s=e[r],n=e[(r+1)%e.length];t+=s[0]*n[1]-n[0]*s[1]}return t<=0}function p(e){const t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function g(e,t,r){switch(t.type){case"LineString":case"MultiPoint":return function(e,t,r){return _(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){for(const s of t.coordinates)_(e,s,r);return e}(e,t,r);case"MultiPolygon":return function(e,t,r){for(const s of t.coordinates){m(e,s[0],r);for(let t=1;t<s.length;t++)y(e,s[t],r)}return e}(e,t,r);case"Point":return function(e,t,r){return I(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){const s=t.coordinates;m(e,s[0],r);for(let t=1;t<s.length;t++)y(e,s[t],r);return e}(e,t,r)}}function m(e,t,r){const s=p(t);!function(e){return!f(e)}(s)?_(e,s,r):v(e,s,r)}function y(e,t,r){const s=p(t);!function(e){return f(e)}(s)?_(e,s,r):v(e,s,r)}function _(e,t,r){for(const s of t)I(e,s,r);e.lengths.push(t.length)}function v(e,t,r){for(let s=t.length-1;s>=0;s--)I(e,t[s],r);e.lengths.push(t.length)}function I(e,t,r){const[s,n,i]=t;e.coords.push(s,n),r.hasZ&&e.coords.push(i||0)}function S(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function x(e){if(!e)throw new(0,n.default)("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new(0,n.default)("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:t}=e;if(!t)return;const r="string"==typeof t?t:"name"===t.type?t.properties.name:"EPSG"===t.type?t.properties.code:null,s=new RegExp(".*(CRS84H?|4326)$","i");if(!r||!s.test(r))throw new(0,n.default)("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function b(e,t={}){const r=[],s=new Set,n=new Set;let i,a=!1,u=null,f=!1,{geometryType:p=null}=t,g=!1;for(const t of c(e)){const{geometry:e,properties:c,id:m}=t;if((!e||(p||(p=l(e.type)),l(e.type)===p))&&(a||(a=h(d(e))),f||(f=null!=m,f&&(i=typeof m,c&&(u=Object.keys(c).filter((e=>c[e]===m))))),c&&u&&f&&null!=m&&(u.length>1?u=u.filter((e=>c[e]===m)):1===u.length&&(u=c[u[0]]===m?u:[])),!g&&c)){let e=!0;for(const t in c){if(s.has(t))continue;const i=c[t];if(null==i){e=!1,n.add(t);continue}const a=S(i);if("unknown"===a){n.add(t);continue}n.delete(t),s.add(t);const u=(0,o.normalizeFieldName)(t);u&&r.push({name:u,alias:t,type:a})}g=e}}var m;const y=null!==(m=(0,o.normalizeFieldName)(1===(null==u?void 0:u.length)&&u[0]||null))&&void 0!==m?m:void 0;if(y)for(const e of r)if(e.name===y&&(0,o.isNumericField)(e)){e.type="esriFieldTypeOID";break}return{fields:r,geometryType:p,hasZ:a,objectIdFieldName:y,objectIdFieldType:i,unknownFields:Array.from(n)}}function T(e,t){return Array.from(function*(e,t={}){const{geometryType:r,objectIdField:s}=t;for(const n of e){const{geometry:e,properties:o,id:u}=n;if(e&&l(e.type)!==r)continue;const c=o||{};let d;s&&(d=c[s],null==u||d||(c[s]=d=u));const h=new(0,i.OptimizedFeature)(e?g(new(0,a.default),e,t):null,c,null,null!=d?d:void 0);yield h}}(c(e),t))}})),t.register("dxhdj",(function(r,s){e(r.exports,"createDrawingInfo",(function(){return u})),e(r.exports,"createDefaultAttributesFunction",(function(){return d})),e(r.exports,"createDefaultTemplate",(function(){return h})),e(r.exports,"createCapabilities",(function(){return f}));var n=t("2VlWd"),i=t("flPLJ"),a=t("aNMpQ"),o=t("2iY9n");function u(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?o.defaultPointSymbolJSON:"esriGeometryPolyline"===e?o.defaultPolylineSymbolJSON:o.defaultPolygonSymbolJSON}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let c=1;function d(e,t){if((0,n.default)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this.${t} = null;`;for(const t in e)r+=`this${l.test(t)?`.${t}`:`["${t}"]`} = ${JSON.stringify(e[t])};`;const s=new Function(`\n      return class AttributesClass$${c++} {\n        constructor() {\n          ${r};\n        }\n      }\n    `)();return()=>new s}catch(r){return()=>({[t]:null,...e})}}function h(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,i.clone)(e)}}]}function f(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:a.queryCapabilities,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1}}}})),t.register("aNMpQ",(function(t,r){e(t.exports,"queryCapabilities",(function(){return s}));const s={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}})),t.register("lkLpJ",(function(r,s){e(r.exports,"FeatureSetReaderPBF",(function(){return I}));var n=t("kyj08"),i=t("jHOLN"),a=t("7qybv"),o=t("acan7"),u=t("akQYU"),l=t("ft2bT"),c=t("awxBI"),d=t("jBcNl"),h=t("6g9gs");const f=268435455,p=128e3,g={small:{delta:new Int32Array(128),decoded:new Int32Array(128)},large:{delta:new Int32Array(p),decoded:new Int32Array(p)}};function m(e){return e<=g.small.delta.length?g.small:(e<=g.large.delta.length||(g.large.delta=new Int32Array(Math.round(1.25*e)),g.large.decoded=new Int32Array(Math.round(1.25*e))),g.large)}function y(e){for(;e.next();){if(1===e.tag())return e.getMessage();e.skip()}return null}function _(e,t,r,s,n,i){return.5*Math.abs(e*s+r*i+n*t-e*i-r*t-n*s)}function v(e,t,r,s){return 0==e*s-r*t&&e*r+t*s>0}class I extends d.FeatureSetReader{static fromBuffer(e,t,r=!1){const s=t.geometryType,a=function(e){try{const t=2,r=new(0,o.default)(new Uint8Array(e),new DataView(e));for(;r.next();){if(r.tag()===t)return y(r.getMessage());r.skip()}}catch(e){const t=new(0,n.default)("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});i.default.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF").error(t)}return null}(e),u=(0,h.parseHeader)(a,"esriGeometryPoint"===s,r),l=d.FeatureSetReader.createInstance();return new I(l,a,u,t)}get fields(){return this._header.fields}get geometryType(){return this._geometryType}get _size(){return this._header.featureCount}get hasZ(){return!1}get hasM(){return!1}get stride(){return 2+(this.hasZ?1:0)+(this.hasM?1:0)}get hasFeatures(){return this._header.hasFeatures}get hasNext(){return this._hasNext}get exceededTransferLimit(){return this._header.exceededTransferLimit}getSize(){return this._size}getQuantizationTransform(){return this._header.transform}getCursor(){return this.copy()}getIndex(){return this._featureIndex}setIndex(e){this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0,this._featureIndex=e}getAttributeHash(){let e="";for(const t of this._header.fields.fields)e+=this._readAttributeAtIndex(t.index)+".";return e}getObjectId(){return this._readAttributeAtIndex(this._header.objectIdFieldIndex)}getDisplayId(){return this._header.displayIds[this._featureIndex]}setDisplayId(e){this._header.displayIds[this._featureIndex]=e}getGroupId(){return this._header.groupIds[this._featureIndex]}setGroupId(e){this._header.groupIds[this._featureIndex]=e}readLegacyFeature(){if(void 0===this._cache.legacyFeature){var e;const t=this.readCentroid(),r={attributes:this.readAttributes(),geometry:this._isPoints?this.readLegacyPointGeometry():this.readLegacyGeometry(),centroid:null!==(e=t&&{x:t.coords[0],y:t.coords[1]})&&void 0!==e?e:null};return this._cache.legacyFeature=r,r}return this._cache.legacyFeature}readOptimizedFeature(){if(void 0===this._cache.optFeature){const e=new(0,l.OptimizedFeature)(this.readGeometry(),this.readAttributes(),this.readCentroid());return e.objectId=this.getObjectId(),e.displayId=this.getDisplayId(),this._cache.optFeature=e,e}return this._cache.optFeature}getXHydrated(){const e=this._header.centroid[2*this._featureIndex],t=this.getQuantizationTransform();return null==t?e:e*t.scale[0]+t.translate[0]}getYHydrated(){const e=this._header.centroid[2*this._featureIndex+1],t=this.getQuantizationTransform();return null==t?e:t.translate[1]-e*t.scale[1]}getX(){return this._header.centroid[2*this._featureIndex]*this._sx+this._tx}getY(){return this._header.centroid[2*this._featureIndex+1]*this._sy+this._ty}readLegacyPointGeometry(){return{x:this.getX(),y:this.getY()}}readLegacyGeometry(e){const t=this.readUnquantizedGeometry(e);return(0,u.convertToGeometry)(t,this.geometryType,!1,!1)}readLegacyCentroid(){const e=this.readCentroid();if(!e)return null;const[t,r]=e.coords;return{x:t,y:r}}readGeometryArea(){return this._cache.area||this.readGeometry(!0),this._cache.area}readUnquantizedGeometry(e=!1){if(void 0===this._cache.unquantGeometry){const t=this.readGeometry(e);if(!t)return this._cache.unquantGeometry=void 0,null;const r=m(t.coords.length).decoded,s=t.clone(r),n=s.coords;let i=0;for(const e of s.lengths){for(let t=1;t<e;t++){const e=2*(i+t),r=2*(i+t-1);n[e]+=n[r],n[e+1]+=n[r+1]}i+=e}return this._cache.unquantGeometry=s,s}return this._cache.unquantGeometry}readHydratedGeometry(){if(this._isPoints){if(this._header.centroid[2*this._featureIndex]===f)return null;const e=this.getXHydrated(),t=this.getYHydrated();return new(0,c.default)([],[e,t])}const e=this.readGeometry();if(!e)return null;const t=e.clone(),r=this.getQuantizationTransform();return null!=r&&(0,u.unquantizeOptimizedGeometry)(t,t,this.hasZ,this.hasM,r),t}readGeometry(e=!1){if(void 0===this._cache.geometry){let t=null;if(this._isPoints){if(this._header.centroid[2*this._featureIndex]===f)return null;const e=this.getX(),r=this.getY();t=new(0,c.default)([],[e,r])}else{const r=this._header.offsets.geometry[this._featureIndex],s=this._reader;if(0===r){const e=this._readServerCentroid();if(!e)return null;const[t,r]=e.coords;return this.createQuantizedExtrudedQuad(t,r)}s.move(r);try{if(t=e?this._parseGeometryForDisplay(s):this._parseGeometry(s),null===t){const e=this._readServerCentroid();if(!e)return null;const[t,r]=e.coords;return this.createQuantizedExtrudedQuad(t,r)}}catch(e){return console.error("Failed to parse geometry!",e),null}}return this._cache.geometry=t,t}return this._cache.geometry}readCentroid(){if(void 0===this._cache.centroid){let e;return e=this._computeCentroid(),e||(e=this._readServerCentroid()),this._cache.centroid=null!=e?e:void 0,null!=e?e:null}return this._cache.centroid}copy(){const e=this._reader.clone(),t=new I(this.instance,e,this._header,this.fullSchema());return this.copyInto(t),t}next(){for(this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._cache.centroid=void 0,this._cache.legacyFeature=void 0,this._cache.optFeature=void 0;++this._featureIndex<this._size&&!this._getExists(););return this._featureIndex<this._size}_readAttribute(e,t){var r;const s=this._header.fields.get(e);if(null==s)return;let n=this._readAttributeAtIndex(s.index);"esriFieldTypeTimestampOffset"===(null===(r=this.fields.get(e))||void 0===r?void 0:r.type)&&(n=this.parseTimestampOffset(n));const i=this._header.fields.isDateField(s.name);return t?null==n?n:i?new Date(n):n:n}_readAttributes(){const e={};for(const t of this._header.fields.fields)e[t.name]=this._readAttributeAtIndex(t.index);return e}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._featureOffset=this._featureOffset,e._hasNext=this._hasNext}_readAttributeAtIndex(e){const t=this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+e],r=this._reader;return r.move(t),function(e){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}(r)}_readServerCentroid(){const e=this._header.centroid[2*this._featureIndex]+this._tx,t=this._header.centroid[2*this._featureIndex+1]+this._ty;return e===f?null:new(0,c.default)([],[e,t])}_parseGeometry(e){const t=e.asUnsafe(),r=t.getLength(),s=t.pos()+r,n=[],i=[];for(;t.pos()<s&&t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),r=t.pos()+e;for(;t.pos()<r;)i.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),r=t.pos()+e;for(n.push(t.getSInt32()+this._tx),n.push(t.getSInt32()+this._ty),this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();t.pos()<r;)n.push(t.getSInt32()),n.push(t.getSInt32()),this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();break}default:t.skip()}return new(0,c.default)(i,n)}_parseGeometryForDisplay(e){const t=e.asUnsafe(),r=t.getLength(),s=t.pos()+r,n=[],i=[];let o=0,u=0,l=null,d=0;const h="esriGeometryPolygon"===this.geometryType;for(;t.pos()<s&&t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),r=t.pos()+e;for(;t.pos()<r;){const e=t.getUInt32();n.push(e),o+=e}l=m(2*o).delta;break}case 3:{t.getUInt32();const e=2+(this.hasZ?1:0)+(this.hasM?1:0);(0,a.assertIsSome)(l);for(const r of n)if(u+e*r>l.length)for(let e=0;e<r;e++)t.getSInt32(),t.getSInt32(),this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();else if(h){const e=this.getAreaSimplificationThreshold(r,this._header.vertexCount);let s=2,n=1;const a=!1;let o=t.getSInt32(),c=t.getSInt32();l[u++]=o,l[u++]=c,this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();let h=t.getSInt32(),f=t.getSInt32();for(this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();s<r;){let r=t.getSInt32(),i=t.getSInt32();this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32();const a=o+h,p=c+f;_(o,c,a,p,a+r,p+i)>=e?(d+=-.5*(a-o)*(p+c),n>1&&v(l[u-2],l[u-1],h,f)?(l[u-2]+=h,l[u-1]+=f):(l[u++]=h,l[u++]=f,n++),o=a,c=p):(r+=h,i+=f),h=r,f=i,s++}n<3||a?u-=2*n:(d+=-.5*(o+h-o)*(c+f+c),v(l[u-2],l[u-1],h,f)?(l[u-2]+=h,l[u-1]+=f,i.push(n)):(l[u++]=h,l[u++]=f,i.push(++n)))}else{let e=0,s=t.getSInt32(),n=t.getSInt32();this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32(),l[u++]=s,l[u++]=n,e+=1;for(let i=1;i<r;i++){const r=t.getSInt32(),a=t.getSInt32(),o=s+r,c=n+a;d+=-.5*(o-s)*(c+n),this.hasZ&&t.getSInt32(),this.hasM&&t.getSInt32(),i>2&&v(l[u-2],l[u-1],r,a)?(l[u-2]+=r,l[u-1]+=a):(l[u++]=r,l[u++]=a,e+=1),s=o,n=c}i.push(e)}break}default:t.skip()}if(this._cache.area=d,!i.length)return null;if(this._tx||this._ty){let e=0;(0,a.assertIsSome)(l);for(const t of i)l[2*e]+=this._tx,l[2*e+1]+=this._ty,e+=t}return new(0,c.default)(i,l)}constructor(e,t,r,s){super(e,s),this._hasNext=!1,this._isPoints=!1,this._featureIndex=-1,this._featureOffset=0,this._cache={area:0,unquantGeometry:void 0,geometry:void 0,centroid:void 0,legacyFeature:void 0,optFeature:void 0},this._geometryType=s.geometryType,this._reader=t,this._header=r,this._hasNext=r.hasFeatures,this._isPoints="esriGeometryPoint"===s.geometryType}}})),t.register("6g9gs",(function(r,s){e(r.exports,"parseHeader",(function(){return l}));var n=t("kyj08"),i=t("4nMX7"),a=t("gIye9");const o=268435455;class u{constructor(){this.hasFeatures=!1,this.exceededTransferLimit=!1,this.fieldCount=0,this.featureCount=0,this.objectIdFieldIndex=0,this.vertexCount=0,this.offsets={attributes:new Array,geometry:new Array},this.centroid=new Array}}function l(e,t,r=!1){var s;const l=e.asUnsafe(),c=l.pos(),d=new u;let h=0,f=0;let p=null,g=null,m=null,y=!1;const _=[];for(;l.next();)switch(l.tag()){case 1:p=l.getString();break;case 3:g=l.getString();break;case 12:m=l.processMessage(a.parseTransform);break;case 9:if(d.exceededTransferLimit=l.getBool(),d.exceededTransferLimit){d.offsets.geometry=r?new Float64Array(8e3):new Int32Array(8e3),d.centroid=r?new Float64Array(16e3):new Int32Array(16e3);for(let e=0;e<d.centroid.length;e++)d.centroid[e]=o}break;case 13:{const e=l.processMessage(a.parseField);e.index=h++,_.push(e);break}case 15:{const e=l.getLength(),s=l.pos()+e;if(!d.exceededTransferLimit){const e=d.offsets.geometry,t=d.centroid;e.push(0),t.push(o),t.push(o)}!y&&d.exceededTransferLimit&&(y=!0,d.offsets.attributes=r?new Float64Array(8e3*h):new Uint32Array(8e3*h));let n=f*h;for(;l.pos()<s&&l.next();)switch(l.tag()){case 1:{y?d.offsets.attributes[n++]=l.pos():d.offsets.attributes.push(l.pos());const e=l.getLength();l.skipLen(e);break}case 2:if(t){const e=l.getLength(),t=l.pos()+e;for(;l.pos()<t&&l.next();)switch(l.tag()){case 3:{l.getUInt32();const e=l.getSInt64(),t=l.getSInt64();d.centroid[2*f]=e,d.centroid[2*f+1]=t;break}default:l.skip()}}else{d.offsets.geometry[f]=l.pos();const e=l.getLength();d.vertexCount+=e,l.skipLen(e)}break;case 4:{const e=l.getLength(),t=l.pos()+e;for(;l.pos()<t&&l.next();)switch(l.tag()){case 3:{l.getUInt32();const e=l.getSInt64(),t=l.getSInt64();d.centroid[2*f]=e,d.centroid[2*f+1]=t;break}default:l.skip()}break}default:l.skip()}f++,d.hasFeatures=!0;break}default:l.skip()}const v=p||g;if(!v)throw new(0,n.default)("FeatureSet has no objectId or globalId field name");return d.fields=new(0,i.default)(_),d.featureCount=f,d.fieldCount=h,d.objectIdFieldIndex=null===(s=d.fields.get(v))||void 0===s?void 0:s.index,d.transform=m,d.displayIds=new Uint32Array(d.featureCount),d.groupIds=new Uint16Array(d.featureCount),l.move(c),d}})),t.register("23qU2",(function(r,s){e(r.exports,"DataTileSource",(function(){return f}));var n=t("9DeZf"),i=t("amfHf"),a=t("2VlWd"),o=t("10vEZ"),u=t("9doMy"),l=t("l1JJG"),c=t("cRlei"),d=t("4rMWh"),h=t("8LcfB");class f{destroy(){for(const e of this._subscriptions.values())e.abort();this.updatingHandles.destroy()}get subscriptions(){return this._subscriptions.values()}async _onMessage(e){const t=this._subscriptions.get(e.id);if(!t)return;var r,s;const n={...e,remove:null!==(r=e.remove)&&void 0!==r?r:[],status:null!==(s=e.status)&&void 0!==s?s:h.UpdateToken.empty()};return(0,o.ignoreAbortErrors)(this._onTileUpdateMessage(n,t.options))}update(e,t){var r;const s=t.fields.length;t.outFields=function(e,t){const r=new Set;return e&&e.forEach((e=>r.add(e))),t&&t.forEach((e=>r.add(e))),r.has("*")?["*"]:Array.from(r)}(null===(r=this._schema)||void 0===r?void 0:r.outFields,t.outFields),t.outFields=t.outFields.length>=.75*s?["*"]:t.outFields,t.outFields.sort();const i=(0,u.diff)(this._schema,t);if(!i)return;(0,a.default)("esri-2d-update-debug")&&console.debug("Applying Update - Source:",i);const o="orderByFields"in this._serviceInfo&&this._serviceInfo.orderByFields?this._serviceInfo.orderByFields:this._serviceInfo.objectIdField+" ASC",l={returnCentroid:"esriGeometryPolygon"===this._serviceInfo.geometryType,returnGeometry:!0,timeReferenceUnknownClient:"stream"!==this._serviceInfo.type&&this._serviceInfo.timeReferenceUnknownClient,outFields:t.outFields,outSpatialReference:this._outSR,orderByFields:[o],where:t.definitionExpression||"1=1",gdbVersion:t.gdbVersion,historicMoment:t.historicMoment,timeExtent:t.timeExtent?n.default.fromJSON(t.timeExtent):null},c=this._schema&&(0,u.hasDiff)(i,"outFields");this._schema&&(0,u.hasDiffAny)(i,["timeExtent","definitionExpression","gdbVersion","historicMoment","customParameters"])&&(e.why.mesh.push("Layer filter and/or custom parameters changed"),e.why.source.push("Layer filter and/or custom parameters changed"),e.mesh=!0,e.source=!0,e.queryFilter=!0),c&&(e.why.source.push("Layer required fields changed"),e.source=!0),(0,u.diff)(l,this._queryInfo)&&(this._queryInfo=l),this._schema=t,this._resolver.resolve()}whenInitialized(){return this._resolver.promise}async applyUpdate(e){if(e.queryFilter||e.source&&this._didEdit)return this.refresh(e.version),void(this._didEdit=!1);this._subscriptions.forEach((t=>t.applyUpdate(e))),await this.resend()}refresh(e,t){for(const t of this._tiles())this.unsubscribe(t),this.subscribe(t,e)}subscribe(e,t){const r=new(0,d.DataTileSubscription)(e,t);this._subscriptions.set(e.id,r),this.updatingHandles.addPromise(r.done)}unsubscribe(e){const t=this.getSubscription(e.id);null!=t&&t.abort(),this._subscriptions.delete(e.id)}createQuery(e={}){const t=this._queryInfo.historicMoment?new Date(this._queryInfo.historicMoment):null;return new(0,c.default)({...this._queryInfo,historicMoment:t,...e})}getSubscription(e){return this._subscriptions.has(e)?this._subscriptions.get(e):null}async queryLastEditDate(){throw new Error("Service does not support query type")}async query(e,t){throw new Error("Service does not support query")}*_tiles(){const e=Array.from(this._subscriptions.values());for(const t of e)yield t.tile}async edit(e,t){const r=Array.from(this._subscriptions.values()),s=r.map((({tile:e})=>e));for(const e of r)e.removeIds(t);if(e.length){const r=s.map((t=>{const r=this.createTileQuery(t);return r.objectIds=e,{tile:t,query:r}})).map((async({tile:e,query:t})=>({tile:e,result:await this.query(t,{query:{tile:(0,a.default)("esri-tiles-debug")?e.id.replaceAll("/","."):void 0}}),query:t}))),n=(await(0,o.eachAlwaysValues)(r)).map((async({tile:r,result:s})=>{if(!s.hasFeatures&&!t.length&&!e.length)return;const n=this._subscriptions.get(r.key.id);n&&n.edit(s,e)}));await(0,o.eachAlways)(n)}this._didEdit=!0}constructor(e){this.updatingHandles=new(0,l.WatchUpdatingTracking),this.events=new(0,i.default),this._resolver=(0,o.createResolver)(),this._didEdit=!1,this._subscriptions=new Map,this._outSR=e.outSR,this._serviceInfo=e.serviceInfo,this._onTileUpdateMessage=e.onMessage}}})),t.register("4rMWh",(function(r,s){e(r.exports,"DataTileSubscription",(function(){return c}));var n=t("lNwWH"),i=t("gDoEW"),a=t("2VlWd"),o=t("10vEZ"),u=t("5STKO"),l=t("8LcfB");class c{get signal(){return this._abortController.signal}get options(){return{signal:this._abortController.signal}}get empty(){return!this.requests.done.length&&null==this.edits}get edits(){return this._edits}get done(){return this._resolver.promise}get isDone(){return this._isDone}resolve(){this._isDone=!0,this._resolver.resolve()}clear(){this.requests.done=[]}applyUpdate(e){this.requests.done.forEach((t=>t.message.status.unset(e))),this._version=e.version,null!=this._edits&&this._edits.status.unset(e)}add(e){var t;e.message.status=null!==(t=e.message.status)&&void 0!==t?t:l.UpdateToken.empty(),e.message.status.version=this._version,(0,a.default)("esri-2d-update-debug")&&console.debug(this.tile.id,"DataTileSubscription:add",this._version),e.message.end&&(this.requests.done.forEach((e=>{null!=e.message&&e.message.end&&(e.message.end=!1)})),this._resolver.resolve(),this._isDone=!0),this.requests.done.push(e)}edit(e,t){const r=e.getQuantizationTransform(),s=e.fullSchema(),i=Array.from(e.features()).filter(n.isSome),a=[...t,...i.map((e=>e.objectId))];this.removeIds(a),this._invalidate(),null!=this._edits?(this.requests.done.forEach((e=>e.message.end=!1)),this._edits.addOrUpdate.append(e.features())):this._edits={type:"append",addOrUpdate:u.FeatureSetReaderJSON.fromOptimizedFeatures(i,s,r),id:this.tile.id,status:l.UpdateToken.empty(),end:!0}}*readers(){for(const{message:e}of this.requests.done)null!=e.addOrUpdate&&(yield e.addOrUpdate);null!=this._edits&&null!=this._edits.addOrUpdate&&(yield this._edits.addOrUpdate)}_invalidate(){for(const e of this.requests.done)e.message.status=l.UpdateToken.empty();null!=this._edits&&(this._edits.status=l.UpdateToken.empty())}removeIds(e){this._invalidate();for(const{message:t}of this.requests.done){const r=t.addOrUpdate;null!=r&&(r.removeIds(e),r.isEmpty&&((0,a.default)("esri-2d-update-debug")&&console.debug("Removing FeatureSetReader"),t.addOrUpdate=null))}null!=this._edits&&null!=this._edits.addOrUpdate&&this._edits.addOrUpdate.removeIds(e),this.requests.done=this.requests.done.filter((e=>e.message.addOrUpdate||e.message.end))}abort(){this._abortController.abort(),this._resolver.reject()}constructor(e,t){this.requests={done:new Array,stream:new(0,i.default)(10)},this._edits=null,this._abortController=new AbortController,this._version=0,this._resolver=(0,o.createResolver)(),this._isDone=!1,this.didSend=!1,this.tile=e,this._version=t}}})),t.register("8LcfB",(function(t,r){e(t.exports,"UpdateToken",(function(){return s}));class s{static create(e){const t=new s;let r;for(r in e){const s=e[r];if("object"==typeof s)for(const e in s){const n=e,i=s[n];t[r][n]=i}t[r]=s}return t}static empty(){return s.create({})}static all(){return s.create({source:!0,targets:{feature:!0,aggregate:!0},storage:{filters:!0,data:!0},mesh:!0})}unset(e){this.version=e.version,e.source&&(this.source=!1),e.targets.feature&&(this.targets.feature=!1),e.targets.aggregate&&(this.targets.aggregate=!1),e.storage.filters&&(this.storage.filters=!1),e.storage.data&&(this.storage.data=!1),e.mesh&&(this.mesh=!1),e.queryFilter&&(this.queryFilter=!1)}any(){return this.source||this.mesh||this.storage.filters||this.storage.data||this.targets.feature||this.targets.aggregate||this.queryFilter}describe(){let e=0,t="";if(this.mesh){e+=20,t+="-> (20) Mesh needs update\n";for(const e of this.why.mesh)t+=`    + ${e}\n`}if(this.source){e+=10,t+="-> (10) The source needs update\n";for(const e of this.why.source)t+=`    + ${e}\n`}this.targets.feature&&(e+=5,t+="-> (5) Feature target parameters changed\n"),this.storage.filters&&(e+=5,t+="-> (5) Feature filter parameters changed\n"),this.targets.aggregate&&(e+=4,t+="-> (4) Aggregate target parameters changed\n"),this.storage.data&&(e+=1,t+="-> (1) Texture storage parameters changed");const r=e<5?"Fastest":e<10?"Fast":e<15?"Moderate":e<20?"Slow":"Very Slow";console.debug(`Applying ${r} update of cost ${e}/45 `),console.debug(t)}toJSON(){return{queryFilter:this.queryFilter,source:this.source,targets:this.targets,storage:this.storage,mesh:this.mesh}}constructor(){this.version=0,this.source=!1,this.targets={feature:!1,aggregate:!1},this.storage={filters:!1,data:!1},this.mesh=!1,this.queryFilter=!1,this.why={mesh:[],source:[]}}}})),t.register("aVi46",(function(r,s){e(r.exports,"PagedFeatureSource",(function(){return u}));var n=t("kyj08"),i=t("jHOLN"),a=t("10vEZ"),o=t("NMQPz");class u extends o.BaseFeatureSource{async _fetchDataTile(e){const t=this._subscriptions.get(e.key.id);let r=!1,s=0,o=0;const u=(s,n)=>{o--,(0,a.throwIfAborted)(t);const i=e.id,u=s.reader,l=s.query;if(!u.exceededTransferLimit){if(r=!0,0!==n&&!u.hasFeatures){const e={id:i,addOrUpdate:u,end:0===o,type:"append"};return t.add({message:e,query:l}),void this._onMessage(e)}const e={id:i,addOrUpdate:u,end:0===o,type:"append"};return t.add({message:e,query:l}),void this._onMessage(e)}const c={id:i,addOrUpdate:u,end:r&&0===o,type:"append"};t.add({message:c,query:l}),this._onMessage(c)};let l=0,c=0;for(;!r&&c++<20;){let c;for(let d=0;d<l+1;d++){const l=s++;o++,c=this._fetchDataTilePage(e,l,t).then((e=>e&&u(e,l))).catch((o=>{if(r=!0,!(0,a.isAbortError)(o)){i.default.getLogger("esri.views.2d.layers.features.sources.PagedFeatureSource").error(new(0,n.default)("mapview-query-error","Encountered error when fetching tile",{tile:e,error:o}));const a={id:e.id,addOrUpdate:null,end:r,type:"append"},u={start:this.pageSize*s,num:this.pageSize,returnExceededLimitFeatures:!0,quantizationParameters:e.getQuantizationParameters()};null!=this.maxRecordCountFactor&&(u.maxRecordCountFactor=this.maxRecordCountFactor);const l=this.createTileQuery(e,u);t.add({message:a,query:l}),this._onMessage(a)}}))}await c,(0,a.throwIfAborted)(t),l=Math.min(l+2,6)}}async _fetchDataTilePage(e,t,r){(0,a.throwIfAborted)(r);const s=this._queryInfo,n={start:this.pageSize*t,num:this.pageSize,returnExceededLimitFeatures:!0,quantizationParameters:e.getQuantizationParameters()};null!=this.maxRecordCountFactor&&(n.maxRecordCountFactor=this.maxRecordCountFactor);const i=this.createTileQuery(e,n);try{const n=r.signal,o=await this.enqueueQuery({tile:e,query:i,signal:n,depth:t});return(0,a.throwIfAborted)(r),o?s!==this._queryInfo?this._fetchDataTilePage(e,t,r):{reader:o,query:i}:null}catch(e){return(0,a.throwIfNotAbortError)(e),null}}constructor(e){super(e)}}})),t.register("hSjjm",(function(r,s){e(r.exports,"SnapshotFeatureSource",(function(){return g}));var n=t("7eJjO");t("2VlWd");var i=t("jHOLN"),a=t("7qybv"),o=t("10vEZ"),u=t("hvORu"),l=t("fcwIv"),c=t("NMQPz"),d=t("esg0R"),h=t("8LcfB");function f(e,t,r){const s=e.getXHydrated(),n=e.getYHydrated(),i=t.getColumnForX(s),a=Math.floor(t.normalizeCol(i));return`${r}/${Math.floor(t.getRowForY(n))}/${a}`}function p(e,t){if(null==e)return null;const r=t.transform,s=e.getQuantizationTransform();if(null==s){const[t,s]=r.scale,[n,i]=r.translate,a=-n/t,o=1/t,u=i/s,l=1/-s;return e.transform(a,u,o,l)}const[n,i]=s.scale,[a,o]=s.translate,[u,l]=r.scale,[c,d]=r.translate,h=n/u,f=(a-c)/u,p=i/l,g=(-o+d)/l;return e.transform(f,g,h,p)}let g=class extends c.BaseFeatureSource{destroy(){super.destroy(),this._controller.abort()}get loading(){return this._loading}get _signal(){return this._controller.signal}update(e,t){var r;super.update(e,t),null==this._featureCount&&(this._featureCount=t.initialFeatureCount),null!=t.changedFeatureCount&&(this._featureCount=t.changedFeatureCount),this._hasAggregates=!!(null===(r=e.targets)||void 0===r?void 0:r.aggregate)}async resend(e=!1){if(await this._downloadPromise,this._invalidated||e){const e=(0,a.unwrapOrThrow)(this._featureCount,"Expected featureCount to be defined");return this._invalidated=!1,this._subscriptions.forEach((e=>e.clear())),this._downloadPromise=this._download(e),void await this._downloadPromise}const t=this._queries.map((({query:e,reader:t})=>this._sendPatchQuery(e,t)));await Promise.all(t),this._subscriptions.forEach((e=>{e.requests.done.forEach((e=>this._onMessage(e.message)))}))}async refresh(e,t){t&&(this._featureCount=t.featureCount),await this.resend(!0)}async _sendPatchQuery(e,t){const r=null!=e.outFields?e.outFields:[],s=this._queryInfo.outFields,n=s.filter((e=>!r.includes(e)));if(!n.length)return;const i=e.clone(),a=this._signal;i.returnGeometry=!1,i.returnCentroid=!1,i.outFields=n,e.outFields=s;const u=await this.enqueueQuery({query:i,depth:0,signal:a});(0,o.throwIfAborted)({signal:a}),t.joinAttributes(u)}async _fetchDataTile(e){if(!this._downloadPromise){const e=(0,a.unwrapOrThrow)(this._featureCount,"Expected featureCount to be defined");this._downloadPromise=this._download(e)}const t=this._store.search(e),r=this._subscriptions.get(e.key.id),s=t.length-1;for(let n=0;n<s;n++){const s=p(t[n],e),i={type:"append",id:e.id,addOrUpdate:s,end:!1,status:h.UpdateToken.empty()};r.add({query:null,message:i}),this._hasAggregates||await(0,o.after)(1),this._onMessage(i)}const n=p(s>=0?t[s]:null,e),i=this._didSendEnd,u={type:"append",id:e.id,addOrUpdate:n,end:i,status:h.UpdateToken.empty()};r.add({query:null,message:u}),this._onMessage(u)}async _download(e){try{await this.whenInitialized();const t=this._store.storage.getBitset(this._markedIdsBufId),r=new Set;t.clear();const s=Math.ceil(e/this.pageSize),n=Array.from({length:s},((e,t)=>t)).sort(((e,t)=>this._random.getInt()-this._random.getInt())).map((e=>this._downloadPage(e,t,r)));await Promise.all(n),this._store.sweepFeatures(t,this._store.storage),this._store.sweepFeatureSets(r)}catch(e){i.default.getLogger("esri.views.2d.layers.features.sources.SnapshotFeatureSource").error("mapview-snapshot-source","Encountered and error when downloading feature snapshot",e)}this._sendEnd(),this._loading=!1}async _downloadPage(e,t,r){const s=this.pageSize,n={start:e*s,num:s,cacheHint:!0};null!=this.maxRecordCountFactor&&(n.maxRecordCountFactor=this.maxRecordCountFactor);const i=this.createQuery(n),a=this._signal,u=await this.enqueueQuery({query:i,depth:e,signal:a});(0,o.throwIfAborted)({signal:a}),this._queries.push({query:i,reader:u}),this._store.insert(u),r.add(u.instance);const l=u.getCursor();for(;l.next();)t.set(l.getDisplayId());this._send(u)}_send(e){if(!this._subscriptions.size)return;let t=null;const r=new Map,s=new Set,n=new Map;this._subscriptions.forEach((e=>{const i=e.tile;var a;r.set(i.key.id,null),t=i.tileInfoView,s.add(i.level);const{row:o,col:u}=i.key,l=`${i.level}/${o}/${u}`,c=null!==(a=n.get(l))&&void 0!==a?a:[];c.push(e),n.set(l,c)}));for(const i of s){const s=t.getLODInfoAt(i),a=e.getCursor();for(;a.next();){const e=f(a,s,i),t=a.getIndex();if(n.has(e))for(const s of n.get(e)){const e=s.tile.id;let n=r.get(e);null==n&&(n=[],r.set(e,n)),n.push(t)}}}r.forEach(((t,r)=>{if(null!=t){const s=this._subscriptions.get(r),n={type:"append",id:r,addOrUpdate:p(d.FeatureSetReaderIndirect.from(e,t),s.tile),end:!1,status:h.UpdateToken.empty()};s.add({query:null,message:n}),this._onMessage(n)}}))}_sendEnd(){this._subscriptions.forEach((e=>{const t={type:"append",id:e.tile.id,addOrUpdate:null,end:!0,status:h.UpdateToken.empty()};e.add({query:null,message:t}),this._onMessage(t)})),this._didSendEnd=!0}constructor(e){super(e),this.mode="snapshot",this._loading=!0,this._controller=new AbortController,this._downloadPromise=null,this._didSendEnd=!1,this._queries=new Array,this._invalidated=!1,this._hasAggregates=!1,this._random=new(0,u.default)(1e3),this._store=e.store,this._markedIdsBufId=this._store.storage.createBitset()}};g=(0,n._)([(0,l.subclass)("esri.view.2d.layers.features.sources.SnapshotFeatureSource")],g)})),t.register("fMY8t",(function(r,s){e(r.exports,"StreamSource",(function(){return y}));var n=t("6ah52");t("2VlWd");var i=t("38gAI"),a=t("akQYU"),o=t("awxBI"),u=t("3Nw26"),l=t("ho6jZ"),c=t("23qU2"),d=t("t8LCR"),h=t("5STKO"),f=t("8LcfB");function p(e,t){const r=e.weakClone();if(null!=e.geometry){const s=(0,a.quantizeX)(t,e.geometry.coords[0]),n=(0,a.quantizeY)(t,e.geometry.coords[1]);r.geometry=new(0,o.default)([],[s,n])}return r}function g(e,t){const r=(0,i.r)(9,function(e){return"esriGeometryPoint"===e?e=>null!=e.geometry?{minX:e.geometry.coords[0],minY:e.geometry.coords[1],maxX:e.geometry.coords[0],maxY:e.geometry.coords[1]}:{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}:e=>{let t=1/0,r=1/0,s=-1/0,n=-1/0;return null!=e.geometry&&e.geometry.forEachVertex(((e,i)=>{t=Math.min(t,e),r=Math.min(r,i),s=Math.max(s,e),n=Math.max(n,i)})),{minX:t,minY:r,maxX:s,maxY:n}}}(t));return r.load(e),r}class m{get _features(){const e=[];return this._objectIdToFeature.forEach((t=>e.push(t))),e}add(e){this._objectIdToFeature.set(e.objectId,e),this._index=null}get(e){return this._objectIdToFeature.has(e)?this._objectIdToFeature.get(e):null}forEach(e){this._objectIdToFeature.forEach(e)}search(e){return this._index||(this._index=g(this._features,this._geometryType)),function(e,t){return e.search({minX:t.bounds[0],minY:t.bounds[1],maxX:t.bounds[2],maxY:t.bounds[3]})}(this._index,e)}clear(){this._index=null,this._objectIdToFeature.clear()}removeById(e){const t=this._objectIdToFeature.get(e);return t?(this._objectIdToFeature.delete(e),this._index=null,t):null}update(e,t){this.onUpdate(e,t)}get size(){return this._objectIdToFeature.size}constructor(e,t){this.onUpdate=e,this._geometryType=t,this._objectIdToFeature=new Map,this._index=null}}class y extends c.DataTileSource{destroy(){var e;super.destroy(),this._clearUpdateInterval(),this._connection.destroy(),null===(e=this._handlesGroup)||void 0===e||e.remove()}_fetchDataTile(){}get connectionStatus(){return this._connectionState.connectionStatus}get errorString(){return this._connectionState.errorString}updateCustomParameters(e){this._connection.updateCustomParameters(e)}pauseStream(){this._isPaused||(this._isPaused=!0,this._clearUpdateInterval())}resumeStream(){this._isPaused&&(this._isPaused=!1,this._initUpdateInterval())}sendMessageToSocket(e){this._connection.sendMessageToSocket(e)}sendMessageToClient(e){this._isPaused&&"type"in e&&"clear"===e.type?(this._store.clear(),this._subscriptions.forEach(((e,t)=>{e.didSend&&e.tile.level===this._level&&this._onMessage({type:"append",id:t,addOrUpdate:null,clear:!0,end:!0})}))):this._connection.sendMessageToClient(e)}enableEvent(e,t){t?this._enabledEventTypes.add(e):this._enabledEventTypes.delete(e)}subscribe(e,t){super.subscribe(e,t);const r=this._subscriptions.get(e.id);r.resolve(),this._level=e.level;const s=this._getTileFeatures(e);this._onMessage({type:"append",id:e.key.id,addOrUpdate:s,end:!0}),r.didSend=!0}unsubscribe(e){super.unsubscribe(e)}*readers(e){const t=this._subscriptions.get(e),{tile:r}=t;yield this._getTileFeatures(r)}createTileQuery(e){throw new Error("Service does not support tile  queries")}async resend(){this._subscriptions.forEach((e=>{const{tile:t}=e,r={type:"append",id:t.id,addOrUpdate:this._getTileFeatures(t),end:!0};this._onMessage(r)}))}_getTileFeatures(e){const t=this._store.search(e).map((t=>this._quantize(t,e.transform)));return h.FeatureSetReaderJSON.fromOptimizedFeatures(t,this._serviceInfo,e.transform)}_onWebSocketMessage(e){if(this._enabledEventTypes.has("message-received")&&this.events.emit("message-received",e),"type"in e)switch(e.type){case"delete":if(e.objectIds)for(const t of e.objectIds)this._manager.removeById(t);if(e.trackIds)for(const t of e.trackIds)this._manager.removeByTrackId(t);break;case"clear":this._store.forEach((e=>this._manager.removeById(e.objectId)))}}_onFeature(e){this._updateInfo.websocket++;try{this._enabledEventTypes.has("data-received")&&this.events.emit("data-received",e);const t=(0,a.convertFromFeature)(e,this._serviceInfo.geometryType,!1,!1,this._serviceInfo.objectIdField);this._manager.add(t)}catch(e){}}_clearUpdateInterval(){clearInterval(this._updateIntervalId),this._updateIntervalId=0}async _onUpdate(e,t){this._inUpdate=!0;try{null!=e&&(this._updateInfo.client+=e.length),this._subscriptions.forEach(((e,t)=>{e.didSend&&e.tile.level===this._level&&this._onMessage({type:"append",id:t,addOrUpdate:null,clear:!0,end:!1})}));const t=[];this._subscriptions.forEach(((e,r)=>{if(!e.didSend||e.tile.level!==this._level)return;const s=e.tile,n={type:"append",id:r,addOrUpdate:this._getTileFeatures(s),remove:[],end:!1,status:f.UpdateToken.empty()};e.requests.stream.enqueue(n),t.push(this._onMessage(n))})),await Promise.all(t),this._subscriptions.forEach(((e,t)=>{e.didSend&&e.tile.level===this._level&&this._onMessage({type:"append",id:t,addOrUpdate:null,end:!0})}))}catch{}this._inUpdate=!1}constructor(e){super(e),this.type="stream",this._updateIntervalId=0,this._level=0,this._isPaused=!1,this._updateInfo={websocket:0,client:0},this._inUpdate=!1;const{outSR:t}=e,{geometryType:r,objectIdField:s,timeInfo:i,purgeOptions:c,source:h,spatialReference:f,serviceFilter:g,maxReconnectionAttempts:y,maxReconnectionInterval:_,updateInterval:v,customParameters:I,enabledEventTypes:S}=e.serviceInfo,x=new m(this._onUpdate.bind(this),r),b=new(0,u.StreamFeatureManager)(x,s,i,c),T=(0,l.createConnection)(h,f,t,r,g,y,_,null!=I?I:{});var w;this._connectionState=new(0,d.StreamConnectionState)({connection:T}),this._store=x,this._manager=b,this._connection=T,this._quantize="esriGeometryPoint"===(w=r)?p:(e,t)=>{const r=e.weakClone(),s=new(0,o.default),n=(0,a.quantizeOptimizedGeometry)(s,e.geometry,!1,!1,w,t,!1,!1);return r.geometry=n,r},this._enabledEventTypes=new Set(S),this._handlesGroup=(0,n.handlesGroup)([this._connection.on("data-received",(e=>this._onFeature(e))),this._connection.on("message-received",(e=>this._onWebSocketMessage(e)))]),this._initUpdateInterval=()=>{let t=performance.now();this._updateIntervalId=setInterval((()=>{const r=performance.now(),s=r-t;if(s>2500){t=r;const e=Math.round(this._updateInfo.client/(s/1e3)),n=Math.round(this._updateInfo.websocket/(s/1e3));this._updateInfo.client=0,this._updateInfo.websocket=0,this.events.emit("updateRate",{client:e,websocket:n})}e.canAcceptRequest()&&!this._inUpdate&&this._manager.checkForUpdates()}),v)},this._isPaused=e.serviceInfo.isPaused,this._isPaused||this._initUpdateInterval()}}})),t.register("3Nw26",(function(r,s){e(r.exports,"StreamFeatureManager",(function(){return a}));var n=t("gDoEW"),i=t("iVfa0");class a{removeById(e){this._removed.push(e)}removeByTrackId(e){const t=this._trackIdToObservations.get(e);if(t)for(const e of t.entries)this._removed.push(e)}add(e){if(this._useGeneratedIds){const t=this._nextId();e.attributes[this.objectIdField]=t,e.objectId=t}else e.objectId=e.attributes[this.objectIdField];const t=e.objectId;if(this._addOrUpdated.set(t,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return null==this._trackIdLessObservations&&(this._trackIdLessObservations=new(0,n.default)(1e5)),void this._trackIdLessObservations.enqueue(t);const r=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(r)){const e=null!=this._purgeOptions&&null!=this._purgeOptions.maxObservations?this._purgeOptions.maxObservations:1e3,t=(0,i.clamp)(e,0,1e3);this._trackIdToObservations.set(r,new(0,n.default)(t))}const s=this._trackIdToObservations.get(r),a=null==s?void 0:s.enqueue(t);null!=a&&(this._addOrUpdated.has(a)?this._addOrUpdated.delete(a):this._removed.push(a))}checkForUpdates(){const e=this._getToAdd(),t=this._getToRemove(),r=performance.now();r-this._lastPurge>=this.purgeInterval&&(this._purge(r),this._lastPurge=r);const s=[];if(null!=t)for(const e of t){const t=this.store.removeById(e);null!=t&&s.push(t)}const n=[];if(null!=e){const s=new Set(null!=t?t:[]);for(const t of e)s.has(t.objectId)||(t.attributes.__esri_timestamp__=r,this.store.add(t),n.push(t))}(n.length||(null==s?void 0:s.length))&&this.store.update(n,s)}_getToAdd(){if(!this._addOrUpdated.size)return null;const e=new Array(this._addOrUpdated.size);let t=0;return this._addOrUpdated.forEach((r=>e[t++]=r)),this._addOrUpdated.clear(),e}_getToRemove(){const e=this._removed;return this._removed.length?(this._removed=[],e):null}_nextId(){const e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e}_purge(e){const t=this._purgeOptions;null!=t&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeByAgeReceived(e,t),this._purgeTracks())}_purgeSomeByDisplayCount(e){if(!e.displayCount)return;let t=this.store.size;if(t>e.displayCount){if(this._timeInfo.trackIdField)for(const r of this._trackIdToObservations.values())if(t>e.displayCount&&r.size){const e=r.dequeue();this._removed.push(e),t--}if(null!=this._trackIdLessObservations){let r=t-e.displayCount;for(;r-- >0;){const e=this._trackIdLessObservations.dequeue();null!=e&&this._removed.push(e)}}}}_purgeByAge(e){var t;const r=null===(t=this._timeInfo)||void 0===t?void 0:t.startTimeField;if(!e.age||!r)return;const s=60*e.age*1e3,n=this._maxAge-s;this.store.forEach((e=>{e.attributes[r]<n&&this._removed.push(e.objectId)}))}_purgeByAgeReceived(e,t){if(!t.ageReceived)return;const r=e-60*t.ageReceived*1e3;this.store.forEach((e=>{e.attributes.__esri_timestamp__<r&&this._removed.push(e.objectId)}))}_purgeTracks(){this._trackIdToObservations.forEach(((e,t)=>{0===e.size&&this._trackIdToObservations.delete(t)}))}constructor(e,t,r,s,n=128){this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=r,this._purgeOptions=s,this.store=e,this.objectIdField=t,this.purgeInterval=n,this._useGeneratedIds="__esri_stream_id__"===this.objectIdField}}})),t.register("t8LCR",(function(r,s){e(r.exports,"StreamConnectionState",(function(){return u}));var n=t("7eJjO"),i=t("jymfC"),a=t("iho5X"),o=t("fcwIv");let u=class extends i.default{get connectionStatus(){var e;return null===(e=this.connection)||void 0===e?void 0:e.connectionStatus}get errorString(){var e;return null===(e=this.connection)||void 0===e?void 0:e.errorString}constructor(e){super(e)}};(0,n._)([(0,a.property)()],u.prototype,"connection",void 0),(0,n._)([(0,a.property)()],u.prototype,"connectionStatus",null),(0,n._)([(0,a.property)()],u.prototype,"errorString",null),u=(0,n._)([(0,o.subclass)("esri.views.2d.layers.features.sources.StreamConnectionState")],u)})),t.register("9Ic5L",(function(r,s){e(r.exports,"BinStore",(function(){return A})),t("2ILM8");var n=t("amfHf"),i=t("2VlWd"),a=t("jHOLN"),o=t("7qybv"),u=t("9doMy"),l=t("8Vmmp"),c=t("bUB3w"),d=t("ayLat"),h=t("8NvwW"),f=t("eY5Yp"),p=t("akQYU"),g=t("ft2bT"),m=t("awxBI"),y=t("fP7bp"),_=t("ieqnL"),v=t("dEIm1"),I=t("eOTSy"),S=t("5STKO"),x=t("j40xv"),b=t("fTq43"),T=t("gINRd");const w=a.default.getLogger("esri.view.2d.layers.features.support.BinStore"),F=(0,d.create)();function E(e){return 57.29577951308232*e}class A extends I.Store2D{destroy(){this._tree&&this._tree.destroy()}get featureSpatialReference(){return this._spatialReference}get fields(){return this._fields}async updateSchema(e,t){const r=this._schema;try{await super.updateSchema(e,t),await this._projectionSupportCheck}catch(e){}this._fields=this._schema.params.fields;const s=(0,u.diff)(r,t);t&&(null!=s||e.source||e.storage.filters)?(((0,u.hasDiff)(s,"params.fields")||(0,u.hasDiff)(s,"params")||!this._tree||e.source)&&(this._tree&&this._tree.destroy(),this._tree=new(0,l.GeohashTree)(this._statisticFields,this._serviceInfo),this._tree.onRelease=e=>e.displayId&&this._storage.releaseDisplayId(e.displayId),this._geohashLevel=this._schema.params.fixedBinLevel,this._rebuildTree(),(0,i.default)("esri-2d-update-debug")&&w.info("Aggregate mesh needs update due to tree changing")),(0,i.default)("esri-2d-update-debug")&&w.info("Aggregate mesh needs update due to tree changing"),e.targets[t.name]=!0,e.mesh=!1):r&&(e.mesh=!0)}clear(){this._rebuildTree()}sweepFeatures(e,t){this._bitsets.inserted.forEachSet((r=>{if(!e.has(r)){const e=t.lookupByDisplayIdUnsafe(r);this._remove(e)}}))}sweepAggregates(e,t,r){}onTileData(e,t,r,s,n=!0){if(!this._schema||null==t.addOrUpdate)return t;this.events.emit("changed");const i=this._getTransforms(e,this._spatialReference);{const e=t.addOrUpdate.getCursor();for(;e.next();)this._update(e,s)}if(t.status.mesh||!n)return t;const a=new Array;this._getBinsForTile(a,e,i,r),t.addOrUpdate=S.FeatureSetReaderJSON.fromOptimizedFeatures(a,{fields:this.fields,geometryType:"esriGeometryPolygon",objectIdField:this.objectIdField}),t.addOrUpdate.attachStorage(r),t.end=!0,t.isRepush||(t.clear=!0);{const s=t.addOrUpdate.getCursor();for(;s.next();){const t=s.getDisplayId();this._bitsets.computed.unset(t),this.setComputedAttributes(r,s,t,e.scale)}}return t}forEachBin(e){this._tree.forEach(e)}forEach(e){this._tree.forEach((t=>{if(t.depth!==this._geohashLevel)return;const r=this._toFeatureJSON(t),s=S.FeatureSetReaderJSON.fromFeatures([r],{objectIdField:this.objectIdField,globalIdField:null,geometryType:this.geometryInfo.geometryType,fields:this.fields}).getCursor();s.next(),e(s)}))}forEachInBounds(e,t){}forEachBounds(e,t){const{hasM:r,hasZ:s}=this.geometryInfo;for(const n of e){const e=(0,p.getBoundsOptimizedGeometry)(F,n.readGeometry(),s,r);null!=e&&t(e)}}onTileUpdate(e){}getAggregate(e){const t=(0,_.createDisplayId)(e,!0),r=this._tree.findIf((e=>e.displayId===t));return(0,o.applySome)(r,(e=>this._toFeatureJSON(e)))}getAggregates(){return this._tree.findAllIf((e=>e.depth===this._geohashLevel)).map(this._toFeatureJSON.bind(this))}getDisplayId(e){const t=this._tree.findIf((t=>t.id===e));return(0,o.applySome)(t,(e=>e.displayId))}getFeatureDisplayIdsForAggregate(e){const t=this._tree.findIf((t=>t.id===e));return null!=t?Array.from(t.displayIds):[]}getDisplayIdForReferenceId(e){const t=this._tree.findIf((t=>1===t.displayIds.size&&t.displayIds.has(e)));return(0,o.applySome)(t,(e=>e.displayId))}_toFeatureJSON(e){const t=this._spatialReference;return{displayId:e.displayId,attributes:e.getAttributes(),geometry:(0,p.convertToGeometry)(e.getGeometry(t),"esriGeometryPolygon",!1,!1),centroid:null}}_rebuildTree(){this._bitsets.computed.clear(),this._bitsets.inserted.clear(),this._tree&&this._tree.clear()}_remove(e){const t=e.getDisplayId(),r=e.getXHydrated(),s=e.getYHydrated(),n=this._geohashBuf[2*t],i=this._geohashBuf[2*t+1];this._bitsets.inserted.has(t)&&(this._bitsets.inserted.unset(t),this._tree.removeCursor(e,r,s,n,i,this._geohashLevel))}_update(e,t){const r=e.getDisplayId(),s=this._bitsets.inserted,n=t.isVisible(r);if(n===s.has(r))return;if(!n)return void this._remove(e);const i=e.getXHydrated(),a=e.getYHydrated();if(!this._setGeohash(r,i,a))return;const o=this._geohashBuf[2*r],u=this._geohashBuf[2*r+1];this._tree.insertCursor(e,r,i,a,o,u,this._geohashLevel),s.set(r)}_setGeohash(e,t,r){if(this._bitsets.geohash.has(e))return!0;const s=this._geohashBuf;if(this._spatialReference.isWebMercator){const n=E(t/h.earth.radius),i=n-360*Math.floor((n+180)/360),a=E(Math.PI/2-2*Math.atan(Math.exp(-r/h.earth.radius)));(0,c.setGeohashBuf)(s,e,a,i,12)}else{const n=(0,y.project)({x:t,y:r},this._spatialReference,x.default.WGS84);if(!n)return!1;(0,c.setGeohashBuf)(s,e,n.y,n.x,12)}return this._bitsets.geohash.set(e),!0}_getBinsForTile(e,t,r,s){try{const n=this._getGeohashBounds(t),i=this._tree.getBins(n);for(const t of i){t.displayId||(t.displayId=s.createDisplayId(!0));let n=null;const i=t.getGeometry(this._spatialReference,r.tile);i||(n=t.getGeometryCentroid(this._spatialReference,r.tile));const a=new(0,g.OptimizedFeature)(i,t.getAttributes(),n);a.objectId=t.id,a.displayId=t.displayId,e.push(a)}}catch(e){return void w.error("Unable to get bins for tile",t.key.id)}}_getGeohash(e,t,r){const s={geohashX:0,geohashY:0};return(0,c.setGeohashXY)(s,t,e,r),s}_getGeohashBounds(e){const t=this._getGeohashLevel(e.key.level),r=[e.extent.xmin,e.extent.ymin,e.extent.xmax,e.extent.ymax],s=b.default.fromExtent(T.default.fromBounds(r,this._spatialReference)),n=(0,y.project)(s,this._spatialReference,x.default.WGS84,{densificationStep:64*e.resolution}),i=(0,p.convertFromPolygon)(new(0,m.default),n,!1,!1),a=i.coords.filter(((e,t)=>!(t%2))),o=i.coords.filter(((e,t)=>t%2)),u=Math.min(...a),l=Math.min(...o),c=Math.max(...a),d=Math.max(...o),h=this._getGeohash(u,l,t),f=this._getGeohash(c,d,t);return{bounds:r,geohashBounds:{xLL:h.geohashX,yLL:h.geohashY,xTR:f.geohashX,yTR:f.geohashY},level:t}}_getGeohashLevel(e){return this._schema.params.fixedBinLevel}_getTransforms(e,t){const r={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},s=(0,f.getInfo)(t);if(!s)return{tile:r,left:null,right:null};const[n,i]=s.valid;return{tile:r,left:{...r,translate:[i,e.bounds[3]]},right:{...r,translate:[n-i+e.bounds[0],e.bounds[3]]}}}constructor(e,t,r,s){super(e,r),this.type="bin",this.events=new(0,n.default),this.objectIdField="aggregateId",this.featureAdapter=v.featureAdapter,this._geohashLevel=5,this._geohashBuf=[],this._serviceInfo=s,this.geometryInfo=e.geometryInfo,this._spatialReference=t,this._projectionSupportCheck=(0,y.checkProjectionSupport)(t,x.default.WGS84),this._bitsets.geohash=r.getBitset(r.createBitset()),this._bitsets.inserted=r.getBitset(r.createBitset())}}})),t.register("8Vmmp",(function(r,s){e(r.exports,"GeohashTree",(function(){return d}));var n=t("gDoEW"),i=t("bUB3w"),a=t("j40xv"),o=t("akQYU"),u=t("awxBI"),l=t("fP7bp"),c=t("5STKO");class d{destroy(){this.clear()}_acquire(e,t,r){this._nodes++;let s=null;return null!=this._pool&&(s=this._pool.dequeue()),null!=s?s.realloc(e,t,r):s=new h(this,e,t,r),s}_release(e){this.onRelease(e),this._nodes--,null!=this._pool&&this._pool.enqueue(e)}get count(){return this._root.count}get size(){return this._nodes}get poolSize(){var e,t;return null!==(t=null===(e=this._pool)||void 0===e?void 0:e.size)&&void 0!==t?t:0}get depth(){let e=0;return this.forEach((t=>e=Math.max(e,t.depth))),e}dropLevels(e){this.forEach((t=>{if(t.depth>=e)for(let e=0;e<t.children.length;e++){const r=t.children[e];r&&this._release(r)}})),this.forEach((t=>{if(t.depth>=e)for(let e=0;e<t.children.length;e++)t.children[e]=null}))}clear(){this.forEach((e=>this._release(e))),this._root=new h(this,0,0,0)}insert(e,t,r=0){const s=c.FeatureSetReaderJSON.fromOptimizedFeatures([e],this._serviceInfo).getCursor();s.next();const n=s.readGeometry();if(!n)return;const[i,a]=n.coords,o=e.geohashX,u=e.geohashY;this.insertCursor(s,e.displayId,i,a,o,u,t,r)}insertCursor(e,t,r,s,n,i,a,o=0){let u=this._root,l=0,c=0,d=0;for(;null!==u;){if(u.depth>=o&&(u.count+=1,u.xTotal+=r,u.yTotal+=s,u.xGeohashTotal+=n,u.yGeohashTotal+=i,u.referenceId=t,this._updateStatisticsCursor(e,u,1)),l>=a)return void u.add(t);const h=Math.ceil((l+1)/2),f=Math.floor((l+1)/2),p=1-l%2,g=30-(3*h+2*f),m=30-(2*h+3*f),y=(n&7*p+3*(1-p)<<g)>>g,_=(i&3*p+7*(1-p)<<m)>>m,v=y+_*(8*p+4*(1-p));c=c<<3*p+2*(1-p)|y,d=d<<2*p+3*(1-p)|_,null==u.children[v]&&(u.children[v]=this._acquire(c,d,l+1)),l+=1,u=u.children[v]}}remove(e,t){const r=c.FeatureSetReaderJSON.fromOptimizedFeatures([e],this._serviceInfo).getCursor();r.next();const s=r.readGeometry();if(!s)return;const[n,i]=s.coords,a=e.geohashX,o=e.geohashY;this.removeCursor(r,n,i,a,o,t)}removeCursor(e,t,r,s,n,i){let a=this._root,o=0;for(;null!==a;){if(a.count-=1,a.xTotal-=t,a.yTotal-=r,a.xGeohashTotal-=s,a.yGeohashTotal-=n,this._updateStatisticsCursor(e,a,-1),o>=i)return void a.remove(e.getDisplayId());const u=Math.ceil((o+1)/2),l=Math.floor((o+1)/2),c=1-o%2,d=30-(3*u+2*l),h=30-(2*u+3*l),f=((s&7*c+3*(1-c)<<d)>>d)+((n&3*c+7*(1-c)<<h)>>h)*(8*c+4*(1-c)),p=a.children[f];1===(null==p?void 0:p.count)&&(this._release(p),a.children[f]=null),o+=1,a=p}}forEach(e){let t=this._root;for(;null!==t;){const r=this._linkChildren(t)||t.next;e(t),t=r}}find(e,t,r){return this._root.find(e,t,r,0,0,0)}findIf(e){let t=null;return this.forEach((r=>{e(r)&&(t=r)})),t}findAllIf(e){const t=[];return this.forEach((r=>{e(r)&&t.push(r)})),t}findSingleOccupancyNode(e,t,r,s,n){let i=this._root;for(;null!==i;){const a=i.depth,o=i.xNode,u=i.yNode,l=1-a%2,c=i.xGeohashTotal/i.count,d=i.yGeohashTotal/i.count;if(1===i.count&&e<c&&c<=r&&t<d&&d<=s)return i;if(a>=n){i=i.next;continue}const h=Math.ceil((a+1)/2),f=Math.floor((a+1)/2),p=30-(3*h+2*f),g=30-(2*h+3*f),m=~((1<<p)-1),y=~((1<<g)-1),_=(e&m)>>p,v=(t&y)>>g,I=(r&m)>>p,S=(s&y)>>g,x=o<<3*l+2*(1-l),b=u<<2*l+3*(1-l),T=x+8*l+4*(1-l),w=b+4*l+8*(1-l),F=Math.max(x,_),E=Math.max(b,v),A=Math.min(T,I),M=Math.min(w,S);let C=null,R=null;for(let e=E;e<=M;e++)for(let t=F;t<=A;t++){const r=t-x+(e-b)*(8*l+4*(1-l)),s=i.children[r];s&&(C||(C=s,C.next=i.next),R&&(R.next=s),R=s,s.next=i.next)}i=C||i.next}return null}getRegionDisplayIds(e){let t=this._root;const{bounds:r,geohashBounds:s,level:n}=e,[i,a,o,u]=r,l=[];for(;null!==t;){const e=t.depth,r=t.xNode,c=t.yNode;if(e>=n){const e=t.xTotal/t.count,r=t.yTotal/t.count;e>=i&&e<=o&&r>=a&&r<=u&&t.displayIds.forEach((e=>l.push(e))),t=t.next;continue}const d=Math.ceil((e+1)/2),h=Math.floor((e+1)/2),f=1-e%2,p=30-(3*d+2*h),g=30-(2*d+3*h),m=~((1<<p)-1),y=~((1<<g)-1),_=(s.xLL&m)>>p,v=(s.yLL&y)>>g,I=(s.xTR&m)>>p,S=(s.yTR&y)>>g,x=r<<3*f+2*(1-f),b=c<<2*f+3*(1-f),T=x+8*f+4*(1-f),w=b+4*f+8*(1-f),F=Math.max(x,_),E=Math.max(b,v),A=Math.min(T,I),M=Math.min(w,S);let C=null,R=null;for(let e=E;e<=M;e++)for(let r=F;r<=A;r++){const s=r-x+(e-b)*(8*f+4*(1-f)),n=t.children[s];n&&(C||(C=n,C.next=t.next),R&&(R.next=n),R=n,n.next=t.next)}t=C||t.next}return l}getRegionStatistics(e){let t=this._root,r=0,s=0,n=0;const i={},{bounds:a,geohashBounds:o,level:u}=e,[l,c,d,h]=a;let f=0;for(;null!==t;){const e=t.depth,a=t.xNode,p=t.yNode;if(e>=u){const e=t.xTotal/t.count,a=t.yTotal/t.count;e>l&&e<=d&&a>c&&a<=h&&(r+=t.count,s+=t.xTotal,n+=t.yTotal,1===t.count&&(f=t.referenceId),this._aggregateStatistics(i,t.statistics)),t=t.next;continue}const g=Math.ceil((e+1)/2),m=Math.floor((e+1)/2),y=1-e%2,_=30-(3*g+2*m),v=30-(2*g+3*m),I=~((1<<_)-1),S=~((1<<v)-1),x=(o.xLL&I)>>_,b=(o.yLL&S)>>v,T=(o.xTR&I)>>_,w=(o.yTR&S)>>v,F=a<<3*y+2*(1-y),E=p<<2*y+3*(1-y),A=F+8*y+4*(1-y),M=E+4*y+8*(1-y),C=Math.max(F,x),R=Math.max(E,b),O=Math.min(A,T),L=Math.min(M,w);let N=null,D=null;for(let e=R;e<=L;e++)for(let a=C;a<=O;a++){const o=a-F+(e-E)*(8*y+4*(1-y)),u=t.children[o];if(u){if(e!==R&&e!==L&&a!==C&&a!==O){const e=u.xTotal/u.count,t=u.yTotal/u.count;e>l&&e<=d&&t>c&&t<=h&&(r+=u.count,s+=u.xTotal,n+=u.yTotal,1===u.count&&(f=u.referenceId),this._aggregateStatistics(i,u.statistics));continue}N||(N=u,N.next=t.next),D&&(D.next=u),D=u,u.next=t.next}}t=N||t.next}return{count:r,attributes:this.normalizeStatistics(i,r),xTotal:s,yTotal:n,referenceId:f}}getBins(e){const t=[],{geohashBounds:r,level:s}=e;let n=this._root;for(;null!==n;){const e=n.depth,i=n.xNode,a=n.yNode;if(e>=s){t.push(n),n=n.next;continue}const o=Math.ceil((e+1)/2),u=Math.floor((e+1)/2),l=1-e%2,c=30-(3*o+2*u),d=30-(2*o+3*u),h=~((1<<c)-1),f=~((1<<d)-1),p=(r.xLL&h)>>c,g=(r.yLL&f)>>d,m=(r.xTR&h)>>c,y=(r.yTR&f)>>d,_=i<<3*l+2*(1-l),v=a<<2*l+3*(1-l),I=_+8*l+4*(1-l),S=v+4*l+8*(1-l),x=Math.max(_,p),b=Math.max(v,g),T=Math.min(I,m),w=Math.min(S,y);let F=null,E=null;for(let e=b;e<=w;e++)for(let t=x;t<=T;t++){const r=t-_+(e-v)*(8*l+4*(1-l)),s=n.children[r];s&&(F||(F=s,F.next=n.next),E&&(E.next=s),E=s,s.next=n.next)}n=F||n.next}return t}_linkChildren(e){let t=null,r=null;for(let s=0;s<=e.children.length;s++){const n=e.children[s];n&&(t||(t=n,t.next=e.next),r&&(r.next=n),r=n,n.next=e.next)}return t}_updateStatisticsCursor(e,t,r){for(const i of this._statisticFields){const a=i.name,o=i.inField?e.readAttribute(i.inField):e.getComputedNumericAtIndex(i.inFieldIndex);switch(i.statisticType){case"min":{if(isNaN(o))break;if(!t.statistics[a]){t.statistics[a]={value:o};break}const e=t.statistics[a].value;t.statistics[a].value=Math.min(e,o);break}case"max":{if(isNaN(o))break;if(!t.statistics[a]){t.statistics[a]={value:o};break}const e=t.statistics[a].value;t.statistics[a].value=Math.max(e,o);break}case"count":break;case"sum":case"avg":{var s;t.statistics[a]||(t.statistics[a]={value:0,nanCount:0});const e=t.statistics[a].value,n=null!==(s=t.statistics[a].nanCount)&&void 0!==s?s:0;null==o||isNaN(o)?t.statistics[a].nanCount=n+r:t.statistics[a].value=e+r*o;break}case"avg_angle":{var n;t.statistics[a]||(t.statistics[a]={x:0,y:0,nanCount:0});const e=t.statistics[a].x,s=t.statistics[a].y,i=null!==(n=t.statistics[a].nanCount)&&void 0!==n?n:0,u=Math.PI/180;null==o||isNaN(o)?t.statistics[a].nanCount=i+r:(t.statistics[a].x=e+r*Math.cos(o*u),t.statistics[a].y=s+r*Math.sin(o*u));break}case"mode":{t.statistics[a]||(t.statistics[a]={});const e=t.statistics[a][o]||0;t.statistics[a][o]=e+r;break}}}}_aggregateStatistics(e,t){for(const r of this._statisticFields){const s=r.name;switch(r.statisticType){case"min":{if(!e[s]){e[s]={value:t[s].value};break}const r=e[s].value;e[s].value=Math.min(r,t[s].value);break}case"max":{if(!e[s]){e[s]={value:t[s].value};break}const r=e[s].value;e[s].value=Math.max(r,t[s].value);break}case"count":break;case"sum":case"avg":case"avg_angle":case"mode":e[s]||(e[s]={});for(const r in t[s]){const n=e[s][r]||0;e[s][r]=n+t[s][r]}}}}normalizeStatistics(e,t){const r={};for(const s of this._statisticFields){const n=s.name;switch(s.statisticType){case"min":case"max":{const s=e[n];if(!t||!s)break;r[n]=s.value;break}case"count":if(!t)break;r[n]=t;break;case"sum":{if(!t)break;const{value:s,nanCount:i}=e[n];if(!(t-i))break;r[n]=s;break}case"avg":{if(!t)break;const{value:s,nanCount:i}=e[n];if(!(t-i))break;r[n]=s/(t-i);break}case"avg_angle":{if(!t)break;const{x:s,y:i,nanCount:a}=e[n];if(!(t-a))break;const o=s/(t-a),u=i/(t-a),l=180/Math.PI,c=Math.atan2(u,o)*l;r[n]=c;break}case"mode":{const t=e[n];let s=0,i=0,a=null;for(const e in t){const r=t[e];r===s?i+=1:r>s&&(s=r,i=1,a=e)}r[n]="null"===a||i>1?null:a;break}}}return r}constructor(e=[],t,r=8096){this.onRelease=e=>{},this._nodes=0,this._root=new h(this,0,0,0),this._statisticFields=e,this._pool=r?new(0,n.default)(8096):null,this._serviceInfo=t}}class h{realloc(e,t,r){for(let e=0;e<this.children.length;e++)this.children[e]=null;return this.xNode=e,this.yNode=t,this.depth=r,this.next=null,this.xGeohashTotal=0,this.yGeohashTotal=0,this.displayId=0,this.referenceId=0,this.xTotal=0,this.yTotal=0,this.count=0,this.statistics={},this.displayIds.clear(),this}get id(){return`${this.xNode}.${this.yNode}`}add(e){this.displayIds.add(e)}remove(e){this.displayIds.delete(e)}getAttributes(){const e=this._tree.normalizeStatistics(this.statistics,this.count);return e.referenceId=null,e.aggregateId=this.id,e.aggregateCount=this.count,e}getGeometry(e,t){const r=this.getLngLatBounds(),[s,n,i,c]=r,d=(0,l.project)({rings:[[[s,n],[s,c],[i,c],[i,n],[s,n]]]},a.default.WGS84,e),h=(0,o.convertFromPolygon)(new(0,u.default),d,!1,!1);return null!=t?(0,o.quantizeOptimizedGeometry)(new(0,u.default),h,!1,!1,"esriGeometryPolygon",t,!1,!1):h}getGeometryCentroid(e,t){const r=this.getLngLatBounds(),[s,n,i,c]=r,d=(0,l.project)({x:(s+i)/2,y:(n+c)/2},a.default.WGS84,e),h=(0,o.convertFromPoint)(new(0,u.default),d);return null!=t?(0,o.quantizeOptimizedGeometry)(new(0,u.default),h,!1,!1,"esriGeometryPoint",t,!1,!1):h}getLngLatBounds(){const e=this.depth,t=Math.ceil(e/2),r=Math.floor(e/2),s=30-(3*t+2*r),n=30-(2*t+3*r),a=this.xNode<<s,o=this.yNode<<n;return(0,i.decodeGeohashXY)({geohashX:a,geohashY:o},this.depth)}find(e,t,r,s,n,i){if(s>=r)return this;const a=1-s%2,o=3*a+2*(1-a),u=2*a+3*(1-a),l=30-n-o,c=30-i-u,d=((e&7*a+3*(1-a)<<l)>>l)+((t&3*a+7*(1-a)<<c)>>c)*(8*a+4*(1-a)),h=this.children[d];return null==h?null:h.find(e,t,r,s+1,n+o,i+u)}constructor(e,t,r,s){this.count=0,this.xTotal=0,this.yTotal=0,this.statistics={},this.displayId=0,this.referenceId=0,this.displayIds=new Set,this.next=null,this.depth=0,this.xNode=0,this.yNode=0,this.xGeohashTotal=0,this.yGeohashTotal=0,this._tree=e,this.children=new Array(32);for(let e=0;e<this.children.length;e++)this.children[e]=null;this.xNode=t,this.yNode=r,this.depth=s}}})),t.register("bUB3w",(function(t,r){e(t.exports,"decodeGeohashXY",(function(){return c})),e(t.exports,"setGeohashXY",(function(){return d})),e(t.exports,"setGeohashBuf",(function(){return h})),e(t.exports,"encodeGeohash",(function(){return f}));const s=new Float64Array(2),n=new Float64Array(2);function i(e){return"0123456789bcdefghjkmnpqrstuvwxyz"[e]}function a(e){return(e[0]+e[1])/2}function o(e,t,r){return e[0]=t,e[1]=r,e}function u(e,t){const r=a(e),s=t,n=!t;e[0]=n*e[0]+s*r,e[1]=n*r+s*e[1]}function l(e,t){const r=t>a(e);return u(e,r),r}function c(e,t){let r=-90,s=90,n=-180,i=180;for(let a=0;a<t;a++){const t=Math.ceil((a+1)/2),o=Math.floor((a+1)/2),u=1-a%2,l=30-(3*t+2*o),c=30-(2*t+3*o),d=3*u+2*(1-u),h=2*u+3*(1-u),f=3*u+7*(1-u)<<c,p=(7*u+3*(1-u)<<l&e.geohashX)>>l,g=(f&e.geohashY)>>c;for(let e=d-1;e>=0;e--){const t=(n+i)/2,r=p&1<<e?1:0;n=(1-r)*n+r*t,i=(1-r)*t+r*i}for(let e=h-1;e>=0;e--){const t=(r+s)/2,n=g&1<<e?1:0;r=(1-n)*r+n*t,s=(1-n)*t+n*s}}return[n,r,i,s]}function d(e,t,r,s){s%2&&(s+=1);let n=0,i=0,a=-90,o=90,u=-180,l=180;for(let e=0;e<s/2;e++){for(let t=0;t<5;t++){const s=(u+l)/2,i=r>s?1:0;n|=i<<29-(t+5*e),u=(1-i)*u+i*s,l=(1-i)*s+i*l}for(let r=0;r<5;r++){const s=(a+o)/2,n=t>s?1:0;i|=n<<29-(r+5*e),a=(1-n)*a+n*s,o=(1-n)*s+n*o}}e.geohashX=n,e.geohashY=i}function h(e,t,r,s,n){n%2&&(n+=1);let i=0,a=0,o=-90,u=90,l=-180,c=180;for(let e=0;e<n/2;e++){for(let t=0;t<5;t++){const r=(l+c)/2,n=s>r?1:0;i|=n<<29-(t+5*e),l=(1-n)*l+n*r,c=(1-n)*r+n*c}for(let t=0;t<5;t++){const s=(o+u)/2,n=r>s?1:0;a|=n<<29-(t+5*e),o=(1-n)*o+n*s,u=(1-n)*s+n*u}}e[2*t]=i,e[2*t+1]=a}function f(e,t,r){let a="";const u=o(s,-90,90),c=o(n,-180,180);for(let s=0;s<r;s++){let r=0;s%2?(r|=l(u,e)<<4,r|=l(c,t)<<3,r|=l(u,e)<<2,r|=l(c,t)<<1,r|=l(u,e)<<0):(r|=l(c,t)<<4,r|=l(u,e)<<3,r|=l(c,t)<<2,r|=l(u,e)<<1,r|=l(c,t)<<0),a+=i(r)}return a}})),t.register("fP7bp",(function(r,s){e(r.exports,"checkProjectionSupport",(function(){return f})),e(r.exports,"project",(function(){return m})),e(r.exports,"projectMany",(function(){return _}));var n=t("lNwWH"),i=t("7RvA5"),a=t("jGyUI"),o=t("eY5Yp"),u=t("eF88h");const l=[0,0];function c(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,l),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,l),[r.xmax,r.ymax]=e(t.xmax,t.ymax,l),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:d(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:d(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:h(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function d(e,t){const r=[];for(const s of e)r.push(h(s,t));return r}function h(e,t){const r=[];for(const s of e){const e=t(s[0],s[1],[0,0]);r.push(e),s.length>2&&e.push(s[2]),s.length>3&&e.push(s[3])}return r}async function f(e,t){if(!e||!t)return;const r=Array.isArray(e)?e.map((e=>null!=e.geometry?e.geometry.spatialReference:null)).filter(n.isSome):[e];await(0,i.initializeProjection)(r.map((e=>({source:e,dest:t}))))}const p=c.bind(null,u.lngLatToXY),g=c.bind(null,u.xyToLngLat);function m(e,t,r,s){if(!e)return e;if(r||(r=t,t=e.spatialReference),!(0,o.isValid)(t)||!(0,o.isValid)(r)||(0,o.equals)(t,r))return e;if((0,u.canProject)(t,r)){const t=(0,o.isWebMercator)(r)?p(e):g(e);return t.spatialReference=r,t}return(0,i.projectMany)(a.jsonAdapter,[e],t,r,null,s)[0]}const y=new class{async push(e,t,r){if(!e||!e.length||!t||!r||(0,o.equals)(t,r))return e;const s={geometries:e,inSpatialReference:t,outSpatialReference:r,resolve:null};return this._jobs.push(s),new Promise((e=>{s.resolve=e,null===this._timer&&(this._timer=setTimeout(this._process,10))}))}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:r,outSpatialReference:s,resolve:n}=e;(0,u.canProject)(r,s)?(0,o.isWebMercator)(s)?n(t.map(p)):n(t.map(g)):n((0,i.projectMany)(a.jsonAdapter,t,r,s,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}};function _(e,t,r){return y.push(e,t,r)}})),t.register("jGyUI",(function(t,r){e(t.exports,"jsonAdapter",(function(){return s}));const s={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){const s=new n(e.getPointX(t),e.getPointY(t),r),i=e.hasZ(t),a=e.hasM(t);return i&&(s.z=e.getPointZ(t)),a&&(s.m=e.getPointM(t)),s},exportPolygon:function(e,t,r){return new i(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new a(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new o(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){const s=e.hasZ(t),n=e.hasM(t),i=new u(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(s){const r=e.getZExtent(t);i.zmin=r.vmin,i.zmax=r.vmax}if(n){const r=e.getMExtent(t);i.mmin=r.vmin,i.mmax=r.vmax}return i}};class n{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class i{constructor(e,t,r,s){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class a{constructor(e,t,r,s){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class o{constructor(e,t,r,s){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class u{constructor(e,t,r,s,n){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=s,this.spatialReference=n,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}})),t.register("ieqnL",(function(t,r){e(t.exports,"DISPLAY_ID_TEXEL_MASK",(function(){return s})),e(t.exports,"DISPLAY_ID_TYPE_FEATURE",(function(){return i})),e(t.exports,"DISPLAY_ID_TYPE_AGGREGATE",(function(){return a})),e(t.exports,"getDisplayIdType",(function(){return o})),e(t.exports,"getDisplayIdTexel",(function(){return u})),e(t.exports,"getDisplayIdFilterMask",(function(){return l})),e(t.exports,"isAggregateId",(function(){return c})),e(t.exports,"createDisplayId",(function(){return d}));const s=8388607,n=8388608,i=0,a=1,o=e=>(e&n)>>>23,u=e=>e&s,l=e=>o(e)===a?254:255;function c(e){return o(e)===a}function d(e,t){return((t?n:0)|e)>>>0}})),t.register("eJHSv",(function(r,s){e(r.exports,"ClusterStore",(function(){return A})),t("2ILM8");var n=t("amfHf"),i=t("2VlWd"),a=t("7qybv"),o=t("9doMy"),u=t("8Vmmp"),l=t("bUB3w"),c=t("ayLat"),d=t("8NvwW"),h=t("eY5Yp"),f=t("akQYU"),p=t("ft2bT"),g=t("awxBI"),m=t("fP7bp"),y=t("4WoSm"),_=t("ieqnL"),v=t("dEIm1"),I=t("eOTSy"),S=t("5STKO"),x=t("j40xv"),b=t("fTq43"),T=t("gINRd");const w=(0,c.create)();class F extends p.OptimizedFeatureWithGeometry{get count(){return this.attributes.cluster_count}static create(e,t,r,s,n,i,a,o){const u=new F(t,r,s,i,a);return u.displayId=e.createDisplayId(!0),u.referenceId=o,u.tileLevel=n,u}update(e,t,r,s,n,i){return this.geometry.coords[0]=e,this.geometry.coords[1]=t,this.tileLevel=r,this.attributes=s,this.geohashBoundsInfo=n,this.referenceId=null,this.referenceId=i,this}toJSON(){return{attributes:{...this.attributes,aggregateId:this.objectId,referenceId:1===this.attributes.cluster_count?this.referenceId:null},geometry:{x:this.geometry.coords[0],y:this.geometry.coords[1]}}}constructor(e,t,r,s,n){super(new(0,g.default)([],[t,r]),s,null,e),this.geohashBoundsInfo=n}}function E(e){return 57.29577951308232*e}class A extends I.Store2D{destroy(){this._tree.destroy()}get featureSpatialReference(){return this._spatialReference}get fields(){return this._fields}async updateSchema(e,t){const r=this._schema;try{await super.updateSchema(e,t),await this._projectionSupportCheck}catch(e){}this._fields=[...this._schema.params.fields,{name:"referenceId",alias:"referenceId",type:"esriFieldTypeInteger"}],this._fields.some((e=>"cluster_count"===e.name))||this._fields.push({name:"cluster_count",alias:"cluster_count",type:"esriFieldTypeInteger"});const s=(0,o.diff)(r,t);t&&(null!=s||e.source||e.storage.filters)?(((0,o.hasDiff)(s,"params.fields")||!this._tree||e.source)&&(this._tree&&this._tree.destroy(),this._tree=new(0,u.GeohashTree)(this._statisticFields,this._serviceInfo),this._rebuildTree(),(0,i.default)("esri-2d-update-debug")&&console.debug("Aggregate mesh needs update due to tree changing")),(0,i.default)("esri-2d-update-debug")&&console.debug("Applying Update - ClusterStore:",s),e.targets[t.name]=!0,e.mesh=!1,this._aggregateValueRanges={}):r&&(e.mesh=!0)}clear(){this._rebuildTree()}sweepFeatures(e,t){this._bitsets.inserted.forEachSet((r=>{if(!e.has(r)){const e=t.lookupByDisplayIdUnsafe(r);this._remove(e)}}))}sweepAggregates(e,t,r){this._clusters.forEach(((s,n)=>{s&&s.tileLevel!==r&&(e.releaseDisplayId(s.displayId),t.unsetAttributeData(s.displayId),this._clusters.delete(n))}))}onTileData(e,t,r,s,n=!0){if(!this._schema||null==t.addOrUpdate)return t;this.events.emit("changed");const i=this._getTransforms(e,this._spatialReference);{const e=t.addOrUpdate.getCursor();for(;e.next();)this._update(e,s)}if(t.status.mesh||!n)return t;const a=new Array,o=this._schema.params.clusterRadius;this._getClustersForTile(a,e,o,r,i),t.addOrUpdate=S.FeatureSetReaderJSON.fromOptimizedFeatures(a,{fields:this.fields,geometryType:"esriGeometryPoint",objectIdField:this.objectIdField}),t.addOrUpdate.attachStorage(r),t.clear=!0,t.end=!0;{const s=t.addOrUpdate.getCursor();for(;s.next();){const t=s.getDisplayId();this._bitsets.computed.unset(t),this.setComputedAttributes(r,s,t,e.scale)}}return this._aggregateValueRangesChanged&&t.end&&(this.events.emit("valueRangesChanged",{valueRanges:this._aggregateValueRanges}),this._aggregateValueRangesChanged=!1),t}onTileUpdate({added:e,removed:t}){if(e.length){const t=e[0].level;this._tileLevel=t,this._setGeohashLevel(t)}if(!this._schema)return;const r=this._schema.params.clusterRadius;t.forEach((e=>{this._tiles.delete(e.key.id),this._markTileClustersForDeletion(e,r)}))}getAggregate(e){for(const t of this._clusters.values())if(((null==t?void 0:t.displayId)&_.DISPLAY_ID_TEXEL_MASK)==(e&_.DISPLAY_ID_TEXEL_MASK))return t.toJSON();return null}getAggregates(){const e=[];for(const t of this._clusters.values())(null==t?void 0:t.tileLevel)===this._tileLevel&&e.push(t.toJSON());return e}getDisplayId(e){const t=this._clusters.get(e);return t?t.displayId:null}getFeatureDisplayIdsForAggregate(e){const t=this._clusters.get(e);return t?this._tree.getRegionDisplayIds(t.geohashBoundsInfo):[]}getDisplayIdForReferenceId(e){for(const t of this._clusters.values())if((null==t?void 0:t.referenceId)===e)return t.displayId;return null}getAggregateValueRanges(){return this._aggregateValueRanges}forEach(e){this._clusters.forEach((t=>{if(!t)return;const r=t.toJSON(),s=S.FeatureSetReaderJSON.fromFeatures([r],{objectIdField:this.objectIdField,globalIdField:null,geometryType:this.geometryInfo.geometryType,fields:this.fields}).getCursor();s.next(),e(s)}))}forEachInBounds(e,t){}forEachBounds(e,t){const{hasM:r,hasZ:s}=this.geometryInfo;for(const n of e){const e=(0,f.getBoundsOptimizedGeometry)(w,n.readGeometry(),s,r);null!=e&&t(e)}}size(){let e=0;return this.forEach((t=>e++)),e}_rebuildTree(){this._bitsets.computed.clear(),this._bitsets.inserted.clear(),this._tree&&this._tree.clear()}_remove(e){const t=e.getDisplayId(),r=e.getXHydrated(),s=e.getYHydrated(),n=this._geohashBuf[2*t],i=this._geohashBuf[2*t+1];this._bitsets.inserted.has(t)&&(this._bitsets.inserted.unset(t),this._tree.removeCursor(e,r,s,n,i,this._geohashLevel))}_update(e,t){const r=e.getDisplayId(),s=this._bitsets.inserted,n=t.isVisible(r);if(n===s.has(r))return;if(!n)return void this._remove(e);const i=e.getXHydrated(),a=e.getYHydrated();if(!this._setGeohash(r,i,a))return;const o=this._geohashBuf[2*r],u=this._geohashBuf[2*r+1];this._tree.insertCursor(e,r,i,a,o,u,this._geohashLevel),s.set(r)}_setGeohash(e,t,r){if(this._bitsets.geohash.has(e))return!0;const s=this._geohashBuf;if(this._spatialReference.isWebMercator){const n=E(t/d.earth.radius),i=n-360*Math.floor((n+180)/360),a=E(Math.PI/2-2*Math.atan(Math.exp(-r/d.earth.radius)));(0,l.setGeohashBuf)(s,e,a,i,12)}else{const n=(0,m.project)({x:t,y:r},this._spatialReference,x.default.WGS84);if(!n)return!1;(0,l.setGeohashBuf)(s,e,n.y,n.x,12)}return this._bitsets.geohash.set(e),!0}_getClustersForTile(e,t,r,s,n,i=!0){const o=this._schema.params.clusterPixelBuffer,u=2*r,l=Math.ceil(2**t.key.level*y.TILE_SIZE/u)+1,c=Math.ceil(o/u)+0,d=Math.ceil(y.TILE_SIZE/u),{row:h,col:g}=t.key,m=g*y.TILE_SIZE,_=h*y.TILE_SIZE,v=Math.floor(m/u)-c,I=Math.floor(_/u)-c,S=v+d+2*c,x=I+d+2*c,b=t.tileInfoView.getLODInfoAt(t.key.level);for(let r=v;r<=S;r++)for(let o=I;o<=x;o++){let u=r;b.wrap&&(u=r<0?r+l:r%l);const c=b.wrap&&r<0,d=b.wrap&&r%l!==r,h=this._lookupCluster(s,b,t.key.level,u,o,t);if(null!=h){const t=(0,a.applySome)(n,(e=>c?e.left:d?e.right:e.tile));if(i&&null==t)continue;if(!h.count)continue;if(null!=t&&i){const r=h.geometry.clone();let s=h.attributes;r.coords[0]=(0,f.quantizeX)(t,r.coords[0]),r.coords[1]=(0,f.quantizeY)(t,r.coords[1]),1===h.count&&null!=h.referenceId&&(s={...h.attributes,referenceId:h.referenceId});const n=new(0,p.OptimizedFeature)(r,s);n.displayId=h.displayId,e.push(n)}}}}_getGeohashLevel(e){return Math.min(Math.ceil(e/2+2),12)}_setGeohashLevel(e){const t=this._getGeohashLevel(e),r=1*(Math.floor(t/1)+1)-1;if(this._geohashLevel!==r)return this._geohashLevel=r,this._rebuildTree(),void this._bitsets.geohash.clear()}_getTransforms(e,t){const r={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},s=(0,h.getInfo)(t);if(!s)return{tile:r,left:null,right:null};const[n,i]=s.valid;return{tile:r,left:{...r,translate:[i,e.bounds[3]]},right:{...r,translate:[n-i+e.bounds[0],e.bounds[3]]}}}_getClusterId(e,t,r){return(15&e)<<28|(16383&t)<<14|16383&r}_markForDeletion(e,t,r){const s=this._getClusterId(e,t,r);this._clusters.delete(s)}_getClusterBounds(e,t,r){const s=this._schema.params.clusterRadius,n=2*s;let i=r%2?t*n:t*n-s;const a=r*n;let o=i+n;const u=a-n,l=2**e.level*y.TILE_SIZE;e.wrap&&i<0&&(i=0),e.wrap&&o>l&&(o=l);const c=i/y.TILE_SIZE,d=a/y.TILE_SIZE,h=o/y.TILE_SIZE,f=u/y.TILE_SIZE;return[e.getXForColumn(c),e.getYForRow(d),e.getXForColumn(h),e.getYForRow(f)]}_getGeohash(e,t,r){const s={geohashX:0,geohashY:0};return(0,l.setGeohashXY)(s,t,e,r),s}_getGeohashBounds(e,t){const r=this._getGeohashLevel(e.key.level);if(this._spatialReference.isWebMercator){const[e,s,n,i]=t,a={x:e,y:s},o={x:n,y:i};let u=0,c=0,h=0,f=0;{const e=E(a.x/d.earth.radius);u=e-360*Math.floor((e+180)/360),c=E(Math.PI/2-2*Math.atan(Math.exp(-a.y/d.earth.radius)))}{const e=E(o.x/d.earth.radius);h=e-360*Math.floor((e+180)/360),f=E(Math.PI/2-2*Math.atan(Math.exp(-o.y/d.earth.radius)))}const p={geohashX:0,geohashY:0},g={geohashX:0,geohashY:0};return(0,l.setGeohashXY)(p,c,u,r),(0,l.setGeohashXY)(g,f,h,r),{bounds:[e,s,n,i],geohashBounds:{xLL:p.geohashX,yLL:p.geohashY,xTR:g.geohashX,yTR:g.geohashY},level:r}}const s=b.default.fromExtent(T.default.fromBounds(t,this._spatialReference)),n=(0,m.project)(s,this._spatialReference,x.default.WGS84,{densificationStep:64*e.resolution});if(!n)return null;const i=(0,f.convertFromPolygon)(new(0,g.default),n,!1,!1),a=i.coords.filter(((e,t)=>!(t%2))),o=i.coords.filter(((e,t)=>t%2)),u=Math.min(...a),c=Math.min(...o),h=Math.max(...a),p=Math.max(...o),y=this._getGeohash(u,c,r),_=this._getGeohash(h,p,r);return{bounds:t,geohashBounds:{xLL:y.geohashX,yLL:y.geohashY,xTR:_.geohashX,yTR:_.geohashY},level:r}}_lookupCluster(e,t,r,s,n,i){const a=this._getClusterId(r,s,n),o=this._clusters.get(a),u=this._getClusterBounds(t,s,n),l=this._getGeohashBounds(i,u);if(null==l)return null;const c=this._tree.getRegionStatistics(l),{count:d,xTotal:h,yTotal:f,referenceId:p}=c,g=d?h/d:0,m=d?f/d:0;if(0===d)return this._clusters.set(a,null),null;const y={cluster_count:d,...c.attributes},_=null!=o?o.update(g,m,r,y,l,p):F.create(e,a,g,m,r,y,l,p);if(0===d){const[e,t,r,s]=u;_.geometry.coords[0]=(e+r)/2,_.geometry.coords[1]=(t+s)/2}return this._clusters.set(a,_),this._updateAggregateValueRangeForCluster(_,_.tileLevel),_}_updateAggregateValueRangeForCluster(e,t){const r=this._aggregateValueRanges[t]||{minValue:1/0,maxValue:0},s=r.minValue,n=r.maxValue;r.minValue=Math.min(s,e.count),r.maxValue=Math.max(n,e.count),this._aggregateValueRanges[t]=r,s===r.minValue&&n===r.maxValue||(this._aggregateValueRangesChanged=!0)}_markTileClustersForDeletion(e,t){const r=2*t,s=Math.ceil(y.TILE_SIZE/r),{row:n,col:i}=e.key,a=i*y.TILE_SIZE,o=n*y.TILE_SIZE,u=Math.floor(a/r),l=Math.floor(o/r);for(let t=u;t<u+s;t++)for(let r=l;r<l+s;r++)this._markForDeletion(e.key.level,t,r)}constructor(e,t,r,s){super(e,r),this.type="cluster",this.events=new(0,n.default),this.objectIdField="aggregateId",this.featureAdapter=v.featureAdapter,this._geohashLevel=0,this._tileLevel=0,this._aggregateValueRanges={},this._aggregateValueRangesChanged=!1,this._geohashBuf=[],this._clusters=new Map,this._tiles=new Map,this._serviceInfo=s,this.geometryInfo=e.geometryInfo,this._spatialReference=t,this._projectionSupportCheck=(0,m.checkProjectionSupport)(t,x.default.WGS84),this._bitsets.geohash=r.getBitset(r.createBitset()),this._bitsets.inserted=r.getBitset(r.createBitset())}}})),t.register("bNZSJ",(function(r,s){e(r.exports,"UnknownTimeZone",(function(){return o})),e(r.exports,"ArcadeDateErrorCodes",(function(){return n})),e(r.exports,"ArcadeDateError",(function(){return l})),e(r.exports,"ArcadeDate",(function(){return c})),e(r.exports,"createDateTimeZone",(function(){return d}));var n,i=t("jdIQq"),a=t("abR4U");class o{}o.instance=new(0,a.IANAZone)("Etc/UTC"),(n||(n={})).TimeZoneNotRecognised="TimeZoneNotRecognised";const u={[n.TimeZoneNotRecognised]:"Timezone identifier has not been recognised."};class l extends Error{constructor(e,t){super((0,i.doSubstitutions)(u[e],t)),this.declaredRootClass="esri.arcade.arcadedate.dateerror",Error.captureStackTrace&&Error.captureStackTrace(this,l)}}class c{static fromParts(e=0,t=1,r=1,s=0,n=0,i=0,o=0,u){if(isNaN(e)||isNaN(t)||isNaN(r)||isNaN(s)||isNaN(n)||isNaN(i)||isNaN(o))return null;let l=0;const h=a.DateTime.local(e,t).daysInMonth;r<1&&(l=r-1,r=1),r>h&&(l=r-h,r=h);let f=0;t>12?(f=t-12,t=12):t<1&&(f=t-1,t=1);let p=0;n>59?(p=n-59,n=59):n<0&&(p=n,n=0);let g=0;i>59?(g=i-59,i=59):i<0&&(g=i,i=0);let m=0;o>999?(m=o-999,o=999):o<0&&(m=o,o=0);let y=a.DateTime.fromObject({day:r,year:e,month:t,hour:s,minute:n,second:i,millisecond:o},{zone:d(u)});return 0!==f&&(y=y.plus({months:f})),0!==l&&(y=y.plus({days:l})),0!==p&&(y=y.plus({minutes:p})),0!==g&&(y=y.plus({seconds:g})),0!==m&&(y=y.plus({milliseconds:m})),new c(y)}static get systemTimeZoneCanonicalName(){var e;return null!==(e=Intl.DateTimeFormat().resolvedOptions().timeZone)&&void 0!==e?e:"system"}static arcadeDateAndZoneToArcadeDate(e,t){const r=d(t);return e.isUnknownTimeZone||r===o.instance?c.fromParts(e.year,e.monthJS+1,e.day,e.hour,e.minute,e.second,e.millisecond,r):new c(e._date.setZone(t))}static dateJSToArcadeDate(e){return new c(a.DateTime.fromJSDate(e,{zone:"system"}))}static dateJSAndZoneToArcadeDate(e,t="system"){return new c(a.DateTime.fromJSDate(e,{zone:t}))}static unknownEpochToArcadeDate(e){return new c(a.DateTime.fromMillis(e,{zone:o.instance}))}static unknownDateJSToArcadeDate(e){return new c(a.DateTime.fromMillis(e.getTime(),{zone:o.instance}))}static epochToArcadeDate(e,t="system"){return new c(a.DateTime.fromMillis(e,{zone:t}))}static dateTimeToArcadeDate(e){return new c(e)}clone(){return new c(this._date)}changeTimeZone(e){const t=d(e);return c.dateTimeToArcadeDate(this._date.setZone(t))}static dateTimeAndZoneToArcadeDate(e,t){const r=d(t);return e.zone===o.instance||r===o.instance?c.fromParts(e.year,e.month,e.day,e.hour,e.minute,e.second,e.millisecond,r):new c(e.setZone(r))}static nowToArcadeDate(e){return new c(a.DateTime.fromJSDate(new Date,{zone:e}))}static nowUTCToArcadeDate(){return new c(a.DateTime.utc())}get isSystem(){return"system"===this.timeZone||this.timeZone===c.systemTimeZoneCanonicalName}equals(e){return this.isSystem&&e.isSystem?this.toNumber()===e.toNumber():this.isUnknownTimeZone===e.isUnknownTimeZone&&this._date.equals(e._date)}get isUnknownTimeZone(){return this._date.zone===o.instance}get isValid(){return this._date.isValid}get hour(){return this._date.hour}get second(){return this._date.second}get day(){return this._date.day}get dayOfWeekISO(){return this._date.weekday}get dayOfWeekJS(){let e=this._date.weekday;return e>6&&(e=0),e}get millisecond(){return this._date.millisecond}get monthISO(){return this._date.month}get weekISO(){return this._date.weekNumber}get yearISO(){return this._date.weekYear}get monthJS(){return this._date.month-1}get year(){return this._date.year}get minute(){return this._date.minute}get zone(){return this._date.zone}get timeZoneOffset(){return this.isUnknownTimeZone?0:this._date.offset}get timeZone(){if(this.isUnknownTimeZone)return"unknown";if("system"===this._date.zone.type)return"system";const e=this.zone;return"fixed"===e.type?0===e.fixed?"utc":e.formatOffset(0,"short"):e.name}stringify(){return JSON.stringify(this.toJSDate())}plus(e){return new c(this._date.plus(e))}diff(e,t="milliseconds"){return this._date.diff(e._date,t)[t]}toISOString(e){return e?this._date.toISO({suppressMilliseconds:!0,includeOffset:!this.isUnknownTimeZone}):this._date.toISO({includeOffset:!this.isUnknownTimeZone})}toFormat(e,t){return this._date.toFormat(e,t)}toJSDate(){return this._date.toJSDate()}toSQLString(){return"timestamp '"+this._date.toFormat("yyyy-LL-dd HH:mm:ss")+"'"}toDateTime(){return this._date}toNumber(){return this._date.toMillis()}getTime(){return this._date.toMillis()}toUTC(){return new c(this._date.toUTC())}toLocal(){return new c(this._date.toLocal())}toString(){return this.toISOString(!0)}constructor(e){this._date=e,this.declaredRootClass="esri.arcade.arcadedate"}}function d(e){if(e instanceof a.Zone)return e;if("system"===e.toLowerCase())return"system";if("utc"===e.toLowerCase())return"utc";if("unknown"===e.toLowerCase())return o.instance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(e)){const t=a.FixedOffsetZone.parseSpecifier("UTC"+(e.startsWith("+")||e.startsWith("-")?"":"+")+e);if(t)return t}const t=a.IANAZone.create(e);if(!t.isValid)throw new l(n.TimeZoneNotRecognised);return t}})),t.register("7MwrG",(function(r,s){e(r.exports,"convertTimeReference",(function(){return l})),e(r.exports,"DateTimeReferenceFieldIndex",(function(){return d}));var n=t("bNZSJ"),i=t("4nMX7"),a=t("4g5jp"),o=t("abR4U"),u=t("19JY4");function l(e){if(!e)return null;if(e instanceof a.default&&(e=c(e.toJSON())),e instanceof o.Zone)return e;if("unknown"===e.toLowerCase())return n.UnknownTimeZone.instance;if("system"===e.toLowerCase())return o.SystemZone.instance;if("utc"===e.toLowerCase())return o.FixedOffsetZone.utcInstance;if(/^[\+\-]?[0-9]{1,2}([:][0-9]{2})?$/.test(e)){const t=o.FixedOffsetZone.parseSpecifier("UTC"+(e.startsWith("+")||e.startsWith("-")?"":"+")+e);if(t)return t}const t=o.IANAZone.create(e);if(!t.isValid)throw new(0,n.ArcadeDateError)(n.ArcadeDateErrorCodes.TimeZoneNotRecognised);return t}function c(e){return(null==e?void 0:e.timeZoneIANA)?null==e?void 0:e.timeZoneIANA:(null==e?void 0:e.timeZone)?(0,u.convertLegacyTimeZone)(e,""):""}class d{static create(e,t){const r=new d;return r.dateTimeReferenceMetaData=t,r._fieldIndex=e instanceof i.default?e:new(0,i.default)(e),r}static createFromLayer(e){var t,r,s,n;if(!e)return null;if(!e.fieldsIndex)return!e.declaredClass&&e.fields?d.create(e.fields,e):null;const i=new d;var a,o,u,l;return i._fieldIndex=e.fieldsIndex,i.dateTimeReferenceMetaData={timeInfo:null!==(a=null==e||null===(t=e.timeInfo)||void 0===t?void 0:t.toJSON())&&void 0!==a?a:null,editFieldsInfo:null!==(o=null==e||null===(r=e.editFieldsInfo)||void 0===r?void 0:r.toJSON())&&void 0!==o?o:null,dateFieldsTimeReference:null!==(u=null==e||null===(s=e.dateFieldsTimeReference)||void 0===s?void 0:s.toJSON())&&void 0!==u?u:null,preferredTimeReference:null!==(l=null==e||null===(n=e.preferredTimeReference)||void 0===n?void 0:n.toJSON())&&void 0!==l?l:null,datesInUnknownTimezone:!0===(null==e?void 0:e.datesInUnknownTimezone)},i}fieldTimeZone(e){var t,r,s,n,i,a,o,u,l,c,d,h,f,p,g,m,y,_,v,I,S,x,b;const T=null===(t=this._fieldIndex)||void 0===t?void 0:t.get(e);if(!T)return null;if("date"!==T.type&&"esriFieldTypeDate"!==T.type)return null;const w=this._fieldTimeZoneIndex[T.name];if(void 0!==w)return w;const F=[{field:null===(r=this.dateTimeReferenceMetaData)||void 0===r||null===(s=r.editFieldsInfo)||void 0===s?void 0:s.creationDateField,timeReference:null===(n=this.dateTimeReferenceMetaData)||void 0===n||null===(i=n.editFieldsInfo)||void 0===i?void 0:i.dateFieldsTimeReference,isunknown:!0===(null===(a=this.dateTimeReferenceMetaData)||void 0===a?void 0:a.datesInUnknownTimezone)},{field:null===(o=this.dateTimeReferenceMetaData)||void 0===o||null===(u=o.editFieldsInfo)||void 0===u?void 0:u.editDateField,timeReference:null===(l=this.dateTimeReferenceMetaData)||void 0===l||null===(c=l.editFieldsInfo)||void 0===c?void 0:c.dateFieldsTimeReference,isunknown:!0===(null===(d=this.dateTimeReferenceMetaData)||void 0===d?void 0:d.datesInUnknownTimezone)},{field:null===(h=this.dateTimeReferenceMetaData)||void 0===h||null===(f=h.timeInfo)||void 0===f?void 0:f.startTimeField,timeReference:null===(p=this.dateTimeReferenceMetaData)||void 0===p||null===(g=p.timeInfo)||void 0===g?void 0:g.timeReference,isunknown:!0===(null===(m=this.dateTimeReferenceMetaData)||void 0===m?void 0:m.datesInUnknownTimezone)},{field:null===(y=this.dateTimeReferenceMetaData)||void 0===y||null===(_=y.timeInfo)||void 0===_?void 0:_.endTimeField,timeReference:null===(v=this.dateTimeReferenceMetaData)||void 0===v||null===(I=v.timeInfo)||void 0===I?void 0:I.timeReference,isunknown:!0===(null===(S=this.dateTimeReferenceMetaData)||void 0===S?void 0:S.datesInUnknownTimezone)}];for(const e of F)if(e.field===T.name){const t=this.convertToIANA(e.timeReference,e.isunknown);return this._fieldTimeZoneIndex[T.name]=t,t}const E=this.convertToIANA(null===(x=this.dateTimeReferenceMetaData)||void 0===x?void 0:x.dateFieldsTimeReference,null===(b=this.dateTimeReferenceMetaData)||void 0===b?void 0:b.datesInUnknownTimezone);return this._fieldTimeZoneIndex[T.name]=E,E}convertToIANA(e,t){return t?"unknown":c(e)}get layerPreferredTimeZone(){var e,t;if(null!==this._ianaPreferred)return this._ianaPreferred;this._ianaPreferred="";const r=null===(e=this.dateTimeReferenceMetaData)||void 0===e?void 0:e.preferredTimeReference;return this._ianaPreferred=this.convertToIANA(r,!0===(null===(t=this.dateTimeReferenceMetaData)||void 0===t?void 0:t.datesInUnknownTimezone)),this._ianaPreferred}get layerTimeInfoTimeZone(){var e,t;if(null!==this._ianaTimeInfo)return this._ianaTimeInfo;this._ianaTimeInfo="";const r=null===(e=this.dateTimeReferenceMetaData)||void 0===e||null===(t=e.timeInfo)||void 0===t?void 0:t.timeReference;return this._ianaTimeInfo=this.convertToIANA(r,!1),this._ianaTimeInfo}get layerEditFieldsTimeZone(){var e,t,r;if(null!==this._ianaEditFields)return this._ianaEditFields;this._ianaEditFields="";const s=null===(e=this.dateTimeReferenceMetaData)||void 0===e||null===(t=e.editFieldsInfo)||void 0===t?void 0:t.dateFieldsTimeReference;return this._ianaEditFields=this.convertToIANA(s,null===(r=this.dateTimeReferenceMetaData)||void 0===r?void 0:r.datesInUnknownTimezone),this._ianaEditFields}get layerDateFieldsTimeZone(){var e,t;if(null!==this._ianaLayerDateFields)return this._ianaLayerDateFields;this._ianaLayerDateFields="";const r=null===(e=this.dateTimeReferenceMetaData)||void 0===e?void 0:e.dateFieldsTimeReference;return this._ianaLayerDateFields=this.convertToIANA(r,!0===(null===(t=this.dateTimeReferenceMetaData)||void 0===t?void 0:t.datesInUnknownTimezone)),this._ianaLayerDateFields}constructor(){this.dateTimeReferenceMetaData=null,this._fieldTimeZoneIndex={},this._fieldIndex=null,this._ianaPreferred=null,this._ianaTimeInfo=null,this._ianaEditFields=null,this._ianaLayerDateFields=null}}})),t.register("hbg1x",(function(r,s){e(r.exports,"processNullValue",(function(){return c})),e(r.exports,"isNullCountSupported",(function(){return d})),e(r.exports,"calculateStringStatistics",(function(){return h})),e(r.exports,"calculatePercentile",(function(){return p})),e(r.exports,"calculateStatistics",(function(){return f})),e(r.exports,"getAttributeComparator",(function(){return g})),e(r.exports,"processSummaryStatisticsResult",(function(){return v})),e(r.exports,"calculateUniqueValuesCount",(function(){return I})),e(r.exports,"createUVResult",(function(){return x})),e(r.exports,"getNormalizedValue",(function(){return b})),e(r.exports,"calculateClassBreaks",(function(){return T})),e(r.exports,"resolveCBResult",(function(){return w})),e(r.exports,"calculateHistogram",(function(){return F}));var n=t("59jTx"),i=t("hxmJW");const a="equal-interval",o=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,u=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),l=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function c(e){return null==e||"string"==typeof e&&!e?"<Null>":e}function d(e){const t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,s=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!s}function h(e){const t=e.returnDistinct?[...new Set(e.values)]:e.values,r=t.filter((e=>null!=e)).sort(),s=r.length,n={count:s,min:r[0],max:r[s-1]};return e.supportsNullCount&&(n.nullcount=t.length-s),e.percentileParams&&(n.median=p(t,e.percentileParams)),n}function f(e){const{values:t,useSampleStdDev:r,supportsNullCount:s}=e;let n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,a=null,o=null,u=null,l=null,c=0;const d=null==e.minValue?-1/0:e.minValue,h=null==e.maxValue?1/0:e.maxValue;for(const e of t)Number.isFinite(e)?e>=d&&e<=h&&(a=null===a?e:a+e,n=Math.min(n,e),i=Math.max(i,e),c++):"string"==typeof e&&c++;if(c&&null!=a){o=a/c;let e=0;for(const r of t)Number.isFinite(r)&&r>=d&&r<=h&&(e+=(r-o)**2);l=r?c>1?e/(c-1):0:c>0?e/c:0,u=Math.sqrt(l)}else n=null,i=null;const f={avg:o,count:c,max:i,min:n,stddev:u,sum:a,variance:l};return s&&(f.nullcount=t.length-c),e.percentileParams&&(f.median=p(t,e.percentileParams)),f}function p(e,t){const{fieldType:r,value:s,orderBy:n,isDiscrete:i}=t,a=g(r,"desc"===n);if(0===(e=[...e].filter((e=>null!=e)).sort(((e,t)=>a(e,t)))).length)return null;if(s<=0)return e[0];if(s>=1)return e[e.length-1];const o=(e.length-1)*s,u=Math.floor(o),l=u+1,c=o%1,d=e[u],h=e[l];return l>=e.length||i||"string"==typeof d||"string"==typeof h?d:d*(1-c)+h*c}function g(e,t){const r=t?1:-1,s=function(e){return e?(e,t)=>{const r=m(e,t,!0);return null!=r?r:t-e}:(e,t)=>{const r=m(e,t,!1);return null!=r?r:e-t}}(t),n=y(t);if(!e||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...u].includes(e))return(e,t)=>"number"==typeof e&&"number"==typeof t?s(e,t):"string"==typeof e&&"string"==typeof t?n(e,t):r;if("esriFieldTypeDate"===e)return(e,t)=>{const n=new Date(e).getTime(),i=new Date(t).getTime();return isNaN(n)||isNaN(i)?r:s(n,i)};if(u.has(e))return(e,t)=>s(e,t);if("esriFieldTypeString"===e)return(e,t)=>n(e,t);if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e){const e=y(t);return(t,r)=>e(_(t),_(r))}return t?(e,t)=>1:(e,t)=>-1}function m(e,t,r){if(r){if(null==e)return null==t?0:1;if(null==t)return-1}else{if(null==e)return null==t?0:-1;if(null==t)return 1}return null}function y(e){return e?(e,t)=>{const r=m(e,t,!0);return null!=r?r:(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0}:(e,t)=>{const r=m(e,t,!1);return null!=r?r:(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}}function _(e){return e.substr(24,12)+e.substr(19,4)+e.substr(16,2)+e.substr(14,2)+e.substr(11,2)+e.substr(9,2)+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)+e.substr(0,2)}function v(e,t){let r;for(r in e)l.includes(r)&&(Number.isFinite(e[r])||(e[r]=null));return t?(["avg","stddev","variance"].forEach((t=>{var r;null!=e[t]&&(e[t]=Math.ceil(null!==(r=e[t])&&void 0!==r?r:0))})),e):e}function I(e){const t={};for(let r of e)(null==r||"string"==typeof r&&""===r.trim())&&(r=null),null==t[r]?t[r]={count:1,data:r}:t[r].count++;return{count:t}}function S(e){return"coded-value"!==(null==e?void 0:e.type)?[]:e.codedValues.map((e=>e.code))}function x(e,t,r,s){const n=e.count,i=[];if(r&&t){const e=[],r=S(t[0]);for(const n of r)if(t[1]){const r=S(t[1]);for(const i of r)if(t[2]){const r=S(t[2]);for(const t of r)e.push(`${c(n)}${s}${c(i)}${s}${c(t)}`)}else e.push(`${c(n)}${s}${c(i)}`)}else e.push(n);for(const t of e)n.hasOwnProperty(t)||(n[t]={data:t,count:0})}for(const e in n){const t=n[e];i.push({value:t.data,count:t.count,label:t.label})}return{uniqueValueInfos:i}}function b(e,t,r,s){let n=null;switch(t){case"log":0!==e&&(n=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(s)&&0!==s&&(n=e/s*100);break;case"field":Number.isFinite(r)&&0!==r&&(n=e/r);break;case"natural-log":e>0&&(n=Math.log(e));break;case"square-root":e>0&&(n=e**.5)}return n}function T(e,t){const r=function(e){const{breakCount:t,field:r,normalizationField:s,normalizationType:i}=e,o=e.classificationMethod||a,u="standard-deviation"===o?e.standardDeviationInterval||1:void 0;return new(0,n.default)({breakCount:t,classificationField:r,classificationMethod:o,normalizationField:"field"===i?s:void 0,normalizationType:i,standardDeviationInterval:u})}({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||5});return e=function(e,t,r){const s=null!=t?t:-1/0,n=null!=r?r:1/0;return e.filter((e=>Number.isFinite(e)&&e>=s&&e<=n))}(e,t.minValue,t.maxValue),(0,i.createGenerateRendererClassBreaks)({definition:r,values:e,normalizationTotal:t.normalizationTotal})}function w(e,t){var r,s;let n=e.classBreaks;const i=n.length,a=null===(r=n[0])||void 0===r?void 0:r.minValue,u=null===(s=n[i-1])||void 0===s?void 0:s.maxValue,l="standard-deviation"===t,c=o;return n=n.map((e=>{const t=e.label,r={minValue:e.minValue,maxValue:e.maxValue,label:t};if(l&&t){var s;const e=t.match(c),n=null!==(s=null==e?void 0:e.map((e=>+e.trim())))&&void 0!==s?s:[];2===n.length?(r.minStdDev=n[0],r.maxStdDev=n[1],n[0]<0&&n[1]>0&&(r.hasAvg=!0)):1===n.length&&(t.includes("<")?(r.minStdDev=null,r.maxStdDev=n[0]):t.includes(">")&&(r.minStdDev=n[0],r.maxStdDev=null))}return r})),{minValue:a,maxValue:u,classBreakInfos:n,normalizationTotal:e.normalizationTotal}}function F(e,t){const r=function(e,t){const{field:r,classificationMethod:s,standardDeviationInterval:n,normalizationType:i,normalizationField:a,normalizationTotal:o,minValue:u,maxValue:l}=t,c=t.numBins||10;let h=null,p=null,g=null;if(s&&"equal-interval"!==s||i){const{classBreaks:t}=T(e,{field:r,normalizationType:i,normalizationField:a,normalizationTotal:o,classificationMethod:s,standardDeviationInterval:n,minValue:u,maxValue:l,numClasses:c});h=t[0].minValue,p=t[t.length-1].maxValue,g=t.map((e=>[e.minValue,e.maxValue]))}else{if(null!=u&&null!=l)h=u,p=l;else{const t=f({values:e,minValue:u,maxValue:l,useSampleStdDev:!i,supportsNullCount:d({normalizationType:i,normalizationField:a,minValue:u,maxValue:l})});var m,y;h=null!==(m=t.min)&&void 0!==m?m:null,p=null!==(y=t.max)&&void 0!==y?y:null}g=function(e,t,r){const s=(t-e)/r,n=[];let i,a=e;for(let e=1;e<=r;e++)i=a+s,i=Number(i.toFixed(16)),n.push([a,e===r?t:i]),a=i;return n}(null!=h?h:0,null!=p?p:0,c)}return{min:h,max:p,intervals:g}}(e,t);if(null==r.min&&null==r.max)return{bins:[],minValue:r.min,maxValue:r.max,normalizationTotal:t.normalizationTotal};var s,n;const i=r.intervals,a=null!==(s=r.min)&&void 0!==s?s:0,o=null!==(n=r.max)&&void 0!==n?n:0,u=i.map(((e,t)=>({minValue:i[t][0],maxValue:i[t][1],count:0})));for(const t of e)if(null!=t&&t>=a&&t<=o){const e=E(i,t);e>-1&&u[e].count++}return{bins:u,minValue:a,maxValue:o,normalizationTotal:t.normalizationTotal}}function E(e,t){let r=-1;for(let s=e.length-1;s>=0;s--)if(t>=e[s][0]){r=s;break}return r}})),t.register("59jTx",(function(r,s){e(r.exports,"default",(function(){return f}));var n=t("7eJjO"),i=t("79ASa"),a=t("1XAcN"),o=t("iho5X");t("iJAIC"),t("lNwWH"),t("2VlWd");var u=t("bSafx"),l=t("fcwIv");const c=new(0,i.JSONMap)({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),d=new(0,i.JSONMap)({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let h=class extends a.JSONSupport{set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}};(0,n._)([(0,u.enumeration)({classBreaksDef:"class-breaks-definition"})],h.prototype,"type",void 0),(0,n._)([(0,o.property)({json:{write:!0}})],h.prototype,"breakCount",void 0),(0,n._)([(0,o.property)({json:{write:!0}})],h.prototype,"classificationField",void 0),(0,n._)([(0,o.property)({type:String,json:{read:c.read,write:c.write}})],h.prototype,"classificationMethod",void 0),(0,n._)([(0,o.property)({json:{write:!0}})],h.prototype,"normalizationField",void 0),(0,n._)([(0,o.property)({json:{read:d.read,write:d.write}})],h.prototype,"normalizationType",void 0),(0,n._)([(0,o.property)({value:null,json:{write:!0}})],h.prototype,"standardDeviationInterval",null),(0,n._)([(0,o.property)({value:null,json:{write:!0}})],h.prototype,"definedInterval",null),h=(0,n._)([(0,l.subclass)("esri.rest.support.ClassBreaksDefinition")],h);const f=h})),t.register("hxmJW",(function(r,s){e(r.exports,"createGenerateRendererClassBreaks",(function(){return a}));const n=t("jHOLN").default.getLogger("esri.rest.support.generateRendererUtils");function i(e,t){return Number(e.toFixed(t))}function a(e){const{normalizationTotal:t}=e;return{classBreaks:o(e),normalizationTotal:t}}function o(e){var t;const r=e.definition,{classificationMethod:s,normalizationType:n,definedInterval:a}=r,o=null!==(t=r.breakCount)&&void 0!==t?t:1,h=[];let f=e.values;if(0===f.length)return[];f=f.sort(((e,t)=>e-t));const p=f[0],g=f[f.length-1];if("equal-interval"===s)if(f.length>=o){const e=(g-p)/o;let t=p;for(let r=1;r<o;r++){const s=i(p+r*e,6);h.push({minValue:t,maxValue:s,label:u(t,s,n)}),t=s}h.push({minValue:t,maxValue:g,label:u(t,g,n)})}else f.forEach((e=>{h.push({minValue:e,maxValue:e,label:u(e,e,n)})}));else if("natural-breaks"===s){const t=l(f),r=e.valueFrequency||t.valueFrequency,s=function(e,t,r){const s=e.length,n=[];r>s&&(r=s);for(let e=0;e<r;e++)n.push(Math.round(e*s/r-1));n.push(s-1);let i=c(n,e,t,r);return function(e,t,r,s,n,i){let a=0,o=0,u=0,l=0,c=!0;for(let h=0;h<2&&c;h++){0===h&&(c=!1);for(let h=0;h<i-1;h++)for(;r[h+1]+1!==r[h+2];){r[h+1]=r[h+1]+1;const i=d(h,r,s,n);u=i.sbMean,a=i.sbSdcm;const f=d(h+1,r,s,n);if(l=f.sbMean,o=f.sbSdcm,!(a+o<t[h]+t[h+1])){r[h+1]=r[h+1]-1;break}t[h]=a,t[h+1]=o,e[h]=u,e[h+1]=l,c=!0}for(let h=i-1;h>0;h--)for(;r[h]!==r[h-1]+1;){r[h]=r[h]-1;const i=d(h-1,r,s,n);u=i.sbMean,a=i.sbSdcm;const f=d(h,r,s,n);if(l=f.sbMean,o=f.sbSdcm,!(a+o<t[h-1]+t[h])){r[h]=r[h]+1;break}t[h-1]=a,t[h]=o,e[h-1]=u,e[h]=l,c=!0}}return c}(i.mean,i.sdcm,n,e,t,r)&&(i=c(n,e,t,r)),n}(t.uniqueValues,r,o);let a=p;for(let e=1;e<o;e++)if(t.uniqueValues.length>e){const r=i(t.uniqueValues[s[e]],6);h.push({minValue:a,maxValue:r,label:u(a,r,n)}),a=r}h.push({minValue:a,maxValue:g,label:u(a,g,n)})}else if("quantile"===s)if(f.length>=o&&p!==g){let e=p,t=Math.ceil(f.length/o),r=0;for(let s=1;s<o;s++){let i=t+r-1;i>f.length&&(i=f.length-1),i<0&&(i=0),h.push({minValue:e,maxValue:f[i],label:u(e,f[i],n)}),e=f[i],r+=t,t=Math.ceil((f.length-r)/(o-s))}h.push({minValue:e,maxValue:g,label:u(e,g,n)})}else{let e=-1;for(let t=0;t<f.length;t++){const r=f[t];r!==e&&(e=r,h.push({minValue:e,maxValue:r,label:u(e,r,n)}),e=r)}}else if("standard-deviation"===s){const e=function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/=e.length,t}(f),t=function(e,t){let r=0;for(let s=0;s<e.length;s++){const n=e[s];r+=(n-t)*(n-t)}return r/=e.length,Math.sqrt(r)}(f,e);if(0===t)h.push({minValue:f[0],maxValue:f[0],label:u(f[0],f[0],n)});else{const r=function(e,t,r,s,n){let i=Math.max(s-e,t-s)/n/r;return i=i>=1?1:i>=.5?.5:.25,i}(p,g,o,e,t)*t;let s=0,a=p;for(let t=o;t>=1;t--){const o=i(e-(t-.5)*r,6);h.push({minValue:a,maxValue:o,label:u(a,o,n)}),a=o,s++}let l=i(e+.5*r,6);h.push({minValue:a,maxValue:l,label:u(a,l,n)}),a=l,s++;for(let t=1;t<=o;t++)l=s===2*o?g:i(e+(t+.5)*r,6),h.push({minValue:a,maxValue:l,label:u(a,l,n)}),a=l,s++}}else if("defined-interval"===s){if(!a)return h;const e=f[0],t=f[f.length-1],r=Math.ceil((t-e)/a);let s=e;for(let t=1;t<r;t++){const r=i(e+t*a,6);h.push({minValue:s,maxValue:r,label:u(s,r,n)}),s=r}h.push({minValue:s,maxValue:t,label:u(s,t,n)})}return h}function u(e,t,r){let s=null;return s=e===t?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+t+"%":e+" - "+t,s}function l(e){const t=[],r=[];let s=Number.MIN_VALUE,n=1,i=-1;for(let a=0;a<e.length;a++){const o=e[a];o===s?(n++,r[i]=n):null!==o&&(t.push(o),s=o,n=1,r.push(n),i++)}return{uniqueValues:t,valueFrequency:r}}function c(e,t,r,s){let n=[],i=[],a=[],o=0;const u=[],l=[];for(let n=0;n<s;n++){const s=d(n,e,t,r);u.push(s.sbMean),l.push(s.sbSdcm),o+=l[n]}let c,h=o,f=!0;for(;f||o<h;){f=!1,n=[];for(let t=0;t<s;t++)n.push(e[t]);for(let r=0;r<s;r++)for(let n=e[r]+1;n<=e[r+1];n++)if(c=t[n],r>0&&n!==e[r+1]&&Math.abs(c-u[r])>Math.abs(c-u[r-1]))e[r]=n;else if(r<s-1&&e[r]!==n-1&&Math.abs(c-u[r])>Math.abs(c-u[r+1])){e[r+1]=n-1;break}h=o,o=0,i=[],a=[];for(let n=0;n<s;n++){i.push(u[n]),a.push(l[n]);const s=d(n,e,t,r);u[n]=s.sbMean,l[n]=s.sbSdcm,o+=l[n]}}if(o>h){for(let t=0;t<s;t++)e[t]=n[t],u[t]=i[t],l[t]=a[t];o=h}return{mean:u,sdcm:l}}function d(e,t,r,s){let i=0,a=0;for(let n=t[e]+1;n<=t[e+1];n++){const e=s[n];i+=r[n]*e,a+=e}a<=0&&n.warn("Exception in Natural Breaks calculation");const o=i/a;let u=0;for(let n=t[e]+1;n<=t[e+1];n++)u+=s[n]*(r[n]-o)**2;return{sbMean:o,sbSdcm:u}}})),t.register("8mTF7",(function(t,r){function s(e,t){return e?t?4:3:t?3:2}function n(e,t,r,n,c){if(null==t||!t.lengths.length)return null;const d="upperLeft"===(null==c?void 0:c.originPosition)?-1:1;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const h=e.coords,f=[],p=r?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:g,coords:m}=t,y=s(r,n);let _=0;for(const e of g){const t=i(p,m,_,e,r,n,d);t&&f.push(t),_+=e*y}if(f.sort(((e,t)=>{let s=d*e[2]-d*t[2];return 0===s&&r&&(s=e[4]-t[4]),s})),f.length){let e=6*f[0][2];h[0]=f[0][0]/e,h[1]=f[0][1]/e,r&&(e=6*f[0][4],h[2]=0!==e?f[0][3]/e:0),(h[0]<p[0]||h[0]>p[1]||h[1]<p[2]||h[1]>p[3]||r&&(h[2]<p[4]||h[2]>p[5]))&&(h.length=0)}if(!h.length){const e=t.lengths[0]?function(e,t,r,n,i){const c=s(n,i);let d=t,h=t+c,f=0,p=0,g=0,m=0;for(let t=0,s=r-1;t<s;t++,d+=c,h+=c){const t=e[d],r=e[d+1],s=e[d+2],i=e[h],c=e[h+1],y=e[h+2],_=n?o(t,r,s,i,c,y):a(t,r,i,c);if(_)if(f+=_,n){const e=l(t,r,s,i,c,y);p+=_*e[0],g+=_*e[1],m+=_*e[2]}else{const e=u(t,r,i,c);p+=_*e[0],g+=_*e[1]}}return f>0?n?[p/f,g/f,m/f]:[p/f,g/f]:r>0?n?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}(m,0,g[0],r,n):null;if(!e)return null;h[0]=e[0],h[1]=e[1],r&&e.length>2&&(h[2]=e[2])}return e}function i(e,t,r,n,i,a,o=1){const u=s(i,a);let l=r,c=r+u,d=0,h=0,f=0,p=0,g=0;for(let r=0,s=n-1;r<s;r++,l+=u,c+=u){const r=t[l],s=t[l+1],n=t[l+2],a=t[c],o=t[c+1],u=t[c+2];let m=r*o-a*s;p+=m,d+=(r+a)*m,h+=(s+o)*m,i&&(m=r*u-a*n,f+=(n+u)*m,g+=m),r<e[0]&&(e[0]=r),r>e[1]&&(e[1]=r),s<e[2]&&(e[2]=s),s>e[3]&&(e[3]=s),i&&(n<e[4]&&(e[4]=n),n>e[5]&&(e[5]=n))}if(p*o>0&&(p*=-1),g*o>0&&(g*=-1),!p)return null;const m=[d,h,.5*p];return i&&(m[3]=f,m[4]=.5*g),m}function a(e,t,r,s){const n=r-e,i=s-t;return Math.sqrt(n*n+i*i)}function o(e,t,r,s,n,i){const a=s-e,o=n-t,u=i-r;return Math.sqrt(a*a+o*o+u*u)}function u(e,t,r,s){return[e+.5*(r-e),t+.5*(s-t)]}function l(e,t,r,s,n,i){return[e+.5*(s-e),t+.5*(n-t),r+.5*(i-r)]}e(t.exports,"getCentroidOptimizedGeometry",(function(){return n}))})),t.register("emniL",(function(r,s){e(r.exports,"QUERY_ENGINE_EMPTY_RESULT",(function(){return g})),e(r.exports,"transformCentroid",(function(){return I})),e(r.exports,"getGeometry",(function(){return S})),e(r.exports,"normalizeQuery",(function(){return x})),e(r.exports,"normalizeQueryLike",(function(){return b})),e(r.exports,"cleanFromGeometryEngine",(function(){return w}));var n=t("79ASa"),i=t("5vzSQ"),a=t("7RvA5"),o=t("jxYOa"),u=t("79LpT"),l=t("5On35"),c=t("eY5Yp"),d=t("akQYU"),h=t("awxBI"),f=t("fP7bp");const p=new(0,n.JSONMap)({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),g=Object.freeze({}),m=new(0,h.default),y=new(0,h.default),_=new(0,h.default),v={esriGeometryPoint:d.convertToPoint,esriGeometryPolyline:d.convertToPolyline,esriGeometryPolygon:d.convertToPolygon,esriGeometryMultipoint:d.convertToMultipoint};function I(e,t,r,s=e.hasZ,n=e.hasM){if(null==t)return null;const i=e.hasZ&&s,a=e.hasM&&n;if(r){const o=(0,d.quantizeOptimizedGeometry)(_,t,e.hasZ,e.hasM,"esriGeometryPoint",r,s,n);return(0,d.convertToPoint)(o,i,a)}return(0,d.convertToPoint)(t,i,a)}function S(e,t,r,s,n,i,a=t,o=r){var u;const l=t&&a,c=r&&o,h=null!=s?"coords"in s?s:s.geometry:null;if(null==h)return null;if(n){var f;let s=(0,d.generalizeOptimizedGeometry)(y,h,t,r,e,n,a,o);var p;return i&&(s=(0,d.quantizeOptimizedGeometry)(_,s,l,c,e,i)),null!==(p=null===(f=v[e])||void 0===f?void 0:f.call(v,s,l,c))&&void 0!==p?p:null}if(i){var g;const s=(0,d.quantizeOptimizedGeometry)(_,h,t,r,e,i,a,o);var I;return null!==(I=null===(g=v[e])||void 0===g?void 0:g.call(v,s,l,c))&&void 0!==I?I:null}var S;return(0,d.removeZMValues)(m,h,t,r,a,o),null!==(S=null===(u=v[e])||void 0===u?void 0:u.call(v,m,l,c))&&void 0!==S?S:null}async function x(e,t,r){const{outFields:s,orderByFields:n,groupByFieldsForStatistics:i,outStatistics:a}=e;if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(a)for(let e=0;e<a.length;e++)a[e].onStatisticField&&(a[e].onStatisticField=a[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),b(e,t,r)}async function b(e,r,s){if(!e)return null;let{where:n}=e;if(e.where=n=n&&n.trim(),(!n||/^1 *= *1$/.test(n)||r&&r===n)&&(e.where=null),!e.geometry)return e;let a=await async function(e){const{distance:r,units:s}=e,n=e.geometry;if(null==r||"vertexAttributes"in n)return n;const a=n.spatialReference,o=s?p.fromJSON(s):(0,i.getUnitString)(a),u=a&&((0,c.isGeographic)(a)||(0,c.isWebMercator)(a))?n:await(0,f.checkProjectionSupport)(a,c.WGS84).then((()=>(0,f.project)(n,c.WGS84)));return(await async function(){return(await t("9AvTl")).geodesicBuffer}())(u.spatialReference,u,r,o)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;a=(0,o.getGeometryExtent)(a),a.spatialReference=t}if(a){var d;await(0,f.checkProjectionSupport)(a.spatialReference,s),a=function(e,t){const r=e.spatialReference;return T(e,t)&&(0,u.isExtent)(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(a,s);const t=(await(0,l.normalizeCentralMeridian)((0,u.fromJSON)(a)))[0];if(null==t)throw g;const r="quantizationParameters"in e&&(null===(d=e.quantizationParameters)||void 0===d?void 0:d.tolerance)||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,n=r&&T(a,s)?{densificationStep:8*r}:void 0,i=t.toJSON(),o=await(0,f.project)(i,i.spatialReference,s,n);if(!o)throw g;o.spatialReference=s,e.geometry=o}return e}function T(e,t){if(!e)return!1;const r=e.spatialReference;return((0,u.isExtent)(e)||(0,u.isPolygon)(e)||(0,u.isPolyline)(e))&&!(0,c.equals)(r,t)&&!(0,a.canProjectWithoutEngine)(r,t)}function w(e){return e&&F in e?JSON.parse(JSON.stringify(e,E)):e}const F="_geVersion",E=(e,t)=>e!==F?t:void 0})),t.register("9AvTl",(function(e,r){e.exports=Promise.all([t("4WKyX")(t("aNJCr").getBundleURL("b3gJV")+t("iE7OH").resolve("9ESom")),t("4WKyX")(t("aNJCr").getBundleURL("b3gJV")+t("iE7OH").resolve("vg0wl"))]).then((()=>t("1n9JK")))})),t.register("iNIOS",(function(r,s){e(r.exports,"getSpatialQueryOperator",(function(){return v})),e(r.exports,"checkSpatialQuerySupport",(function(){return I})),e(r.exports,"canQueryWithRBush",(function(){return S}));var n=t("kyj08"),i=t("8Iadx"),a=t("1ILI6"),o=t("79LpT"),u=t("eY5Yp"),l=t("4idof"),c=t("akQYU"),d=t("awxBI"),h=t("fP7bp"),f=t("emniL");const p="feature-store:unsupported-query",g={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},m={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},y={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},_={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function v(e,r,s,n,u){if((0,o.isPolygon)(r)&&"esriGeometryPoint"===s&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=(0,c.convertFromPolygon)(new(0,d.default),r,!1,!1);return Promise.resolve((t=>(0,l.polygonContainsPoint)(e,!1,!1,t)))}if((0,o.isPolygon)(r)&&"esriGeometryMultipoint"===s){const t=(0,c.convertFromPolygon)(new(0,d.default),r,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>(0,l.polygonContainsMultipoint)(t,!1,!1,e,n,u)))}if((0,o.isExtent)(r)&&"esriGeometryPoint"===s&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>(0,i.extentContainsPoint)(r,(0,f.getGeometry)(s,n,u,e))));if((0,o.isExtent)(r)&&"esriGeometryMultipoint"===s&&"esriSpatialRelContains"===e)return Promise.resolve((e=>(0,i.extentContainsMultipoint)(r,(0,f.getGeometry)(s,n,u,e))));if((0,o.isExtent)(r)&&"esriSpatialRelIntersects"===e){const e=(0,a.getExtentIntersector)(s);return Promise.resolve((t=>e(r,(0,f.getGeometry)(s,n,u,t))))}return t("9AvTl").then((t=>{const i=t[g[e]].bind(null,r.spatialReference,r);return e=>i((0,f.getGeometry)(s,n,u,e))}))}async function I(e,t,r){const{spatialRel:s,geometry:i}=e;if(i){if(null==(a=s)||!0!==m[a])throw new(0,n.default)(p,"Unsupported query spatial relationship",{query:e});if((0,u.isValid)(i.spatialReference)&&(0,u.isValid)(r)){if(!function(e){return null!=e&&!0===y[(0,o.getJsonType)(e)]}(i))throw new(0,n.default)(p,"Unsupported query geometry type",{query:e});if(!function(e){return null!=e&&!0===_[e]}(t))throw new(0,n.default)(p,"Unsupported layer geometry type",{query:e});if(e.outSR)return(0,h.checkProjectionSupport)(e.geometry&&e.geometry.spatialReference,e.outSR)}}var a}function S(e){if((0,o.isExtent)(e))return!0;if((0,o.isPolygon)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}})),t.register("1ILI6",(function(r,s){e(r.exports,"getExtentIntersector",(function(){return i}));var n=t("80GBQ");n=t("80GBQ");function i(e){return"mesh"===e?n.extentIntersectsExtent:(0,n.getFeatureExtentIntersector)(e)}})),t.register("4idof",(function(t,r){function s(e,t){return e?t?4:3:t?3:2}function n(e,t,r,s){return a(e,t,r,s.coords[0],s.coords[1])}function i(e,t,r,n,i,o){const u=s(i,o),{coords:l,lengths:c}=n;if(!c)return!1;for(let s=0,n=0;s<c.length;s++,n+=u)if(!a(e,t,r,l[n],l[n+1]))return!1;return!0}function a(e,t,r,n,i){if(!e)return!1;const a=s(t,r),{coords:u,lengths:l}=e;let c=!1,d=0;for(const e of l)c=o(c,u,a,d,e,n,i),d+=e*a;return c}function o(e,t,r,s,n,i,a){let o=e,u=s;for(let e=s,l=s+n*r;e<l;e+=r){u=e+r,u===l&&(u=s);const n=t[e],c=t[e+1],d=t[u],h=t[u+1];(c<a&&h>=a||h<a&&c>=a)&&n+(a-c)/(h-c)*(d-n)<i&&(o=!o)}return o}e(t.exports,"polygonContainsPoint",(function(){return n})),e(t.exports,"polygonContainsMultipoint",(function(){return i}))})),t.register("17eId",(function(t,r){async function s(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:s,endTimeField:n}=e;let i=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(s&&n)await t.forEach((e=>{const t=r.getAttribute(e,s),o=r.getAttribute(e,n);null==t||isNaN(t)||(i=Math.min(i,t)),null==o||isNaN(o)||(a=Math.max(a,o))}));else{const e=s||n;await t.forEach((t=>{const s=r.getAttribute(t,e);null==s||isNaN(s)||(i=Math.min(i,s),a=Math.max(a,s))}))}return{start:i,end:a}}function n(e,t,r){if(!t||!e)return null;const{startTimeField:s,endTimeField:n}=e;if(!s&&!n)return null;const{start:i,end:a}=t;return null===i&&null===a?null:void 0===i&&void 0===a?()=>!1:s&&n?function(e,t,r,s,n){return null!=s&&null!=n?i=>{const a=e.getAttribute(i,t),o=e.getAttribute(i,r);return(null==a||a<=n)&&(null==o||o>=s)}:null!=s?t=>{const n=e.getAttribute(t,r);return null==n||n>=s}:null!=n?r=>{const s=e.getAttribute(r,t);return null==s||s<=n}:void 0}(r,s,n,i,a):function(e,t,r,s){return null!=r&&null!=s&&r===s?s=>e.getAttribute(s,t)===r:null!=r&&null!=s?n=>{const i=e.getAttribute(n,t);return i>=r&&i<=s}:null!=r?s=>e.getAttribute(s,t)>=r:null!=s?r=>e.getAttribute(r,t)<=s:void 0}(r,s||n,i,a)}e(t.exports,"getTimeExtent",(function(){return s})),e(t.exports,"getTimeOperator",(function(){return n}))})),t.register("6Gukk",(function(t,r){e(t.exports,"createDebugLogger",(function(){return s})),e(t.exports,"DEBUG_ATTR_UPDATES",(function(){return n}));const s=(e,t)=>e&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),n=!1})),t.register("1Fs6Q",(function(r,s){e(r.exports,"getVisualVariableSizeValueRepresentationRatio",(function(){return l})),e(r.exports,"convertVisualVariables",(function(){return f}));var n=t("iXlXu"),i=t("hUDEJ"),a=t("4WoSm"),o=t("66IJZ"),u=t("2VOK9");function l(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}function c(e){return(null!=e?e:[]).map((e=>{return{value:(t=e).value,size:(0,n.toPt)(t.size)};var t}))}function d(e){if("string"==typeof e||"number"==typeof e)return(0,n.toPt)(e);const t=e;return{type:"size",expression:t.expression,stops:c(t.stops)}}const h=e=>{const t=[],r=[],s=c(e),i=s.length;for(let e=0;e<6;e++){const o=s[Math.min(e,i-1)];t.push(o.value),r.push(null==o.size?a.NAN_MAGIC_NUMBER:(0,n.pt2px)(o.size))}return{values:new Float32Array(t),sizes:new Float32Array(r)}};function f(e){const t=e&&e.length>0?{}:null,r=t?{}:null;if(!t||!r)return{vvFields:t,vvRanges:r};for(const n of e)if(n.field&&(t[n.type]=n.field),"size"===n.type){r.size||(r.size={});const e=n;switch((0,u.getTypeOfSizeVisualVariable)(e)){case o.WGLVVFlag.SIZE_MINMAX_VALUE:r.size.minMaxValue={minDataValue:e.minDataValue,maxDataValue:e.maxDataValue,minSize:d(e.minSize),maxSize:d(e.maxSize)};break;case o.WGLVVFlag.SIZE_SCALE_STOPS:r.size.scaleStops={stops:c(e.stops)};break;case o.WGLVVFlag.SIZE_FIELD_STOPS:if(e.levels){const t={};for(const r in e.levels)t[r]=h(e.levels[r]);r.size.fieldStops={type:"level-dependent",levels:t}}else r.size.fieldStops={type:"static",...h(e.stops)};break;case o.WGLVVFlag.SIZE_UNIT_VALUE:var s;r.size.unitValue={unit:e.valueUnit,valueRepresentation:null!==(s=e.valueRepresentation)&&void 0!==s?s:void 0}}}else if("color"===n.type)r.color=m(n);else if("opacity"===n.type)r.opacity=p(n);else if("rotation"===n.type){const e=n;r.rotation={type:e.rotationType}}return{vvFields:t,vvRanges:r}}function p(e){const t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;const r=e.stops;for(let e=0;e<8;++e){const s=r[Math.min(e,r.length-1)];t.values[e]=s.value,t.opacities[e]=s.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const r=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;for(let e=0;e<8;e++)t.values[e]=1/0,t.opacities[e]=r}}return t}function g(e,t,r){e[4*t]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function m(e){if(null==e)return null;if(e.normalizationField)return null;const t={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof e.field){if(!e.stops)return null;{if(e.stops.length>8)return null;t.field=e.field;const r=e.stops;for(let e=0;e<8;++e){const s=r[Math.min(e,r.length-1)];t.values[e]=s.value,g(t.colors,e,s.color)}}}else{if(!(e.stops&&e.stops.length>=0))return null;{const r=e.stops&&e.stops.length>=0&&e.stops[0].color;for(let e=0;e<8;e++)t.values[e]=1/0,g(t.colors,e,r)}}for(let e=0;e<32;e+=4)(0,i.premultiplyAlpha)(t.colors,e,!0);return t}})),t.register("hUDEJ",(function(r,s){e(r.exports,"premultiplyAlpha",(function(){return i})),e(r.exports,"premultiplyAlphaRGBA",(function(){return a})),e(r.exports,"premultiplyAlphaRGBAArray",(function(){return o})),e(r.exports,"writeColor",(function(){return u}));var n=t("8lbQw");function i(e,t=0,r=!1){const s=e[t+3];return e[t]*=s,e[t+1]*=s,e[t+2]*=s,r||(e[t+3]*=255),e}function a(e){if(!e)return 0;const{r:t,g:r,b:s,a:i}=e;return(0,n.i8888to32)(t*i,r*i,s*i,255*i)}function o(e){if(!e)return 0;const[t,r,s,i]=e;return(0,n.i8888to32)(t*(i/255),r*(i/255),s*(i/255),i)}function u(e,t,r=0){if(null==t)return e[r]=0,e[r+1]=0,e[r+2]=0,void(e[r+3]=0);const{r:s,g:n,b:i,a:a}=t;e[r]=s*a/255,e[r+1]=n*a/255,e[r+2]=i*a/255,e[r+3]=a}})),t.register("8lbQw",(function(t,r){e(t.exports,"u32to4Xu8",(function(){return n})),e(t.exports,"i1616to32",(function(){return i})),e(t.exports,"i8888to32",(function(){return a}));const s=new Float32Array(1);new Uint32Array(s.buffer);function n(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function i(e,t){return 65535&e|t<<16}function a(e,t,r,s){return 255&e|(255&t)<<8|(255&r)<<16|s<<24}})),t.register("66IJZ",(function(t,r){var s,n,i,a,o,u,l,c;e(t.exports,"WGLGeometryType",(function(){return s})),e(t.exports,"WGLDrawPhase",(function(){return n})),e(t.exports,"VVType",(function(){return i})),e(t.exports,"WGLVVFlag",(function(){return a})),e(t.exports,"WGLVVTarget",(function(){return o})),e(t.exports,"MosaicType",(function(){return u})),e(t.exports,"WGLSymbologyType",(function(){return l})),(c=s||(s={}))[c.FILL=0]="FILL",c[c.LINE=1]="LINE",c[c.MARKER=2]="MARKER",c[c.TEXT=3]="TEXT",c[c.LABEL=4]="LABEL",function(e){e[e.NONE=0]="NONE",e[e.MAP=1]="MAP",e[e.LABEL=2]="LABEL",e[e.LABEL_ALPHA=4]="LABEL_ALPHA",e[e.HITTEST=8]="HITTEST",e[e.HIGHLIGHT=16]="HIGHLIGHT",e[e.CLIP=32]="CLIP",e[e.DEBUG=64]="DEBUG",e[e.NUM_DRAW_PHASES=9]="NUM_DRAW_PHASES"}(n||(n={})),function(e){e[e.SIZE=0]="SIZE",e[e.COLOR=1]="COLOR",e[e.OPACITY=2]="OPACITY",e[e.ROTATION=3]="ROTATION"}(i||(i={})),function(e){e[e.NONE=0]="NONE",e[e.OPACITY=1]="OPACITY",e[e.COLOR=2]="COLOR",e[e.ROTATION=4]="ROTATION",e[e.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE",e[e.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS",e[e.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS",e[e.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"}(a||(a={})),function(e){e[e.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE",e[e.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE",e[e.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE",e[e.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"}(o||(o={})),function(e){e[e.SPRITE=0]="SPRITE",e[e.GLYPH=1]="GLYPH"}(u||(u={})),function(e){e[e.DEFAULT=0]="DEFAULT",e[e.SIMPLE=1]="SIMPLE",e[e.DOT_DENSITY=2]="DOT_DENSITY",e[e.OUTLINE_FILL=3]="OUTLINE_FILL",e[e.OUTLINE_FILL_SIMPLE=4]="OUTLINE_FILL_SIMPLE",e[e.HEATMAP=5]="HEATMAP",e[e.PIE_CHART=6]="PIE_CHART"}(l||(l={}))})),t.register("2VOK9",(function(r,s){e(r.exports,"getTypeOfSizeVisualVariable",(function(){return u}));var n=t("kyj08"),i=t("jHOLN"),a=t("66IJZ"),o=t("5WctK");function u(e){return(0,o.isNumber)(e.minDataValue)&&(0,o.isNumber)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?a.WGLVVFlag.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?a.WGLVVFlag.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?a.WGLVVFlag.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?a.WGLVVFlag.SIZE_UNIT_VALUE:(i.default.getLogger("esri.views.2d.engine.webgl").error(new(0,n.default)("mapview-bad-type","Found invalid size VisualVariable",e)),a.WGLVVFlag.NONE)}})),t.register("5WctK",(function(r,s){e(r.exports,"getStrides",(function(){return A})),e(r.exports,"strideToPackingFactor",(function(){return D})),e(r.exports,"allocateTypedArrayBuffer",(function(){return k})),e(r.exports,"allocateTypedArrayBufferwithData",(function(){return P})),e(r.exports,"isDefined",(function(){return G})),e(r.exports,"isNumber",(function(){return U})),e(r.exports,"getCapType",(function(){return z})),e(r.exports,"getJoinType",(function(){return q})),e(r.exports,"getVVType",(function(){return V})),e(r.exports,"copyMeshData",(function(){return j})),e(r.exports,"C_VBO_INFO",(function(){return B})),e(r.exports,"createGeometryData",(function(){return Q})),e(r.exports,"getPixelBytes",(function(){return Y})),e(r.exports,"getPixelArrayCtor",(function(){return W})),e(r.exports,"createProgramDescriptor",(function(){return $})),e(r.exports,"forEachGeometryType",(function(){return K})),e(r.exports,"isSVGResource",(function(){return ee})),e(r.exports,"isImageResource",(function(){return te})),e(r.exports,"getUrl",(function(){return re})),e(r.exports,"isGIF",(function(){return ne})),e(r.exports,"isPNG",(function(){return ae})),e(r.exports,"is3D",(function(){return oe})),e(r.exports,"isSimple",(function(){return ue})),e(r.exports,"isSVGImage",(function(){return le})),e(r.exports,"shouldRepeat",(function(){return ce})),e(r.exports,"isMarkerPlacementInsidePolygon",(function(){return pe})),e(r.exports,"getPMSResourceSize",(function(){return de})),e(r.exports,"charCodes",(function(){return he}));var n=t("kyj08"),i=t("jHOLN"),a=t("6LoaD"),o=t("66IJZ"),u=t("8JzMA"),l=t("LW1Aq");const c=i.default.getLogger("esri.views.2d.engine.webgl.Utils"),d="geometry",h=[{name:d,strideInBytes:12}],f=[{name:d,strideInBytes:36}],p=[{name:d,strideInBytes:24}],g=[{name:d,strideInBytes:12}],m=[{name:d,strideInBytes:40}],y=[{name:d,strideInBytes:36}],_=[{name:d,strideInBytes:36}];function v(e){const t={};for(const r of e)t[r.name]=r.strideInBytes;return t}const I=v([{name:d,strideInBytes:36}]),S=v(h),x=v(f),b=v(p),T=v(g),w=v(m),F=v(y),E=v(_);function A(e,t){switch(e){case o.WGLGeometryType.MARKER:return t===o.WGLSymbologyType.HEATMAP?S:I;case o.WGLGeometryType.FILL:switch(t){case o.WGLSymbologyType.DOT_DENSITY:return T;case o.WGLSymbologyType.SIMPLE:case o.WGLSymbologyType.OUTLINE_FILL_SIMPLE:return b;default:return x}case o.WGLGeometryType.LINE:return w;case o.WGLGeometryType.TEXT:return F;case o.WGLGeometryType.LABEL:return E}}const M=[d],C=[d],R=[d],O=[d],L=[d];function N(e){switch(e){case o.WGLGeometryType.MARKER:return M;case o.WGLGeometryType.FILL:return C;case o.WGLGeometryType.LINE:return R;case o.WGLGeometryType.TEXT:return O;case o.WGLGeometryType.LABEL:return L}}function D(e){switch(e%4){case 0:case 2:return 4;case 1:case 3:return 1}}function k(e,t){switch(t%4){case 0:case 2:return new Uint32Array(Math.floor(e*t/4));case 1:case 3:return new Uint8Array(e*t)}}function P(e,t){switch(t%4){case 0:case 2:return new Uint32Array(e);case 1:case 3:return new Uint8Array(e)}}function G(e){return null!=e}function U(e){return"number"==typeof e}function z(e){switch(e){case"butt":return a.CapType.BUTT;case"round":return a.CapType.ROUND;case"square":return a.CapType.SQUARE;default:return c.error(new(0,n.default)("mapview-invalid-type",`Cap type ${e} is not a valid option. Defaulting to round`)),a.CapType.ROUND}}function q(e){switch(e){case"miter":return a.JoinType.MITER;case"bevel":return a.JoinType.BEVEL;case"round":return a.JoinType.ROUND;default:return c.error(new(0,n.default)("mapview-invalid-type",`Join type ${e} is not a valid option. Defaulting to round`)),a.JoinType.ROUND}}function V(e){switch(e){case"opacity":return o.VVType.OPACITY;case"color":return o.VVType.COLOR;case"rotation":return o.VVType.ROTATION;case"size":return o.VVType.SIZE;default:return c.error(`Cannot interpret unknown vv: ${e}`),null}}function j(e,t,r,s,n,i,a){for(const t in i){const s=i[t].stride,a=D(s),o=i[t].data,u=r[t].data;if(null==o||null==u)continue;const l=s*n.vertexCount/a,c=s*e/a,d=s*n.vertexFrom/a;for(let e=0;e<l;++e)u[e+c]=o[e+d]}if(null!=a&&null!=s){const r=n.indexCount;for(let i=0;i<r;++i)s[i+t]=a[i+n.indexFrom]-n.vertexFrom+e}}const B={[d]:u.Usage.STATIC_DRAW};function Q(e,t){const r=[];for(let s=0;s<5;++s){const n=N(s),i={};for(const e of n)i[e]={data:t(s,e)};r.push({data:e(s),buffers:i})}return r}function Z(e){switch(e){case u.DataType.BYTE:case u.DataType.UNSIGNED_BYTE:return 1;case u.DataType.SHORT:case u.DataType.UNSIGNED_SHORT:return 2;case u.DataType.FLOAT:case u.DataType.INT:case u.DataType.UNSIGNED_INT:return 4}}function Y(e){switch(e){case u.PixelType.UNSIGNED_BYTE:return 1;case u.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case u.PixelType.FLOAT:return 4;default:return void c.error(new(0,n.default)("webgl-utils",`Unable to handle type ${e}`))}}function W(e){switch(e){case u.PixelType.UNSIGNED_BYTE:return Uint8Array;case u.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case u.PixelType.FLOAT:return Float32Array;default:return void c.error(new(0,n.default)("webgl-utils",`Unable to handle type ${e}`))}}const J=e=>{const t=new Map;for(const r in e)for(const s of e[r])t.set(s.name,s.location);return t},H=e=>{const t={};for(const r in e){const s=e[r];t[r]=(null==s?void 0:s.length)?s[0].stride:0}return t},X=new Map,$=(e,t)=>{if(!X.has(e)){const r=function(e){const t={};for(const s in e){var r;const n=e[s];let i=0;t[s]=n.map((e=>{const t=new(0,l.VertexElementDescriptor)(e.name,e.count,e.type,i,0,e.normalized||!1);return i+=e.count*Z(e.type),t})),null===(r=t[s])||void 0===r||r.forEach((e=>e.stride=i))}return t}(t),s={strides:H(r),bufferLayouts:r,attributes:J(t)};X.set(e,s)}return X.get(e)};function K(e){e(o.WGLGeometryType.FILL),e(o.WGLGeometryType.LINE),e(o.WGLGeometryType.MARKER),e(o.WGLGeometryType.TEXT),e(o.WGLGeometryType.LABEL)}const ee=e=>"path"in e&&fe(e.path),te=e=>"url"in e&&e.url||"imageData"in e&&e.imageData,re=e=>"imageData"in e&&e.imageData&&"contentType"in e&&e.contentType?`data:${e.contentType};base64,${e.imageData}`:"url"in e?e.url:null,se=e=>null!=e&&e.startsWith("data:image/gif"),ne=e=>"url"in e&&e.url&&(e.url.includes(".gif")||se(e.url))||"contentType"in e&&"image/gif"===e.contentType||"imageData"in e&&se(e.imageData),ie=e=>null!=e&&e.startsWith("data:image/png"),ae=e=>"url"in e&&e.url&&(e.url.includes(".png")||ie(e.url))||"contentType"in e&&"image/png"===e.contentType||"imageData"in e&&ie(e.imageData),oe=e=>e.type&&e.type.toLowerCase().includes("3d");function ue(e){switch(e.type){case"line":{const t=e;return"CIMSolidStroke"===t.cim.type&&!t.dashTemplate}case"fill":return"CIMSolidFill"===e.cim.type;case"esriSFS":return"esriSFSSolid"===e.style||"esriSFSNull"===e.style;case"esriSLS":return"esriSLSSolid"===e.style||"esriSLSNull"===e.style;default:return!1}}const le=e=>e.includes("data:image/svg+xml");function ce(e){switch("cim"in e?e.cim.type:e.type){case"esriSMS":case"esriPMS":case"CIMPointSymbol":return!1;case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":return pe(e);default:return!0}}function de(e){const t="maxVVSize"in e&&e.maxVVSize,r="width"in e&&e.width||"size"in e&&e.size||0;return t||r}function he(e){const t=[];for(let r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t}const fe=e=>!!e&&(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4)),pe=e=>{var t,r;return"fill"===e.type&&"CIMMarkerPlacementInsidePolygon"===(null==e||null===(t=e.cim)||void 0===t||null===(r=t.markerPlacement)||void 0===r?void 0:r.type)}}))}();
//# sourceMappingURL=Pipeline.c0082567.js.map
