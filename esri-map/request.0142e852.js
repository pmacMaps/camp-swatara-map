var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;e.register("bYA0c",(function(t,r){var o,s,n,a,i;o=t.exports,Object.defineProperty(o,"__esModule",{value:!0,configurable:!0}),s=t.exports,n="default",a=function(){return w},Object.defineProperty(s,n,{get:a,set:i,enumerable:!0,configurable:!0});var l=e("9XPDd"),u=e("1mmm2"),d=e("bPmsI"),c=e("5HTPH"),p=e("itGIg"),f=e("1CpCt"),h=e("lHg4e"),m=e("7dRCe"),y=e("dVr8I"),g=e("jdQTA");async function w(t,r){var o;const s=(0,m.isDataProtocol)(t),n=(0,m.isBlobProtocol)(t);n||s||(t=(0,m.normalize)(t));const a={url:t,requestOptions:{...(0,f.unwrap)(r)}};let i=(0,m.getInterceptor)(t);if(i){const e=await async function(e,t){if(null!=e.responseData)return e.responseData;if(e.headers&&(t.requestOptions.headers={...t.requestOptions.headers,...e.headers}),e.query&&(t.requestOptions.query={...t.requestOptions.query,...e.query}),e.before){let r,o;try{o=await e.before(t)}catch(e){r=E("request:interceptor",e,t)}if((o instanceof Error||o instanceof d.default)&&(r=E("request:interceptor",o,t)),r)throw e.error&&e.error(r),r;return o}}(i,a);if(null!=e)return{data:e,getHeader:S,requestOptions:a.requestOptions,url:a.url};i.after||i.error||(i=null)}if(t=a.url,"image"===(r=a.requestOptions).responseType){if((0,c.default)("host-webworker")||(0,c.default)("host-node"))throw E("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),a)}else if(s)throw E("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+r.responseType),a);if("head"===r.method){if(r.body)throw E("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),a);if(s||n)throw E("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),a)}if(await async function(){(0,c.default)("host-webworker")?b||(b=await e("ct6jF")):w._abortableFetch||(w._abortableFetch=globalThis.fetch.bind(globalThis))}(),b)return b.execute(t,r);const p=new AbortController;(0,h.onAbort)(r,(()=>p.abort()));const g={controller:p,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:i,params:a,redoRequest:!1,useIdentity:T.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},O=await async function(e){var t,r;let o,s;await async function(e){const t=e.params.url,r=e.params.requestOptions,o=e.controller.signal,s=r.body;let n=null,a=null,i=null;if(q&&"HTMLFormElement"in globalThis&&(s instanceof FormData?n=s:s instanceof HTMLFormElement&&(a=s,n=new FormData(a))),"string"==typeof s&&(i=s),e.fetchOptions={cache:r.cacheBust&&!w._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:"head"===r.method?"HEAD":"GET",mode:"cors",redirect:"follow",signal:o},(n||i)&&(e.fetchOptions.body=n||i),"anonymous"===r.authMode&&(e.useIdentity=!1),e.hasToken=!!(/token=/i.test(t)||r.query&&r.query.token||n&&n.get&&n.get("token")||a&&a.elements.token),!e.hasToken&&l.default.apiKey&&(0,y.supportsApiKey)(t)&&(r.query||(r.query={}),r.query.token=l.default.apiKey,e.hasToken=!0),e.useIdentity&&!e.hasToken&&!e.credentialToken&&!L(t)&&!(0,h.isAborted)(o)){let s;"immediate"===r.authMode?(await P(),s=await u.id.getCredential(t,{signal:o}),e.credential=s):"no-prompt"===r.authMode?(await P(),s=await u.id.getCredential(t,{prompt:!1,signal:o}).catch((()=>{})),e.credential=s):u.id&&(s=u.id.findCredential(t)),s&&(e.credentialToken=s.token,e.useSSL=!!s.ssl)}}(e);try{do{[o,s]=await D(e)}while(!await j(e,o,s))}catch(t){const r=E("request:server",t,e.params,o);throw r.details.ssl=e.useSSL,e.interceptor&&e.interceptor.error&&e.interceptor.error(r),r}const n=e.params.url;if(/\/sharing\/rest\/(accounts|portals)\/self/i.test(n)&&!e.hasToken&&!e.credentialToken&&null!=(t=s)&&null!=(r=t.user)&&r.username&&!(0,m.isTrustedServer)(n)){const e=(0,m.getOrigin)(n,!0);e&&T.trustedServers.push(e)}const a=e.credential;if(a&&u.id){const e=u.id.findServerInfo(a.server);let t=e&&e.owningSystemUrl;if(t){t=t.replace(/\/?$/,"/sharing");const e=u.id.findCredential(t,a.userId);e&&-1===u.id._getIdenticalSvcIdx(t,e)&&e.resources.unshift(t)}}return{data:s,getHeader:o?e=>o.headers.get(e):S,requestOptions:e.params.requestOptions,ssl:e.useSSL,url:e.params.url}}(g);return null==(o=i)||null==o.after||o.after(O),O}let b;const T=l.default.request,q="FormData"in globalThis,O=[499,498,403,401],k=["COM_0056","COM_0057","SB_0008"],x=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],S=()=>null,v=Symbol();function C(e){const t=(0,m.getOrigin)(e);return!t||t.endsWith(".arcgis.com")||w._corsServers.includes(t)||(0,m.isTrustedServer)(t)}function E(e,t,r,o){let s="Error";const n={url:r.url,requestOptions:r.requestOptions,getHeader:S,ssl:!1};if(t instanceof d.default)return t.details?(t.details=(0,p.clone)(t.details),t.details.url=r.url,t.details.requestOptions=r.requestOptions):t.details=n,t;if(t){const e=o&&(e=>o.headers.get(e)),r=o&&o.status,a=t.message;a&&(s=a),e&&(n.getHeader=e),n.httpStatus=(null!=t.httpCode?t.httpCode:t.code)||r||0,n.subCode=t.subcode,n.messageCode=t.messageCode,"string"==typeof t.details?n.messages=[t.details]:n.messages=t.details,n.raw=v in t?t[v]:t}return(0,h.isAbortError)(t)?(0,h.createAbortError)():new(0,d.default)(e,s,n)}async function P(){u.id||await e("7DxjT")}function L(e){return x.some((t=>t.test(e)))}async function D(e){let t=e.params.url;const r=e.params.requestOptions,o=e.fetchOptions,s=(0,m.isBlobProtocol)(t)||(0,m.isDataProtocol)(t),n=r.responseType||"json",a=s?0:null!=r.timeout?r.timeout:T.timeout;let i=!1;if(!s){e.useSSL&&(t=(0,m.toHTTPS)(t)),r.cacheBust&&"default"===o.cache&&(t=(0,m.addQueryParameter)(t,"request.preventCache",Date.now()));let s={...r.query};e.credentialToken&&(s.token=e.credentialToken);let n=(0,m.objectToQuery)(s);(0,c.default)("esri-url-encodes-apostrophe")&&(n=n.replace(/'/g,"%27"));const a=t.length+1+n.length;let l;i="delete"===r.method||"post"===r.method||"put"===r.method||!!r.body||a>T.maxUrlLength;const d=r.useProxy||!!(0,m.getProxyRule)(t);if(d){const e=(0,m.getProxyUrl)(t);l=e.path,!i&&l.length+1+a>T.maxUrlLength&&(i=!0),e.query&&(s={...e.query,...s})}if("HEAD"===o.method&&(i||d)){if(i){if(a>T.maxUrlLength)throw E("request:invalid-parameters",new Error("URL exceeds maximum length"),e.params);throw E("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),e.params)}if(d)throw E("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),e.params)}if(i?(o.method="delete"===r.method?"DELETE":"put"===r.method?"PUT":"POST",r.body?t=(0,m.addQueryParameters)(t,s):(o.body=(0,m.objectToQuery)(s),o.headers["Content-Type"]="application/x-www-form-urlencoded")):t=(0,m.addQueryParameters)(t,s),d&&(e.useProxy=!0,t=`${l}?${t}`),s.token&&q&&o.body instanceof FormData){const e=o.body;e.set?e.set("token",s.token):e.append("token",s.token)}if(r.hasOwnProperty("withCredentials"))e.withCredentials=r.withCredentials;else if(!(0,m.hasSameOrigin)(t,(0,m.getAppUrl)()))if((0,m.isTrustedServer)(t))e.withCredentials=!0;else if(u.id){const r=u.id.findServerInfo(t);r&&r.webTierAuth&&(e.withCredentials=!0)}e.withCredentials&&(o.credentials="include")}let l,d,p=0,f=!1;a>0&&(p=setTimeout((()=>{f=!0,e.controller.abort()}),a));try{if("native-request-init"===r.responseType)d=o,d.url=t;else if("image"!==r.responseType||"default"!==o.cache||"GET"!==o.method||i||function(e){if(e)for(const t of Object.getOwnPropertyNames(e))if(e[t])return!0;return!1}(r.headers)||!s&&!e.useProxy&&T.proxyUrl&&!C(t)){if(l=await w._abortableFetch(t,o),e.useProxy||function(e){const t=(0,m.getOrigin)(e);t&&!w._corsServers.includes(t)&&w._corsServers.push(t)}(t),"native"===r.responseType)d=l;else if("HEAD"!==o.method)if(l.ok){switch(n){case"array-buffer":d=await l.arrayBuffer();break;case"blob":case"image":d=await l.blob();break;default:d=await l.text()}if(p&&(clearTimeout(p),p=0),"json"===n||"xml"===n||"document"===n)if(d)switch(n){case"json":d=JSON.parse(d);break;case"xml":d=U(d,"application/xml");break;case"document":d=U(d,"text/html")}else d=null;if(d){if("array-buffer"===n||"blob"===n){const e=l.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(e)&&d["blob"===n?"size":"byteLength"]<=750)try{const e=await new Response(d).json();e.error&&(d=e)}catch{}}"image"===n&&d instanceof Blob&&(d=await A(URL.createObjectURL(d),e,!0))}}else d=await l.text()}else d=await A(t,e)}catch(o){if("AbortError"===o.name){if(f)throw new Error("Timeout exceeded");throw(0,h.createAbortError)("Request canceled")}if(!(!l&&o instanceof TypeError&&T.proxyUrl)||r.body||"delete"===r.method||"head"===r.method||"post"===r.method||"put"===r.method||e.useProxy||C(t))throw o;e.redoRequest=!0,(0,m.addProxyRule)({proxyUrl:T.proxyUrl,urlPrefix:(0,m.getOrigin)(t)})}finally{p&&clearTimeout(p)}return[l,d]}function U(e,t){let r;try{r=(new DOMParser).parseFromString(e,t)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function j(e,t,r){if(e.redoRequest)return e.redoRequest=!1,!1;const o=e.params.requestOptions;if(!t||"native"===o.responseType||"native-request-init"===o.responseType)return!0;let s,n,a,i;if(!t.ok)throw s=new Error(`Unable to load ${t.url} status: ${t.status}`),s[v]=r,s;null!=r&&r.error&&(s=r.error),s&&(n=Number(s.code),a=s.hasOwnProperty("subcode")?Number(s.subcode):null,i=s.messageCode,i=i&&i.toUpperCase());const l=o.authMode;if(403===n&&(4===a||s.message&&s.message.toLowerCase().indexOf("ssl")>-1&&-1===s.message.toLowerCase().indexOf("permission"))){if(!e.useSSL)return e.useSSL=!0,!1}else if(!e.hasToken&&e.useIdentity&&("no-prompt"!==l||498===n)&&-1!==O.indexOf(n)&&!L(e.params.url)&&(403!==n||-1===k.indexOf(i)&&(null==a||2===a&&e.credentialToken))){await P();try{const t=await u.id.getCredential(e.params.url,{error:E("request:server",s,e.params),prompt:"no-prompt"!==l,signal:e.controller.signal,token:e.credentialToken});return e.credential=t,e.credentialToken=t.token,e.useSSL=e.useSSL||t.ssl,!1}catch(t){if("no-prompt"===l)return e.credential=null,e.credentialToken=null,!1;s=t}}if(s)throw s;return!0}function A(e,t,r=!1){const o=t.controller.signal,s=new Image;return t.withCredentials?s.crossOrigin="use-credentials":s.crossOrigin="anonymous",s.alt="",s.src=e,(0,g.loadImageAsync)(s,e,r,o)}w._abortableFetch=null,w._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"]})),e.register("ct6jF",(function(t,r){t.exports=import("./"+e("kyEFX").resolve("3mb7W")).then((()=>e("hhVdE")))})),e.register("7DxjT",(function(t,r){t.exports=import("./"+e("kyEFX").resolve("fhvsi")).then((()=>e("aDYHW")))}));
//# sourceMappingURL=request.0142e852.js.map
