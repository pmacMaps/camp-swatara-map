function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("l8Y3H",(function(r,n){var i;i=r.exports,Object.defineProperty(i,"__esModule",{value:!0,configurable:!0}),e(r.exports,"default",(function(){return V}));var s=t("j6uz9"),a=t("iLz4U");t("bPmsI"),t("5HTPH");var o=t("6TszD"),l=t("1CpCt"),u=t("lHg4e");t("gHCNy"),t("aX9sh"),t("bXKTN");var c=t("qA6zg"),y=t("lDoe3"),h=t("jaaCV"),p=t("jocF1"),f=t("hAqwK"),v=t("1dnlL"),d=t("6zm2Z"),m=t("9VqGW"),g=t("8QpQ1"),x=t("lyPWm"),S=t("5Y02G");function b(e,t){return(!e.minScale||e.minScale>=t)&&(!e.maxScale||e.maxScale<=t)}function T(e){const t=e.message,r={message:{data:{},tileKey:t.tileKey,tileKeyOrigin:t.tileKeyOrigin,version:t.version},transferList:new Array};for(const e in t.data){const n=t.data[e];if(r.message.data[e]=null,(0,l.isSome)(n)){const t=n.stride,i=n.indices.slice(0),s=n.vertices.slice(0),a=n.records.slice(0),o={stride:t,indices:i,vertices:s,records:a,metrics:(0,l.applySome)(n.metrics,(e=>e.slice(0)))};r.transferList.push(i,s,a),r.message.data[e]=o}}return r}o.default.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");let L=class extends x.default{initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))]),this._resourceManagerProxy=new(0,S.default)(this.remoteClient)}destroy(){this._resourceManagerProxy.destroy()}get supportsTileUpdates(){return!0}forEachBufferId(e){this._bufferIds.forEach((t=>{t.forEach(e)}))}async update(e,t){const r=t.schema.processors[0];if("symbol"!==r.type)return;const n=(0,y.diff)(this._schema,r);(0,y.hasDiff)(n,"mesh")&&(e.mesh=!0,e.why.mesh.push("Symbology changed"),this._schema=r,this._factory=this._createFactory(r),this._factory.update(r,this.tileStore.tileScheme.tileInfo))}onTileMessage(e,t,r,n){return(0,u.throwIfAborted)(n),this._onTileData(e,t,r,n)}onTileClear(e){return this._bufferData.delete(e.key.id),this._bufferIds.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}onTileError(e,t,r){const n=r.signal,i={tileKey:e.id,error:t};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:n})}onTileUpdate(e){for(const t of e.removed)this._bufferData.has(t.key.id)&&this._bufferData.delete(t.key.id),this._bufferIds.has(t.key.id)&&this._bufferIds.delete(t.key.id);for(const t of e.added)this._bufferData.forEach((e=>{for(const r of e)r.message.tileKey===t.id&&this._updateTileMesh("append",t,T(r),[],!1,!1,null)}))}_addBufferData(e,t){this._bufferData.has(e)||this._bufferData.set(e,[]),this._bufferData.get(e).push(T(t))}_createFactory(e){const{geometryType:t,objectIdField:r,fields:n}=this.service,i={geometryType:t,fields:n,spatialReference:h.default.fromJSON(this.spatialReference)},s=new(0,d.WGLTemplateStore)(((e,t)=>this.remoteClient.invoke("tileRenderer.getMaterialItems",e,t)),this.tileStore.tileScheme.tileInfo),{matcher:a,aggregateMatcher:o}=e.mesh;return this._store=s,this._matchers.feature=(0,m.createMatcher)(a,s,i,this._resourceManagerProxy),this._matchers.aggregate=(0,l.applySome)(o,(e=>(0,m.createMatcher)(e,s,i,this._resourceManagerProxy))),new(0,v.WGLMeshFactory)(t,r,s)}async _onTileData(e,t,r,n){(0,u.throwIfAborted)(n);const{type:i,addOrUpdate:s,remove:a,clear:o,end:c}=t,y=!!this._schema.mesh.sortKey;if(!s){const t={type:i,addOrUpdate:null,remove:a,clear:o,end:c,sort:y};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t},n)}const h=this._processFeatures(e,s,r,n,t.status.version);try{const r=await h;if((0,l.isNone)(r)){const t={type:i,addOrUpdate:null,remove:a,clear:o,end:c,sort:y};return this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t},n)}const s=[];for(const t of r){let r=!1;const n=t.message.bufferIds,i=e.key.id,a=t.message.tileKey;if(i!==a&&(0,l.isSome)(n)){if(!this.tileStore.get(a)){this._addBufferData(i,t),s.push(t);continue}let e=this._bufferIds.get(a);e||(e=new Set,this._bufferIds.set(a,e));const o=Array.from(n);for(const t of o){if(e.has(t)){r=!0;break}e.add(t)}}r||(this._addBufferData(i,t),s.push(t))}await Promise.all(s.map((r=>{const s=e.key.id===r.message.tileKey,a=s?t.remove:[],o=s&&t.end;return this._updateTileMesh(i,e,r,a,o,t.clear,n.signal)})))}catch(t){this._handleError(e,t,n)}}async _updateTileMesh(e,t,r,n,i,s,a){const o=e,c=r.message.tileKey,y=!!this._schema.mesh.sortKey;c!==t.key.id&&(i=!1);const h=(0,l.applySome)(r,(e=>e.message)),p=(0,l.applySome)(r,(e=>e.transferList))||[],f={type:o,addOrUpdate:h,remove:n,clear:s,end:i,sort:y},v={transferList:(0,l.unwrap)(p)||[],signal:a};return(0,u.throwIfAborted)(v),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:c,data:f},v)}async _processFeatures(e,t,r,n,i){if((0,l.isNone)(t)||!t.hasFeatures)return null;const s={transform:e.transform,hasZ:!1,hasM:!1},a=this._factory,o={viewingMode:"",scale:e.scale},c=await this._matchers.feature,y=await this._matchers.aggregate;(0,u.throwIfAborted)(n);const h=this._getLabelInfos(e,t);return await a.analyze(t.getCursor(),this._resourceManagerProxy,c,y,s,o),(0,u.throwIfAborted)(n),this._writeFeatureSet(e,t,s,h,a,r,i)}_writeFeatureSet(e,t,r,n,i,s,a){const o=t.getSize(),u=new(0,f.MeshData)(e.key.id,{features:o,records:o,metrics:0},this._schema.mesh.matcher.symbologyType,s,!0,a),c={viewingMode:"",scale:e.scale},y=t.getCursor();for(;y.next();)try{const t=y.getDisplayId(),s=(0,l.isSome)(n)?n.get(t):null;i.writeCursor(u,y,r,c,e.level,s,this._resourceManagerProxy)}catch(e){}const h=e.tileInfoView.tileInfo.isWrappable;return u.serialize(h)}_handleError(e,t,r){if(!(0,u.isAbortError)(t)){const n={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",n,{signal:r.signal})}}_getLabelingSchemaForScale(e){const t=this._schema.mesh.labels;if((0,l.isNone)(t))return null;if("subtype"===t.type){const r={type:"subtype",classes:{}};let n=!1;for(const i in t.classes){const s=t.classes[i].filter((t=>b(t,e.scale)));n=n||!!s.length,r.classes[i]=s}return n?r:null}const r=t.classes.filter((t=>b(t,e.scale)));return r.length?{type:"simple",classes:r}:null}_getLabels(e,t){if("subtype"===t.type){const r=this.service.subtypeField,n=(0,l.unwrapOrThrow)(r,"Expected to find subtype Field"),i=e.readAttribute(n);return null==i?[]:t.classes[i]??[]}return t.classes}_getLabelInfos(e,t){const r=this._getLabelingSchemaForScale(e);if((0,l.isNone)(r))return null;const n=new Map,i=t.getCursor();for(;i.next();){const e=i.getDisplayId(),t=[],s=(0,p.isAggregateId)(e),o=s&&1!==i.readAttribute("cluster_count")?"aggregate":"feature",l=this._getLabels(i,r);for(const r of l){if(r.target!==o)continue;const n=i.getStorage(),l=s&&"feature"===o?n.getComputedStringAtIndex(i.readAttribute("referenceId"),r.fieldIndex):n.getComputedStringAtIndex(e,r.fieldIndex);if(!l)continue;const u=(0,a.bidiText)(l.toString()),c=u[0],y=u[1];this._store.getMosaicItem(r.symbol,(0,g.codepoints)(c)).then((e=>{t[r.index]={glyphs:e.glyphMosaicItems,rtl:y,index:r.index}}))}n.set(e,t)}return n}constructor(){super(...arguments),this.type="symbol",this._matchers={feature:null,aggregate:null},this._bufferData=new Map,this._bufferIds=new Map}};L=(0,s._)([(0,c.subclass)("esri.views.2d.layers.features.processors.SymbolProcessor")],L);const V=L})),t.register("lyPWm",(function(r,n){e(r.exports,"default",(function(){return u}));var i=t("j6uz9"),s=t("8Y9g8"),a=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var o=t("qA6zg");let l=class extends s.HandleOwner{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};(0,i._)([(0,a.property)({readOnly:!0})],l.prototype,"supportsTileUpdates",null),(0,i._)([(0,a.property)({constructOnly:!0})],l.prototype,"remoteClient",void 0),(0,i._)([(0,a.property)({constructOnly:!0})],l.prototype,"service",void 0),(0,i._)([(0,a.property)()],l.prototype,"spatialReference",null),(0,i._)([(0,a.property)({constructOnly:!0})],l.prototype,"tileInfo",void 0),(0,i._)([(0,a.property)({constructOnly:!0})],l.prototype,"tileStore",void 0),l=(0,i._)([(0,o.subclass)("esri.views.2d.layers.features.processors.BaseProcessor")],l);const u=l})),t.register("5Y02G",(function(r,n){e(r.exports,"default",(function(){return s}));var i=t("lHg4e");class s{destroy(){}async fetchResource(e,t){const r=this._resourceMap,n=r.get(e);if(n)return n;let s=this._inFlightResourceMap.get(e);if(s)return s;try{s=this._remoteClient.invoke("tileRenderer.fetchResource",{url:e},{...t}),this._inFlightResourceMap.set(e,s),s.then((t=>(this._inFlightResourceMap.delete(e),r.set(e,t),t)))}catch(e){return(0,i.isAbortError)(e)?null:{width:0,height:0}}return s}getResource(e){return this._resourceMap.get(e)??null}constructor(e){this._remoteClient=e,this._resourceMap=new Map,this._inFlightResourceMap=new Map,this.geometryEngine=null}}})),t.register("9F6Dg",(function(r,n){e(r.exports,"getPow2NeighborKey",(function(){return i}));t("6uWZ2");function i(e,t,r,n){const i=e.clone(),s=1<<i.level,a=i.col+t,o=i.row+r;return n&&a<0?(i.col=a+s,i.world-=1):a>=s?(i.col=a-s,i.world+=1):i.col=a,i.row=o,i}})),t.register("bVIMy",(function(t,r){var n,i,s;function a(e){switch(e){case"left":return n.Left;case"right":return n.Right;case"center":return n.Center}}function o(e){switch(e){case"top":return i.Top;case"middle":return i.Center;case"baseline":return i.Baseline;case"bottom":return i.Bottom}}function l(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return[n.Right,i.Bottom];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return[n.Center,i.Bottom];case"above-right":case"esriServerPointLabelPlacementAboveRight":return[n.Left,i.Bottom];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return[n.Right,i.Center];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return[n.Center,i.Center];case"center-right":case"esriServerPointLabelPlacementCenterRight":return[n.Left,i.Center];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return[n.Right,i.Top];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return[n.Center,i.Top];case"below-right":case"esriServerPointLabelPlacementBelowRight":return[n.Left,i.Top];default:return console.debug(`Found invalid placement type ${e}`),[n.Center,i.Center]}}function u(e){switch(e){case n.Right:return-1;case n.Center:return 0;case n.Left:return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}}function c(e){switch(e){case i.Top:return 1;case i.Center:return 0;case i.Bottom:case i.Baseline:return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}}function y(e){switch(e){case"left":return n.Left;case"right":return n.Right;case"center":return n.Center}}function h(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}e(t.exports,"HAlign",(function(){return n})),e(t.exports,"VAlign",(function(){return i})),e(t.exports,"getXAnchorDirection",(function(){return a})),e(t.exports,"getYAnchorDirection",(function(){return o})),e(t.exports,"getAlignmentFromPlacement",(function(){return l})),e(t.exports,"getXDirection",(function(){return u})),e(t.exports,"getYDirection",(function(){return c})),e(t.exports,"getJustification",(function(){return y})),e(t.exports,"isMapAligned",(function(){return h})),(s=n||(n={}))[s.Left=-1]="Left",s[s.Center=0]="Center",s[s.Right=1]="Right",function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(i||(i={}))})),t.register("eDdav",(function(r,n){e(r.exports,"isOutlineFillSymbology",(function(){return l})),e(r.exports,"hasSimpleSymbology",(function(){return u})),e(r.exports,"hasOutlineFillSymbology",(function(){return c})),e(r.exports,"createMaterialKey",(function(){return y})),e(r.exports,"FillMaterialKey",(function(){return g})),e(r.exports,"LineMaterialKey",(function(){return S})),e(r.exports,"MarkerMaterialKey",(function(){return x})),e(r.exports,"TextMaterialKey",(function(){return b})),e(r.exports,"LabelMaterialKey",(function(){return T})),e(r.exports,"hydrateMaterialKey",(function(){return h})),e(r.exports,"MaterialKeyBase",(function(){return p}));var i=t("bPmsI"),s=t("bVIMy"),a=t("eyQUy");const o=Object.keys(a.WGLSymbologyType).filter((e=>"number"==typeof a.WGLSymbologyType[e])).reduce(((e,t)=>({...e,[t]:a.WGLSymbologyType[t]})),{});function l(e){return e===a.WGLSymbologyType.OUTLINE_FILL||e===a.WGLSymbologyType.OUTLINE_FILL_SIMPLE}function u(e){return function(e){return e===a.WGLSymbologyType.SIMPLE||e===a.WGLSymbologyType.OUTLINE_FILL_SIMPLE}(e.symbologyType)}function c(e){return l(e.symbologyType)}function y(e,t){switch(e){case a.WGLGeometryType.FILL:return g.from(t);case a.WGLGeometryType.LINE:return S.from(t);case a.WGLGeometryType.MARKER:return x.from(t);case a.WGLGeometryType.TEXT:return b.from(t);case a.WGLGeometryType.LABEL:return T.from(t);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${e}`)}}function h(e){switch(p.load(e).geometryType){case a.WGLGeometryType.MARKER:return new x(e);case a.WGLGeometryType.FILL:return new g(e);case a.WGLGeometryType.LINE:return new S(e);case a.WGLGeometryType.TEXT:return new b(e);case a.WGLGeometryType.LABEL:return new T(e)}}class p{static load(e){const t=this.shared;return t.data=e,t}set data(e){this._data=e}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(e){this.setBits(e,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(e){this.setBit(20,e)}get sdf(){return!!this.bit(11)}set sdf(e){this.setBit(11,e)}get pattern(){return!!this.bit(12)}set pattern(e){this.setBit(12,e)}get textureBinding(){return this.bits(0,8)}set textureBinding(e){this.setBits(e,0,8)}get symbologyType(){return this.bits(21,26)}set symbologyType(e){this.setBits(e,21,26)}get geometryTypeString(){switch(this.geometryType){case a.WGLGeometryType.FILL:return"fill";case a.WGLGeometryType.MARKER:return"marker";case a.WGLGeometryType.LINE:return"line";case a.WGLGeometryType.TEXT:return"text";case a.WGLGeometryType.LABEL:return"label";default:throw new(0,i.default)(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(e,t){const r=1<<e;t?this._data|=r:this._data&=~r}bit(e){return(this._data&1<<e)>>e}setBits(e,t,r){for(let n=t,i=0;n<r;n++,i++)this.setBit(n,0!=(e&1<<i))}bits(e,t){let r=0;for(let n=e,i=0;n<t;n++,i++)r|=this.bit(n)<<i;return r}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf,symbologyType:{value:a.WGLSymbologyType[this.symbologyType],options:o,namespace:"SYMBOLOGY_TYPE"}}}getVariationHash(){return this._data&~(7&this.textureBinding)}constructor(e){this._data=0,this._data=e}}p.shared=new p(0);const f=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(e){this.setBit(16,e)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(e){this.setBit(17,e)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(e){this.setBit(18,e)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(e){this.setBit(19,e)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(e,t){super.setVV(e,t);const r=function(e,t,r){const n=a.WGLVVFlag.SIZE_FIELD_STOPS|a.WGLVVFlag.SIZE_MINMAX_VALUE|a.WGLVVFlag.SIZE_SCALE_STOPS|a.WGLVVFlag.SIZE_UNIT_VALUE,i=(t&(a.WGLVVTarget.FIELD_TARGETS_OUTLINE|a.WGLVVTarget.MINMAX_TARGETS_OUTLINE|a.WGLVVTarget.SCALE_TARGETS_OUTLINE|a.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return e===a.WGLGeometryType.LINE&&r.isOutline||e===a.WGLGeometryType.FILL&&l(r.symbologyType)?n&i:n&~i}(this.geometryType,e,t)&e;this.vvSizeMinMaxValue=!!(r&a.WGLVVFlag.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(r&a.WGLVVFlag.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(r&a.WGLVVFlag.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(r&a.WGLVVFlag.SIZE_SCALE_STOPS)}},v=e=>class extends e{get vvRotation(){return 0!==this.bit(15)}set vvRotation(e){this.setBit(15,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t.isOutline&&!!(e&a.WGLVVFlag.ROTATION)}},d=e=>class extends e{get vvColor(){return 0!==this.bit(13)}set vvColor(e){this.setBit(13,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t.isOutline&&!!(e&a.WGLVVFlag.COLOR)}},m=e=>class extends e{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(e){this.setBit(14,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t.isOutline&&!!(e&a.WGLVVFlag.OPACITY)}};class g extends(d(m(f(p)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const{symbologyType:t,vvFlags:r}=e,n=this.load(0);return n.geometryType=a.WGLGeometryType.FILL,n.symbologyType=t,t!==a.WGLSymbologyType.DOT_DENSITY&&n.setVV(r,e),n.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}g.shared=new g(0);class x extends(d(m(v(f(p))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const{symbologyType:t,vvFlags:r}=e,n=this.load(0);return n.geometryType=a.WGLGeometryType.MARKER,n.symbologyType=t,t!==a.WGLSymbologyType.HEATMAP&&n.setVV(r,e),n.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}x.shared=new x(0);class S extends(d(m(f(p)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.LINE,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}S.shared=new S(0);class b extends(d(m(v(f(p))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.TEXT,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}b.shared=new b(0);class T extends(f(p)){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.LABEL,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.mapAligned=(0,s.isMapAligned)(e.placement),t.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}T.shared=new T(0)})),t.register("c4cvq",(function(t,r){e(t.exports,"radToByte",(function(){return o})),e(t.exports,"degToByte",(function(){return l})),e(t.exports,"log2",(function(){return u})),e(t.exports,"between",(function(){return c}));Number.POSITIVE_INFINITY;const n=Math.PI,i=128/n,s=1/Math.LN2;function a(e,t){return(e%=t)>=0?e:e+t}function o(e){return a(e*i,256)}function l(e){return a(.7111111111111111*e,256)}function u(e){return Math.log(e)*s}function c(e,t,r){return e>=t&&e<=r||e>=r&&e<=t}})),t.register("3Icya",(function(t,r){e(t.exports,"e",(function(){return a}));var n,i,s={exports:{}};n=s,void 0!==(i=function(){function e(e,r,i){i=i||2;var s,a,o,u,c,y,h,p=r&&r.length,f=p?r[0]*i:e.length,v=t(e,0,f,i,!0),d=[];if(!v||v.next===v.prev)return d;if(p&&(v=l(e,r,v,i)),e.length>80*i){s=o=e[0],a=u=e[1];for(var m=i;m<f;m+=i)(c=e[m])<s&&(s=c),(y=e[m+1])<a&&(a=y),c>o&&(o=c),y>u&&(u=y);h=0!==(h=Math.max(o-s,u-a))?1/h:0}return n(v,d,i,s,a,h),d}function t(e,t,r,n,i){var s,a;if(i===I(e,t,r,n)>0)for(s=t;s<r;s+=n)a=_(s,e[s],e[s+1],a);else for(s=r-n;s>=t;s-=n)a=_(s,e[s],e[s+1],a);if(a&&x(a,a.next)){var o=a.next;M(a),a=o}return a}function r(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!x(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{var i=n.prev;if(M(n),(n=t=i)===n.next)break;r=!0}}while(r||n!==t);return t}function n(e,t,l,u,c,y,h){if(e){!h&&y&&p(e,u,c,y);for(var f,v,d=e;e.prev!==e.next;)if(f=e.prev,v=e.next,y?s(e,u,c,y):i(e))t.push(f.i/l),t.push(e.i/l),t.push(v.i/l),M(e),e=v.next,d=v.next;else if((e=v)===d){h?1===h?n(e=a(r(e),t,l),t,l,u,c,y,2):2===h&&o(e,t,l,u,c,y):n(r(e),t,l,u,c,y,1);break}}}function i(e){var t=e.prev,r=e,n=e.next;if(g(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(d(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function s(e,t,r,n){var i=e.prev,s=e,a=e.next;if(g(i,s,a)>=0)return!1;for(var o=i.x<s.x?i.x<a.x?i.x:a.x:s.x<a.x?s.x:a.x,l=i.y<s.y?i.y<a.y?i.y:a.y:s.y<a.y?s.y:a.y,u=i.x>s.x?i.x>a.x?i.x:a.x:s.x>a.x?s.x:a.x,c=i.y>s.y?i.y>a.y?i.y:a.y:s.y>a.y?s.y:a.y,y=f(o,l,t,r,n),h=f(u,c,t,r,n),p=e.prevZ,v=e.nextZ;p&&p.z>=y&&v&&v.z<=h;){if(p!==e.prev&&p!==e.next&&d(i.x,i.y,s.x,s.y,a.x,a.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,v!==e.prev&&v!==e.next&&d(i.x,i.y,s.x,s.y,a.x,a.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;p&&p.z>=y;){if(p!==e.prev&&p!==e.next&&d(i.x,i.y,s.x,s.y,a.x,a.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;v&&v.z<=h;){if(v!==e.prev&&v!==e.next&&d(i.x,i.y,s.x,s.y,a.x,a.y,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function a(e,t,n){var i=e;do{var s=i.prev,a=i.next.next;!x(s,a)&&S(s,i,i.next,a)&&L(s,a)&&L(a,s)&&(t.push(s.i/n),t.push(i.i/n),t.push(a.i/n),M(i),M(i.next),i=e=a),i=i.next}while(i!==e);return r(i)}function o(e,t,i,s,a,o){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&m(l,u)){var c=V(l,u);return l=r(l,l.next),c=r(c,c.next),n(l,t,i,s,a,o),void n(c,t,i,s,a,o)}u=u.next}l=l.next}while(l!==e)}function l(e,n,i,s){var a,o,l,c=[];for(a=0,o=n.length;a<o;a++)(l=t(e,n[a]*s,a<o-1?n[a+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),c.push(v(l));for(c.sort(u),a=0;a<c.length;a++)i=r(i=y(c[a],i),i.next);return i}function u(e,t){return e.x-t.x}function c(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function y(e,t){var n=function(e,t){var r,n=t,i=e.x,s=e.y,a=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){var o=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=i&&o>a){if(a=o,o===i){if(s===n.y)return n;if(s===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r;var l,u=r,c=r.x,y=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&d(s<y?i:a,s,c,y,s<y?a:i,s,n.x,n.y)&&(l=Math.abs(s-n.y)/(i-n.x),L(n,e)&&(l<p||l===p&&(n.x>r.x||n.x===r.x&&h(r,n)))&&(r=n,p=l)),n=n.next}while(n!==u);return r}(e,t);if(!n)return t;var i=V(n,e),s=r(n,n.next);let a=c(i);return r(a,a.next),s=c(s),c(t===n?s:t)}function h(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function p(e,t,r,n){var i=e;do{null===i.z&&(i.z=f(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,s,a,o,l,u=1;do{for(r=e,e=null,s=null,a=0;r;){for(a++,n=r,o=0,t=0;t<u&&(o++,n=n.nextZ);t++);for(l=u;o>0||l>0&&n;)0!==o&&(0===l||!n||r.z<=n.z)?(i=r,r=r.nextZ,o--):(i=n,n=n.nextZ,l--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=n}s.nextZ=null,u*=2}while(a>1)}(i)}function f(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function v(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function d(e,t,r,n,i,s,a,o){return(i-a)*(t-o)-(e-a)*(s-o)>=0&&(e-a)*(n-o)-(r-a)*(t-o)>=0&&(r-a)*(s-o)-(i-a)*(n-o)>=0}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&S(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(L(e,t)&&L(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||x(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function S(e,t,r,n){var i=T(g(e,t,r)),s=T(g(e,t,n)),a=T(g(r,n,e)),o=T(g(r,n,t));return i!==s&&a!==o||!(0!==i||!b(e,r,t))||!(0!==s||!b(e,n,t))||!(0!==a||!b(r,e,n))||!(0!==o||!b(r,t,n))}function b(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function T(e){return e>0?1:e<0?-1:0}function L(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function V(e,t){var r=new w(e.i,e.x,e.y),n=new w(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function _(e,t,r,n){var i=new w(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function w(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(e,t,r,n){for(var i=0,s=t,a=r-n;s<r;s+=n)i+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return i}return e.deviation=function(e,t,r,n){var i=t&&t.length,s=i?t[0]*r:e.length,a=Math.abs(I(e,0,s,r));if(i)for(var o=0,l=t.length;o<l;o++){var u=t[o]*r,c=o<l-1?t[o+1]*r:e.length;a-=Math.abs(I(e,u,c,r))}var y=0;for(o=0;o<n.length;o+=3){var h=n[o]*r,p=n[o+1]*r,f=n[o+2]*r;y+=Math.abs((e[h]-e[f])*(e[p+1]-e[h+1])-(e[h]-e[p])*(e[f+1]-e[h+1]))}return 0===a&&0===y?0:Math.abs((y-a)/a)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var s=0;s<e[i].length;s++)for(var a=0;a<t;a++)r.vertices.push(e[i][s][a]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r},e}())&&(n.exports=i);const a=s.exports})),t.register("d1j0h",(function(r,n){e(r.exports,"expandSymbol",(function(){return l})),e(r.exports,"cimLayerToRasterizationInfo",(function(){return u}));var i=t("9LGQK"),s=t("6LuoZ"),a=t("nXMis");const o=async(e,t,r)=>new(0,s.ExpandedCIM)(await(0,i.analyzeCIMSymbol)(e.data,t,r),e.data,e.rendererKey,e.maxVVSize),l=async(e,t,r,n)=>{if(!e)return null;if("cim"===e.type)return o(e,t,r);if("web-style"===e.type){const i={type:"cim",data:await(0,a.fetchCIMSymbolReference)(e,null,n),rendererKey:e.rendererKey,maxVVSize:e.maxVVSize};return o(i,t,r)}return e};function u(e){if(!e)return null;const{type:t,cim:r,url:n,materialHash:i}=e,s={cim:r,type:t,mosaicHash:i,url:n,size:null,dashTemplate:null,path:null,text:null,fontName:null,animatedSymbolProperties:null};switch(t){case"marker":s.size=e.size,s.path=e.path,s.animatedSymbolProperties=e.animatedSymbolProperties;break;case"line":s.dashTemplate=e.dashTemplate;break;case"text":s.text=e.text,s.fontName=e.fontName}return s}})),t.register("6LuoZ",(function(r,n){e(r.exports,"ExpandedCIM",(function(){return o}));var i=t("eyQUy"),s=t("eDdav");const a={marker:i.WGLGeometryType.MARKER,fill:i.WGLGeometryType.FILL,line:i.WGLGeometryType.LINE,text:i.WGLGeometryType.TEXT};class o{get type(){return"expanded-cim"}_createHash(){let e="";for(const t of this.layers)e+=t.templateHash;return e}constructor(e,t,r,n){const o={minScale:t?.minScale,maxScale:t?.maxScale},l=function(e){return e.minScale||e.maxScale?e.minScale+"-"+e.maxScale:""}(o);this.layers=e,this.data=t,this.hash=this._createHash()+l,this.rendererKey=r;const u={isOutline:!1,placement:null,symbologyType:i.WGLSymbologyType.DEFAULT,vvFlags:r};for(const t of e){const e=a[t.type];u.isOutline="line"===t.type&&t.isOutline,t.materialKey=(0,s.createMaterialKey)(e,u),t.maxVVSize=n,t.scaleInfo=o,t.templateHash+=l}}}})),t.register("nXMis",(function(r,n){e(r.exports,"fetchCIMSymbolReference",(function(){return h}));var i=t("gnGFZ"),s=t("bPmsI"),a=t("1CpCt"),o=t("lHg4e"),l=t("7dRCe"),u=t("39WmQ"),c=t("hej7M"),y=t("i9hTa");async function h(e,t,r){if(!e.name)throw new(0,s.default)("style-symbol-reference-name-missing","Missing name in style symbol reference");if(e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName)return async function(e,t){const r=y.Style2DUrlTemplate.replace(/\{SymbolName\}/gi,e.name);try{const e=await(0,y.requestJSON)(r,t);return(0,y.makeCIMSymbolRef)(e.data)}catch(e){return(0,o.throwIfAborted)(e),null}}(e,r);try{return async function(e,t,r,n){const h=e.data,p={portal:r&&(0,a.isSome)(r.portal)?r.portal:u.default.getDefault(),url:(0,l.urlToObject)(e.baseUrl),origin:"portal-item"},f=h.items.find((e=>e.name===t));if(!f)throw new(0,s.default)("symbolstyleutils:symbol-name-not-found",`The symbol name '${t}' could not be found`,{symbolName:t});let v=(0,c.f)((0,y.symbolUrlFromStyleItem)(f,"cimRef"),p);(0,i.isDevEnvironment)()&&(v=(0,i.adjustStaticAGOUrl)(v));try{const e=await(0,y.requestJSON)(v,n);return(0,y.makeCIMSymbolRef)(e.data)}catch(e){return(0,o.throwIfAborted)(e),null}}(await(0,y.fetchStyle)(e,t,r),e.name,t,r)}catch(e){return(0,o.throwIfAborted)(e),null}}}));
//# sourceMappingURL=SymbolProcessor.668ac671.js.map
