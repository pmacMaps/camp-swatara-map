!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("3RWte",(function(i,a){t(i.exports,"default",(function(){return H}));var n=r("8TSCy"),s=r("2TvXO"),o=r("7eJjO"),l=r("jymfC"),u=r("6J0KG"),d=r("6dXDO"),c=r("2VlWd"),f=r("7qybv"),h=r("10vEZ"),y=r("iho5X");r("lNwWH"),r("iJAIC");var v=r("fcwIv"),p=r("j40xv"),m=r("8TwEW"),g=r("exxMy"),x=r("79LpT"),_=r("fDoeM"),b=r("eY5Yp"),C=r("fP7bp"),k=r("4FBKO"),w=r("4aUIW"),T=r("4WoSm"),S=r("3kinH"),D=r("6WOnF"),B=r("7P0zT"),F=r("4rXhP"),I=r("7Vsyp"),M=r("iyMTk"),L=r("aZQjs"),R=r("li6vg"),A=r("8c8ji"),G=r("angIQ"),P=r("cdq0d"),z=r("4gS0A"),O=r("d2StF"),V=r("2rjRQ"),E=r("eOR0N"),U=r("3NAox"),j=r("90RBb"),K=(0,c.default)("esri-2d-graphic-debug");function W(e,t,r){if(r.has(e))return r.get(e);var i={tile:t,addedOrModified:[],removed:[]};return r.set(e,i),i}var q=function(t){"use strict";n.inherits(i,t);var r=n.createSuper(i);function i(e){var t;return n.classCallCheck(this,i),(t=r.call(this,e))._storage=new(0,G.ComputedAttributeStorage),t._displayIds=new Map,t._controller=new AbortController,t._tiles=new Map,t._graphicStoreUpdate=!1,t._graphicsSet=new Set,t._matcher=Promise.resolve(null),t._tileUpdateSet=new Set,t._tilesToUpdate=new Map,t._graphicIdToAbortController=new Map,t._attached=!1,t._updatingGraphicsTimer=null,t._hashToExpandedSymbol=new Map,t._hashToExpandedSymbolPromise=new Map,t._hashToCIMSymbolPromise=new Map,t._hashToCIM=new Map,t._processing=!1,t._needsProcessing=!1,t._pendingUpdate={added:new Set,updated:new Set,removed:new Set},t.lastUpdateId=-1,t.updateRequested=!1,t.graphicUpdateHandler=t.graphicUpdateHandler.bind(n.assertThisInitialized(t)),n.possibleConstructorReturn(t)}return n.createClass(i,[{key:"destroy",value:function(){this._updatingGraphicsTimer&&(clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=null,this.notifyChange("updating")),this._controller.abort(),this.container.destroy(),this._set("graphics",null),this._graphicStore.clear(),this._attributeStore=null,this._hashToExpandedSymbol.clear(),this.view=null,this.renderer=null,this._hashToCIM.clear(),this._hashToCIMSymbolPromise.clear(),this._hashToExpandedSymbolPromise.clear()}},{key:"_createMatcher",value:function(e,t,r){if(e){var i=(0,R.createMatcherSchema)({indexCount:0,fields:{}},"feature",e);this._matcher=(0,L.createMatcher)(i,t,null,r)}}},{key:"_createDisplayId",value:function(e){return this._displayIds.has(e)||this._displayIds.set(e,this._storage.createDisplayId()),this._displayIds.get(e)}},{key:"initialize",value:function(){var e=this;this._attributeStore=new(0,A.default)({type:"local",initialize:function(t){return Promise.resolve(e.container.attributeView.initialize(t))},update:function(t){return e.container.attributeView.requestUpdate(t)},render:function(){return e.container.requestRender()}},(0,U.getWebGL1Capabilities)()),this.container.hasHighlight=function(){return e._attributeStore.hasHighlight};var t=new(0,M.WGLTemplateStore)(this.container.getMaterialItems.bind(this.container),this.view.featuresTilingScheme.tileInfo);this._graphicStore=new(0,z.default)(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,(function(t){e._createDisplayId(t.uid),e._setFilterState(t.uid,t.visible)}),(function(t){var r=e._displayIds.get(t.uid);e._displayIds.delete(t.uid),e._storage.releaseDisplayId(r)}),this._hashToCIM),this._meshFactory=new(0,I.WGLMeshFactory)(null,this.uid,t),this._templateStore=t,this.handles.add([this.watch("renderer",(function(r){e._createMatcher(r,t,e.container.stage.resourceManager);var i=!0,a=!1,n=void 0;try{for(var s,o=e.graphics[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var l=s.value;e._pendingUpdate.updated.add(l)}}catch(e){a=!0,n=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw n}}e.requestUpdate()})),this.view.graphicsTileStore.on("update",(function(t){return e._onTileUpdate(t)})),this.container.on("attach",(function(){var r=e;K&&e.container.enableRenderingBounds((function(){return r._graphicStore.getAllBounds()})),e.graphics.items.length>0&&e._graphicsChangeHandler({target:e.graphics,added:e.graphics.items,removed:[],moved:[]}),e.handles.add(e.graphics.on("change",(function(e){return r._graphicsChangeHandler(e)})),"graphics");var i=e.container.stage.resourceManager;e._createMatcher(e.renderer,t,i),e._graphicStore.setResourceManager(i),e._attached=!0,e.notifyChange("updating")}))]);var r=this.view.graphicsTileStore.tiles;this._onTileUpdate({added:r,removed:[]})}},{key:"updating",get:function(){return!this._attached||null!==this._updatingGraphicsTimer||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0}},{key:"hitTest",value:function(e){if(!this.view||!this.view.position)return null;var t=this.view.state,r=t.resolution,i=t.rotation;return this._graphicStore.hitTest(e.x,e.y,2,r,i)}},{key:"update",value:function(e){(0,h.throwIfAborted)(this._controller.signal);var t=e.state.resolution;if(this._graphicStore.updateLevel(t),this._graphicStoreUpdate=!0,this.updateRequested=!1,this._pendingUpdate.updated.size>0){if(!this._processing)return void this._updateGraphics();this._needsProcessing=!0}}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"requestUpdate",value:function(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback())}},{key:"processUpdate",value:function(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}},{key:"graphicUpdateHandler",value:function(e){var t=e.graphic,r=e.property,i=e.newValue;switch(r){case"attributes":case"geometry":case"symbol":this._pendingUpdate.updated.add(t),this.requestUpdate();break;case"visible":this._setFilterState(t.uid,i),this._attributeStore.sendUpdates()}}},{key:"setHighlight",value:function(e){var t=this,r=e.map((function(e){return t._displayIds.get(e)}));this._attributeStore.setHighlight(e,r)}},{key:"_getIntersectingTiles",value:function(e){var t=this._graphicStore.getBounds(e);if(!t||0===(0,m.width)(t)||0===(0,m.height)(t))return[];var r=(0,O.intersectingInternationalDateline)(t,this.view.spatialReference);return(0,f.isSome)(r)?n.toConsumableArray(new Set(n.toConsumableArray(this.view.graphicsTileStore.boundsIntersections(r[0])).concat(n.toConsumableArray(this.view.graphicsTileStore.boundsIntersections(r[1]))))):this.view.graphicsTileStore.boundsIntersections(t)}},{key:"_updateTile",value:function(t){var r=this;return n.asyncToGenerator(e(s).mark((function i(){var a,n,o;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,h.throwIfAborted)(r._controller.signal),a=t.tile,n=r._getGraphicsData(r._templateStore,a,t.addedOrModified),e.next=5,r._processGraphics(a,n);case 5:return o=e.sent,e.abrupt("return",((0,h.throwIfAborted)(r._controller.signal),r._patchTile(a.key,{type:"update",addOrUpdate:o,remove:t.removed,end:!0,clear:!1,sort:!1}),o));case 7:case"end":return e.stop()}}),i)})))()}},{key:"_patchTile",value:function(e,t){if(this._tiles.has(e)){var r=this._tiles.get(e);this.container.onTileData(r,t),this.container.requestRender()}}},{key:"_graphicsChangeHandler",value:function(e){var t=this._pendingUpdate,r=!0,i=!1,a=void 0;try{for(var n,s=e.added[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var o=n.value;t.added.add(o)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}var l=!0,u=!1,d=void 0;try{for(var c,f=e.moved[Symbol.iterator]();!(l=(c=f.next()).done);l=!0){var h=c.value;t.updated.add(h)}}catch(e){u=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(u)throw d}}var y=!0,v=!1,p=void 0;try{for(var m,g=e.removed[Symbol.iterator]();!(y=(m=g.next()).done);y=!0){var x=m.value;this._pendingUpdate.added.has(x)?t.added.delete(x):t.removed.add(x)}}catch(e){v=!0,p=e}finally{try{y||null==g.return||g.return()}finally{if(v)throw p}}this._processing?this._needsProcessing=!0:this._updateGraphics()}},{key:"_getGraphicsToUpdate",value:function(){var e={added:[],removed:[],updated:[]};if(!this.graphics)return e;var t=this._pendingUpdate,r=!0,i=!1,a=void 0;try{for(var n,s=this.graphics.items[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var o=n.value;t.added.has(o)?e.added.push(o):t.updated.has(o)&&e.updated.push(o)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}var l=!0,u=!1,d=void 0;try{for(var c,f=t.removed[Symbol.iterator]();!(l=(c=f.next()).done);l=!0){var h=c.value;this._graphicStore.has(h)&&e.removed.push(h)}}catch(e){u=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(u)throw d}}return t.added.clear(),t.removed.clear(),t.updated.clear(),e}},{key:"_updateGraphics",value:function(){var t=this;return n.asyncToGenerator(e(s).mark((function r(){var i,a,o,l,u,d,c,f,y,v,p,m,g,x,_,b,C,k,w,T,S,D,B,F,I,M,L,R,A,G,P,z,O,V,E,U,j,K,q,H,N,X,Z,J,Y,Q,$,ee,te,re,ie,ae,ne,se,oe,le,ue,de,ce;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t._processing=!0,i=t._getGraphicsToUpdate(),a=i.added,o=i.removed,l=i.updated,u=t._tilesToUpdate,e.prev=3,t._graphicStoreUpdate||(d=t.view.state,c=d.resolution,t._graphicStore.updateLevel(c)),f=[],y=new Array(a.length+o.length),v=0;case 7:if(!(v<l.length)){e.next=30;break}for(p=l[v],m=t._getIntersectingTiles(p),g=!0,x=!1,_=void 0,e.prev=10,b=m[Symbol.iterator]();!(g=(C=b.next()).done);g=!0)k=C.value,W(k.id,k,u).removed.push(t._displayIds.get(p.uid));e.next=18;break;case 14:e.prev=14,e.t0=e.catch(10),x=!0,_=e.t0;case 18:e.prev=18,e.prev=19,g||null==b.return||b.return();case 21:if(e.prev=21,!x){e.next=24;break}throw _;case 24:return e.finish(21);case 25:return e.finish(18);case 26:f.push(t._updateGraphic(p,null)),y[v]=p;case 27:v++,e.next=7;break;case 30:for(w=l.length,T=0;T<a.length;T++)S=a[T],y[w+T]=S,t._graphicsSet.add(S),f.push(t._addGraphic(S));D=!0,B=!1,F=void 0,e.prev=33,I=o[Symbol.iterator]();case 35:if(D=(M=I.next()).done){e.next=60;break}for(L=M.value,t._abortProcessingGraphic(L.uid),R=t._getIntersectingTiles(L),A=!0,G=!1,P=void 0,e.prev=40,z=R[Symbol.iterator]();!(A=(O=z.next()).done);A=!0)V=O.value,W(V.id,V,u).removed.push(t._displayIds.get(L.uid));e.next=48;break;case 44:e.prev=44,e.t1=e.catch(40),G=!0,P=e.t1;case 48:e.prev=48,e.prev=49,A||null==z.return||z.return();case 51:if(e.prev=51,!G){e.next=54;break}throw P;case 54:return e.finish(51);case 55:return e.finish(48);case 56:t._graphicsSet.delete(L),t._graphicStore.remove(L);case 57:D=!0,e.next=35;break;case 60:e.next=66;break;case 62:e.prev=62,e.t2=e.catch(33),B=!0,F=e.t2;case 66:e.prev=66,e.prev=67,D||null==I.return||I.return();case 69:if(e.prev=69,!B){e.next=72;break}throw F;case 72:return e.finish(69);case 73:return e.finish(66);case 74:return t._flipUpdatingGraphics(),e.next=78,Promise.all(f);case 78:U=0;case 79:if(!(U<y.length)){e.next=102;break}for(E=y[U],j=t._getIntersectingTiles(E),K=!0,q=!1,H=void 0,e.prev=83,N=j[Symbol.iterator]();!(K=(X=N.next()).done);K=!0)Z=X.value,W(Z.id,Z,u).addedOrModified.push(E);e.next=91;break;case 87:e.prev=87,e.t3=e.catch(83),q=!0,H=e.t3;case 91:e.prev=91,e.prev=92,K||null==N.return||N.return();case 94:if(e.prev=94,!q){e.next=97;break}throw H;case 97:return e.finish(94);case 98:return e.finish(91);case 99:U++,e.next=79;break;case 102:for(t._graphicStore.updateZ(),J=[],Y=!0,Q=!1,$=void 0,e.prev=105,ee=u[Symbol.iterator]();!(Y=(te=ee.next()).done);Y=!0)re=n.slicedToArray(te.value,2),re[0],ie=re[1],J.push(t._updateTile(ie));e.next=113;break;case 109:e.prev=109,e.t4=e.catch(105),Q=!0,$=e.t4;case 113:e.prev=113,e.prev=114,Y||null==ee.return||ee.return();case 116:if(e.prev=116,!Q){e.next=119;break}throw $;case 119:return e.finish(116);case 120:return e.finish(113);case 121:return e.next=123,Promise.all(J);case 123:e.next=128;break;case 125:e.prev=125,e.t5=e.catch(3),(0,h.isAbortError)(e.t5);case 128:ae=!0,ne=!1,se=void 0,e.prev=129,oe=o[Symbol.iterator]();case 131:if(ae=(le=oe.next()).done){e.next=146;break}return ue=le.value,e.prev=133,e.next=136,t._getSymbolForGraphic(ue,{});case 136:(de=e.sent)&&(ce=de.hash(),t._hashToExpandedSymbol.delete(ce)),e.next=143;break;case 140:e.prev=140,e.t6=e.catch(133),(0,h.isAbortError)(e.t6);case 143:ae=!0,e.next=131;break;case 146:e.next=152;break;case 148:e.prev=148,e.t7=e.catch(129),ne=!0,se=e.t7;case 152:e.prev=152,e.prev=153,ae||null==oe.return||oe.return();case 155:if(e.prev=155,!ne){e.next=158;break}throw se;case 158:return e.finish(155);case 159:return e.finish(152);case 160:u.clear(),t.notifyChange("updating"),t._processing=!1,t._needsProcessing&&(t._needsProcessing=!1,t._updateGraphics());case 161:case"end":return e.stop()}}),r,null,[[3,125],[10,14,18,26],[19,,21,25],[33,62,66,74],[40,44,48,56],[49,,51,55],[67,,69,73],[83,87,91,99],[92,,94,98],[105,109,113,121],[114,,116,120],[129,148,152,160],[133,140],[153,,155,159]])})))()}},{key:"_getArcadeInfo",value:function(e){var t=(e.attributes?Object.keys(e.attributes):[]).map((function(t){return{name:t,alias:t,type:"string"==typeof e.attributes[t]?"esriFieldTypeString":"esriFieldTypeDouble"}}));return(0,f.isNone)(e.geometry)?null:{geometryType:(0,x.getJsonType)(e.geometry),spatialReference:p.default.fromJSON(e.geometry.spatialReference),fields:t}}},{key:"_getSymbolForGraphic",value:function(e,t){return(0,h.throwIfAborted)(this._controller.signal),(0,f.isSome)(e.symbol)?Promise.resolve(e.symbol):(0,f.isSome)(this.renderer)?this.renderer.getSymbolAsync(e,{scale:this.view.scale,abortOptions:t}):Promise.resolve(this._getNullSymbol(e))}},{key:"_getCIMSymbol",value:function(e,t,r){var i=this._hashToCIM.get(t);if(i)return Promise.resolve(i);var a=(0,k.symbolToCIM)(e);if((0,f.isSome)(a)){var n=this;if("CIMSymbolReference"===a.type)return i=a,this._hashToCIM.set(t,i),Promise.resolve(i);var s=this._hashToCIMSymbolPromise.get(t);return s||(s=a.fetchCIMSymbol(r).then((function(e){return n._hashToCIM.set(t,e.data),n._hashToCIMSymbolPromise.delete(t),e})).catch((function(e){return n._hashToCIMSymbolPromise.delete(t),(0,h.throwIfAbortError)(e),null})),this._hashToCIMSymbolPromise.set(t,s),s)}return Promise.resolve(null)}},{key:"_expandCIMSymbol",value:function(e,t,r,i){var a=this,n=this._hashToExpandedSymbol.get(r);if(n)return Promise.resolve(n);var s=this._hashToExpandedSymbolPromise.get(r);if(s)return s;var o=this.container.stage,l=this._getArcadeInfo(t),u=(0,R.createSymbolSchemaOptions)(null),d=(0,j.createSymbolSchema)(e,u);return s=(0,V.expandSymbol)(d,l,o.resourceManager,i),this._hashToExpandedSymbolPromise.set(r,s),s.then((function(e){return a._hashToExpandedSymbol.set(r,e),a._hashToExpandedSymbolPromise.delete(r),e})),s}},{key:"_getSymbolResources",value:function(t,r){var i=this;return n.asyncToGenerator(e(s).mark((function a(){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,h.throwIfAborted)(i._controller.signal),e.abrupt("return",i.container.stage?i._getSymbolForGraphic(t,r).then((function(e){var a=e.hash();return i._getCIMSymbol(e,a,r).then((function(e){return(0,f.isNone)(e)?null:i._expandCIMSymbol(e,t,a,r).then((function(e){var t=e.layers.filter((function(e){return"text"===e.type&&"string"==typeof e.text}));if(t&&t.length>0){for(var r=new Array(t.length),s=0;s<t.length;s++){for(var o=t[s],l=[],d=n.slicedToArray((0,u.bidiText)(o.text),1)[0],c=0;c<d.length;c++)l.push(d.charCodeAt(c));r[s]={symbol:o,id:s,glyphIds:l}}var f=new Map;return i.container.getMaterialItems(r).then((function(r){for(var i=0;i<t.length;i++){var n=t[i];f.set(n.cim,{text:n.text,mosaicItem:r[i].mosaicItem})}return{symbol:e,textInfo:f,hash:a}}))}return{symbol:e,hash:a}}))}))})).catch((function(e){return(0,h.throwIfAbortError)(e),null})):null);case 2:case"end":return e.stop()}}),a)})))()}},{key:"_projectAndNormalizeGeometry",value:function(t,r){var i=this;return n.asyncToGenerator(e(s).mark((function a(){var n,o,l,u,d,c;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,h.throwIfAborted)(i._controller.signal),!(0,f.isNone)(t.geometry)&&"mesh"!==t.geometry.type){e.next=2;break}return e.abrupt("return",null);case 2:if(n=t.geometry,!(0,x.isPolygon)(n)){e.next=7;break}o=n.rings,n.rings=o,e.next=16;break;case 7:if(!(0,x.isPolyline)(n)){e.next=11;break}l=n.paths,n.paths=l,e.next=16;break;case 11:if(!(0,x.isExtent)(n)){e.next=16;break}return e.next=14,i._getSymbolForGraphic(t,r);case 14:u=e.sent,(0,h.throwIfAborted)(i._controller.signal),n=(0,O.isMarkerSymbol)(u.type)||(0,O.isTextSymbol)(u.type)?n.center:(0,O.polygonFromExtent)(n);case 16:return e.next=18,(0,C.checkProjectionSupport)(n.spatialReference,i.view.spatialReference);case 18:return d=(0,_.normalizeCentralMeridianSync)(n),c=(0,C.project)(d,n.spatialReference,i.view.spatialReference),e.abrupt("return",((0,g.closeRingsAndFixWinding)(c),c));case 20:case"end":return e.stop()}}),a)})))()}},{key:"_onTileUpdate",value:function(e){var t=(0,b.getInfo)(this.view.spatialReference),r=!0,i=!1,a=void 0;if(e.added&&e.added.length>0)try{for(var n,s=e.added[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var o=n.value;this._addNewTile(o,t)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}var l=!0,u=!1,d=void 0;if(e.removed&&e.removed.length>0)try{for(var c,f=e.removed[Symbol.iterator]();!(l=(c=f.next()).done);l=!0){var h=c.value;this._removeTile(h.key)}}catch(e){u=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(u)throw d}}}},{key:"_addGraphic",value:function(t){var r=this;return n.asyncToGenerator(e(s).mark((function i(){var a,n;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r._abortProcessingGraphic(t.uid),(0,h.throwIfAborted)(r._controller.signal),a=new AbortController,r._graphicIdToAbortController.set(t.uid,a),n={signal:a.signal},e.prev=4,e.next=7,r._addOrUpdateGraphic(t,n);case 7:(0,h.throwIfAborted)(r._controller.signal),r._graphicIdToAbortController.delete(t.uid),e.next=15;break;case 11:if(e.prev=11,e.t0=e.catch(4),r._graphicIdToAbortController.delete(t.uid),(0,h.isAbortError)(e.t0)){e.next=15;break}throw e.t0;case 15:case"end":return e.stop()}}),i,null,[[4,11]])})))()}},{key:"_updateGraphic",value:function(e,t){var r=this;(0,h.throwIfAborted)(this._controller.signal);var i=this._projectAndNormalizeGeometry(e,t),a=this._getSymbolResources(e,t);return Promise.all([i,a]).then((function(t){var i=n.slicedToArray(t,2),a=i[0],s=i[1];(0,h.throwIfAborted)(r._controller.signal),r._graphicStore.addOrModify(e,s,a)}))}},{key:"_addOrUpdateGraphic",value:function(e,t){var r=this;(0,h.throwIfAborted)(this._controller.signal);var i=this._projectAndNormalizeGeometry(e,t),a=this._getSymbolResources(e,t);return Promise.all([i,a]).then((function(t){var i=n.slicedToArray(t,2),a=i[0],s=i[1];(0,h.throwIfAborted)(r._controller.signal),r._graphicsSet.has(e)&&r._graphicStore.addOrModify(e,s,a)}))}},{key:"_addTile",value:function(e){var t=this.view.featuresTilingScheme.getTileBounds((0,m.create)(),e),r=new(0,S.GraphicTile)(e,t[0],t[3]);return this._tiles.set(e,r),this.container.addChild(r),r}},{key:"_addNewTile",value:function(t,r){var i=this;return n.asyncToGenerator(e(s).mark((function a(){var n,o,l,u,d,c,f,y,v,p,m;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i._addTile(t.key),0!==(o=i._graphicStore.queryTileData(i._templateStore,t)).length){e.next=3;break}return e.abrupt("return");case 3:if(!r){e.next=22;break}for(l=Math.round((r.valid[1]-r.valid[0])/t.resolution),u=!0,d=!1,c=void 0,e.prev=6,f=o[Symbol.iterator]();!(u=(y=f.next()).done);u=!0)(v=y.value).geometry&&((0,x.isPoint)(v.geometry)||(0,x.isMultipoint)(v.geometry))&&i._wrapPoints(v,l);e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),d=!0,c=e.t0;case 14:e.prev=14,e.prev=15,u||null==f.return||f.return();case 17:if(e.prev=17,!d){e.next=20;break}throw c;case 20:return e.finish(17);case 21:return e.finish(14);case 22:return p=t.key,i._tileUpdateSet.add(t.key),i.notifyChange("updating"),e.prev=24,e.t1=!1,e.next=28,i._processGraphics(t,o);case 28:e.t2=e.sent,e.t3=[],e.t4=!0,e.t5=!1,m={type:"update",clear:e.t1,addOrUpdate:e.t2,remove:e.t3,end:e.t4,sort:e.t5},n.patch(m),i._tileUpdateSet.delete(p),i.notifyChange("updating"),e.next=40;break;case 36:if(e.prev=36,e.t6=e.catch(24),i._tileUpdateSet.delete(p),i.notifyChange("updating"),(0,h.isAbortError)(e.t6)){e.next=40;break}throw e.t6;case 40:case"end":return e.stop()}}),a,null,[[6,10,14,22],[15,,17,21],[24,36]])})))()}},{key:"_removeTile",value:function(e){if(this._tiles.has(e)){var t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}}},{key:"_setFilterState",value:function(e,t){var r=this._displayIds.get(e),i=this._attributeStore.getHighlightFlag(e);this._attributeStore.setData(r,0,0,i|(t?T.FILTER_FLAG_0:0))}},{key:"_getGraphicsData",value:function(e,t,r){var i=this.view,a=(0,b.getInfo)(i.spatialReference),n=this._graphicStore.getGraphicsData(e,t,r);if(a){var s=Math.round((a.valid[1]-a.valid[0])/t.resolution),o=!0,l=!1,u=void 0;try{for(var d,c=n[Symbol.iterator]();!(o=(d=c.next()).done);o=!0){var f=d.value;f.geometry&&((0,x.isPoint)(f.geometry)||(0,x.isMultipoint)(f.geometry))&&this._wrapPoints(f,s)}}catch(e){l=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(l)throw u}}}return n}},{key:"_wrapPoints",value:function(e,t){var r=e.geometry;(0,x.isMultipoint)(r)?this._wrapMultipoint(r,t):this._wrapPoint(e,t)}},{key:"_wrapMultipoint",value:function(e,t){var r=e.points,i=[],a=0,s=0,o=!0,l=!1,u=void 0;try{for(var d,c=r[Symbol.iterator]();!(o=(d=c.next()).done);o=!0){var f=n.slicedToArray(d.value,2),h=f[0],y=f[1];if(i.push([h+a,y]),a=0,t===O.TILE_SIZE){var v=5*O.PIXEL_BUFFER;h+s<v?(i.push([t,0]),a=-t):h+s>O.TILE_SIZE-v&&(i.push([-t,0]),a=t)}else h+s<-O.PIXEL_BUFFER?(i.push([t,0]),a=-t):h+s>O.TILE_SIZE+O.PIXEL_BUFFER&&(i.push([-t,0]),a=t);s+=h}}catch(e){l=!0,u=e}finally{try{o||null==c.return||c.return()}finally{if(l)throw u}}e.points=i}},{key:"_wrapPoint",value:function(e,t){var r=e.geometry;if(t===O.TILE_SIZE){var i=5*O.PIXEL_BUFFER;r.x<i?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>O.TILE_SIZE-i&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}else r.x<-O.PIXEL_BUFFER?e.geometry={points:[[r.x,r.y],[t,0]]}:r.x>O.TILE_SIZE+O.PIXEL_BUFFER&&(e.geometry={points:[[r.x,r.y],[-t,0]]})}},{key:"_processGraphics",value:function(e,t,r){var i=this;if(!t||!t.length||!this._meshFactory)return null;var a=P.GraphicsReader.from(t),n=this._meshFactory;return this._matcher.then((function(t){return n.analyzeGraphics(a,i.container.stage.resourceManager,t,null,null,r).then((function(){return i._attributeStore.sendUpdates(),i._processAnalyzedGraphics(e,a)}))}))}},{key:"_processAnalyzedGraphics",value:function(e,t){for(var r=this._meshFactory,i=t.getSize(),a=t.getCursor(),n={features:i,records:i,metrics:0},s=new(0,F.MeshData)(e.key.id,n,{fill:"default"},!1,!1),o=[];a.next();){var l=a.readGraphic();l.insertAfter=-1===l.insertAfter?-1:this._displayIds.get(l.insertAfter),l.displayId=this._displayIds.get(l.attributes[this.uid]);var u=new(0,B.default)(l.displayId);u.insertAfter=l.insertAfter,o.push(u),r.writeGraphic(s,a,e.level,this.container.stage.resourceManager)}var d=e.tileInfoView.tileInfo.isWrappable,c=s.serialize(d);if(1!==c.length)return new(0,D.TileData);var f=c[0].message;return D.TileData.fromVertexData(f,o)}},{key:"_abortProcessingGraphic",value:function(e){this._graphicIdToAbortController.has(e)&&this._graphicIdToAbortController.get(e).abort()}},{key:"_getNullSymbol",value:function(e){var t=e.geometry;return(0,x.isPolyline)(t)?w.errorPolylineSymbol2D:(0,x.isPolygon)(t)||(0,x.isExtent)(t)?w.errorPolygonSymbol2D:w.errorPointSymbol2D}},{key:"_flipUpdatingGraphics",value:function(){var e=this;this._updatingGraphicsTimer&&clearTimeout(this._updatingGraphicsTimer),this._updatingGraphicsTimer=setTimeout((function(){e._updatingGraphicsTimer=null,e.notifyChange("updating")}),160),this.notifyChange("updating")}}]),i}((0,E.GraphicsView)((0,d.HandleOwnerMixin)(l.default)));(0,o._)([(0,y.property)({constructOnly:!0})],q.prototype,"requestUpdateCallback",void 0),(0,o._)([(0,y.property)()],q.prototype,"container",void 0),(0,o._)([(0,y.property)({constructOnly:!0})],q.prototype,"graphics",void 0),(0,o._)([(0,y.property)()],q.prototype,"updating",null),(0,o._)([(0,y.property)()],q.prototype,"view",void 0),(0,o._)([(0,y.property)()],q.prototype,"updateRequested",void 0);var H=q=(0,o._)([(0,v.subclass)("esri.views.2d.layers.support.GraphicsView2D")],q)})),r.register("fDoeM",(function(e,i){t(e.exports,"normalizeCentralMeridianSync",(function(){return c}));var a=r("8TSCy"),n=r("8TwEW"),s=r("5Hy9K"),o=r("80GBQ"),l=r("79LpT"),u=r("7E1SV"),d=r("eY5Yp");function c(e){if(!e)return null;var t=null,r=e.spatialReference,i=(0,d.getInfo)(r);if(!i)return"toJSON"in e?e.toJSON():e;var n,c=(0,d.isWebMercator)(r)?102100:4326,v=u.cutParams[c].maxX,g=u.cutParams[c].minX,x=u.cutParams[c].plus180Line,_=u.cutParams[c].minus180Line,b="toJSON"in e?e.toJSON():e;if((0,l.isPoint)(b))n=f(b,v,g);else if((0,l.isMultipoint)(b))b.points=b.points.map((function(e){return f(e,v,g)})),n=b;else if((0,l.isExtent)(b))n=function(e,t){if(!t)return e;var r=function(e,t){var r,i=[],n=e.ymin,s=e.ymax,o=e.xmax-e.xmin,l=e.xmin,u=e.xmax,d=a.slicedToArray(t.valid,2),c=d[0],f=d[1],v=(r=h(e.xmin,t)).x,p=r.frameId,m=(r=h(e.xmax,t)).x,g=r.frameId,x=v===m&&o>0;if(o>2*f){var _={xmin:l<u?v:m,ymin:n,xmax:f,ymax:s},b={xmin:c,ymin:n,xmax:l<u?m:v,ymax:s},C={xmin:0,ymin:n,xmax:f,ymax:s},k={xmin:c,ymin:n,xmax:0,ymax:s},w=[],T=[];y(_,C)&&w.push(p),y(_,k)&&T.push(p),y(b,C)&&w.push(g),y(b,k)&&T.push(g);for(var S=p+1;S<g;S++)w.push(S),T.push(S);i.push({extent:_,frameIds:[p]},{extent:b,frameIds:[g]},{extent:C,frameIds:w},{extent:k,frameIds:T})}else v>m||x?i.push({extent:{xmin:v,ymin:n,xmax:f,ymax:s},frameIds:[p]},{extent:{xmin:c,ymin:n,xmax:m,ymax:s},frameIds:[g]}):i.push({extent:{xmin:v,ymin:n,xmax:m,ymax:s},frameIds:[p]});return i}(e,t).map((function(e){return e.extent}));return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map((function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]}))}}(b,i);else if((0,l.isPolygon)(b)||(0,l.isPolyline)(b)){var C=m;(0,s.getBoundsXY)(C,b);var k={xmin:C[0],ymin:C[1],xmax:C[2],ymax:C[3]},w=(0,u.offsetMagnitude)(k.xmin,g)*(2*v),T=0===w?b:function(e,t){var r=(0,u.getGeometryParts)(e),i=!0,a=!1,n=void 0,s=!0,o=!1,l=void 0;try{for(var d,c=r[Symbol.iterator]();!(s=(d=c.next()).done);s=!0){var f=d.value;try{for(var h,y=f[Symbol.iterator]();!(i=(h=y.next()).done);i=!0){h.value[0]+=t}}catch(e){a=!0,n=e}finally{try{i||null==y.return||y.return()}finally{if(a)throw n}}}}catch(e){o=!0,l=e}finally{try{s||null==c.return||c.return()}finally{if(o)throw l}}return e}(b,w);k.xmin+=w,k.xmax+=w,(0,o.extentIntersectsPolyline)(k,x)&&k.xmax!==v||(0,o.extentIntersectsPolyline)(k,_)&&k.xmin!==g?t=T:n=T}else n=b;return null!==t?(new p).cut(t,v):n}function f(e,t,r){if(Array.isArray(e)){var i=e[0];if(i>t){var a=(0,u.offsetMagnitude)(i,t);e[0]=i+a*(-2*t)}else if(i<r){var n=(0,u.offsetMagnitude)(i,r);e[0]=i+n*(-2*r)}}else{var s=e.x;if(s>t){var o=(0,u.offsetMagnitude)(s,t);e.x+=o*(-2*t)}else if(s<r){var l=(0,u.offsetMagnitude)(s,r);e.x+=l*(-2*r)}}return e}function h(e,t){var r,i=a.slicedToArray(t.valid,2),n=i[0],s=i[1],o=2*s,l=0;return e>s?(e-=(r=Math.ceil(Math.abs(e-s)/o))*o,l=r):e<n&&(e+=(r=Math.ceil(Math.abs(e-n)/o))*o,l=-r),{x:e,frameId:l}}function y(e,t){var r=t.xmin,i=t.ymin,a=t.xmax,n=t.ymax;return v(e,r,i)&&v(e,r,n)&&v(e,a,n)&&v(e,a,i)}function v(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}var p=function(){"use strict";function e(){a.classCallCheck(this,e)}return a.createClass(e,[{key:"cut",value:function(e,t){var r;if(e.rings)this.closed=!0,r=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,r=e.paths,this.minPts=2}for(var i=r.length,a=-2*t,n=0;n<i;n++){var s=r[n];if(s&&s.length>=this.minPts){var o=[],l=!0,u=!1,d=void 0;try{for(var c,f=s[Symbol.iterator]();!(l=(c=f.next()).done);l=!0){var h=c.value;o.push([h[0]+a,h[1]])}}catch(e){u=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(u)throw d}}r.push(o)}}return this.closed?e.rings=r:e.paths=r,e}}]),e}(),m=(0,n.create)()})),r.register("3kinH",(function(e,i){t(e.exports,"GraphicTile",(function(){return l}));var a=r("8TSCy"),n=r("8g5yZ"),s=r("4q6AC"),o=r("JmPPi"),l=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){var e;return a.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))))._data=null,e._displayList=null,e._lastCommitTime=0,e._hasData=!1,e._invalidated=!1,e._wglBuffers=null,e._dirtyMap=new(0,n.default),a.possibleConstructorReturn(e)}return a.createClass(r,[{key:"destroy",value:function(){a.get(a.getPrototypeOf(r.prototype),"destroy",this).call(this),this.clear()}},{key:"hasData",get:function(){return!!this._hasData}},{key:"displayObjects",get:function(){var e;return null!=(e=this._displayObjects)?e:[]}},{key:"getGeometry",value:function(e){return this._wglBuffers&&this._wglBuffers.has(e)?this._wglBuffers.get(e):null}},{key:"getDisplayList",value:function(){return this._displayList}},{key:"patch",value:function(e){if(!0===e.clear)return this.clear(),void(this._hasData=!1);var t=e.addOrUpdate,r=e.remove;!this._data&&t&&t.tileDisplayData.displayObjects.length?(t.tileDisplayData.computeDisplayList(),this._dirtyMap=new(0,n.default),this._dispRecStore=s.default.fromTileData(t,this._dirtyMap),this._data=t,this._dirtyMap.markAllDirty(),this._hasData=!0,e.end&&this.ready()):this._data&&(t&&t.tileDisplayData.displayObjects.length||r.length)?this._doPatchData(e):e.end&&this.ready(),e.end&&!this._data&&this.clear(),this.requestRender(),this.emit("change")}},{key:"commit",value:function(e){e.time&&e.time===this._lastCommitTime||(this._lastCommitTime=e.time,this.visible&&this._data&&(this._wglBuffers||(this._wglBuffers=new(0,o.default)(e.context)),(this._dirtyMap.hasDirty()||this._invalidated)&&(this._invalidated=!1,this._wglBuffers.upload(this._data.tileBufferData,this._dirtyMap),this._displayList=this._data.tileDisplayData.displayList.clone(),this._displayObjects=this._data.tileDisplayData.displayObjects.slice(),this._dirtyMap.markAllClean())))}},{key:"clear",value:function(){this._data=null,this._displayList=null,this._dispRecStore=null,this._wglBuffers&&(this._wglBuffers.dispose(),this._wglBuffers=null)}},{key:"_doPatchData",value:function(e){this._invalidated=!0,this._patchData(e)||(this._dirtyMap.markAllDirty(),this._data.reshuffle(),this._dispRecStore=s.default.fromTileData(this._data,this._dirtyMap)),this.requestRender()}},{key:"_patchData",value:function(e){var t=!0,r=e.addOrUpdate&&e.addOrUpdate.tileDisplayData&&e.addOrUpdate.tileDisplayData.displayObjects||[],i=(e.remove||[]).slice(),a=!0,n=!1,s=void 0;try{for(var o,l=r[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value;null!=u.insertAfter&&i.push(u.id)}}catch(e){n=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(n)throw s}}var d=!0,c=!1,f=void 0;try{for(var h,y=i[Symbol.iterator]();!(d=(h=y.next()).done);d=!0){var v=h.value,p=this._data.tileDisplayData.displayObjectRegistry.get(v);if(p){this._data.tileDisplayData.displayList.removeFromList(p.displayRecords);var m=!0,g=!1,x=void 0;try{for(var _,b=p.displayRecords[Symbol.iterator]();!(m=(_=b.next()).done);m=!0){var C=_.value;this._dispRecStore.delete(C)}}catch(e){g=!0,x=e}finally{try{m||null==b.return||b.return()}finally{if(g)throw x}}this._data.tileDisplayData.displayObjectRegistry.delete(v);var k=this._data.tileDisplayData.displayObjects.indexOf(p);this._data.tileDisplayData.displayObjects.splice(k,1)}}}catch(e){c=!0,f=e}finally{try{d||null==y.return||y.return()}finally{if(c)throw f}}var w=!0,T=!1,S=void 0;try{for(var D,B=r[Symbol.iterator]();!(w=(D=B.next()).done);w=!0){var F=D.value,I=void 0,M=this._data.tileDisplayData.displayObjectRegistry.get(F.id);if(M){var L=M.displayRecords;M.set(F),M.displayRecords=L;for(var R=M.displayRecords.length,A=0;A<R;++A){var G=M.displayRecords[A],P=F.displayRecords[A];(A>=F.displayRecords.length||G.geometryType!==P.geometryType||G.symbolLevel!==P.symbolLevel||G.zOrder!==P.zOrder||G.materialKey!==P.materialKey)&&(this._dispRecStore.delete(M.displayRecords[A]),A<F.displayRecords.length&&(M.displayRecords[A]=void 0))}M.displayRecords.length=F.displayRecords.length}else{var z=void 0;(M=F.copy()).displayRecords=[],this._data.tileDisplayData.displayObjectRegistry.set(F.id,M);var O=this._data.tileDisplayData.displayObjects;if(null!=M.insertAfter)if(I={},M.insertAfter>=0){var V=this._data.tileDisplayData.displayObjectRegistry.get(M.insertAfter);V?(z=O.indexOf(V)+1)<O.length?O.splice(z,0,M):(O.push(M),z=O.length):(O.push(M),z=O.length)}else O.unshift(M),z=0;else O.push(M),z=O.length;if(I)for(var E=F.displayRecords.length>0?1:0,U=0,j=z-1;j>=0&&U<E;--j)for(var K=O[j].displayRecords.length-1;K>=0&&U<E;--K){var W=O[j].displayRecords[K],q=this._data.tileDisplayData.displayList.getDPInfoType();I[q]||(I[q]=W,++U)}}for(var H=F.displayRecords.length,N=0;N<H;++N){var X=F.displayRecords[N],Z=M.displayRecords[N];Z?(Z.meshData=X.meshData,Z.materialKey=X.materialKey):((Z=X.copy()).vertexFrom=void 0,Z.indexFrom=void 0,M.displayRecords[N]=Z);var J=X.geometryType,Y=this._data.tileDisplayData.displayList.getDPInfoType(),Q=e.addOrUpdate.tileBufferData.geometries[J],$=Q.vertexBuffer,ee=Q.indexBuffer,te=void 0;I&&(te=I[Y]?this._data.tileDisplayData.displayList.splitAfter(I[Y]):-1),t=this._dispRecStore.setMeshData(Z,X,$,ee,te)&&t,I&&null!=Z.indexFrom&&null!=Z.indexFrom&&(I[Y]=Z)}}}catch(e){T=!0,S=e}finally{try{w||null==B.return||B.return()}finally{if(T)throw S}}return t}}]),r}(r("gINiF").WGLTile)})),r.register("8g5yZ",(function(e,i){t(e.exports,"default",(function(){return s}));var a=r("8TSCy"),n=-1,s=function(){"use strict";function e(){a.classCallCheck(this,e),this._dirties=[{vertexFrom:n,vertexCount:n,indexFrom:n,indexCount:n,allDirty:!1},{vertexFrom:n,vertexCount:n,indexFrom:n,indexCount:n,allDirty:!1},{vertexFrom:n,vertexCount:n,indexFrom:n,indexCount:n,allDirty:!1},{vertexFrom:n,vertexCount:n,indexFrom:n,indexCount:n,allDirty:!1},{vertexFrom:n,vertexCount:n,indexFrom:n,indexCount:n,allDirty:!1}]}return a.createClass(e,[{key:"hasDirty",value:function(){return this._dirties.some((function(e){return e.indexCount!==n||e.allDirty}))}},{key:"markAllClean",value:function(){var e=!0,t=!1,r=void 0;try{for(var i,a=this._dirties[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var s=i.value;s.indexFrom=n,s.indexCount=n,s.vertexFrom=n,s.vertexCount=n,s.allDirty=!1}}catch(e){t=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}}},{key:"markAllDirty",value:function(){var e=!0,t=!1,r=void 0;try{for(var i,a=this._dirties[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){i.value.allDirty=!0}}catch(e){t=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}}},{key:"forEach",value:function(e){for(var t=0;t<this._dirties.length;++t){var r=this._dirties[t],i=r.indexCount,a=r.indexFrom,s=r.vertexCount,o=r.vertexFrom,l=r.allDirty,u={},d=void 0,c=!1;(l||o!==n&&s>0)&&(u.geometry={count:s,from:o,allDirty:l},c=!0),(l||a!==n&&i>0)&&(d={count:i,from:a,allDirty:l},c=!0),c&&e({indices:d,vertices:u},t)}}},{key:"markDirtyIndices",value:function(e,t,r){var i=this._dirties[e],a=t,s=r;if(!i.allDirty)if(i.indexCount!==n){var o=Math.min(i.indexFrom,a),l=Math.max(i.indexFrom+i.indexCount,a+s)-o;i.indexFrom=o,i.indexCount=l}else i.indexFrom=a,i.indexCount=s}},{key:"markDirtyVertices",value:function(e,t,r,i){var a=this._dirties[e],s=r,o=i;if(!a.allDirty)if(a.vertexCount!==n){var l=Math.min(a.vertexFrom,s),u=Math.max(a.vertexFrom+a.vertexCount,s+o)-l;a.vertexFrom=l,a.vertexCount=u}else a.vertexFrom=s,a.vertexCount=o}}]),e}()})),r.register("4q6AC",(function(e,i){t(e.exports,"default",(function(){return l}));var a=r("8TSCy");r("2VlWd");var n=r("7UqHt"),s=r("5WctK"),o=["FILL","LINE","MARKER","TEXT","LABEL"];var l=function(){"use strict";function e(t,r,i,o){for(var l in a.classCallCheck(this,e),this._strides=t,this._displayList=r,this._freeListsAndStorage={},this._dirtyMap=null,this._dirtyMap=i,t)for(var u in this._freeListsAndStorage[l]={vtxFreeList:o?new(0,n.FreeList)(o):null,idxFreeList:o?new(0,n.FreeList)(o):null,vertexBuffers:{},indexBuffer:o?new Uint32Array(o):null},t[l])this._freeListsAndStorage[l].vertexBuffers[u]={data:o?(0,s.allocateTypedArrayBuffer)(o,t[l][u]):null,stride:t[l][u]}}return a.createClass(e,[{key:"delete",value:function(e){var t=o[e.geometryType];this._freeVertices(t,e.vertexFrom,e.vertexCount),this._freeIndices(t,e.indexFrom,e.indexCount),this._displayList.removeFromList(e),e.vertexFrom=void 0,e.indexFrom=void 0}},{key:"setMeshData",value:function(e,t,r,i,a){var n,l,u=o[e.geometryType];e.meshData=null,void 0===e.vertexFrom?(l=t.vertexCount,n=this._allocateVertices(u,l)):t.vertexCount>e.vertexCount?(this._freeVertices(u,e.vertexFrom,e.vertexCount),l=t.vertexCount,n=this._allocateVertices(u,l)):t.vertexCount===e.vertexCount?(n=e.vertexFrom,l=e.vertexCount):(this._freeVertices(u,e.vertexFrom+t.vertexCount,e.vertexCount-t.vertexCount),n=e.vertexFrom,l=t.vertexCount);var d,c,f,h=!0;if(void 0===e.indexFrom?(d=a,f=t.indexCount,c=this._allocateIndices(u,f)):t.indexCount>e.indexCount?(d=this._displayList.removeFromList(e),this._freeIndices(u,e.indexFrom,e.indexCount),f=t.indexCount,c=this._allocateIndices(u,f)):t.indexCount===e.indexCount?(h=!1,c=e.indexFrom,f=e.indexCount):(d=this._displayList.removeFromList(e),this._freeIndices(u,e.indexFrom+t.indexCount,e.indexCount-t.indexCount),c=e.indexFrom,f=t.indexCount),-1!==n&&-1!==c){var y=this._storageFor(u);if((0,s.copyMeshData)(n,c,y.vertexBuffers,y.indexBuffer,t,r,i),e.vertexFrom=n,e.indexFrom=c,e.vertexCount=t.vertexCount,e.indexCount=t.indexCount,this._dirtyMap)for(var v in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),r)this._dirtyMap.markDirtyVertices(e.geometryType,v,e.vertexFrom,e.vertexCount);return h&&this._displayList.addToList(e,d),!0}return-1!==n&&this._freeVertices(u,n,l),-1!==c&&this._freeIndices(u,c,f),e.setMeshDataFromBuffers(t,r,i),e.vertexFrom=void 0,e.vertexCount=0,e.indexFrom=void 0,e.indexCount=0,!1}},{key:"tryAddMeshData",value:function(e,t){var r=t.vertexBuffer,i=t.indexBuffer,a=o[e.geometryType],n=this._allocateVertices(a,e.vertexCount);if(-1===n)return this._freeVertices(a,n,e.vertexCount),!1;var l=this._allocateIndices(a,e.indexCount);if(-1===l)return this._freeVertices(a,n,e.vertexCount),this._freeIndices(a,l,e.indexCount),!1;var u=this._storageFor(a);if((0,s.copyMeshData)(n,l,u.vertexBuffers,u.indexBuffer,e,r,i),e.vertexFrom=n,e.indexFrom=l,this._dirtyMap)for(var d in this._dirtyMap.markDirtyIndices(e.geometryType,e.indexFrom,e.indexCount),r)this._dirtyMap.markDirtyVertices(e.geometryType,d,n,e.vertexCount);return this._displayList.addToList(e),!0}},{key:"_allocateVertices",value:function(e,t){var r=this._storageFor(e),i=r.vtxFreeList.allocate(t);return-1===i||r.vtxFreeList.fragmentation>.5?-1:i}},{key:"_freeVertices",value:function(e,t,r){this._storageFor(e).vtxFreeList.free(t,r)}},{key:"_freeIndices",value:function(e,t,r){this._storageFor(e).idxFreeList.free(t,r)}},{key:"_allocateIndices",value:function(e,t){var r=this._storageFor(e),i=r.idxFreeList.allocate(t);return-1===i||r.idxFreeList.fragmentation>.5?-1:i}},{key:"_storageFor",value:function(e){return this._freeListsAndStorage[e]}},{key:"_stridesFor",value:function(e,t){return this._strides[e][t]}}],[{key:"fromTileData",value:function(t,r){var i=function(e){for(var t=e.getStrides(),r={},i=0;i<t.length;i++)r[o[i]]=t[i];return r}(t),a=[0,0,0,0,0],l=[0,0,0,0,0],u=t.tileDisplayData.displayObjects,d=!0,c=!1,f=void 0,h=!0,y=!1,v=void 0;try{for(var p,m=u[Symbol.iterator]();!(h=(p=m.next()).done);h=!0){var g=p.value;try{for(var x,_=g.displayRecords[Symbol.iterator]();!(d=(x=_.next()).done);d=!0){var b=x.value;a[b.geometryType]=Math.max(a[b.geometryType],b.vertexFrom+b.vertexCount),l[b.geometryType]=Math.max(l[b.geometryType],b.indexFrom+b.indexCount)}}catch(e){c=!0,f=e}finally{try{d||null==_.return||_.return()}finally{if(c)throw f}}}}catch(e){y=!0,v=e}finally{try{h||null==m.return||m.return()}finally{if(y)throw v}}for(var C=new e(i,t.tileDisplayData.displayList,r,null),k=0;k<t.tileBufferData.geometries.length;++k){var w=a[k],T=l[k],S=t.tileBufferData.geometries[k],D=o[k],B=C._storageFor(D),F=t.tileBufferData.geometries[k].indexBuffer,I=void 0;for(var M in B.indexBuffer=F,B.idxFreeList=new(0,n.FreeList)(F.length),B.idxFreeList.allocate(T),S.vertexBuffer){var L=t.tileBufferData.geometries[k].vertexBuffer[M];B.vertexBuffers[M].data=L.data,B.vertexBuffers[M].stride=L.stride;var R=(0,s.strideToPackingFactor)(L.stride),A=L.data.length*R/L.stride;I||(I=A)}B.vtxFreeList=new(0,n.FreeList)(I),B.vtxFreeList.allocate(w)}return C}}]),e}()})),r.register("7UqHt",(function(e,i){t(e.exports,"FreeList",(function(){return s}));var a=r("8TSCy"),n=function(){"use strict";function e(t){a.classCallCheck(this,e),this._largestRange=null,this._parent=t,this._updateLargestRange()}return a.createClass(e,[{key:"largestRange",get:function(){return this._largestRange}},{key:"rangeCreated",value:function(e){(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}},{key:"rangeResized",value:function(e,t){e===this._largestRange?e.count<t&&this._updateLargestRange():(!this._largestRange||e.count>this._largestRange.count)&&(this._largestRange=e)}},{key:"findBestRange",value:function(e){for(var t=this._parent._freeHead,r=null;null!==t;)t.count>=e&&(!r||t.count-e<r.count-e)&&(r=t),t=t.next;return r}},{key:"findAdjacentRanges",value:function(e,t){for(var r=!0,i=!1,a=null,n=this._parent._freeHead;r&&!i;){var s=null!==a?a.from+a.count:0,o=null!==n?n.from:this._parent._size;e>=s&&e+t<=o?(r=!1,i=!0):null!==n?(a=n,n=n.next):r=!1}return[a,n]}},{key:"_updateLargestRange",value:function(){for(var e=null,t=this._parent._freeHead;null!==t;)(!e||t.count>e.count)&&(e=t),t=t.next;this._largestRange=e}}]),e}(),s=function(){"use strict";function e(t,r){a.classCallCheck(this,e),this._allocated=0,this._size=t,this._freeHead=t>0?{from:0,count:t,prev:null,next:null}:null,this._bookKeeper=r||new n(this),this._freeHead&&this._bookKeeper.rangeCreated(this._freeHead)}return a.createClass(e,[{key:"allocate",value:function(t){var r=this._bookKeeper.findBestRange(t);if(null===r)return-1;var i=r.from,a=r.count;if(r.from+=t,r.count-=t,this._bookKeeper.rangeResized(r,i,a),this._allocated+=t,0===r.count){var n=null!==r.prev?this._freeHead:r.next;e._removeRange(r),this._freeHead=n}return i}},{key:"free",value:function(t,r){var i=a.slicedToArray(this._bookKeeper.findAdjacentRanges(t,r),2),n=i[0],s=i[1],o={from:t,count:r,prev:n,next:s};if(null!==n&&(n.next=o),null!==s&&(s.prev=o),this._bookKeeper.rangeCreated(o),this._allocated-=r,null!==s&&o.from+o.count===s.from){var l=o.from,u=o.count;e._fuse(o,s),e._removeRange(s),this._bookKeeper.rangeResized(o,l,u),this._bookKeeper.rangeResized(s,void 0,0)}if(null!==n&&n.from+n.count===o.from){var d=n.from,c=n.count;e._fuse(n,o),e._removeRange(o),this._bookKeeper.rangeResized(n,d,c),this._bookKeeper.rangeResized(o,void 0,0)}this._freeHead=null!==o.prev?this._freeHead:o}},{key:"fragmentation",get:function(){var e=this._size-this._allocated;return 0===e?0:1-this._bookKeeper.largestRange.count/e}}],[{key:"_removeRange",value:function(e){null!==e.prev?null!==e.next?(e.prev.next=e.next,e.next.prev=e.prev):e.prev.next=null:null!==e.next&&(e.next.prev=null)}},{key:"_fuse",value:function(e,t){e.count+=t.count,e.next=t.next,t.from+=t.count,t.count=0,null!==t.next&&(t.next.prev=e)}}]),e}()})),r.register("JmPPi",(function(e,i){t(e.exports,"default",(function(){return u}));var a=r("8TSCy"),n=r("5WctK"),s=r("iRJeW"),o=r("8JzMA"),l=r("4aQus"),u=function(){"use strict";function e(t){a.classCallCheck(this,e),this.geometryMap=(0,n.createGeometryData)((function(){return{indexBuffer:s.BufferObject.createIndex(t,o.Usage.STATIC_DRAW),vao:null}}),(function(e,r){return{vertexBuffer:s.BufferObject.createVertex(t,n.C_VBO_INFO[r])}}))}return a.createClass(e,[{key:"dispose",value:function(){for(var e=0;e<5;e++){var t=this.geometryMap[e];if(t)for(var r in t.data.vao&&t.data.vao.dispose(!1),t.data.indexBuffer&&t.data.indexBuffer.dispose(),t.buffers)t.buffers[r]&&t.buffers[r].data.vertexBuffer.dispose()}}},{key:"get",value:function(e){var t=this.geometryMap[e];return{getVAO:function(e,r,i){if(!t.data.vao){var a={};for(var n in t.buffers)a[n]=t.buffers[n].data.vertexBuffer;t.data.vao=new(0,l.VertexArrayObject)(e,i,r,a,t.data.indexBuffer)}return t.data.vao}}}},{key:"has",value:function(e){return null!=this.geometryMap[e]}},{key:"upload",value:function(e,t){var r=this;t.forEach((function(t,i){r._upload(t,i,e)}))}},{key:"_upload",value:function(e,t,r){if(e.indices&&(e.indices.allDirty?this._uploadIndices(r,t):null!=e.indices.from&&null!=e.indices.count&&this._uploadIndices(r,t,e.indices.from,e.indices.count)),e.vertices){var i=e.vertices;for(var a in i){var n=i[a];n.allDirty?this._uploadVertices(r,t,a):null!=n.from&&null!=n.count&&this._uploadVertices(r,t,a,n.from,n.count)}}}},{key:"_uploadVertices",value:function(e,t,r,i,a){var n=this.geometryMap[t];if(n){var s=e.geometries[t].vertexBuffer[r];if(s){var o=s.stride,l=s.data.buffer;n.buffers[r]&&l.byteLength>0&&(null!=i&&null!=a?n.buffers[r].data.vertexBuffer.setSubData(l,i*o,i*o,(i+a)*o):n.buffers[r].data.vertexBuffer.setData(l))}}}},{key:"_uploadIndices",value:function(e,t,r,i){var a=this.geometryMap[t];if(a){var n=e.geometries[t].indexBuffer.buffer;a.data.indexBuffer&&n.byteLength>0&&(null!=r&&null!=i?a.data.indexBuffer.setSubData(n,4*r,4*r,4*(r+i)):a.data.indexBuffer.setData(n))}}}]),e}()})),r.register("6WOnF",(function(e,i){t(e.exports,"TileData",(function(){return g}));var a=r("8TSCy"),n=r("7qybv"),s=r("a3keH"),o=r("6KY07"),l=r("b63R8"),u=r("5WctK"),d=r("1uPnB"),c=r("kgLNq"),f=r("jTLfv"),h=r("f5ROF"),y=r("8laiu"),v=new(0,s.default),p=new(0,s.default);function m(e,t){var r={};for(var i in e){var a={data:(0,u.allocateTypedArrayBuffer)(t,e[i]),stride:e[i]};r[i]=a}return r}var g=function(){"use strict";function e(){a.classCallCheck(this,e),this.tileDisplayData=null,this.tileBufferData=null}return a.createClass(e,[{key:"reshuffle",value:function(){v.reset();var t=(0,l.groupRecordsByGeometryType)(this.tileDisplayData.displayObjects),r=!0,i=!1,a=void 0,n=!0,s=!1,d=void 0;try{for(var c,f=t[Symbol.iterator]();!(n=(c=f.next()).done);n=!0){var h=c.value;try{for(var y,m=h[Symbol.iterator]();!(r=(y=m.next()).done);r=!0){var g=y.value;g&&v.needMore(g.geometryType,g.meshData?g.meshData.vertexCount:g.vertexCount,g.meshData?g.meshData.indexData.length:g.indexCount)}}catch(e){i=!0,a=e}finally{try{r||null==m.return||m.return()}finally{if(i)throw a}}}}catch(e){s=!0,d=e}finally{try{n||null==f.return||f.return()}finally{if(s)throw d}}for(var x=t.length,_=new(0,o.default),b=0;b<x;++b){_.geometries[b].indexBuffer=new Uint32Array(Math.round(1.5*v.indicesFor(b)));var C=[];for(var k in this.tileBufferData.geometries[b].vertexBuffer)C.push(this.tileBufferData.geometries[b].vertexBuffer[k].stride);var w=e._computeVertexAlignment(C),T=Math.round(1.5*v.verticesFor(b)),S=e._align(T,w);for(var D in this.tileBufferData.geometries[b].vertexBuffer){var B=this.tileBufferData.geometries[b].vertexBuffer[D].stride;_.geometries[b].vertexBuffer[D]={stride:B,data:(0,u.allocateTypedArrayBuffer)(S,B)}}}p.reset(),this.tileDisplayData.displayList.clear();for(var F=0;F<x;++F){var I=t[F],M=!0,L=!1,R=void 0;try{for(var A,G=I[Symbol.iterator]();!(M=(A=G.next()).done);M=!0){var P=A.value;if(P.meshData)P.writeMeshDataToBuffers(p.verticesFor(F),_.geometries[F].vertexBuffer,p.indicesFor(F),_.geometries[F].indexBuffer),P.meshData=null;else{var z=this.tileBufferData.geometries[F].vertexBuffer,O=this.tileBufferData.geometries[F].indexBuffer,V=_.geometries[F].vertexBuffer,E=_.geometries[F].indexBuffer,U=p.verticesFor(F),j=p.indicesFor(F);(0,u.copyMeshData)(U,j,V,E,P,z,O),P.vertexFrom=U,P.indexFrom=j}p.needMore(F,P.vertexCount,P.indexCount)}}catch(e){L=!0,R=e}finally{try{M||null==G.return||G.return()}finally{if(L)throw R}}}var K=!0,W=!1,q=void 0;try{for(var H,N=this.tileDisplayData.displayObjects[Symbol.iterator]();!(K=(H=N.next()).done);K=!0){var X=H.value;this.tileDisplayData.displayList.addToList(X.displayRecords)}}catch(e){W=!0,q=e}finally{try{K||null==N.return||N.return()}finally{if(W)throw q}}this.tileBufferData=_}},{key:"getStrides",value:function(){for(var e=[],t=0;t<this.tileBufferData.geometries.length;++t){var r=this.tileBufferData.geometries[t];for(var i in e[t]={},r.vertexBuffer)e[t][i]=r.vertexBuffer[i].stride}return e}},{key:"clone",value:function(){var t=new e;return t.tileBufferData=this.tileBufferData.clone(),t.tileDisplayData=this.tileDisplayData.clone(),t}},{key:"_guessSize",value:function(){for(var e=this.tileDisplayData.displayObjects,t=Math.min(e.length,4),r=0,i=0;i<t;i++)r=Math.max(r,e[i].displayRecords.length);return 2*(12*e.length+e.length*r*40)}},{key:"serialize",value:function(){var e=this.tileBufferData.serialize(),t=this.tileBufferData.getBuffers(),r=this.tileDisplayData.serialize(new(0,y.default)(Int32Array,this._guessSize())).buffer();return t.push(r),{result:{displayData:r,bufferData:e},transferList:t}}}],[{key:"fromVertexData",value:function(t,r){var i={},a=new Map,s=!0,o=!1,l=void 0;try{for(var y,v=r[Symbol.iterator]();!(s=(y=v.next()).done);s=!0){var p=y.value;a.set(p.id,p)}}catch(e){o=!0,l=e}finally{try{s||null==v.return||v.return()}finally{if(o)throw l}}return(0,u.forEachGeometryType)((function(e){var r=t.data[e];if((0,n.isSome)(r)){for(var s=c.DisplayRecordReader.from(r.records).getCursor();s.next();){var o=s.id,l=s.materialKey,u=s.indexFrom,y=s.indexCount,v=s.vertexFrom,p=s.vertexCount,m=a.get(o),g=new(0,d.default)(o,e,l);g.indexFrom=u,g.indexCount=y,g.vertexFrom=v,g.vertexCount=p,m.displayRecords.push(g)}i[e]=f.VertexBuffers.fromVertexData(r,e)}else i[e]=new(0,h.VertexVectors)(e,0,{fill:"default"}).intoBuffers()})),e.fromMeshData({displayObjects:r,vertexBuffersMap:i})}},{key:"fromMeshData",value:function(t){var r=new e,i=new(0,l.default),a=new(0,o.default);for(var n in i.displayObjects=t.displayObjects,t.vertexBuffersMap){var s=t.vertexBuffersMap[n];a.geometries[n].indexBuffer=s.indexBuffer,a.geometries[n].vertexBuffer=s.namedBuffers}return r.tileDisplayData=i,r.tileBufferData=a,r}},{key:"bind",value:function(t,r){var i=new e;return i.tileDisplayData=t,i.tileBufferData=r,i}},{key:"create",value:function(t,r){var i=new e;i.tileDisplayData=new(0,l.default),i.tileDisplayData.displayObjects=t;var a=[0,0,0,0,0],n=[0,0,0,0,0],s=[[],[],[],[],[]],u=!0,c=!1,f=void 0,h=!0,y=!1,v=void 0;try{for(var p,g=t[Symbol.iterator]();!(h=(p=g.next()).done);h=!0){var x=p.value;try{for(var _,b=x.displayRecords[Symbol.iterator]();!(u=(_=b.next()).done);u=!0){var C=_.value;s[C.geometryType].push(C),a[C.geometryType]+=C.meshData.vertexCount,n[C.geometryType]+=C.meshData.indexData.length}}catch(e){c=!0,f=e}finally{try{u||null==b.return||b.return()}finally{if(c)throw f}}}}catch(e){y=!0,v=e}finally{try{h||null==g.return||g.return()}finally{if(y)throw v}}for(var k,w=new(0,o.default),T=[(k=r).fill||{},k.line||{},k.icon||{},k.text||{},k.label||{}],S=0;S<5;S++){var D=new Uint32Array(n[S]),B=m(T[S],a[S]);d.default.writeAllMeshDataToBuffers(s[S],B,D),w.geometries[S]={indexBuffer:D,vertexBuffer:B}}return i.tileBufferData=w,i}},{key:"_align",value:function(e,t){var r=e%t;return 0===r?e:e+(t-r)}},{key:"_computeVertexAlignment",value:function(e){var t=!1,r=!1,i=!0,a=!1,n=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var l=s.value;l%4==2?t=!0:l%4!=0&&(r=!0)}}catch(e){a=!0,n=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw n}}return r?4:t?2:1}}]),e}()})),r.register("a3keH",(function(e,i){t(e.exports,"default",(function(){return n}));var a=r("8TSCy"),n=function(){"use strict";function e(){a.classCallCheck(this,e),this._byGeometryType=null}return a.createClass(e,[{key:"satisfied",get:function(){return!this._byGeometryType}},{key:"reset",value:function(){this._byGeometryType=null}},{key:"verticesFor",value:function(e){return this._byGeometryType?this._byGeometryType[e].vertices:0}},{key:"indicesFor",value:function(e){return this._byGeometryType?this._byGeometryType[e].indices:0}},{key:"needMore",value:function(e,t,r){if(t||r){this._byGeometryType||(this._byGeometryType=[{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0},{vertices:0,indices:0}]);var i=this._byGeometryType[e];i.vertices+=t,i.indices+=r}}}]),e}()})),r.register("6KY07",(function(e,i){t(e.exports,"default",(function(){return s}));var a=r("8TSCy"),n=r("5WctK"),s=function(){"use strict";function e(){a.classCallCheck(this,e),this.geometries=[{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}},{indexBuffer:void 0,vertexBuffer:{}}]}return a.createClass(e,[{key:"clone",value:function(){for(var t=new e,r=0;r<this.geometries.length;r++){var i=this.geometries[r],a=t.geometries[r];for(var n in a.indexBuffer=i.indexBuffer.slice(),a.vertexBuffer={},i.vertexBuffer){var s=i.vertexBuffer[n],o=s.data,l=s.stride;a.vertexBuffer[n]={data:o.slice(),stride:l}}}return t}},{key:"serialize",value:function(){for(var e={geometries:[{indexBuffer:this.geometries[0].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[1].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[2].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[3].indexBuffer.buffer,vertexBuffer:{}},{indexBuffer:this.geometries[4].indexBuffer.buffer,vertexBuffer:{}}]},t=0;t<5;++t)for(var r in this.geometries[t].vertexBuffer)e.geometries[t].vertexBuffer[r]={data:this.geometries[t].vertexBuffer[r].data.buffer,stride:this.geometries[t].vertexBuffer[r].stride};return e}},{key:"getBuffers",value:function(){for(var e=[],t=0;t<5;++t)for(var r in e.push(this.geometries[t].indexBuffer.buffer),this.geometries[t].vertexBuffer)e.push(this.geometries[t].vertexBuffer[r].data.buffer);return e}}],[{key:"deserialize",value:function(t){for(var r=new e,i=0;i<5;++i)for(var a in r.geometries[i].indexBuffer=new Uint32Array(t.geometries[i].indexBuffer),r.geometries[i].vertexBuffer={},t.geometries[i].vertexBuffer)r.geometries[i].vertexBuffer[a]={data:(0,n.allocateTypedArrayBufferwithData)(t.geometries[i].vertexBuffer[a].data,t.geometries[i].vertexBuffer[a].stride),stride:t.geometries[i].vertexBuffer[a].stride};return r}}]),e}()})),r.register("b63R8",(function(e,i){t(e.exports,"groupRecordsByGeometryType",(function(){return l})),t(e.exports,"default",(function(){return u}));var a=r("8TSCy"),n=r("63ASp"),s=r("7P0zT"),o=r("5F4A5");function l(e){var t=[[],[],[],[],[]],r=e,i=!0,a=!1,n=void 0,s=!0,o=!1,l=void 0;try{for(var u,d=r[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value;try{for(var f,h=c.displayRecords[Symbol.iterator]();!(i=(f=h.next()).done);i=!0){var y=f.value;t[y.geometryType].push(y)}}catch(e){a=!0,n=e}finally{try{i||null==h.return||h.return()}finally{if(a)throw n}}}}catch(e){o=!0,l=e}finally{try{s||null==d.return||d.return()}finally{if(o)throw l}}return t}var u=function(){"use strict";function e(){a.classCallCheck(this,e)}return a.createClass(e,[{key:"displayObjectRegistry",get:function(){if(!this._displayObjectRegistry){this._displayObjectRegistry=new Map;var e=!0,t=!1,r=void 0;try{for(var i,a=this.displayObjects[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var n=i.value;this._displayObjectRegistry.set(n.id,n)}}catch(e){t=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}}return this._displayObjectRegistry}},{key:"displayList",get:function(){return this._displayList}},{key:"computeDisplayList",value:function(){this._displayList=new(0,n.default);var e=!0,t=!1,r=void 0,i=!0,a=!1,s=void 0;try{for(var o,l=this.displayObjects[Symbol.iterator]();!(i=(o=l.next()).done);i=!0){var u=o.value;try{for(var d,c=u.displayRecords[Symbol.iterator]();!(e=(d=c.next()).done);e=!0){var f=d.value;this._displayList.addToList(f)}}catch(e){t=!0,r=e}finally{try{e||null==c.return||c.return()}finally{if(t)throw r}}}}catch(e){a=!0,s=e}finally{try{i||null==l.return||l.return()}finally{if(a)throw s}}}},{key:"clone",value:function(){var t=new e;return this.displayObjects&&(t.displayObjects=this.displayObjects.map((function(e){return e.clone()}))),t}},{key:"serialize",value:function(e){return(0,o.serializeList)(e,this.displayObjects),e}},{key:"_deserializeObjects",value:function(e){for(var t=e.readInt32(),r=new Array(t),i=new Map,a=0;a<r.length;++a){var n=s.default.deserialize(e);r[a]=n,i.set(n.id,n)}this.displayObjects=r,this._displayList=null,this._displayObjectRegistry=i}}],[{key:"deserialize",value:function(t){var r=new e;return r._deserializeObjects(t),r}}]),e}()})),r.register("63ASp",(function(e,i){t(e.exports,"default",(function(){return l}));var a=r("8TSCy"),n=r("66IJZ");function s(e,t,r){for(var i=arguments.length,n=new Array(i>3?i-3:0),s=3;s<i;s++)n[s-3]=arguments[s];var o,l;t<e.length?(o=e).splice.apply(o,[t,r].concat(a.toConsumableArray(n))):(l=e).push.apply(l,a.toConsumableArray(n))}var o=new Map;o.set(n.WGLDrawPhase.MAP,[n.WGLGeometryType.FILL,n.WGLGeometryType.LINE,n.WGLGeometryType.MARKER,n.WGLGeometryType.TEXT]),o.set(n.WGLDrawPhase.LABEL,[n.WGLGeometryType.LABEL]),o.set(n.WGLDrawPhase.LABEL_ALPHA,[n.WGLGeometryType.LABEL]);var l=function(){"use strict";function e(){a.classCallCheck(this,e),this.symbolLevels=[]}return a.createClass(e,[{key:"replay",value:function(e,t,r){var i=!0,a=!1,n=void 0,s=!0,o=!1,l=void 0;try{for(var u,d=this.symbolLevels[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value;try{for(var f,h=c.zLevels[Symbol.iterator]();!(i=(f=h.next()).done);i=!0){var y=f.value.geometryDPInfo.unified,v=!0,p=!1,m=void 0;if(y)try{for(var g,x=y[Symbol.iterator]();!(v=(g=x.next()).done);v=!0){var _=g.value,b=e.painter.getGeometryBrush(_.geometryType),C=t.getGeometry(_.geometryType),k={geometryType:_.geometryType,materialKey:_.materialKey,indexFrom:_.indexFrom,indexCount:_.indexCount,target:C};b.prepareState(e,t),b.drawGeometry(e,t,k,r)}}catch(e){p=!0,m=e}finally{try{v||null==x.return||x.return()}finally{if(p)throw m}}}}catch(e){a=!0,n=e}finally{try{i||null==h.return||h.return()}finally{if(a)throw n}}}}catch(e){o=!0,l=e}finally{try{s||null==d.return||d.return()}finally{if(o)throw l}}}},{key:"empty",get:function(){return!this.symbolLevels||0===this.symbolLevels.length}},{key:"clear",value:function(){this.symbolLevels.length=0}},{key:"addToList",value:function(e,t){var r=!0,i=!1,a=void 0;if(Array.isArray(e))try{for(var n,s=e[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var o=n.value;this._addToList(o,t)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}else this._addToList(e,t)}},{key:"removeFromList",value:function(e){Array.isArray(e)||(e=[e]);var t=null,r=!0,i=!1,a=void 0;try{for(var n,s=e[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var o=n.value;t=this._removeFromList(o)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return t}},{key:"clone",value:function(){var t=new e,r=!0,i=!1,a=void 0;try{for(var n,s=this.symbolLevels[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var o=n.value;t.symbolLevels.push(o.clone())}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return t}},{key:"splitAfter",value:function(e){for(var t=this._getDisplayList(e.symbolLevel,e.zOrder),r=t.length,i=e.indexFrom+e.indexCount,a=0;a<r;++a){var n=t[a];if(n.geometryType===e.geometryType&&i>n.indexFrom&&i<=n.indexFrom+n.indexCount){if(i<n.indexFrom+n.indexCount){var s=new u;s.geometryType=n.geometryType,s.materialKey=n.materialKey,s.indexFrom=i,s.indexCount=n.indexFrom+n.indexCount-i,t.splice(a+1,0,s),n.indexCount=i-n.indexFrom}return a}}}},{key:"_addToList",value:function(e,t){var r=e.symbolLevel,i=e.zOrder,a=this._getDisplayList(r,i),n=null!=t?t:a.length-1,o=n>=0&&n<a.length?a[n]:null;if(null!==o&&o.materialKey===e.materialKey&&o.indexFrom+o.indexCount===e.indexFrom&&o.geometryType===e.geometryType)o.indexCount+=e.indexCount;else{var l=new u;l.indexFrom=e.indexFrom,l.indexCount=e.indexCount,l.materialKey=e.materialKey,l.geometryType=e.geometryType,s(a,n+1,0,l)}}},{key:"_removeFromList",value:function(e){for(var t,r=e.symbolLevel,i=e.zOrder,a=this._getDisplayList(r,i),n=a.length,o=0;o<n;++o){var l=a[o];if(e.indexFrom+e.indexCount>l.indexFrom&&e.indexFrom<l.indexFrom+l.indexCount&&l.geometryType===e.geometryType){t=o;break}}if(void 0!==t){var d=a[t];if(e.indexFrom===d.indexFrom)return d.indexCount-=e.indexCount,d.indexFrom+=e.indexCount,0===d.indexCount&&s(a,t,1),t-1;if(e.indexFrom+e.indexCount===d.indexFrom+d.indexCount)return d.indexCount-=e.indexCount,0===d.indexCount?(s(a,t,1),t-1):t;var c=d.indexFrom,f=e.indexFrom-d.indexFrom,h=e.indexCount,y=d.indexFrom+d.indexCount-(e.indexFrom+e.indexCount);d.indexCount=f;var v=new u;return v.geometryType=d.geometryType,v.materialKey=d.materialKey,v.indexFrom=c+f+h,v.indexCount=y,s(a,t+1,0,v),t}return null}},{key:"_getDisplayList",value:function(e,t){for(var r,i,a=this.symbolLevels.length,n=0;n<a;n++)if(this.symbolLevels[n].symbolLevel===e){r=this.symbolLevels[n];break}r||((r=new f).symbolLevel=e,this.symbolLevels.push(r));for(var s=r.zLevels.length,o=0;o<s;o++)if(r.zLevels[o].zLevel===t){i=r.zLevels[o];break}return i||((i=new c).geometryDPInfo=new d,i.zLevel=t,r.zLevels.push(i)),i.geometryDPInfo.unified||(i.geometryDPInfo.unified=[]),i.geometryDPInfo.unified}},{key:"getDPInfoType",value:function(){return"unified"}}]),e}(),u=function(){"use strict";function e(){a.classCallCheck(this,e),this.materialKey=null,this.indexFrom=0,this.indexCount=0}return a.createClass(e,[{key:"clone",value:function(){var t=new e;return t.geometryType=this.geometryType,t.materialKey=this.materialKey,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t}}]),e}(),d=function(){"use strict";function e(){a.classCallCheck(this,e),this.fill=null,this.line=null,this.marker=null,this.text=null,this.label=null,this.unified=null}return a.createClass(e,[{key:"clone",value:function(){var t=new e;return t.fill=this.fill&&this.fill.map((function(e){return e.clone()})),t.line=this.line&&this.line.map((function(e){return e.clone()})),t.marker=this.marker&&this.marker.map((function(e){return e.clone()})),t.text=this.text&&this.text.map((function(e){return e.clone()})),t.label=this.label&&this.label.map((function(e){return e.clone()})),t.unified=this.unified&&this.unified.map((function(e){return e.clone()})),t}}]),e}(),c=function(){"use strict";function e(){a.classCallCheck(this,e),this.geometryDPInfo=new d}return a.createClass(e,[{key:"clone",value:function(){var t=new e;return t.zLevel=this.zLevel,t.geometryDPInfo=this.geometryDPInfo.clone(),t}}]),e}(),f=function(){"use strict";function e(){a.classCallCheck(this,e),this.zLevels=[]}return a.createClass(e,[{key:"clone",value:function(){var t=new e;t.symbolLevel=this.symbolLevel;var r=!0,i=!1,a=void 0;try{for(var n,s=this.zLevels[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var o=n.value;t.zLevels.push(o.clone())}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return t}}]),e}()})),r.register("7P0zT",(function(e,i){t(e.exports,"default",(function(){return o}));var a=r("8TSCy"),n=r("1uPnB"),s=r("5F4A5"),o=function(){"use strict";function e(t){a.classCallCheck(this,e),this.insertAfter=null,this.id=t,this.displayRecords=[]}return a.createClass(e,[{key:"copy",value:function(){var t=new e(this.id);return t.set(this),t}},{key:"clone",value:function(){var t=new e(this.id);return t.displayRecords=this.displayRecords.map((function(e){return e.clone()})),t.insertAfter=this.insertAfter,t}},{key:"set",value:function(e){this.id=e.id,this.displayRecords=e.displayRecords,this.insertAfter=e.insertAfter}},{key:"serialize",value:function(e){return e.push(this.id),(0,s.serializeList)(e,this.displayRecords),e}}],[{key:"deserialize",value:function(t){var r=t.readInt32(),i=new e(r),a={id:r};return i.displayRecords=(0,s.deserializeList)(t,n.default,a),i}}]),e}()})),r.register("1uPnB",(function(e,i){t(e.exports,"default",(function(){return o}));var a=r("8TSCy"),n=r("lug9S"),s=r("5WctK"),o=function(){"use strict";function e(t,r,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;a.classCallCheck(this,e),this.id=t,this.geometryType=r,this.materialKey=i,this.minZoom=n,this.maxZoom=s,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}return a.createClass(e,[{key:"sortKey",get:function(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}},{key:"clone",value:function(){return this.copy()}},{key:"copy",value:function(){var t=new e(this.id,this.geometryType,this.materialKey);return t.vertexFrom=this.vertexFrom,t.vertexCount=this.vertexCount,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t.zOrder=this.zOrder,t.symbolLevel=this.symbolLevel,t.meshData=this.meshData,t.minZoom=this.minZoom,t.maxZoom=this.maxZoom,t}},{key:"setMeshDataFromBuffers",value:function(e,t,r){var i=new(0,n.default);for(var a in t){for(var o=t[a].stride,l=t[a].data,u=[],d=(0,s.strideToPackingFactor)(o),c=0;c<o*e.vertexCount/d;++c)u[c]=l[c+o*e.vertexFrom/d];i.vertexData.set(a,u)}i.indexData.length=0;for(var f=0;f<e.indexCount;++f)i.indexData[f]=r[f+e.indexFrom]-e.vertexFrom;i.vertexCount=e.vertexCount,this.meshData=i}},{key:"readMeshDataFromBuffers",value:function(e,t){for(var r in this.meshData?this.meshData.clear():this.meshData=new(0,n.default),e){for(var i=e[r].stride,a=e[r].data,o=[],l=(0,s.strideToPackingFactor)(i),u=0;u<i*this.vertexCount/l;++u)o[u]=a[u+i*this.vertexFrom/l];this.meshData.vertexData.set(r,o)}this.meshData.indexData.length=0;for(var d=0;d<this.indexCount;++d)this.meshData.indexData[d]=t[d+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}},{key:"writeMeshDataToBuffers",value:function(e,t,r,i){for(var a in t)for(var n=t[a].stride,o=this.meshData.vertexData.get(a),l=t[a].data,u=(0,s.strideToPackingFactor)(n),d=0;d<n*this.meshData.vertexCount/u;++d)l[d+n*e/u]=o[d];for(var c=0;c<this.meshData.indexData.length;++c)i[c+r]=this.meshData.indexData[c]+e;this.vertexFrom=e,this.vertexCount=this.meshData.vertexCount,this.indexFrom=r,this.indexCount=this.meshData.indexData.length}},{key:"_computeSortKey",value:function(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}},{key:"serialize",value:function(e){return e.push(this.geometryType),e.push(this.materialKey),e.push(this.vertexFrom),e.push(this.vertexCount),e.push(this.indexFrom),e.push(this.indexCount),e.push(this.minZoom),e.push(this.maxZoom),e}}],[{key:"writeAllMeshDataToBuffers",value:function(e,t,r){var i=0,a=0,n=!0,s=!1,o=void 0;try{for(var l,u=e[Symbol.iterator]();!(n=(l=u.next()).done);n=!0){var d=l.value;d.writeMeshDataToBuffers(i,t,a,r),i+=d.vertexCount,a+=d.indexCount}}catch(e){s=!0,o=e}finally{try{n||null==u.return||u.return()}finally{if(s)throw o}}}},{key:"deserialize",value:function(t,r){var i=t.readInt32(),a=t.readInt32(),n=new e(r.id,i,a);return n.vertexFrom=t.readInt32(),n.vertexCount=t.readInt32(),n.indexFrom=t.readInt32(),n.indexCount=t.readInt32(),n.minZoom=t.readInt32(),n.maxZoom=t.readInt32(),n}}]),e}()})),r.register("lug9S",(function(e,i){t(e.exports,"default",(function(){return n}));var a=r("8TSCy"),n=function(){"use strict";function e(){a.classCallCheck(this,e),this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}return a.createClass(e,[{key:"clear",value:function(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}},{key:"update",value:function(e,t,r){for(var i in e)this.vertexData.set(i,e[i]);for(var a in this.vertexData)null===e[a]&&this.vertexData.delete(a);this.vertexCount=t,this.indexData=r}}]),e}()})),r.register("5F4A5",(function(e,r){function i(e,t){if(null!==t){e.push(t.length);var r=!0,i=!1,a=void 0;try{for(var n,s=t[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){n.value.serialize(e)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return e}e.push(0)}function a(e,t,r){for(var i=e.readInt32(),a=new Array(i),n=0;n<a.length;n++)a[n]=t.deserialize(e,r);return a}t(e.exports,"serializeList",(function(){return i})),t(e.exports,"deserializeList",(function(){return a}))})),r.register("jTLfv",(function(e,i){t(e.exports,"VertexBuffers",(function(){return o}));var a=r("8TSCy"),n=r("5WctK"),s=function(){"use strict";function e(t,r){a.classCallCheck(this,e),this.data=t,this.stride=r}return a.createClass(e,null,[{key:"decode",value:function(t){return new e((0,n.allocateTypedArrayBufferwithData)(t.data,t.stride),t.stride)}},{key:"fromVertexVector",value:function(t){return new e((0,n.allocateTypedArrayBufferwithData)(t.data.buffer(),t.stride),t.stride)}}]),e}(),o=function(){"use strict";function e(t,r,i){a.classCallCheck(this,e),this.geometryType=t,this.indexBuffer=new Uint32Array(r),this.namedBuffers=i}return a.createClass(e,null,[{key:"decode",value:function(t){var r=t.geometryType,i=t.indexBuffer,a={};for(var n in t.namedBuffers)a[n]=s.decode(t.namedBuffers[n]);return new e(r,i,a)}},{key:"fromVertexData",value:function(t,r){var i=t.indices,a=(0,n.allocateTypedArrayBufferwithData)(t.vertices,t.stride),o=t.stride;return new e(r,i,{geometry:new s(a,o)})}},{key:"fromVertexVectors",value:function(t){var r=t.geometryType,i=t.indexVector.buffer(),a={};for(var n in t.namedVectors)a[n]=s.fromVertexVector(t.namedVectors[n]);return new e(r,i,a)}}]),e}()})),r.register("f5ROF",(function(e,i){t(e.exports,"VertexVectors",(function(){return u}));var a=r("8TSCy"),n=r("5WctK"),s=r("jTLfv"),o=r("8laiu"),l=function(){"use strict";function e(t,r){a.classCallCheck(this,e),this.data=t,this.stride=r}return a.createClass(e,[{key:"vertexCount",get:function(){var e=this.stride/4,t=this.data.length/e;return t!==(0|t)&&console.debug("Corrupted stride"),t}},{key:"transfer",value:function(e,t){var r=this.data.buffer();e.vertexCount=this.vertexCount,e.data=r,e.stride=this.stride,t.push(r)}}]),e}(),u=function(){"use strict";function e(t,r,i){a.classCallCheck(this,e),this.geometryType=t,this.indexVector=new(0,o.default)(Uint32Array,6*r),this.namedVectors={};var s=(0,n.getStrides)(t,i);for(var u in s){var d=s[u],c=void 0;switch(d%4){case 0:case 2:c=new(0,o.default)(Uint32Array,d*r);break;case 1:case 3:c=new(0,o.default)(Uint8Array,d*r)}this.namedVectors[u]=new l(c,d)}}return a.createClass(e,[{key:"get",value:function(e){return this.namedVectors[e].data}},{key:"getVector",value:function(e){return this.namedVectors[e]}},{key:"transfer",value:function(e,t){var r=this.indexVector.buffer(),i={};for(var a in t.push(r),this.namedVectors){var n=this.namedVectors[a];i[a]={},n.transfer(i[a],t)}e.geometryType=this.geometryType,e.indexBuffer=r,e.namedBuffers=i,this.destroy()}},{key:"intoBuffers",value:function(){var e=s.VertexBuffers.fromVertexVectors(this);return this.destroy(),e}},{key:"destroy",value:function(){this.indexVector=null,this.namedVectors=null}}]),e}()})),r.register("cdq0d",(function(e,i){t(e.exports,"GraphicsReader",(function(){return l}));var a=r("8TSCy"),n=r("79LpT"),s=r("akQYU"),o=r("jBcNl"),l=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(e,i){return a.classCallCheck(this,r),t.call(this,e,i,null)}return a.createClass(r,[{key:"geometryType",get:function(){var e=this._current;return e?e.geometryType:null}},{key:"insertAfter",get:function(){return this._current.insertAfter}},{key:"readGraphic",value:function(){return this._current}},{key:"getCursor",value:function(){return this.copy()}},{key:"copy",value:function(){var e=new r(this.instance,this._features);return this.copyInto(e),e}}],[{key:"from",value:function(e){var t=o.FeatureSetReader.createInstance(),i=[],a=e.filter((function(e){return!!e.geometry})),l=!0,u=!1,d=void 0;try{for(var c,f=a[Symbol.iterator]();!(l=(c=f.next()).done);l=!0){var h=c.value,y=(0,n.getJsonType)(h.geometry);(0,s.convertFromGraphics)(i,[h],y,!1,!1,"uid")}}catch(e){u=!0,d=e}finally{try{l||null==f.return||f.return()}finally{if(u)throw d}}return new r(t,i)}}]),r}(r("5STKO").FeatureSetReaderJSON)})),r.register("4gS0A",(function(e,i){t(e.exports,"default",(function(){return b}));var a=r("8TSCy"),n=r("7qybv"),s=r("iXlXu"),o=r("38gAI"),l=r("8TwEW"),u=r("5Hy9K"),d=r("5On35"),c=r("7E1SV"),f=r("eGRqB"),h=r("4FBKO"),y=r("gKnlV"),v=r("d2StF"),p={minX:0,minY:0,maxX:0,maxY:0},m=(0,l.create)(),g=1e-5;function x(e,t,r,i,a){return p.minX=t,p.minY=r,p.maxX=i,p.maxY=a,e.search(p)}function _(e){return{minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}}var b=function(){"use strict";function e(t,r,i,n,s,l,u){a.classCallCheck(this,e),this._graphics=n,this._onAdd=s,this._onRemove=l,this._hashToCIM=u,this._index=(0,o.r)(9,_),this._itemByGraphic=new Map,this._inflatedSizeHelper=new(0,h.CIMSimbolInflatedSizeHelper),this._tileInfoView=t,this._uidFieldName=i;var d=t.getClosestInfoForScale(r);d&&(this._resolution=this._tileInfoView.getTileResolution(d.level))}return a.createClass(e,[{key:"setResourceManager",value:function(e){this._cimResourceManager=e,this._hittestDrawHelper=new(0,f.HittestDrawHelper)(e)}},{key:"hitTest",value:function(e,t,r,i,a){e=(0,d.normalizeMapX)(e,this._tileInfoView.spatialReference);var n=.5*i*window.devicePixelRatio*r;m[0]=e-n,m[1]=t-n,m[2]=e+n,m[3]=t+n;var s=.5*i*(r+v.PIXEL_BUFFER),o=x(this._index,e-s,t-s,e+s,t+s);if(!o||0===o.length)return[];var u=[],c=(0,l.create)(),f=(0,l.create)(),h=!0,y=!1,p=void 0;try{for(var g,_=o[Symbol.iterator]();!(h=(g=_.next()).done);h=!0){var b=g.value,k=b.geometry,w=b.symbolResource;this._getSymbolBounds(c,w,k,f,a),f[3]=f[2]=f[1]=f[0]=0,(0,l.intersects)(c,m)&&b.graphic.visible&&u.push(b)}}catch(e){y=!0,p=e}finally{try{h||null==_.return||_.return()}finally{if(y)throw p}}if(0===u.length)return[];var T=this._hittestDrawHelper,S=[],D=!0,B=!1,F=void 0;try{for(var I,M=u[Symbol.iterator]();!(D=(I=M.next()).done);D=!0){var L=I.value,R=L.geometry,A=L.symbolResource,G=A.hash,P=A.textInfo,z=this._hashToCIM.get(G);z&&T.hitTest(m,z.symbol,R,P,a,i)&&S.push(L)}}catch(e){B=!0,F=e}finally{try{D||null==M.return||M.return()}finally{if(B)throw F}}return S.sort(C),S.map((function(e){return e.graphic}))}},{key:"getGraphicsData",value:function(e,t,r){var i=this._searchForItems(t);if(0===i.length||0===r.length)return[];i.sort((function(e,t){return e.zorder-t.zorder})),i[0].insertAfter=-1;for(var n=1;n<i.length;n++)i[n].insertAfter=i[n-1].graphic.uid;i.sort((function(e,t){return e.graphic.uid-t.graphic.uid})),r.sort((function(e,t){return e.uid-t.uid}));var s,o=0,l=0,u=t.resolution,d=[],c={originPosition:"upperLeft",scale:[u,u],translate:[t.bounds[0],t.bounds[3]]},f=!0,h=!1,v=void 0;try{for(var p,m=r[Symbol.iterator]();!(f=(p=m.next()).done);f=!0){var g=p.value;for(l=-2;o<i.length;)if(s=i[o],o++,g.uid===s.graphic.uid){l=s.insertAfter;break}if(s.geometry&&-2!==l){var x=s.getGeometryQuantized(c,t.bounds,this._tileInfoView.spatialReference,u),_=a.objectSpread({},s.graphic.attributes);_[this._uidFieldName]=g.uid,null==s.groupId&&(s.groupId=e.createTemplateGroup(s.symbol,null)),d.push({centroid:y.default.getCentroidQuantized(s,c),geometry:x,attributes:_,symbol:s.symbol,groupId:s.groupId,insertAfter:l,zorder:s.zorder})}}}catch(e){h=!0,v=e}finally{try{f||null==m.return||m.return()}finally{if(h)throw v}}return d.sort((function(e,t){return e.zorder-t.zorder})),d}},{key:"queryTileData",value:function(e,t){if(0===this._graphics.length)return[];var r=t.bounds,i=t.resolution,a=this._searchForItems(t),n=[];return 0===a.length||this._createTileGraphics(n,e,a,{originPosition:"upperLeft",scale:[i,i],translate:[r[0],r[3]]},t),n}},{key:"has",value:function(e){return this._itemByGraphic.has(e)}},{key:"getBounds",value:function(e){var t=this._itemByGraphic.get(e);return t?t.bounds:null}},{key:"getAllBounds",value:function(){return Array.from(this._itemByGraphic.values()).filter((function(e){return e.graphic.visible})).map((function(e){return e.bounds}))}},{key:"addOrModify",value:function(e,t,r){if(e&&!(0,n.isNone)(t)){this.has(e)&&this.remove(e),this._onAdd(e);var i=[0,0,0,0],a=this._getSymbolBounds(null,t,r,i,0),s=y.default.acquire(e,t,r,(0,n.isSome)(a)?a:null,i);return this._itemByGraphic.set(e,s),r&&this._index.insert(s),s.bounds}}},{key:"remove",value:function(e){if(this._itemByGraphic.has(e)){this._onRemove(e);var t=this._itemByGraphic.get(e);t.bounds&&this._index.remove(t),this._itemByGraphic.delete(e)}}},{key:"updateZ",value:function(){for(var e,t,r=this._graphics.items,i=0;i<r.length;i++)t=r[i],(e=this._itemByGraphic.get(t))&&(e.zorder=i)}},{key:"update",value:function(e,t,r){var i=this._itemByGraphic.get(e);i.groupId=null;var a=(0,l.clone)(i.bounds);this._index.remove(i);var s=this._getSymbolBounds(i.bounds,t,r,i.size,0);return(0,n.isSome)(s)&&i.set(e,t,r,s,i.size),r&&this._index.insert(i),{oldBounds:a,newBounds:i.bounds}}},{key:"updateLevel",value:function(e){if(this._resolution!==e){this._resolution=e,this._index.clear();var t=this._itemByGraphic,r=[],i=!0,s=!1,o=void 0;try{for(var l,u=t[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var d=a.slicedToArray(l.value,2),c=(d[0],d[1]),f=this._getSymbolBounds(c.bounds,c.symbolResource,c.geometry,c.size,0);c.geometry&&(0,n.isSome)(f)&&(c.bounds=f,r.push(c))}}catch(e){s=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(s)throw o}}this._index.load(r)}}},{key:"clear",value:function(){this._itemByGraphic.clear(),this._index.clear()}},{key:"_createTileGraphics",value:function(e,t,r,i,n){var s,o,l,u,d=this._uidFieldName,c=this._tileInfoView.spatialReference,f=n.bounds,h=n.resolution;r.sort((function(e,t){return e.zorder-t.zorder}));for(var v=0;v<r.length;v++){s=(l=r[v]).graphic,o=l.getGeometryQuantized(i,f,c,h),u=0===v?-1:r[v-1].graphic.uid;var p=a.objectSpread({},l.graphic.attributes);p[d]=s.uid,null==l.groupId&&(l.groupId=t.createTemplateGroup(l.symbol,null)),e.push({centroid:y.default.getCentroidQuantized(l,i),geometry:o,attributes:p,symbol:l.symbol,groupId:l.groupId,insertAfter:u,zorder:l.zorder})}}},{key:"_searchForItems",value:function(e){var t=this._tileInfoView.spatialReference,r=e.bounds;if(t.isWrappable){var i=a.slicedToArray((0,c.getSpatialReferenceMinMaxX)(t),2),n=i[0],s=i[1],o=Math.abs(r[2]-s)<g,u=Math.abs(r[0]-n)<g;if((!o||!u)&&(o||u)){var d,f=e.resolution;d=(0,l.create)(o?[n,r[1],n+f*v.PIXEL_BUFFER,r[3]]:[s-f*v.PIXEL_BUFFER,r[1],s,r[3]]);var h=x(this._index,r[0],r[1],r[2],r[3]),y=x(this._index,d[0],d[1],d[2],d[3]);return a.toConsumableArray(new Set(a.toConsumableArray(h).concat(a.toConsumableArray(y))))}}return x(this._index,r[0],r[1],r[2],r[3])}},{key:"_getSymbolBounds",value:function(e,t,r,i,a){if(!t||!t.symbol||!r)return null;if(e||(e=(0,l.create)()),(0,u.getBoundsXY)(e,r),!i||0===i[0]&&0===i[1]&&0===i[2]&&0===i[3]){var n=t.hash,o=t.textInfo,d=this._hashToCIM.get(n);if(!d)return null;i||(i=[0,0,0,0]);var c=this._inflatedSizeHelper.getSymbolInflateSize(i,d.symbol,this._cimResourceManager,a,o);i[0]=(0,s.pt2px)(c[0]),i[1]=(0,s.pt2px)(c[1]),i[2]=(0,s.pt2px)(c[2]),i[3]=(0,s.pt2px)(c[3])}var f=this._resolution,y=h.CIMSimbolInflatedSizeHelper.safeSize(i);return e[0]-=y*f,e[1]-=y*f,e[2]+=y*f,e[3]+=y*f,e}}]),e}(),C=function(e,t){var r=(0,v.graphicGeometryToNumber)(e.graphic),i=(0,v.graphicGeometryToNumber)(t.graphic);return r===i?t.zorder-e.zorder:r-i}})),r.register("gKnlV",(function(e,i){t(e.exports,"default",(function(){return g}));var a=r("8TSCy"),n=r("7qybv"),s=r("8TwEW"),o=r("30puZ"),l=r("79LpT"),u=r("7E1SV"),d=r("ibKgR"),c=r("akQYU"),f=r("awxBI"),h=r("d2StF"),y=new(0,f.default),v=new(0,f.default),p="esriGeometryPolyline";function m(e){e.coords.length=0,e.lengths.length=0}var g=function(){"use strict";function e(){a.classCallCheck(this,e),this.bounds=(0,s.create)(),this.graphic=null}return a.createClass(e,[{key:"acquire",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;e&&this.set(e,t,r,i,a)}},{key:"release",value:function(){this.graphic=null,this.symbolResource=null,this.geometry=null}},{key:"symbol",get:function(){return this.symbolResource.symbol}},{key:"set",value:function(e,t,r,i,a){this.graphic=e,this.geometry=r,this.symbolResource=t,this.bounds=i,a&&(this.size=a)}},{key:"getGeometryQuantized",value:function(e,t,r,i){var n=this.geometry;if((0,l.isPolygon)(n)){var o=n.rings;if(1===o.length&&2===o[0].length)return(0,d.quantizeGeometry)(e,{paths:[[o[0][0],o[0][1]]]})}else{if((0,l.isPolyline)(n))return m(y),m(v),(0,c.convertFromPolyline)(y,n),(0,c.generalizeOptimizedGeometry)(v,y,n.hasZ,n.hasM,p,e.scale[0]),(0,c.quantizeOptimizedGeometry)(y,v,n.hasZ,n.hasM,p,e),(0,c.convertToPolyline)(y,n.hasZ,n.hasM);if((0,l.isMultipoint)(n)){var f=.5*i*Math.max(Math.abs(this.size[0])+this.size[2]-this.size[0],Math.abs(this.size[1])+this.size[3]-this.size[1]),h=a.slicedToArray((0,u.getSpatialReferenceMinMaxX)(r),2),g=h[0],x=h[1],_=x-g,b=n.points.filter((function(e){if(e[0]+f>x||e[0]-f<g){var r=a.toConsumableArray(e);return e[0]+f>x?r[0]-=_:r[0]+=_,(0,s.containsPointWithMargin)(t,e,f)||(0,s.containsPointWithMargin)(t,r,f)}return(0,s.containsPointWithMargin)(t,e,f)}));return 0===b.length?{points:b}:(0,d.quantizeGeometry)(e,{points:b})}}return(0,d.quantizeGeometry)(e,this.geometry)}}],[{key:"acquire",value:function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;return 0===e._pool.length?t=new e:(t=e._pool.pop(),this._set.delete(t)),t.acquire(r,i,a,n,s),t}},{key:"release",value:function(e){e&&!this._set.has(e)&&(e.release(),this._pool.push(e),this._set.add(e))}},{key:"getCentroidQuantized",value:function(e,t){if((0,l.isPolygon)(e.geometry)){var r=e.symbol;if((0,n.isNone)(r))return null;if((0,h.isMarkerSymbol)(r.type)||(0,h.isTextSymbol)(r.type)){var i=(0,o.polygonCentroid)(e.geometry);return(0,d.quantizePoint)(t,{},{x:i[0],y:i[1]},!1,!1)}}return null}}]),e}();g._pool=[],g._set=new Set})),r.register("eOR0N",(function(e,i){t(e.exports,"GraphicsView",(function(){return u}));var a=r("8TSCy"),n=r("7eJjO"),s=r("52Bzb"),o=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var l=r("fcwIv"),u=function(e){var t=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){var e;return a.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))).graphics=null,e.renderer=null,a.possibleConstructorReturn(e)}return r}((0,s.IdentifiableMixin)(e));return(0,n._)([(0,o.property)()],t.prototype,"graphics",void 0),(0,n._)([(0,o.property)()],t.prototype,"renderer",void 0),(0,n._)([(0,o.property)()],t.prototype,"updating",void 0),(0,n._)([(0,o.property)()],t.prototype,"view",void 0),t=(0,n._)([(0,l.subclass)("esri.views.layers.GraphicsView")],t)}})),r.register("kL0tX",(function(e,i){t(e.exports,"default",(function(){return l}));var a=r("8TSCy"),n=r("hTEz4"),s=r("i2VfC"),o=r("8JzMA"),l=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(e){var i;return a.classCallCheck(this,r),(i=t.call(this,e)).hasHighlight=function(){return!0},a.possibleConstructorReturn(i)}return a.createClass(r,[{key:"destroy",value:function(){a.get(a.getPrototypeOf(r.prototype),"destroy",this).call(this),this._boundsRenderer&&(this._boundsRenderer.destroy(),this._boundsRenderer=null)}},{key:"enableRenderingBounds",value:function(e){this._boundsRenderer=new(0,s.default)(e),this.requestRender()}},{key:"hasLabels",get:function(){return!1}},{key:"onTileData",value:function(e,t){e.patch(t),this.contains(e)||this.addChild(e),this.requestRender()}},{key:"onTileError",value:function(e){e.clear(),this.contains(e)||this.addChild(e)}},{key:"_renderChildren",value:function(e,t){var r=!0,i=!1,a=void 0;try{for(var n,s=this.children[Symbol.iterator]();!(r=(n=s.next()).done);r=!0){var l=n.value;l.isReady&&l.hasData&&(l.commit(e),e.context.setStencilFunction(o.CompareFunction.EQUAL,l.stencilRef,255),l._displayList.replay(e,l,t))}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}]),r}(n.FeatureContainer)})),r.register("i2VfC",(function(e,i){t(e.exports,"default",(function(){return p}));var a=r("8TSCy"),n=r("j3x2p"),s=r("eYrMi"),o=r("0P8XU"),l=r("8tU7Q"),u=r("5On35"),d=r("2qlsz"),c=r("5WctK"),f=r("iRJeW"),h=r("8JzMA"),y=r("4aQus"),v=Math.PI/180,p=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(e){var i;return a.classCallCheck(this,r),(i=t.call(this))._dvsMat3=(0,s.c)(),i._localOrigin={x:0,y:0},i._getBounds=e,a.possibleConstructorReturn(i)}return a.createClass(r,[{key:"destroy",value:function(){this._vao&&(this._vao.dispose(!0),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program&&(this._program.dispose(),this._program=null)}},{key:"doRender",value:function(e){var t=e.context,r=this._getBounds();if(!(r.length<1)){this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(e),this._updateBufferData(t,r),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0);var i=this._program;t.bindVAO(this._vao),t.useProgram(i),i.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(h.PrimitiveType.LINES,8*r.length,h.DataType.UNSIGNED_INT,0),t.bindVAO()}}},{key:"_createTransforms",value:function(){return{dvs:(0,s.c)()}}},{key:"_createShaderProgram",value:function(e){if(!this._program){this._program=e.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",m().attributes)}}},{key:"_updateMatricesAndLocalOrigin",value:function(e){var t=e.state,r=t.displayMat3,i=t.size,a=t.resolution,s=t.pixelRatio,d=t.rotation,c=t.viewpoint,f=v*d,h=c.targetGeometry,y=h.x,p=h.y,m=(0,u.normalizeMapX)(y,t.spatialReference);this._localOrigin.x=m,this._localOrigin.y=p;var g=s*i[0],x=s*i[1],_=a*g,b=a*x,C=(0,n.b)(this._dvsMat3);(0,n.m)(C,C,r),(0,n.c)(C,C,(0,o.f)(g/2,x/2)),(0,n.d)(C,C,(0,l.f)(i[0]/_,-x/b,1)),(0,n.r)(C,C,-f)}},{key:"_updateBufferData",value:function(e,t){var r=this._localOrigin,i=r.x,a=r.y,n=8*t.length,s=new Float32Array(n),o=new Uint32Array(8*t.length),l=0,u=0,d=!0,c=!1,v=void 0;try{for(var p,g=t[Symbol.iterator]();!(d=(p=g.next()).done);d=!0){var x=p.value;x&&(s[2*l+0]=x[0]-i,s[2*l+1]=x[1]-a,s[2*l+2]=x[0]-i,s[2*l+3]=x[3]-a,s[2*l+4]=x[2]-i,s[2*l+5]=x[3]-a,s[2*l+6]=x[2]-i,s[2*l+7]=x[1]-a,o[u+0]=l+0,o[u+1]=l+3,o[u+2]=l+3,o[u+3]=l+2,o[u+4]=l+2,o[u+5]=l+1,o[u+6]=l+1,o[u+7]=l+0,l+=4,u+=8)}}catch(e){c=!0,v=e}finally{try{d||null==g.return||g.return()}finally{if(c)throw v}}if(this._vertexBuffer?this._vertexBuffer.setData(s.buffer):this._vertexBuffer=f.BufferObject.createVertex(e,h.Usage.DYNAMIC_DRAW,s.buffer),this._indexBuffer?this._indexBuffer.setData(o):this._indexBuffer=f.BufferObject.createIndex(e,h.Usage.DYNAMIC_DRAW,o),!this._vao){var _=m();this._vao=new(0,y.VertexArrayObject)(e,_.attributes,_.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}]),r}(d.DisplayObject),m=function(){return(0,c.createProgramDescriptor)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:h.DataType.FLOAT}]})}}))}();
//# sourceMappingURL=mapViewDeps.8fb029b7.js.map
