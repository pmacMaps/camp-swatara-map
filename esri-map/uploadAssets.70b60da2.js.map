{"mappings":"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","sources":["node_modules/@arcgis/core/layers/graphics/sources/support/uploadAssets.js","node_modules/@arcgis/core/layers/graphics/sources/support/uploads.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport e from\"../../../../request.js\";import t from\"../../../../core/Error.js\";import s from\"../../../../core/Logger.js\";import{throwIfAborted as r,throwIfAbortError as a,after as o}from\"../../../../core/promiseUtils.js\";import{parseData as n,join as i}from\"../../../../core/urlUtils.js\";import{generateBracedUUID as u}from\"../../../../core/uuid.js\";import{externalIsOnService as l,assetFormatId as c,ServiceAsset as p,ServiceAssetPart as f,externalSourceToMultiPart as d}from\"../../../../geometry/support/meshUtils/External.js\";import{uploadItem as m}from\"./uploads.js\";import{getFormatIdMimeType as y,getMimeTypeFormatId as w,getFilenameFormatId as h}from\"../../../support/infoFor3D.js\";async function g(e,t,s){return e.length?Promise.all(e.map((e=>T(e,t,s)))):[]}async function T(e,{layer:s,ongoingUploads:r},a){const o=r.get(e);if(o)return o;if(!P(s))throw new t(`${s.type}-layer:upload-failure`,\"Layer does not support asset uploads.\",new Error);if(b(e,s))return e;const n=E(e,s,a);r.set(e,n);try{await n}finally{r.delete(e)}return e}function b(e,t){const{parsedUrl:s}=t;return null!=s&&e.metadata.externalSources.some((e=>l(e,s)))}async function E(e,t,s){const{metadata:a}=e,{displaySource:o}=a,n=x(o?.source,t),i=!!n,u=a.externalSources.length>0,l=i?$(n,t,s):u?F(e,t,s):j(e,t,s),c=await l;return r(s),e.addExternalSources([c]),e}async function $(e,t,s){return{source:await N(e,t,s),original:!0}}async function F(e,s,r){const a=B(s),{externalSources:o}=e.metadata,n=U(o,s);if(!n)throw new t(`${s.type}-layer:upload-failure`,\"Could not find an external source that is supported by the service.\",new Error);const i=await N(n,s,r);e.addExternalSources([{source:i,original:!0}]);return{source:await q(i,s,a)}}async function j(e,t,s){const r=D(e,t,s);return{source:await A([r],t,s),extent:e.extent.clone(),original:!0}}async function D(e,t,s){const a=B(t),o=await e.load(s),n=await o.toBinaryGLTF({ignoreLocalTransform:!0});r(s);const i=await n.buffer();return r(s),{blob:new Blob([i.data],{type:i.type}),assetName:`${u()}.glb`,assetType:a}}function U(e,t){for(const s of e){const e=x(s.source,t);if(e)return e}return null}function x(e,t){if(!e)return null;const{infoFor3D:{supportedFormats:s,editFormats:r}}=t,a=d(e),o=new Array;let n=!1;for(let i=0;i<a.length;++i){const e=v(a[i],s);if(!e)return null;r.includes(e.assetType)&&(n=!0),o.push(e)}return n?o:null}function v(e,t){const s=c(e,t);return s?{asset:e,assetType:s}:null}async function N(e,t,s){return A(e.map((e=>S(e,s))),t,s)}async function A(e,t,s){const a=await Promise.all(e.map((async e=>{const a=I(await e,t,s);return r(s),a})));r(s);const{uploadResults:o}=await R(a.map((({item:e})=>e)),t,s);return r(s),e.map(((e,s)=>L(a[s],o[s],t)))}async function S(e,t){const{asset:s,assetType:a}=e;if(s instanceof File)return{blob:s,assetName:s.name,assetType:a};const o=await s.toBlob(t);return r(t),{blob:o,assetName:s.assetName,assetType:a}}async function I(e,o,i){const{blob:u,assetType:l,assetName:c}=e;let p=null;try{const e=await m({data:u,name:c},o.url,i);r(i),p={assetType:l,assetUploadId:e.itemID}}catch(f){a(f),s.getLogger(\"esri.layers.graphics.sources.support.uploadAssets\").warnOnce(`Service ${o.url} does not support the REST Uploads API.`)}if(!p){const e=await n(u);if(r(i),!e.isBase64)throw new t(`${o.type}-layer:uploadAssets-failure`,\"Expected gltf data in base64 format after conversion.\",new Error);p={assetType:l,assetData:e.data}}if(!p)throw new t(`${o.type}-layer:uploadAssets-failure`,\"Unable to prepare uploadAsset request options.\",new Error);return{item:p,assetName:c}}async function R(s,a,o){const n=await e(i(a.parsedUrl.path,\"uploadAssets\"),{timeout:0,query:{f:\"json\",assets:JSON.stringify(s)},method:\"post\",responseType:\"json\"});if(r(o),n.data.uploadResults.length!==s.length)throw new t(`${a.type}-layer:uploadAssets-failure`,`Bad response. Uploaded ${s.length} items and received ${n.data.uploadResults.length} results.`,new Error);return n.data}function L(e,s,r){const{success:a}=s;if(!a){const{error:a}=s;throw new t(`${r.type}-layer:upload-failure`,`Failed to upload mesh file ${e.assetName}. Error code: ${a.code}. Error message: ${a.messages}`,new Error)}const{assetHash:o}=s,{assetName:n,item:{assetType:i}}=e,{infoFor3D:{supportedFormats:u}}=r,l=y(i,u);if(!l)throw new t(`${r.type}-layer:upload-failure`,`The service allowed us to upload an asset of FormatID ${i}, but it does not list it in its supported formats.`,new Error);return new p(n,l,[new f(`${r.parsedUrl.path}/assets/${o}`,o)])}async function q(s,r,a){const o=s.map((({assetName:e,parts:t})=>({assetName:e,assetHash:t[0].partHash}))),n=r.capabilities?.operations.supportsAsyncConvert3D,u={query:{f:\"json\",assets:JSON.stringify(o),transportType:\"esriTransportTypeUrl\",targetFormat:a,async:n},responseType:\"json\",timeout:0},l=i(r.parsedUrl.path,\"convert3D\"),c=(n?await C(l,u):await e(l,u)).data,{infoFor3D:{supportedFormats:d}}=r;return c.assets.map((e=>{const s=w(e.contentType,d);if(!s)throw new t(`${r.type}-layer:upload-failure`,`The service allowed us to upload an asset of FormatID ${s}, but it does not list it in its supported formats.`,new Error);return new p(e.assetName,e.contentType,[new f(e.assetURL,e.assetHash)])}))}async function C(s,r){const a=(await e(s,r)).data.statusUrl;for(;;){const s=(await e(a,{query:{f:\"json\"},responseType:\"json\"})).data;switch(s.status){case\"Completed\":return e(s.resultUrl,{query:{f:\"json\"},responseType:\"json\"});case\"CompletedWithErrors\":throw new t(\"async-convert3D-failed\",\"asynchronous convert3D call failed.\");case\"Failed ImportChanges\":case\"InProgress\":case\"Pending\":case\"ExportAttachments\":case\"ExportChanges\":case\"ExportingData\":case\"ExportingSnapshot\":case\"ImportAttachments\":case\"ProvisioningReplica\":case\"UnRegisteringReplica\":break;default:throw new t(\"async-convert3D-failed\",\"asynchronous convert3D call failed (undefined response status)\")}await o(H)}}function P(e){return!!e.infoFor3D&&!!e.url}function B(e){const{infoFor3D:s}=e,r=w(\"model/gltf-binary\",s.supportedFormats)??h(\"glb\",s.supportedFormats);if(!r)throw new t(`${e.type}-layer:upload-failure`,\"Layer does not support glb.\",new Error);return r}const H=1e3;export{g as uploadAssets};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.27/esri/copyright.txt for details.\n*/\nimport e from\"../../../../request.js\";import{throwIfAborted as t}from\"../../../../core/promiseUtils.js\";import{join as o}from\"../../../../core/urlUtils.js\";import{isHostedAgolService as s}from\"../../../support/arcgisLayerUrl.js\";const r=1e6,a=20*r,n=2e9,i=3;async function p({data:p,name:c,description:l},m,d){let f=null;try{const u=o(m,\"uploads\"),h=o(u,\"info\"),{data:w}=await e(h,{query:{f:\"json\"},responseType:\"json\"});t(d);const y=s(m),j=w.maxUploadFileSize*r,g=y?n:j,q=y?Math.min(a,j):a;if(p.size>g)throw new Error(\"Data too large\");const T=o(u,\"register\"),{data:z}=await e(T,{query:{f:\"json\",itemName:c,description:l},responseType:\"json\",method:\"post\"});if(t(d),!z.success)throw new Error(\"Registration failed\");const{itemID:E}=z.item;f=o(u,E);const U=o(f,\"uploadPart\"),D=Math.ceil(p.size/q),M=new Array;for(let e=0;e<D;++e)M.push(p.slice(e*q,Math.min((e+1)*q,p.size)));const P=M.slice().reverse(),x=new Array,A=async()=>{for(;0!==P.length;){const o=M.length-P.length,s=P.pop(),r=new FormData;r.append(\"f\",\"json\"),r.append(\"file\",s),r.append(\"partId\",`${o}`);const{data:a}=await e(U,{timeout:0,body:r,responseType:\"json\",method:\"post\"});if(t(d),!a.success)throw new Error(\"Part upload failed\")}};for(let e=0;e<i&&0!==P.length;++e)x.push(A());await Promise.all(x);const F=o(f,\"commit\"),{data:I}=await e(F,{query:{f:\"json\",parts:M.map(((e,t)=>t)).join(\",\")},responseType:\"json\",method:\"post\"});if(t(d),!I.success)throw new Error(\"Commit failed\");return I.item}catch(u){if(null!=f){const t=o(f,\"delete\");await e(t,{query:{f:\"json\"},responseType:\"json\",method:\"post\"})}throw u}}export{p as uploadItem};\n"],"names":["$9pNSx","parcelRequire","async","$cedde4d05fdfe235$export$54085e1fef2ee78e","e","t","s","length","Promise","all","map","layer","ongoingUploads","r","a","o","get","infoFor3D","url","$cedde4d05fdfe235$var$P","$kyj08","default","type","Error","parsedUrl","metadata","externalSources","some","$hqLgT","externalIsOnService","$cedde4d05fdfe235$var$b","n","displaySource","$cedde4d05fdfe235$var$x","source","i","u","l","$cedde4d05fdfe235$var$N","original","$cedde4d05fdfe235$var$$","$cedde4d05fdfe235$var$B","e1","$cedde4d05fdfe235$var$U","addExternalSources","$cedde4d05fdfe235$var$q","$cedde4d05fdfe235$var$F","load","toBinaryGLTF","ignoreLocalTransform","$10vEZ","throwIfAborted","buffer","blob","Blob","data","assetName","$9Rl0r","generateBracedUUID","assetType","$cedde4d05fdfe235$var$D","$cedde4d05fdfe235$var$A","extent","clone","$cedde4d05fdfe235$var$j","c","$cedde4d05fdfe235$var$E","set","delete","$cedde4d05fdfe235$var$T","supportedFormats","editFormats","externalSourceToMultiPart","Array","$cedde4d05fdfe235$var$v","includes","push","assetFormatId","asset","File","name","toBlob","$cedde4d05fdfe235$var$S","p","$19uTx","uploadItem","assetUploadId","itemID","f","throwIfAbortError","$jHOLN","getLogger","warnOnce","e2","$kYueh","parseData","isBase64","assetData","item","$cedde4d05fdfe235$var$I","uploadResults","join","path","timeout","query","assets","JSON","stringify","method","responseType","$cedde4d05fdfe235$var$R","success","error","a1","code","messages","assetHash","$g1GYh","getFormatIdMimeType","ServiceAsset","ServiceAssetPart","$cedde4d05fdfe235$var$L","ref","parts","partHash","capabilities","operations","supportsAsyncConvert3D","transportType","targetFormat","statusUrl","s1","status","resultUrl","after","$cedde4d05fdfe235$var$H","$cedde4d05fdfe235$var$C","d","getMimeTypeFormatId","contentType","assetURL","getFilenameFormatId","$0d6e98c94ca4c82a$var$r","$0d6e98c94ca4c82a$var$a","$0d6e98c94ca4c82a$export$e5277fc94f47f9c6","description","m","h","w","y","$lmu5w","isHostedAgolService","j","maxUploadFileSize","g","q","Math","min","size","T","z","itemName","E","U","D","ceil","M","slice","P","reverse","x","A","pop","FormData","append","body","F","I","u1","t1"],"version":3,"file":"uploadAssets.70b60da2.js.map"}