!function(){function e(e){return e&&e.__esModule?e.default:e}function r(e,r,t,n){Object.defineProperty(e,r,{get:t,set:n,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("blFzk",(function(n,a){var o;o=n.exports,Object.defineProperty(o,"__esModule",{value:!0,configurable:!0}),r(n.exports,"default",(function(){return I}));var i=t("8TSCy"),l=t("2TvXO"),s=t("7eJjO"),u=t("9pNSx"),c=t("kyj08"),d=t("jHOLN"),p=t("7qybv"),h=t("8NioF"),f=t("10vEZ"),y=t("kYueh"),v=t("iho5X");t("lNwWH"),t("2VlWd"),t("iJAIC");var g=t("eB8sj"),m=t("fcwIv"),_=t("dt8qO"),w=t("4LDxK"),b=t("1a7AW"),k=t("aLy89"),S=t("5N5S1"),T=t("9bAYR"),x=t("gRgX5"),C=t("lsDKR"),j=d.default.getLogger("esri.layers.ElevationLayer"),L=function(r){"use strict";i.inherits(a,r);var n=i.createSuper(a);function a(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var o;return i.classCallCheck(this,a),(o=n.call.apply(n,[this].concat(i.toConsumableArray(r)))).copyright=null,o.heightModelInfo=null,o.path=null,o.opacity=1,o.operationalLayerType="ArcGISTiledElevationServiceLayer",o.sourceJSON=null,o.type="elevation",o.url=null,o.version=null,o._lercDecoder=(0,C.acquireDecoder)(),i.possibleConstructorReturn(o)}return i.createClass(a,[{key:"normalizeCtorArgs",value:function(e,r){return"string"==typeof e?i.objectSpread({url:e},r):e}},{key:"destroy",value:function(){this._lercDecoder=(0,p.releaseMaybe)(this._lercDecoder)}},{key:"minScale",get:function(){},set:function(e){this.constructed&&j.warn("".concat(this.declaredClass,".minScale support has been removed (since 4.5)"))}},{key:"maxScale",get:function(){},set:function(e){this.constructed&&j.warn("".concat(this.declaredClass,".maxScale support has been removed (since 4.5)"))}},{key:"readVersion",value:function(e,r){var t=r.currentVersion;return t||(t=9.3),t}},{key:"load",value:function(e){var r=this,t=(0,p.isSome)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(e){for(var r=0;r<e.typeKeywords.length;r++)if("elevation 3d layer"===e.typeKeywords[r].toLowerCase())return!0;throw new(0,c.default)("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"})}},e).catch(f.throwIfAbortError).then((function(){return r._fetchImageService(t)}))),Promise.resolve(this)}},{key:"fetchTile",value:function(e,r,t,n){var a=this,o=(0,p.isSome)((n=n||{signal:null}).signal)?n.signal:n.signal=(new AbortController).signal,i={responseType:"array-buffer",signal:o},l={noDataValue:n.noDataValue,returnFileInfo:!0};return this.load().then((function(){return a._fetchTileAvailability(e,r,t,n)})).then((function(){return(0,u.default)(a.getTileUrl(e,r,t),i)})).then((function(e){return a._lercDecoder.decode(e.data,l,o)})).then((function(e){return{values:e.pixelData,width:e.width,height:e.height,maxZError:e.fileInfo.maxZError,noDataValue:e.noDataValue,minValue:e.minValue,maxValue:e.maxValue}}))}},{key:"getTileUrl",value:function(e,r,t){var n=!this.tilemapCache&&this.supportsBlankTile,a=(0,y.objectToQuery)(i.objectSpread({},this.parsedUrl.query,{blankTile:!n&&null}));return"".concat(this.parsedUrl.path,"/tile/").concat(e,"/").concat(r,"/").concat(t).concat(a?"?"+a:"")}},{key:"queryElevation",value:function(r,n){var a=this;return i.asyncToGenerator(e(l).mark((function o(){var i,s;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("fNjxZ");case 2:return i=e.sent,s=i.ElevationQuery,(0,f.throwIfAborted)(n),e.abrupt("return",(new s).query(a,r,n));case 6:case"end":return e.stop()}}),o)})))()}},{key:"createElevationSampler",value:function(r,n){var a=this;return i.asyncToGenerator(e(l).mark((function o(){var i,s;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("fNjxZ");case 2:return i=e.sent,s=i.ElevationQuery,(0,f.throwIfAborted)(n),e.abrupt("return",(new s).createSampler(a,r,n));case 6:case"end":return e.stop()}}),o)})))()}},{key:"_fetchTileAvailability",value:function(e,r,t,n){return this.tilemapCache?this.tilemapCache.fetchAvailability(e,r,t,n):Promise.resolve("unknown")}},{key:"_fetchImageService",value:function(r){var t=this;return i.asyncToGenerator(e(l).mark((function n(){var a,o;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.sourceJSON){e.next=2;break}return e.abrupt("return",t.sourceJSON);case 2:return a={query:i.objectSpread({f:"json"},t.parsedUrl.query),responseType:"json",signal:r},e.next=5,(0,u.default)(t.parsedUrl.path,a);case 5:(o=e.sent).ssl&&(t.url=t.url.replace(/^http:/i,"https:")),t.sourceJSON=o.data,t.read(o.data,{origin:"service",url:t.parsedUrl});case 7:case"end":return e.stop()}}),n)})))()}},{key:"hasOverriddenFetchTile",get:function(){return!this.fetchTile.__isDefault__}}]),a}((0,b.ArcGISCachedService)((0,k.ArcGISService)((0,S.OperationalLayer)((0,T.PortalLayer)((0,h.MultiOriginJSONMixin)(w.default))))));(0,s._)([(0,v.property)({json:{read:{source:"copyrightText"}}})],L.prototype,"copyright",void 0),(0,s._)([(0,v.property)({readOnly:!0,type:_.default})],L.prototype,"heightModelInfo",void 0),(0,s._)([(0,v.property)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],L.prototype,"path",void 0),(0,s._)([(0,v.property)({type:["show","hide"]})],L.prototype,"listMode",void 0),(0,s._)([(0,v.property)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],L.prototype,"minScale",null),(0,s._)([(0,v.property)({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],L.prototype,"maxScale",null),(0,s._)([(0,v.property)({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],L.prototype,"opacity",void 0),(0,s._)([(0,v.property)({type:["ArcGISTiledElevationServiceLayer"]})],L.prototype,"operationalLayerType",void 0),(0,s._)([(0,v.property)()],L.prototype,"sourceJSON",void 0),(0,s._)([(0,v.property)({json:{read:!1},value:"elevation",readOnly:!0})],L.prototype,"type",void 0),(0,s._)([(0,v.property)(x.url)],L.prototype,"url",void 0),(0,s._)([(0,v.property)()],L.prototype,"version",void 0),(0,s._)([(0,g.reader)("version",["currentVersion"])],L.prototype,"readVersion",null),(L=(0,s._)([(0,m.subclass)("esri.layers.ElevationLayer")],L)).prototype.fetchTile.__isDefault__=!0;var I=L})),t.register("lsDKR",(function(e,n){r(e.exports,"acquireDecoder",(function(){return s}));var a=t("8TSCy"),o=t("7qybv"),i=function(e){"use strict";a.inherits(t,e);var r=a.createSuper(t);function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return a.classCallCheck(this,t),(e=r.call(this,"LercWorker","_decode",n,{strategy:"dedicated"})).schedule=n,e.ref=0,a.possibleConstructorReturn(e)}return a.createClass(t,[{key:"decode",value:function(e,r,t){return e&&0!==e.byteLength?this.invoke({buffer:e,options:r},t):Promise.resolve(null)}},{key:"getTransferList",value:function(e){return[e.buffer]}},{key:"release",value:function(){var e=this;--this.ref<=0&&(l.forEach((function(r,t){r===e&&l.delete(t)})),this.destroy())}}]),t}(t("g3Wkg").WorkerHandle),l=new Map;function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=l.get((0,o.unwrap)(e));return r||((0,o.isSome)(e)?(r=new i((function(r){return e.schedule(r)})),l.set(e,r)):(r=new i,l.set(null,r))),++r.ref,r}})),t.register("g3Wkg",(function(e,n){r(e.exports,"WorkerHandle",(function(){return p}));var a=t("8TSCy"),o=t("lNwWH"),i=t("6ah52"),l=t("jHOLN"),s=t("7qybv"),u=t("10vEZ"),c=t("gdXB3"),d=l.default.getLogger("esri.core.workers.WorkerHandle"),p=function(){"use strict";function e(r,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this;a.classCallCheck(this,e),this._mainMethod=t,this._listeners=[],this._promise=(0,c.open)(r,a.objectSpread({},o,{schedule:n})).then((function(e){if(void 0===i._thread){i._thread=e,i._promise=null,o.hasInitialize&&i.broadcast({},"initialize");var r=!0,t=!1,n=void 0;try{for(var a,l=i._listeners[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var s=a.value;i._connectListener(s)}}catch(e){t=!0,n=e}finally{try{r||null==l.return||l.return()}finally{if(t)throw n}}}else e.close()})),this._promise.catch((function(e){return d.error("Failed to initialize ".concat(r," worker: ").concat(e))}))}return a.createClass(e,[{key:"on",value:function(e,r){var t=this,n={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(n),this._connectListener(n),(0,i.makeHandle)((function(){n.removed=!0,(0,o.remove)(t._listeners,n),t._thread&&(0,s.isSome)(n.threadHandle)&&n.threadHandle.remove()}))}},{key:"destroy",value:function(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}},{key:"invoke",value:function(e,r){return this.invokeMethod(this._mainMethod,e,r)}},{key:"invokeMethod",value:function(e,r,t){var n=this;if(this._thread){var a=this.getTransferList(r,e);return this._thread.invoke(e,r,{transferList:a,signal:t})}return this._promise?this._promise.then((function(){return(0,u.throwIfAborted)(t),n.invokeMethod(e,r,t)})):Promise.reject(null)}},{key:"broadcast",value:function(e,r){var t=this;return this._thread?Promise.all(this._thread.broadcast(r,e)).then((function(){})):this._promise?this._promise.then((function(){return t.broadcast(e,r)})):Promise.reject()}},{key:"promise",get:function(){return this._promise}},{key:"_connectListener",value:function(e){this._thread&&this._thread.on(e.eventName,e.callback).then((function(r){e.removed||(e.threadHandle=r)}))}}]),e}()})),t.register("fNjxZ",(function(e,r){e.exports=t("4WKyX")(t("aNJCr").getBundleURL("6Qw24")+t("iE7OH").resolve("k6tQN")).then((function(){return t("7gr2y")}))}))}();
//# sourceMappingURL=ElevationLayer.af16bc5f.js.map
