!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("8hKBq",(function(n,a){var o;o=n.exports,Object.defineProperty(o,"__esModule",{value:!0,configurable:!0}),t(n.exports,"default",(function(){return b}));var i=r("8TSCy"),l=r("2TvXO"),u=r("7eJjO");r("2VlWd");var s=r("7qybv");r("jHOLN"),r("iJAIC"),r("lNwWH"),r("62edV");var c=r("fcwIv"),f=r("9doMy"),d=r("e51b3"),y=r("4WoSm"),p=r("fUO9S"),h=r("6r3ht"),v=function e(t,r){"use strict";i.classCallCheck(this,e),this.offset=t,this.extent=r};function g(e){var t=e.key,r=new Map,n=256,a=y.TILE_SIZE,o=e.tileInfoView.tileInfo.isWrappable;return r.set((0,h.getPow2NeighborKey)(t,-1,-1,o).id,new v([-a,-a],[a-n,a-n,a,a])),r.set((0,h.getPow2NeighborKey)(t,0,-1,o).id,new v([0,-a],[0,a-n,a,a])),r.set((0,h.getPow2NeighborKey)(t,1,-1,o).id,new v([a,-a],[0,a-n,n,a])),r.set((0,h.getPow2NeighborKey)(t,-1,0,o).id,new v([-a,0],[a-n,0,a,a])),r.set((0,h.getPow2NeighborKey)(t,1,0,o).id,new v([a,0],[0,0,n,a])),r.set((0,h.getPow2NeighborKey)(t,-1,1,o).id,new v([-a,a],[a-n,0,a,n])),r.set((0,h.getPow2NeighborKey)(t,0,1,o).id,new v([0,a],[0,0,a,n])),r.set((0,h.getPow2NeighborKey)(t,1,1,o).id,new v([a,a],[0,0,n,n])),r}var w=function(t){"use strict";i.inherits(n,t);var r=i.createSuper(n);function n(){var e;return i.classCallCheck(this,n),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments)))).type="heatmap",e._tileKeyToFeatureSets=new Map,i.possibleConstructorReturn(e)}return i.createClass(n,[{key:"initialize",value:function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}},{key:"update",value:function(t,r){var n=this;return i.asyncToGenerator(e(l).mark((function a(){var o;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("heatmap"===(o=r.schema.processors[0]).type){e.next=3;break}return e.abrupt("return");case 3:(0,f.diff)(n._schema,o)&&(t.mesh=!0,n._schema=o);case 4:case"end":return e.stop()}}),a)})))()}},{key:"onTileUpdate",value:function(e){var t=!0,r=!1,n=void 0;try{for(var a,o=e.removed[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;this._tileKeyToFeatureSets.delete(i.key.id)}}catch(e){r=!0,n=e}finally{try{t||null==o.return||o.return()}finally{if(r)throw n}}}},{key:"onTileClear",value:function(e){return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}},{key:"onTileMessage",value:function(t,r,n){var a=this;return i.asyncToGenerator(e(l).mark((function o(){var u,c,f,y,p,h;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a._tileKeyToFeatureSets.has(t.key.id)||a._tileKeyToFeatureSets.set(t.key.id,new Map),u=a._tileKeyToFeatureSets.get(t.key.id),(0,s.isSome)(r.addOrUpdate)&&r.addOrUpdate.hasFeatures&&u.set(r.addOrUpdate.instance,r),!r.end){e.next=7;break}return c=[],f=g(t),a._tileKeyToFeatureSets.forEach((function(e,r){if(r===t.key.id)e.forEach((function(e){return(0,s.applySome)(e.addOrUpdate,(function(e){return c.push(e)}))}));else if(f.has(r)){var n=f.get(r),a=i.slicedToArray(n.offset,2),o=a[0],l=a[1];e.forEach((function(e){return(0,s.applySome)(e.addOrUpdate,(function(e){var t=e.transform(o,l,1,1);c.push(t)}))}))}})),y=(0,d.calculateHeatmapIntensityInfoReaders)(c,a._schema.mesh,512,512),p={tileKey:t.key.id,intensityInfo:y},h=[y.matrix],e.abrupt("return",a.remoteClient.invoke("tileRenderer.onTileData",p,i.objectSpread({},n,{transferList:h})));case 7:case"end":return e.stop()}}),o)})))()}},{key:"onTileError",value:function(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},r)}}]),n}(p.default),b=w=(0,u._)([(0,c.subclass)("esri.views.2d.layers.features.processors.HeatmapProcessor")],w)})),r.register("e51b3",(function(e,n){t(e.exports,"generateGradient",(function(){return o})),t(e.exports,"calculateHeatmapIntensityInfoReaders",(function(){return i})),t(e.exports,"drawHeatmap",(function(){return l}));var a=r("iVfa0"),o=function(){if(!("document"in globalThis))return function(){return null};var e=document.createElement("canvas"),t=e.getContext("2d");return e.height=512,e.width=1,function(r){t.clearRect(0,0,1,e.height);var n=t.createLinearGradient(0,0,0,e.height),a=!0,o=!1,i=void 0;try{for(var l,u=r[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var s=l.value,c=s.ratio,f=s.color;n.addColorStop(Math.max(c,.001),"rgba(".concat(f.r,", ").concat(f.g,", ").concat(f.b,", ").concat(f.a,")"))}}catch(e){o=!0,i=e}finally{try{a||null==u.return||u.return()}finally{if(o)throw i}}return t.fillStyle=n,t.fillRect(0,0,1,e.height),t.getImageData(0,0,1,e.height).data}}();function i(e,t,r,n){var a,o,i,l=t.blurRadius,s=t.fieldOffset,c=t.field,f=new Float64Array(r*n),d=u(l),y=Math.round(3*l),p=Number.NEGATIVE_INFINITY,h=(i=s,null!=(o=c)?"string"==typeof i?function(e){return-1*+e.readAttribute(o)}:function(e){return+e.readAttribute(o)+i}:function(e){return 1}),v=new Set,g=!0,w=!1,b=void 0;try{for(var m,S=e[Symbol.iterator]();!(g=(m=S.next()).done);g=!0)for(var T=m.value.getCursor();T.next();){var k=T.getObjectId();if(!v.has(k)){v.add(k);var x=T.readLegacyPointGeometry(),_=128;if(!(x.x<-_||x.x>=r+_||x.y<-_||x.y>n+_))for(var I=+h(T),M=Math.round(x.x)-y,O=Math.round(x.y)-y,C=Math.max(0,M),K=Math.max(0,O),N=Math.min(n,Math.round(x.y)+y),U=Math.min(r,Math.round(x.x)+y),A=K;A<N;A++)for(var P=d[A-O],R=C;R<U;R++){var F=d[R-M];(a=f[A*r+R]+=P*F*I)>p&&(p=a)}}}}catch(e){w=!0,b=e}finally{try{g||null==S.return||S.return()}finally{if(w)throw b}}return{matrix:f.buffer,max:p}}function l(e,t,r,n,o,i){e.canvas.width=e.canvas.height=t,e.clearRect(0,0,t,t);var l=e.getImageData(0,0,t,t);r&&n&&l.data.set(new Uint8ClampedArray(function(e,t,r,n,o){for(var i=new Uint32Array(e*e),l=("buffer"in t?t:new Float64Array(t)),u=("buffer"in r?new Uint32Array(r.buffer):new Uint32Array(new Uint8Array(r).buffer)),s=u.length/(o-n),c=0;c<l.length;c++){var f=l[c],d=Math.floor((f-n)*s);i[c]=u[(0,a.clamp)(d,0,u.length-1)]}return i.buffer}(t,r,n,o,i))),e.putImageData(l,0,0)}function u(e){for(var t=Math.round(3*e),r=2*e*e,n=new Float64Array(2*t+1),a=0;a<=n.length;a++)n[a]=Math.exp(-Math.pow(a-t,2)/r)/Math.sqrt(2*Math.PI)*(e/2);return n}})),r.register("fUO9S",(function(e,n){t(e.exports,"default",(function(){return c}));var a=r("8TSCy"),o=r("7eJjO"),i=r("6dXDO"),l=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var u=r("fcwIv"),s=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){return a.classCallCheck(this,r),t.apply(this,arguments)}return a.createClass(r,[{key:"initialize",value:function(){}},{key:"destroy",value:function(){}},{key:"supportsTileUpdates",get:function(){return!1}},{key:"spatialReference",get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}}]),r}(i.HandleOwner);(0,o._)([(0,l.property)({readOnly:!0})],s.prototype,"supportsTileUpdates",null),(0,o._)([(0,l.property)({constructOnly:!0})],s.prototype,"remoteClient",void 0),(0,o._)([(0,l.property)({constructOnly:!0})],s.prototype,"service",void 0),(0,o._)([(0,l.property)()],s.prototype,"spatialReference",null),(0,o._)([(0,l.property)({constructOnly:!0})],s.prototype,"tileInfo",void 0),(0,o._)([(0,l.property)({constructOnly:!0})],s.prototype,"tileStore",void 0);var c=s=(0,o._)([(0,u.subclass)("esri.views.2d.layers.features.processors.BaseProcessor")],s)})),r.register("6r3ht",(function(e,n){t(e.exports,"getPow2NeighborKey",(function(){return a}));r("2Z8dq");function a(e,t,r,n){var a=e.clone(),o=1<<a.level,i=a.col+t,l=a.row+r;return n&&i<0?(a.col=i+o,a.world-=1):i>=o?(a.col=i-o,a.world+=1):a.col=i,a.row=l,a}}))}();
//# sourceMappingURL=HeatmapProcessor.ba60f220.js.map
