!function(){function e(e,t,r,a){Object.defineProperty(e,t,{get:r,set:a,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("h0ca8",(function(r,a){e(r.exports,"save",(function(){return P})),e(r.exports,"saveAll",(function(){return F})),e(r.exports,"saveAs",(function(){return J}));var n=t("lNwWH"),o=t("kyj08"),i=t("jHOLN"),l=t("7qybv"),s=t("10vEZ"),u=t("amEsL"),d=t("g15Jq"),c=t("1VmFB"),y=t("lmu5w"),f=t("d1ImW"),p=t("ajJOT"),m=t("iYaGG"),w=t("UdTKD"),v=t("7Kuhs");const h=i.default.getLogger("esri.layers.FeatureLayer"),g="Feature Service";function b(e,t){return`Layer (title: ${e.title}, id: ${e.id}) of type '${e.declaredClass}' ${t}`}function S(e,t){if(t.type!==g)throw new(0,o.default)("feature-layer:portal-item-wrong-type",b(e,'should have portal item of type "Feature Service"'))}async function T(e){if(await e.load(),(0,f.isFeatureCollectionLayer)(e))throw new(0,o.default)("feature-layer:save",b(e,"using an in-memory source cannot be saved to a portal item"))}async function I(e,t,r){"beforeSave"in e&&"function"==typeof e.beforeSave&&await e.beforeSave();const a=e.write({},t);return function(e,t){let r=e.messages.filter((({type:e})=>"error"===e)).map((({name:e,message:t,details:r})=>new(0,o.default)(e,t,r)));if((null==t?void 0:t.ignoreUnsupported)&&(r=r.filter((({name:e})=>"layer:unsupported"!==e&&"symbol:unsupported"!==e&&"symbol-layer:unsupported"!==e&&"property:unsupported"!==e&&"url:unsupported"!==e))),r.length>0)throw new(0,o.default)("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:r})}(t,r),a}function K(e){const{layer:t,layerJSON:r}=e;return t.isTable?{layers:[],tables:[r]}:{layers:[r],tables:[]}}function O(e){(0,v.addTypeKeyword)(e,v.TypeKeyword.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(((e,t,r)=>r.indexOf(e)===t)))}async function A(e,t){return/\/\d+\/?$/.test(e.url)?K(t[0]):async function(e,t){const{layer:{url:r,customParameters:a,apiKey:n}}=t[0];let o=await e.fetchData("json");o&&null!=o.layers&&null!=o.tables||(o=await async function(e,t,r){var a,n;e||(e={}),(a=e).layers||(a.layers=[]),(n=e).tables||(n.tables=[]);const{url:o,customParameters:i,apiKey:u}=t,{serviceJSON:y,layersJSON:f}=await(0,c.fetchFeatureService)(o,{customParameters:i,apiKey:u}),p=E(e.layers,y.layers,r),m=E(e.tables,y.tables,r);e.layers=p.itemResources,e.tables=m.itemResources;const w=[...p.added,...m.added],v=f?[...f.layers,...f.tables]:[];return await async function(e,t,r,a){const n=t.map((({id:e})=>new(0,d.default)({url:r,layerId:e,sourceJSON:a.find((({id:t})=>t===e))})));await(0,s.eachAlways)(n.map((e=>e.load()))),n.forEach((t=>{const{layerId:r,loaded:a,defaultPopupTemplate:n}=t;a&&!(0,l.isNone)(n)&&x(t,{id:r,popupInfo:n.toJSON()},e)}))}(e,w,o,v),e}(o,{url:r,customParameters:a,apiKey:n},t.map((e=>e.layer.layerId))));for(const e of t)x(e.layer,e.layerJSON,o);return o}(e,t)}function E(e,t,r){const a=(0,n.difference)(e,t,((e,t)=>e.id===t.id));e=e.filter((e=>!a.removed.some((t=>t.id===e.id))));const o=a.added.map((({id:e})=>({id:e})));return o.forEach((({id:t})=>{e.push({id:t})})),{itemResources:e,added:o.filter((({id:e})=>!r.includes(e)))}}function x(e,t,r){e.isTable?L(r.tables,t):L(r.layers,t)}function L(e,t){const r=e.findIndex((({id:e})=>e===t.id));-1===r?e.push(t):e[r]=t}function N(e){const{portalItem:t}=e;return(0,f.isFeatureServiceLayer)(e)&&!e.dynamicDataSource&&!!(null==t?void 0:t.loaded)&&t.type===g}const P=(0,s.debounce)((async function(e,t){await T(e),function(e){const t=e.portalItem;if(!t)throw h.error("save: requires the portalItem property to be set"),new(0,o.default)("feature-layer:portal-item-not-set",b(e,"requires the portalItem property to be set"));if(!t.loaded)throw new(0,o.default)("feature-layer:portal-item-not-loaded",b(e,"cannot be saved to a portal item that does not exist or is inaccessible"));S(e,t)}(e);const r=e.portalItem,a=(0,w.createForItemWrite)(r),n=await I(e,a,t),i=await A(r,[{layer:e,layerJSON:n}]);return O(r),await r.update({data:i}),(0,u.updateOrigins)(a),r}));const F=(0,s.debounce)((async(e,t)=>{await async function(e){if(!(null==e?void 0:e.length))throw new(0,o.default)("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");await Promise.all(e.map((e=>e.load())));for(const t of e)if(!N(t))throw new(0,o.default)("feature-layer-utils-saveall:invalid-parameters",`'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ${b(t,"does not conform")}`,{layer:t});const t=e.map((e=>e.portalItem.id));if(new Set(t).size>1)throw new(0,o.default)("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");const r=e.map((e=>e.layerId));if(new Set(r).size!==r.length)throw new(0,o.default)("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service")}(e);const r=e[0].portalItem,a=(0,w.createForItemWrite)(r),n=await Promise.all(e.map((e=>I(e,a,t)))),i=await A(r,e.map(((e,t)=>({layer:e,layerJSON:n[t]}))));return O(r),await r.update({data:i}),await Promise.all(e.slice(1).map((e=>e.portalItem.reload()))),(0,u.updateOrigins)(a),r.clone()})),J=(0,s.debounce)((async function(e,t,r){await T(e);const a=function(e,t){var r,a;let n=m.default.from(t);var o,i;return n.id&&(n=n.clone(),n.id=null),null!==(o=(r=n).type)&&void 0!==o||(r.type=g),null!==(i=(a=n).portal)&&void 0!==i||(a.portal=p.default.getDefault()),S(e,n),n}(e,t),n=(0,w.createForItemWrite)(a),o=K({layer:e,layerJSON:await I(e,n,r)});return await async function(e,t){const{url:r,layerId:a,title:n,fullExtent:o,isTable:i}=e,s=(0,y.parse)(r),u=(0,l.isSome)(s)&&"FeatureServer"===s.serverType;t.url=u?r:`${r}/${a}`,t.title||(t.title=n),t.extent=null,!i&&(0,l.isSome)(o)&&(t.extent=await(0,v.getWGS84ExtentForItem)(o)),(0,v.removeTypeKeyword)(t,v.TypeKeyword.METADATA),(0,v.removeTypeKeyword)(t,v.TypeKeyword.MULTI_LAYER),(0,v.addTypeKeyword)(t,v.TypeKeyword.SINGLE_LAYER),i&&(0,v.addTypeKeyword)(t,v.TypeKeyword.TABLE),O(t)}(e,a),await async function(e,t,r){const a=e.portal;await a._signIn(),await a.user.addItem({item:e,data:t,folder:null==r?void 0:r.folder})}(a,o,r),e.portalItem=a,(0,u.updateOrigins)(n),a}))})),t.register("amEsL",(function(r,a){e(r.exports,"updateOrigins",(function(){return o}));var n=t("arTQ0");function o(e){e&&e.writtenProperties&&e.writtenProperties.forEach((({target:e,propName:t,newOrigin:r})=>{(0,n.isMultiOriginJSONMixin)(e)&&r&&e.originOf(t)!==r&&e.updateOrigin(t,r)}))}})),t.register("arTQ0",(function(t,r){function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}e(t.exports,"isMultiOriginJSONMixin",(function(){return a}))})),t.register("7Kuhs",(function(r,a){e(r.exports,"addTypeKeyword",(function(){return l})),e(r.exports,"hasTypeKeyword",(function(){return s})),e(r.exports,"removeTypeKeyword",(function(){return u})),e(r.exports,"getWGS84ExtentForItem",(function(){return d})),e(r.exports,"TypeKeyword",(function(){return c}));var n=t("7RvA5"),o=t("j40xv"),i=t("eF88h");function l(e,t){if(!s(e,t)){const r=e.typeKeywords;r?r.push(t):e.typeKeywords=[t]}}function s(e,t){var r;return!!(null===(r=e.typeKeywords)||void 0===r?void 0:r.includes(t))}function u(e,t){const r=e.typeKeywords;if(r){const e=r.indexOf(t);e>-1&&r.splice(e,1)}}async function d(e){const t=e.clone().normalize();let r;if(t.length>1)for(const e of t)r?e.width>r.width&&(r=e):r=e;else r=t[0];return async function(e){const t=e.spatialReference;if(t.isWGS84)return e.clone();if(t.isWebMercator)return(0,i.webMercatorToGeographic)(e);const r=o.default.WGS84;return await(0,n.initializeProjection)(t,r),(0,n.project)(e,r)}(r)}const c={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table"}}))}();
//# sourceMappingURL=featureLayerUtils.e14824a0.js.map
