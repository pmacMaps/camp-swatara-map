function e(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("w1b4k",(function(r,i){e(r.exports,"default",(function(){return _}));var s=t("bPmsI"),n=t("6TszD"),a=t("1CpCt"),o=t("19dbe"),u=t("772GK"),d=t("hOW65"),l=t("UbUrW"),c=t("4JNri"),h=t("gC5jC"),p=t("8FlpL"),f=t("fJsQB");const g=n.default.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter");class _{get hash(){return this._hash}check(e){return this._applyFilter(e)}clear(){const e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}invalidate(){this._idToVisibility.forEach(((e,t)=>{this._idToVisibility.set(t,0)}))}setKnownIds(e){for(const t of e)this._idToVisibility.set(t,1)}setTrue(e){const t=[],r=[],i=new Set(e);return this._idToVisibility.forEach(((e,s)=>{const n=!!(1&this._idToVisibility.get(s)),a=i.has(s);!n&&a?t.push(s):n&&!a&&r.push(s),this._idToVisibility.set(s,a?3:0)})),{show:t,hide:r}}createQuery(){const{geometry:e,spatialRel:t,where:r,timeExtent:i,objectIds:s}=this;return h.default.fromJSON({geometry:e,spatialRel:t,where:r,timeExtent:i,objectIds:s})}async update(e,t){this._hash=JSON.stringify(e);const r=await(0,c.normalizeQueryLike)(e,null,t);await Promise.all([this._setGeometryFilter(r),this._setIdFilter(r),this._setAttributeFilter(r),this._setTimeFilter(r)])}async _setAttributeFilter(e){if(!e||!e.where)return this._clause=null,void(this.where=null);this._clause=await(0,f.createWhereClause)(e.where,this._serviceInfo.fieldsIndex),this.where=e.where}_setIdFilter(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}async _setGeometryFilter(e){if(!e||!e.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const t=e.geometry,r=e.spatialRel||"esriSpatialRelIntersects",i=await(0,d.getSpatialQueryOperator)(r,t,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);(0,u.getBoundsXY)(this._geometryBounds,t),this._spatialQueryOperator=i,this.geometry=t,this.spatialRel=r}_setTimeFilter(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,l.getTimeOperator)(this._serviceInfo.timeInfo,e.timeExtent,p.featureAdapter);else{const t=new(0,s.default)("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);g.error(t)}}_applyFilter(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}_filterByExpression(e){return!this.where||this._clause(e)}_filterById(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;const t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}_filterByTime(e){return!!(0,a.isNone)(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){const e=[];return this._idToVisibility.forEach(((t,r)=>{1&t||(this._idToVisibility.set(r,1),e.push(r))})),e}constructor(e){this._geometryBounds=(0,o.create)(),this._idToVisibility=new Map,this._serviceInfo=e}}})),t.register("hOW65",(function(r,i){e(r.exports,"getSpatialQueryOperator",(function(){return I})),e(r.exports,"checkSpatialQuerySupport",(function(){return x})),e(r.exports,"canQueryWithRBush",(function(){return b}));var s=t("bPmsI"),n=t("6fwEV"),a=t("f34r5"),o=t("86d4E"),u=t("fau59"),d=t("7xmrM"),l=t("8RZNq"),c=t("i24Gp"),h=t("haPYR"),p=t("4JNri");const f="feature-store:unsupported-query",g={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},_={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},y={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},m={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function I(e,r,i,s,u){if((0,o.isPolygon)(r)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=(0,l.convertFromPolygon)(new(0,c.default),r,!1,!1);return Promise.resolve((t=>(0,d.polygonContainsPoint)(e,!1,!1,t)))}if((0,o.isPolygon)(r)&&"esriGeometryMultipoint"===i){const t=(0,l.convertFromPolygon)(new(0,c.default),r,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>(0,d.polygonContainsMultipoint)(t,!1,!1,e,s,u)))}if((0,o.isExtent)(r)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>(0,n.extentContainsPoint)(r,(0,p.getGeometry)(i,s,u,e))));if((0,o.isExtent)(r)&&"esriGeometryMultipoint"===i&&"esriSpatialRelContains"===e)return Promise.resolve((e=>(0,n.extentContainsMultipoint)(r,(0,p.getGeometry)(i,s,u,e))));if((0,o.isExtent)(r)&&"esriSpatialRelIntersects"===e){const e=(0,a.getExtentIntersector)(i);return Promise.resolve((t=>e(r,(0,p.getGeometry)(i,s,u,t))))}return t("fCutU").then((t=>{const n=t[g[e]].bind(null,r.spatialReference,r);return e=>n((0,p.getGeometry)(i,s,u,e))}))}async function x(e,t,r){const{spatialRel:i,geometry:n}=e;if(n){if(!0!==_[i])throw new(0,s.default)(f,"Unsupported query spatial relationship",{query:e});if((0,u.isValid)(n.spatialReference)&&(0,u.isValid)(r)){if(!function(e){return!0===y[(0,o.getJsonType)(e)]}(n))throw new(0,s.default)(f,"Unsupported query geometry type",{query:e});if(!function(e){return!0===m[e]}(t))throw new(0,s.default)(f,"Unsupported layer geometry type",{query:e});if(e.outSR)return(0,h.checkProjectionSupport)(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function b(e){if((0,o.isExtent)(e))return!0;if((0,o.isPolygon)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}})),t.register("f34r5",(function(r,i){e(r.exports,"getExtentIntersector",(function(){return n}));var s=t("fspd0");s=t("fspd0");function n(e){return"mesh"===e?s.extentIntersectsExtent:(0,s.getFeatureExtentIntersector)(e)}})),t.register("7xmrM",(function(t,r){function i(e,t){return e?t?4:3:t?3:2}function s(e,t,r,i){return a(e,t,r,i.coords[0],i.coords[1])}function n(e,t,r,s,n,o){const u=i(n,o),{coords:d,lengths:l}=s;if(!l)return!1;for(let i=0,s=0;i<l.length;i++,s+=u)if(!a(e,t,r,d[s],d[s+1]))return!1;return!0}function a(e,t,r,s,n){if(!e)return!1;const a=i(t,r),{coords:u,lengths:d}=e;let l=!1,c=0;for(const e of d)l=o(l,u,a,c,e,s,n),c+=e*a;return l}function o(e,t,r,i,s,n,a){let o=e,u=i;for(let e=i,d=i+s*r;e<d;e+=r){u=e+r,u===d&&(u=i);const s=t[e],l=t[e+1],c=t[u],h=t[u+1];(l<a&&h>=a||h<a&&l>=a)&&s+(a-l)/(h-l)*(c-s)<n&&(o=!o)}return o}e(t.exports,"polygonContainsPoint",(function(){return s})),e(t.exports,"polygonContainsMultipoint",(function(){return n}))})),t.register("4JNri",(function(r,i){e(r.exports,"QUERY_ENGINE_EMPTY_RESULT",(function(){return g})),e(r.exports,"transformCentroid",(function(){return x})),e(r.exports,"getGeometry",(function(){return b})),e(r.exports,"normalizeQuery",(function(){return S})),e(r.exports,"normalizeQueryLike",(function(){return w})),e(r.exports,"cleanFromGeometryEngine",(function(){return F}));var s=t("4jlRt"),n=t("1CpCt"),a=t("zPXCh"),o=t("lHXAI"),u=t("86d4E"),d=t("hq5aB"),l=t("fau59"),c=(t("dG024"),t("8RZNq")),h=t("i24Gp"),p=t("haPYR");const f=new(0,s.JSONMap)({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),g=Object.freeze({}),_=new(0,h.default),y=new(0,h.default),m=new(0,h.default),I={esriGeometryPoint:c.convertToPoint,esriGeometryPolyline:c.convertToPolyline,esriGeometryPolygon:c.convertToPolygon,esriGeometryMultipoint:c.convertToMultipoint};function x(e,t,r,i=e.hasZ,s=e.hasM){if((0,n.isNone)(t))return null;const a=e.hasZ&&i,o=e.hasM&&s;if(r){const n=(0,c.quantizeOptimizedGeometry)(m,t,e.hasZ,e.hasM,"esriGeometryPoint",r,i,s);return(0,c.convertToPoint)(n,a,o)}return(0,c.convertToPoint)(t,a,o)}function b(e,t,r,i,s,a,o=t,u=r){const d=t&&o,l=r&&u,h=(0,n.isSome)(i)?"coords"in i?i:i.geometry:null;if((0,n.isNone)(h))return null;if(s){let i=(0,c.generalizeOptimizedGeometry)(y,h,t,r,e,s,o,u);return a&&(i=(0,c.quantizeOptimizedGeometry)(m,i,d,l,e,a)),I[e](i,d,l)}if(a){const i=(0,c.quantizeOptimizedGeometry)(m,h,t,r,e,a,o,u);return I[e](i,d,l)}return(0,c.removeZMValues)(_,h,t,r,o,u),I[e](_,d,l)}async function S(e,t,r){const{outFields:i,orderByFields:s,groupByFieldsForStatistics:n,outStatistics:a}=e;if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(a)for(let e=0;e<a.length;e++)a[e].onStatisticField&&(a[e].onStatisticField=a[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),w(e,t,r)}async function w(e,r,i){if(!e)return null;let{where:s}=e;if(e.where=s=s&&s.trim(),(!s||/^1 *= *1$/.test(s)||r&&r===s)&&(e.where=null),!e.geometry)return e;let c=await async function(e){const{geometry:r,distance:i,units:s}=e;if(null==i||"vertexAttributes"in r)return r;const n=r.spatialReference,o=s?f.fromJSON(s):(0,a.getUnitString)(n),u=n&&((0,l.isGeographic)(n)||(0,l.isWebMercator)(n))?r:await(0,p.checkProjectionSupport)(n,l.WGS84).then((()=>(0,p.project)(r,l.WGS84)));return(await async function(){return(await t("fCutU")).geodesicBuffer}())(u.spatialReference,u,i,o)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;c=(0,o.getGeometryExtent)(c),c.spatialReference=t}e.geometry=c,await(0,p.checkProjectionSupport)(c.spatialReference,i);const h=(await(0,d.normalizeCentralMeridian)((0,u.fromJSON)(c)))[0];if((0,n.isNone)(h))throw g;const _=h.toJSON(),y=await(0,p.project)(_,_.spatialReference,i);if(!y)throw g;return y.spatialReference=i,e.geometry=y,e}function F(e){return e&&v in e?JSON.parse(JSON.stringify(e,C)):e}const v="_geVersion",C=(e,t)=>e!==v?t:void 0})),t.register("fCutU",(function(e,r){e.exports=Promise.all([import("./"+t("kyEFX").resolve("dtw1j")),import("./"+t("kyEFX").resolve("amzcH"))]).then((()=>t("d26pv")))})),t.register("UbUrW",(function(t,r){function i(e,t){if(!e)return null;const r=t.featureAdapter,{startTimeField:i,endTimeField:s}=e;let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(i&&s)t.forEach((e=>{const t=r.getAttribute(e,i),o=r.getAttribute(e,s);null==t||isNaN(t)||(n=Math.min(n,t)),null==o||isNaN(o)||(a=Math.max(a,o))}));else{const e=i||s;t.forEach((t=>{const i=r.getAttribute(t,e);null==i||isNaN(i)||(n=Math.min(n,i),a=Math.max(a,i))}))}return{start:n,end:a}}function s(e,t,r){if(!t||!e)return null;const{startTimeField:i,endTimeField:s}=e;if(!i&&!s)return null;const{start:n,end:a}=t;return null===n&&null===a?null:void 0===n&&void 0===a?()=>!1:i&&s?function(e,t,r,i,s){return null!=i&&null!=s?n=>{const a=e.getAttribute(n,t),o=e.getAttribute(n,r);return(null==a||a<=s)&&(null==o||o>=i)}:null!=i?t=>{const s=e.getAttribute(t,r);return null==s||s>=i}:null!=s?r=>{const i=e.getAttribute(r,t);return null==i||i<=s}:void 0}(r,i,s,n,a):function(e,t,r,i){return null!=r&&null!=i&&r===i?i=>e.getAttribute(i,t)===r:null!=r&&null!=i?s=>{const n=e.getAttribute(s,t);return n>=r&&n<=i}:null!=r?i=>e.getAttribute(i,t)>=r:null!=i?r=>e.getAttribute(r,t)<=i:void 0}(r,i||s,n,a)}e(t.exports,"getTimeExtent",(function(){return i})),e(t.exports,"getTimeOperator",(function(){return s}))})),t.register("8FlpL",(function(r,i){e(r.exports,"featureAdapter",(function(){return f})),e(r.exports,"FeatureStore2D",(function(){return g}));var s=t("cxEdX"),n=t("cS4u3");t("5HTPH");var a=t("1CpCt"),o=t("lD2ob"),u=t("ccOFp"),d=t("a6GbF"),l=t("cB7qm");function c(e,t){return e<<16|t}function h(e){return(4294901760&e)>>>16}function p(e){return 65535&e}const f={getObjectId:e=>e.getObjectId(),getAttributes:e=>e.readAttributes(),getAttribute:(e,t)=>e.readAttribute(t),cloneWithGeometry:(e,t)=>e,getGeometry:e=>e.readHydratedGeometry(),getCentroid:(e,t)=>e.readCentroid()};class g extends d.Store2D{get storeStatistics(){let e=0,t=0,r=0;return this.forEach((i=>{const s=i.readGeometry();s&&(t+=s.isPoint?1:s.lengths.reduce(((e,t)=>e+t),0),r+=s.isPoint?1:s.lengths.length,e+=1)})),{featureCount:e,vertexCount:t,ringCount:r}}hasInstance(e){return this._featureSetsByInstance.has(e)}onTileData(e,t){if((0,a.isNone)(t.addOrUpdate))return t;if(t.addOrUpdate.attachStorage(this._storage),"snapshot"===this.mode){const r=t.addOrUpdate.getCursor();for(;r.next();){const t=r.getDisplayId();this.setComputedAttributes(this._storage,r,t,e.scale)}return t}this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate);const r=t.addOrUpdate.getCursor();for(;r.next();)this._insertFeature(r,e.scale);return this._spatialIndexInvalid=!0,this.events.emit("changed"),t}search(e){this._rebuildIndex();const t=e.id,r=this._indexSearchCache.find((e=>e.tileId===t));if((0,a.isSome)(r))return r.readers;const i=new Map,s=this._searchIndex(e.bounds),n=[];for(const e of s){const t=this._storage.getInstanceId(e),r=h(t),s=p(t);i.has(r)||i.set(r,[]),i.get(r).push(s)}return i.forEach(((e,t)=>{const r=this._featureSetsByInstance.get(t);n.push(l.FeatureSetReaderIndirect.from(r,e))})),this._indexSearchCache.enqueue({tileId:t,readers:n}),n}insert(e){const t=e.getCursor(),r=this._storage;for(;t.next();){const e=c(t.instance,t.getIndex()),i=t.getObjectId(),s=this._objectIdToDisplayId.get(i)??this._storage.createDisplayId();t.setDisplayId(s),r.setInstanceId(s,e),this._objectIdToDisplayId.set(i,s)}this._featureSetsByInstance.set(e.instance,e),this._spatialIndexInvalid=!0}remove(e){const t=this._objectIdToDisplayId.get(e);if(!t)return;const r=this._storage.getInstanceId(t),i=p(r),s=h(r),n=this._featureSetsByInstance.get(s);this._objectIdToDisplayId.delete(e),this._storage.releaseDisplayId(t),n.removeAtIndex(i),n.isEmpty&&this._featureSetsByInstance.delete(s),this._spatialIndexInvalid=!0}toArray(){const e=new Array;return this.forEach((t=>e.push(t))),e}forEach(e){this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t),i=this._lookupFeature(r);e(i)}))}forEachUnsafe(e){this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t),i=h(r),s=p(r),n=this._getFeatureSet(i);n.setIndex(s),e(n)}))}forEachInBounds(e,t){const r=this._searchIndex(e);for(const e of r){const r=this.lookupFeatureByDisplayId(e,this._storage);t((0,a.unwrap)(r))}}forEachBounds(e,t,r){this._rebuildIndex();const i=[0,0,0,0];for(const s of e){if(!s.readGeometry())continue;const e=s.getDisplayId();i[0]=this._storage.getXMin(e),i[1]=this._storage.getYMin(e),i[2]=this._storage.getXMax(e),i[3]=this._storage.getYMax(e),t((0,u.fromRect)(r,i))}}sweepFeatures(e,t,r){this._spatialIndexInvalid=!0,this._objectIdToDisplayId.forEach(((i,s)=>{e.has(i)||(t.releaseDisplayId(i),r&&r.unsetAttributeData(i),this._objectIdToDisplayId.delete(s))})),this.events.emit("changed")}sweepFeatureSets(e){this._spatialIndexInvalid=!0,this._featureSetsByInstance.forEach(((t,r)=>{e.has(r)||this._featureSetsByInstance.delete(r)}))}lookupObjectId(e,t){const r=this.lookupFeatureByDisplayId(e,t);return(0,a.isNone)(r)?null:r.getObjectId()}lookupDisplayId(e){return this._objectIdToDisplayId.get(e)}lookupFeatureByDisplayId(e,t){const r=t.getInstanceId(e);return this._lookupFeature(r)}lookupByDisplayIdUnsafe(e){const t=this._storage.getInstanceId(e),r=h(t),i=p(t),s=this._getFeatureSet(r);return s?(s.setIndex(i),s):null}_insertFeature(e,t){const r=this._storage,i=e.getObjectId(),s=c(e.instance,e.getIndex());r.getInstanceId(e.getDisplayId());let n=this._objectIdToDisplayId.get(i);n||(n=r.createDisplayId(),this._objectIdToDisplayId.set(i,n),this._spatialIndexInvalid=!0),e.setDisplayId(n),r.setInstanceId(n,s),this.setComputedAttributes(r,e,n,t)}_searchIndex(e){this._rebuildIndex();const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}_rebuildIndex(){if(!this._spatialIndexInvalid)return;const e=[];"snapshot"===this.mode?this._featureSetsByInstance.forEach((t=>{const r=t.getCursor();for(;r.next();){const t=r.getDisplayId();this._storage.setBounds(t,r)&&e.push(t)}})):this._objectIdToDisplayId.forEach((t=>{const r=this._storage.getInstanceId(t);this._storage.setBounds(t,this._lookupFeature(r))&&e.push(t)})),this._index.clear(),this._index.load(e),this._indexSearchCache.clear(),this._spatialIndexInvalid=!1}_lookupFeature(e){const t=h(e),r=this._getFeatureSet(t);if(!r)return null;const i=r.getCursor(),s=p(e);return i.setIndex(s),i}_getFeatureSet(e){return this._featureSetsByInstance.get(e)}constructor(e,t,r){super(e,t),this.featureAdapter=f,this.events=new(0,n.default),this._featureSetsByInstance=new Map,this._objectIdToDisplayId=new Map,this._spatialIndexInvalid=!0,this._indexSearchCache=new(0,s.default)(50),this._index=(0,o.r)(9,(e=>({minX:this._storage.getXMin(e),minY:this._storage.getYMin(e),maxX:this._storage.getXMax(e),maxY:this._storage.getYMax(e)}))),this.mode=r}}})),t.register("cxEdX",(function(r,i){e(r.exports,"default",(function(){return n}));var s=t("1CpCt");class n{get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}dequeue(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}peek(){return 0===this.size?null:this._buffer[this._start]}find(e){if(0===this.size)return null;for(const t of this._buffer)if((0,s.isSome)(t)&&e(t))return t;return null}clear(e){let t=this.dequeue();for(;(0,s.isSome)(t);)e&&e(t),t=this.dequeue()}constructor(e){this.size=0,this._start=0,this.maxSize=e,this._buffer=new Array(e)}}})),t.register("a6GbF",(function(r,i){e(r.exports,"Store2D",(function(){return l}));var s=t("5HTPH"),n=t("1CpCt"),a=t("lDoe3"),o=t("QiKdE"),u=t("9kHBQ");const d=t("5EaRj");class l{get storage(){return this._storage}invalidate(){this._bitsets.computed.clear()}async updateSchema(e,t){const r=(0,a.diff)(this._schema,t);if(this._schema=t,!t||(0,n.isNone)(r)||!(0,a.hasDiff)(r,"attributes"))return;(0,s.default)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",r),this._bitsets.computed.clear(),e.targets[t.name]=!0;const i=t.attributes,o=[],u=[];for(const e in i){const t=i[e];switch(t.type){case"field":break;case"expression":o.push(this._createArcadeComputedField(t));break;case"label-expression":o.push(this._createLabelArcadeComputedField(t));break;case"statistic":u.push(t)}}this._computedFields=await Promise.all(o),this._canCacheExpressionValue=!this._computedFields.some((e=>"expression"===e.type&&e.expression.referencesScale())),this._statisticFields=u}setComputedAttributes(e,t,r,i){const s=this._bitsets.computed;if(!this._canCacheExpressionValue||!s.has(r)){s.set(r);for(const s of this._computedFields){const n=this._evaluateField(t,s,i);switch(s.resultType){case"numeric":e.setComputedNumericAtIndex(r,s.fieldIndex,n);break;case"string":e.setComputedStringAtIndex(r,s.fieldIndex,n)}}}}async _createArcadeComputedField(e){const t=this._sourceInfo.spatialReference,r=this._sourceInfo.fieldsIndex;return{...e,expression:await(0,o.createRendererExpression)(e.valueExpression,t,r)}}async _createLabelArcadeComputedField(e){const t=this._sourceInfo.spatialReference,r=this._sourceInfo.fieldsIndex,{createLabelFunction:i}=await d,s=await i(e.label,r,t);return{...e,builder:s}}_evaluateField(e,t,r){switch(t.type){case"label-expression":{const r=e.readArcadeFeature();return t.builder.evaluate(r)||""}case"expression":{const{expression:i}=t;return(0,u.default)(i,e,{$view:{scale:r}})}}}constructor(e,t){this._canCacheExpressionValue=!1,this._sourceInfo=e,this._storage=t,this._bitsets={computed:t.getBitset(t.createBitset())}}}})),t.register("9kHBQ",(function(r,i){e(r.exports,"default",(function(){return n}));var s=t("6TszD");function n(e,t,r){e.referencesGeometry();const i=t.readArcadeFeature();try{return e.evaluate({...r,$feature:i})}catch(e){return s.default.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}})),t.register("5EaRj",(function(e,r){e.exports=import("./"+t("kyEFX").resolve("bWt6I")).then((()=>t("9koH3")))})),t.register("cB7qm",(function(r,i){e(r.exports,"FeatureSetReaderIndirect",(function(){return n}));var s=t("dbCZi");class n extends s.FeatureSetReader{static from(e,t){return new n(e.copy(),t)}get hasNext(){return this._currentIndex+1<this._indices.length}getSize(){return this._indices.length}getCursor(){return this.copy()}copy(){const e=new n(this._reader.copy(),this._indices);return e._currentIndex=this._currentIndex,e}next(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}_nextIndex(){return++this._currentIndex<this._indices.length&&(this._reader.setIndex(this._indices[this._currentIndex]),!0)}setArcadeSpatialReference(e){this._reader.setArcadeSpatialReference(e)}attachStorage(e){this._reader.attachStorage(e)}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}getStorage(){return this._reader.getStorage()}getComputedNumeric(e){return this._reader.getComputedNumericAtIndex(0)}setComputedNumeric(e,t){return this._reader.setComputedNumericAtIndex(t,0)}getComputedString(e){return this._reader.getComputedStringAtIndex(0)}setComputedString(e,t){return this._reader.setComputedStringAtIndex(0,t)}getComputedNumericAtIndex(e){return this._reader.getComputedNumericAtIndex(e)}setComputedNumericAtIndex(e,t){this._reader.setComputedNumericAtIndex(e,t)}getComputedStringAtIndex(e){return this._reader.getComputedStringAtIndex(e)}setComputedStringAtIndex(e,t){return this._reader.setComputedStringAtIndex(e,t)}transform(e,t,r,i){const s=this.copy();return s._reader=this._reader.transform(e,t,r,i),s}readAttribute(e,t=!1){return this._reader.readAttribute(e,t)}readAttributes(){return this._reader.readAttributes()}joinAttributes(e){return this._reader.joinAttributes(e)}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(e){return this.readAttribute(e,!0)}hasField(e){return this._reader.hasField(e)}setField(e,t){return this._reader.setField(e,t)}keys(){return this._reader.keys()}castToText(){return this._reader.castToText()}getQuantizationTransform(){return this._reader.getQuantizationTransform()}getFieldNames(){return this._reader.getFieldNames()}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(e){return this._reader.setDisplayId(e)}getGroupId(){return this._reader.getGroupId()}setGroupId(e){return this._reader.setGroupId(e)}getXHydrated(){return this._reader.getXHydrated()}getYHydrated(){return this._reader.getYHydrated()}getX(){return this._reader.getX()}getY(){return this._reader.getY()}setIndex(e){return this._reader.setIndex(e)}getIndex(){return this._reader.getIndex()}readLegacyFeature(){return this._reader.readLegacyFeature()}readOptimizedFeature(){return this._reader.readOptimizedFeature()}readLegacyPointGeometry(){return this._reader.readLegacyPointGeometry()}readLegacyGeometry(){return this._reader.readLegacyGeometry()}readLegacyCentroid(){return this._reader.readLegacyCentroid()}readGeometryArea(){return this._reader.readGeometryArea()}readUnquantizedGeometry(){return this._reader.readUnquantizedGeometry()}readHydratedGeometry(){return this._reader.readHydratedGeometry()}readGeometry(){return this._reader.readGeometry()}readCentroid(){return this._reader.readCentroid()}_readAttribute(e,t){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}_readAttributes(){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}constructor(e,t){super(s.FeatureSetReader.createInstance(),e.fullSchema()),this._currentIndex=-1,this._reader=e,this._indices=t}}})),t.register("fJsQB",(function(r,i){e(r.exports,"createWhereClause",(function(){return o}));var s=t("bPmsI");const n=t("6TszD").default.getLogger("esri.views.2d.layers.features.support.whereUtils"),a={getAttribute:(e,t)=>e.field(t)};async function o(e,r){const i=await t("h8EXn");try{const t=i.WhereClause.create(e,r);if(!t.isStandardized){const e=new(0,s.default)("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",t);n.error(e)}return e=>{const r=e.readArcadeFeature();return t.testFeature(r,a)}}catch(t){return n.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",e),e=>!0}}})),t.register("h8EXn",(function(e,r){e.exports=import("./"+t("kyEFX").resolve("k1oiq")).then((()=>t("jKVXg")))}));
//# sourceMappingURL=FeatureFilter.081be076.js.map
