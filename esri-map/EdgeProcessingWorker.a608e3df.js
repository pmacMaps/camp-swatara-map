!function(){function t(t,e,n,r){Object.defineProperty(t,e,{get:n,set:r,enumerable:!0,configurable:!0})}var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;e.register("k8a7B",(function(n,r){t(n.exports,"EdgeInputBufferLayout",(function(){return c})),t(n.exports,"RegularEdgeInstancesLayout",(function(){return l})),t(n.exports,"SilhouetteEdgeInstancesLayout",(function(){return f}));var o=e("3h6Nu"),i=e("8Z9U2"),s=e("7S12W");const c=(0,i.newLayout)().vec3f(s.VertexAttribute.POSITION).u16(s.VertexAttribute.COMPONENTINDEX).u16(s.VertexAttribute.U16PADDING),a=(0,i.newLayout)().vec2u8(s.VertexAttribute.SIDENESS),u=((0,o.glLayout)(a),(0,i.newLayout)().vec3f(s.VertexAttribute.POSITION0).vec3f(s.VertexAttribute.POSITION1).u16(s.VertexAttribute.COMPONENTINDEX).u8(s.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(s.VertexAttribute.VARIANTSTROKE).u8(s.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0}).u8(s.VertexAttribute.U8PADDING,{glPadding:!0}).u16(s.VertexAttribute.U16PADDING,{glPadding:!0})),l=u.clone().vec3f(s.VertexAttribute.NORMAL),f=u.clone().vec3f(s.VertexAttribute.NORMALA).vec3f(s.VertexAttribute.NORMALB);new Map([[s.VertexAttribute.POSITION0,0],[s.VertexAttribute.POSITION1,1],[s.VertexAttribute.COMPONENTINDEX,2],[s.VertexAttribute.VARIANTOFFSET,3],[s.VertexAttribute.VARIANTSTROKE,4],[s.VertexAttribute.VARIANTEXTENSION,5],[s.VertexAttribute.NORMAL,6],[s.VertexAttribute.NORMALA,6],[s.VertexAttribute.NORMALB,7],[s.VertexAttribute.SIDENESS,8]])})),e.register("3h6Nu",(function(n,r){t(n.exports,"glLayout",(function(){return s}));var o=e("8JzMA"),i=e("LW1Aq");function s(t,e=0){const n=t.stride;return Array.from(t.fields.keys()).filter((e=>{var n;const r=null===(n=t.fields.get(e))||void 0===n?void 0:n.optional;return!(r&&r.glPadding)})).map((r=>{const o=t.fields.get(r),s=o.constructor.ElementCount,a=function(t){const e=c[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}(o.constructor.ElementType),u=o.offset,l=!(!o.optional||!o.optional.glNormalized);return new(0,i.VertexElementDescriptor)(r,s,a,u,n,l,e)}))}const c={u8:o.DataType.UNSIGNED_BYTE,u16:o.DataType.UNSIGNED_SHORT,u32:o.DataType.UNSIGNED_INT,i8:o.DataType.BYTE,i16:o.DataType.SHORT,i32:o.DataType.INT,f32:o.DataType.FLOAT}})),e.register("6lzcr",(function(n,r){t(n.exports,"extractEdges",(function(){return f}));var o=e("lNwWH"),i=e("iVfa0"),s=e("e4Xv2"),c=e("5YMIf");const a=-1;var u,l;function f(t,e,n,r=N){const c=t.vertices.position,u=t.vertices.componentIndex,l=(0,i.deg2rad)(r.anglePlanar),f=(0,i.deg2rad)(r.angleSignificantEdge),I=Math.cos(f),h=Math.cos(l),x=p.edge,m=x.position0,E=x.position1,y=x.faceNormal0,V=x.faceNormal1,b=function(t){const e=t.faces.length/3,n=t.vertices.position,r=t.faces,o=A.v0,i=A.v1,c=A.v2,a=new Float32Array(3*e);for(let t=0;t<e;t++){const e=r[3*t],u=r[3*t+1],l=r[3*t+2];n.getVec(e,o),n.getVec(u,i),n.getVec(l,c),(0,s.b)(i,i,o),(0,s.b)(c,c,o),(0,s.f)(o,i,c),(0,s.n)(o,o),a[3*t]=o[0],a[3*t+1]=o[1],a[3*t+2]=o[2]}return a}(t),S=function(t){const e=t.faces.length/3,n=t.faces,r=t.neighbors;let o=0;for(let t=0;t<e;t++){const e=r[3*t],i=r[3*t+1],s=r[3*t+2],c=n[3*t],u=n[3*t+1],l=n[3*t+2];o+=e===a||c<u?1:0,o+=i===a||u<l?1:0,o+=s===a||l<c?1:0}const i=new Int32Array(4*o);let s=0;for(let t=0;t<e;t++){const e=r[3*t],o=r[3*t+1],c=r[3*t+2],u=n[3*t],l=n[3*t+1],f=n[3*t+2];(e===a||u<l)&&(i[s++]=u,i[s++]=l,i[s++]=t,i[s++]=e),(o===a||l<f)&&(i[s++]=l,i[s++]=f,i[s++]=t,i[s++]=o),(c===a||f<u)&&(i[s++]=f,i[s++]=u,i[s++]=t,i[s++]=c)}return i}(t),w=S.length/4,O=e.allocate(w);let L=0;const T=w,v=n.allocate(T);let D=0,R=0,P=0;const M=(0,o.range)(0,w),B=new Float32Array(w);B.forEach(((t,e,n)=>{c.getVec(S[4*e],m),c.getVec(S[4*e+1],E),n[e]=(0,s.i)(m,E)})),M.sort(((t,e)=>B[e]-B[t]));const W=new Array,U=new Array;for(let t=0;t<w;t++){const r=M[t],o=B[r],i=S[4*r],f=S[4*r+1],p=S[4*r+2],A=S[4*r+3],N=A===a;if(c.getVec(i,m),c.getVec(f,E),N)(0,s.s)(y,b[3*p],b[3*p+1],b[3*p+2]),(0,s.c)(V,y),x.componentIndex=u.get(i),x.cosAngle=(0,s.e)(y,V);else{if((0,s.s)(y,b[3*p],b[3*p+1],b[3*p+2]),(0,s.s)(V,b[3*A],b[3*A+1],b[3*A+2]),x.componentIndex=u.get(i),x.cosAngle=(0,s.e)(y,V),F=h,x.cosAngle>F)continue;x.cosAngle<-.9999&&(0,s.c)(V,y)}R+=o,P++,N||g(x,I)?(e.write(O,L++,x),W.push(o)):d(x,l)&&(n.write(v,D++,x),U.push(o))}var F;const _=new Float32Array(W.reverse()),C=new Float32Array(U.reverse());return{regular:{instancesData:e.trim(O,L),lodInfo:{lengths:_}},silhouette:{instancesData:n.trim(v,D),lodInfo:{lengths:C}},averageEdgeLength:R/P}}function g(t,e){return t.cosAngle<e}function d(t,e){const n=(0,i.acosClamped)(t.cosAngle),r=p.fwd,o=p.ortho;return(0,s.r)(r,t.position1,t.position0),n*((0,s.e)((0,s.f)(o,t.faceNormal0,t.faceNormal1),r)>0?-1:1)>e}(l=u||(u={}))[l.SOLID=0]="SOLID",l[l.SKETCH=1]="SKETCH";const p={edge:{position0:(0,c.c)(),position1:(0,c.c)(),faceNormal0:(0,c.c)(),faceNormal1:(0,c.c)(),componentIndex:0,cosAngle:0},ortho:(0,c.c)(),fwd:(0,c.c)()},A={v0:(0,c.c)(),v1:(0,c.c)(),v2:(0,c.c)()},N={anglePlanar:4,angleSignificantEdge:35}})),e.register("prRAE",(function(n,r){t(n.exports,"extract",(function(){return f})),t(n.exports,"extractEdgeInformation",(function(){return g})),t(n.exports,"extractEdgeLocationsLayout",(function(){return N})),t(n.exports,"extractComponentsEdgeLocationsLayout",(function(){return I}));var o=e("gPnQi"),i=e("c8rlx"),s=e("8Z9U2"),c=e("7S12W"),a=e("k8a7B"),u=e("1VRLl"),l=e("6lzcr");function f(t){const e=g(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return p.updateSettings(t.writerSettings),A.updateSettings(t.writerSettings),(0,l.extractEdges)(e,p,A)}function g(t,e,n,r){if(e){const e=(0,i.computeNeighbors)(n,r,t.count);return new d(n,r,e,t)}const s=(0,o.deduplicate)(t.buffer,t.stride/4,{originalIndices:n,originalIndicesLength:r}),c=(0,i.computeNeighbors)(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:c,vertices:a.EdgeInputBufferLayout.createView(s.buffer)}}class d{constructor(t,e,n,r){this.faces=t,this.facesLength=e,this.neighbors=n,this.vertices=r}}const p=new(0,u.RegularEdgeBufferWriter),A=new(0,u.SilhouetteEdgeBufferWriter),N=(0,s.newLayout)().vec3f(c.VertexAttribute.POSITION0).vec3f(c.VertexAttribute.POSITION1),I=(0,s.newLayout)().vec3f(c.VertexAttribute.POSITION0).vec3f(c.VertexAttribute.POSITION1).u16(c.VertexAttribute.COMPONENTINDEX).u16(c.VertexAttribute.U16PADDING,{glPadding:!0})})),e.register("c8rlx",(function(e,n){function r(t,e,n){const r=e/3,o=new Uint32Array(n+1),i=new Uint32Array(n+1),s=(t,e)=>{t<e?o[t+1]++:i[e+1]++};for(let e=0;e<r;e++){const n=t[3*e],r=t[3*e+1],o=t[3*e+2];s(n,r),s(r,o),s(o,n)}let c=0,a=0;for(let t=0;t<n;t++){const e=o[t+1],n=i[t+1];o[t+1]=c,i[t+1]=a,c+=e,a+=n}const u=new Uint32Array(6*r),l=o[n],f=(t,e,n)=>{if(t<e){const r=o[t+1]++;u[2*r]=e,u[2*r+1]=n}else{const r=i[e+1]++;u[2*l+2*r]=t,u[2*l+2*r+1]=n}};for(let e=0;e<r;e++){const n=t[3*e],r=t[3*e+1],o=t[3*e+2];f(n,r,e),f(r,o,e),f(o,n,e)}const g=(t,e)=>{const n=2*t,r=e-t;for(let t=1;t<r;t++){const e=u[n+2*t],r=u[n+2*t+1];let o=t-1;for(;o>=0&&u[n+2*o]>e;o--)u[n+2*o+2]=u[n+2*o],u[n+2*o+3]=u[n+2*o+1];u[n+2*o+2]=e,u[n+2*o+3]=r}};for(let t=0;t<n;t++)g(o[t],o[t+1]),g(l+i[t],l+i[t+1]);const d=new Int32Array(3*r),p=(e,n)=>e===t[3*n]?0:e===t[3*n+1]?1:e===t[3*n+2]?2:-1,A=(t,e)=>{const n=p(t,e);d[3*e+n]=-1},N=(t,e,n,r)=>{const o=p(t,e);d[3*e+o]=r;const i=p(n,r);d[3*r+i]=e};for(let t=0;t<n;t++){let e=o[t];const n=o[t+1];let r=i[t];const s=i[t+1];for(;e<n&&r<s;){const n=u[2*e],o=u[2*l+2*r];n===o?(N(t,u[2*e+1],o,u[2*l+2*r+1]),e++,r++):n<o?(A(t,u[2*e+1]),e++):(A(o,u[2*l+2*r+1]),r++)}for(;e<n;)A(t,u[2*e+1]),e++;for(;r<s;)A(u[2*l+2*r],u[2*l+2*r+1]),r++}return d}t(e.exports,"computeNeighbors",(function(){return r}))})),e.register("1VRLl",(function(n,r){t(n.exports,"RegularEdgeBufferWriter",(function(){return N})),t(n.exports,"SilhouetteEdgeBufferWriter",(function(){return I}));var o=e("hvORu"),i=e("e4Xv2"),s=e("5YMIf"),c=e("3h6Nu"),a=e("k8a7B");class u{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?p:d}write(t,e,n){const r=this._edgeHashFunction(n);x.seed=r;const o=x.getIntRange(0,255),i=x.getIntRange(0,this.settings.variants-1),s=x.getFloat(),c=255*(.5*function(t,e){const n=t<0?-1:1;return Math.abs(t)**e*n}(-(1-Math.min(s/.7,1))+Math.max(0,s-.7)/(1-.7),1.2)+.5);t.position0.setVec(e,n.position0),t.position1.setVec(e,n.position1),t.componentIndex.set(e,n.componentIndex),t.variantOffset.set(e,o),t.variantStroke.set(e,i),t.variantExtension.set(e,c)}trim(t,e){return t.slice(0,e)}}const l=new Float32Array(6),f=new Uint32Array(l.buffer),g=new Uint32Array(1);function d(t){const e=l;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],g[0]=5381;for(let t=0;t<f.length;t++)g[0]=31*g[0]+f[t];return g[0]}function p(t){const e=l;e[0]=A(t.position0[0]),e[1]=A(t.position0[1]),e[2]=A(t.position0[2]),e[3]=A(t.position1[0]),e[4]=A(t.position1[1]),e[5]=A(t.position1[2]),g[0]=5381;for(let t=0;t<f.length;t++)g[0]=31*g[0]+f[t];return g[0]}function A(t){return Math.round(1e4*t)/1e4}class N{updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return a.RegularEdgeInstancesLayout.createBuffer(t)}write(t,e,n){this._commonWriter.write(t,e,n),(0,i.a)(h,n.faceNormal0,n.faceNormal1),(0,i.n)(h,h),t.normal.setVec(e,h)}trim(t,e){return this._commonWriter.trim(t,e)}constructor(){this._commonWriter=new u}}N.Layout=a.RegularEdgeInstancesLayout,N.glLayout=(0,c.glLayout)(a.RegularEdgeInstancesLayout,1);class I{updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return a.SilhouetteEdgeInstancesLayout.createBuffer(t)}write(t,e,n){this._commonWriter.write(t,e,n),t.normalA.setVec(e,n.faceNormal0),t.normalB.setVec(e,n.faceNormal1)}trim(t,e){return this._commonWriter.trim(t,e)}constructor(){this._commonWriter=new u}}I.Layout=a.SilhouetteEdgeInstancesLayout,I.glLayout=(0,c.glLayout)(a.SilhouetteEdgeInstancesLayout,1);const h=(0,s.c)(),x=new(0,o.default)}))}();
//# sourceMappingURL=EdgeProcessingWorker.a608e3df.js.map
