function e(e,r,t,o){Object.defineProperty(e,r,{get:t,set:o,enumerable:!0,configurable:!0})}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("gfFNw",(function(t,o){e(t.exports,"functionHelper",(function(){return X})),e(t.exports,"extend",(function(){return Y})),e(t.exports,"executeScript",(function(){return J}));var n=r("lpILz"),a=r("8DKat"),i=r("lz1nc"),c=r("li6NP"),l=r("2mxq8"),u=r("8MibT"),s=r("hyHkL"),d=r("fXK0z"),f=r("gDYGn"),E=r("effkN"),w=r("jB7L7"),p=r("fVx77"),x=r("aIasu"),h=r("7lxsX"),g=r("4jvWz"),v=r("eqMhf"),m=r("jaaCV");function y(e){return e&&"function"==typeof e.then}const C=100;async function b(e,r){const t=[];for(let o=0;o<r.arguments.length;o++)t.push(await I(e,r.arguments[o]));return t}async function A(e,r,t){return!0===r.preparsed?t(e,null,r.arguments):t(e,r,await b(e,r))}class S extends u.ArcadeFunction{createFunction(e){return(...r)=>{const t={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeReference:this.context.timeReference??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:e.depthCounter+1},globalScope:this.context.globalScope};if(t.depthCounter.depth>64)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.MaximumCallDepth,null);return V(this.definition,t,r,null)}}call(e,r){return F(e,r,((t,o,n)=>{const a={spatialReference:e.spatialReference,services:e.services,console:e.console,libraryResolver:e.libraryResolver,exports:e.exports,lrucache:e.lrucache,timeReference:e.timeReference??null,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1}};if(a.depthCounter.depth>64)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.MaximumCallDepth,r);return V(this.definition,a,n,r)}))}marshalledCall(e,r,t,o){return o(e,r,(async(n,a,i)=>{const c={spatialReference:e.spatialReference,globalScope:t.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,abortSignal:e.abortSignal,lrucache:e.lrucache,timeReference:e.timeReference??null,interceptor:e.interceptor,localScope:{}};return i=i.map((r=>!(0,s.i)(r)||r instanceof u.ScopeMarshalledFunction?r:(0,u.wrapModuleScopedResponse)(r,e,o))),(0,u.wrapModuleScopedResponse)(await V(this.definition,c,i,r),t,o)}))}constructor(e,r){super(),this.definition=null,this.context=null,this.definition=e,this.context=r}}class R extends n.ArcadeModule{async global(e){const r=this.executingContext.globalScope[e.toLowerCase()];if(r.valueset||(r.value=await I(this.executingContext,r.node),r.valueset=!0),(0,s.i)(r.value)&&!(r.value instanceof u.ScopeMarshalledFunction)){const e=new(0,u.ScopeMarshalledFunction);e.fn=r.value,e.parameterEvaluator=F,e.context=this.executingContext,r.value=e}return r.value}setGlobal(e,r){if((0,s.i)(r))throw new(0,c.ArcadeExecutionError)(null,c.ExecutionErrorCodes.AssignModuleFunction,null);this.executingContext.globalScope[e.toLowerCase()]={value:r,valueset:!0,node:null}}hasGlobal(e){return void 0===this.executingContext.exports[e]&&(e=e.toLowerCase()),void 0!==this.executingContext.exports[e]}async loadModule(e){let r=e.spatialReference;null==r&&(r=new(0,m.default)({wkid:102100})),this.moduleScope=z({},e.customfunctions,e.timeReference),this.executingContext={spatialReference:r,services:e.services,libraryResolver:new(0,a.ArcadeModuleLoader)(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:void 0===e.abortSignal||null===e.abortSignal?{aborted:!1}:e.abortSignal,globalScope:this.moduleScope,console:e.console??H,lrucache:e.lrucache,timeReference:e.timeReference??null,interceptor:e.interceptor,localScope:null,depthCounter:{depth:1}},await I(this.executingContext,this.source.syntax)}constructor(e){super(e)}}async function F(e,r,t){if(!0===r.preparsed){const o=t(e,null,r.arguments);return y(o),o}const o=t(e,r,await b(e,r));return y(o),o}async function I(e,r,t){if(r.breakpoint&&!0!==t){const t=r.breakpoint();return await t,I(e,r,!0)}try{switch(r?.type){case"VariableDeclarator":return await async function(e,r){let t=null;if(t=null===r.init?null:await I(e,r.init),null!==e.localScope){if(t===s.v&&(t=null),"Identifier"!==r.id.type)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidIdentifier,r);const o=r.id.name.toLowerCase();return null!=e.localScope&&(e.localScope[o]={value:t,valueset:!0,node:r.init}),s.v}if("Identifier"!==r.id.type)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidIdentifier,r);const o=r.id.name.toLowerCase();return t===s.v&&(t=null),e.globalScope[o]={value:t,valueset:!0,node:r.init},s.v}(e,r);case"ImportDeclaration":return await async function(e,r){const t=r.specifiers[0].local.name.toLowerCase(),o=e.libraryResolver.loadLibrary(t);let n=null;return e.libraryResolver._moduleSingletons?.has(o.uri)?n=e.libraryResolver._moduleSingletons.get(o.uri):(n=new R(o),await n.loadModule(e),e.libraryResolver._moduleSingletons?.set(o.uri,n)),e.globalScope[t]={value:n,valueset:!0,node:r},s.v}(e,r);case"ExportNamedDeclaration":return await async function(e,r){if(await I(e,r.declaration),"FunctionDeclaration"===r.declaration.type)e.exports[r.declaration.id.name.toLowerCase()]="function";else if("VariableDeclaration"===r.declaration.type)for(const t of r.declaration.declarations)e.exports[t.id.name.toLowerCase()]="variable";return s.v}(e,r);case"VariableDeclaration":return await K(e,r,0);case"BlockStatement":case"Program":return await async function(e,r){return P(e,r,0)}(e,r);case"FunctionDeclaration":return await async function(e,r){const t=r.id.name.toLowerCase();return e.globalScope[t]={valueset:!0,node:null,value:new S(r,e)},s.v}(e,r);case"ReturnStatement":return await async function(e,r){if(null===r.argument)return new(0,s.R)(s.v);const t=await I(e,r.argument);return new(0,s.R)(t)}(e,r);case"IfStatement":return await async function(e,r){const t=await I(e,r.test);if(!0===t)return I(e,r.consequent);if(!1===t)return null!==r.alternate?I(e,r.alternate):s.v;throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.BooleanConditionRequired,r)}(e,r);case"ExpressionStatement":return await async function(e,r){if("AssignmentExpression"===r.expression.type)return I(e,r.expression);if("CallExpression"===r.expression.type){const t=await I(e,r.expression);return t===s.v?s.v:new(0,s.I)(t)}const t=await I(e,r.expression);return t===s.v?s.v:new(0,s.I)(t)}(e,r);case"UpdateExpression":return await async function(e,r){const t=r.argument;if("MemberExpression"===t.type){const o={t:null},n=await I(e,t.object);let a=null;o.t=n,!0===t.computed?a=await I(e,t.property):"Identifier"===t.property.type&&(a=t.property.name);const l=o.t;let u;if((0,s.m)(l)){if(!(0,s.b)(a))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.ArrayAccessorMustBeNumber,r);if(a<0&&(a=l.length+a),a<0||a>=l.length)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.OutOfBounds,r);u=(0,s.g)(l[a]),l[a]="++"===r.operator?u+1:u-1}else if(l instanceof i.default){if(!1===(0,s.c)(a))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0!==l.hasField(a))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.FieldNotFound,r,{key:a});u=(0,s.g)(l.field(a)),l.setField(a,"++"===r.operator?u+1:u-1)}else if(l instanceof R){if(!1===(0,s.c)(a))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.ModuleAccessorMustBeString,r);if(!0!==l.hasGlobal(a))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.ModuleExportNotFound,r);u=(0,s.g)(await l.global(a)),l.setGlobal(a,"++"===r.operator?u+1:u-1)}else{if(!(0,s.p)(l))throw(0,s.o)(l)?new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.Immutable,r):new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidParameter,r);if(!1===(0,s.c)(a))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0!==l.hasField(a))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.FieldNotFound,r,{key:a});u=(0,s.g)(l.field(a)),l.setField(a,"++"===r.operator?u+1:u-1)}return!1===r.prefix?u:"++"===r.operator?u+1:u-1}const o="Identifier"===r.argument.type?r.argument.name.toLowerCase():"";if(!o)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidIdentifier,r);let n;if(null!=e.localScope&&void 0!==e.localScope[o])return n=(0,s.g)(e.localScope[o].value),e.localScope[o]={value:"++"===r.operator?n+1:n-1,valueset:!0,node:r},!1===r.prefix?n:"++"===r.operator?n+1:n-1;if(void 0!==e.globalScope[o])return n=(0,s.g)(e.globalScope[o].value),e.globalScope[o]={value:"++"===r.operator?n+1:n-1,valueset:!0,node:r},!1===r.prefix?n:"++"===r.operator?n+1:n-1;throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidIdentifier,r)}(e,r);case"AssignmentExpression":return await async function(e,r){const t=r.left;if("MemberExpression"===t.type){const o=await I(e,t.object);let n=null;if(!0===t.computed)n=await I(e,t.property);else{if("Identifier"!==t.property.type)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidIdentifier,r);n=t.property.name}const a=await I(e,r.right);if((0,s.m)(o)){if(!(0,s.b)(n))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.ArrayAccessorMustBeNumber,r);if(n<0&&(n=o.length+n),n<0||n>o.length)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.OutOfBounds,r);if(n===o.length){if("="!==r.operator)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.OutOfBounds,r);o[n]=j(a,r.operator,o[n],r,e)}else o[n]=j(a,r.operator,o[n],r,e)}else if(o instanceof i.default){if(!1===(0,s.c)(n))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0===o.hasField(n))o.setField(n,j(a,r.operator,o.field(n),r,e));else{if("="!==r.operator)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.FieldNotFound,r,{key:n});o.setField(n,j(a,r.operator,null,r,e))}}else if(o instanceof R){if(!1===(0,s.c)(n))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0!==o.hasGlobal(n))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.ModuleExportNotFound,r);o.setGlobal(n,j(a,r.operator,await o.global(n),r,e))}else{if(!(0,s.p)(o))throw(0,s.o)(o)?new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.Immutable,r):new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidParameter,r);if(!1===(0,s.c)(n))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.KeyAccessorMustBeString,r);if(!0===o.hasField(n))o.setField(n,j(a,r.operator,o.field(n),r,e));else{if("="!==r.operator)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.FieldNotFound,r,{key:n});o.setField(n,j(a,r.operator,null,r,e))}}return s.v}const o=t.name.toLowerCase();if(null!=e.localScope&&void 0!==e.localScope[o]){const t=await I(e,r.right);return e.localScope[o]={value:j(t,r.operator,e.localScope[o].value,r,e),valueset:!0,node:r.right},s.v}if(void 0!==e.globalScope[o]){const t=await I(e,r.right);return e.globalScope[o]={value:j(t,r.operator,e.globalScope[o].value,r,e),valueset:!0,node:r.right},s.v}throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidIdentifier,r)}(e,r);case"ForStatement":return await function(e,r){try{return null!==r.init?I(e,r.init).then((()=>new Promise(((t,o)=>{N(e,r,{testResult:!0,lastAction:s.v},(e=>{t(e)}),(e=>{o(e)}),0)})))):new Promise(((t,o)=>{N(e,r,{testResult:!0,lastAction:s.v},(e=>{t(e)}),(e=>{o(e)}),0)}))}catch(e){return Promise.reject(e)}}(e,r);case"WhileStatement":return await async function(e,r){const t={testResult:!0,lastAction:s.v};if(t.testResult=await I(e,r.test),!1===t.testResult)return s.v;if(!0!==t.testResult)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.BooleanConditionRequired,r);for(;!0===t.testResult&&(t.lastAction=await I(e,r.body),t.lastAction!==s.w)&&!(t.lastAction instanceof s.R);)if(t.testResult=await I(e,r.test),!0!==t.testResult&&!1!==t.testResult)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.BooleanConditionRequired,r);return t.lastAction instanceof s.R?t.lastAction:s.v}(e,r);case"ForInStatement":return await async function(e,r){return new Promise(((t,o)=>{I(e,r.right).then((n=>{try{let a=null;a="VariableDeclaration"===r.left.type?I(e,r.left):Promise.resolve(),a.then((()=>{try{let a="";if("VariableDeclaration"===r.left.type){const e=r.left.declarations[0].id;"Identifier"===e.type&&(a=e.name)}else"Identifier"===r.left.type&&(a=r.left.name);if(!a)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidIdentifier,r);a=a.toLowerCase();let l=null;if(null!=e.localScope&&void 0!==e.localScope[a]&&(l=e.localScope[a]),null===l&&void 0!==e.globalScope[a]&&(l=e.globalScope[a]),null===l)return void o(new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidIdentifier,r));(0,s.m)(n)||(0,s.c)(n)?k(e,r,n,{reject:o,resolve:t},l):(0,s.o)(n)?function(e,r,t,o,n,a){try{if(void 0===a&&(a="i"),0===t.length)return void o.resolve(s.v);O(e,r,t,n,0,a,(e=>{o.resolve(e)}),(e=>{o.reject(e)}),0)}catch(e){o.reject(e)}}(e,r,n,{reject:o,resolve:t},l):n instanceof i.default||(0,s.p)(n)?function(e,r,t,o,n){try{k(e,r,t.keys(),o,n,"k")}catch(e){o.reject(e)}}(e,r,n,{reject:o,resolve:t},l):(0,s.r)(n)?B(n.iterator(e.abortSignal),e,r,n,l,(e=>{t(e)}),(e=>{o(e)}),0):k(e,r,[],{reject:o,resolve:t},l)}catch(e){o(e)}}),o)}catch(e){o(e)}}),o)}))}(e,r);case"BreakStatement":return s.w;case"EmptyStatement":return s.v;case"ContinueStatement":return s.x;case"TemplateElement":return await async function(e,r){return r.value?r.value.cooked:""}(0,r);case"TemplateLiteral":return await async function(e,r){const t=[];for(let o=0;o<r.expressions.length;o++){const n=await I(e,r.expressions[o]);t[o]=(0,s.j)(n)}let o="",n=0;for(const a of r.quasis)o+=a.value?a.value.cooked:"",!1===a.tail&&(o+=t[n]?T(t[n],e,r):"",n++);return o}(e,r);case"Identifier":return await D(e,r);case"MemberExpression":return await async function(e,r){const t=await I(e,r.object);if(null===t)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.MemberOfNull,r);if(!1===r.computed){if("Identifier"===r.property.type){if(t instanceof i.default||(0,s.p)(t))return t.field(r.property.name);if(t instanceof v.default)return(0,p.geometryMember)(t,r.property.name,e,r);if(t instanceof R){if(!t.hasGlobal(r.property.name))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidIdentifier,r);return t.global(r.property.name)}throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidMemberAccessKey,r)}throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidMemberAccessKey,r)}let o=await I(e,r.property);if(t instanceof i.default||(0,s.p)(t)){if((0,s.c)(o))return t.field(o);throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(t instanceof R){if((0,s.c)(o))return t.global(o);throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if(t instanceof v.default){if((0,s.c)(o))return(0,p.geometryMember)(t,o,e,r);throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if((0,s.m)(t)){if((0,s.b)(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=t.length+o),o>=t.length||o<0)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.OutOfBounds,r);return t[o]}throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if((0,s.o)(t)){if((0,s.b)(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=t.length()+o),o>=t.length()||o<0)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.OutOfBounds,r);return t.get(o)}throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidMemberAccessKey,r)}if((0,s.c)(t)){if((0,s.b)(o)&&isFinite(o)&&Math.floor(o)===o){if(o<0&&(o=t.length+o),o>=t.length||o<0)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.OutOfBounds,r);return t[o]}throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidMemberAccessKey,r)}throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidMemberAccessKey,r)}(e,r);case"Literal":return r.value;case"CallExpression":return await async function(e,r){if("MemberExpression"===r.callee.type){const t=await I(e,r.callee.object);if(!(t instanceof R))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.FunctionNotFound,r);const o=!1===r.callee.computed?r.callee.property.name:await I(e,r.callee.property);if(!t.hasGlobal(o))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.FunctionNotFound,r);const n=await t.global(o);if(!(0,s.i)(n))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.CallNonFunction,r);return n.call(e,r)}if("Identifier"!==r.callee.type)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.FunctionNotFound,r);if(null!=e.localScope&&void 0!==e.localScope[r.callee.name.toLowerCase()]){const t=e.localScope[r.callee.name.toLowerCase()];if((0,s.i)(t.value))return t.value.call(e,r);throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.CallNonFunction,r)}if(void 0!==e.globalScope[r.callee.name.toLowerCase()]){const t=e.globalScope[r.callee.name.toLowerCase()];if((0,s.i)(t.value))return t.value.call(e,r);throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.CallNonFunction,r)}throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.FunctionNotFound,r)}(e,r);case"UnaryExpression":return await async function(e,r){const t=await I(e,r.argument);if((0,s.a)(t)){if("!"===r.operator)return!t;if("-"===r.operator)return-1*(0,s.g)(t);if("+"===r.operator)return 1*(0,s.g)(t);if("~"===r.operator)return~(0,s.g)(t);throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.UnsupportedUnaryOperator,r)}if("-"===r.operator)return-1*(0,s.g)(t);if("+"===r.operator)return 1*(0,s.g)(t);if("~"===r.operator)return~(0,s.g)(t);throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.UnsupportedUnaryOperator,r)}(e,r);case"BinaryExpression":return await async function(e,r){const t=[];t[0]=await I(e,r.left),t[1]=await I(e,r.right);const o=t[0],n=t[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return(0,s.B)((0,s.g)(o),(0,s.g)(n),r.operator);case"==":return(0,s.A)(o,n);case"!=":return!(0,s.A)(o,n);case"<":case">":case"<=":case">=":return(0,s.z)(o,n,r.operator);case"+":return(0,s.c)(o)||(0,s.c)(n)?(0,s.j)(o)+(0,s.j)(n):(0,s.g)(o)+(0,s.g)(n);case"-":return(0,s.g)(o)-(0,s.g)(n);case"*":return(0,s.g)(o)*(0,s.g)(n);case"/":return(0,s.g)(o)/(0,s.g)(n);case"%":return(0,s.g)(o)%(0,s.g)(n);default:throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.UnsupportedOperator,r)}}(e,r);case"LogicalExpression":return await async function(e,r){const t=await I(e,r.left);let o=null;if(!(0,s.a)(t))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.LogicalExpressionOnlyBoolean,r);switch(r.operator){case"||":if(!0===t)return t;if(o=await I(e,r.right),(0,s.a)(o))return o;throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.LogicExpressionOrAnd,r);case"&&":if(!1===t)return t;if(o=await I(e,r.right),(0,s.a)(o))return o;throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.LogicExpressionOrAnd,r);default:throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.LogicExpressionOrAnd,r)}}(e,r);case"ArrayExpression":return await async function(e,r){const t=[];for(let o=0;o<r.elements.length;o++)t.push(await I(e,r.elements[o]));for(let o=0;o<t.length;o++){if((0,s.i)(t[o]))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.NoFunctionInArray,r);t[o]===s.v&&(t[o]=null)}return t}(e,r);case"ObjectExpression":return await async function(e,r){const t=[];for(let o=0;o<r.properties.length;o++)t[o]=await I(e,r.properties[o]);const o={},n=new Map;for(let a=0;a<t.length;a++){const i=t[a];if((0,s.i)(i.value))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.NoFunctionInDictionary,r);if(!1===(0,s.c)(i.key))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.KeyMustBeString,r);let l=i.key.toString();const u=l.toLowerCase();n.has(u)?l=n.get(u):n.set(u,l),i.value===s.v?o[l]=null:o[l]=i.value}const a=new(0,i.default)(o);return a.immutable=!1,a}(e,r);case"Property":return await async function(e,r){const t=await I(e,r.value);return"Identifier"===r.key.type?{key:r.key.name,value:t}:{key:await I(e,r.key),value:t}}(e,r);default:throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.Unrecognised,r)}}catch(t){throw(0,c.ensureArcadeExecutionError)(e,r,t)}}async function M(e,r,t){const o=await I(e,r.body);return t.lastAction=o,t.lastAction===s.w||t.lastAction instanceof s.R?(t.testResult=!1,t):null!==r.update?(await I(e,r.update),t):t}function N(e,r,t,o,n,a){try{(async function(e,r,t){if(null!==r.test){const o=await I(e,r.test);if(!0===e.abortSignal?.aborted)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.Cancelled,r);if(t.testResult=o,!1===t.testResult)return t;if(!0!==t.testResult)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.BooleanConditionRequired,r);return M(e,r,t)}return M(e,r,t)})(e,r,t).then((()=>{try{!0===t.testResult?++a>C?(a=0,setTimeout((()=>{N(e,r,t,o,n,a)}),0)):N(e,r,t,o,n,a):t.lastAction instanceof s.R?o(t.lastAction):o(s.v)}catch(e){n(e)}}),(e=>{n(e)}))}catch(e){n(e)}}function L(e,r,t,o,n,a,i,c,l,u){try{if(o<=a)return void c(s.v);n.value="k"===i?t[a]:a,I(e,r.body).then((d=>{try{d instanceof s.R?c(d):d===s.w?c(s.v):++u>C?(u=0,setTimeout((()=>{L(e,r,t,o,n,a+1,i,c,l,u)}),0)):L(e,r,t,o,n,a+1,i,c,l,u)}catch(e){l(e)}}),(e=>{l(e)}))}catch(e){l(e)}}function O(e,r,t,o,n,a,i,c,l){try{if(t.length()<=n)return void i(s.v);o.value="k"===a?t.get(n):n,I(e,r.body).then((u=>{u instanceof s.R?i(u):u===s.w?i(s.v):++l>C?(l=0,setTimeout((()=>{O(e,r,t,o,n+1,a,i,c,l)}),0)):O(e,r,t,o,n+1,a,i,c,l)}),(e=>{c(e)}))}catch(e){c(e)}}function k(e,r,t,o,n,a){try{if(void 0===a&&(a="i"),0===t.length)return void o.resolve(s.v);L(e,r,t,t.length,n,0,a,(e=>{o.resolve(e)}),(e=>{o.reject(e)}),0)}catch(e){o.reject(e)}}function B(e,r,t,o,n,a,i,c){try{e.next().then((u=>{try{if(null===u)a(s.v);else{const d=l.default.createFromGraphicLikeObject(u.geometry,u.attributes,o,r.timeReference);d._underlyingGraphic=u,n.value=d,I(r,t.body).then((l=>{try{l===s.w?a(s.v):l instanceof s.R?a(l):++c>C?(c=0,setTimeout((()=>{B(e,r,t,o,n,a,i,c)}),0)):B(e,r,t,o,n,a,i,c)}catch(e){i(e)}}),(e=>{i(e)}))}}catch(e){i(e)}}),(e=>{i(e)}))}catch(e){i(e)}}function j(e,r,t,o,n){switch(r){case"=":return e===s.v?null:e;case"/=":return(0,s.g)(t)/(0,s.g)(e);case"*=":return(0,s.g)(t)*(0,s.g)(e);case"-=":return(0,s.g)(t)-(0,s.g)(e);case"+=":return(0,s.c)(t)||(0,s.c)(e)?(0,s.j)(t)+(0,s.j)(e):(0,s.g)(t)+(0,s.g)(e);case"%=":return(0,s.g)(t)%(0,s.g)(e);default:throw new(0,c.ArcadeExecutionError)(n,c.ExecutionErrorCodes.UnsupportedOperator,o)}}async function P(e,r,t){if(t>=r.body.length)return s.v;const o=await I(e,r.body[t]);return o instanceof s.R||o===s.w||o===s.x||t===r.body.length-1?o:P(e,r,t+1)}async function K(e,r,t){return t>=r.declarations.length||(await I(e,r.declarations[t]),t===r.declarations.length-1||await K(e,r,t+1)),s.v}async function D(e,r){const t=r.name.toLowerCase();if(null!=e.localScope&&void 0!==e.localScope[t]){const r=e.localScope[t];if(!0===r.valueset)return r.value;if(null!==r.d)return r.d;r.d=I(e,r.node);const o=await r.d;return r.value=o,r.valueset=!0,o}if(void 0!==e.globalScope[t]){const r=e.globalScope[t];if(!0===r.valueset)return r.value;if(null!==r.d)return r.d;r.d=I(e,r.node);const o=await r.d;return r.value=o,r.valueset=!0,o}throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.InvalidIdentifier,r)}function T(e,r,t){if((0,s.i)(e))throw new(0,c.ArcadeExecutionError)(r,c.ExecutionErrorCodes.NoFunctionInTemplateLiteral,t);return e}const q={};async function G(e,r,t,o){const n=await I(e,r.arguments[t]);if((0,s.A)(n,o))return I(e,r.arguments[t+1]);const a=r.arguments.length-t;return 1===a?I(e,r.arguments[t]):2===a?null:3===a?I(e,r.arguments[t+2]):G(e,r,t+2,o)}async function U(e,r,t,o){if(!0===o)return I(e,r.arguments[t+1]);if(3==r.arguments.length-t)return I(e,r.arguments[t+2]);const n=await I(e,r.arguments[t+2]);if(!1===(0,s.a)(n))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.ModuleExportNotFound,r.arguments[t+2]);return U(e,r,t+2,n)}async function V(e,r,t,o){const n=e.body;if(t.length!==e.params.length)throw new(0,c.ArcadeExecutionError)(r,c.ExecutionErrorCodes.WrongNumberOfParameters,null);for(let o=0;o<t.length;o++){const n=e.params[o];"Identifier"===n.type&&null!=r.localScope&&(r.localScope[n.name.toLowerCase()]={d:null,value:t[o],valueset:!0,node:null})}const a=await I(r,n);if(a instanceof s.R)return a.value;if(a===s.w)throw new(0,c.ArcadeExecutionError)(r,c.ExecutionErrorCodes.UnexpectedToken,o);if(a===s.x)throw new(0,c.ArcadeExecutionError)(r,c.ExecutionErrorCodes.UnexpectedToken,o);return a instanceof s.I?a.value:a}(0,E.registerFunctions)(q,A),(0,g.registerFunctions)(q,A),(0,x.registerFunctions)(q,A),(0,p.registerFunctions)(q,A),(0,h.registerFunctions)(q,A),(0,w.registerFunctions)({functions:q,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:A,standardFunctionAsync:F}),q.iif=async function(e,r){(0,s.C)(null===r.arguments?[]:r.arguments,3,3,e,r);const t=await I(e,r.arguments[0]);if(!1===(0,s.a)(t))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.BooleanConditionRequired,r);return I(e,t?r.arguments[1]:r.arguments[2])},q.decode=async function(e,r){if(r.arguments.length<2)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.WrongNumberOfParameters,r);if(2===r.arguments.length)return I(e,r.arguments[1]);if((r.arguments.length-1)%2==0)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.WrongNumberOfParameters,r);return G(e,r,1,await I(e,r.arguments[0]))},q.when=async function(e,r){if(r.arguments.length<3)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.WrongNumberOfParameters,r);if(r.arguments.length%2==0)throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.WrongNumberOfParameters,r);const t=await I(e,r.arguments[0]);if(!1===(0,s.a)(t))throw new(0,c.ArcadeExecutionError)(e,c.ExecutionErrorCodes.BooleanConditionRequired,r.arguments[0]);return U(e,r,0,t)};const W={fixSpatialReference:s.y,parseArguments:b,standardFunction:A,standardFunctionAsync:F,evaluateIdentifier:D};for(const e in q)q[e]={value:new(0,u.NativeFunction)(q[e]),valueset:!0,node:null};const _=function(){};function z(e,r,t){const o=new _;null==e&&(e={}),null==r&&(r={});const n=new(0,i.default)({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});n.immutable=!1,o.textformatting={value:n,valueset:!0,node:null};for(const e in r)o[e]={value:new(0,u.NativeFunction)(r[e]),native:!0,valueset:!0,node:null};for(const r in e)e[r]&&"esri.Graphic"===e[r].declaredClass?o[r]={value:l.default.createFromGraphic(e[r],t),valueset:!0,node:null}:o[r]={value:e[r],valueset:!0,node:null};return o}function H(e){console.log(e)}(_.prototype=q).infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},_.prototype.pi={value:Math.PI,valueset:!0,node:null};const X=W;function Y(e){const r={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:A,standardFunctionAsync:F,evaluateIdentifier:D};for(let t=0;t<e.length;t++)e[t].registerFunctions(r);for(const e in r.functions)q[e]={value:new(0,u.NativeFunction)(r.functions[e]),valueset:!0,node:null},_.prototype[e]=q[e];for(let e=0;e<r.signatures.length;e++)(0,d.addFunctionDeclaration)(r.signatures[e],"async")}async function J(e,r){let t=r.spatialReference;null==t&&(t=new(0,m.default)({wkid:102100}));let o=null;e.usesModules&&(o=new(0,a.ArcadeModuleLoader)(new Map,e.loadedModules));const n=z(r.vars,r.customfunctions,r.timeReference),i={spatialReference:t,services:r.services,exports:{},libraryResolver:o,abortSignal:void 0===r.abortSignal||null===r.abortSignal?{aborted:!1}:r.abortSignal,globalScope:n,console:r.console??H,timeReference:r.timeReference??null,lrucache:r.lrucache,interceptor:r.interceptor,localScope:null,depthCounter:{depth:1}};let l=await I(i,e);if(l instanceof s.R&&(l=l.value),l instanceof s.I&&(l=l.value),l===s.v&&(l=null),l===s.w)throw new(0,c.ArcadeExecutionError)(i,c.ExecutionErrorCodes.IllegalResult,null);if(l===s.x)throw new(0,c.ArcadeExecutionError)(i,c.ExecutionErrorCodes.IllegalResult,null);if((0,s.i)(l))throw new(0,c.ArcadeExecutionError)(i,c.ExecutionErrorCodes.IllegalResult,null);return l}Y([f.A])}));
//# sourceMappingURL=arcadeAsyncRuntime.9bc3dc2f.js.map
