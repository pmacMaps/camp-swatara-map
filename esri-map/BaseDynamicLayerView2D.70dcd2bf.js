!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("3UAL3",(function(n,a){t(n.exports,"default",(function(){return P}));var i=r("8TSCy"),o=r("2TvXO"),u=r("7eJjO"),s=r("jymfC"),p=r("10vEZ"),c=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var l=r("fcwIv"),d=r("gINRd"),f=r("8TwEW"),h=r("eY5Yp"),v=r("xQ42o"),y=r("eA3h8"),m=r("1ScYs"),g=r("cqGfY"),x=r("i90gL"),w=(0,f.create)(),b=[0,0],_=new(0,x.default)(0,0,0,0),S=2048,M=2048,k=!1,T=!1,R=!1,z=function(t){"use strict";i.inherits(n,t);var r=i.createSuper(n);function n(t){var a;i.classCallCheck(this,n);var u,s=i.assertThisInitialized(a);return(a=r.call(this,t))._imagePromise=null,a.bitmaps=[],a.hidpi=R,a.imageMaxWidth=S,a.imageMaxHeight=M,a.imageRotationSupported=k,a.imageNormalizationSupported=T,a.update=(0,p.debounce)((u=i.asyncToGenerator(e(o).mark((function t(r,n){var a,u,p,c,l,d,f,v,m,g,x;return e(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.stationary&&!s.destroyed){t.next=2;break}return t.abrupt("return",null);case 2:return a=r.state,u=(0,h.getInfo)(a.spatialReference),p=s.hidpi?r.pixelRatio:1,(c=s.imageNormalizationSupported&&a.worldScreenWidth&&a.worldScreenWidth<a.size[0])?(b[0]=a.worldScreenWidth,b[1]=a.size[1]):s.imageRotationSupported?(b[0]=a.size[0],b[1]=a.size[1]):(0,y.getOuterSize)(b,a),l=Math.floor(b[0]*p)>s.imageMaxWidth||Math.floor(b[1]*p)>s.imageMaxHeight,d=u&&(a.extent.xmin<u.valid[0]||a.extent.xmax>u.valid[1]),f=!s.imageNormalizationSupported&&d,v=!l&&!f,m=s.imageRotationSupported?a.rotation:0,v?(g=c?a.paddedViewState.center:a.center,s._imagePromise=s._singleExport(a,b,g,a.resolution,m,p,n)):(x=Math.min(s.imageMaxWidth,s.imageMaxHeight),f&&(x=Math.min(a.worldScreenWidth,x)),s._imagePromise=s._tiledExport(a,x,m,p,n)),t.abrupt("return",s._imagePromise.then(function(){var t=i.asyncToGenerator(e(o).mark((function t(r){var n,a,i,u,p,c,l,d,f,h,v,y;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s._imagePromise=null,s.destroyed){e.next=36;break}for(s.bitmaps=null!=r?r:[],n=!0,a=!1,i=void 0,e.prev=3,u=s.container.children[Symbol.iterator]();!(n=(p=u.next()).done);n=!0)c=p.value,r.includes(c)||c.fadeOut().then((function(){c.remove()}));e.next=11;break;case 7:e.prev=7,e.t0=e.catch(3),a=!0,i=e.t0;case 11:e.prev=11,e.prev=12,n||null==u.return||u.return();case 14:if(e.prev=14,!a){e.next=17;break}throw i;case 17:return e.finish(14);case 18:return e.finish(11);case 19:for(l=!0,d=!1,f=void 0,e.prev=20,h=r[Symbol.iterator]();!(l=(v=h.next()).done);l=!0)y=v.value,s.container.addChild(y),y.fadeIn();e.next=28;break;case 24:e.prev=24,e.t1=e.catch(20),d=!0,f=e.t1;case 28:e.prev=28,e.prev=29,l||null==h.return||h.return();case 31:if(e.prev=31,!d){e.next=34;break}throw f;case 34:return e.finish(31);case 35:return e.finish(28);case 36:case"end":return e.stop()}}),t,null,[[3,7,11,19],[12,,14,18],[20,24,28,36],[29,,31,35]])})));return function(e){return t.apply(this,arguments)}}()).catch((function(e){throw s._imagePromise=null,e})));case 7:case"end":return t.stop()}}),t)}))),function(e,t){return u.apply(this,arguments)}),5e3),i.possibleConstructorReturn(a)}return i.createClass(n,[{key:"destroy",value:function(){this.bitmaps=[]}},{key:"updating",get:function(){return!this.destroyed&&null!==this._imagePromise}},{key:"updateExports",value:function(e){var t=!0,r=!1,n=void 0;try{for(var a,i=this.container.children[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;if(!o.visible||!o.stage)return;e(o),o.invalidateTexture(),o.requestRender()}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}},{key:"_export",value:function(t,r,n,a,u,s){var p=this;return i.asyncToGenerator(e(o).mark((function i(){var c,l;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.fetchSource(t,Math.floor(r*u),Math.floor(n*u),{rotation:a,pixelRatio:u,signal:s});case 2:return c=e.sent,l=new(0,m.Bitmap)(c,"additive"),e.abrupt("return",(l.x=t.xmin,l.y=t.ymax,l.resolution=t.width/r,l.rotation=a,l.pixelRatio=u,l));case 5:case"end":return e.stop()}}),i)})))()}},{key:"_singleExport",value:function(t,r,n,a,u,s,p){var c=this;return i.asyncToGenerator(e(o).mark((function i(){var l;return e(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,y.getBBox)(w,n,a,r),l=new(0,d.default)(w[0],w[1],w[2],w[3],t.spatialReference),e.next=4,c._export(l,r[0],r[1],u,s,p);case 4:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 6:case"end":return e.stop()}}),i)})))()}},{key:"_tiledExport",value:function(e,t,r,n,a){var i=this,o=v.default.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),u=new(0,g.default)(o),s=u.getTileCoverage(e);if(!s)return null;var p=[];return s.forEach((function(o,s,c,l){_.set(o,s,c,l),u.getTileBounds(w,_);var f=new(0,d.default)(w[0],w[1],w[2],w[3],e.spatialReference);p.push(i._export(f,t,t,r,n,a))})),Promise.all(p)}}]),n}(s.default);(0,u._)([(0,c.property)()],z.prototype,"_imagePromise",void 0),(0,u._)([(0,c.property)()],z.prototype,"bitmaps",void 0),(0,u._)([(0,c.property)()],z.prototype,"container",void 0),(0,u._)([(0,c.property)()],z.prototype,"fetchSource",void 0),(0,u._)([(0,c.property)()],z.prototype,"hidpi",void 0),(0,u._)([(0,c.property)()],z.prototype,"imageMaxWidth",void 0),(0,u._)([(0,c.property)()],z.prototype,"imageMaxHeight",void 0),(0,u._)([(0,c.property)()],z.prototype,"imageRotationSupported",void 0),(0,u._)([(0,c.property)()],z.prototype,"imageNormalizationSupported",void 0),(0,u._)([(0,c.property)()],z.prototype,"requestUpdate",void 0),(0,u._)([(0,c.property)()],z.prototype,"updating",null);var P=z=(0,u._)([(0,l.subclass)("esri.views.2d.layers.support.ExportStrategy")],z)})),r.register("eA3h8",(function(e,n){t(e.exports,"getOuterSize",(function(){return o})),t(e.exports,"getBBox",(function(){return u}));var a=r("8TSCy"),i=Math.PI/180;function o(e,t){var r=t.rotation*i,n=Math.abs(Math.cos(r)),o=Math.abs(Math.sin(r)),u=a.slicedToArray(t.size,2),s=u[0],p=u[1];return e[0]=Math.round(p*o+s*n),e[1]=Math.round(p*n+s*o),e}function u(e,t,r,n){var i=a.slicedToArray(t,2),o=i[0],u=i[1],s=a.slicedToArray(n,2),p=s[0],c=s[1],l=.5*r;return e[0]=o-l*p,e[1]=u-l*c,e[2]=o+l*p,e[3]=u+l*c,e}}))}();
//# sourceMappingURL=BaseDynamicLayerView2D.70dcd2bf.js.map
