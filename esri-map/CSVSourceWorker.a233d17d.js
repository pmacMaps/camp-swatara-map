function e(e,t,a,r){Object.defineProperty(e,t,{get:a,set:r,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("jKVXg",(function(a,r){e(a.exports,"WhereClause",(function(){return m})),e(a.exports,"defaultAttributeAdapter",(function(){return k}));var s=t("5HTPH"),n=t("3yoKB"),i=t("3HNR4"),l=t("8HVwb");const u=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,o=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,c=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,d=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,h=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,p=new Set(["current_timestamp","current_date","current_time"]);function v(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function f(e,t,a="0",r="0",s="0",n="0",i="",l="0",u="0"){if("+"===i||"-"===i){const o=`${v(parseInt(e,10),4)}-${v(parseInt(t,10),2)}-${v(parseInt(a,10),2)}`;let c="";parseFloat(n)<10&&(c="0");const d=`${v(parseInt(r,10),2)}:${v(parseInt(s,10),2)}:${c+parseFloat(n).toString()}`,h=`${i}${v(parseInt(l,10),2)}:${v(parseInt(u,10),2)}`;return new Date(o+"T"+d+h)}return new Date(parseInt(e,10),parseInt(t,10)-1,parseInt(a,10),parseInt(r,10),parseInt(s,10),parseFloat(n))}class N{static makeBool(e){return T(e)}static featureValue(e,t,a,r){return O(e,t,a,r)}static equalsNull(e){return null===e}static applyLike(e,t,a){return E(e,t,a)}static ensureArray(e){return S(e)}static applyIn(e,t){return b(e,t)}static currentDate(){const e=new Date;return e.setHours(0,0,0,0),e}static makeSqlInterval(e,t,a){return i.SqlInterval.createFromValueAndQualifer(e,t,a)}static convertInterval(e){return e instanceof i.SqlInterval?e.valueInMilliseconds():e}static currentTimestamp(){return new Date}static compare(e,t,a){return F(e,t,a)}static calculate(e,t,a){return M(e,t,a)}static makeComparable(e){return x(e)}static evaluateFunction(e,t){return(0,i.evaluateFunction)(e,t)}static lookup(e,t){const a=t[e];return void 0===a?null:a}static between(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]}static notbetween(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]}static ternaryNot(e){return w(e)}static ternaryAnd(e,t){return I(e,t)}static ternaryOr(e,t){return y(e,t)}}class m{static create(e,t){return new m(e,t)}get fieldNames(){return this.referencedFieldNames}testSet(e,t=k){const a={};for(const r of this.fieldNames)a[r]=e.map((e=>t.getAttribute(e,r)));return!!this._evaluateNode(this.parseTree,{attributes:a},k)}calculateValue(e,t=k){const a=this._evaluateNode(this.parseTree,e,t);return a instanceof i.SqlInterval?a.valueInMilliseconds()/864e5:a}calculateValueCompiled(e,t=k){return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):(0,s.default)("esri-csp-restrictions")?this.calculateValue(e,t):(this._compileMe(),this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}testFeature(e,t=k){return!!this._evaluateNode(this.parseTree,e,t)}testFeatureCompiled(e,t=k){return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields):(0,s.default)("esri-csp-restrictions")?this.testFeature(e,t):(this._compileMe(),!!this.parseTree._compiledVersion(e,this.parameters,t,this.datefields))}get hasDateFunctions(){return null!=this._hasDateFunctions||(this._hasDateFunctions=!1,this._visitAll(this.parseTree,(e=>{"current_time"===e.type?this._hasDateFunctions=!0:"function"===e.type&&(this._hasDateFunctions=this._hasDateFunctions||p.has(e.name.toLowerCase()))}))),this._hasDateFunctions}getFunctions(){const e=new Set;return this._visitAll(this.parseTree,(t=>{"function"===t.type&&e.add(t.name.toLowerCase())})),Array.from(e)}getExpressions(){const e=new Map;return this._visitAll(this.parseTree,(t=>{if("function"===t.type){const a=t.name.toLowerCase(),r=t.args.value[0];if("column_ref"===r.type){const t=r.column,s=`${a}-${t}`;e.has(s)||e.set(s,{aggregateType:a,field:t})}}})),[...e.values()]}getVariables(){const e=new Set;return this._visitAll(this.parseTree,(t=>{"param"===t.type&&e.add(t.value.toLowerCase())})),Array.from(e)}_compileMe(){const e="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",e).bind(N)}_extractExpressionInfo(e){const t=[],a=new Set;let r=!0,s=!0;return this._visitAll(this.parseTree,(l=>{switch(l.type){case"column_ref":{const r=e.get(l.column);let s,n;r?s=n=r.name:(n=l.column,s=n.toLowerCase()),!r||"date"!==r.type&&"esriFieldTypeDate"!==r.type||(this.datefields[r.name]=1),a.has(s)||(a.add(s),t.push(n)),l.column=n;break}case"function":{const{name:e,args:t}=l,a=t.value.length;r&&(r=(0,i.isStandardized)(e,a)),s&&(s=(0,n.isAggregate)(e,a));break}}})),{referencedFieldNames:Array.from(t),isStandardized:r,isAggregate:s}}_visitAll(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this._visitAll(e.operand,t),this._visitAll(e.value,t);break;case"case_expression":for(const a of e.clauses)this._visitAll(a,t);"simple"===e.format&&this._visitAll(e.operand,t),null!==e.else&&this._visitAll(e.else,t);break;case"expr_list":for(const a of e.value)this._visitAll(a,t);break;case"unary_expr":this._visitAll(e.expr,t);break;case"binary_expr":this._visitAll(e.left,t),this._visitAll(e.right,t);break;case"function":this._visitAll(e.args,t)}}evaluateNodeToJavaScript(e){switch(e.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(e.value)+", "+JSON.stringify(e.qualifier)+","+JSON.stringify(e.op)+")";case"case_expression":{let t="";if("simple"===e.format){const a="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(let r=0;r<e.clauses.length;r++)t+=" ("+a+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[r].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[r].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(let a=0;a<e.clauses.length;a++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[a].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[a].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t}case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":{let t="[";for(const a of e.value)"["!==t&&(t+=","),t+=this.evaluateNodeToJavaScript(a);return t+="]",t}case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+_(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+g(e.value).getTime().toString()+"))";case"current_time":return"date"===e.mode?"this.currentDate()":"this.currentTimestamp()";case"column_ref":return"this.featureValue(feature,"+JSON.stringify(e.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)}_evaluateNode(e,t,a){switch(e.type){case"interval":{const r=this._evaluateNode(e.value,t,a);return i.SqlInterval.createFromValueAndQualifer(r,e.qualifier,e.op)}case"case_expression":if("simple"===e.format){const r=x(this._evaluateNode(e.operand,t,a));for(let s=0;s<e.clauses.length;s++)if(r===x(this._evaluateNode(e.clauses[s].operand,t,a)))return this._evaluateNode(e.clauses[s].value,t,a);if(null!==e.else)return this._evaluateNode(e.else,t,a)}else{for(let r=0;r<e.clauses.length;r++)if(T(this._evaluateNode(e.clauses[r].operand,t,a)))return this._evaluateNode(e.clauses[r].value,t,a);if(null!==e.else)return this._evaluateNode(e.else,t,a)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":{const r=[];for(const s of e.value)r.push(this._evaluateNode(s,t,a));return r}case"unary_expr":return w(this._evaluateNode(e.expr,t,a));case"binary_expr":switch(e.operator){case"AND":return I(this._evaluateNode(e.left,t,a),this._evaluateNode(e.right,t,a));case"OR":return y(this._evaluateNode(e.left,t,a),this._evaluateNode(e.right,t,a));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this._evaluateNode(e.left,t,a);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this._evaluateNode(e.left,t,a);case"IN":{const r=S(this._evaluateNode(e.right,t,a));return b(this._evaluateNode(e.left,t,a),r)}case"NOT IN":{const r=S(this._evaluateNode(e.right,t,a));return w(b(this._evaluateNode(e.left,t,a),r))}case"BETWEEN":{const r=this._evaluateNode(e.left,t,a),s=this._evaluateNode(e.right,t,a);return null==r||null==s[0]||null==s[1]?null:r>=x(s[0])&&r<=x(s[1])}case"NOTBETWEEN":{const r=this._evaluateNode(e.left,t,a),s=this._evaluateNode(e.right,t,a);return null==r||null==s[0]||null==s[1]?null:r<x(s[0])||r>x(s[1])}case"LIKE":return E(this._evaluateNode(e.left,t,a),this._evaluateNode(e.right,t,a),e.escape);case"NOT LIKE":return w(E(this._evaluateNode(e.left,t,a),this._evaluateNode(e.right,t,a),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return F(e.operator,this._evaluateNode(e.left,t,a),this._evaluateNode(e.right,t,a));case"-":case"+":case"*":case"/":return M(e.operator,this._evaluateNode(e.left,t,a),this._evaluateNode(e.right,t,a))}case"null":case"bool":case"string":case"number":return e.value;case"date":return _(e.value);case"timestamp":return g(e.value);case"current_time":{const t=new Date;return"date"===e.mode&&t.setHours(0,0,0,0),t}case"column_ref":return O(t,e.column,this.datefields,a);case"function":{const r=this._evaluateNode(e.args,t,a);return this.isAggregate?(0,n.aggregateFunction)(e.name,r):(0,i.evaluateFunction)(e.name,r)}}throw new Error("Unsupported sql syntax "+e.type)}constructor(e,t){this.fieldsIndex=t,this.datefields={},this.parameters={},this._hasDateFunctions=void 0,this.parseTree=l.WhereGrammar.parse(e);const{isStandardized:a,isAggregate:r,referencedFieldNames:s}=this._extractExpressionInfo(t);this.referencedFieldNames=s,this.isStandardized=a,this.isAggregate=r}}function g(e){let t=o.exec(e);if(null!==t){const[,e,a,r,s,n,i]=t;return f(e,a,r,s,n,i)}if(t=c.exec(e),null!==t){const[,e,a,r,s,n,i,l,u,o]=t;return f(e,a,r,s,n,i,l,u,o)}if(t=d.exec(e),null!==t){const[,e,a,r,s,n,i,l,u]=t;return f(e,a,r,s,n,"0",i,l,u)}if(t=h.exec(e),null!==t){const[,e,a,r,s,n]=t;return f(e,a,r,s,n)}if(t=u.exec(e),null!==t){const[,e,a,r]=t;return f(e,a,r)}throw new Error("SQL Invalid Timestamp")}function _(e){const t=u.exec(e);if(null===t)throw new Error("SQL Invalid Date");const[,a,r,s]=t;return new Date(parseInt(a,10),parseInt(r,10)-1,parseInt(s,10))}function T(e){return!0===e}function S(e){return Array.isArray(e)?e:[e]}function w(e){return null!==e?!0!==e:null}function I(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function y(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function b(e,t){if(null==e)return null;let a=!1;for(const r of t)if(null==r)a=null;else if(e===r){a=!0;break}return a}const J="-[]/{}()*+?.\\^$|";var A,D;function E(e,t,a){return null==e?null:function(e,t){const a=t;let r="",s=A.Normal;for(let t=0;t<e.length;t++){const n=e.charAt(t);switch(s){case A.Normal:n===a?s=A.Escaped:J.includes(n)?r+="\\"+n:r+="%"===n?".*":"_"===n?".":n;break;case A.Escaped:J.includes(n)?r+="\\"+n:r+=n,s=A.Normal}}return new RegExp("^"+r+"$","m")}(t,a).test(e)}function x(e){return e instanceof Date?e.valueOf():e}function F(e,t,a){if(null==t||null==a)return null;const r=x(t),s=x(a);switch(e){case"<>":return r!==s;case"=":return r===s;case">":return r>s;case"<":return r<s;case">=":return r>=s;case"<=":return r<=s}}function M(e,t,a){if(t instanceof i.SqlInterval)if(a instanceof Date)switch(e){case"+":return new Date(t.valueInMilliseconds()+a.getTime());case"-":return t.valueInMilliseconds()-a.getTime();case"*":return t.valueInMilliseconds()*a.getTime();case"/":return t.valueInMilliseconds()/a.getTime()}else if(a instanceof i.SqlInterval)switch(e){case"+":return i.SqlInterval.createFromMilliseconds(t.valueInMilliseconds()+a.valueInMilliseconds());case"-":return i.SqlInterval.createFromMilliseconds(t.valueInMilliseconds()-a.valueInMilliseconds());case"*":return t.valueInMilliseconds()*a.valueInMilliseconds();case"/":return t.valueInMilliseconds()/a.valueInMilliseconds()}else t=t.valueInMilliseconds();else if(a instanceof i.SqlInterval)if(t instanceof Date)switch(e){case"+":return new Date(a.valueInMilliseconds()+t.getTime());case"-":return new Date(t.getTime()-a.valueInMilliseconds());case"*":return t.getTime()*a.valueInMilliseconds();case"/":return t.getTime()/a.valueInMilliseconds()}else a=a.valueInMilliseconds();else if(t instanceof Date&&"number"==typeof a)switch(a=24*a*36e5,t=t.getTime(),e){case"+":return new Date(t+a);case"-":return new Date(t-a);case"*":return new Date(t*a);case"/":return new Date(t/a)}else if(a instanceof Date&&"number"==typeof t)switch(t=24*t*36e5,a=a.getTime(),e){case"+":return new Date(t+a);case"-":return new Date(t-a);case"*":return new Date(t*a);case"/":return new Date(t/a)}switch(e){case"+":return t+a;case"-":return t-a;case"*":return t*a;case"/":return t/a}}function O(e,t,a,r){const s=r.getAttribute(e,t);return null!=s&&1===a[t]?new Date(s):s}(D=A||(A={}))[D.Normal=0]="Normal",D[D.Escaped=1]="Escaped";const k={getAttribute:(e,t)=>{return(a=e,a&&"object"==typeof a.attributes?e.attributes:e)[t];var a}}}));
//# sourceMappingURL=CSVSourceWorker.a233d17d.js.map
