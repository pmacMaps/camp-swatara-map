function e(e,t,r,s){Object.defineProperty(e,t,{get:r,set:s,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("3lrwW",(function(r,s){var n;n=r.exports,Object.defineProperty(n,"__esModule",{value:!0,configurable:!0}),e(r.exports,"default",(function(){return j}));var o=t("j6uz9");t("ixrNB");var a=t("EvxpF"),i=t("bYA0c"),u=t("kURdk"),c=t("bPmsI"),l=t("5HTPH"),d=t("4jlRt"),p=t("lEAUW"),y=t("1CpCt"),h=t("fO1IB"),f=t("lHg4e"),m=t("7dRCe"),g=t("hTI69");t("aX9sh"),t("gHCNy");var F=t("qA6zg"),b=t("2WnyR"),S=t("86d4E"),x=t("7hPz0"),R=t("lPgMU"),O=t("bj1sh"),I=t("iLRU4"),q=t("jaaCV");const _=new(0,d.JSONMap)({originalAndCurrentFeatures:"original-and-current-features",none:"none"});const C=new Set(["Feature Layer","Table"]);let T=class extends p.default{load(e){const t=(0,y.isSome)(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:t,dynamicDataSource:r,infoFor3D:s,gdbVersion:n,spatialReference:o,fieldsIndex:a}=this.layer,i=(0,l.default)("featurelayer-pbf")&&e&&(0,y.isNone)(s)?"pbf":"json";return new(0,R.default)({url:t.path,format:i,fieldsIndex:a,infoFor3D:s,dynamicDataSource:r,gdbVersion:n,sourceSpatialReference:o})}async addAttachment(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+r+"/addAttachment",n=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(t,n.query);try{const e=await(0,i.default)(s,{body:o});return this._createFeatureEditResult(e.data.addAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}async updateAttachment(e,t,r){await this.load();const s=e.attributes[this.layer.objectIdField],n=this.layer.parsedUrl.path+"/"+s+"/updateAttachment",o=this._getLayerRequestOptions({query:{attachmentId:t}}),a=this._getFormDataForAttachment(r,o.query);try{const e=await(0,i.default)(n,{body:a});return this._createFeatureEditResult(e.data.updateAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(s,e)}}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),s=e.updateFeatures.map(this._serializeFeature,this),n=this._getFeatureIds(e.deleteFeatures,t?.globalIdUsed);(0,O.unapplyEditsZUnitScaling)(r,s,this.layer.spatialReference);const o=[],a=[],u=[...e.deleteAttachments];for(const t of e.addAttachments)o.push(await this._serializeAttachment(t));for(const t of e.updateAttachments)a.push(await this._serializeAttachment(t));const c=o.length||a.length||u.length?{adds:o,updates:a,deletes:u}:null,l={gdbVersion:t?.gdbVersion||this.layer.gdbVersion,rollbackOnFailure:t?.rollbackOnFailureEnabled,useGlobalIds:t?.globalIdUsed,returnEditMoment:t?.returnEditMoment,usePreviousEditMoment:t?.usePreviousEditMoment,sessionId:t?.sessionId};t?.returnServiceEditsOption?(l.edits=JSON.stringify([{id:this.layer.layerId,adds:r,updates:s,deletes:n,attachments:c}]),l.returnServiceEditsOption=_.toJSON(t?.returnServiceEditsOption),l.returnServiceEditsInSourceSR=t?.returnServiceEditsInSourceSR):(l.adds=r.length?JSON.stringify(r):null,l.updates=s.length?JSON.stringify(s):null,l.deletes=n.length?t?.globalIdUsed?JSON.stringify(n):n.join(","):null,l.attachments=c&&JSON.stringify(c));const d=this._getLayerRequestOptions({method:"post",query:l}),p=t?.returnServiceEditsOption?this.layer.url:this.layer.parsedUrl.path,y=await(0,i.default)(p+"/applyEdits",d);return this._createEditsResult(y)}async deleteAttachments(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+r+"/deleteAttachments";try{return(await(0,i.default)(s,this._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:r,url:s}=this.layer,{data:n}=await(0,i.default)(`${s}/${r}`,t),{id:o,extent:a,fullExtent:c,timeExtent:l}=n,d=a||c;return{id:o,fullExtent:d&&b.default.fromJSON(d),timeExtent:l&&u.default.fromJSON({start:l[0],end:l[1]})}}))}async queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,s=r.path;await this.load();const n=this._getLayerRequestOptions(t);if(!this.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:t}=e,r=[];for(const e of t){const t=s+"/"+e+"/attachments";r.push((0,i.default)(t,n))}return Promise.all(r).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>(0,I.processAttachmentQueryResult)(e,s)))}return this.queryTask.executeAttachmentQuery(e,n)}async queryFeatures(e,t){return await this.load(),this.queryTask.execute(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:this._createRequestQueryOptions(t)})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopFeatures(e,t){return await this.load(),this.queryTask.executeTopFeaturesQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopObjectIds(e,t){return await this.load(),this.queryTask.executeForTopIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopExtents(e,t){return await this.load(),this.queryTask.executeForTopExtents(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopCount(e,t){return await this.load(),this.queryTask.executeForTopCount(e,{...t,query:this._createRequestQueryOptions(t)})}_createRequestQueryOptions(e){const t={...this.layer.customParameters,token:this.layer.apiKey,...e?.query};return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}async _fetchService(e,t){if(!e){const{data:r}=await(0,i.default)(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:(0,l.default)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:t}));e=r}this.sourceJSON=this._patchServiceJSON(e);const r=e.type;if(!C.has(r))throw new(0,c.default)("feature-layer-source:unsupported-type",`Source type "${r}" is not supported`)}_patchServiceJSON(e){if("Table"!==e.type&&e.geometryType&&!e?.drawingInfo?.renderer&&!e.defaultSymbol){const t=(0,x.createDrawingInfo)(e.geometryType).renderer;(0,h.setDeepValue)("drawingInfo.renderer",t,e)}return"esriGeometryMultiPatch"===e.geometryType&&e.infoFor3D&&(e.geometryType="mesh"),e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return(0,y.isNone)(t)?{attributes:r}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:s,name:n,contentType:o,data:a,uploadId:i}=r,u={globalId:s,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(u.parentGlobalId="attributes"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),i)u.uploadId=i;else if(a){const e=await async function(e){if("string"==typeof e)return(0,m.dataComponents)(e)||{data:e};return new Promise(((t,r)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t((0,m.dataComponents)(s.result)),s.onerror=e=>r(e)}))}(a);u.contentType=e.mediaType,u.data=e.data,a instanceof File&&(u.name=a.name)}return n&&(u.name=n),o&&(u.contentType=o),u}_getFeatureIds(e,t){const r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):"objectId"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_canUseGlobalIds(e,t){return e&&"globalId"in t[0]}_getObjectIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_getGlobalIdsFromFeatureIdentifier(e){return e.map((e=>e.globalId))}_createEditsResult(e){const t=e.data,{layerId:r}=this.layer,s=[];let n=null;if(Array.isArray(t))for(const e of t)s.push({id:e.id,editedFeatures:e.editedFeatures}),e.id===r&&(n={addResults:e.addResults,updateResults:e.updateResults,deleteResults:e.deleteResults,attachments:e.attachments,editMoment:e.editMoment});else n=t;const o=n?.attachments,a={addFeatureResults:n.addResults?n.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:n.updateResults?n.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:n.deleteResults?n.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:o&&o.addResults?o.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:o&&o.updateResults?o.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:o&&o.deleteResults?o.deleteResults.map(this._createFeatureEditResult,this):[]};if(n.editMoment&&(a.editMoment=n.editMoment),s.length>0){a.editedFeatureResults=[];for(const e of s){const{adds:t,updates:r,deletes:s,spatialReference:n}=e.editedFeatures,o=n?new(0,q.default)(n):null;a.editedFeatureResults.push({layerId:e.id,editedFeatures:{adds:t?.map((e=>this._createEditedFeature(e,o)))||[],updates:r?.map((e=>({original:this._createEditedFeature(e[0],o),current:this._createEditedFeature(e[1],o)})))||[],deletes:s?.map((e=>this._createEditedFeature(e,o)))||[],spatialReference:o}})}}return a}_createEditedFeature(e,t){return new(0,a.default)({attributes:e.attributes,geometry:(0,S.fromJSON)({...e.geometry,spatialReference:t})})}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new(0,c.default)("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new(0,c.default)("feature-layer-source:attachment-failure",r,{code:s})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const e in t){const s=t[e];null!=s&&(r.set?r.set(e,s):r.append(e,s))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:r,dynamicDataSource:s}=this.layer;return{...e,query:{gdbVersion:r,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:"json",...this._createRequestQueryOptions(e)},responseType:"json"}}constructor(){super(...arguments),this.type="feature-layer",this.refresh=(0,f.debounce)((async()=>{await this.load();const e=this.sourceJSON.editingInfo?.lastEditDate;if(null==e)return{dataChanged:!0,updates:{}};try{await this._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const t=e!==this.sourceJSON.editingInfo?.lastEditDate;return{dataChanged:t,updates:t?{editingInfo:this.sourceJSON.editingInfo,extent:this.sourceJSON.extent}:null}}))}};(0,o._)([(0,g.property)()],T.prototype,"type",void 0),(0,o._)([(0,g.property)({constructOnly:!0})],T.prototype,"layer",void 0),(0,o._)([(0,g.property)({readOnly:!0})],T.prototype,"queryTask",null),T=(0,o._)([(0,F.subclass)("esri.layers.graphics.sources.FeatureLayerSource")],T);const j=T})),t.register("7hPz0",(function(r,s){e(r.exports,"createDrawingInfo",(function(){return u})),e(r.exports,"createDefaultAttributesFunction",(function(){return d})),e(r.exports,"createDefaultTemplate",(function(){return p})),e(r.exports,"createCapabilities",(function(){return y}));var n=t("5HTPH"),o=t("itGIg"),a=t("11H8e"),i=t("hb76Y");function u(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?i.defaultPointSymbolJSON:"esriGeometryPolyline"===e?i.defaultPolylineSymbolJSON:i.defaultPolygonSymbolJSON}}}const c=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let l=1;function d(e,t){if((0,n.default)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this.${t} = null;`;for(const t in e)r+=`this${c.test(t)?`.${t}`:`["${t}"]`} = ${JSON.stringify(e[t])};`;const s=new Function(`\n      return class AttributesClass$${l++} {\n        constructor() {\n          ${r};\n        }\n      }\n    `)();return()=>new s}catch(r){return()=>({[t]:null,...e})}}function p(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,o.clone)(e)}}]}function y(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0},query:a.queryCapabilities,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}})),t.register("11H8e",(function(t,r){e(t.exports,"queryCapabilities",(function(){return s}));const s={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}})),t.register("lPgMU",(function(r,s){e(r.exports,"default",(function(){return T}));var n=t("j6uz9"),o=t("bPmsI"),a=t("5HTPH"),i=t("1CpCt"),u=t("lHg4e"),c=t("hTI69");t("aX9sh"),t("gHCNy");var l=t("qA6zg"),d=t("bGOam"),p=t("gUA0G"),y=t("jBscr"),h=t("gEU1A"),f=t("gC5jC"),m=t("7Sewt"),g=t("f2o0Y"),F=t("dl2hH"),b=t("gX72D"),S=t("7XsNY"),x=t("apY1Z"),R=t("7Nxmh"),O=t("4D8NH"),I=t("iHtAn"),q=t("ec36V"),_=t("5vbdy");let C=class extends _.default{execute(e,t){return this.executeJSON(e,t).then((r=>this.featureSetFromJSON(e,r,t)))}async executeJSON(e,t){const r={...this.requestOptions,...t},s=this._normalizeQuery(e),n=null!=e.outStatistics?.[0],o=(0,a.default)("featurelayer-pbf-statistics"),i=!n||o;let u;if("pbf"===this.format&&i)try{u=await(0,y.executeRawQueryPBF)(this.url,s,r)}catch(e){if("query:parsing-pbf"!==e.name)throw e;this.format="json"}return"json"!==this.format&&i||(u=await(0,p.executeRawQueryJSON)(this.url,s,r)),this._normalizeFields(u.fields),u}async featureSetFromJSON(e,r,s){if(!this._queryIs3DObjectFormat(e)||(0,i.isNone)(this.infoFor3D)||!r.features||!r.features.length)return h.default.fromJSON(r);const{meshFeatureSetFromJSON:n}=await(0,u.whenOrAbort)(t("45ptM"),s);return n(e,this.infoFor3D,r)}executeForCount(e,t){const r={...this.requestOptions,...t},s=this._normalizeQuery(e);return(0,g.executeForCount)(this.url,s,r)}executeForExtent(e,t){const r={...this.requestOptions,...t},s=this._normalizeQuery(e);return(0,F.executeForExtent)(this.url,s,r)}executeForIds(e,t){const r={...this.requestOptions,...t},s=this._normalizeQuery(e);return(0,b.executeForIds)(this.url,s,r)}executeRelationshipQuery(e,t){e=q.default.from(e);const r={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),(0,S.executeRelationshipQuery)(this.url,e,r)}executeRelationshipQueryForCount(e,t){e=q.default.from(e);const r={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),(0,S.executeRelationshipQueryForCount)(this.url,e,r)}executeAttachmentQuery(e,t){const r={...this.requestOptions,...t};return(0,m.executeAttachmentQuery)(this.url,e,r)}executeTopFeaturesQuery(e,t){const r={...this.requestOptions,...t};return(0,x.executeTopFeaturesQuery)(this.parsedUrl,e,this.sourceSpatialReference,r)}executeForTopIds(e,t){const r={...this.requestOptions,...t};return(0,R.executeForTopIds)(this.parsedUrl,e,r)}executeForTopExtents(e,t){const r={...this.requestOptions,...t};return(0,O.executeForTopExtents)(this.parsedUrl,e,r)}executeForTopCount(e,t){const r={...this.requestOptions,...t};return(0,I.executeForTopCount)(this.parsedUrl,e,r)}_normalizeQuery(e){let t=f.default.from(e);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?d.DataLayerSource.from(e.dynamicDataSource):this.dynamicDataSource),(0,i.isSome)(this.infoFor3D)&&this._queryIs3DObjectFormat(e)){t=t===e?t.clone():t,t.formatOf3DObjects=null;for(const e of this.infoFor3D.queryFormats){if("3D_glb"===e.id){t.formatOf3DObjects=e.id;break}"3D_gltf"!==e.id||t.formatOf3DObjects||(t.formatOf3DObjects=e.id)}if(!t.formatOf3DObjects)throw new(0,o.default)("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if((0,i.isNone)(t.outFields)||!t.outFields.includes("*")){t=t===e?t.clone():t,(0,i.isNone)(t.outFields)&&(t.outFields=[]);const{originX:r,originY:s,originZ:n,translationX:o,translationY:a,translationZ:u,scaleX:c,scaleY:l,scaleZ:d,rotationX:p,rotationY:y,rotationZ:h,rotationDeg:f}=this.infoFor3D.transformFieldRoles;t.outFields.push(r,s,n,o,a,u,c,l,d,p,y,h,f)}}return t}_normalizeFields(e){if((0,i.isSome)(this.fieldsIndex)&&(0,i.isSome)(e))for(const t of e){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}_queryIs3DObjectFormat(e){return(0,i.isSome)(this.infoFor3D)&&e.returnGeometry&&"xyFootprint"!==e.multipatchOption&&!e.outStatistics}constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.format="json",this.gdbVersion=null,this.infoFor3D=null,this.sourceSpatialReference=null}};(0,n._)([(0,c.property)({type:d.DataLayerSource})],C.prototype,"dynamicDataSource",void 0),(0,n._)([(0,c.property)()],C.prototype,"fieldsIndex",void 0),(0,n._)([(0,c.property)()],C.prototype,"format",void 0),(0,n._)([(0,c.property)()],C.prototype,"gdbVersion",void 0),(0,n._)([(0,c.property)()],C.prototype,"infoFor3D",void 0),(0,n._)([(0,c.property)()],C.prototype,"sourceSpatialReference",void 0),C=(0,n._)([(0,l.subclass)("esri.tasks.QueryTask")],C);const T=C})),t.register("jBscr",(function(r,s){e(r.exports,"executeRawQueryPBF",(function(){return u}));var n=t("dgLSf"),o=t("htSgC"),a=t("6ljp4"),i=(t("gEU1A"),t("gC5jC"));async function u(e,t,r){const s=(0,n.parseUrl)(e),u={...r},c=i.default.from(t),l=!c.quantizationParameters,{data:d}=await(0,a.executeQueryPBF)(s,c,new(0,o.JSONFeatureSetParserContext)({sourceSpatialReference:c.sourceSpatialReference,applyTransform:l}),u);return d}})),t.register("htSgC",(function(r,s){e(r.exports,"JSONFeatureSetParserContext",(function(){return h}));var n=t("cL2Ua"),o=t("1CpCt"),a=t("1vzSt"),i=t("8RZNq");function u(e,t){return t}function c(e,t,r,s){switch(r){case 0:return y(e,t+s,0);case 1:return"lowerLeft"===e.originPosition?y(e,t+s,1):function({translate:e,scale:t},r,s){return e[s]-r*t[s]}(e,t+s,1)}}function l(e,t,r,s){return 2===r?y(e,t,2):c(e,t,r,s)}function d(e,t,r,s){return 2===r?y(e,t,3):c(e,t,r,s)}function p(e,t,r,s){return 3===r?y(e,t,3):l(e,t,r,s)}function y({translate:e,scale:t},r,s){return e[s]+r*t[s]}class h{createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this.options.applyTransform&&(e.transform=null),this._attributesConstructor=()=>{},this.coordinateBuffer=null,this.lengths.length=0,!e.hasZ)return;const t=(0,a.getGeometryZScaler)(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(!(0,o.isNone)(t))for(const r of e.features)t(r.geometry)}createSpatialReference(){return{}}addField(e,t){e.fields.push(t);const r=e.fields.map((e=>e.name));this._attributesConstructor=function(){for(const e of r)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this.transform=e.transform,this.options.applyTransform&&e.transform&&(this.applyTransform=this._deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,t,r)=>this.addCoordinatePoint(e,t,r),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,t,r)=>this._addCoordinatePolygon(e,t,r),this.createGeometry=e=>this._createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,t,r)=>this._addCoordinatePolyline(e,t,r),this.createGeometry=e=>this._createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,t,r)=>this._addCoordinateMultipoint(e,t,r),this.createGeometry=e=>this._createMultipointGeometry(e);break;default:(0,n.neverReached)(e.geometryType)}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)}addQueryGeometry(e,t){const{queryGeometry:r,queryGeometryType:s}=t,n=(0,i.unquantizeOptimizedGeometry)(r.clone(),r,!1,!1,this.transform),o=(0,i.convertToGeometry)(n,s,!1,!1);e.queryGeometryType=s,e.queryGeometry={...o}}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}_transformPathLikeValue(e,t){let r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)}_addCoordinatePolyline(e,t,r){this._dehydratedAddPointsCoordinate(e.paths,t,r)}_addCoordinatePolygon(e,t,r){this._dehydratedAddPointsCoordinate(e.rings,t,r)}_addCoordinateMultipoint(e,t,r){0===r&&e.points.push([]);const s=this._transformPathLikeValue(t,r);e.points[e.points.length-1].push(s)}_createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_dehydratedAddPointsCoordinate(e,t,r){0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const s=this._transformPathLikeValue(t,r),n=e[e.length-1];0===r&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),n.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=s}_deriveApplyTransform(e){const{hasZ:t,hasM:r}=e;return t&&r?p:t?l:r?d:c}constructor(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=u,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this._attributesConstructor=()=>{}}}})),t.register("7Sewt",(function(r,s){e(r.exports,"executeAttachmentQuery",(function(){return i}));var n=t("dgLSf"),o=t("iLRU4"),a=t("1JFSz");async function i(e,t,r){const s=(0,n.parseUrl)(e);return(0,o.executeAttachmentQuery)(s,a.default.from(t),{...r}).then((e=>(0,o.processAttachmentQueryResult)(e.data.attachmentGroups,s.path)))}})),t.register("iLRU4",(function(r,s){e(r.exports,"processAttachmentQueryResult",(function(){return l})),e(r.exports,"executeAttachmentQuery",(function(){return d}));var n=t("1mmm2"),o=t("bYA0c"),a=t("7dRCe"),i=t("bAQEw"),u=t("81dmF");function c(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function l(e,t){const r={};for(const s of e){const{parentObjectId:e,parentGlobalId:o,attachmentInfos:i}=s;for(const s of i){const{id:i}=s,c=(0,a.addProxy)((0,n.addTokenParameter)(`${t}/${e}/attachments/${i}`)),l=u.default.fromJSON(s);l.set({url:c,parentObjectId:e,parentGlobalId:o}),r[e]?r[e].push(l):r[e]=[l]}}return r}function d(e,t,r){let s={query:(0,i.mapParameters)({...e.query,f:"json",...c(t)})};return r&&(s={...r,...s,query:{...r.query,...s.query}}),(0,o.default)(e.path+"/queryAttachments",s)}})),t.register("f2o0Y",(function(r,s){e(r.exports,"executeForCount",(function(){return i}));var n=t("dgLSf"),o=t("6ljp4"),a=t("gC5jC");async function i(e,t,r){const s=(0,n.parseUrl)(e);return(0,o.executeQueryForCount)(s,a.default.from(t),{...r}).then((e=>e.data.count))}})),t.register("dl2hH",(function(r,s){e(r.exports,"executeForExtent",(function(){return u})),t("ixrNB");var n=t("dgLSf"),o=t("6ljp4"),a=t("gC5jC"),i=t("2WnyR");async function u(e,t,r){const s=(0,n.parseUrl)(e);return(0,o.executeQueryForExtent)(s,a.default.from(t),{...r}).then((e=>({count:e.data.count,extent:i.default.fromJSON(e.data.extent)})))}})),t.register("gX72D",(function(r,s){e(r.exports,"executeForIds",(function(){return i}));var n=t("dgLSf"),o=t("6ljp4"),a=t("gC5jC");async function i(e,t,r){const s=(0,n.parseUrl)(e);return(0,o.executeQueryForIds)(s,a.default.from(t),{...r}).then((e=>e.data.objectIds))}})),t.register("7XsNY",(function(r,s){e(r.exports,"executeRelationshipQuery",(function(){return u})),e(r.exports,"executeRelationshipQueryForCount",(function(){return c}));var n=t("dgLSf"),o=t("2jD4D"),a=t("gEU1A"),i=t("ec36V");async function u(e,t,r){t=i.default.from(t);const s=(0,n.parseUrl)(e);return(0,o.executeRelationshipQuery)(s,t,r).then((e=>{const t=e.data,r={};return Object.keys(t).forEach((e=>r[e]=a.default.fromJSON(t[e]))),r}))}async function c(e,t,r){t=i.default.from(t);const s=(0,n.parseUrl)(e);return(0,o.executeRelationshipQueryForCount)(s,t,{...r}).then((e=>e.data))}})),t.register("2jD4D",(function(r,s){e(r.exports,"executeRelationshipQuery",(function(){return i})),e(r.exports,"executeRelationshipQueryForCount",(function(){return u}));var n=t("bYA0c"),o=t("bAQEw");function a(e,t){const r=e.toJSON();return r.objectIds&&(r.objectIds=r.objectIds.join(",")),r.orderByFields&&(r.orderByFields=r.orderByFields.join(",")),r.outFields&&!t?.returnCountOnly?r.outFields.includes("*")?r.outFields="*":r.outFields=r.outFields.join(","):delete r.outFields,r.outSpatialReference&&(r.outSR=r.outSR.wkid||JSON.stringify(r.outSR.toJSON()),delete r.outSpatialReference),r.dynamicDataSource&&(r.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r}async function i(e,t,r){const s=await c(e,t,r),n=s.data,o=n.geometryType,a=n.spatialReference,i={};for(const e of n.relatedRecordGroups){const t={fields:void 0,objectIdFieldName:void 0,geometryType:o,spatialReference:a,hasZ:!!n.hasZ,hasM:!!n.hasM,features:e.relatedRecords};if(null!=e.objectId)i[e.objectId]=t;else for(const r in e)e.hasOwnProperty(r)&&"relatedRecords"!==r&&(i[e[r]]=t)}return{...s,data:i}}async function u(e,t,r){const s=await c(e,t,r,{returnCountOnly:!0}),n=s.data,o={};for(const e of n.relatedRecordGroups)null!=e.objectId&&(o[e.objectId]=e.count);return{...s,data:o}}async function c(e,t,r={},s){const i=(0,o.mapParameters)({...e.query,f:"json",...s,...a(t,s)});return(0,n.default)(e.path+"/queryRelatedRecords",{...r,query:{...r.query,...i}})}})),t.register("apY1Z",(function(r,s){e(r.exports,"executeTopFeaturesQuery",(function(){return u}));var n=t("dgLSf"),o=t("2pWQg"),a=t("gEU1A"),i=t("gqX03");async function u(e,t,r,s){const u=(0,n.parseUrl)(e),c={...s},{data:l}=await(0,o.executeTopFeaturesQuery)(u,i.default.from(t),r,c);return a.default.fromJSON(l)}})),t.register("2pWQg",(function(r,s){e(r.exports,"executeTopFeaturesQuery",(function(){return y})),e(r.exports,"executeQueryForTopIds",(function(){return h})),e(r.exports,"executeQueryForTopExtents",(function(){return f})),e(r.exports,"executeQueryForTopCount",(function(){return m}));var n=t("bYA0c"),o=t("1CpCt"),a=t("7dRCe"),i=t("86d4E"),u=t("hq5aB"),c=t("bAQEw"),l=t("1FRrh");const d="Layer does not support extent calculation.";function p(e,t){const r=e.geometry,s=e.toJSON(),n=s;if((0,o.isSome)(r)&&(n.geometry=JSON.stringify(r),n.geometryType=(0,i.getJsonType)(r),n.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference)),s.topFilter?.groupByFields&&(n.topFilter.groupByFields=s.topFilter.groupByFields.join(",")),s.topFilter?.orderByFields&&(n.topFilter.orderByFields=s.topFilter.orderByFields.join(",")),s.topFilter&&(n.topFilter=JSON.stringify(n.topFilter)),s.objectIds&&(n.objectIds=s.objectIds.join(",")),s.orderByFields&&(n.orderByFields=s.orderByFields.join(",")),s.outFields&&!(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?s.outFields.includes("*")?n.outFields="*":n.outFields=s.outFields.join(","):delete n.outFields,s.outSR?n.outSR=s.outSR.wkid||JSON.stringify(s.outSR):r&&s.returnGeometry&&(n.outSR=n.inSR),s.returnGeometry&&delete s.returnGeometry,s.timeExtent){const e=s.timeExtent,{start:t,end:r}=e;null==t&&null==r||(n.time=t===r?t:`${null==t?"null":t},${null==r?"null":r}`),delete s.timeExtent}return n}async function y(e,t,r,s){const n=await g(e,t,"json",s);return(0,l.applyFeatureSetZUnitScaling)(t,r,n.data),n}async function h(e,t,r){return(0,o.isSome)(t.timeExtent)&&t.timeExtent.isEmpty?{data:{objectIds:[]}}:g(e,t,"json",r,{returnIdsOnly:!0})}async function f(e,t,r){return(0,o.isSome)(t.timeExtent)&&t.timeExtent.isEmpty?{data:{count:0,extent:null}}:g(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((e=>{const t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(d);if(t.hasOwnProperty("count"))throw new Error(d);return e}))}function m(e,t,r){return(0,o.isSome)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):g(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function g(e,t,r,s={},i={}){const l="string"==typeof e?(0,a.urlToObject)(e):e,d=t.geometry?[t.geometry]:[];return s.responseType="pbf"===r?"array-buffer":"json",(0,u.normalizeCentralMeridian)(d,null,s).then((e=>{const u=e&&e[0];(0,o.isSome)(u)&&((t=t.clone()).geometry=u);const d=(0,c.mapParameters)({...l.query,f:r,...i,...p(t,i)});return(0,n.default)((0,a.join)(l.path,"queryTopFeatures"),{...s,query:{...d,...s.query}})}))}})),t.register("7Nxmh",(function(r,s){e(r.exports,"executeForTopIds",(function(){return i}));var n=t("dgLSf"),o=t("2pWQg"),a=t("gqX03");async function i(e,t,r){const s=(0,n.parseUrl)(e);return(await(0,o.executeQueryForTopIds)(s,a.default.from(t),{...r})).data.objectIds}})),t.register("4D8NH",(function(r,s){e(r.exports,"executeForTopExtents",(function(){return u})),t("ixrNB");var n=t("dgLSf"),o=t("2pWQg"),a=t("gqX03"),i=t("2WnyR");async function u(e,t,r){const s=(0,n.parseUrl)(e),u=await(0,o.executeQueryForTopExtents)(s,a.default.from(t),{...r});return{count:u.data.count,extent:i.default.fromJSON(u.data.extent)}}})),t.register("iHtAn",(function(r,s){e(r.exports,"executeForTopCount",(function(){return i}));var n=t("dgLSf"),o=t("2pWQg"),a=t("gqX03");async function i(e,t,r){const s=(0,n.parseUrl)(e);return(await(0,o.executeQueryForTopCount)(s,a.default.from(t),{...r})).data.count}})),t.register("5vbdy",(function(r,s){e(r.exports,"default",(function(){return l}));var n=t("j6uz9"),o=t("27btt"),a=t("7dRCe"),i=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var u=t("qA6zg");let c=class extends o.default{normalizeCtorArgs(e,t){return"string"!=typeof e?e:{url:e,...t}}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(e){return e?(0,a.urlToObject)(e):null}_encode(e,t,r){const s={};for(const n in e){if("declaredClass"===n)continue;const o=e[n];if(null!=o&&"function"!=typeof o)if(Array.isArray(o)){s[n]=[];for(let e=0;e<o.length;e++)s[n][e]=this._encode(o[e])}else if("object"==typeof o)if(o.toJSON){const e=o.toJSON(r&&r[n]);s[n]=t?e:JSON.stringify(e)}else s[n]=t?o:JSON.stringify(o);else s[n]=o}return s}constructor(...e){super(...e),this.requestOptions=null,this.url=null}};(0,n._)([(0,i.property)({readOnly:!0})],c.prototype,"parsedUrl",null),(0,n._)([(0,i.property)()],c.prototype,"requestOptions",void 0),(0,n._)([(0,i.property)({type:String})],c.prototype,"url",void 0),c=(0,n._)([(0,u.subclass)("esri.tasks.Task")],c);const l=c})),t.register("45ptM",(function(e,r){e.exports=Promise.all([import("./"+t("kyEFX").resolve("9U18k")),import("./"+t("kyEFX").resolve("1W1uA")),import("./"+t("kyEFX").resolve("1Gjuc"))]).then((()=>t("54DDy")))}));
//# sourceMappingURL=FeatureLayerSource.05c9a605.js.map
