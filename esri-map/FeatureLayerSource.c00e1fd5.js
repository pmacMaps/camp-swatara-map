!function(){function e(e,t,r,s){Object.defineProperty(e,t,{get:r,set:s,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("hwHXf",(function(r,s){var n;n=r.exports,Object.defineProperty(n,"__esModule",{value:!0,configurable:!0}),e(r.exports,"default",(function(){return w}));var o=t("7eJjO");t("2ILM8");var a=t("bsvXr"),i=t("9pNSx"),u=t("9DeZf"),l=t("kyj08"),d=t("2VlWd"),c=t("79ASa"),p=t("bQCqB"),y=t("7qybv"),h=t("8EPEw"),f=t("10vEZ"),m=t("kYueh"),g=t("iho5X");t("lNwWH"),t("iJAIC");var F=t("fcwIv"),b=t("gINRd"),x=t("79LpT"),R=t("dxhdj"),S=t("jABk8"),O=t("kXCh8"),I=t("5EgUN"),v=t("j40xv");const q=new(0,c.JSONMap)({originalAndCurrentFeatures:"original-and-current-features",none:"none"});const _=new Set(["Feature Layer","Table"]);let j=class extends p.default{load(e){const t=(0,y.isSome)(e)?e.signal:null;return this.addResolvingPromise(this._fetchService(this.layer.sourceJSON,t)),Promise.resolve(this)}get queryTask(){const{capabilities:{query:{supportsFormatPBF:e}},parsedUrl:t,dynamicDataSource:r,infoFor3D:s,gdbVersion:n,spatialReference:o,fieldsIndex:a}=this.layer,i=(0,d.default)("featurelayer-pbf")&&e&&(0,y.isNone)(s)?"pbf":"json";return new(0,S.default)({url:t.path,format:i,fieldsIndex:a,infoFor3D:s,dynamicDataSource:r,gdbVersion:n,sourceSpatialReference:o})}async addAttachment(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+r+"/addAttachment",n=this._getLayerRequestOptions(),o=this._getFormDataForAttachment(t,n.query);try{const e=await(0,i.default)(s,{body:o});return this._createFeatureEditResult(e.data.addAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}async updateAttachment(e,t,r){await this.load();const s=e.attributes[this.layer.objectIdField],n=this.layer.parsedUrl.path+"/"+s+"/updateAttachment",o=this._getLayerRequestOptions({query:{attachmentId:t}}),a=this._getFormDataForAttachment(r,o.query);try{const e=await(0,i.default)(n,{body:a});return this._createFeatureEditResult(e.data.updateAttachmentResult)}catch(e){throw this._createAttachmentErrorResult(s,e)}}async applyEdits(e,t){await this.load();const r=e.addFeatures.map(this._serializeFeature,this),s=e.updateFeatures.map(this._serializeFeature,this),n=this._getFeatureIds(e.deleteFeatures,null==t?void 0:t.globalIdUsed);(0,O.unapplyEditsZUnitScaling)(r,s,this.layer.spatialReference);const o=[],a=[],u=[...e.deleteAttachments];for(const t of e.addAttachments)o.push(await this._serializeAttachment(t));for(const t of e.updateAttachments)a.push(await this._serializeAttachment(t));const l=o.length||a.length||u.length?{adds:o,updates:a,deletes:u}:null,d={gdbVersion:(null==t?void 0:t.gdbVersion)||this.layer.gdbVersion,rollbackOnFailure:null==t?void 0:t.rollbackOnFailureEnabled,useGlobalIds:null==t?void 0:t.globalIdUsed,returnEditMoment:null==t?void 0:t.returnEditMoment,usePreviousEditMoment:null==t?void 0:t.usePreviousEditMoment,sessionId:null==t?void 0:t.sessionId};(null==t?void 0:t.returnServiceEditsOption)?(d.edits=JSON.stringify([{id:this.layer.layerId,adds:r,updates:s,deletes:n,attachments:l}]),d.returnServiceEditsOption=q.toJSON(null==t?void 0:t.returnServiceEditsOption),d.returnServiceEditsInSourceSR=null==t?void 0:t.returnServiceEditsInSourceSR):(d.adds=r.length?JSON.stringify(r):null,d.updates=s.length?JSON.stringify(s):null,d.deletes=n.length?(null==t?void 0:t.globalIdUsed)?JSON.stringify(n):n.join(","):null,d.attachments=l&&JSON.stringify(l));const c=this._getLayerRequestOptions({method:"post",query:d}),p=(null==t?void 0:t.returnServiceEditsOption)?this.layer.url:this.layer.parsedUrl.path,y=await(0,i.default)(p+"/applyEdits",c);return this._createEditsResult(y)}async deleteAttachments(e,t){await this.load();const r=e.attributes[this.layer.objectIdField],s=this.layer.parsedUrl.path+"/"+r+"/deleteAttachments";try{return(await(0,i.default)(s,this._getLayerRequestOptions({query:{attachmentIds:t.join(",")},method:"post"}))).data.deleteAttachmentResults.map(this._createFeatureEditResult)}catch(e){throw this._createAttachmentErrorResult(r,e)}}fetchRecomputedExtents(e={}){const t=e.signal;return this.load({signal:t}).then((async()=>{const t=this._getLayerRequestOptions({...e,query:{returnUpdates:!0}}),{layerId:r,url:s}=this.layer,{data:n}=await(0,i.default)(`${s}/${r}`,t),{id:o,extent:a,fullExtent:l,timeExtent:d}=n,c=a||l;return{id:o,fullExtent:c&&b.default.fromJSON(c),timeExtent:d&&u.default.fromJSON({start:d[0],end:d[1]})}}))}async queryAttachments(e,t={}){const{parsedUrl:r}=this.layer,s=r.path;await this.load();const n=this._getLayerRequestOptions(t);if(!this.layer.get("capabilities.operations.supportsQueryAttachments")){const{objectIds:t}=e,r=[];for(const e of t){const t=s+"/"+e+"/attachments";r.push((0,i.default)(t,n))}return Promise.all(r).then((e=>t.map(((t,r)=>({parentObjectId:t,attachmentInfos:e[r].data.attachmentInfos}))))).then((e=>(0,I.processAttachmentQueryResult)(e,s)))}return this.queryTask.executeAttachmentQuery(e,n)}async queryFeatures(e,t){return await this.load(),this.queryTask.execute(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeaturesJSON(e,t){return await this.load(),this.queryTask.executeJSON(e,{...t,query:this._createRequestQueryOptions(t)})}async queryObjectIds(e,t){return await this.load(),this.queryTask.executeForIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryFeatureCount(e,t){return await this.load(),this.queryTask.executeForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryExtent(e,t){return await this.load(),this.queryTask.executeForExtent(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeatures(e,t){return await this.load(),this.queryTask.executeRelationshipQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryRelatedFeaturesCount(e,t){return await this.load(),this.queryTask.executeRelationshipQueryForCount(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopFeatures(e,t){return await this.load(),this.queryTask.executeTopFeaturesQuery(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopObjectIds(e,t){return await this.load(),this.queryTask.executeForTopIds(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopExtents(e,t){return await this.load(),this.queryTask.executeForTopExtents(e,{...t,query:this._createRequestQueryOptions(t)})}async queryTopCount(e,t){return await this.load(),this.queryTask.executeForTopCount(e,{...t,query:this._createRequestQueryOptions(t)})}_createRequestQueryOptions(e){const t={...this.layer.customParameters,token:this.layer.apiKey,...null==e?void 0:e.query};return this.layer.datesInUnknownTimezone&&(t.timeReferenceUnknownClient=!0),t}async _fetchService(e,t){if(!e){const{data:r}=await(0,i.default)(this.layer.parsedUrl.path,this._getLayerRequestOptions({query:(0,d.default)("featurelayer-advanced-symbols")?{returnAdvancedSymbols:!0}:{},signal:t}));e=r}this.sourceJSON=this._patchServiceJSON(e);const r=e.type;if(!_.has(r))throw new(0,l.default)("feature-layer-source:unsupported-type",`Source type "${r}" is not supported`)}_patchServiceJSON(e){var t;if("Table"!==e.type&&e.geometryType&&!(null==e||null===(t=e.drawingInfo)||void 0===t?void 0:t.renderer)&&!e.defaultSymbol){const t=(0,R.createDrawingInfo)(e.geometryType).renderer;(0,h.setDeepValue)("drawingInfo.renderer",t,e)}return"esriGeometryMultiPatch"===e.geometryType&&e.infoFor3D&&(e.geometryType="mesh"),e}_serializeFeature(e){const{geometry:t,attributes:r}=e;return(0,y.isNone)(t)?{attributes:r}:"mesh"===t.type||"extent"===t.type?null:{geometry:t.toJSON(),attributes:r}}async _serializeAttachment(e){const{feature:t,attachment:r}=e,{globalId:s,name:n,contentType:o,data:a,uploadId:i}=r,u={globalId:s,parentGlobalId:null,contentType:null,name:null,uploadId:null,data:null};if(t&&(u.parentGlobalId="attributes"in t?t.attributes&&t.attributes[this.layer.globalIdField]:t.globalId),i)u.uploadId=i;else if(a){const e=await async function(e){if("string"==typeof e)return(0,m.dataComponents)(e)||{data:e};return new Promise(((t,r)=>{const s=new FileReader;s.readAsDataURL(e),s.onload=()=>t((0,m.dataComponents)(s.result)),s.onerror=e=>r(e)}))}(a);u.contentType=e.mediaType,u.data=e.data,a instanceof File&&(u.name=a.name)}return n&&(u.name=n),o&&(u.contentType=o),u}_getFeatureIds(e,t){const r=e[0];return r?this._canUseGlobalIds(t,e)?this._getGlobalIdsFromFeatureIdentifier(e):"objectId"in r?this._getObjectIdsFromFeatureIdentifier(e):this._getIdsFromFeatures(e):[]}_getIdsFromFeatures(e){const t=this.layer.objectIdField;return e.map((e=>e.attributes&&e.attributes[t]))}_canUseGlobalIds(e,t){return e&&"globalId"in t[0]}_getObjectIdsFromFeatureIdentifier(e){return e.map((e=>e.objectId))}_getGlobalIdsFromFeatureIdentifier(e){return e.map((e=>e.globalId))}_createEditsResult(e){const t=e.data,{layerId:r}=this.layer,s=[];let n=null;if(Array.isArray(t))for(const e of t)s.push({id:e.id,editedFeatures:e.editedFeatures}),e.id===r&&(n={addResults:e.addResults,updateResults:e.updateResults,deleteResults:e.deleteResults,attachments:e.attachments,editMoment:e.editMoment});else n=t;const o=null==n?void 0:n.attachments,a={addFeatureResults:n.addResults?n.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:n.updateResults?n.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:n.deleteResults?n.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:o&&o.addResults?o.addResults.map(this._createFeatureEditResult,this):[],updateAttachmentResults:o&&o.updateResults?o.updateResults.map(this._createFeatureEditResult,this):[],deleteAttachmentResults:o&&o.deleteResults?o.deleteResults.map(this._createFeatureEditResult,this):[]};if(n.editMoment&&(a.editMoment=n.editMoment),s.length>0){a.editedFeatureResults=[];for(const e of s){const{adds:t,updates:r,deletes:s,spatialReference:n}=e.editedFeatures,o=n?new(0,v.default)(n):null;a.editedFeatureResults.push({layerId:e.id,editedFeatures:{adds:(null==t?void 0:t.map((e=>this._createEditedFeature(e,o))))||[],updates:(null==r?void 0:r.map((e=>({original:this._createEditedFeature(e[0],o),current:this._createEditedFeature(e[1],o)}))))||[],deletes:(null==s?void 0:s.map((e=>this._createEditedFeature(e,o))))||[],spatialReference:o}})}}return a}_createEditedFeature(e,t){return new(0,a.default)({attributes:e.attributes,geometry:(0,x.fromJSON)({...e.geometry,spatialReference:t})})}_createFeatureEditResult(e){const t=!0===e.success?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:t?new(0,l.default)("feature-layer-source:edit-failure",t.description,{code:t.code}):null}}_createAttachmentErrorResult(e,t){const r=t.details.messages&&t.details.messages[0]||t.message,s=t.details.httpStatus||t.details.messageCode;return{objectId:e,globalId:null,error:new(0,l.default)("feature-layer-source:attachment-failure",r,{code:s})}}_getFormDataForAttachment(e,t){const r=e instanceof FormData?e:e&&e.elements?new FormData(e):null;if(r)for(const e in t){const s=t[e];null!=s&&(r.set?r.set(e,s):r.append(e,s))}return r}_getLayerRequestOptions(e={}){const{parsedUrl:t,gdbVersion:r,dynamicDataSource:s}=this.layer;return{...e,query:{gdbVersion:r,layer:s?JSON.stringify({source:s}):void 0,...t.query,f:"json",...this._createRequestQueryOptions(e)},responseType:"json"}}constructor(){super(...arguments),this.type="feature-layer",this.refresh=(0,f.debounce)((async()=>{var e,t;await this.load();const r=null===(e=this.sourceJSON.editingInfo)||void 0===e?void 0:e.lastEditDate;if(null==r)return{dataChanged:!0,updates:{}};try{await this._fetchService(null)}catch{return{dataChanged:!0,updates:{}}}const s=r!==(null===(t=this.sourceJSON.editingInfo)||void 0===t?void 0:t.lastEditDate);return{dataChanged:s,updates:s?{editingInfo:this.sourceJSON.editingInfo,extent:this.sourceJSON.extent}:null}}))}};(0,o._)([(0,g.property)()],j.prototype,"type",void 0),(0,o._)([(0,g.property)({constructOnly:!0})],j.prototype,"layer",void 0),(0,o._)([(0,g.property)({readOnly:!0})],j.prototype,"queryTask",null),j=(0,o._)([(0,F.subclass)("esri.layers.graphics.sources.FeatureLayerSource")],j);const w=j})),t.register("dxhdj",(function(r,s){e(r.exports,"createDrawingInfo",(function(){return u})),e(r.exports,"createDefaultAttributesFunction",(function(){return c})),e(r.exports,"createDefaultTemplate",(function(){return p})),e(r.exports,"createCapabilities",(function(){return y}));var n=t("2VlWd"),o=t("flPLJ"),a=t("aNMpQ"),i=t("2iY9n");function u(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?i.defaultPointSymbolJSON:"esriGeometryPolyline"===e?i.defaultPolylineSymbolJSON:i.defaultPolygonSymbolJSON}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let d=1;function c(e,t){if((0,n.default)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this.${t} = null;`;for(const t in e)r+=`this${l.test(t)?`.${t}`:`["${t}"]`} = ${JSON.stringify(e[t])};`;const s=new Function(`\n      return class AttributesClass$${d++} {\n        constructor() {\n          ${r};\n        }\n      }\n    `)();return()=>new s}catch(r){return()=>({[t]:null,...e})}}function p(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,o.clone)(e)}}]}function y(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0},query:a.queryCapabilities,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}})),t.register("aNMpQ",(function(t,r){e(t.exports,"queryCapabilities",(function(){return s}));const s={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}})),t.register("jABk8",(function(r,s){e(r.exports,"default",(function(){return j}));var n=t("7eJjO"),o=t("kyj08"),a=t("2VlWd"),i=t("7qybv"),u=t("10vEZ"),l=t("iho5X");t("lNwWH"),t("iJAIC");var d=t("fcwIv"),c=t("eSq8i"),p=t("3UMgP"),y=t("eAfIf"),h=t("f4h86"),f=t("cRlei"),m=t("fl6qy"),g=t("8iXHs"),F=t("127at"),b=t("1d1jX"),x=t("eKCA3"),R=t("jUdRy"),S=t("3yEtJ"),O=t("4g04v"),I=t("24qsJ"),v=t("8g8vH"),q=t("hAlVw");let _=class extends q.default{execute(e,t){return this.executeJSON(e,t).then((r=>this.featureSetFromJSON(e,r,t)))}async executeJSON(e,t){var r;const s={...this.requestOptions,...t},n=this._normalizeQuery(e),o=null!=(null===(r=e.outStatistics)||void 0===r?void 0:r[0]),i=(0,a.default)("featurelayer-pbf-statistics"),u=!o||i;let l;if("pbf"===this.format&&u)try{l=await(0,y.executeRawQueryPBF)(this.url,n,s)}catch(e){if("query:parsing-pbf"!==e.name)throw e;this.format="json"}return"json"!==this.format&&u||(l=await(0,p.executeRawQueryJSON)(this.url,n,s)),this._normalizeFields(l.fields),l}async featureSetFromJSON(e,r,s){if(!this._queryIs3DObjectFormat(e)||(0,i.isNone)(this.infoFor3D)||!r.features||!r.features.length)return h.default.fromJSON(r);const{meshFeatureSetFromJSON:n}=await(0,u.whenOrAbort)(t("7YEBf"),s);return n(e,this.infoFor3D,r)}executeForCount(e,t){const r={...this.requestOptions,...t},s=this._normalizeQuery(e);return(0,g.executeForCount)(this.url,s,r)}executeForExtent(e,t){const r={...this.requestOptions,...t},s=this._normalizeQuery(e);return(0,F.executeForExtent)(this.url,s,r)}executeForIds(e,t){const r={...this.requestOptions,...t},s=this._normalizeQuery(e);return(0,b.executeForIds)(this.url,s,r)}executeRelationshipQuery(e,t){e=v.default.from(e);const r={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),(0,x.executeRelationshipQuery)(this.url,e,r)}executeRelationshipQueryForCount(e,t){e=v.default.from(e);const r={...this.requestOptions,...t};return(this.gdbVersion||this.dynamicDataSource)&&((e=e.clone()).gdbVersion=e.gdbVersion||this.gdbVersion,e.dynamicDataSource=e.dynamicDataSource||this.dynamicDataSource),(0,x.executeRelationshipQueryForCount)(this.url,e,r)}executeAttachmentQuery(e,t){const r={...this.requestOptions,...t};return(0,m.executeAttachmentQuery)(this.url,e,r)}executeTopFeaturesQuery(e,t){const r={...this.requestOptions,...t};return(0,R.executeTopFeaturesQuery)(this.parsedUrl,e,this.sourceSpatialReference,r)}executeForTopIds(e,t){const r={...this.requestOptions,...t};return(0,S.executeForTopIds)(this.parsedUrl,e,r)}executeForTopExtents(e,t){const r={...this.requestOptions,...t};return(0,O.executeForTopExtents)(this.parsedUrl,e,r)}executeForTopCount(e,t){const r={...this.requestOptions,...t};return(0,I.executeForTopCount)(this.parsedUrl,e,r)}_normalizeQuery(e){let t=f.default.from(e);if(t.sourceSpatialReference=t.sourceSpatialReference||this.sourceSpatialReference,(this.gdbVersion||this.dynamicDataSource)&&(t=t===e?t.clone():t,t.gdbVersion=e.gdbVersion||this.gdbVersion,t.dynamicDataSource=e.dynamicDataSource?c.DataLayerSource.from(e.dynamicDataSource):this.dynamicDataSource),(0,i.isSome)(this.infoFor3D)&&this._queryIs3DObjectFormat(e)){t=t===e?t.clone():t,t.formatOf3DObjects=null;for(const e of this.infoFor3D.queryFormats){if("3D_glb"===e.id){t.formatOf3DObjects=e.id;break}"3D_gltf"!==e.id||t.formatOf3DObjects||(t.formatOf3DObjects=e.id)}if(!t.formatOf3DObjects)throw new(0,o.default)("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if((0,i.isNone)(t.outFields)||!t.outFields.includes("*")){t=t===e?t.clone():t,(0,i.isNone)(t.outFields)&&(t.outFields=[]);const{originX:r,originY:s,originZ:n,translationX:o,translationY:a,translationZ:u,scaleX:l,scaleY:d,scaleZ:c,rotationX:p,rotationY:y,rotationZ:h,rotationDeg:f}=this.infoFor3D.transformFieldRoles;t.outFields.push(r,s,n,o,a,u,l,d,c,p,y,h,f)}}return t}_normalizeFields(e){if((0,i.isSome)(this.fieldsIndex)&&(0,i.isSome)(e))for(const t of e){const e=this.fieldsIndex.get(t.name);e&&Object.assign(t,e.toJSON())}}_queryIs3DObjectFormat(e){return(0,i.isSome)(this.infoFor3D)&&e.returnGeometry&&"xyFootprint"!==e.multipatchOption&&!e.outStatistics}constructor(e){super(e),this.dynamicDataSource=null,this.fieldsIndex=null,this.format="json",this.gdbVersion=null,this.infoFor3D=null,this.sourceSpatialReference=null}};(0,n._)([(0,l.property)({type:c.DataLayerSource})],_.prototype,"dynamicDataSource",void 0),(0,n._)([(0,l.property)()],_.prototype,"fieldsIndex",void 0),(0,n._)([(0,l.property)()],_.prototype,"format",void 0),(0,n._)([(0,l.property)()],_.prototype,"gdbVersion",void 0),(0,n._)([(0,l.property)()],_.prototype,"infoFor3D",void 0),(0,n._)([(0,l.property)()],_.prototype,"sourceSpatialReference",void 0),_=(0,n._)([(0,d.subclass)("esri.tasks.QueryTask")],_);const j=_})),t.register("eAfIf",(function(r,s){e(r.exports,"executeRawQueryPBF",(function(){return u}));var n=t("dsJ7q"),o=t("gO17t"),a=t("j6c7r"),i=(t("f4h86"),t("cRlei"));async function u(e,t,r){const s=(0,n.parseUrl)(e),u={...r},l=i.default.from(t),d=!l.quantizationParameters,{data:c}=await(0,a.executeQueryPBF)(s,l,new(0,o.JSONFeatureSetParserContext)({sourceSpatialReference:l.sourceSpatialReference,applyTransform:d}),u);return c}})),t.register("gO17t",(function(r,s){e(r.exports,"JSONFeatureSetParserContext",(function(){return h}));var n=t("dMFG2"),o=t("7qybv"),a=t("bRuRM"),i=t("akQYU");function u(e,t){return t}function l(e,t,r,s){switch(r){case 0:return y(e,t+s,0);case 1:return"lowerLeft"===e.originPosition?y(e,t+s,1):function({translate:e,scale:t},r,s){return e[s]-r*t[s]}(e,t+s,1)}}function d(e,t,r,s){return 2===r?y(e,t,2):l(e,t,r,s)}function c(e,t,r,s){return 2===r?y(e,t,3):l(e,t,r,s)}function p(e,t,r,s){return 3===r?y(e,t,3):d(e,t,r,s)}function y({translate:e,scale:t},r,s){return e[s]+r*t[s]}class h{createFeatureResult(){return{fields:[],features:[]}}finishFeatureResult(e){if(this.options.applyTransform&&(e.transform=null),this._attributesConstructor=()=>{},this.coordinateBuffer=null,this.lengths.length=0,!e.hasZ)return;const t=(0,a.getGeometryZScaler)(e.geometryType,this.options.sourceSpatialReference,e.spatialReference);if(!(0,o.isNone)(t))for(const r of e.features)t(r.geometry)}createSpatialReference(){return{}}addField(e,t){e.fields.push(t);const r=e.fields.map((e=>e.name));this._attributesConstructor=function(){for(const e of r)this[e]=null}}addFeature(e,t){e.features.push(t)}prepareFeatures(e){switch(this.transform=e.transform,this.options.applyTransform&&e.transform&&(this.applyTransform=this._deriveApplyTransform(e)),this.vertexDimension=2,e.hasZ&&this.vertexDimension++,e.hasM&&this.vertexDimension++,e.geometryType){case"esriGeometryPoint":this.addCoordinate=(e,t,r)=>this.addCoordinatePoint(e,t,r),this.createGeometry=e=>this.createPointGeometry(e);break;case"esriGeometryPolygon":this.addCoordinate=(e,t,r)=>this._addCoordinatePolygon(e,t,r),this.createGeometry=e=>this._createPolygonGeometry(e);break;case"esriGeometryPolyline":this.addCoordinate=(e,t,r)=>this._addCoordinatePolyline(e,t,r),this.createGeometry=e=>this._createPolylineGeometry(e);break;case"esriGeometryMultipoint":this.addCoordinate=(e,t,r)=>this._addCoordinateMultipoint(e,t,r),this.createGeometry=e=>this._createMultipointGeometry(e);break;default:(0,n.neverReached)(e.geometryType)}}createFeature(){return this.lengths.length=0,this.currentLengthIndex=0,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,{attributes:new this._attributesConstructor}}allocateCoordinates(){}addLength(e,t,r){0===this.lengths.length&&(this.toAddInCurrentPath=t),this.lengths.push(t)}addQueryGeometry(e,t){const{queryGeometry:r,queryGeometryType:s}=t,n=(0,i.unquantizeOptimizedGeometry)(r.clone(),r,!1,!1,this.transform),o=(0,i.convertToGeometry)(n,s,!1,!1);e.queryGeometryType=s,e.queryGeometry={...o}}createPointGeometry(e){const t={x:0,y:0,spatialReference:e.spatialReference};return e.hasZ&&(t.z=0),e.hasM&&(t.m=0),t}addCoordinatePoint(e,t,r){switch(t=this.applyTransform(this.transform,t,r,0),r){case 0:e.x=t;break;case 1:e.y=t;break;case 2:"z"in e?e.z=t:e.m=t;break;case 3:e.m=t}}_transformPathLikeValue(e,t){let r=0;return t<=1&&(r=this.previousCoordinate[t],this.previousCoordinate[t]+=e),this.applyTransform(this.transform,e,t,r)}_addCoordinatePolyline(e,t,r){this._dehydratedAddPointsCoordinate(e.paths,t,r)}_addCoordinatePolygon(e,t,r){this._dehydratedAddPointsCoordinate(e.rings,t,r)}_addCoordinateMultipoint(e,t,r){0===r&&e.points.push([]);const s=this._transformPathLikeValue(t,r);e.points[e.points.length-1].push(s)}_createPolygonGeometry(e){return{rings:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createPolylineGeometry(e){return{paths:[[]],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_createMultipointGeometry(e){return{points:[],spatialReference:e.spatialReference,hasZ:!!e.hasZ,hasM:!!e.hasM}}_dehydratedAddPointsCoordinate(e,t,r){0===r&&0==this.toAddInCurrentPath--&&(e.push([]),this.toAddInCurrentPath=this.lengths[++this.currentLengthIndex]-1,this.previousCoordinate[0]=0,this.previousCoordinate[1]=0);const s=this._transformPathLikeValue(t,r),n=e[e.length-1];0===r&&(this.coordinateBufferPtr=0,this.coordinateBuffer=new Array(this.vertexDimension),n.push(this.coordinateBuffer)),this.coordinateBuffer[this.coordinateBufferPtr++]=s}_deriveApplyTransform(e){const{hasZ:t,hasM:r}=e;return t&&r?p:t?d:r?c:l}constructor(e){this.options=e,this.geometryTypes=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"],this.previousCoordinate=[0,0],this.transform=null,this.applyTransform=u,this.lengths=[],this.currentLengthIndex=0,this.toAddInCurrentPath=0,this.vertexDimension=0,this.coordinateBuffer=null,this.coordinateBufferPtr=0,this._attributesConstructor=()=>{}}}})),t.register("fl6qy",(function(r,s){e(r.exports,"executeAttachmentQuery",(function(){return i}));var n=t("dsJ7q"),o=t("5EgUN"),a=t("lYvo2");async function i(e,t,r){const s=(0,n.parseUrl)(e);return(0,o.executeAttachmentQuery)(s,a.default.from(t),{...r}).then((e=>(0,o.processAttachmentQueryResult)(e.data.attachmentGroups,s.path)))}})),t.register("5EgUN",(function(r,s){e(r.exports,"processAttachmentQueryResult",(function(){return d})),e(r.exports,"executeAttachmentQuery",(function(){return c}));var n=t("dLARP"),o=t("9pNSx"),a=t("kYueh"),i=t("bPDFo"),u=t("crcVj");function l(e){const t=e.toJSON();return t.attachmentTypes&&(t.attachmentTypes=t.attachmentTypes.join(",")),t.keywords&&(t.keywords=t.keywords.join(",")),t.globalIds&&(t.globalIds=t.globalIds.join(",")),t.objectIds&&(t.objectIds=t.objectIds.join(",")),t.size&&(t.size=t.size.join(",")),t}function d(e,t){const r={};for(const s of e){const{parentObjectId:e,parentGlobalId:o,attachmentInfos:i}=s;for(const s of i){const{id:i}=s,l=(0,a.addProxy)((0,n.addTokenParameter)(`${t}/${e}/attachments/${i}`)),d=u.default.fromJSON(s);d.set({url:l,parentObjectId:e,parentGlobalId:o}),r[e]?r[e].push(d):r[e]=[d]}}return r}function c(e,t,r){let s={query:(0,i.mapParameters)({...e.query,f:"json",...l(t)})};return r&&(s={...r,...s,query:{...r.query,...s.query}}),(0,o.default)(e.path+"/queryAttachments",s)}})),t.register("8iXHs",(function(r,s){e(r.exports,"executeForCount",(function(){return i}));var n=t("dsJ7q"),o=t("j6c7r"),a=t("cRlei");async function i(e,t,r){const s=(0,n.parseUrl)(e);return(0,o.executeQueryForCount)(s,a.default.from(t),{...r}).then((e=>e.data.count))}})),t.register("127at",(function(r,s){e(r.exports,"executeForExtent",(function(){return u})),t("2ILM8");var n=t("dsJ7q"),o=t("j6c7r"),a=t("cRlei"),i=t("gINRd");async function u(e,t,r){const s=(0,n.parseUrl)(e);return(0,o.executeQueryForExtent)(s,a.default.from(t),{...r}).then((e=>({count:e.data.count,extent:i.default.fromJSON(e.data.extent)})))}})),t.register("1d1jX",(function(r,s){e(r.exports,"executeForIds",(function(){return i}));var n=t("dsJ7q"),o=t("j6c7r"),a=t("cRlei");async function i(e,t,r){const s=(0,n.parseUrl)(e);return(0,o.executeQueryForIds)(s,a.default.from(t),{...r}).then((e=>e.data.objectIds))}})),t.register("eKCA3",(function(r,s){e(r.exports,"executeRelationshipQuery",(function(){return u})),e(r.exports,"executeRelationshipQueryForCount",(function(){return l}));var n=t("dsJ7q"),o=t("40Ehj"),a=t("f4h86"),i=t("8g8vH");async function u(e,t,r){t=i.default.from(t);const s=(0,n.parseUrl)(e);return(0,o.executeRelationshipQuery)(s,t,r).then((e=>{const t=e.data,r={};return Object.keys(t).forEach((e=>r[e]=a.default.fromJSON(t[e]))),r}))}async function l(e,t,r){t=i.default.from(t);const s=(0,n.parseUrl)(e);return(0,o.executeRelationshipQueryForCount)(s,t,{...r}).then((e=>e.data))}})),t.register("40Ehj",(function(r,s){e(r.exports,"executeRelationshipQuery",(function(){return i})),e(r.exports,"executeRelationshipQueryForCount",(function(){return u}));var n=t("9pNSx"),o=t("bPDFo");function a(e,t){const r=e.toJSON();return r.objectIds&&(r.objectIds=r.objectIds.join(",")),r.orderByFields&&(r.orderByFields=r.orderByFields.join(",")),r.outFields&&!(null==t?void 0:t.returnCountOnly)?r.outFields.includes("*")?r.outFields="*":r.outFields=r.outFields.join(","):delete r.outFields,r.outSpatialReference&&(r.outSR=r.outSR.wkid||JSON.stringify(r.outSR.toJSON()),delete r.outSpatialReference),r.dynamicDataSource&&(r.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r}async function i(e,t,r){const s=await l(e,t,r),n=s.data,o=n.geometryType,a=n.spatialReference,i={};for(const e of n.relatedRecordGroups){const t={fields:void 0,objectIdFieldName:void 0,geometryType:o,spatialReference:a,hasZ:!!n.hasZ,hasM:!!n.hasM,features:e.relatedRecords};if(null!=e.objectId)i[e.objectId]=t;else for(const r in e)e.hasOwnProperty(r)&&"relatedRecords"!==r&&(i[e[r]]=t)}return{...s,data:i}}async function u(e,t,r){const s=await l(e,t,r,{returnCountOnly:!0}),n=s.data,o={};for(const e of n.relatedRecordGroups)null!=e.objectId&&(o[e.objectId]=e.count);return{...s,data:o}}async function l(e,t,r={},s){const i=(0,o.mapParameters)({...e.query,f:"json",...s,...a(t,s)});return(0,n.default)(e.path+"/queryRelatedRecords",{...r,query:{...r.query,...i}})}})),t.register("jUdRy",(function(r,s){e(r.exports,"executeTopFeaturesQuery",(function(){return u}));var n=t("dsJ7q"),o=t("6zkYf"),a=t("f4h86"),i=t("7D30I");async function u(e,t,r,s){const u=(0,n.parseUrl)(e),l={...s},{data:d}=await(0,o.executeTopFeaturesQuery)(u,i.default.from(t),r,l);return a.default.fromJSON(d)}})),t.register("6zkYf",(function(r,s){e(r.exports,"executeTopFeaturesQuery",(function(){return y})),e(r.exports,"executeQueryForTopIds",(function(){return h})),e(r.exports,"executeQueryForTopExtents",(function(){return f})),e(r.exports,"executeQueryForTopCount",(function(){return m}));var n=t("9pNSx"),o=t("7qybv"),a=t("kYueh"),i=t("79LpT"),u=t("5On35"),l=t("bPDFo"),d=t("4JATB");const c="Layer does not support extent calculation.";function p(e,t){var r,s;const n=e.geometry,a=e.toJSON(),u=a;if((0,o.isSome)(n)&&(u.geometry=JSON.stringify(n),u.geometryType=(0,i.getJsonType)(n),u.inSR=n.spatialReference.wkid||JSON.stringify(n.spatialReference)),(null===(r=a.topFilter)||void 0===r?void 0:r.groupByFields)&&(u.topFilter.groupByFields=a.topFilter.groupByFields.join(",")),(null===(s=a.topFilter)||void 0===s?void 0:s.orderByFields)&&(u.topFilter.orderByFields=a.topFilter.orderByFields.join(",")),a.topFilter&&(u.topFilter=JSON.stringify(u.topFilter)),a.objectIds&&(u.objectIds=a.objectIds.join(",")),a.orderByFields&&(u.orderByFields=a.orderByFields.join(",")),a.outFields&&!((null==t?void 0:t.returnCountOnly)||(null==t?void 0:t.returnExtentOnly)||(null==t?void 0:t.returnIdsOnly))?a.outFields.includes("*")?u.outFields="*":u.outFields=a.outFields.join(","):delete u.outFields,a.outSR?u.outSR=a.outSR.wkid||JSON.stringify(a.outSR):n&&a.returnGeometry&&(u.outSR=u.inSR),a.returnGeometry&&delete a.returnGeometry,a.timeExtent){const e=a.timeExtent,{start:t,end:r}=e;null==t&&null==r||(u.time=t===r?t:`${null==t?"null":t},${null==r?"null":r}`),delete a.timeExtent}return u}async function y(e,t,r,s){const n=await g(e,t,"json",s);return(0,d.applyFeatureSetZUnitScaling)(t,r,n.data),n}async function h(e,t,r){return(0,o.isSome)(t.timeExtent)&&t.timeExtent.isEmpty?{data:{objectIds:[]}}:g(e,t,"json",r,{returnIdsOnly:!0})}async function f(e,t,r){return(0,o.isSome)(t.timeExtent)&&t.timeExtent.isEmpty?{data:{count:0,extent:null}}:g(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}).then((e=>{const t=e.data;if(t.hasOwnProperty("extent"))return e;if(t.features)throw new Error(c);if(t.hasOwnProperty("count"))throw new Error(c);return e}))}function m(e,t,r){return(0,o.isSome)(t.timeExtent)&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):g(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0})}function g(e,t,r,s={},i={}){const d="string"==typeof e?(0,a.urlToObject)(e):e,c=t.geometry?[t.geometry]:[];return s.responseType="pbf"===r?"array-buffer":"json",(0,u.normalizeCentralMeridian)(c,null,s).then((e=>{const u=e&&e[0];(0,o.isSome)(u)&&((t=t.clone()).geometry=u);const c=(0,l.mapParameters)({...d.query,f:r,...i,...p(t,i)});return(0,n.default)((0,a.join)(d.path,"queryTopFeatures"),{...s,query:{...c,...s.query}})}))}})),t.register("3yEtJ",(function(r,s){e(r.exports,"executeForTopIds",(function(){return i}));var n=t("dsJ7q"),o=t("6zkYf"),a=t("7D30I");async function i(e,t,r){const s=(0,n.parseUrl)(e);return(await(0,o.executeQueryForTopIds)(s,a.default.from(t),{...r})).data.objectIds}})),t.register("4g04v",(function(r,s){e(r.exports,"executeForTopExtents",(function(){return u})),t("2ILM8");var n=t("dsJ7q"),o=t("6zkYf"),a=t("7D30I"),i=t("gINRd");async function u(e,t,r){const s=(0,n.parseUrl)(e),u=await(0,o.executeQueryForTopExtents)(s,a.default.from(t),{...r});return{count:u.data.count,extent:i.default.fromJSON(u.data.extent)}}})),t.register("24qsJ",(function(r,s){e(r.exports,"executeForTopCount",(function(){return i}));var n=t("dsJ7q"),o=t("6zkYf"),a=t("7D30I");async function i(e,t,r){const s=(0,n.parseUrl)(e);return(await(0,o.executeQueryForTopCount)(s,a.default.from(t),{...r})).data.count}})),t.register("hAlVw",(function(r,s){e(r.exports,"default",(function(){return d}));var n=t("7eJjO"),o=t("jymfC"),a=t("kYueh"),i=t("iho5X");t("lNwWH"),t("2VlWd"),t("iJAIC");var u=t("fcwIv");let l=class extends o.default{normalizeCtorArgs(e,t){return"string"!=typeof e?e:{url:e,...t}}get parsedUrl(){return this._parseUrl(this.url)}_parseUrl(e){return e?(0,a.urlToObject)(e):null}_encode(e,t,r){const s={};for(const n in e){if("declaredClass"===n)continue;const o=e[n];if(null!=o&&"function"!=typeof o)if(Array.isArray(o)){s[n]=[];for(let e=0;e<o.length;e++)s[n][e]=this._encode(o[e])}else if("object"==typeof o)if(o.toJSON){const e=o.toJSON(r&&r[n]);s[n]=t?e:JSON.stringify(e)}else s[n]=t?o:JSON.stringify(o);else s[n]=o}return s}constructor(...e){super(...e),this.requestOptions=null,this.url=null}};(0,n._)([(0,i.property)({readOnly:!0})],l.prototype,"parsedUrl",null),(0,n._)([(0,i.property)()],l.prototype,"requestOptions",void 0),(0,n._)([(0,i.property)({type:String})],l.prototype,"url",void 0),l=(0,n._)([(0,u.subclass)("esri.tasks.Task")],l);const d=l})),t.register("7YEBf",(function(e,r){e.exports=Promise.all([t("4WKyX")(t("aNJCr").getBundleURL("9NcSU")+t("iE7OH").resolve("jO4My")),t("4WKyX")(t("aNJCr").getBundleURL("9NcSU")+t("iE7OH").resolve("39f1r")),t("4WKyX")(t("aNJCr").getBundleURL("9NcSU")+t("iE7OH").resolve("c0ZBe"))]).then((()=>t("3EzsP")))}))}();
//# sourceMappingURL=FeatureLayerSource.c00e1fd5.js.map
