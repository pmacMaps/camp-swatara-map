!function(){var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;e.register("5NlMV",(function(t,n){var r,a,i,l;r=t.exports,a="registerFunctions",i=function(){return O},Object.defineProperty(r,a,{get:i,set:l,enumerable:!0,configurable:!0});var s=e("iwIpP"),o=e("3UOnP"),u=e("3TgtC"),f=e("jvSuk"),c=e("c4SkA"),d=e("1xq6U"),p=e("4aVVd"),m=e("e8oaX"),y=e("jeRSU"),g=e("fJC97"),h=e("k1hID"),w=e("6ILB7"),F=e("cHwtI"),E=e("2ANni"),I=e("aZgek"),S=e("9yzf5"),A=e("jA3R1"),b=e("hRH8E"),D=e("10vEZ"),x=e("9AqbE"),N=e("g15Jq"),C=e("buMuJ");async function T(e,t,n){const r=e.getVariables();if(r.length>0){const a=[];for(let e=0;e<r.length;e++){const i={name:r[e]};a.push(await t.evaluateIdentifier(n,i))}const i={};for(let e=0;e<r.length;e++)i[r[e]]=a[e];return e.parameters=i,e}return e}function $(e,t,n=null){for(const n in e)if(n.toLowerCase()===t.toLowerCase())return e[n];return n}function v(e){if(null===e)return null;const t={type:$(e,"type",""),name:$(e,"name","")};if("range"===t.type)t.range=$(e,"range",[]);else{t.codedValues=[];for(const n of $(e,"codedValues",[]))t.codedValues.push({name:$(n,"name",""),code:$(n,"code",null)})}return t}function L(e){if(null===e)return null;const t={},n=$(e,"wkt",null);null!==n&&(t.wkt=n);const r=$(e,"wkid",null);return null!==r&&(t.wkid=r),t}function R(e){if(null===e)return null;const t={hasZ:$(e,"hasz",!1),hasM:$(e,"hasm",!1)},n=$(e,"spatialreference",null);n&&(t.spatialReference=L(n));const r=$(e,"x",null);if(null!==r)return t.x=r,t.y=$(e,"y",null),t;const a=$(e,"rings",null);if(null!==a)return t.rings=a,t;const i=$(e,"paths",null);if(null!==i)return t.paths=i,t;const l=$(e,"points",null);if(null!==l)return t.points=l,t;for(const n of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const r=$(e,n,null);null!==r&&(t[n]=r)}return t}function O(e){"async"===e.mode&&(e.functions.getuser=function(t,n){return e.standardFunctionAsync(t,n,(async(e,n,r)=>{(0,m.p)(r,1,2);let a=(0,m.C)(r[1],""),i=!0===a;if(a=!0===a||!1===a?"":(0,m.h)(a),r[0]instanceof s.default){let e=null;t.services&&t.services.portal&&(e=t.services.portal),e=(0,c.getPortal)(r[0],e);const n=await(0,c.lookupUser)(e,a,i);if(n){const e=JSON.parse(JSON.stringify(n));for(const t of["lastLogin","created","modified"])void 0!==e[t]&&null!==e[t]&&(e[t]=new Date(e[t]));return o.default.convertObjectToArcadeDictionary(e)}return null}let l=null;if((0,m.y)(r[0])&&(l=r[0]),l){if(i=!1,a)return null;await l.load();const e=await l.getOwningSystemUrl();if(!e){if(!a){const e=await l.getIdentityUser();return e?o.default.convertObjectToArcadeDictionary({username:e}):null}return null}let n=null;t.services&&t.services.portal&&(n=t.services.portal),n=(0,c.getPortal)(new(0,s.default)(e),n);const r=await(0,c.lookupUser)(n,a,i);if(r){const e=JSON.parse(JSON.stringify(r));for(const t of["lastLogin","created","modified"])void 0!==e[t]&&null!==e[t]&&(e[t]=new Date(e[t]));return o.default.convertObjectToArcadeDictionary(e)}return null}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getuser",min:"1",max:"2"}),e.functions.featuresetbyid=function(t,n){return e.standardFunctionAsync(t,n,((e,t,n)=>{if((0,m.p)(n,2,4),n[0]instanceof f.default){const e=(0,m.h)(n[1]);let t=(0,m.C)(n[2],null);const r=(0,m.g)((0,m.C)(n[3],!0));if(null===t&&(t=["*"]),!1===(0,m.l)(t))throw new Error("Invalid Parameter");return n[0].featureSetById(e,r,t)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.getfeatureset=function(t,n){return e.standardFunctionAsync(t,n,((e,n,r)=>{if((0,m.p)(r,1,2),(0,m.s)(r[0])){let e=(0,m.C)(r[1],"datasource");return null===e&&(e="datasource"),e=(0,m.h)(e).toLowerCase(),(0,c.convertToFeatureSet)(r[0].fullSchema(),e,t.lrucache,t.interceptor,t.spatialReference)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getfeatureset",min:"1",max:"2"}),e.functions.featuresetbyportalitem=function(t,n){return e.standardFunctionAsync(t,n,((e,n,r)=>{if((0,m.p)(r,2,5),null===r[0])throw new Error("Portal is required");if(r[0]instanceof s.default){const e=(0,m.h)(r[1]),n=(0,m.h)(r[2]);let a=(0,m.C)(r[3],null);const i=(0,m.g)((0,m.C)(r[4],!0));if(null===a&&(a=["*"]),!1===(0,m.l)(a))throw new Error("Invalid Parameter");let l=null;return t.services&&t.services.portal&&(l=t.services.portal),l=(0,c.getPortal)(r[0],l),(0,c.constructFeatureSetFromPortalItem)(e,n,t.spatialReference,a,i,l,t.lrucache,t.interceptor)}if(!1===(0,m.b)(r[0]))throw new Error("Portal is required");const a=(0,m.h)(r[0]),i=(0,m.h)(r[1]);let l=(0,m.C)(r[2],null);const o=(0,m.g)((0,m.C)(r[3],!0));if(null===l&&(l=["*"]),!1===(0,m.l)(l))throw new Error("Invalid Parameter");if(t.services&&t.services.portal)return(0,c.constructFeatureSetFromPortalItem)(a,i,t.spatialReference,l,o,t.services.portal,t.lrucache,t.interceptor);throw new Error("Portal is required")}))},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),e.functions.featuresetbyname=function(t,n){return e.standardFunctionAsync(t,n,((e,t,n)=>{if((0,m.p)(n,2,4),n[0]instanceof f.default){const e=(0,m.h)(n[1]);let t=(0,m.C)(n[2],null);const r=(0,m.g)((0,m.C)(n[3],!0));if(null===t&&(t=["*"]),!1===(0,m.l)(t))throw new Error("Invalid Parameter");return n[0].featureSetByName(e,r,t)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(t,n){return e.standardFunction(t,n,((e,n,r)=>{(0,m.p)(r,1,1);let a=r[0];const i={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,m.b)(a))a=JSON.parse(a),void 0!==a.layerDefinition?(i.layerDefinition=a.layerDefinition,i.featureSet=a.featureSet,a.layerDefinition.spatialReference&&(i.layerDefinition.spatialReference=a.layerDefinition.spatialReference)):(i.featureSet.features=a.features,i.featureSet.geometryType=a.geometryType,i.layerDefinition.geometryType=i.featureSet.geometryType,i.layerDefinition.objectIdField=a.objectIdFieldName,i.layerDefinition.typeIdField=a.typeIdFieldName,i.layerDefinition.globalIdField=a.globalIdFieldName,i.layerDefinition.fields=a.fields,a.spatialReference&&(i.layerDefinition.spatialReference=a.spatialReference));else{if(!(r[0]instanceof o.default))throw new Error("Invalid Parameter");{a=JSON.parse(r[0].castToText());const e=$(a,"layerdefinition");if(null!==e){i.layerDefinition.geometryType=$(e,"geometrytype",""),i.featureSet.geometryType=i.layerDefinition.geometryType,i.layerDefinition.globalIdField=$(e,"globalidfield",""),i.layerDefinition.objectIdField=$(e,"objectidfield",""),i.layerDefinition.typeIdField=$(e,"typeidfield","");const t=$(e,"spatialreference",null);t&&(i.layerDefinition.spatialReference=L(t));for(const t of $(e,"fields",[])){const e={name:$(t,"name",""),alias:$(t,"alias",""),type:$(t,"type",""),nullable:$(t,"nullable",!0),editable:$(t,"editable",!0),length:$(t,"length",null),domain:v($(t,"domain"))};i.layerDefinition.fields.push(e)}const n=$(a,"featureset",null);if(n){const e={};for(const t of i.layerDefinition.fields)e[t.name.toLowerCase()]=t.name;for(const t of $(n,"features",[])){const n={},r=$(t,"attributes",{});for(const t in r)n[e[t.toLowerCase()]]=r[t];i.featureSet.features.push({attributes:n,geometry:R($(t,"geometry",null))})}}}else{i.layerDefinition.geometryType=$(a,"geometrytype",""),i.featureSet.geometryType=i.layerDefinition.geometryType,i.layerDefinition.objectIdField=$(a,"objectidfieldname",""),i.layerDefinition.typeIdField=$(a,"typeidfieldname","");const e=$(a,"spatialreference",null);e&&(i.layerDefinition.spatialReference=L(e));for(const e of $(a,"fields",[])){const t={name:$(e,"name",""),alias:$(e,"alias",""),type:$(e,"type",""),nullable:$(e,"nullable",!0),editable:$(e,"editable",!0),length:$(e,"length",null),domain:v($(e,"domain"))};i.layerDefinition.fields.push(t)}const t={};for(const e of i.layerDefinition.fields)t[e.name.toLowerCase()]=e.name;for(const e of $(a,"features",[])){const n={},r=$(e,"attributes",{});for(const e in r)n[t[e.toLowerCase()]]=r[e];i.featureSet.features.push({attributes:n,geometry:R($(e,"geometry",null))})}}}}if(!1===function(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,t){for(const n of t)if(n===e)return!0;return!1}(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==(0,m.l)(e.layerDefinition.fields)&&!1!==(0,m.l)(e.featureSet.features)}(i))throw new Error("Invalid Parameter");return E.default.create(i,t.spatialReference)}))},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(t,n){return e.standardFunctionAsync(t,n,(async(n,r,a)=>{if((0,m.p)(a,2,2),(0,m.l)(a[0])||(0,m.n)(a[0])){const n=[];let r=a[0];r instanceof p.default&&(r=r.toArray());let i=null;if(a[1]instanceof d.default)i=e.arcadeCustomFunctionHandler(a[1]);else if(a[1]instanceof m.N)i=(...e)=>a[1].fn(t,{preparsed:!0,arguments:e});else{if(!(a[1]instanceof m.S))throw new Error("Invalid Parameter");i=(...e)=>{if(e.length!==a[1].paramCount)throw new Error("Invalid parameters");return a[1].fn(...e)}}for(const e of r){const t=i(e);(0,D.isPromiseLike)(t)?!0===await t&&n.push(e):!0===t&&n.push(e)}return n}if((0,m.y)(a[0])){const n=await a[0].load(),r=x.WhereClause.create(a[1],n.getFieldsIndex()),i=r.getVariables();if(i.length>0){const n=[];for(let r=0;r<i.length;r++){const a={name:i[r]};n.push(await e.evaluateIdentifier(t,a))}const l={};for(let e=0;e<i.length;e++)l[i[e]]=n[e];return r.parameters=l,new(0,g.default)({parentfeatureset:a[0],whereclause:r})}return new(0,g.default)({parentfeatureset:a[0],whereclause:r})}throw new Error("Filter cannot accept this parameter type")}))},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(t,n){return e.standardFunctionAsync(t,n,(async(e,t,n)=>{if((0,m.p)(n,2,2),(0,m.y)(n[0])){const e=new(0,I.default)(n[1]);return new(0,h.default)({parentfeatureset:n[0],orderbyclause:e})}throw new Error("Order cannot accept this parameter type")}))},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(t,n){return e.standardFunctionAsync(t,n,(async(e,t,n)=>{if((0,m.p)(n,2,2),(0,m.y)(n[0]))return new(0,w.default)({parentfeatureset:n[0],topnum:n[1]});if((0,m.l)(n[0]))return(0,m.f)(n[1])>=n[0].length?n[0].slice(0):n[0].slice(0,(0,m.f)(n[1]));if((0,m.n)(n[0]))return(0,m.f)(n[1])>=n[0].length()?n[0].slice(0):n[0].slice(0,(0,m.f)(n[1]));throw new Error("Top cannot accept this parameter type")}))},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(t,n){return e.standardFunctionAsync(t,n,(async(e,t,n)=>{if((0,m.p)(n,1,1),(0,m.y)(n[0])){const t=await n[0].first(e.abortSignal);if(null!==t){const e=u.default.createFromGraphicLikeObject(t.geometry,t.attributes,n[0]);return e._underlyingGraphic=t,e}return t}return(0,m.l)(n[0])?0===n[0].length?null:n[0][0]:(0,m.n)(n[0])?0===n[0].length()?null:n[0].get(0):null}))},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(t,n){return e.standardFunctionAsync(t,n,(async(e,n,r)=>{(0,m.p)(r,1,2);const a={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(r.length>1)if(r[1]instanceof o.default){if(r[1].hasField("minsize")&&(a.minsize=(0,m.f)(r[1].field("minsize"))),r[1].hasField("metadata")&&(a.returnMetadata=(0,m.g)(r[1].field("metadata"))),r[1].hasField("maxsize")&&(a.maxsize=(0,m.f)(r[1].field("maxsize"))),r[1].hasField("types")){const e=(0,m.Y)(r[1].field("types"),!1);e.length>0&&(a.types=e)}}else if(null!==r[1])throw new Error("Invalid Parameter");if((0,m.s)(r[0])){let e=r[0]._layer;return e instanceof N.default&&(e=(0,c.constructFeatureSet)(e,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===e||!1===(0,m.y)(e)?[]:(await e.load(),e.queryAttachments(r[0].field(e.objectIdField),a.minsize,a.maxsize,a.types,a.returnMetadata))}if(null===r[0])return[];throw new Error("Invalid Parameter")}))},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationshipname=function(t,n){return e.standardFunctionAsync(t,n,(async(e,n,r)=>{(0,m.p)(r,2,4);const a=r[0],i=(0,m.h)(r[1]);let l=(0,m.C)(r[2],null);const s=(0,m.g)((0,m.C)(r[3],!0));if(null===l&&(l=["*"]),!1===(0,m.l)(l))throw new Error("Invalid Parameter");if(null===r[0])return null;if(!(0,m.s)(r[0]))throw new Error("Invalid Parameter");let o=a._layer;if(o instanceof N.default&&(o=(0,c.constructFeatureSet)(o,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===o)return null;if(!1===(0,m.y)(o))return null;o=await o.load();const u=o.relationshipMetaData().filter((e=>e.name===i));if(0===u.length)return null;if(void 0!==u[0].relationshipTableId&&null!==u[0].relationshipTableId&&u[0].relationshipTableId>-1)return(0,c.constructFeatureSetFromRelationship)(o,u[0],a.field(o.objectIdField),o.spatialReference,l,s,t.lrucache,t.interceptor);let f=o.serviceUrl();if(!f)return null;f="/"===f.charAt(f.length-1)?f+u[0].relatedTableId.toString():f+"/"+u[0].relatedTableId.toString();const d=await(0,c.constructFeatureSetFromUrl)(f,o.spatialReference,l,s,t.lrucache,t.interceptor);await d.load();let p=d.relationshipMetaData();if(p=p.filter((e=>e.id===u[0].id)),!1===a.hasField(u[0].keyField)||null===a.field(u[0].keyField)){const e=await o.getFeatureByObjectId(a.field(o.objectIdField),[u[0].keyField]);if(e){const t=x.WhereClause.create(p[0].keyField+"= @id",d.getFieldsIndex());return t.parameters={id:e.attributes[u[0].keyField]},d.filter(t)}return new(0,F.default)({parentfeatureset:d})}const y=x.WhereClause.create(p[0].keyField+"= @id",d.getFieldsIndex());return y.parameters={id:a.field(u[0].keyField)},d.filter(y)}))},e.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),e.functions.featuresetbyassociation=function(t,n){return e.standardFunctionAsync(t,n,(async(e,n,r)=>{(0,m.p)(r,2,3);const a=r[0],i=(0,m.h)((0,m.C)(r[1],"")).toLowerCase(),l=(0,m.b)(r[2])?(0,m.h)(r[2]):null;if(null===r[0])return null;if(!(0,m.s)(r[0]))throw new Error("Invalid Parameter");let s=a._layer;if(s instanceof N.default&&(s=(0,c.constructFeatureSet)(s,t.spatialReference,["*"],!0,t.lrucache,t.interceptor)),null===s)return null;if(!1===(0,m.y)(s))return null;await s.load();const o=s.serviceUrl(),u=await(0,c.constructAssociationMetaDataFeatureSetFromUrl)(o,t.spatialReference);let f=null,d=null,p=!1;if(null!==l&&""!==l&&void 0!==l){for(const e of u.terminals)e.terminalName===l&&(d=e.terminalId);null===d&&(p=!0)}const g=u.associations.getFieldsIndex(),h=g.get("TOGLOBALID").name,w=g.get("FROMGLOBALID").name,F=g.get("TOTERMINALID").name,E=g.get("FROMTERMINALID").name,I=g.get("FROMNETWORKSOURCEID").name,A=g.get("TONETWORKSOURCEID").name,b=g.get("ASSOCIATIONTYPE").name,D=g.get("ISCONTENTVISIBLE").name,T=g.get("OBJECTID").name;for(const e of s.fields)if("global-id"===e.type){f=a.field(e.name);break}let $=null,v=new(0,y.SqlExpressionAdapted)(new(0,C.default)({name:"percentalong",alias:"percentalong",type:"double"}),x.WhereClause.create("0",u.associations.getFieldsIndex())),L=new(0,y.SqlExpressionAdapted)(new(0,C.default)({name:"side",alias:"side",type:"string"}),x.WhereClause.create("''",u.associations.getFieldsIndex()));const R="globalid",O="globalId",P={};for(const e in u.lkp)P[e]=u.lkp[e].sourceId;const M=new(0,y.StringToCodeAdapted)(new(0,C.default)({name:"classname",alias:"classname",type:"string"}),null,P);let k="";switch(i){case"midspan":{k=`((${h}='${f}') OR ( ${w}='${f}')) AND (${b} IN (5))`,M.codefield=x.WhereClause.create(`CASE WHEN (${h}='${f}') THEN ${I} ELSE ${A} END`,u.associations.getFieldsIndex());const e=(0,S.cloneField)(y.AdaptedFeatureSet.findField(u.associations.fields,w));e.name=R,e.alias=R,$=new(0,y.SqlExpressionAdapted)(e,x.WhereClause.create(`CASE WHEN (${w}='${f}') THEN ${h} ELSE ${w} END`,u.associations.getFieldsIndex())),v=u.unVersion>=4?new(0,y.OriginalField)(y.AdaptedFeatureSet.findField(u.associations.fields,g.get("PERCENTALONG").name)):new(0,y.SqlExpressionAdapted)(new(0,C.default)({name:"percentalong",alias:"percentalong",type:"double"}),x.WhereClause.create("0",u.associations.getFieldsIndex()));break}case"junctionedge":{k=`((${h}='${f}') OR ( ${w}='${f}')) AND (${b} IN (4,6))`,M.codefield=x.WhereClause.create(`CASE WHEN (${h}='${f}') THEN ${I} ELSE ${A} END`,u.associations.getFieldsIndex());const e=(0,S.cloneField)(y.AdaptedFeatureSet.findField(u.associations.fields,w));e.name=R,e.alias=R,$=new(0,y.SqlExpressionAdapted)(e,x.WhereClause.create(`CASE WHEN (${w}='${f}') THEN ${h} ELSE ${w} END`,u.associations.getFieldsIndex())),L=new(0,y.SqlExpressionAdapted)(new(0,C.default)({name:"side",alias:"side",type:"string"}),x.WhereClause.create(`CASE WHEN (${b}=4) THEN 'from' ELSE 'to' END`,u.associations.getFieldsIndex()));break}case"connected":{let e=`${h}='@T'`,t=`${w}='@T'`;null!==d&&(e+=` AND ${F}=@A`,t+=` AND ${E}=@A`),k="(("+e+") OR ("+t+"))",k=(0,m.M)(k,"@T",f),e=(0,m.M)(e,"@T",f),null!==d&&(e=(0,m.M)(e,"@A",d.toString()),k=(0,m.M)(k,"@A",d.toString())),M.codefield=x.WhereClause.create("CASE WHEN "+e+` THEN ${I} ELSE ${A} END`,u.associations.getFieldsIndex());const n=(0,S.cloneField)(y.AdaptedFeatureSet.findField(u.associations.fields,w));n.name=R,n.alias=R,$=new(0,y.SqlExpressionAdapted)(n,x.WhereClause.create("CASE WHEN "+e+` THEN ${w} ELSE ${h} END`,u.associations.getFieldsIndex()));break}case"container":k=`${h}='${f}' AND ${b} = 2`,null!==d&&(k+=` AND ${F} = `+d.toString()),M.codefield=I,k="( "+k+" )",$=new(0,y.FieldRename)(y.AdaptedFeatureSet.findField(u.associations.fields,w),R,R);case"content":k=`(${w}='${f}' AND ${b} = 2)`,null!==d&&(k+=` AND ${E} = `+d.toString()),M.codefield=A,k="( "+k+" )",$=new(0,y.FieldRename)(y.AdaptedFeatureSet.findField(u.associations.fields,h),R,R);break;case"structure":k=`(${h}='${f}' AND ${b} = 3)`,null!==d&&(k+=` AND ${F} = `+d.toString()),M.codefield=I,k="( "+k+" )",$=new(0,y.FieldRename)(y.AdaptedFeatureSet.findField(u.associations.fields,w),R,O);break;case"attached":k=`(${w}='${f}' AND ${b} = 3)`,null!==d&&(k+=` AND ${E} = `+d.toString()),M.codefield=A,k="( "+k+" )",$=new(0,y.FieldRename)(y.AdaptedFeatureSet.findField(u.associations.fields,h),R,O);break;default:throw new Error("Invalid Parameter")}return p&&(k="1 <> 1"),new(0,y.AdaptedFeatureSet)({parentfeatureset:u.associations,adaptedFields:[new(0,y.OriginalField)(y.AdaptedFeatureSet.findField(u.associations.fields,T)),new(0,y.OriginalField)(y.AdaptedFeatureSet.findField(u.associations.fields,D)),$,L,M,v],extraFilter:k?x.WhereClause.create(k,u.associations.getFieldsIndex()):null})}))},e.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),e.functions.groupby=function(t,n){return e.standardFunctionAsync(t,n,(async(n,r,a)=>{if((0,m.p)(a,3,3),!(0,m.y)(a[0]))throw new Error("Illegal Value: GroupBy");const i=await a[0].load(),l=[],s=[];let u=!1,f=[];if((0,m.b)(a[1]))f.push(a[1]);else if(a[1]instanceof o.default)f.push(a[1]);else if((0,m.l)(a[1]))f=a[1];else{if(!(0,m.n)(a[1]))throw new Error("Illegal Value: GroupBy");f=a[1].toArray()}for(const e of f)if((0,m.b)(e)){const t=x.WhereClause.create((0,m.h)(e),i.getFieldsIndex()),n=!0===(0,A.isSingleField)(t)?(0,m.h)(e):"%%%%FIELDNAME";l.push({name:n,expression:t}),"%%%%FIELDNAME"===n&&(u=!0)}else{if(!(e instanceof o.default))throw new Error("Illegal Value: GroupBy");{const t=e.hasField("name")?e.field("name"):"%%%%FIELDNAME",n=e.hasField("expression")?e.field("expression"):"";if("%%%%FIELDNAME"===t&&(u=!0),!t)throw new Error("Illegal Value: GroupBy");l.push({name:t,expression:x.WhereClause.create(n||t,i.getFieldsIndex())})}}if(f=[],(0,m.b)(a[2]))f.push(a[2]);else if((0,m.l)(a[2]))f=a[2];else if((0,m.n)(a[2]))f=a[2].toArray();else{if(!(a[2]instanceof o.default))throw new Error("Illegal Value: GroupBy");f.push(a[2])}for(const e of f){if(!(e instanceof o.default))throw new Error("Illegal Value: GroupBy");{const t=e.hasField("name")?e.field("name"):"",n=e.hasField("statistic")?e.field("statistic"):"",r=e.hasField("expression")?e.field("expression"):"";if(!t||!n||!r)throw new Error("Illegal Value: GroupBy");s.push({name:t,statistic:n.toLowerCase(),expression:x.WhereClause.create(r,i.getFieldsIndex())})}}if(u){const e={};for(const t of i.fields)e[t.name.toLowerCase()]=1;for(const t of l)"%%%%FIELDNAME"!==t.name&&(e[t.name.toLowerCase()]=1);for(const t of s)"%%%%FIELDNAME"!==t.name&&(e[t.name.toLowerCase()]=1);let t=0;for(const n of l)if("%%%%FIELDNAME"===n.name){for(;1===e["field_"+t.toString()];)t++;e["field_"+t.toString()]=1,n.name="FIELD_"+t.toString()}}for(const n of l)await T(n.expression,e,t);for(const n of s)await T(n.expression,e,t);return a[0].groupby(l,s)}))},e.signatures.push({name:"groupby",min:"3",max:"3"}),e.functions.distinct=function(t,n){return e.standardFunctionAsync(t,n,(async(n,r,a)=>{if((0,m.y)(a[0])){(0,m.p)(a,2,2);const n=await a[0].load(),r=[];let i=[];if((0,m.b)(a[1]))i.push(a[1]);else if(a[1]instanceof o.default)i.push(a[1]);else if((0,m.l)(a[1]))i=a[1];else{if(!(0,m.n)(a[1]))throw new Error("Illegal Value: GroupBy");i=a[1].toArray()}let l=!1;for(const e of i)if((0,m.b)(e)){const t=x.WhereClause.create((0,m.h)(e),n.getFieldsIndex()),a=!0===(0,A.isSingleField)(t)?(0,m.h)(e):"%%%%FIELDNAME";r.push({name:a,expression:t}),"%%%%FIELDNAME"===a&&(l=!0)}else{if(!(e instanceof o.default))throw new Error("Illegal Value: GroupBy");{const t=e.hasField("name")?e.field("name"):"%%%%FIELDNAME",a=e.hasField("expression")?e.field("expression"):"";if("%%%%FIELDNAME"===t&&(l=!0),!t)throw new Error("Illegal Value: GroupBy");r.push({name:t,expression:x.WhereClause.create(a||t,n.getFieldsIndex())})}}if(l){const e={};for(const t of n.fields)e[t.name.toLowerCase()]=1;for(const t of r)"%%%%FIELDNAME"!==t.name&&(e[t.name.toLowerCase()]=1);let t=0;for(const n of r)if("%%%%FIELDNAME"===n.name){for(;1===e["field_"+t.toString()];)t++;e["field_"+t.toString()]=1,n.name="FIELD_"+t.toString()}}for(const n of r)await T(n.expression,e,t);return a[0].groupby(r,[])}return function(e,t,n,r){if(1===r.length){if((0,m.l)(r[0]))return(0,b.calculateStat)(e,r[0],-1);if((0,m.n)(r[0]))return(0,b.calculateStat)(e,r[0].toArray(),-1)}return(0,b.calculateStat)(e,r,-1)}("distinct",0,0,a)}))})}}))}();
//# sourceMappingURL=featuresetbase.78184fe3.js.map
