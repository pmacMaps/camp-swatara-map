!function(){function e(e,a,r,i){Object.defineProperty(e,a,{get:r,set:i,enumerable:!0,configurable:!0})}var a=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;a.register("fO9V6",(function(r,i){e(r.exports,"viewScaleRE",(function(){return b})),e(r.exports,"getColor",(function(){return m})),e(r.exports,"getOpacity",(function(){return h})),e(r.exports,"getRotationAngle",(function(){return V})),e(r.exports,"getSize",(function(){return y})),e(r.exports,"getSizeForValue",(function(){return S})),e(r.exports,"getSizeFromNumberOrVariable",(function(){return x})),e(r.exports,"getSizeRangeAtScale",(function(){return w})),e(r.exports,"getVisualVariableValues",(function(){return T})),e(r.exports,"getAllSizes",(function(){return F}));var n=a("8TSCy"),t=a("jgs9n"),s=a("bsvXr"),l=a("dMFG2"),o=a("jHOLN"),u=a("7qybv"),c=a("2JxK9"),f=a("1OaQa"),p=o.default.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),d=new(0,s.default),v=Math.PI,b=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function m(e,a,r){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((function(e){return"color"===e.type})):e;if(i)if("esri.renderers.visualVariables.ColorVariable"===i.declaredClass){var n="number"==typeof a,s=n?null:a,l=s&&s.attributes,o=n?a:null,c=i.field,f=i.cache,d=f.ipData,v=f.hasExpression,b=i.cache.compiledFunc;if(!c&&!v){var m=i.stops;return m&&m[0]&&m[0].color}if("number"!=typeof o)if(v){if(!(0,u.isSome)(r)||!(0,u.isSome)(r.arcade))return void p.error("Use of arcade expressions requires an arcade context");var h={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},V=r.arcade.arcadeUtils,y=V.getViewInfo(h),x=V.createExecContext(s,y);if(!b){var g=V.createSyntaxTree(i.valueExpression);b=V.createFunction(g),i.cache.compiledFunc=b}o=V.executeFunction(b,x)}else l&&(o=l[c]);var S=i.normalizationField,w=l?parseFloat(l[S]):void 0;if(null!=o&&(!S||n||!isNaN(w)&&0!==w)){isNaN(w)||n||(o/=w);var T=z(o,d);if(T){var F=T[0],N=T[1],M=F===N?i.stops[F].color:t.default.blendColors(i.stops[F].color,i.stops[N].color,T[2],(0,u.isSome)(r)?r.color:void 0);return new(0,t.default)(M)}}}else p.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable")}function h(e,a,r){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((function(e){return"opacity"===e.type})):e;if(i)if("esri.renderers.visualVariables.OpacityVariable"===i.declaredClass){var n="number"==typeof a,t=n?null:a,s=t&&t.attributes,l=n?a:null,o=i.field,c=i.cache,f=c.ipData,d=c.hasExpression,v=i.cache.compiledFunc;if(!o&&!d){var b=i.stops;return b&&b[0]&&b[0].opacity}if("number"!=typeof l)if(d){if((0,u.isNone)(r)||(0,u.isNone)(r.arcade))return void p.error("Use of arcade expressions requires an arcade context");var m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},h=r.arcade.arcadeUtils,V=h.getViewInfo(m),y=h.createExecContext(t,V);if(!v){var x=h.createSyntaxTree(i.valueExpression);v=h.createFunction(x),i.cache.compiledFunc=v}l=h.executeFunction(v,y)}else s&&(l=s[o]);var g=i.normalizationField,S=s?parseFloat(s[g]):void 0;if(null!=l&&(!g||n||!isNaN(S)&&0!==S)){isNaN(S)||n||(l/=S);var w=z(l,f);if(w){var T=w[0],F=w[1];if(T===F)return i.stops[T].opacity;var N=i.stops[T].opacity;return N+(i.stops[F].opacity-N)*w[2]}}}else p.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable")}function V(e,a,r){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((function(e){return"rotation"===e.type})):e;if(i){if("esri.renderers.visualVariables.RotationVariable"===i.declaredClass){var n=i.axis||"heading",t="heading"===n&&"arithmetic"===i.rotationType?90:0,s="heading"===n&&"arithmetic"===i.rotationType?-1:1,l="number"==typeof a?null:a,o=l&&l.attributes,c=i.field,f=i.cache.hasExpression,d=i.cache.compiledFunc,v=0;if(!c&&!f)return v;if(f){if((0,u.isNone)(r)||(0,u.isNone)(r.arcade))return void p.error("Use of arcade expressions requires an arcade context");var b={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},m=r.arcade.arcadeUtils,h=m.getViewInfo(b),V=m.createExecContext(l,h);if(!d){var y=m.createSyntaxTree(i.valueExpression);d=m.createFunction(y),i.cache.compiledFunc=d}v=m.executeFunction(d,V)}else o&&(v=o[c]||0);return v="number"!=typeof v||isNaN(v)?null:t+s*v}p.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable")}}function y(e,a,r){var i="visualVariables"in e&&e.visualVariables?e.visualVariables.find((function(e){return"size"===e.type})):e;if(i){if("esri.renderers.visualVariables.SizeVariable"===i.declaredClass){var n=S(function(e,a,r){var i="number"==typeof a,n=i?null:a,t=n&&n.attributes,s=i?a:null,l=e.cache.isScaleDriven,o=e.cache.compiledFunc;if(l){var c=(0,u.isSome)(r)?r.scale:void 0,d=(0,u.isSome)(r)?r.view:void 0;s=null==c||"3d"===d?function(e){var a=null,r=null,i=e.stops;return i?(a=i[0].value,r=i[i.length-1].value):(a=e.minDataValue||0,r=e.maxDataValue||0),(a+r)/2}(e):c}else if(!i)switch(e.inputValueType){case f.InputValueType.Expression:if((0,u.isNone)(r)||(0,u.isNone)(r.arcade))return void p.error("Use of arcade expressions requires an arcade context");var v={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},b=r.arcade.arcadeUtils,m=b.getViewInfo(v),h=b.createExecContext(n,m);if(!o){var V=b.createSyntaxTree(e.valueExpression);o=b.createFunction(V),e.cache.compiledFunc=o}s=b.executeFunction(o,h);break;case f.InputValueType.Field:t&&(s=t[e.field]);break;case f.InputValueType.Unknown:s=null}if(!(0,f.isValidNumber)(s))return null;if(i||!e.normalizationField)return s;var y=t?parseFloat(t[e.normalizationField]):null;return(0,f.isValidNumber)(y)&&0!==y?s/y:null}(i,a,r),i,a,r,i.cache.ipData);return null==n||isNaN(n)?0:n}p.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable")}}function x(e,a,r){return null==e?null:(0,f.isSizeVariable)(e)?y(e,a,r):(0,f.isValidNumber)(e)?e:null}function g(e,a,r){return(0,f.isValidNumber)(r)&&e>r?r:(0,f.isValidNumber)(a)&&e<a?a:e}function S(e,a,r,i,t){switch(a.transformationType){case f.TransformationType.Additive:return U=r,I=i,e+(x((q=a).minSize,U,I)||q.minDataValue);case f.TransformationType.Constant:return R=r,C=i,D=(E=a).stops,null==(k=D&&D.length&&D[0].size)&&(k=E.minSize),x(k,R,C);case f.TransformationType.ClampedLinear:return function(e,a,r,i){var n=(e-a.minDataValue)/(a.maxDataValue-a.minDataValue),t=x(a.minSize,r,i),s=x(a.maxSize,r,i),l=(0,u.isSome)(i)?i.shape:void 0;if(e<=a.minDataValue)return t;if(e>=a.maxDataValue)return s;if("area"===a.scaleBy&&l){var o="circle"===l,c=o?v*Math.pow(t/2,2):t*t,f=c+n*((o?v*Math.pow(s/2,2):s*s)-c);return o?2*Math.sqrt(f/v):Math.sqrt(f)}return t+n*(s-t)}(e,a,r,i);case f.TransformationType.Proportional:return V=e,y=a,S=r,w=i,T=(0,u.isSome)(w)?w.shape:void 0,F=V/y.minDataValue,N=x(y.minSize,S,w),M=x(y.maxSize,S,w),g("circle"===T?2*Math.sqrt(F*Math.pow(N/2,2)):"square"===T||"diamond"===T||"image"===T?Math.sqrt(F*Math.pow(N,2)):F*N,N,M);case f.TransformationType.Stops:return function(e,a,r,i,t){var s=n.slicedToArray(z(e,t),3),l=s[0],o=s[1],u=s[2];if(l===o)return x(a.stops[l].size,r,i);var c=x(a.stops[l].size,r,i);return c+(x(a.stops[o].size,r,i)-c)*u}(e,a,r,i,t);case f.TransformationType.RealWorldSize:return s=e,l=a,o=r,p=i,d=((0,u.isSome)(p)&&p.resolution?p.resolution:1)*c.meterIn[l.valueUnit],b=x(l.minSize,o,p),m=x(l.maxSize,o,p),g("area"===(h=l.valueRepresentation)?2*Math.sqrt(s/v)/d:"radius"===h||"distance"===h?2*s/d:s/d,b,m);case f.TransformationType.Identity:return e;case f.TransformationType.Unknown:return null}var s,l,o,p,d,b,m,h,V,y,S,w,T,F,N,M,E,R,C,D,k,q,U,I}function w(e,a,r){if(!(e.cache.isScaleDriven&&"3d"===r||a))return null;var i={scale:a,view:r},n=x(e.minSize,d,i),t=x(e.maxSize,d,i);if(null!=n||null!=t){if(n>t){var s=t;t=n,n=s}return{minSize:n,maxSize:t}}}function T(e,a,r){if(e.visualVariables){var i=[],n=[],t=[],s=[],l=[],o=!0,u=!1,c=void 0;try{for(var f,p=e.visualVariables[Symbol.iterator]();!(o=(f=p.next()).done);o=!0){var d=f.value;switch(d.type){case"color":n.push(d);break;case"opacity":t.push(d);break;case"rotation":l.push(d);break;case"size":s.push(d)}}}catch(e){u=!0,c=e}finally{try{o||null==p.return||p.return()}finally{if(u)throw c}}return n.forEach((function(e){var n=m(e,a,r);i.push({variable:e,value:n})})),t.forEach((function(e){var n=h(e,a,r);i.push({variable:e,value:n})})),l.forEach((function(e){var n=V(e,a,r);i.push({variable:e,value:n})})),s.forEach((function(e){var n=y(e,a,r);i.push({variable:e,value:n})})),i.filter((function(e){return null!=e.value}))}}function z(e,a){if(a){var r=0,i=a.length-1;return a.some((function(a,n){return e<a?(i=n,!0):(r=n,!1)})),[r,i,(e-a[r])/(a[i]-a[r])]}}function F(e,a,r){var i=["proportional","proportional","proportional"],n=!0,t=!1,s=void 0;try{for(var o,u=e[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var c=o.value,f=c.useSymbolValue?"symbol-value":y(c,a,r);switch(c.axis){case"width":i[0]=f;break;case"depth":i[1]=f;break;case"height":i[2]=f;break;case"width-and-depth":i[0]=f,i[1]=f;break;case"all":case void 0:case null:i[0]=f,i[1]=f,i[2]=f;break;default:(0,l.neverReached)(c.axis)}}}catch(e){t=!0,s=e}finally{try{n||null==u.return||u.return()}finally{if(t)throw s}}return i}}))}();
//# sourceMappingURL=visualVariableUtils.072c505a.js.map
