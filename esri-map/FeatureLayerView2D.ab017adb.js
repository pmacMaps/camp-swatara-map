function e(e,t,i,r){Object.defineProperty(e,t,{get:i,set:r,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("lstEf",(function(i,r){var s;s=i.exports,Object.defineProperty(s,"__esModule",{value:!0,configurable:!0}),e(i.exports,"default",(function(){return q}));var n=t("j6uz9"),a=t("g5QqQ");t("ixrNB");var l=t("EvxpF"),o=t("26zvD"),u=t("bPmsI"),h=t("5HTPH"),c=t("itGIg"),d=t("6TszD"),p=t("1CpCt"),f=t("lHg4e"),y=t("cc23H"),g=t("hTI69");t("gHCNy");var v=t("qA6zg"),m=t("ktCFl"),_=t("gkHrn"),S=t("gEU1A"),b=t("gC5jC"),x=t("aPQ4T"),V=t("35vaU"),R=t("4W3Zs"),T=t("643pB"),w=t("32ZAU"),C=t("2aVaM"),I=t("b9yzk"),L=t("8it4a"),O=t("j9MnR"),E=t("dKRyb"),F=t("YRjSC"),z=t("aDxLR"),U=t("8r0sl"),M=t("2WnyR");function A(e){return e&&"openPorts"in e}const P=d.default.getLogger("esri.views.2d.layers.FeatureLayerView2D");let G=class extends((0,E.FeatureLayerView)((0,z.RefreshableLayerView)((0,V.LayerView2DMixin)(F.default)))){destroy(){var e;(0,p.applySome)(this._updateClusterSizeTask,(e=>e.remove())),null==(e=this._proxy)||e.destroy(),this._commandsQueue.destroy()}initialize(){this.addResolvingPromise(Promise.all([this._initProxy(),this._initServiceOptions()])),this.handles.add([this.on("valueRangesChanged",(e=>{this._set("_aggregateValueRanges",e.valueRanges)})),(0,y.watch)((()=>this.featureEffect),(e=>{this.featureEffectView.featureEffect=e}),{initial:!0,sync:!0})])}async _initProxy(){if("isTable"in this.layer&&this.layer.isTable)throw new(0,u.default)("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer});this._proxy&&this._proxy.destroy();const e=this._createClientOptions();return this._set("_proxy",new(0,I.default)({client:e})),this._proxy.when()}async _initServiceOptions(){return this._set("_serviceOptions",await this._createServiceOptions()),this._serviceOptions}get orderByFields(){return"stream"!==this._serviceOptions.type&&this._serviceOptions.orderByFields}get labelsVisible(){const e="subtype-group"===this.layer.type?this.layer.sublayers.items:[this.layer];return!this.suspended&&e.some((e=>e.labelingInfo&&e.labelsVisible))}get queryMode(){return this._serviceOptions.type}get renderingConfigHash(){if(!this.layer)return null;const e=this.availableFields,t=this.layer,i=this.view.floors,{definitionExpression:r}=t,s="subtype-group"!==this.layer.type&&this.layer.labelsVisible&&this.layer.labelingInfo,n="renderer"in t&&t.renderer,a="feature"===t.type?t.gdbVersion:void 0,l="feature"===t.type&&t.historicMoment?t.historicMoment.getTime():void 0,{timeExtent:o}=this,u="customParameters"in t?JSON.stringify(t.customParameters):void 0,h="apiKey"in t?t.apiKey:void 0,c="stream"===t.type?`${JSON.stringify(t.geometryDefinition)}${t.definitionExpression}`:null,d=JSON.stringify(this.clips),f=t.featureReduction&&t.featureReduction.toJSON(),y="orderBy"in this.layer&&JSON.stringify(this.layer.orderBy),g="sublayers"in this.layer&&this.layer.sublayers.items.reduce(((e,t)=>e+`${t.visible?1:0}.${JSON.stringify(t.renderer)}.${t.labelsVisible}\n.${JSON.stringify(t.labelingInfo)}`),"");return JSON.stringify({orderBy:y,sublayerHash:g,filterHash:(0,p.isSome)(this.filter)&&this.filter.toJSON(),effectHash:(0,p.isSome)(this.featureEffect)&&this.featureEffect.toJSON(),streamFilter:c,gdbVersion:a,definitionExpression:r,historicMoment:l,availableFields:e,renderer:n,labelingInfo:s,timeExtent:o,floors:i,clipsHash:d,featureReduction:f,customParameters:u,apiKey:h})}highlight(e){var t;let i;return e instanceof l.default?i=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?i=[e]:Array.isArray(e)&&e.length>0?i="number"==typeof e[0]||"string"==typeof e[0]?e:e.map((e=>null==e?void 0:e.getObjectId())):o.default.isCollection(e)&&e.length>0&&(i=e.map((e=>null==e?void 0:e.getObjectId())).toArray()),i=null==(t=i)?void 0:t.filter((e=>null!=e)),i&&i.length?(this._addHighlight(i),{remove:()=>this._removeHighlight(i)}):{remove:()=>{}}}hasHighlight(){return!!this._highlightIds.size}async hitTest(e,t){if(!this.tileRenderer)return null;const i=await this.tileRenderer.hitTest(t);if(0===i.length)return null;const{features:r,aggregates:s}=await this._proxy.getFeatures(i);return[...s.map((e=>this._createHittestResult(a.default.fromJSON(e)))),...r.map((e=>this._createHittestResult(l.default.fromJSON(e))))]}async queryAggregates(){return(await this._proxy.getAggregates()).map((e=>a.default.fromJSON(e)))}queryStatistics(){return this._proxy.queryStatistics()}async querySummaryStatistics(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.querySummaryStatistics(this._cleanUpQuery(e),r,i)}async queryUniqueValues(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.queryUniqueValues(this._cleanUpQuery(e),r,i)}async queryClassBreaks(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.queryClassBreaks(this._cleanUpQuery(e),r,i)}async queryHistogram(e,t,i){const r={...t,scale:this.view.scale};return this._proxy.queryHistogram(this._cleanUpQuery(e),r,i)}queryFeatures(e,t){return this.queryFeaturesJSON(e,t).then((e=>{const t=S.default.fromJSON(e);return t.features.forEach((e=>this._setLayersForFeature(e))),t}))}queryVisibleFeatures(e,t){return this._proxy.queryVisibleFeatures(this._cleanUpQuery(e),t).then((e=>{const t=S.default.fromJSON(e);return t.features.forEach((e=>this._setLayersForFeature(e))),t}))}queryFeaturesJSON(e,t){return this._proxy.queryFeatures(this._cleanUpQuery(e),t)}queryObjectIds(e,t){return this._proxy.queryObjectIds(this._cleanUpQuery(e),t)}queryFeatureCount(e,t){return this._proxy.queryFeatureCount(this._cleanUpQuery(e),t)}queryExtent(e,t){return this._proxy.queryExtent(this._cleanUpQuery(e),t).then((e=>({count:e.count,extent:M.default.fromJSON(e.extent)})))}setVisibility(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}update(e){if(!this._tileStrategy||!this.tileRenderer)return;const{hasMissingTiles:t,added:i,removed:r}=this._tileStrategy.update(e);(i.length||r.length)&&this._proxy.updateTiles({added:i,removed:r}),t&&this.requestUpdate(),this.notifyChange("updating")}attach(){this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this._tileStrategy=new(0,O.TileManager)({acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme,buffer:0}),this.handles.add((0,y.watch)((()=>this.renderingConfigHash),(()=>this._update()),y.initial),"attach"),"stream"!==this.layer.type&&this.handles.add(this.layer.on("edits",(e=>this._edit(e))),"attach")}detach(){var e;this._commandsQueue.clear(),null==(e=this._proxy)||e.stop(),this.container.removeAllChildren(),this.handles.remove("attach"),this.tileRenderer&&(this.tileRenderer.uninstall(this.container),this.tileRenderer=null),this._tileStrategy&&(this._tileStrategy.destroy(),this._tileStrategy=null),this._tileRendererHash=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}isUpdating(){var e;const t="renderer"in this.layer&&null!=this.layer.renderer,i=this._commandsQueue.updating,r=null!=this._updatingRequiredFieldsPromise,s=!this._proxy||!this._proxy.isReady,n=this._pipelineIsUpdating,a=null==this.tileRenderer||(null==(e=this.tileRenderer)?void 0:e.updating),l=t&&(i||r||s||n||a);return(0,h.default)("esri-2d-log-updating")&&console.log(`Updating FLV2D: ${l}\n  -> hasRenderer ${t}\n  -> hasPendingCommand ${i}\n  -> updatingRequiredFields ${r}\n  -> updatingProxy ${s}\n  -> updatingPipeline ${n}\n  -> updatingTileRenderer ${a}\n`),l}_createClientOptions(){return{setUpdating:e=>{this._set("_pipelineIsUpdating",e)},emitEvent:e=>{this.emit(e.name,e.event)}}}async _detectQueryMode(e){var t;const i="path"in e,r="editingInfo"in this.layer&&(null==(t=this.layer.editingInfo)?void 0:t.lastEditDate),s=!!this.layer.refreshInterval,n=!r&&s;if(i&&("feature"===this.layer.type||"subtype-group"===this.layer.type)&&"point"===this.layer.geometryType&&this.layer.capabilities.query.supportsPagination&&!this.layer.capabilities.operations.supportsEditing&&!n&&(0,h.default)("featurelayer-snapshot-enabled"))try{const e=await this.layer.queryFeatureCount();if(e<=(0,h.default)("featurelayer-snapshot-point-min-threshold"))return{mode:"snapshot",featureCount:e};const t=(0,h.default)("featurelayer-snapshot-point-max-threshold"),i=(0,h.default)("featurelayer-snapshot-point-coverage"),r=this.view.extent,s=(0,p.unwrap)(this.layer.fullExtent),n=null==s?void 0:s.clone().intersection(r),a=(0,p.isSome)(n)?n.width*n.height:0,l=(null==s?void 0:s.width)*(null==s?void 0:s.height),o=0===l?0:a/l;if(e<=t&&o>=i)return{mode:"snapshot",featureCount:e}}catch(e){P.warn("mapview-feature-layer","Encountered an error when querying for featureCount",{error:e})}return{mode:"on-demand"}}async _createServiceOptions(){var e;const t=this.layer;if("stream"===t.type)return null;const{capabilities:i,objectIdField:r}=t,s=t.fields.map((e=>e.toJSON())),n=(0,p.isSome)(t.fullExtent)&&t.fullExtent.toJSON(),a=(0,L.toJSONGeometryType)(t.geometryType),l=t.timeInfo&&t.timeInfo.toJSON()||null,o=t.spatialReference?t.spatialReference.toJSON():null,u="feature"===t.type?t.globalIdField:null;let h;"ogc-feature"===t.type?h=t.source.getFeatureDefinition():A(t.source)?h=await t.source.openPorts():t.parsedUrl&&(h=(0,c.clone)(t.parsedUrl),"dynamicDataSource"in t&&t.dynamicDataSource&&(h.query={layer:JSON.stringify({source:t.dynamicDataSource})}));const d="datesInUnknownTimezone"in this.layer&&this.layer.datesInUnknownTimezone,f=null!=(e="subtypeField"in this.layer&&this.layer.subtypeField)?e:null,{mode:y,featureCount:g}=await this._detectQueryMode(h);let v=this.layer.objectIdField;if("feature"===this.layer.type&&(0,p.isSome)(this.layer.orderBy)&&this.layer.orderBy.length){const e=!this.layer.orderBy[0].valueExpression&&this.layer.orderBy[0].field;e&&(v=e)}return{type:y,timeReferenceUnknownClient:d,subtypeField:f,featureCount:g,globalIdField:u,maxRecordCount:i.query.maxRecordCount,tileMaxRecordCount:i.query.tileMaxRecordCount,capabilities:i,fields:s,fullExtent:n,geometryType:a,objectIdField:r,source:h,timeInfo:l,spatialReference:o,orderByFields:v}}async _createMemoryServiceOptions(e){const t=await e.openPorts();return{...this._createServiceOptions(),type:"memory",source:t}}_cleanUpQuery(e){const t=b.default.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t}async _update(){return this._commandsQueue.push({type:"update"})}async _edit(e){if(!this.suspended)return this._validateEdit(e)?this._commandsQueue.push({type:"edit",edits:e}):void 0;this._clearTiles()}async doRefresh(e){if(this._tileStrategy.tileKeys().length)return this.suspended&&e?void this._clearTiles():this._commandsQueue.push({type:"refresh",dataChanged:e})}_clearTiles(){this._tileStrategy.tileKeys().length&&(this._proxy.updateTiles({added:[],removed:this._tileStrategy.tileKeys()}),this._tileStrategy.clear(),this.requestUpdate(),this._commandsQueue.clear(),this._update())}_validateEdit(e){const t="globalIdField"in this.layer&&this.layer.globalIdField,i=e.deletedFeatures.some((e=>-1===e.objectId||!e.objectId)),r=t&&this.availableFields.includes(t);return i&&!r?(P.error(new(0,u.default)("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${t} to be included the layer's outFields for updates to be reflected on the map`)),null):e}async _doUpdate(){try{if(this.destroyed||!this._hasRequiredSupport(this.layer)||!this._tileStrategy)return;const{featureEffectView:e,filter:t}=this;await this._updateRequiredFields();const{renderer:i}=this._getEffectiveRenderer();this._set("_effectiveRenderer",i);const r=this._createSchemaConfig(),s=this._createConfiguration(r,t,e.filter),n=this._lastDefinitionExpression!==s.definitionExpression;this._lastDefinitionExpression=s.definitionExpression;const a=this._createTileRendererHash(i);if("snapshot"===this._serviceOptions.type&&(s.schema.source.featureCount=this._serviceOptions.featureCount),a!==this._tileRendererHash){await this._initTileRenderer(i);const e=this.layer,t="stream"===e.type?await this._initServiceOptions():this._serviceOptions;this.tileRenderer.onConfigUpdate(i),"stream"!==e.type&&A(e.source)&&(t.source=await e.source.openPorts());const r={added:this._tileStrategy.tileKeys(),removed:[]};await this._proxy.startup(this.view.featuresTilingScheme,s,t,r),this.hasHighlight()&&await this._proxy.setHighlight(Array.from(this._highlightIds.keys())),await this._onceTilesUpdated(),this.tileRenderer.onConfigUpdate(i)}else{"snapshot"===this._serviceOptions.type&&n&&(s.schema.source.featureCount=await this.layer.queryFeatureCount());const e=await this._proxy.update(s);(e.mesh||e.targets.aggregate)&&this._lockGPUUploads();try{await this._proxy.applyUpdate(e)}catch(e){(0,f.isAbortError)(e)||P.error(e)}(e.mesh||e.targets.aggregate)&&this._unlockGPUUploads(),this.tileRenderer.onConfigUpdate(i),this._updateClusterSizeVariable(),this._forceAttributeTextureUpload()}this._tileRendererHash=a,this.tileRenderer.invalidateLabels(),this.requestUpdate()}catch(e){}}async _doEdit(e){try{await this._proxy.onEdits(e)}catch(e){(0,f.isAbortError)(e)}}async _doRefresh(e){var t;this._lockGPUUploads();try{await this._proxy.refresh(e)}catch(e){(0,f.isAbortError)(e)}this._unlockGPUUploads(),null!=(t=this.layer)&&t.featureReduction&&this._updateClusterSizeVariable()}_updateClusterSizeVariable(){this._needsClusterSizeUpdate&&(this.tileRenderer.onConfigUpdate(this._effectiveRenderer),this._needsClusterSizeUpdate=!1)}_createUpdateClusterSizeTask(e,t){return this.watch("_aggregateValueRanges",(async i=>{this._updateClusterEffectiveRendererSizeVariable(e,t,i),this._needsClusterSizeUpdate=!0,this._uploadsLocked||this._updateClusterSizeVariable()}))}async _updateClusterEffectiveRendererSizeVariable(e,t,i){if(e.dynamicClusterSize&&"visualVariables"in e&&e.visualVariables){const r=(0,w.findSizeVV)(e.visualVariables);if((0,p.isSome)(r)&&"cluster_count"===r.field){const s=e.visualVariables.indexOf(r);e.visualVariables[s]=(0,w.createClusterCountSizeVariable)(t,i);const n=e.clone();n.dynamicClusterSize=!0,this._set("_effectiveRenderer",n)}}}_getEffectiveRenderer(){const e="renderer"in this.layer&&this.layer.renderer,t=this.layer.featureReduction;if((0,p.isSome)(this._updateClusterSizeTask)&&(this._updateClusterSizeTask.remove(),this._updateClusterSizeTask=null),t&&"cluster"===t.type&&(0,w.isClusterCompatibleRenderer)(e)){const i=t,r=[],s=(0,w.createClusterRenderer)(r,e,i,this._aggregateValueRanges);return(0,p.applySome)(this._updateClusterSizeTask,(e=>e.remove())),this._updateClusterSizeTask=this._createUpdateClusterSizeTask(s,i),{renderer:s,aggregateFields:r,featureReduction:t}}return{renderer:e,aggregateFields:[],featureReduction:null}}_acquireTile(e){const t=this.tileRenderer.acquireTile(e);return t.once("attach",(()=>{this.requestUpdate()})),t}_releaseTile(e){this.tileRenderer.releaseTile(e)}async _initTileRenderer(e){const t=await(0,T.createOrReuseTileRenderer)(e,{layerView:this,tileInfoView:this.view.featuresTilingScheme,layer:this.layer});return this.tileRenderer&&(this._tileStrategy.clear(),this.tileRenderer.uninstall(this.container),this.tileRenderer.destroy(),this.tileRenderer=null),this.destroyed?null:(this._proxy.tileRenderer=t,this._set("tileRenderer",t),this.tileRenderer.install(this.container),this.tileRenderer.onConfigUpdate(e),this.requestUpdate(),this.tileRenderer)}_createTileRendererHash(e){return""+("heatmap"===e.type?"heatmap":"symbol")}get hasFilter(){const e=!!("floorInfo"in this.layer&&this.layer.floorInfo&&this.view.floors&&this.view.floors.length);return!!this.filter||e||!!this._visibilityOverrides.size||!!this.timeExtent}_injectOverrides(e){const t=(0,p.isSome)(e)?e.timeExtent:null,i=(0,p.isSome)(this.timeExtent)&&(0,p.isSome)(t)?this.timeExtent.intersection(t):this.timeExtent||t;let r=null;const s="floorInfo"in this.layer&&this.layer.floorInfo;if(s){const t=(0,p.isSome)(e)&&e.where;r=this._addFloorFilterClause(t)}if(!this._visibilityOverrides.size&&!i&&!s)return(0,p.isSome)(e)?e.toJSON():null;(e=(0,p.isSome)(e)&&e.clone()||new(0,_.default)).timeExtent=i,r&&(e.where=r);const n=e.toJSON();return n.hiddenIds=Array.from(this._visibilityOverrides),n}_addFloorFilterClause(e){const t=this.layer;let i=e||"";if("floorInfo"in t&&t.floorInfo){var r;let e=this.view.floors;if(!e||!e.length)return i;null!=(r=t.floorInfo.viewAllLevelIds)&&r.length&&(e=t.floorInfo.viewAllLevelIds);const s=e.filter((e=>""!==e)).map((e=>"'"+e+"'"));s.push("''");const n=t.floorInfo.floorField;let a="("+n+" IN ({ids}) OR "+n+" IS NULL)";if(a=a.replace("{ids}",s.join(", ")),(0,p.isSome)(i)&&i.includes(n)){let e=new RegExp("AND \\("+n+".*NULL\\)","g");i=i.replace(e,""),e=new RegExp("\\("+n+".*NULL\\)","g"),i=i.replace(e,""),i=i.replace(/\s+/g," ").trim()}i=""!==i?"("+i+") AND "+a:a}return""!==i?i:null}_createConfiguration(e,t,i){const r="feature"===this.layer.type&&this.layer.historicMoment?this.layer.historicMoment.getTime():void 0,s="feature"===this.layer.type?this.layer.gdbVersion:void 0,n=new Array(x.MAX_FILTERS),a=this._injectOverrides(t);n[0]=a,n[1]=(0,p.isSome)(i)?i.toJSON():null;const l=(0,R.createSchema)(e);if((0,p.isNone)(l))return null;const o=(0,U.getWebGL1Capabilities)();return{definitionExpression:this.layer.definitionExpression,availableFields:this.availableFields,gdbVersion:s,historicMoment:r,devicePixelRatio:window.devicePixelRatio||1,filters:n,schema:l,supportsTextureFloat:o.supportsTextureFloat,maxTextureSize:o.maxTextureSize}}_hasRequiredSupport(e){var t;return!("renderer"in e&&"dot-density"===(null==(t=e.renderer)?void 0:t.type)&&!(0,U.getWebGL1Capabilities)().supportsTextureFloat&&(P.error(new(0,u.default)("webgl-missing-extension","Missing WebGL extension OES_Texture_Float which is required for DotDensity")),1))}_onceTilesUpdated(){return this.requestUpdate(),(0,y.whenOnce)((()=>!this._pipelineIsUpdating))}_lockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!0,this.tileRenderer.lockGPUUploads())}_unlockGPUUploads(){this.tileRenderer&&(this._uploadsLocked=!1,this.tileRenderer.unlockGPUUploads())}_forceAttributeTextureUpload(){this.tileRenderer&&this.tileRenderer.forceAttributeTextureUpload()}_createSchemaConfig(){const e="feature"===this.layer.type?this.layer.historicMoment:null,t="feature"===this.layer.type?this.layer.gdbVersion:null;return{renderer:"renderer"in this.layer&&this.layer.renderer,spatialReference:this.layer.spatialReference,timeExtent:this.layer.timeExtent,definitionExpression:this.layer.definitionExpression,featureReduction:this.layer.featureReduction,fields:this.layer.fields,geometryType:this.layer.geometryType,historicMoment:e,labelsVisible:"labelsVisible"in this.layer&&this.layer.labelsVisible,labelingInfo:"labelingInfo"in this.layer&&this.layer.labelingInfo,availableFields:this.availableFields,featureEffect:this.featureEffect,filter:this.filter,gdbVersion:t,pixelBuffer:0,orderBy:"orderBy"in this.layer&&this.layer.orderBy?this.layer.orderBy:null,customParameters:{..."customParameters"in this.layer?this.layer.customParameters:void 0,token:"apiKey"in this.layer?this.layer.apiKey:void 0}}}_addHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t);this._highlightIds.set(t,e+1)}else this._highlightIds.set(t,1);this._updateHighlight().catch((e=>{(0,f.isAbortError)(e)||P.error(e)}))}_removeHighlight(e){for(const t of e)if(this._highlightIds.has(t)){const e=this._highlightIds.get(t)-1;0===e?this._highlightIds.delete(t):this._highlightIds.set(t,e)}this._updateHighlight().catch((e=>{(0,f.isAbortError)(e)||P.error(e)}))}_setLayersForFeature(e){const t=this.layer;e.layer=t,e.sourceLayer=t}_createHittestResult(e){return this._setLayersForFeature(e),(0,p.isSome)(e.geometry)&&(e.geometry.spatialReference=this.view.spatialReference),e}constructor(){super(...arguments),this._pipelineIsUpdating=!0,this._commandsQueue=new(0,C.default)({process:e=>{switch(e.type){case"processed-edit":return this._doEdit(e);case"refresh":return this._doRefresh(e.dataChanged);case"update":return this._doUpdate()}}}),this._visibilityOverrides=new Set,this._highlightIds=new Map,this._updateHighlight=(0,f.debounce)((async()=>this._proxy.setHighlight(Array.from(this._highlightIds.keys())))),this._uploadsLocked=!1,this._needsClusterSizeUpdate=!1,this.featureEffectView=new(0,m.default),this._lastDefinitionExpression=null}};(0,n._)([(0,g.property)()],G.prototype,"_serviceOptions",void 0),(0,n._)([(0,g.property)()],G.prototype,"_proxy",void 0),(0,n._)([(0,g.property)()],G.prototype,"_pipelineIsUpdating",void 0),(0,n._)([(0,g.property)()],G.prototype,"_effectiveRenderer",void 0),(0,n._)([(0,g.property)()],G.prototype,"_aggregateValueRanges",void 0),(0,n._)([(0,g.property)()],G.prototype,"_commandsQueue",void 0),(0,n._)([(0,g.property)()],G.prototype,"featureEffectView",void 0),(0,n._)([(0,g.property)()],G.prototype,"labelsVisible",null),(0,n._)([(0,g.property)({readOnly:!0})],G.prototype,"queryMode",null),(0,n._)([(0,g.property)()],G.prototype,"renderingConfigHash",null),(0,n._)([(0,g.property)()],G.prototype,"tileRenderer",void 0),(0,n._)([(0,g.property)()],G.prototype,"updating",void 0),G=(0,n._)([(0,v.subclass)("esri.views.2d.layers.FeatureLayerView2D")],G);const q=G})),t.register("8it4a",(function(i,r){e(i.exports,"toJSONGeometryType",(function(){return n})),e(i.exports,"canUseMajorityInterpolationOnDataSource",(function(){return a}));const s=new(0,t("4jlRt").JSONMap)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function n(e){return s.toJSON(e)}function a(e){const{bandCount:t,attributeTable:i,colormap:r,pixelType:s}=e.rasterInfo;return 1===t&&(null!=i||null!=r||"u8"===s||"s8"===s)}})),t.register("aDxLR",(function(i,r){e(i.exports,"RefreshableLayerView",(function(){return h}));var s=t("j6uz9"),n=t("6TszD"),a=t("lHg4e"),l=t("cc23H"),o=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var u=t("qA6zg");const h=e=>{let t=class extends e{initialize(){this.handles.add((0,l.on)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{(0,a.isAbortError)(e)||n.default.getLogger(this.declaredClass).error(e)}))})),"RefreshableLayerView")}};return(0,s._)([(0,o.property)()],t.prototype,"layer",void 0),t=(0,s._)([(0,u.subclass)("esri.layers.mixins.RefreshableLayerView")],t),t}})),t.register("1kNSi",(function(i,r){e(i.exports,"toQuantizationTransform",(function(){return u})),e(i.exports,"quantizePoint",(function(){return m})),e(i.exports,"quantizeGeometry",(function(){return b})),e(i.exports,"unquantizeMultipoint",(function(){return x})),e(i.exports,"unquantizePoint",(function(){return V})),e(i.exports,"unquantizePolygon",(function(){return R})),e(i.exports,"unquantizePolyline",(function(){return T}));var s=t("1CpCt"),n=t("86d4E");const a=(e,t,i)=>[t,i],l=(e,t,i)=>[t,i,e[2]],o=(e,t,i)=>[t,i,e[2],e[3]];function u(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance]:[1,1],translate:(0,s.isSome)(e.extent)?[e.extent.xmin,e.extent.ymax]:[0,0]}:null}function h({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function c({scale:e,translate:t},i){return Math.round((t[1]-i)/e[1])}function d(e,t,i){const r=[];let s,n,a,l;for(let o=0;o<i.length;o++){const u=i[o];o>0?(a=h(e,u[0]),l=c(e,u[1]),a===s&&l===n||(r.push(t(u,a-s,l-n)),s=a,n=l)):(s=h(e,u[0]),n=c(e,u[1]),r.push(t(u,s,n)))}return r.length>0?r:null}function p({scale:e,translate:t},i){return i*e[0]+t[0]}function f({scale:e,translate:t},i){return t[1]-i*e[1]}function y(e,t,i){const r=new Array(i.length);if(!i.length)return r;const[s,n]=e.scale;let a=p(e,i[0][0]),l=f(e,i[0][1]);r[0]=t(i[0],a,l);for(let e=1;e<i.length;e++){const o=i[e];a+=o[0]*s,l-=o[1]*n,r[e]=t(o,a,l)}return r}function g(e,t,i){const r=new Array(i.length);for(let s=0;s<i.length;s++)r[s]=y(e,t,i[s]);return r}function v(e,t,i,r,s){return t.points=(n=e,u=i.points,h=s,d(n,r?h?o:l:h?l:a,u)),t;var n,u,h}function m(e,t,i,r,s){return t.x=h(e,i.x),t.y=c(e,i.y),t!==i&&(r&&(t.z=i.z),s&&(t.m=i.m)),t}function _(e,t,i,r,s){const n=function(e,t,i,r){const s=[],n=i?r?o:l:r?l:a;for(let i=0;i<t.length;i++){const r=d(e,n,t[i]);r&&r.length>=3&&s.push(r)}return s.length?s:null}(e,i.rings,r,s);return n?(t.rings=n,t):null}function S(e,t,i,r,s){const n=function(e,t,i,r){const s=[],n=i?r?o:l:r?l:a;for(let i=0;i<t.length;i++){const r=d(e,n,t[i]);r&&r.length>=2&&s.push(r)}return s.length?s:null}(e,i.paths,r,s);return n?(t.paths=n,t):null}function b(e,t){return e&&t?(0,n.isPoint)(t)?m(e,{},t,!1,!1):(0,n.isPolyline)(t)?S(e,{},t,!1,!1):(0,n.isPolygon)(t)?_(e,{},t,!1,!1):(0,n.isMultipoint)(t)?v(e,{},t,!1,!1):(0,n.isExtent)(t)?(a=!1,l=!1,(r={}).xmin=h(i=e,(s=t).xmin),r.ymin=c(i,s.ymin),r.xmax=h(i,s.xmax),r.ymax=c(i,s.ymax),r!==s&&(a&&(r.zmin=s.zmin,r.zmax=s.zmax),l&&(r.mmin=s.mmin,r.mmax=s.mmax)),r):null:null;var i,r,s,a,l}function x(e,t,i,r,n){return(0,s.isSome)(i)&&(t.points=(u=e,h=i.points,c=n,y(u,r?c?o:l:c?l:a,h))),t;var u,h,c}function V(e,t,i,r,n){return(0,s.isNone)(i)||(t.x=p(e,i.x),t.y=f(e,i.y),t!==i&&(r&&(t.z=i.z),n&&(t.m=i.m))),t}function R(e,t,i,r,n){return(0,s.isSome)(i)&&(t.rings=(u=e,h=i.rings,c=n,g(u,r?c?o:l:c?l:a,h))),t;var u,h,c}function T(e,t,i,r,n){return(0,s.isSome)(i)&&(t.paths=(u=e,h=i.paths,c=n,g(u,r?c?o:l:c?l:a,h))),t;var u,h,c}})),t.register("3mbeV",(function(t,i){e(t.exports,"u32to4Xu8",(function(){return s})),e(t.exports,"i1616to32",(function(){return n})),e(t.exports,"i8888to32",(function(){return a}));const r=new Float32Array(1);new Uint32Array(r.buffer);function s(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function n(e,t){return 65535&e|t<<16}function a(e,t,i,r){return 255&e|(255&t)<<8|(255&i)<<16|r<<24}})),t.register("bVIMy",(function(t,i){var r,s,n,a;function l(e){switch(e){case"left":return r.Left;case"right":return r.Right;case"center":case"justify":return r.Center}}function o(e){switch(e){case"top":return s.Top;case"middle":return s.Center;case"baseline":return s.Baseline;case"bottom":return s.Bottom}}function u(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return[r.Right,s.Bottom];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return[r.Center,s.Bottom];case"above-right":case"esriServerPointLabelPlacementAboveRight":return[r.Left,s.Bottom];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return[r.Right,s.Center];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return[r.Center,s.Center];case"center-right":case"esriServerPointLabelPlacementCenterRight":return[r.Left,s.Center];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return[r.Right,s.Top];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return[r.Center,s.Top];case"below-right":case"esriServerPointLabelPlacementBelowRight":return[r.Left,s.Top];default:return console.debug(`Found invalid placement type ${e}`),[r.Center,s.Center]}}function h(e){switch(e){case r.Right:return-1;case r.Center:return 0;case r.Left:return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}}function c(e){switch(e){case s.Top:return 1;case s.Center:return 0;case s.Bottom:case s.Baseline:return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}}function d(e){switch(e){case"left":return r.Left;case"right":return r.Right;case"center":case"justify":return r.Center}}function p(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}e(t.exports,"HAlign",(function(){return r})),e(t.exports,"VAlign",(function(){return s})),e(t.exports,"getXAnchorDirection",(function(){return l})),e(t.exports,"getYAnchorDirection",(function(){return o})),e(t.exports,"getAlignmentFromPlacement",(function(){return u})),e(t.exports,"getXDirection",(function(){return h})),e(t.exports,"getYDirection",(function(){return c})),e(t.exports,"getJustification",(function(){return d})),e(t.exports,"isMapAligned",(function(){return p})),(a=r||(r={}))[a.Left=-1]="Left",a[a.Center=0]="Center",a[a.Right=1]="Right",(n=s||(s={}))[n.Top=1]="Top",n[n.Center=0]="Center",n[n.Bottom=-1]="Bottom",n[n.Baseline=2]="Baseline"})),t.register("eDdav",(function(i,r){e(i.exports,"createMaterialKey",(function(){return l})),e(i.exports,"FillMaterialKey",(function(){return p})),e(i.exports,"LineMaterialKey",(function(){return y})),e(i.exports,"MarkerMaterialKey",(function(){return f})),e(i.exports,"TextMaterialKey",(function(){return g})),e(i.exports,"LabelMaterialKey",(function(){return v})),e(i.exports,"MaterialKeyBase",(function(){return o}));var s=t("bPmsI"),n=t("bVIMy"),a=t("eyQUy");function l(e,t){switch(e){case a.WGLGeometryType.FILL:return p.from(t);case a.WGLGeometryType.LINE:return y.from(t);case a.WGLGeometryType.MARKER:return f.from(t);case a.WGLGeometryType.TEXT:return g.from(t);case a.WGLGeometryType.LABEL:return v.from(t);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${e}`)}}class o{static load(e){const t=this.shared;return t.data=e,t}set data(e){this._data=e}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(e){this.setBits(e,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(e){this.setBit(20,e)}get sdf(){return!!this.bit(11)}set sdf(e){this.setBit(11,e)}get pattern(){return!!this.bit(12)}set pattern(e){this.setBit(12,e)}get textureBinding(){return this.bits(0,8)}set textureBinding(e){this.setBits(e,0,8)}get geometryTypeString(){switch(this.geometryType){case a.WGLGeometryType.FILL:return"fill";case a.WGLGeometryType.MARKER:return"marker";case a.WGLGeometryType.LINE:return"line";case a.WGLGeometryType.TEXT:return"text";case a.WGLGeometryType.LABEL:return"label";default:throw new(0,s.default)(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(e,t){const i=1<<e;t?this._data|=i:this._data&=~i}bit(e){return(this._data&1<<e)>>e}setBits(e,t,i){for(let r=t,s=0;r<i;r++,s++)this.setBit(r,0!=(e&1<<s))}bits(e,t){let i=0;for(let r=e,s=0;r<t;r++,s++)i|=this.bit(r)<<s;return i}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}constructor(e){this._data=0,this._data=e}}o.shared=new o(0);const u=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(e){this.setBit(16,e)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(e){this.setBit(17,e)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(e){this.setBit(18,e)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(e){this.setBit(19,e)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(e,t){super.setVV(e,t);const i=function(e,t){const i=a.WGLVVFlag.SIZE_FIELD_STOPS|a.WGLVVFlag.SIZE_MINMAX_VALUE|a.WGLVVFlag.SIZE_SCALE_STOPS|a.WGLVVFlag.SIZE_UNIT_VALUE,r=(e&(a.WGLVVTarget.FIELD_TARGETS_OUTLINE|a.WGLVVTarget.MINMAX_TARGETS_OUTLINE|a.WGLVVTarget.SCALE_TARGETS_OUTLINE|a.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return t.isOutline||t.isOutlinedFill?i&r:i&~r}(e,t)&e;this.vvSizeMinMaxValue=!!(i&a.WGLVVFlag.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(i&a.WGLVVFlag.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(i&a.WGLVVFlag.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(i&a.WGLVVFlag.SIZE_SCALE_STOPS)}},h=e=>class extends e{get vvRotation(){return 0!==this.bit(15)}set vvRotation(e){this.setBit(15,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t.isOutline&&!!(e&a.WGLVVFlag.ROTATION)}},c=e=>class extends e{get vvColor(){return 0!==this.bit(13)}set vvColor(e){this.setBit(13,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t.isOutline&&!!(e&a.WGLVVFlag.COLOR)}},d=e=>class extends e{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(e){this.setBit(14,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t.isOutline&&!!(e&a.WGLVVFlag.OPACITY)}};class p extends(c(d(u(o)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.FILL,t.dotDensity="dot-density"===e.stride.fill,t.simple="simple"===e.stride.fill,t.outlinedFill=e.isOutlinedFill,t.dotDensity||t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,outlinedFill:this.outlinedFill,simple:this.simple,vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}get dotDensity(){return!!this.bit(15)}set dotDensity(e){this.setBit(15,e)}get simple(){return!!this.bit(22)}set simple(e){this.setBit(22,e)}get outlinedFill(){return!!this.bit(21)}set outlinedFill(e){this.setBit(21,e)}}p.shared=new p(0);class f extends(c(d(h(u(o))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.MARKER,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}f.shared=new f(0);class y extends(c(d(u(o)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.LINE,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}y.shared=new y(0);class g extends(c(d(h(u(o))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.TEXT,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}g.shared=new g(0);class v extends(u(o)){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.LABEL,t.setVV(e.vvFlags,e),t.mapAligned=(0,n.isMapAligned)(e.placement),t.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}v.shared=new v(0)})),t.register("d1j0h",(function(i,r){e(i.exports,"expandSymbol",(function(){return o})),e(i.exports,"cimLayerToRasterizationInfo",(function(){return u}));var s=t("9LGQK"),n=t("6LuoZ"),a=t("nXMis");const l=async(e,t,i)=>new(0,n.ExpandedCIM)(await(0,s.analyzeCIMSymbol)(e.data,t,i),e.data,e.rendererKey,e.maxVVSize),o=async(e,t,i,r)=>{if(!e)return null;if("cim"===e.type)return l(e,t,i);if("web-style"===e.type){const s={type:"cim",data:await(0,a.fetchCIMSymbolReference)(e,null,r),rendererKey:e.rendererKey,maxVVSize:e.maxVVSize};return l(s,t,i)}return e};function u(e){if(!e)return null;const{type:t,cim:i,url:r,materialHash:s}=e,n={cim:i,type:t,mosaicHash:s,url:r,size:null,dashTemplate:null,path:null,text:null,fontName:null};switch(t){case"marker":n.size=e.size,n.path=e.path;break;case"line":n.dashTemplate=e.dashTemplate;break;case"text":n.text=e.text,n.fontName=e.fontName}return n}})),t.register("6LuoZ",(function(i,r){e(i.exports,"ExpandedCIM",(function(){return l}));var s=t("eyQUy"),n=t("eDdav");const a={marker:s.WGLGeometryType.MARKER,fill:s.WGLGeometryType.FILL,line:s.WGLGeometryType.LINE,text:s.WGLGeometryType.TEXT};class l{get type(){return"expanded-cim"}_createHash(){let e="";for(const t of this.layers)e+=t.templateHash;return e}constructor(e,t,i,r){const s={minScale:null==t?void 0:t.minScale,maxScale:null==t?void 0:t.maxScale},l=(o=s).minScale||o.maxScale?o.minScale+"-"+o.maxScale:"";var o;this.layers=e,this.data=t,this.hash=this._createHash()+l,this.rendererKey=i;const u={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:i};for(const t of e){const e=a[t.type];t.materialKey=(0,n.createMaterialKey)(e,u),t.maxVVSize=r,t.scaleInfo=s,t.templateHash+=l}}}})),t.register("nXMis",(function(i,r){e(i.exports,"fetchCIMSymbolReference",(function(){return c}));var s=t("gnGFZ"),n=t("bPmsI"),a=t("lHg4e"),l=t("7dRCe"),o=t("39WmQ"),u=t("hej7M"),h=t("i9hTa");async function c(e,t,i){if(!e.name)return Promise.reject(new(0,n.default)("style-symbol-reference-name-missing","Missing name in style symbol reference"));if(e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName)return async function(e,t){const i=h.Style2DUrlTemplate.replace(/\{SymbolName\}/gi,e.name);try{const e=await(0,h.requestJSON)(i,t);return(0,h.makeCIMSymbolRef)(e.data)}catch(e){return(0,a.throwIfAborted)(e),null}}(e,i);try{return async function(e,t,i,r){const c=e.data,d={portal:i&&i.portal||o.default.getDefault(),url:(0,l.urlToObject)(e.baseUrl),origin:"portal-item"},p=c.items.find((e=>e.name===t));if(!p)throw new(0,n.default)("symbolstyleutils:symbol-name-not-found",`The symbol name '${t}' could not be found`,{symbolName:t});let f=(0,u.f)((0,h.symbolUrlFromStyleItem)(p,"cimRef"),d);(0,s.isDevEnvironment)()&&(f=(0,s.adjustStaticAGOUrl)(f));try{const e=await(0,h.requestJSON)(f,r);return(0,h.makeCIMSymbolRef)(e.data)}catch(e){return(0,a.throwIfAborted)(e),null}}(await(0,h.fetchStyle)(e,t,i),e.name,t,i)}catch(e){return(0,a.throwIfAborted)(e),null}}})),t.register("jdyxA",(function(i,r){e(i.exports,"getTypeOfSizeVisualVariable",(function(){return u}));var s=t("bPmsI"),n=t("6TszD"),a=t("eyQUy"),l=t("cPgEa");const o=n.default.getLogger("esri.views.2d.engine.webgl");function u(e){return(0,l.isNumber)(e.minDataValue)&&(0,l.isNumber)(e.maxDataValue)&&null!=e.minSize&&null!=e.maxSize?a.WGLVVFlag.SIZE_MINMAX_VALUE:(e.expression&&"view.scale"===e.expression||e.valueExpression&&"$view.scale"===e.valueExpression)&&Array.isArray(e.stops)?a.WGLVVFlag.SIZE_SCALE_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&(Array.isArray(e.stops)||"levels"in e&&e.levels)?a.WGLVVFlag.SIZE_FIELD_STOPS:(null!=e.field||e.expression&&"view.scale"!==e.expression||e.valueExpression&&"$view.scale"!==e.valueExpression)&&null!=e.valueUnit?a.WGLVVFlag.SIZE_UNIT_VALUE:(o.error(new(0,s.default)("mapview-bad-type","Found invalid size VisualVariable",e)),a.WGLVVFlag.NONE)}})),t.register("4TsVR",(function(t,i){e(t.exports,"outputTypes",(function(){return r})),e(t.exports,"createMD5Hash",(function(){return h}));const r={Base64:0,Hex:1,String:2,Raw:3};function s(e,t){const i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i}function n(e,t,i,r,n,a){return s((l=s(s(t,e),s(r,a)))<<(o=n)|l>>>32-o,i);var l,o}function a(e,t,i,r,s,a,l){return n(t&i|~t&r,e,t,s,a,l)}function l(e,t,i,r,s,a,l){return n(t&r|i&~r,e,t,s,a,l)}function o(e,t,i,r,s,a,l){return n(t^i^r,e,t,s,a,l)}function u(e,t,i,r,s,a,l){return n(i^(t|~r),e,t,s,a,l)}function h(e,t=r.Hex){const i=t||r.Base64,n=function(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;let i=1732584193,r=-271733879,n=-1732584194,h=271733878;for(let t=0;t<e.length;t+=16){const c=i,d=r,p=n,f=h;i=a(i,r,n,h,e[t+0],7,-680876936),h=a(h,i,r,n,e[t+1],12,-389564586),n=a(n,h,i,r,e[t+2],17,606105819),r=a(r,n,h,i,e[t+3],22,-1044525330),i=a(i,r,n,h,e[t+4],7,-176418897),h=a(h,i,r,n,e[t+5],12,1200080426),n=a(n,h,i,r,e[t+6],17,-1473231341),r=a(r,n,h,i,e[t+7],22,-45705983),i=a(i,r,n,h,e[t+8],7,1770035416),h=a(h,i,r,n,e[t+9],12,-1958414417),n=a(n,h,i,r,e[t+10],17,-42063),r=a(r,n,h,i,e[t+11],22,-1990404162),i=a(i,r,n,h,e[t+12],7,1804603682),h=a(h,i,r,n,e[t+13],12,-40341101),n=a(n,h,i,r,e[t+14],17,-1502002290),r=a(r,n,h,i,e[t+15],22,1236535329),i=l(i,r,n,h,e[t+1],5,-165796510),h=l(h,i,r,n,e[t+6],9,-1069501632),n=l(n,h,i,r,e[t+11],14,643717713),r=l(r,n,h,i,e[t+0],20,-373897302),i=l(i,r,n,h,e[t+5],5,-701558691),h=l(h,i,r,n,e[t+10],9,38016083),n=l(n,h,i,r,e[t+15],14,-660478335),r=l(r,n,h,i,e[t+4],20,-405537848),i=l(i,r,n,h,e[t+9],5,568446438),h=l(h,i,r,n,e[t+14],9,-1019803690),n=l(n,h,i,r,e[t+3],14,-187363961),r=l(r,n,h,i,e[t+8],20,1163531501),i=l(i,r,n,h,e[t+13],5,-1444681467),h=l(h,i,r,n,e[t+2],9,-51403784),n=l(n,h,i,r,e[t+7],14,1735328473),r=l(r,n,h,i,e[t+12],20,-1926607734),i=o(i,r,n,h,e[t+5],4,-378558),h=o(h,i,r,n,e[t+8],11,-2022574463),n=o(n,h,i,r,e[t+11],16,1839030562),r=o(r,n,h,i,e[t+14],23,-35309556),i=o(i,r,n,h,e[t+1],4,-1530992060),h=o(h,i,r,n,e[t+4],11,1272893353),n=o(n,h,i,r,e[t+7],16,-155497632),r=o(r,n,h,i,e[t+10],23,-1094730640),i=o(i,r,n,h,e[t+13],4,681279174),h=o(h,i,r,n,e[t+0],11,-358537222),n=o(n,h,i,r,e[t+3],16,-722521979),r=o(r,n,h,i,e[t+6],23,76029189),i=o(i,r,n,h,e[t+9],4,-640364487),h=o(h,i,r,n,e[t+12],11,-421815835),n=o(n,h,i,r,e[t+15],16,530742520),r=o(r,n,h,i,e[t+2],23,-995338651),i=u(i,r,n,h,e[t+0],6,-198630844),h=u(h,i,r,n,e[t+7],10,1126891415),n=u(n,h,i,r,e[t+14],15,-1416354905),r=u(r,n,h,i,e[t+5],21,-57434055),i=u(i,r,n,h,e[t+12],6,1700485571),h=u(h,i,r,n,e[t+3],10,-1894986606),n=u(n,h,i,r,e[t+10],15,-1051523),r=u(r,n,h,i,e[t+1],21,-2054922799),i=u(i,r,n,h,e[t+8],6,1873313359),h=u(h,i,r,n,e[t+15],10,-30611744),n=u(n,h,i,r,e[t+6],15,-1560198380),r=u(r,n,h,i,e[t+13],21,1309151649),i=u(i,r,n,h,e[t+4],6,-145523070),h=u(h,i,r,n,e[t+11],10,-1120210379),n=u(n,h,i,r,e[t+2],15,718787259),r=u(r,n,h,i,e[t+9],21,-343485551),i=s(i,c),r=s(r,d),n=s(n,p),h=s(h,f)}return[i,r,n,h]}(function(e){const t=[];for(let i=0,r=8*e.length;i<r;i+=8)t[i>>5]|=(255&e.charCodeAt(i/8))<<i%32;return t}(e),8*e.length);switch(i){case r.Raw:return n;case r.Hex:return function(e){const t="0123456789abcdef",i=[];for(let r=0,s=4*e.length;r<s;r++)i.push(t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15));return i.join("")}(n);case r.String:return function(e){const t=[];for(let i=0,r=32*e.length;i<r;i+=8)t.push(String.fromCharCode(e[i>>5]>>>i%32&255));return t.join("")}(n);case r.Base64:return function(e){const t=[];for(let i=0,r=4*e.length;i<r;i+=3){const r=(e[i>>2]>>i%4*8&255)<<16|(e[i+1>>2]>>(i+1)%4*8&255)<<8|e[i+2>>2]>>(i+2)%4*8&255;for(let s=0;s<4;s++)8*i+6*s>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(r>>6*(3-s)&63))}return t.join("")}(n)}}})),t.register("jrPhy",(function(i,r){e(i.exports,"Container",(function(){return l}));var s=t("jsolS"),n=t("coJUt"),a=t("5aS5k");class l extends a.DisplayObject{get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender()}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach((t=>t.clips=e))}get computedEffects(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effects)?e:null}get effect(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effect)?e:""}set effect(e){(this._effectView||e)&&(this._effectView||(this._effectView=new(0,n.EffectView)),this._effectView.effect=e,this.requestRender())}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._effectView&&(this._effectView.transitionStep(e,t),this._effectView.transitioning&&this.requestRender())}doRender(e){const t=this.createRenderParams(e);this.renderChildren(t)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;const i=e.parent;return i&&i!==this&&i.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}contains(e){return this._childrenSet.has(e)}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;const t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}sortChildren(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}_createTransforms(){return{dvs:(0,s.c)()}}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){for(const t of this.children)t.beforeRender(e);for(const t of this.children)t.processRender(e);for(const t of this.children)t.afterRender(e)}createRenderParams(e){return{...e,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition}}constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this.children=[],this._effectView=null}}})),t.register("5aS5k",(function(i,r){e(i.exports,"DisplayObject",(function(){return u}));var s=t("cS4u3"),n=t("5HTPH"),a=t("1CpCt"),l=t("lHg4e");const o=1/(0,n.default)("mapview-transitions-duration");class u extends s.default{get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return(0,a.isNone)(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=(0,l.createResolver)(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=(0,l.createResolver)(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;null==(e=this.parent)||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,t){if(this.fadeTransitionEnabled){const t=this._fadeOutResolver||!this.visible?0:this.opacity,i=this.computedOpacity;if(i===t)this.computedVisible=this.visible;else{const r=e*o;this.computedOpacity=i>t?Math.max(t,i-r):Math.min(t,i+r),this.computedVisible=this.computedOpacity>0;const s=t===this.computedOpacity;this.inFadeTransition=!s,s||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}}})),t.register("6hadY",(function(i,r){e(i.exports,"getRequiredFields",(function(){return a})),e(i.exports,"getFetchPopupTemplate",(function(){return l}));var s=t("1CpCt"),n=t("15IfA");async function a(e,t=e.popupTemplate){if(!(0,s.isSome)(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:r}=t,{objectIdField:a,typeIdField:l,globalIdField:o,relationships:u}=e;if(i.includes("*"))return["*"];const h=r?await(0,n.getFeatureEditFields)(e):[],c=(0,n.fixFields)(e.fieldsIndex,[...i,...h]);return l&&c.push(l),c&&a&&e.fieldsIndex.has(a)&&-1===c.indexOf(a)&&c.push(a),c&&o&&e.fieldsIndex.has(o)&&-1===c.indexOf(o)&&c.push(o),u&&u.forEach((t=>{const{keyField:i}=t;c&&i&&e.fieldsIndex.has(i)&&-1===c.indexOf(i)&&c.push(i)})),c}function l(e,t){return e.popupTemplate?e.popupTemplate:(0,s.isSome)(t)&&t.defaultPopupTemplateEnabled&&(0,s.isSome)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}));
//# sourceMappingURL=FeatureLayerView2D.ab017adb.js.map
