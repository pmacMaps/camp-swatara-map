{"mappings":"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","sources":["node_modules/@arcgis/core/renderers/support/DictionaryLoader.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.23/esri/copyright.txt for details.\n*/\nimport e from\"../../Color.js\";import t from\"../../request.js\";import s from\"../../core/Error.js\";import o from\"../../core/Logger.js\";import i from\"../../core/LRUCache.js\";import{isSome as r}from\"../../core/maybe.js\";import{isAbortError as n}from\"../../core/promiseUtils.js\";import{numericHash as l}from\"../../core/string.js\";import{loadArcade as a,createDictionaryExpression as c}from\"../../support/arcadeOnDemand.js\";import m from\"../../symbols/CIMSymbol.js\";const f=o.getLogger(\"esri.renderers.support.DictionaryLoader\"),h={type:\"CIMSimpleLineCallout\",lineSymbol:{type:\"CIMLineSymbol\",symbolLayers:[{type:\"CIMSolidStroke\",width:.5,color:[0,0,0,255]}]}};class y{constructor(e,t,s){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new i(100),this.url=e,this.config=t,this.fieldMap=s}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,s){let o;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(s));try{o=await this._dictionaryPromise}catch(b){if(n(b))return this._dictionaryPromise=null,null}const i={};if(this.fieldMap)for(const e of this._symbolFields){const s=this.fieldMap[e];if(s&&null!=t.attributes[s]){const o=\"\"+t.attributes[s];i[e]=o}else i[e]=\"\"}const a=o(i,s);if(!a||\"string\"!=typeof a)return null;const c=l(a).toString(),m=this._symbolCache.get(c);if(m)return m.catch((()=>{this._symbolCache.pop(c)})),m;const f=a.split(\";\"),h=[],y=[];for(const r of f)if(r)if(r.includes(\"po:\")){const t=r.substr(3).split(\"|\");if(3===t.length){const s=t[0],o=t[1];let i=t[2];if(\"DashTemplate\"===o)i=i.split(\" \").map((e=>Number(e)));else if(\"Color\"===o){const t=new e(i).toRgba();i=[t[0],t[1],t[2],255*t[3]]}else i=Number(i);y.push({primitiveName:s,propertyName:o,value:i})}}else if(r.includes(\"|\")){for(const e of r.split(\"|\"))if(this._itemNames.has(e)){h.push(e);break}}else this._itemNames.has(r)&&h.push(r);const u=!r(t.geometry)||!t.geometry.hasZ&&\"point\"===t.geometry.type,p=this._cimPartsToCIMSymbol(h,y,u,s);return this._symbolCache.put(c,p,1),p}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void f.error(\"no valid URL!\");const o=r(e)?e.abortOptions:null,i=t(this.url+\"/resources/styles/dictionary-info.json\",{responseType:\"json\",query:{f:\"json\"},...o}),[{data:n}]=await Promise.all([i,a()]);if(!n)throw this._dictionaryPromise=null,new s(\"esri.renderers.DictionaryRenderer\",\"Bad dictionary data!\");const l=n.expression,m=n.authoringInfo;this._refSymbolUrlTemplate=this.url+\"/\"+n.cimRefTemplateUrl,this._itemNames=new Set(n.itemsNames),this._symbolFields=m.symbol;const h={};if(this.config){const e=this.config;for(const t in e)h[t]=e[t]}if(m.configuration)for(const t of m.configuration)h.hasOwnProperty(t.name)||(h[t.name]=t.value);const y=[];if(r(e)&&e.fields&&this.fieldMap)for(const t of this._symbolFields){const s=this.fieldMap[t],o=e.fields.filter((e=>e.name===s));o.length>0&&y.push({...o[0],name:t})}return this._dictionaryPromise=c(l,r(e)?e.spatialReference:null,y,h).then((e=>{const t={scale:0};return(s,o)=>{const i=e.repurposeFeature({geometry:null,attributes:s});return t.scale=r(o)?o.scale:void 0,e.evaluate({$feature:i,$view:t})}})).catch((e=>(f.error(\"Creating dictinoary expression failed:\",e),null))),this._dictionaryPromise}async _cimPartsToCIMSymbol(e,t,s,o){const i=new Array(e.length);for(let l=0;l<e.length;l++)i[l]=this._getSymbolPart(e[l],o);const r=await Promise.all(i),n=this.fieldMap;for(const l of r)u(l,n);return new m({data:this._combineSymbolParts(r,t,s)})}async _getSymbolPart(e,s){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then((e=>e.data));const o=this._refSymbolUrlTemplate.replace(/\\{itemName\\}/gi,e),i=t(o,{responseType:\"json\",query:{f:\"json\"},...s});this._ongoingRequests.set(e,i);try{return(await i).data}catch(r){return this._ongoingRequests.delete(e),Promise.reject(r)}}_combineSymbolParts(e,t,s){if(!e||0===e.length)return null;const o={...e[0]};if(e.length>1){o.symbolLayers=[];for(const t of e){const e=t;o.symbolLayers.unshift(...e.symbolLayers)}}return s&&(o.callout=h),{type:\"CIMSymbolReference\",symbol:o,primitiveOverrides:t}}}function u(e,t){if(!e)return;const s=e.symbolLayers;if(!s)return;let o=s.length;for(;o--;){const e=s[o];if(e&&!1!==e.enable&&\"CIMVectorMarker\"===e.type)p(e,t)}}function p(e,t){const s=e.markerGraphics;if(s)for(const o of s){if(!o)continue;const e=o.symbol;if(e)switch(e.type){case\"CIMPointSymbol\":case\"CIMLineSymbol\":case\"CIMPolygonSymbol\":u(e,t);break;case\"CIMTextSymbol\":e.fieldMap=t}}}export{y as DictionaryLoader};\n"],"names":["$hJt7u","parcelRequire","$4328f3994b70c129$var$f","$6TszD","default","getLogger","$4328f3994b70c129$var$h","type","lineSymbol","symbolLayers","width","color","$4328f3994b70c129$export$a2ce741e0d1b8eca","getSymbolFields","this","_symbolFields","async","t1","s1","o1","_dictionaryPromise","fetchResources","b","$lHg4e","isAbortError","i1","fieldMap","e1","s2","attributes","o2","a1","c1","$29Fuv","numericHash","toString","m1","_symbolCache","get","catch","pop","f1","split","h1","y1","r1","includes","t2","substr","length","s3","o3","i2","map","e2","Number","t3","toRgba","push","primitiveName","propertyName","value","e3","_itemNames","has","u1","$1CpCt","isSome","geometry","hasZ","p1","_cimPartsToCIMSymbol","put","e4","url","error","o4","abortOptions","i3","$bYA0c","responseType","query","f","data","n1","Promise","all","$QiKdE","loadArcade","$bPmsI","l1","expression","m2","authoringInfo","_refSymbolUrlTemplate","cimRefTemplateUrl","Set","itemsNames","symbol","h2","config","e5","t6","configuration","t5","hasOwnProperty","name","y2","fields","t4","s4","o5","filter","e6","createDictionaryExpression","spatialReference","then","e7","t7","scale","s5","o6","i4","repurposeFeature","evaluate","$feature","$view","e8","e9","t8","s6","o7","i5","Array","l3","_getSymbolPart","r2","n2","l2","$4328f3994b70c129$var$u","$dRXfp","_combineSymbolParts","e10","s7","_ongoingRequests","e11","o8","replace","i6","set","r3","delete","reject","e12","t10","s8","o9","t9","e13","unshift","callout","primitiveOverrides","constructor","e14","t11","s9","Map","$c8bTS","e15","t12","s10","o10","e16","enable","$4328f3994b70c129$var$p","e17","t13","s11","markerGraphics","o11","e18"],"version":3,"file":"DictionaryLoader.a79335a6.js.map"}