!function(){function e(e){return e&&e.__esModule?e.default:e}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("dyiP8",(function(t,n){var a,i,s,o;a=t.exports,i="DictionaryLoader",s=function(){return S},Object.defineProperty(a,i,{get:s,set:o,enumerable:!0,configurable:!0});var u=r("8TSCy"),l=r("2TvXO"),c=r("jgs9n"),f=r("9pNSx"),p=r("kyj08"),b=r("jHOLN"),y=r("crS0R"),m=r("7qybv"),d=r("10vEZ"),v=r("1TSdR"),h=r("3nnTb"),x=r("d2VJI"),g=b.default.getLogger("esri.renderers.support.DictionaryLoader"),k={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}},S=function(){"use strict";function r(e,t,n){u.classCallCheck(this,r),this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new(0,y.default)(100),this.url=e,this.config=t,this.fieldMap=n}return u.createClass(r,[{key:"getSymbolFields",value:function(){return this._symbolFields}},{key:"getSymbolAsync",value:function(r,t){var n=this;return u.asyncToGenerator(e(l).mark((function a(){var i,s,o,u,f,p,b,y,h,x,g,k,S,_,w,C,P,M,T,R,j,I,L,N,q,A,F,O,D,G,U,E,H,V,Z;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n._dictionaryPromise||(n._dictionaryPromise=n.fetchResources(t)),e.prev=2,e.next=5,n._dictionaryPromise;case 5:i=e.sent,e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(2),!(0,d.isAbortError)(e.t0)){e.next=12;break}return e.abrupt("return",(n._dictionaryPromise=null,null));case 12:if(s={},o=!0,u=!1,f=void 0,!n.fieldMap){e.next=31;break}for(e.prev=15,p=n._symbolFields[Symbol.iterator]();!(o=(b=p.next()).done);o=!0)y=b.value,(h=n.fieldMap[y])&&null!=r.attributes[h]?(x=""+r.attributes[h],s[y]=x):s[y]="";e.next=23;break;case 19:e.prev=19,e.t1=e.catch(15),u=!0,f=e.t1;case 23:e.prev=23,e.prev=24,o||null==p.return||p.return();case 26:if(e.prev=26,!u){e.next=29;break}throw f;case 29:return e.finish(26);case 30:return e.finish(23);case 31:if((g=i(s,t))&&"string"==typeof g){e.next=34;break}return e.abrupt("return",null);case 34:if(k=(0,v.numericHash)(g).toString(),!(S=n._symbolCache.get(k))){e.next=37;break}return e.abrupt("return",(S.catch((function(){n._symbolCache.pop(k)})),S));case 37:_=g.split(";"),w=[],C=[],P=!0,M=!1,T=void 0,e.prev=39,R=_[Symbol.iterator]();case 41:if(P=(j=R.next()).done){e.next=80;break}if(!(I=j.value)){e.next=77;break}if(!I.includes("po:")){e.next=48;break}3===(L=I.substr(3).split("|")).length&&(N=L[0],q=L[1],A=L[2],"DashTemplate"===q?A=A.split(" ").map((function(e){return Number(e)})):"Color"===q?(F=new(0,c.default)(A).toRgba(),A=[F[0],F[1],F[2],255*F[3]]):A=Number(A),C.push({primitiveName:N,propertyName:q,value:A})),e.next=77;break;case 48:if(!I.includes("|")){e.next=76;break}O=!0,D=!1,G=void 0,e.prev=50,U=I.split("|")[Symbol.iterator]();case 52:if(O=(E=U.next()).done){e.next=60;break}if(H=E.value,!n._itemNames.has(H)){e.next=57;break}return w.push(H),e.abrupt("break",60);case 57:O=!0,e.next=52;break;case 60:e.next=66;break;case 62:e.prev=62,e.t2=e.catch(50),D=!0,G=e.t2;case 66:e.prev=66,e.prev=67,O||null==U.return||U.return();case 69:if(e.prev=69,!D){e.next=72;break}throw G;case 72:return e.finish(69);case 73:return e.finish(66);case 74:e.next=77;break;case 76:n._itemNames.has(I)&&w.push(I);case 77:P=!0,e.next=41;break;case 80:e.next=86;break;case 82:e.prev=82,e.t3=e.catch(39),M=!0,T=e.t3;case 86:e.prev=86,e.prev=87,P||null==R.return||R.return();case 89:if(e.prev=89,!M){e.next=92;break}throw T;case 92:return e.finish(89);case 93:return e.finish(86);case 94:return V=!(0,m.isSome)(r.geometry)||!r.geometry.hasZ&&"point"===r.geometry.type,Z=n._cimPartsToCIMSymbol(w,C,V,t),e.abrupt("return",(n._symbolCache.put(k,Z,1),Z));case 96:case"end":return e.stop()}}),a,null,[[2,8],[15,19,23,31],[24,,26,30],[39,82,86,94],[50,62,66,74],[67,,69,73],[87,,89,93]])})))()}},{key:"fetchResources",value:function(r){var t=this;return u.asyncToGenerator(e(l).mark((function n(){var a,i,s,o,c,b,y,d,v,x,k,S,_,w,C,P,M,T,R,j,I,L,N,q,A;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t._dictionaryPromise){e.next=2;break}return e.abrupt("return",t._dictionaryPromise);case 2:if(t.url){e.next=4;break}return e.abrupt("return",void g.error("no valid URL!"));case 4:return a=(0,m.isSome)(r)?r.abortOptions:null,i=(0,f.default)(t.url+"/resources/styles/dictionary-info.json",u.objectSpread({responseType:"json",query:{f:"json"}},a)),e.t0=u,e.next=9,Promise.all([i,(0,h.loadArcade)()]);case 9:if(e.t1=e.sent,s=e.t0.slicedToArray.call(e.t0,e.t1,1),o=s[0],c=o.data){e.next=15;break}throw t._dictionaryPromise=null,new(0,p.default)("esri.renderers.DictionaryRenderer","Bad dictionary data!");case 15:if(b=c.expression,y=c.authoringInfo,t._refSymbolUrlTemplate=t.url+"/"+c.cimRefTemplateUrl,t._itemNames=new Set(c.itemsNames),t._symbolFields=y.symbol,d={},t.config)for(x in v=t.config)d[x]=v[x];if(k=!0,S=!1,_=void 0,!y.configuration){e.next=37;break}for(e.prev=21,w=y.configuration[Symbol.iterator]();!(k=(C=w.next()).done);k=!0)P=C.value,d.hasOwnProperty(P.name)||(d[P.name]=P.value);e.next=29;break;case 25:e.prev=25,e.t2=e.catch(21),S=!0,_=e.t2;case 29:e.prev=29,e.prev=30,k||null==w.return||w.return();case 32:if(e.prev=32,!S){e.next=35;break}throw _;case 35:return e.finish(32);case 36:return e.finish(29);case 37:if(M=[],T=!0,R=!1,j=void 0,!((0,m.isSome)(r)&&r.fields&&t.fieldMap)){e.next=56;break}for(e.prev=40,I=t._symbolFields[Symbol.iterator]();!(T=(L=I.next()).done);T=!0)N=L.value,q=t.fieldMap[N],(A=r.fields.filter((function(e){return e.name===q}))).length>0&&M.push(u.objectSpread({},A[0],{name:N}));e.next=48;break;case 44:e.prev=44,e.t3=e.catch(40),R=!0,j=e.t3;case 48:e.prev=48,e.prev=49,T||null==I.return||I.return();case 51:if(e.prev=51,!R){e.next=54;break}throw j;case 54:return e.finish(51);case 55:return e.finish(48);case 56:return e.abrupt("return",(t._dictionaryPromise=(0,h.createDictionaryExpression)(b,(0,m.isSome)(r)?r.spatialReference:null,M,d).then((function(e){var r={scale:0};return function(t,n){var a=e.repurposeFeature({geometry:null,attributes:t});return r.scale=(0,m.isSome)(n)?n.scale:void 0,e.evaluate({$feature:a,$view:r})}})).catch((function(e){return g.error("Creating dictinoary expression failed:",e),null})),t._dictionaryPromise));case 57:case"end":return e.stop()}}),n,null,[[21,25,29,37],[30,,32,36],[40,44,48,56],[49,,51,55]])})))()}},{key:"_cimPartsToCIMSymbol",value:function(r,t,n,a){var i=this;return u.asyncToGenerator(e(l).mark((function s(){var o,u,c,f,p,b,y,m,d;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=new Array(r.length),u=0;u<r.length;u++)o[u]=i._getSymbolPart(r[u],a);return e.next=4,Promise.all(o);case 4:for(c=e.sent,f=i.fieldMap,p=!0,b=!1,y=void 0,e.prev=7,m=c[Symbol.iterator]();!(p=(d=m.next()).done);p=!0)_(d.value,f);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),b=!0,y=e.t0;case 15:e.prev=15,e.prev=16,p||null==m.return||m.return();case 18:if(e.prev=18,!b){e.next=21;break}throw y;case 21:return e.finish(18);case 22:return e.finish(15);case 23:return e.abrupt("return",new(0,x.default)({data:i._combineSymbolParts(c,t,n)}));case 24:case"end":return e.stop()}}),s,null,[[7,11,15,23],[16,,18,22]])})))()}},{key:"_getSymbolPart",value:function(r,t){var n=this;return u.asyncToGenerator(e(l).mark((function a(){var i,s;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n._ongoingRequests.has(r)){e.next=2;break}return e.abrupt("return",n._ongoingRequests.get(r).then((function(e){return e.data})));case 2:return i=n._refSymbolUrlTemplate.replace(/\{itemName\}/gi,r),s=(0,f.default)(i,u.objectSpread({responseType:"json",query:{f:"json"}},t)),n._ongoingRequests.set(r,s),e.prev=4,e.next=7,s;case 7:return e.abrupt("return",e.sent.data);case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",(n._ongoingRequests.delete(r),Promise.reject(e.t0)));case 13:case"end":return e.stop()}}),a,null,[[4,10]])})))()}},{key:"_combineSymbolParts",value:function(e,r,t){if(!e||0===e.length)return null;var n=u.objectSpread({},e[0]);if(e.length>1){n.symbolLayers=[];var a=!0,i=!1,s=void 0;try{for(var o,l=e[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var c,f=o.value;(c=n.symbolLayers).unshift.apply(c,u.toConsumableArray(f.symbolLayers))}}catch(e){i=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(i)throw s}}}return t&&(n.callout=k),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:r}}}]),r}();function _(e,r){if(e){var t=e.symbolLayers;if(t)for(var n=t.length;n--;){var a=t[n];a&&!1!==a.enable&&"CIMVectorMarker"===a.type&&w(a,r)}}}function w(e,r){var t=e.markerGraphics,n=!0,a=!1,i=void 0;if(t)try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value;if(u){var l=u.symbol;if(l)switch(l.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":_(l,r);break;case"CIMTextSymbol":l.fieldMap=r}}}}catch(e){a=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}}))}();
//# sourceMappingURL=DictionaryLoader.37d66442.js.map
