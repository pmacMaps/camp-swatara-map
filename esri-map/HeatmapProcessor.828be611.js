!function(){function e(e,t,r,o){Object.defineProperty(e,t,{get:r,set:o,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("8hKBq",(function(r,o){var i;i=r.exports,Object.defineProperty(i,"__esModule",{value:!0,configurable:!0}),e(r.exports,"default",(function(){return h}));var s=t("7eJjO");t("2VlWd");var n=t("7qybv");t("jHOLN"),t("iJAIC"),t("lNwWH"),t("62edV");var a=t("fcwIv"),l=t("9doMy"),d=t("e51b3"),c=t("4WoSm"),p=t("fUO9S"),y=t("6r3ht");class u{constructor(e,t){this.offset=e,this.extent=t}}let f=class extends p.default{initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}async update(e,t){const r=t.schema.processors[0];"heatmap"===r.type&&(0,l.diff)(this._schema,r)&&(e.mesh=!0,this._schema=r)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}async onTileMessage(e,t,r){this._tileKeyToFeatureSets.has(e.key.id)||this._tileKeyToFeatureSets.set(e.key.id,new Map);const o=this._tileKeyToFeatureSets.get(e.key.id);if((0,n.isSome)(t.addOrUpdate)&&t.addOrUpdate.hasFeatures&&o.set(t.addOrUpdate.instance,t),t.end){const t=[],o=function(e){const t=e.key,r=new Map,o=256,i=c.TILE_SIZE,s=e.tileInfoView.tileInfo.isWrappable;return r.set((0,y.getPow2NeighborKey)(t,-1,-1,s).id,new u([-i,-i],[i-o,i-o,i,i])),r.set((0,y.getPow2NeighborKey)(t,0,-1,s).id,new u([0,-i],[0,i-o,i,i])),r.set((0,y.getPow2NeighborKey)(t,1,-1,s).id,new u([i,-i],[0,i-o,o,i])),r.set((0,y.getPow2NeighborKey)(t,-1,0,s).id,new u([-i,0],[i-o,0,i,i])),r.set((0,y.getPow2NeighborKey)(t,1,0,s).id,new u([i,0],[0,0,o,i])),r.set((0,y.getPow2NeighborKey)(t,-1,1,s).id,new u([-i,i],[i-o,0,i,o])),r.set((0,y.getPow2NeighborKey)(t,0,1,s).id,new u([0,i],[0,0,i,o])),r.set((0,y.getPow2NeighborKey)(t,1,1,s).id,new u([i,i],[0,0,o,o])),r}(e);this._tileKeyToFeatureSets.forEach(((r,i)=>{if(i===e.key.id)r.forEach((e=>(0,n.applySome)(e.addOrUpdate,(e=>t.push(e)))));else if(o.has(i)){const e=o.get(i),[s,a]=e.offset;r.forEach((e=>(0,n.applySome)(e.addOrUpdate,(e=>{const r=e.transform(s,a,1,1);t.push(r)}))))}}));const i=(0,d.calculateHeatmapIntensityInfoReaders)(t,this._schema.mesh,512,512),s={tileKey:e.key.id,intensityInfo:i},a=[i.matrix];return this.remoteClient.invoke("tileRenderer.onTileData",s,{...r,transferList:a})}}onTileError(e,t,r){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},r)}constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}};f=(0,s._)([(0,a.subclass)("esri.views.2d.layers.features.processors.HeatmapProcessor")],f);const h=f})),t.register("fUO9S",(function(r,o){e(r.exports,"default",(function(){return d}));var i=t("7eJjO"),s=t("6dXDO"),n=t("iho5X");t("lNwWH"),t("2VlWd"),t("iJAIC");var a=t("fcwIv");let l=class extends s.HandleOwner{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};(0,i._)([(0,n.property)({readOnly:!0})],l.prototype,"supportsTileUpdates",null),(0,i._)([(0,n.property)({constructOnly:!0})],l.prototype,"remoteClient",void 0),(0,i._)([(0,n.property)({constructOnly:!0})],l.prototype,"service",void 0),(0,i._)([(0,n.property)()],l.prototype,"spatialReference",null),(0,i._)([(0,n.property)({constructOnly:!0})],l.prototype,"tileInfo",void 0),(0,i._)([(0,n.property)({constructOnly:!0})],l.prototype,"tileStore",void 0),l=(0,i._)([(0,a.subclass)("esri.views.2d.layers.features.processors.BaseProcessor")],l);const d=l})),t.register("6r3ht",(function(r,o){e(r.exports,"getPow2NeighborKey",(function(){return i}));t("2Z8dq");function i(e,t,r,o){const i=e.clone(),s=1<<i.level,n=i.col+t,a=i.row+r;return o&&n<0?(i.col=n+s,i.world-=1):n>=s?(i.col=n-s,i.world+=1):i.col=n,i.row=a,i}}))}();
//# sourceMappingURL=HeatmapProcessor.828be611.js.map
