!function(){function e(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("4rXhP",(function(t,i){e(t.exports,"MeshData",(function(){return d}));var n=r("8TSCy");r("3yhCg"),r("cqGfY");var a=r("i90gL");r("eX6AZ"),r("gZ2KV");var s=r("4WoSm"),o=r("ieqnL"),l=r("66IJZ"),u=r("5WctK"),c=r("8PFQB"),h=r("6r3ht"),f=128;function p(e){switch(e){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case f:return 1}}function y(e){switch(e){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case f:return 1}}var d=function(){"use strict";function e(t,r,i,a,s){n.classCallCheck(this,e),this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=r,this.tileKey=t,this._hasAggregate=a,this._pixelBufferEnabled=s,this._strideOptions=i}return n.createClass(e,[{key:"hasAggregates",get:function(){return this._hasAggregate}},{key:"hasPixelBufferEnabled",get:function(){return this._pixelBufferEnabled}},{key:"serialize",value:function(e){var t=this,r=[];return r.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((function(i,n){var s=1<<n,o=p(s),l=y(s),u=(0,h.getPow2NeighborKey)(new(0,a.default)(t.tileKey),o,l,e),c=t._serializeTileVertexData(t.tileKey,u.id,i.vertexData);c.message.bufferIds=i.displayIds,r.push(c)})),r}},{key:"_serializeTileVertexData",value:function(e,t,r){var i,a,s,o,u,c,h=new Array;return{message:{tileKeyOrigin:e,tileKey:t,data:(c={},n.defineProperty(c,l.WGLGeometryType.MARKER,null==(i=r.get(l.WGLGeometryType.MARKER))?void 0:i.serialize(h)),n.defineProperty(c,l.WGLGeometryType.FILL,null==(a=r.get(l.WGLGeometryType.FILL))?void 0:a.serialize(h)),n.defineProperty(c,l.WGLGeometryType.LINE,null==(s=r.get(l.WGLGeometryType.LINE))?void 0:s.serialize(h)),n.defineProperty(c,l.WGLGeometryType.TEXT,null==(o=r.get(l.WGLGeometryType.TEXT))?void 0:o.serialize(h)),n.defineProperty(c,l.WGLGeometryType.LABEL,null==(u=r.get(l.WGLGeometryType.LABEL))?void 0:u.serialize(h)),c)},transferList:h}}},{key:"featureStart",value:function(e,t){this._current.insertAfter=e,this._current.sortKey=t}},{key:"featureEnd",value:function(){}},{key:"recordStart",value:function(e,t,r,i){this._current.writer=this._getVertexWriter(r),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=i,this._current.id=e,this._current.materialKey=t,this._current.geometryType=r,this._current.isDotDensity=!1,this._current.writer.recordStart()}},{key:"recordCount",value:function(){return this._current.writer.recordCount}},{key:"vertexCount",value:function(){return this._current.writer.vertexCount}},{key:"indexCount",value:function(){return this._current.writer.indexCount}},{key:"vertexEnsureSize",value:function(e){this._current.writer.vertexEnsureSize(e)}},{key:"indexEnsureSize",value:function(e){this._current.writer.indexEnsureSize(e)}},{key:"vertexBounds",value:function(e,t,r,i){this._current.bufferingEnabled&&this._addOverlap(e,t,r,i)}},{key:"vertexWrite",value:function(e){this._current.writer.writeVertex(e)}},{key:"vertexWriteF32",value:function(e){this._current.writer.writeVertexF32(e)}},{key:"vertexEnd",value:function(){}},{key:"vertexWriter",value:function(){return this._current.writer.vertexWriter}},{key:"indexWrite",value:function(e){this._current.writer.writeIndex(e)}},{key:"indexWriter",value:function(){return this._current.writer.indexWriter}},{key:"metricWriter",value:function(){return this._current.writer.metricWriter}},{key:"metricStart",value:function(e,t,r,i,n,a,s,u){this._current.writer=this._getVertexWriter(l.WGLGeometryType.LABEL);var c=this._current.writer.metricWriter;c.push((0,o.getDisplayIdTexel)(e)),c.push(t),c.push(r),c.push(i),c.push(n),c.push(a),c.push(s),c.push(u),c.push(255),this._current.metricBoxLenPointer=c.push(0)}},{key:"metricEnd",value:function(){var e=this._current.writer.metricWriter;0===e.getValue(this._current.metricBoxLenPointer)&&e.seek(e.length-10)}},{key:"metricBoxWrite",value:function(e,t,r,i){var n=this._current.writer.metricWriter;n.incr(this._current.metricBoxLenPointer),n.push(0),n.push(0),n.push(e),n.push(t),n.push(r),n.push(i)}},{key:"recordEnd",value:function(){var e=this._current.vertStart,t=this._current.writer.vertexCount-e;if(!t)return!1;this.hasRecords=!0;var r=this._current.indexStart,i=this._current.writer.indexCount-r;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,r,i,e,t,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===l.WGLGeometryType.LABEL)return!0;for(var n=this._current.writer,a=0;a<8;a++){var o=1<<a;if(this._current.overlaps&o){this._data.neighbors[a]||(this._data.neighbors[a]={vertexData:new Map,displayIds:new Set});var h=this._data.neighbors[a],f=this._current.geometryType;if(!h.vertexData.has(f)){var d=(0,u.getStrides)(f,this._strideOptions).geometry,_=new(0,c.VertexDataWriter)(f,d,s.PATCH_PIXEL_BUFFER_ALLOC_SIZE);h.vertexData.set(f,_)}var v=h.vertexData.get(this._current.geometryType),m=512*-p(o)*8,x=512*-y(o)*8;v.copyLastFrom(n,m,x),h.displayIds.add(this._current.id)}}return!0}},{key:"_addOverlap",value:function(e,t,r,i){var n=255^((e<0+r?148:e>=s.TILE_SIZE-r?41:189)|(t<0+i?224:t>=s.TILE_SIZE-i?7:231));this._current.overlaps|=n}},{key:"_getVertexWriter",value:function(e){if(!this._data.self.has(e)){var t=this._data.self,r=(0,u.getStrides)(e,this._strideOptions).geometry;t.set(e,new(0,c.VertexDataWriter)(e,r,this.hint.records))}return this._data.self.get(e)}}]),e}()})),r.register("8PFQB",(function(t,i){e(t.exports,"VertexDataWriter",(function(){return l}));var n=r("8TSCy"),a=r("4WoSm"),s=r("lzJ2e"),o=r("8laiu"),l=function(){"use strict";function e(t,r,i){n.classCallCheck(this,e),this._start={index:0,vertex:0};var a=(0,s.getMeshSizeHint)(t,r,i),l=r/4;this.geometryType=t,this._records=new(0,o.default)(Int32Array,a.recordBytes),this._indices=new(0,o.default)(Uint32Array,a.indexBytes),this._vertices=new(0,o.default)(Uint32Array,a.vertexBytes),this._metrics=new(0,o.default)(Float32Array,0),this._strideInt=l}return n.createClass(e,[{key:"serialize",value:function(e){var t=this._records.buffer(),r=this._indices.buffer(),i=this._vertices.buffer(),n=this._metrics.length?this._metrics.buffer():null,a=4*this._strideInt;return e.push(t,r,i),{stride:a,records:t,indices:r,vertices:i,metrics:n}}},{key:"strideInt",get:function(){return this._strideInt}},{key:"recordCount",get:function(){return this._records.length/a.DISPLAY_RECORD_INT_PER_ELEMENT}},{key:"vertexCount",get:function(){return this._vertices.length/this._strideInt}},{key:"indexCount",get:function(){return this._indices.length}},{key:"indexWriter",get:function(){return this._indices}},{key:"vertexWriter",get:function(){return this._vertices}},{key:"metricWriter",get:function(){return this._metrics}},{key:"vertexEnsureSize",value:function(e){this._vertices.ensureSize(e)}},{key:"indexEnsureSize",value:function(e){this._indices.ensureSize(e)}},{key:"recordStart",value:function(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}},{key:"recordEnd",value:function(e,t,r,i,n,a,s,o){this._records.push(e),this._records.push(t),this._records.push(r),this._records.push(i),this._records.push(n),this._records.push(a),this._records.push(s),this._records.writeF32(o)}},{key:"writeIndex",value:function(e){this._indices.push(e)}},{key:"writeVertex",value:function(e){this._vertices.push(e)}},{key:"writeVertexF32",value:function(e){this._vertices.writeF32(e)}},{key:"copyLastFrom",value:function(e,t,r){for(var i=e._records.length-a.DISPLAY_RECORD_INT_PER_ELEMENT,n=e._records.getValue(i),s=e._records.getValue(i+1),o=e._records.getValue(i+2),l=e._records.getValue(i+4),u=e._records.getValue(i+6),c=e._records.getValue(i+7),h=this._vertices.length,f=(e._start.vertex-this._vertices.length)/this._strideInt,p=this._indices.length,y=this.vertexCount,d=e._start.index;d!==e._indices.length;d++){var _=e._indices.getValue(d);this._indices.push(_-f)}for(var v=e._start.vertex;v!==e._vertices.length;v++){var m=e._vertices.getValue(v);this._vertices.push(m)}for(var x=h;x<=this._vertices.length;x+=this._strideInt)this._vertices.i1616Add(x,t,r);this._records.push(n),this._records.push(s),this._records.push(o),this._records.push(p),this._records.push(l),this._records.push(y),this._records.push(u),this._records.push(c)}}]),e}()})),r.register("lzJ2e",(function(t,i){e(t.exports,"getMeshSizeHint",(function(){return o}));var n=r("4WoSm"),a=r("66IJZ"),s=new Map;function o(e,t,r){var i=s.get(e),a=i.indicesPerRecord,o=i.multiplier,l=i.verticesPerRecord;return{recordBytes:r*n.DISPLAY_RECORD_INT_PER_ELEMENT*Uint32Array.BYTES_PER_ELEMENT,indexBytes:o*a*r*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:o*l*r*t}}s.set(a.WGLGeometryType.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),s.set(a.WGLGeometryType.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),s.set(a.WGLGeometryType.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),s.set(a.WGLGeometryType.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),s.set(a.WGLGeometryType.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4})})),r.register("8laiu",(function(t,i){e(t.exports,"default",(function(){return a}));var n=r("8TSCy"),a=function(){"use strict";function e(t,r){n.classCallCheck(this,e),this._pos=0;var i=r?this._roundToNearest(r,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(i),this._buffer=new t(this._array),this._ctor=t,this._i16View=new Int16Array(this._array)}return n.createClass(e,[{key:"length",get:function(){return this._pos}},{key:"_roundToNearest",value:function(e,t){var r=Math.round(e);return r+(t-r%t)}},{key:"_ensureSize",value:function(e){if(this._pos+e>=this._buffer.length){var t=this._roundToNearest(1.25*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),r=new ArrayBuffer(t),i=new this._ctor(r);i.set(this._buffer,0),this._array=r,this._buffer=i,this._i16View=new Int16Array(this._array)}}},{key:"ensureSize",value:function(e){this._ensureSize(e)}},{key:"writeF32",value:function(e){this._ensureSize(1);var t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}},{key:"push",value:function(e){this._ensureSize(1);var t=this._pos;return this._buffer[this._pos++]=e,t}},{key:"writeFixed",value:function(e){this._buffer[this._pos++]=e}},{key:"setValue",value:function(e,t){this._buffer[e]=t}},{key:"i1616Add",value:function(e,t,r){this._i16View[2*e]+=t,this._i16View[2*e+1]+=r}},{key:"getValue",value:function(e){return this._buffer[e]}},{key:"incr",value:function(e){if(this._buffer.length<e)throw new Error("Increment index overflows the target buffer");this._buffer[e]++}},{key:"decr",value:function(e){this._buffer[e]--}},{key:"writeRegion",value:function(e){this._ensureSize(e.length);var t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}},{key:"writeManyFrom",value:function(e,t,r){this._ensureSize(r-t);for(var i=t;i!==r;i++)this.writeFixed(e._buffer[i])}},{key:"buffer",value:function(){var e=this._array.slice(0,4*this._pos);return this.destroy(),e}},{key:"toArray",value:function(){for(var e=this._array,t=[],r=0;r<e.byteLength/4;r++)t.push(e[r]);return t}},{key:"seek",value:function(e){this._pos=e}},{key:"destroy",value:function(){this._array=null,this._buffer=null}}]),e}()})),r.register("7Vsyp",(function(i,n){e(i.exports,"WGLMeshFactory",(function(){return y}));var a=r("8TSCy"),s=r("2TvXO");r("2VlWd");var o=r("7qybv"),l=r("10vEZ"),u=r("fb8De"),c=r("ieqnL"),h=r("5wFDv"),f=r("02uBX"),p=r("iyMTk"),y=function(){"use strict";function e(t,r,i){a.classCallCheck(this,e),this._loadPromise=(0,u.loadLibtess)(),this._geometryType=t,this._idField=r,this._templateStore=i}return a.createClass(e,[{key:"update",value:function(e,t){(0,o.isSome)(e.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(e.mesh.labels,t)),this._schema=e}},{key:"_createLabelTemplates",value:function(e,t){var r=new Map;if("simple"===e.type){var i=!0,n=!1,a=void 0;try{for(var s,o=e.classes[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var l=s.value,u=h.default.fromLabelClass(l,t);r.set(l.index,u)}}catch(e){n=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(n)throw a}}return r}for(var c in e.classes){var f=e.classes[c],p=!0,y=!1,d=void 0;try{for(var _,v=f[Symbol.iterator]();!(p=(_=v.next()).done);p=!0){var m=_.value,x=h.default.fromLabelClass(m,t);r.set(m.index,x)}}catch(e){y=!0,d=e}finally{try{p||null==v.return||v.return()}finally{if(y)throw d}}}return r}},{key:"templates",get:function(){return this._templateStore}},{key:"analyze",value:function(e,r,i,n,u,h,f){var y=this;return a.asyncToGenerator(t(s).mark((function a(){var d,_,v,m,x,g,M,b,k,S;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,l.isAborted)(f)){t.next=2;break}return t.abrupt("return");case 2:if(t.t0="dictionary"===i.type,!t.t0){t.next=8;break}return t.next=7,i.analyze(y._idField,e.copy(),r,u,h,f);case 7:d=t.sent;case 8:_=0;case 9:if(!e.next()){t.next=32;break}if(v=d?d[_++]:(0,o.isSome)(n)&&(0,c.isAggregateId)(e.getDisplayId())&&1!==e.readAttribute("cluster_count")?n.match(y._idField,e,y._geometryType,u,h):i.match(y._idField,e,y._geometryType,u,h),e.setGroupId(v),!(0,p.isDynamicId)(v)){t.next=30;break}for(m=y._templateStore.getDynamicTemplateGroup(v),x=!0,g=!1,M=void 0,t.prev=14,b=m[Symbol.iterator]();!(x=(k=b.next()).done);x=!0)(S=k.value)&&S.analyze&&S.analyze(y._templateStore,e,u,h);t.next=22;break;case 18:t.prev=18,t.t1=t.catch(14),g=!0,M=t.t1;case 22:t.prev=22,t.prev=23,x||null==b.return||b.return();case 25:if(t.prev=25,!g){t.next=28;break}throw M;case 28:return t.finish(25);case 29:return t.finish(22);case 30:t.next=9;break;case 32:return t.next=34,y._loadPromise;case 34:return t.abrupt("return",(t.sent,y._templateStore.finalize(f)));case 35:case"end":return t.stop()}}),a,null,[[14,18,22,30],[23,,25,29]])})))()}},{key:"analyzeGraphics",value:function(e,r,i,n,o,u){var c=this;return a.asyncToGenerator(t(s).mark((function a(){var h,f,y,d,_,v,m,x,g;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,l.isAborted)(u)){t.next=2;break}return t.abrupt("return");case 2:if(h=e.getCursor(),t.t0=i,!t.t0){t.next=7;break}return t.next=7,i.analyze(c._idField,h.copy(),r,n,o,u);case 7:if(!h.next()){t.next=31;break}if(null!=(f=h.getGroupId())&&-1!==f||(f=i.match(c._idField,h,h.geometryType,n,o),h.setGroupId(f)),!(0,p.isDynamicId)(f)){t.next=28;break}for(y=c._templateStore.getDynamicTemplateGroup(f),d=!0,_=!1,v=void 0,t.prev=12,m=y[Symbol.iterator]();!(d=(x=m.next()).done);d=!0)(g=x.value)&&g.analyze&&g.analyze(c._templateStore,h,n,o);t.next=20;break;case 16:t.prev=16,t.t1=t.catch(12),_=!0,v=t.t1;case 20:t.prev=20,t.prev=21,d||null==m.return||m.return();case 23:if(t.prev=23,!_){t.next=26;break}throw v;case 26:return t.finish(23);case 27:return t.finish(20);case 28:h.setGroupId(f);case 29:t.next=7;break;case 31:return t.next=33,c._loadPromise;case 33:return t.abrupt("return",(t.sent,c._templateStore.finalize(u)));case 34:case"end":return t.stop()}}),a,null,[[12,16,20,28],[21,,23,27]])})))()}},{key:"writeGraphic",value:function(e,t,r,i){var n=t.getGroupId(),a=t.getDisplayId(),s=this._templateStore.getTemplateGroup(n);if(e.featureStart(t.insertAfter,0),null!=a){var o=!0,l=!1,u=void 0;if((0,p.isDynamicId)(n))try{for(var c,h=s[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var f=c.value;f&&f.bindFeature(t,null,null)}}catch(e){l=!0,u=e}finally{try{o||null==h.return||h.return()}finally{if(l)throw u}}if(s){var y=!0,d=!1,_=void 0;try{for(var v,m=s[Symbol.iterator]();!(y=(v=m.next()).done);y=!0){var x=v.value;x&&x.write(e,t,r,i)}}catch(e){d=!0,_=e}finally{try{y||null==m.return||m.return()}finally{if(d)throw _}}e.featureEnd()}}}},{key:"writeCursor",value:function(e,t,r,i,n,a,s){var l=t.getGroupId(),u=t.getDisplayId(),c=this._templateStore.getTemplateGroup(l),h=this._schema.mesh.sortKey,f=0;if((0,o.isSome)(h)&&(f=null!=h.fieldIndex?t.getComputedNumericAtIndex(h.fieldIndex):null!=h.field?t.readAttribute(h.field):t.readAttribute(this._idField),f*="asc"===h.order?1:-1),e.featureStart(0,null==f||isNaN(f)?0:f),null!=u&&c){var y=!0,d=!1,_=void 0;if((0,p.isDynamicId)(l))try{for(var v,m=c[Symbol.iterator]();!(y=(v=m.next()).done);y=!0){v.value.bindFeature(t,r,i)}}catch(e){d=!0,_=e}finally{try{y||null==m.return||m.return()}finally{if(d)throw _}}var x=!0,g=!1,M=void 0;try{for(var b,k=c[Symbol.iterator]();!(x=(b=k.next()).done);x=!0){b.value.write(e,t,n,s)}}catch(e){g=!0,M=e}finally{try{x||null==k.return||k.return()}finally{if(g)throw M}}if((0,o.isSome)(a)&&e.hasRecords){var S=a&&this._findLabelRef(c);this._writeLabels(e,t,a,S,n,s)}e.featureEnd()}}},{key:"_findLabelRef",value:function(e){var t=!0,r=!1,i=void 0;try{for(var n,a=e[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var s=n.value;if(s instanceof f.default)return s}}catch(e){r=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw i}}return null}},{key:"_writeLabels",value:function(e,t,r,i,n,a){var s=!0,l=!1,u=void 0;try{for(var c,h=r[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var f=c.value;if((0,o.isSome)(f)&&f){var p=f.glyphs,y=f.rtl,d=f.index,_=this._labelTemplates.get(d);_.setZoomLevel(n),_.bindReferenceTemplate(i),_.bindTextInfo(p,y),_.write(e,t,null,a)}}}catch(e){l=!0,u=e}finally{try{s||null==h.return||h.return()}finally{if(l)throw u}}}}]),e}()})),r.register("5wFDv",(function(t,i){e(t.exports,"default",(function(){return w}));var n=r("8TSCy"),a=r("kyj08"),s=r("jHOLN"),o=r("iVfa0"),l=r("7qybv"),u=r("iXlXu"),c=r("6LoaD"),h=r("6S0qa"),f=r("hUDEJ"),p=r("4WoSm"),y=r("66IJZ"),d=r("8lbQw"),_=r("ktHf8"),v=r("4rTyW"),m=r("85tW8"),x=s.default.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate");var g,M,b=(g=function(e){var t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t},M=new Map,function(e){return M.has(e)||M.set(e,g(e)),M.get(e)}),k=function(e){return Math.floor(127*e+127)},S=function(e){return Math.floor(10*e)},T=function(e){return Math.round(e*(254/360))},w=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i,a,s){var l,d,v,m;n.classCallCheck(this,r),(l=t.call(this,e,a.font.size,a.haloSize||0,a.font.size,a.color&&(0,f.premultiplyAlphaRGBAArray)(a.color)||0,a.haloColor&&(0,f.premultiplyAlphaRGBAArray)(a.haloColor)||0,a.horizontalAlignment,a.verticalAlignment,(0,h.isMapAligned)(i.labelPlacement)?c.Alignment.MAP:c.Alignment.SCREEN,a.font.decoration,!1,a.angle||0,a.xoffset,a.yoffset,a.lineWidth,a.lineHeight,null,null,null,null,null))._outLineLabelAngle=0,l._refPlacementPadding=0,l._refPlacementDirX=0,l._refPlacementDirY=0,l._refOffsetX=0,l._refOffsetY=0,l._zoomLevel=0,l.geometryType=y.WGLGeometryType.LABEL,l._allowOverrun=null!=(d=i.allowOverrun)&&d,l._repeatLabel=null==(v=i.repeatLabel)||v,l._labelPosition=null!=(m=i.labelPosition)?m:"curved";var x,g,M,b,k,S,T=(k=s,S=!!(b=i).minScale&&k.scaleToZoom(b.minScale)||0,(0,o.clamp)(S,0,25.5)),w=(g=s,M=!!(x=i).maxScale&&g.scaleToZoom(x.maxScale)||255,(0,o.clamp)(M,0,25.5)),I=i.labelPlacement,C=n.slicedToArray((0,h.getAlignmentFromPlacement)(I),2),L=C[0],A=C[1];l._xAlignD=L,l._yAlignD=A,l._minZoom=T,l._maxZoom=w,l._refPlacementPadding=(0,u.pt2px)(a.haloSize)+p.TEXT_PLACEMENT_PADDING,l._repeatLabelDistance=i.repeatLabelDistance?(0,u.pt2px)(i.repeatLabelDistance):128;var P=_.LabelMaterialKey.load(e);return P.sdf=!0,l._materialKey=P.data,n.possibleConstructorReturn(l)}return n.createClass(r,[{key:"_shapedBox",get:function(){return(0,l.unwrap)(this._shapingInfo).bounds}},{key:"setZoomLevel",value:function(e){this._zoomLevel=e}},{key:"bindReferenceTemplate",value:function(e){var t=(0,h.getXDirection)(this._xAlignD),r=(0,h.getYDirection)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,(0,l.isNone)(e))this._refSymbolAndPlacementOffset=(0,d.i8888to32)(0,0,k(t),k(r));else{if("circle"===e.boundsType&&(t||r)){var i=Math.sqrt(t*t+r*r);t/=i,r/=i}var n=Math.max(e.height,e.width),a=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=(0,d.i8888to32)(a,n,k(t),k(r)),this._referenceSize=n,this._refPlacementDirX=t,this._refPlacementDirY=r,this._refOffsetX=e.xOffset,this._refOffsetY=e.yOffset}}},{key:"_write",value:function(e,t){if(!(0,l.isNone)(this._shapingInfo)){var r=this._shapingInfo,i=t.getDisplayId(),n="esriGeometryPolygon"===t.geometryType?t.readLegacyCentroid():t.readLegacyGeometry();if(n)switch(this.current={out:e,inId:i,inShaping:r,zoomLevel:this._zoomLevel},t.geometryType){case"esriGeometryPolyline":this._placeLineLabels(n);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(n);break;default:!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mapview-labeling";x.error(new(0,a.default)(t,e))}("mapview-labeling","Geometry of type ".concat(t.geometryType," is not supported"))}}}},{key:"_isVisible",value:function(e,t){var r=S(this.current.zoomLevel);return S(e)<=r&&r<=S(t)}},{key:"_placePointLabels",value:function(e){var t=this.current,r=t.out,i=t.inId,n=t.inShaping;this._writeGlyphs(r,i,e,n)}},{key:"_placeLineLabels",value:function(e){var t=(0,v.smoothPaths)(e.paths,this.current.inShaping.bounds.width),r=this._placeSubdivGlyphs.bind(this),i=(this._shapedBox.width+this._repeatLabelDistance)/2,n=!0,a=!1,s=void 0;try{for(var o,l=t[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var u=o.value;(0,v.pathDivide)(u,i,r,this._repeatLabel)}}catch(e){a=!0,s=e}finally{try{n||null==l.return||l.return()}finally{if(a)throw s}}}},{key:"_placeSubdivGlyphs",value:function(e,t,r,i){var n=b(t),a=this._shapedBox.width/2,s=Math.sqrt(this._repeatLabelDistance)/2,o=Math.min(r,i-r),l=Math.log2(o/(s+a/2)),u=0===t?l:Math.min(n,l),c=Math.max(this._minZoom,this.current.zoomLevel+1-u),h=this.current.zoomLevel-c,f=this._shapedBox.width/2*Math.pow(2,h);this.current.inShaping.isMultiline?0===t&&this._placeStraight(e,c):this._allowOverrun&&h<0?this._placeStraightAlong(e,this._minZoom):"parallel"===this._labelPosition?this._placeStraightAlong(e,c):"curved"===this._labelPosition&&this._placeCurved(e,c,f)}},{key:"_placeStraight",value:function(e,t){var r=this.current,i=r.out,n=r.inId,a=r.inShaping;this._writeGlyphs(i,n,e,a,t)}},{key:"_placeCurved",value:function(e,t,r){var i=this.current,n=i.out,a=i.inId;n.metricStart(a,t,e.x,e.y,0,0,0,0);var s=e.clone(),o=e.angle*(180/Math.PI)%360,l=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=T(o),this._placeFirst(s,t,1),this._placeBack(e,s,t,r,1),this._placeForward(e,s,t,r,1),this._outLineLabelAngle=T(l),this._placeFirst(s,t,0),this._placeBack(e,s,t,r,0),this._placeForward(e,s,t,r,0),n.metricEnd()}},{key:"_placeStraightAlong",value:function(e,t){var r=this.current,i=r.out,n=r.inId;i.metricStart(n,t,e.x,e.y,0,0,0,0);var a=e.clone(),s=e.angle*(180/Math.PI)%360,o=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=T(s),this._placeFirst(a,t,1,!0),this._outLineLabelAngle=T(o),this._placeFirst(a,t,0,!0),i.metricEnd()}},{key:"_placeBack",value:function(e,t,r,i,n){for(var a=e.clone(),s=e.backwardLength+0;a.prev()&&!(s>=i);)this._placeOnSegment(a,t,s,r,-1,n),s+=a.length+0}},{key:"_placeForward",value:function(e,t,r,i,n){for(var a=e.clone(),s=e.remainingLength+0;a.next()&&!(s>=i);)this._placeOnSegment(a,t,s,r,1,n),s+=a.length+0}},{key:"_placeFirst",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=e,a=this.current.inShaping,s=a.glyphs,o=this.current.zoomLevel,l=this.current,u=l.out,c=l.inId,h=!0,f=!1,p=void 0;try{for(var y,d=s[Symbol.iterator]();!(h=(y=d.next()).done);h=!0){var _=y.value,v=_.x>a.bounds.x?r:1-r,m=v*e.remainingLength+(1-v)*e.backwardLength,x=Math.abs(_.x+_.width/2-a.bounds.x),g=Math.max(0,o+Math.log2(x/(m+0))),M=Math.max(t,i?0:g);if(_.maxZoom=25,_.angle=e.angle+(1-r)*Math.PI,_.minZoom=M,this._writeGlyph(u,c,n.x,n.y,_),r&&this._isVisible(_.minZoom,_.maxZoom)){var b=_.bounds;u.metricBoxWrite(b.center[0],b.center[1],b.width,b.height)}}}catch(e){f=!0,p=e}finally{try{h||null==d.return||d.return()}finally{if(f)throw p}}}},{key:"_placeOnSegment",value:function(e,t,r,i,n,a){var s=this.current.inShaping.glyphs,o=this.current,l=o.out,u=o.inId,c=this.current.inShaping,h=this.current.zoomLevel,f=e.dx/e.length,p=e.dy/e.length,y={x:e.x+r*-n*f,y:e.y+r*-n*p},d=!0,_=!1,v=void 0;try{for(var m,x=s[Symbol.iterator]();!(d=(m=x.next()).done);d=!0){var g=m.value,M=g.x>c.bounds.x?a:1-a;if(M&&1===n||!M&&-1===n){var b=Math.abs(g.x+g.width/2-c.bounds.x),k=Math.max(0,h+Math.log2(b/r)-.1),S=Math.max(i,h+Math.log2(b/(r+e.length+0)));if(0!==k&&(g.angle=e.angle+(1-a)*Math.PI,g.minZoom=S,g.maxZoom=k,this._writeGlyph(l,u,y.x,y.y,g),a&&this._isVisible(g.minZoom,g.maxZoom))){var T=g.bounds,w=e.x-t.x,I=e.y-t.y;l.metricBoxWrite(T.center[0]+w,T.center[1]+I,T.width,T.height)}}}}catch(e){_=!0,v=e}finally{try{d||null==x.return||x.return()}finally{if(_)throw v}}}},{key:"_writeGlyphs",value:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this._minZoom;if(!(r.x<0||r.x>=512||r.y<0||r.y>=512)){var a=r.x+this._refOffsetX,s=r.y-this._refOffsetY,o=!0,l=!1,u=void 0;try{for(var c,h=i.glyphs[Symbol.iterator]();!(o=(c=h.next()).done);o=!0){var f=c.value;f.minZoom=n,f.maxZoom=this._maxZoom,this._writeGlyph(e,t,a,s,f)}}catch(e){l=!0,u=e}finally{try{o||null==h.return||h.return()}finally{if(l)throw u}}var p=this._refPlacementDirX,y=this._refPlacementDirY,d=i.boundsT;e.metricStart(t,n,a,s,p,y,this._referenceSize,this._materialKey),e.metricBoxWrite(d.center[0],d.center[1],d.width,d.height),e.metricEnd()}}},{key:"_writeVertexCommon",value:function(e,t,r,i){var n=this._color,a=this._haloColor,s=(0,d.i8888to32)(0,0,this._size,this._haloSize),o=Math.max(i.minZoom,this._minZoom),l=Math.min(i.maxZoom,this._maxZoom),u=(0,d.i8888to32)(S(o),S(l),this._outLineLabelAngle,0);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(n),e.vertexWrite(a),e.vertexWrite(s),e.vertexWrite(this._refSymbolAndPlacementOffset),e.vertexWrite(u)}}],[{key:"fromLabelClass",value:function(e,t){if("esriServerLinePlacementCenterAlong"===e.labelPlacement){var i=e.symbol;i.xoffset=0,i.yoffset=0,i.angle=0,i.font.decoration="none"}return new r(e.materialKey,e,e.symbol,t)}}]),r}(m.default)})),r.register("4rTyW",(function(t,i){e(t.exports,"pathDivide",(function(){return h})),e(t.exports,"smoothPaths",(function(){return f}));var n=r("8TSCy"),a=(r("7qybv"),r("10UfI"));function s(e,t){return e[t+1]}function o(e){return e.length-1}function l(e){for(var t=0,r=0;r<o(e);r++)t+=u(e,r);return t}function u(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=n.slicedToArray(s(e,t),2),a=i[0],o=i[1];return Math.sqrt(a*a+o*o)*r}var c=function(){"use strict";function e(t,r,i,a,s){n.classCallCheck(this,e),this._segments=t,this._index=r,this._distance=i,this._xStart=a,this._yStart=s,this._done=!1}return n.createClass(e,[{key:"clone",value:function(){return new e(this._segments,this._index,this._distance,this.xStart,this.yStart)}},{key:"equals",value:function(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}},{key:"leq",value:function(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}},{key:"geq",value:function(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}},{key:"_segment",get:function(){return this._segments[this._index+1]}},{key:"angle",get:function(){var e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length),r=Math.acos(t);return e>0&&(r=2*Math.PI-r),r}},{key:"xStart",get:function(){return this._xStart}},{key:"yStart",get:function(){return this._yStart}},{key:"x",get:function(){return this.xStart+this.distance*this.dx}},{key:"y",get:function(){return this.yStart+this.distance*this.dy}},{key:"dx",get:function(){return this._segment[0]}},{key:"dy",get:function(){return this._segment[1]}},{key:"xMidpoint",get:function(){return this.xStart+.5*this.dx}},{key:"yMidpoint",get:function(){return this.yStart+.5*this.dy}},{key:"xEnd",get:function(){return this.xStart+this.dx}},{key:"yEnd",get:function(){return this.yStart+this.dy}},{key:"length",get:function(){var e=this.dx,t=this.dy;return Math.sqrt(e*e+t*t)}},{key:"remainingLength",get:function(){return this.length*(1-this._distance)}},{key:"backwardLength",get:function(){return this.length*this._distance}},{key:"distance",get:function(){return this._distance}},{key:"done",get:function(){return this._done}},{key:"hasPrev",value:function(){return this._index-1>=0}},{key:"hasNext",value:function(){return this._index+1<o(this._segments)}},{key:"next",value:function(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}},{key:"prev",value:function(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}},{key:"_seekBackwards",value:function(e,t){var r=this.backwardLength;if(e<=r)return this._distance=(r-e)/this.length,this;for(var i=this.backwardLength;this.prev();){if(i+this.length>e)return this._seekBackwards(e-i);i+=this.length}return this._distance=0,t?this:null}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;for(var r=this.remainingLength;this.next();){if(r+this.length>e)return this.seek(e-r,t);r+=this.length}return this._distance=1,t?this:null}}],[{key:"create",value:function(t){return new e(t,0,0,t[0][0],t[0][1])}}]),e}();function h(e,t,r){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=l(e),a=c.create(e),s=n/2;if(!i)return a.seek(s),void r(a.clone(),0,s+0*t,n);var o=Math.max((n-t)/2,0),u=Math.floor(o/t),h=s-u*t;a.seek(h);for(var f=-u;f<=u;f++)a.x<512&&a.x>=0&&a.y<512&&a.y>=0&&r(a.clone(),f,s+f*t,n),a.seek(t)}function f(e,t){for(var r=t,i=0;i<e.length;i++){var a=e[i],s=[];s.push(a[0]);for(var o=1;o<a.length;o++){var l=n.slicedToArray(s[o-1],2),u=l[0],c=l[1];u+=a[o][0],c+=a[o][1],s.push([u,c])}p(s,r);var h=[];h.push(s[0]);for(var f=1;f<s.length;f++){var y=n.slicedToArray(s[f-1],2),d=y[0],_=y[1],v=n.slicedToArray(s[f],2),m=v[0],x=v[1],g=Math.round(m-d),M=Math.round(x-_);h.push([g,M])}e[i]=h,a=h}return e}function p(e,t){var r=1e-6;if(!(t<=0)){var i=e.length;if(!(i<3)){var n=[],s=0;n.push(0);for(var o=1;o<i;o++)s+=(0,a.dist)(e[o],e[o-1]),n.push(s);t=Math.min(t,.2*s);var l=[];l.push(e[0][0]),l.push(e[0][1]);var u=e[i-1][0],c=e[i-1][1],h=(0,a.sub)([0,0],e[0],e[1]);(0,a.normalize)(h),e[0][0]+=t*h[0],e[0][1]+=t*h[1],(0,a.sub)(h,e[i-1],e[i-2]),(0,a.normalize)(h),e[i-1][0]+=t*h[0],e[i-1][1]+=t*h[1];for(var f=1;f<i;f++)n[f]+=t;n[i-1]+=t;for(var p=.5*t,y=1;y<i-1;y++){for(var d=0,_=0,v=0,m=y-1;m>=0&&!(n[m+1]<n[y]-p);m--){var x=p+n[m+1]-n[y],g=n[m+1]-n[m],M=n[y]-n[m]<p?1:x/g;if(Math.abs(M)<r)break;var b=M*M,k=M*x-.5*b*g,S=M*g/t,T=e[m+1],w=e[m][0]-T[0],I=e[m][1]-T[1];d+=S/k*(T[0]*M*x+.5*b*(x*w-g*T[0])-b*M*g*w/3),_+=S/k*(T[1]*M*x+.5*b*(x*I-g*T[1])-b*M*g*I/3),v+=S}for(var C=y+1;C<i&&!(n[C-1]>n[y]+p);C++){var L=p-n[C-1]+n[y],A=n[C]-n[C-1],P=n[C]-n[y]<p?1:L/A;if(Math.abs(P)<r)break;var E=P*P,R=P*L-.5*E*A,O=P*A/t,W=e[C-1],G=e[C][0]-W[0],F=e[C][1]-W[1];d+=O/R*(W[0]*P*L+.5*E*(L*G-A*W[0])-E*P*A*G/3),_+=O/R*(W[1]*P*L+.5*E*(L*F-A*W[1])-E*P*A*F/3),v+=O}l.push(d/v),l.push(_/v)}l.push(u),l.push(c);for(var z=0,D=0;z<i;z++)e[z][0]=l[D++],e[z][1]=l[D++]}}}})),r.register("10UfI",(function(t,r){e(t.exports,"DEFAULT_MIN_ZOOM",(function(){return i})),e(t.exports,"DEFAULT_MAX_ZOOM",(function(){return n})),e(t.exports,"sub",(function(){return a})),e(t.exports,"normalize",(function(){return o})),e(t.exports,"dist",(function(){return l})),e(t.exports,"isFunction",(function(){return u})),e(t.exports,"getLimitCosine",(function(){return c})),e(t.exports,"getMinMaxZoom",(function(){return h}));var i=0,n=100;function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function s(e,t){return Math.sqrt(e*e+t*t)}function o(e){var t=s(e[0],e[1]);e[0]/=t,e[1]/=t}function l(e,t){return s(e[0]-t[0],e[1]-t[1])}function u(e){return"function"==typeof e}function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return 1/Math.max(e,1)}function h(e,t){return[!!e.minScale&&t.scaleToZoom(e.minScale)||i,!!e.maxScale&&t.scaleToZoom(e.maxScale)||n]}})),r.register("85tW8",(function(t,i){e(t.exports,"default",(function(){return _}));var n=r("8TSCy"),a=r("6J0KG"),s=r("iXlXu"),o=r("6LoaD"),l=r("6S0qa"),u=r("hUDEJ"),c=r("4WoSm"),h=r("8lbQw"),f=r("ktHf8"),p=r("10UfI"),y=r("6aUmX"),d=r("5Izwl"),_=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i,a,u,p,y,d,_,v,m,x,g,M,b,k,S,T,w){var I,C=arguments.length>18&&void 0!==arguments[18]&&arguments[18],L=arguments.length>19?arguments[19]:void 0,A=arguments.length>20?arguments[20]:void 0;n.classCallCheck(this,r),(I=t.call(this))._xOffset=(0,s.pt2px)(M),I._yOffset=(0,s.pt2px)(b),I._decoration=m||"none",I._color=p,I._haloColor=y,I._haloSize=Math.min(Math.floor(5*(0,s.pt2px)((0,s.toPt)(a))),127),I._size=Math.min(Math.round((0,s.pt2px)(i)),127);var P=Math.min(Math.round((0,s.pt2px)(u||i)),127);I._referenceSize=Math.round(Math.sqrt(256*P)),I._scale=I._size/c.GLYPH_SIZE,I._angle=g,I._justify=(0,l.getJustification)(d||"center"),I._xAlignD=(0,l.getXAnchorDirection)(d||"center"),I._yAlignD=(0,l.getYAnchorDirection)(_||"baseline"),I._baseline="baseline"===(_||"baseline"),I._bitset=(v===o.Alignment.MAP?1:0)|(x?1:0)<<1;var E=f.MaterialKeyBase.load(e);return E.sdf=!0,I._materialKey=E.data,I._lineWidth=(0,s.pt2px)(k)||512,I._lineHeight=S||1,I._textPlacement=T,I._effects=w,I._isCIM=C,I._minMaxZoom=(0,h.i1616to32)(Math.round(L*c.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(A*c.MIN_MAX_ZOOM_PRECISION_FACTOR)),n.possibleConstructorReturn(I)}return n.createClass(r,null,[{key:"fromText",value:function(e,t){var i=new r(e.materialKey,e.font.size,e.haloSize||0,e.font.size,e.color&&(0,u.premultiplyAlphaRGBAArray)(e.color)||0,e.haloColor&&(0,u.premultiplyAlphaRGBAArray)(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,o.Alignment.SCREEN,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1,p.DEFAULT_MIN_ZOOM,p.DEFAULT_MAX_ZOOM),s=n.slicedToArray((0,a.bidiText)(e.text),2)[1];return i.bindTextInfo(t,s),i._vertexBoundsScale=e.maxVVSize?e.maxVVSize/e.font.size:1,i}},{key:"fromCIMText",value:function(e,t,i){var s=e.scaleFactor||1,o=e.size*e.sizeRatio*s,l=n.slicedToArray((0,p.getMinMaxZoom)(e.scaleInfo,i),2),c=l[0],h=l[1],f=new r(e.materialKey,o,e.outlineSize*e.sizeRatio,e.referenceSize,(0,u.premultiplyAlphaRGBA)(e.color),(0,u.premultiplyAlphaRGBA)(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*s,e.offsetY*e.sizeRatio*s,512,1,e.markerPlacement,e.effects,!0,c,h),y=n.slicedToArray((0,a.bidiText)(e.text),2)[1];return f.bindTextInfo(t,y),f._vertexBoundsScale=e.maxVVSize?e.maxVVSize/o:1,f}}]),r}((0,y.default)(d.default))})),r.register("6aUmX",(function(t,i){e(t.exports,"default",(function(){return y}));var n=r("8TSCy"),a=r("7qybv"),s=r("iXlXu"),o=r("akQYU"),l=r("ipeZ7"),u=r("4WoSm"),c=r("66IJZ"),h=r("8lbQw"),f=r("ktHf8"),p=r("a7brS"),y=function(e){var t=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];var s;return n.classCallCheck(this,r),(s=t.call.apply(t,[this].concat(n.toConsumableArray(i))))._isCIM=!1,s._vertexBoundsScale=1,s.geometryType=c.WGLGeometryType.TEXT,s._aux=(0,h.i8888to32)(0,0,s._referenceSize,s._bitset),n.possibleConstructorReturn(s)}return n.createClass(r,[{key:"bindTextInfo",value:function(e,t){var r=this;e&&e.length?this._shapingInfo=(0,a.applySome)(e,(function(e){return(0,p.shapeGlyphs)(e,t,{scale:r._scale,angle:r._angle,xOffset:r._xOffset,yOffset:r._yOffset,hAlign:r._xAlignD,vAlign:r._yAlignD,maxLineWidth:Math.max(32,Math.min(r._lineWidth,512)),lineHeight:u.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(r._lineHeight,4)),decoration:r._decoration,isCIM:r._isCIM})})):this._shapingInfo=null}},{key:"_write",value:function(e,t,r,i){var n=t.getDisplayId();this._writeGeometry(e,t,n,r,i)}},{key:"_writeGeometry",value:function(e,t,r,i,s){var l=this._shapingInfo;if(!(0,a.isNone)(l)){if((0,a.isSome)(this._textPlacement)){var u=null!=s?s:t.readLegacyGeometryForDisplay();return this._writePlacedText(e,r,u,l,i)}var c=s?(0,o.deltaDecodeGeometry)((0,o.convertFromGeometry)(s),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(!(0,a.isNone)(c)){var h=this;if(c.isPoint){var f=n.slicedToArray(c.coords,2),p=f[0],y=f[1];if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(p<0||p>=512||y<0||y>=512))return;return this._writeGlyphs(e,r,{x:p,y:y},l)}c.forEachVertex((function(t,i){return h._writeGlyphs(e,r,{x:t,y:i},l)}))}}}},{key:"_writePlacedText",value:function(e,t,r,i,n){var o=(0,a.unwrap)(this._textPlacement),u=l.CIMMarkerPlacementHelper.getPlacement(r,o,(0,s.pt2px)(1),n.geometryEngine);if(u)for(var c=u.next();null!=c;){var h=-c.getAngle();i.setRotation(h);var f=c.tx,p=-c.ty;f<0||f>=512||p<0||p>=512||(this._writeGlyphs(e,t,{x:f,y:p},i),i.setRotation(-h)),c=u.next()}}},{key:"_writeGlyphs",value:function(e,t,r,i){var n=f.MaterialKeyBase.load(this._materialKey),a=(0,h.i1616to32)(Math.round(8*r.x),Math.round(8*r.y)),s=this._vertexBoundsScale,o=i.bounds,l=2*Math.max(o.width,o.height),u=!0,c=!1,p=void 0;try{for(var y,d=i.glyphs[Symbol.iterator]();!(u=(y=d.next()).done);u=!0){var _=y.value;n.textureBinding=_.textureBinding,e.recordStart(t,n.data,this.geometryType,!0),e.vertexBounds(r.x+o.x+this._xOffset,r.y+o.y-this._yOffset,l*s,l*s),this._writeVertices(e,t,a,_),e.recordEnd()}}catch(e){c=!0,p=e}finally{try{u||null==d.return||d.return()}finally{if(c)throw p}}}},{key:"_writeGlyph",value:function(e,t,r,i,n){var a=f.MaterialKeyBase.load(this._materialKey),s=(0,h.i1616to32)(Math.round(8*r),Math.round(8*i));a.textureBinding=n.textureBinding,e.recordStart(t,a.data,this.geometryType,!0);var o=n.bounds,l=this._vertexBoundsScale;e.vertexBounds(r+o.x*l,i+o.y*l,o.width*l,o.height*l),this._writeVertices(e,t,s,n),e.recordEnd()}},{key:"_writeVertices",value:function(e,t,r,i){var n=e.vertexCount();this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.upperLeft),e.vertexWrite(i.texcoords.upperLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.upperRight),e.vertexWrite(i.texcoords.upperRight),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.lowerLeft),e.vertexWrite(i.texcoords.lowerLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,i),e.vertexWrite(i.offsets.lowerRight),e.vertexWrite(i.texcoords.lowerRight),e.vertexEnd(),e.indexWrite(n+0),e.indexWrite(n+1),e.indexWrite(n+2),e.indexWrite(n+1),e.indexWrite(n+3),e.indexWrite(n+2)}},{key:"_writeVertexCommon",value:function(e,t,r,i){var n=this._color,a=this._haloColor,s=(0,h.i8888to32)(0,0,this._referenceSize,this._bitset),o=(0,h.i8888to32)(0,0,this._size,this._haloSize);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(n),e.vertexWrite(a),e.vertexWrite(o),e.vertexWrite(s),e.vertexWrite(this._minMaxZoom)}}]),r}(e);return t}})),r.register("ipeZ7",(function(t,i){e(t.exports,"CIMMarkerPlacementHelper",(function(){return o}));var n=r("8TSCy"),a=r("eA5AD"),s=r("4qQLM"),o=function(){"use strict";function e(){n.classCallCheck(this,e)}return n.createClass(e,null,[{key:"getPlacement",value:function(e,t,r,i){var n=(0,s.getPlacementOperator)(t);if(!n)return null;var o=(0,a.cloneAndDecodeGeometry)(e);return n.execute(o,t,r,i)}}]),e}()})),r.register("5Izwl",(function(t,i){e(t.exports,"default",(function(){return o}));var n=r("8TSCy"),a=r("7qybv"),s=r("k9Ouu"),o=function(){"use strict";function e(){n.classCallCheck(this,e)}return n.createClass(e,[{key:"bindFeature",value:function(e,t,r){}},{key:"write",value:function(e,t,r,i){var n;if((0,a.isNone)(this._effects)||0===(null==(n=this._effects)?void 0:n.length))return this._write(e,t,i);for(var o=s.CIMEffectHelper.executeEffects(this._effects,t.readLegacyGeometryForDisplay(),i.geometryEngine),l=s.CIMEffectHelper.next(o);l;)this._write(e,t,i,l),l=s.CIMEffectHelper.next(o)}},{key:"_write",value:function(e,t,r,i){}}]),e}()})),r.register("02uBX",(function(t,i){e(t.exports,"default",(function(){return v}));var n=r("8TSCy"),a=r("7qybv"),s=r("iXlXu"),o=r("cMCBC"),l=r("0P8XU"),u=r("6LoaD"),c=r("hUDEJ"),h=r("4WoSm"),f=r("8lbQw"),p=r("ktHf8"),y=r("10UfI"),d=r("5DWwP"),_=r("5Izwl"),v=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i,a,s,c,y,d,_,v,m,x,g,M,b,k,S,T,w,I,C,L,A,P){var E;n.classCallCheck(this,r),(E=t.call(this)).angle=s,E.height=d,E.width=y,E.xOffset=i*I,E.yOffset=a*I,E._markerPlacement=C,E._effects=L,E._anchorX=.5-(.5+S)*k.width/k.width,E._anchorY=.5-(.5+T)*k.height/k.height,E._minMaxZoom=(0,f.i1616to32)(Math.round(A*h.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(P*h.MIN_MAX_ZOOM_PRECISION_FACTOR));var R=(b===u.Alignment.MAP?h.BITSET_MARKER_ALIGNMENT_MAP:h.BITSET_MARKER_ALIGNMENT_SCREEN)|(x?h.BITSET_GENERIC_LOCK_COLOR:0)|(M?h.BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE:0)|(g?h.BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY:0),O=k&&k.sdf,W=p.MarkerMaterialKey.load(e);W.sdf=O,W.pattern=!0,W.textureBinding=k.textureBinding,E._materialKey=W.data,E._fillColor=c,E._outlineColor=v,E._sizeOutlineWidth=(0,f.i8888to32)(Math.round(Math.min(Math.sqrt(128*y),255)),Math.round(Math.min(Math.sqrt(128*d),255)),Math.round(Math.min(Math.sqrt(128*m),255)),Math.round(Math.min(Math.sqrt(128*_),255)));var G=k.rect.x+h.SPRITE_PADDING,F=k.rect.y+h.SPRITE_PADDING,z=G+k.width,D=F+k.height;E._offsets.xUpperLeft=G,E._offsets.yUpperLeft=F,E._offsets.xUpperRight=z,E._offsets.yUpperRight=F,E._offsets.xBottomLeft=G,E._offsets.yBottomLeft=D,E._offsets.xBottomRight=z,E._offsets.yBottomRight=D,E._texUpperLeft=(0,f.i1616to32)(G,F),E._texUpperRight=(0,f.i1616to32)(z,F),E._texBottomLeft=(0,f.i1616to32)(G,D),E._texBottomRight=(0,f.i1616to32)(z,D),y*=w,d*=w,y*=I,d*=I;var B=Math.round(64*w);E._bitestAndDistRatio=(0,f.i1616to32)(R,B),E._computedWidth=y,E._computedHeight=d;var N=(0,l.c)(),Z=(0,o.c)();return E._applyTransformation(Z,N),n.possibleConstructorReturn(E)}return n.createClass(r,null,[{key:"fromCIMMarker",value:function(e,t,i){var o=t&&t.width||1,l=t&&t.height||1,h=e.size,f=o/l*e.scaleX,p=e.scaleSymbolsProportionally&&e.frameHeight?h/e.frameHeight:1,d=(0,c.premultiplyAlphaRGBA)(e.color),_=(0,c.premultiplyAlphaRGBA)(e.outlineColor),v=(0,s.pt2px)(h),m=v*f,x=(0,s.pt2px)(e.offsetX||0),g=(0,s.pt2px)(e.offsetY||0),M=(0,s.pt2px)(e.outlineWidth||0)*p,b=e.alignment||u.Alignment.SCREEN,k=(0,s.pt2px)(e.referenceSize),S=n.slicedToArray((0,y.getMinMaxZoom)(e.scaleInfo,i),2),T=S[0],w=S[1];t.sdf||0!==d||(d=-1);var I=e.rotation||0;e.rotateClockwise||(I=-I);var C=0,L=0,A=e.anchorPoint;A&&(e.isAbsoluteAnchorPoint?h&&(C=-A.x/(h*f),L=A.y/h):(C=A.x,L=A.y));var P=new r(e.materialKey,x,g,I,d,m,v,k,_,M,e.colorLocked,e.scaleSymbolsProportionally,!1,b,t,C,L,e.sizeRatio,(0,a.unwrapOr)(e.scaleFactor,1),e.markerPlacement,e.effects,T,w);return P._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/m:1,P._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/v:1,P}},{key:"fromPictureMarker",value:function(e,t){var i=Math.round((0,s.pt2px)(e.width)),n=Math.round((0,s.pt2px)(e.height)),a=h.PICTURE_FILL_COLOR,o=Math.round((0,s.pt2px)(e.xoffset||0)),l=Math.round((0,s.pt2px)(e.yoffset||0)),c=new r(e.materialKey,o,l,e.angle,a,i,n,n,0,0,!1,!1,!1,u.Alignment.SCREEN,t,0,0,1,1,null,null,y.DEFAULT_MIN_ZOOM,y.DEFAULT_MAX_ZOOM);return c._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,c._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,c}},{key:"fromSimpleMarker",value:function(e,t){var i=(0,c.premultiplyAlphaRGBAArray)(e.color),n=Math.round((0,s.pt2px)(e.size)),a=n,o=Math.round((0,s.pt2px)(e.xoffset||0)),l=Math.round((0,s.pt2px)(e.yoffset||0)),h=e.style,f=e.outline,p=0|(f&&f.color&&(0,c.premultiplyAlphaRGBAArray)(f.color)),d=0|(f&&f.width&&Math.round((0,s.pt2px)(f.width))),_=new r(e.materialKey,o,l,e.angle,i,n,a,a,p,d,!1,!1,"esriSMSCross"===h||"esriSMSX"===h,u.Alignment.SCREEN,t,0,0,126/64,1,null,null,y.DEFAULT_MIN_ZOOM,y.DEFAULT_MAX_ZOOM);return _.boundsType="esriSMSCircle"===h?"circle":"square",_._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,_._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,_}},{key:"fromLineSymbolMarker",value:function(e,t){var i,n=(0,c.premultiplyAlphaRGBAArray)(e.color),a=Math.round((0,s.pt2px)(6*e.lineWidth)),o=a,l="cross"===e.style||"x"===e.style;switch(e.placement){case"begin-end":i=u.ExtremityPlacement.Both;break;case"begin":i=u.ExtremityPlacement.JustBegin;break;case"end":i=u.ExtremityPlacement.JustEnd;break;default:i=u.ExtremityPlacement.None}var h={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:i,offsetAlongLine:0},f=new r(e.materialKey,0,0,0,n,a,o,o/6,n,l?Math.round((0,s.pt2px)(e.lineWidth)):0,!1,!1,l,u.Alignment.MAP,t,0,0,126/64,1,h,null,y.DEFAULT_MIN_ZOOM,y.DEFAULT_MAX_ZOOM);return f.boundsType="circle"===e.style?"circle":"square",f}}]),r}((0,d.default)(_.default))})),r.register("5DWwP",(function(t,i){e(t.exports,"default",(function(){return _}));var n=r("8TSCy"),a=r("7qybv"),s=r("iXlXu"),o=r("b4Wmd"),l=r("cMCBC"),u=r("hRgCq"),c=r("0P8XU"),h=r("akQYU"),f=r("ipeZ7"),p=r("66IJZ"),y=r("8lbQw"),d=3.14159265359/180,_=function(e){var t=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];var s;return n.classCallCheck(this,r),(s=t.call.apply(t,[this].concat(n.toConsumableArray(i)))).angle=0,s.xOffset=0,s.yOffset=0,s.width=0,s.height=0,s.boundsType="square",s._anchorX=0,s._anchorY=0,s._computedWidth=0,s._computedHeight=0,s._vertexBoundsScaleX=1,s._vertexBoundsScaleY=1,s._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},s.geometryType=p.WGLGeometryType.MARKER,n.possibleConstructorReturn(s)}return n.createClass(r,[{key:"_write",value:function(e,t,r,i){var n=t.getDisplayId();e.recordStart(n,this._materialKey,this.geometryType,!0),this._writeGeometry(e,t,n,r,i),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,i,s){if((0,a.isSome)(this._markerPlacement))return this._writePlacedMarkers(e,t,i,s);if(!s&&"esriGeometryPoint"===t.geometryType){var o=t.getX(),l=t.getY();if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(o<0||o>=513||l<0||l>=513))return;return this._writeVertices(e,r,this._getPos(o,l),o,l)}var u=s?(0,h.deltaDecodeGeometry)((0,h.convertFromGeometry)(s),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(!(0,a.isNone)(u)){var c=this;if(u.isPoint){var f=n.slicedToArray(u.coords,2),p=f[0],y=f[1];if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(p<0||p>=512||y<0||y>=512))return;return this._writeVertices(e,r,this._getPos(p,y),p,y)}u.forEachVertex((function(t,i){return c._writeVertices(e,r,c._getPos(t,i),t,i)}))}}},{key:"_writePlacedMarkers",value:function(e,t,r,i){var n=null!=i?i:t.readLegacyGeometryForDisplay(),o=f.CIMMarkerPlacementHelper.getPlacement(n,(0,a.unwrap)(this._markerPlacement),(0,s.pt2px)(1),r.geometryEngine);if(o)for(var u=t.getDisplayId(),h=(0,c.c)(),p=(0,l.c)(),y=o.next();null!=y;){var _=y.tx,v=-y.ty;_>=-128&&_<=640&&v>=-128&&v<=640&&(this._applyTransformation(p,h,-y.getAngle()/d),this._writeVertices(e,u,this._getPos(_,v),_,v)),y=o.next()}}},{key:"_writeVertices",value:function(e,t,r,i,n){var a=e.vertexCount();if(this.angle){var s=Math.max(this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY);e.vertexBounds(i+this.xOffset,n-this.yOffset,s,s)}else e.vertexBounds(i+this.xOffset,n-this.yOffset,this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY);e.vertexWrite(r),e.vertexWrite(this._offsetUpperLeft),e.vertexWrite(this._texUpperLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetUpperRight),e.vertexWrite(this._texUpperRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomLeft),e.vertexWrite(this._texBottomLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomRight),e.vertexWrite(this._texBottomRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.indexWrite(a+0),e.indexWrite(a+1),e.indexWrite(a+2),e.indexWrite(a+1),e.indexWrite(a+3),e.indexWrite(a+2)}},{key:"_applyTransformation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,o.a)(e,(0,c.f)(this.xOffset,-this.yOffset)),this.angle+r!==0&&(0,o.r)(e,e,d*(this.angle+r));var i=this._computedWidth,n=this._computedHeight,a=(this._anchorX-.5)*i,s=(this._anchorY-.5)*n;(0,u.s)(t,a,s),(0,u.t)(t,t,e),this._offsetUpperLeft=(0,y.i1616to32)(16*t[0],16*t[1]),this._offsets.xUpperLeft=t[0],this._offsets.yUpperLeft=t[1],(0,u.s)(t,a+i,s),(0,u.t)(t,t,e),this._offsetUpperRight=(0,y.i1616to32)(16*t[0],16*t[1]),this._offsets.xUpperRight=t[0],this._offsets.yUpperRight=t[1],(0,u.s)(t,a,s+n),(0,u.t)(t,t,e),this._offsetBottomLeft=(0,y.i1616to32)(16*t[0],16*t[1]),this._offsets.xBottomLeft=t[0],this._offsets.yBottomLeft=t[1],(0,u.s)(t,a+i,s+n),(0,u.t)(t,t,e),this._offsetBottomRight=(0,y.i1616to32)(16*t[0],16*t[1]),this._offsets.xBottomRight=t[0],this._offsets.yBottomRight=t[1]}},{key:"_getPos",value:function(e,t){return(0,y.i1616to32)(Math.round(8*e),Math.round(8*t))}}]),r}(e);return t}})),r.register("iyMTk",(function(i,n){e(i.exports,"isDynamicId",(function(){return E})),e(i.exports,"WGLTemplateStore",(function(){return R}));var a=r("8TSCy"),s=r("2TvXO"),o=r("kyj08"),l=r("jHOLN"),u=r("10vEZ"),c=r("2iY9n"),h=r("66IJZ"),f=r("ktHf8"),p=r("e9Ylt"),y=r("lGMdi"),d=r("2ZfpK"),_=r("ieevV"),v=r("cHDNQ"),m=r("AsOJN"),x=r("02uBX"),g=r("85tW8"),M=r("hfZF0"),b=r("bMiFr"),k=r("4gcZA"),S=r("2rjRQ"),T=l.default.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),w=new Array,I={isOutline:!1,isOutlinedFill:!1,placement:null,stride:{fill:"default"},vvFlags:0},C=a.objectSpread({},c.errorPointSymbolJSON,{hash:JSON.stringify(c.errorPointSymbolJSON),materialKey:(0,f.createMaterialKey)(h.WGLGeometryType.MARKER,I)}),L=a.objectSpread({},c.errorPolylineSymbolJSON,{hash:JSON.stringify(c.errorPolylineSymbolJSON),materialKey:(0,f.createMaterialKey)(h.WGLGeometryType.LINE,I)}),A=a.objectSpread({},c.errorPolygonSymbolJSON,{hash:JSON.stringify(c.errorPolygonSymbolJSON),materialKey:(0,f.createMaterialKey)(h.WGLGeometryType.FILL,I)});function P(e,t){var r=e.length;return e.push(null),t.then((function(t){return e[r]=t})),e}function E(e){return!!(1&e)}var R=function(){"use strict";function e(t,r){a.classCallCheck(this,e),this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new(0,M.default),this._fetchResource=t,this._tileInfo=r}return a.createClass(e,[{key:"_markerError",get:function(){return this._errorTemplates.marker[0]}},{key:"_fillError",get:function(){return this._errorTemplates.fill[0]}},{key:"_lineError",get:function(){return this._errorTemplates.line[0]}},{key:"_textError",get:function(){return this._errorTemplates.line[0]}},{key:"createTemplateGroup",value:function(e,t){this._initErrorTemplates();var r=e.hash;if(this._symbolToTemplate.has(r))return this._symbolToTemplate.get(r);var i=new Array;t&&this._createMeshTemplates(i,t,!0),this._createMeshTemplates(i,e,!1);var n=this._createGroupId("expanded-cim"===e.type&&O(e));return this._idToTemplateGroup.set(n,i),this._symbolToTemplate.set(r,n),n}},{key:"getTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?this._idToTemplateGroup.get(e):w}},{key:"getDynamicTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?(E(e)||T.error("mapview-template-store","Id ".concat(e," does not refer to a dynamic template")),this._idToTemplateGroup.get(e)):w}},{key:"getMosaicItem",value:function(e,t){var r=this,i=this._createTemplateId(),n=new Promise((function(e){return r._idToResolver.set(i,e)}));return this._fetchQueue.push({symbol:e,id:i,glyphIds:t}),n}},{key:"finalize",value:function(e){return this._fetchQueue.length||this._lock.isHeld()?(0,M.withLock)(this._lock,this._fetchAllQueuedResources.bind(this),e):Promise.resolve()}},{key:"_initErrorTemplates",value:function(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],A,!1),marker:this._createMeshTemplates([],C,!1),line:this._createMeshTemplates([],L,!1)})}},{key:"_fetchAllQueuedResources",value:function(e){var t=this;if(!this._fetchQueue.length)return Promise.resolve();var r=this._fetchQueue,i=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(i).then((function(){return t._fetchResource(r,e).then((function(e){var r=!0,i=!1,n=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value,l=o.id,u=o.mosaicItem;t._idToResolver.get(l)(u),t._idToResolver.delete(l)}}catch(e){i=!0,n=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw n}}}))})).catch((function(e){(0,u.isAbortError)(e)?t._fetchQueue=t._fetchQueue.concat(r):"worker:port-closed"===e.name||T.error(new(0,o.default)("mapview-template-store","Unable to fetch requested texture resources",e))}))}},{key:"_createGroupId",value:function(e){return this._idCounter++<<1|(e?1:0)}},{key:"_createTemplateId",value:function(){return this._templateIdCounter++}},{key:"_createSMS",value:function(e){var r=this;return a.asyncToGenerator(t(s).mark((function i(){var n,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getMosaicItem(e);case 2:return n=t.sent,a=n.spriteMosaicItem,t.abrupt("return",(0,b.ok)(a,T)?x.default.fromSimpleMarker(e,a):r._markerError);case 5:case"end":return t.stop()}}),i)})))()}},{key:"_createPMS",value:function(e){var r=this;return a.asyncToGenerator(t(s).mark((function i(){var n,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getMosaicItem(e);case 2:return n=t.sent,a=n.spriteMosaicItem,t.abrupt("return",(0,b.ok)(a,T)?x.default.fromPictureMarker(e,a):r._markerError);case 5:case"end":return t.stop()}}),i)})))()}},{key:"_createSFS",value:function(e,r){var i=this;return a.asyncToGenerator(t(s).mark((function n(){var a,o;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.getMosaicItem(e);case 2:return a=t.sent,o=a.spriteMosaicItem,t.abrupt("return",(0,b.ok)(o,T)?v.default.fromSimpleFill(e,o,r):i._fillError);case 5:case"end":return t.stop()}}),n)})))()}},{key:"_createPFS",value:function(e,r){var i=this;return a.asyncToGenerator(t(s).mark((function n(){var a,o;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.getMosaicItem(e);case 2:return a=t.sent,o=a.spriteMosaicItem,t.abrupt("return",(0,b.ok)(o,T)?v.default.fromPictureFill(e,o,r):i._fillError);case 5:case"end":return t.stop()}}),n)})))()}},{key:"_createSLS",value:function(e,r){var i=this;return a.asyncToGenerator(t(s).mark((function r(){var n,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.getMosaicItem(e);case 2:return n=t.sent,a=n.spriteMosaicItem,t.abrupt("return",(0,b.ok)(a,T)?m.default.fromSimpleLine(e,a):i._lineError);case 5:case"end":return t.stop()}}),r)})))()}},{key:"_createLMS",value:function(e){var r=this;return a.asyncToGenerator(t(s).mark((function i(){var n,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getMosaicItem(e);case 2:return n=t.sent,a=n.spriteMosaicItem,t.abrupt("return",(0,b.ok)(a,T)?x.default.fromLineSymbolMarker(e,a):r._markerError);case 5:case"end":return t.stop()}}),i)})))()}},{key:"_createTS",value:function(e){var r=this;return a.asyncToGenerator(t(s).mark((function i(){var n,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getMosaicItem(e);case 2:return n=t.sent,a=n.glyphMosaicItems,t.abrupt("return",g.default.fromText(e,a));case 5:case"end":return t.stop()}}),i)})))()}},{key:"_createCIMText",value:function(e){var r=this;return a.asyncToGenerator(t(s).mark((function i(){var n,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getMosaicItem((0,S.cimLayerToRasterizationInfo)(e),(0,k.codepoints)(e.text));case 2:return n=t.sent,a=n.glyphMosaicItems,t.abrupt("return",(0,b.ok)(a,T)?g.default.fromCIMText(e,a,r._tileInfo):r._textError);case 5:case"end":return t.stop()}}),i)})))()}},{key:"_createCIMFill",value:function(e){var r=this;return a.asyncToGenerator(t(s).mark((function i(){var n,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getMosaicItem((0,S.cimLayerToRasterizationInfo)(e));case 2:return n=t.sent,a=n.spriteMosaicItem,t.abrupt("return",(0,b.ok)(a,T)?v.default.fromCIMFill(e,a,r._tileInfo):r._fillError);case 5:case"end":return t.stop()}}),i)})))()}},{key:"_createCIMLine",value:function(e){var r=this;return a.asyncToGenerator(t(s).mark((function i(){var n,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getMosaicItem((0,S.cimLayerToRasterizationInfo)(e));case 2:return n=t.sent,a=n.spriteMosaicItem,t.abrupt("return",(0,b.ok)(a,T)?m.default.fromCIMLine(e,a,r._tileInfo):r._lineError);case 5:case"end":return t.stop()}}),i)})))()}},{key:"_createCIMMarker",value:function(e){var r=this;return a.asyncToGenerator(t(s).mark((function i(){var n,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getMosaicItem((0,S.cimLayerToRasterizationInfo)(e));case 2:return n=t.sent,a=n.spriteMosaicItem,t.abrupt("return",(0,b.ok)(a,T)?x.default.fromCIMMarker(e,a,r._tileInfo):r._markerError);case 5:case"end":return t.stop()}}),i)})))()}},{key:"_createCIM",value:function(e){var r=this;return a.asyncToGenerator(t(s).mark((function i(){var n,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.templateHash,!r._cimTemplateCache.has(n)){t.next=3;break}return t.abrupt("return",r._cimTemplateCache.get(n));case 3:t.t0=e.type,t.next="marker"===t.t0?7:"line"===t.t0?11:"fill"===t.t0?15:"text"===t.t0?19:22;break;case 7:return t.next=9,r._createCIMMarker(e);case 9:return a=t.sent,t.abrupt("break",22);case 11:return t.next=13,r._createCIMLine(e);case 13:return a=t.sent,t.abrupt("break",22);case 15:return t.next=17,r._createCIMFill(e);case 17:return a=t.sent,t.abrupt("break",22);case 19:return t.next=21,r._createCIMText(e);case 21:a=t.sent;case 22:return t.abrupt("return",(r._cimTemplateCache.set(n,a),a));case 23:case"end":return t.stop()}}),i)})))()}},{key:"_createDynamicCIM",value:function(e){var r=this;return a.asyncToGenerator(t(s).mark((function i(){var n,a;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.templateHash,!r._cimTemplateCache.has(n)){t.next=3;break}return t.abrupt("return",r._cimTemplateCache.get(n));case 3:t.t0=e.type,t.next="marker"===t.t0?7:"line"===t.t0?9:"fill"===t.t0?11:"text"===t.t0?13:14;break;case 7:return a=d.default.fromCIMMarker(e,r._tileInfo),t.abrupt("break",14);case 9:return a=y.default.fromCIMLine(e,r._tileInfo),t.abrupt("break",14);case 11:return a=p.default.fromCIMFill(e,r._tileInfo),t.abrupt("break",14);case 13:a=_.default.fromCIMText(e,r._tileInfo);case 14:return t.abrupt("return",(r._cimTemplateCache.set(n,a),a));case 15:case"end":return t.stop()}}),i)})))()}},{key:"_createPrimitiveMeshTemplates",value:function(e,t,r){switch(t.type){case"esriSMS":return P(e,this._createSMS(t));case"esriPMS":return P(e,this._createPMS(t));case"esriSFS":return P(e,this._createSFS(t,r));case"line-marker":return P(e,this._createLMS(t));case"esriPFS":return P(e,this._createPFS(t,r));case"esriSLS":return P(e,this._createSLS(t,!1));case"esriTS":return P(e,this._createTS(t));default:return T.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),e}}},{key:"_createMeshTemplates",value:function(e,t,r){if(-1!==t.type.indexOf("3d"))return T.error("3D symbols are not supported with MapView"),e;if("expanded-cim"===t.type){var i=!0,n=!1,a=void 0;try{for(var s,o=t.layers[Symbol.iterator]();!(i=(s=o.next()).done);i=!0){var l=s.value;"function"==typeof l.materialHash?P(e,this._createDynamicCIM(l)):P(e,this._createCIM(l))}}catch(e){n=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(n)throw a}}return e}if("composite-symbol"===t.type){var u=!0,c=!1,h=void 0;try{for(var f,p=t.layers[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var y=f.value;this._createPrimitiveMeshTemplates(e,y,r)}}catch(e){c=!0,h=e}finally{try{u||null==p.return||p.return()}finally{if(c)throw h}}return e}return"cim"===t.type||"label"===t.type||"web-style"===t.type?e:this._createPrimitiveMeshTemplates(e,t,r)}}]),e}(),O=function(e){if(!e.layers)return!1;var t=!0,r=!1,i=void 0;try{for(var n,a=e.layers[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){if("function"==typeof n.value.materialHash)return!0}}catch(e){r=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw i}}return!1}})),r.register("e9Ylt",(function(t,i){e(t.exports,"default",(function(){return v}));var n=r("8TSCy"),a=r("7qybv"),s=r("iXlXu"),o=r("hUDEJ"),l=r("4WoSm"),u=r("iTfMY"),c=r("8lbQw"),h=r("ktHf8"),f=r("10UfI"),p=r("kN92c"),y=r("bqxun"),d=r("bMiFr"),_=128,v=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i,p){var y,d;if(n.classCallCheck(this,r),(y=t.call(this,e))._minMaxZoom=(0,c.i1616to32)(Math.round(i*l.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(p*l.MIN_MAX_ZOOM_PRECISION_FACTOR)),(0,f.isFunction)(e.color)){y._dynamicPropertyMap.set("fillColor",(function(t,r,i){var n=e.color(t,r,i);return n&&(0,o.premultiplyAlphaRGBA)(n)||0}))}else{var v=e.color;y.fillColor=v&&(0,o.premultiplyAlphaRGBA)(v)||0}var m="CIMMarkerPlacementInsidePolygon"===(null==(d=e.cim.placement)?void 0:d.type)&&e.cim.placement.shiftOddRows?2:1,x=e.height;if((0,f.isFunction)(x)){y._dynamicPropertyMap.set("_height",(function(e,t,r){return x(e,t,r)*m}))}else y._height=(x||0)*m;var g=e.offsetX;if((0,f.isFunction)(g)){y._dynamicPropertyMap.set("_offsetX",(function(e,t,r){var i=(0,s.pt2px)(g(e,t,r))+_;return i>255?i=255:i<0&&(i=0),i}))}else{var M=(0,s.pt2px)(g||0)+_;M>255?M=255:M<0&&(M=0),y._offsetX=M}var b=e.offsetY;if((0,f.isFunction)(b)){y._dynamicPropertyMap.set("_offsetY",(function(e,t,r){var i=(0,s.pt2px)(-b(e,t,r))+_;return i>255?i=255:i<0&&(i=0),i}))}else{var k=(0,s.pt2px)(-b||0)+_;k>255?k=255:k<0&&(k=0),y._offsetY=k}var S=e.scaleX;(0,f.isFunction)(S)?y._dynamicPropertyMap.set("_scaleX",S):y._scaleX=S||1;var T=e.angle;if((0,f.isFunction)(T)){y._dynamicPropertyMap.set("_angle",(function(e,t,r){return(0,u.radToByte)(T(e,t,r))}))}else y._angle=(0,u.radToByte)(T)||0;if((0,a.isSome)(e.effects)){var w=e.effects;(0,f.isFunction)(w)?y._dynamicPropertyMap.set("_effects",w):y._effects=w}return y._cimFillLayer=e,y._fillMaterialKey=h.FillMaterialKey.load(e.materialKey),n.possibleConstructorReturn(y)}return n.createClass(r,[{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)}));var a=this._fillMaterialKey,o=this._materialCache,u=(0,this._cimFillLayer.materialHash)(n,t,r),h=o.get(u),f=null;if(h&&(0,d.ok)(h.spriteMosaicItem)&&(f=h.spriteMosaicItem),f){var p=f.rect,y=f.width,_=f.height,v=p.x+l.SPRITE_PADDING,m=p.y+l.SPRITE_PADDING,x=v+y,g=m+_,M=Math.round((0,s.pt2px)(this._height));M>255?M=255:M<=0&&(M=g-m);var b=Math.round((0,s.pt2px)(this._height/_*y||0));b>255?b=255:b<=0&&(b=x-v);var k=this._scaleX;this.tl=(0,c.i1616to32)(v,m),this.br=(0,c.i1616to32)(x,g),this.aux2=(0,c.i8888to32)(b,M,this._offsetX,this._offsetY),this.aux3=(0,c.i8888to32)(k,1,this._angle,0),a.sdf=f.sdf,a.pattern=!0,a.textureBinding=f.textureBinding}else this.tl=0,this.br=0,this.aux2=0,this.aux3=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data}}],[{key:"fromCIMFill",value:function(e,t){var i=n.slicedToArray((0,f.getMinMaxZoom)(e.scaleInfo,t),2);return new r(e,i[0],i[1])}}]),r}((0,p.default)(y.default))})),r.register("kN92c",(function(t,i){e(t.exports,"default",(function(){return f}));var n=r("8TSCy"),a=r("7qybv"),s=r("akQYU"),o=r("66IJZ"),l=r("8lbQw"),u=r("ktHf8"),c=r("2tbWY"),h=r("AsOJN"),f=function(e){var t=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];var s;return n.classCallCheck(this,r),(s=t.call.apply(t,[this].concat(n.toConsumableArray(i)))).forceLibtess=!1,s._bitset=0,s._lineTemplate=null,s.geometryType=o.WGLGeometryType.FILL,n.possibleConstructorReturn(s)}return n.createClass(r,[{key:"_maybeAddLineTemplate",value:function(e){this._lineTemplate=h.default.fromFillOutline(e)}},{key:"_write",value:function(e,t,r,i){var n="esriGeometryPoint"===t.geometryType,s=u.FillMaterialKey.load(this._materialKey);e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,n),this._writeGeometry(e,t,s,i,n),s.outlinedFill&&(0,a.isSome)(this._lineTemplate)&&this._lineTemplate.writeGeometry(e,t,i,n),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,i,n){var s=this._getGeometry(t,i,n);if(!(0,a.isNone)(s)){var o=[];if(s.maxLength>100||this.forceLibtess||!(0,c.triangulate)(o,s)){var l=(0,c.triangulateLibtess)(s);this._writeVertices(e,t,l,[l.length/2],r)}else o.length&&this._writeVertices(e,t,s.coords,s.lengths,r,o)}}},{key:"_writeVertex",value:function(e,t,r,i,n,a){var s=(0,l.i1616to32)(1*i,1*n);e.vertexBounds(i,n,0,0),e.vertexWrite(s),e.vertexWrite(t),r.dotDensity?e.vertexWriteF32(1/Math.abs(a.readGeometryArea())):(e.vertexWrite(this.fillColor),r.simple||(e.vertexWrite(this.tl),e.vertexWrite(this.br)),e.vertexWrite(this.aux2),e.vertexWrite(this.aux3),r.simple||e.vertexWrite(this._minMaxZoom))}},{key:"_writeVertices",value:function(e,t,r,i,n,a){var s=t.getDisplayId(),o=this._bitset<<24|s,l=i.reduce((function(e,t){return e+t})),u=n.dotDensity?4:10,c=e.vertexCount();e.vertexEnsureSize(u*l);var h=0,f=!0,p=!1,y=void 0;if(a)try{for(var d,_=a[Symbol.iterator]();!(f=(d=_.next()).done);f=!0){var v=d.value,m=r[2*v],x=r[2*v+1];this._writeVertex(e,o,n,m,x,t),h++}}catch(e){p=!0,y=e}finally{try{f||null==_.return||_.return()}finally{if(p)throw y}}else for(var g=0;g<r.length;g+=2){var M=Math.round(r[g]),b=Math.round(r[g+1]);this._writeVertex(e,o,n,M,b,t),h++}e.indexEnsureSize(h);for(var k=0;k<h;k++)e.indexWrite(k+c)}},{key:"_getGeometry",value:function(e,t,r){var i=t?(0,s.deltaDecodeGeometry)((0,s.convertFromGeometry)(t),2):e.readGeometryForDisplay();return i?(0,c.clipMarshall)(i,r?256:8):null}}]),r}(e);return t}})),r.register("2tbWY",(function(t,i){e(t.exports,"triangulate",(function(){return _})),e(t.exports,"triangulateLibtess",(function(){return v})),e(t.exports,"clipMarshall",(function(){return m})),e(t.exports,"clipLinesMarshall",(function(){return x}));var n=r("8TSCy"),a=r("7qybv"),s=(r("2ndsO"),r("fb8De")),o=r("awxBI"),l=r("4WoSm"),u=r("ljf2P"),c=r("eCSGR"),h=r("eWpze"),f=new(0,c.TileClipper)(0,0,0,1,0),p=new(0,c.TileClipper)(0,0,0,1,0);function y(e,t,r){for(var i=0,n=1;n<r;n++){var a=e[2*(t+n-1)],s=e[2*(t+n-1)+1];i+=(e[2*(t+n)]-a)*(e[2*(t+n)+1]+s)}return i}function d(e,t,r,i,n){for(var a=0,s=r;s<i;s+=3){var o=2*(e[s]-n),l=2*(e[s+1]-n),u=2*(e[s+2]-n);a+=Math.abs((t[o]-t[u])*(t[l+1]-t[o+1])-(t[o]-t[l])*(t[u+1]-t[o+1]))}return a}function _(e,t){var r=t.coords,i=t.lengths,n=e;if(t.hasIndeterminateRingOrder)return!1;for(var a=0,s=0;s<i.length;){for(var o=s,l=i[s],u=y(r,a,l),c=[];++o<i.length;){var f=i[o],p=y(r,a+l,f);if(!(p>0))break;u+=p,c.push(a+l),l+=f}var _=n.length;(0,h.bufcut)(n,r,a,a+l,c,2,0);var v=d(n,r,_,n.length,0),m=Math.abs(u);if(Math.abs((v-m)/Math.max(1e-7,m))>1e-5)return n.length=0,!1;s=o,a+=l}return!0}function v(e){var t=e.coords,r=e.lengths;return(0,s.triangulate)(t,r).buffer}function m(e,t){if((0,a.isNone)(e))return null;if(!function(e,t,r){for(var i=0,n=0;n<e.lengths.length;n++){for(var a=e.lengths[n],s=0;s<a;s++){var o=e.coords[2*(s+i)],l=e.coords[2*(s+i)+1];if(o<t||o>r||l<t||l>r)return!0}i+=a}return!1}(e,-128,l.TILE_SIZE+128))return e;f.setPixelMargin(t),f.reset(u.GeometryType.Polygon);for(var r=0,i=0;i<e.lengths.length;i++){var n=e.lengths[i],s=e.coords[2*(0+r)],c=e.coords[2*(0+r)+1];f.moveTo(s,c);for(var h=1;h<n;h++)s=e.coords[2*(h+r)],c=e.coords[2*(h+r)+1],f.lineTo(s,c);f.close(),r+=n}var p=f.result(!1);if(!p)return null;var y=[],d=[],_=!0,v=!1,m=void 0;try{for(var x,g=p[Symbol.iterator]();!(_=(x=g.next()).done);_=!0){var M=x.value,b=0,k=!0,S=!1,T=void 0;try{for(var w,I=M[Symbol.iterator]();!(k=(w=I.next()).done);k=!0){var C=w.value;d.push(C.x),d.push(C.y),b++}}catch(e){S=!0,T=e}finally{try{k||null==I.return||I.return()}finally{if(S)throw T}}y.push(b)}}catch(e){v=!0,m=e}finally{try{_||null==g.return||g.return()}finally{if(v)throw m}}return new(0,o.default)(y,d)}function x(e,t){p.setPixelMargin(t);for(var r=p,i=-t,a=l.TILE_SIZE+t,s=[],o=!1,c=0;c<e.length;){var h=[],f=e[c];if(!f)return null;r.reset(u.GeometryType.LineString);var y=n.slicedToArray(f[0],2),d=y[0],_=y[1];if(o)r.moveTo(d,_);else{if(d<i||d>a||_<i||_>a){o=!0;continue}h.push({x:d,y:_})}for(var v=!1,m=f.length,x=1;x<m;++x)if(d+=f[x][0],_+=f[x][1],o)r.lineTo(d,_);else{if(d<i||d>a||_<i||_>a){v=!0;break}h.push({x:d,y:_})}if(v)o=!0;else{if(o){var g=r.resultWithStarts(),M=!0,b=!1,k=void 0;if(g)try{for(var S,T=g[Symbol.iterator]();!(M=(S=T.next()).done);M=!0){var w=S.value;s.push(w)}}catch(e){b=!0,k=e}finally{try{M||null==T.return||T.return()}finally{if(b)throw k}}}else s.push({line:h,start:0});c++,o=!1}}return 0===(s=s.filter((function(e){return e.line.length>1}))).length?null:s}f.setExtent(l.TILE_SIZE),p.setExtent(l.TILE_SIZE)})),r.register("eWpze",(function(t,i){e(t.exports,"bufcut",(function(){return a}));var n=r("8TSCy");function a(e,t,r,i,n,a,u){C=0;var c,h,f,d,_,v=(i-r)*a,m=n&&n.length,x=m?(n[0]-r)*a:v,g=s(t,r,i,0,x,a,!0);if(g&&g.next!==g.prev){if(m&&(g=function(e,t,r,i,n,a){for(var l=new Array,u=0,c=i.length;u<c;u++){var h=s(e,t,r,i[u]*a,u<c-1?i[u+1]*a:r*a,a,!1);h===h.next&&(h.steiner=!0),l.push(p(h))}l.sort(b);var f=!0,d=!1,_=void 0;try{for(var v,m=l[Symbol.iterator]();!(f=(v=m.next()).done);f=!0){y(v.value,n),n=o(n,n.next)}}catch(e){d=!0,_=e}finally{try{f||null==m.return||m.return()}finally{if(d)throw _}}return n}(t,r,i,n,g,a)),v>80*a){c=f=t[0+r*a],h=d=t[1+r*a];for(var M=a;M<x;M+=a){var k=t[M+r*a],S=t[M+1+r*a];c=Math.min(c,k),h=Math.min(h,S),f=Math.max(f,k),d=Math.max(d,S)}_=0!==(_=Math.max(f-c,d-h))?1/_:0}l(g,e,a,c,h,_,u,0)}}function s(e,t,r,i,n,a,s){var o;if(s===function(e,t,r,i,n,a){for(var s=0,o=i,l=n-a;o<n;o+=a)s+=(e[l+t*a]-e[o+t*a])*(e[o+1+t*a]+e[l+1+t*a]),l=o;return s}(e,t,0,i,n,a)>0)for(var l=i;l<n;l+=a)o=h(l+t*a,e[l+t*a],e[l+1+t*a],o);else for(var u=n-a;u>=i;u-=a)o=h(u+t*a,e[u+t*a],e[u+1+t*a],o);return o&&M(o,o.next)&&(f(o),o=o.next),o}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(!e)return e;var r,i=e;do{if(r=!1,i.steiner||!M(i,i.next)&&0!==_(i.prev,i,i.next))i=i.next;else{if(f(i),(i=t=i.prev)===i.next)break;r=!0}}while(r||i!==t);return t}function l(e,t,r,i,n,a,s,h){if(e){!h&&a&&(e=d(e,i,n,a));for(var p=e;e.prev!==e.next;){var y=e.prev,_=e.next;if(a?c(e,i,n,a):u(e))t.push(y.index/r+s),t.push(e.index/r+s),t.push(_.index/r+s),f(e),e=_.next,p=_.next;else if((e=_)===p){h?1===h?l(e=k(e,t,r,s),t,r,i,n,a,s,2):2===h&&S(e,t,r,i,n,a,s):l(o(e),t,r,i,n,a,s,1);break}}}}function u(e){var t=e.prev,r=e,i=e.next;if(_(t,r,i)>=0)return!1;for(var n=e.next.next,a=n,s=0;n!==e.prev&&(0===s||n!==a);){if(s++,m(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&_(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function c(e,t,r,i){var n=e.prev,a=e,s=e.next;if(_(n,a,s)>=0)return!1;for(var o=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,l=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,u=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,c=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,h=g(o,l,t,r,i),f=g(u,c,t,r,i),p=e.prevZ,y=e.nextZ;p&&p.z>=h&&y&&y.z<=f;){if(p!==e.prev&&p!==e.next&&m(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,y!==e.prev&&y!==e.next&&m(n.x,n.y,a.x,a.y,s.x,s.y,y.x,y.y)&&_(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&m(n.x,n.y,a.x,a.y,s.x,s.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;y&&y.z<=f;){if(y!==e.prev&&y!==e.next&&m(n.x,n.y,a.x,a.y,s.x,s.y,y.x,y.y)&&_(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function h(e,t,r,i){var n=w.create(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function f(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function p(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function y(e,t){if(t=function(e,t){var r,i=t,n=e.x,a=e.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var o=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=n&&o>s){if(s=o,o===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===s)return r.prev;var l,u=r,c=r.x,h=r.y,f=1/0;for(i=r.next;i!==u;)n>=i.x&&i.x>=c&&n!==i.x&&m(a<h?n:s,a,c,h,a<h?s:n,a,i.x,i.y)&&((l=Math.abs(a-i.y)/(n-i.x))<f||l===f&&i.x>r.x)&&x(i,e)&&(r=i,f=l),i=i.next;return r}(e,t)){var r=T(t,e);o(r,r.next)}}function d(e,t,r,i){for(var n;n!==e;n=n.next){if(null===(n=n||e).z&&(n.z=g(n.x,n.y,t,r,i)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,d(e,t,r,i);n.prevZ=n.prev,n.nextZ=n.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){for(var t,r=1;;){var i=void 0,n=e;e=null,t=null;for(var a=0;n;){a++,i=n;for(var s=0;s<r&&i;s++)i=i.nextZ;for(var o=r;s>0||o>0&&i;){var l=void 0;0===s?(l=i,i=i.nextZ,o--):0!==o&&i?n.z<=i.z?(l=n,n=n.nextZ,s--):(l=i,i=i.nextZ,o--):(l=n,n=n.nextZ,s--),t?t.nextZ=l:e=l,l.prevZ=t,t=l}n=i}if(t.nextZ=null,r*=2,a<2)return e}}(e)}function _(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function v(e,t,r,i){return!!(M(e,t)&&M(r,i)||M(e,i)&&M(r,t))||_(e,t,r)>0!=_(e,t,i)>0&&_(r,i,e)>0!=_(r,i,t)>0}function m(e,t,r,i,n,a,s,o){return(n-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(i-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(n-s)*(i-o)>=0}function x(e,t){return _(e.prev,e,e.next)<0?_(e,t,e.next)>=0&&_(e,e.prev,t)>=0:_(e,t,e.prev)<0||_(e,e.next,t)<0}function g(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function M(e,t){return e.x===t.x&&e.y===t.y}function b(e,t){return e.x-t.x}function k(e,t,r,i){var n=e;do{var a=n.prev,s=n.next.next;!M(a,s)&&v(a,n,n.next,s)&&x(a,s)&&x(s,a)&&(t.push(a.index/r+i),t.push(n.index/r+i),t.push(s.index/r+i),f(n),f(n.next),n=e=s),n=n.next}while(n!==e);return n}function S(e,t,r,i,n,a,s){var u,c,h=e;do{for(var f=h.next.next;f!==h.prev;){if(h.index!==f.index&&(c=f,(u=h).next.index!==c.index&&u.prev.index!==c.index&&!function(e,t){var r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&v(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(u,c)&&x(u,c)&&x(c,u)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(u,c))){var p=T(h,f);return h=o(h,h.next),p=o(p,p.next),l(h,t,r,i,n,a,s,0),void l(p,t,r,i,n,a,s,0)}f=f.next}h=h.next}while(h!==e)}function T(e,t){var r=w.create(e.index,e.x,e.y),i=w.create(t.index,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}for(var w=function(){"use strict";function e(){n.classCallCheck(this,e),this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return n.createClass(e,null,[{key:"create",value:function(t,r,i){var n=C<I.length?I[C++]:new e;return n.index=t,n.x=r,n.y=i,n.prev=null,n.next=null,n.z=null,n.prevZ=null,n.nextZ=null,n.steiner=!1,n}}]),e}(),I=new Array,C=0,L=0;L<8096;L++)I.push(new w)})),r.register("AsOJN",(function(t,i){e(t.exports,"default",(function(){return v}));var n=r("8TSCy"),a=r("jHOLN"),s=r("iXlXu"),o=r("6LoaD"),l=r("hUDEJ"),u=r("4WoSm"),c=r("8lbQw"),h=r("5WctK"),f=r("ktHf8"),p=r("10UfI"),y=r("8q8rQ"),d=r("5Izwl"),_=a.default.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate"),v=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i,a,s,o,l,h,y,d,_,v,m,x,g,M,b,k,S,T){var w;n.classCallCheck(this,r),w=t.call(this);var I=f.LineMaterialKey.load(e);i&&(I.sdf=i.sdf,I.pattern=!0,I.textureBinding=i.textureBinding),w._capType=s,w._joinType=o,w._miterLimitCosine=(0,p.getLimitCosine)(l),w.tessellationProperties._fillColor=h,w.tessellationProperties._tl=y,w.tessellationProperties._br=d,w._hasPattern=_,w._isDashed=v,w._zOrder=b,w._effects=k,w._minMaxZoom=(0,c.i1616to32)(Math.round(S*u.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(T*u.MIN_MAX_ZOOM_PRECISION_FACTOR)),w._materialKey=I.data;var C=(x?u.BITSET_GENERIC_LOCK_COLOR:0)|(g?u.BITSET_TYPE_FILL_OUTLINE:0)|(m?u.BITSET_LINE_SCALE_DASH:0);return w.tessellationProperties._bitset=C,w.tessellationProperties._halfWidth=.5*a,w.tessellationProperties._halfReferenceWidth=.5*M,w.tessellationProperties.offset=0,w._initializeTessellator(!1),w}return n.createClass(r,null,[{key:"fromCIMLine",value:function(e,t,i){var a=e.color,h=e.scaleFactor||1,f=!!e.dashTemplate,y=e.cap;f&&y===o.CapType.ROUND&&(y=o.CapType.SQUARE);var d=e.join,_=(0,s.pt2px)(e.width)*h,v=(0,s.pt2px)(e.referenceWidth),m=(0,s.pt2px)(e.miterLimit),x=a&&(0,l.premultiplyAlphaRGBA)(a)||0,g=n.slicedToArray((0,p.getMinMaxZoom)(e.scaleInfo,i),2),M=g[0],b=g[1];if(!t)return new r(e.materialKey,t,_,y,d,m,x,0,0,!1,f,e.scaleDash,e.colorLocked,!1,v,e.zOrder,e.effects,M,b);var k=t.rect,S=t.width,T=t.height,w=k.x+u.SPRITE_PADDING,I=k.y+u.SPRITE_PADDING,C=w+S,L=I+T,A=(0,c.i1616to32)(w,I),P=(0,c.i1616to32)(C,L);return new r(e.materialKey,t,_,y,d,m,x,A,P,!0,f,e.scaleDash,e.colorLocked,!1,v,e.zOrder,e.effects,M,b)}},{key:"fromFillOutline",value:function(e){var t;return e.isOutlinedFill&&e.outline&&"esriSLSSolid"===(null==(t=e.outline)?void 0:t.style)?r.fromSimpleLine(n.objectSpread({hash:"",materialKey:e.materialKey},e.outline),null,!0):null}},{key:"fromSimpleLine",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.color,a="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,o=(0,h.getCapType)(e.cap||"round"),f=(0,h.getJoinType)(e.join||"round"),y=n&&"esriSLSNull"!==e.style&&(0,l.premultiplyAlphaRGBAArray)(n)||0;"esriSLSNull"===e.style&&(y=0);var d=(0,s.pt2px)(e.width),_=e.miterLimit;if(!t)return new r(e.materialKey,t,d,o,f,_,y,0,0,!1,a,!0,!1,i,d,0,null,p.DEFAULT_MIN_ZOOM,p.DEFAULT_MAX_ZOOM);var v=t.rect,m=t.width,x=t.height,g=v.x+u.SPRITE_PADDING,M=v.y+u.SPRITE_PADDING,b=g+m,k=M+x,S=(0,c.i1616to32)(g,M),T=(0,c.i1616to32)(b,k);return new r(e.materialKey,t,d,o,f,_,y,S,T,!0,a,!0,!1,i,d,0,null,p.DEFAULT_MIN_ZOOM,p.DEFAULT_MAX_ZOOM)}},{key:"fromPictureLineSymbol",value:function(e,t,r,i){return _.error("PictureLineSymbol support does not exist!"),null}}]),r}((0,y.default)(d.default))})),r.register("8q8rQ",(function(t,i){e(t.exports,"default",(function(){return p}));var n=r("8TSCy"),a=r("7qybv"),s=r("4WoSm"),o=r("66IJZ"),l=r("8lbQw"),u=r("8DFoJ"),c=r("ktHf8"),h=r("2tbWY"),f=16,p=function(e){var t=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];var s;return n.classCallCheck(this,r),(s=t.call.apply(t,[this].concat(n.toConsumableArray(i)))).tessellationProperties={},s._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},s.geometryType=o.WGLGeometryType.LINE,n.possibleConstructorReturn(s)}return n.createClass(r,[{key:"writeGeometry",value:function(e,t,r,i){this._writeGeometry(e,t,r,i)}},{key:"_initializeTessellator",value:function(e){var t=c.LineMaterialKey.load(this._materialKey),r=c.FillMaterialKey.load(this._materialKey),i=this._tessellationOptions,n=t.vvSizeFieldStops||t.vvSizeMinMaxValue||t.vvSizeScaleStops||t.vvSizeUnitValue,a=this.tessellationProperties._halfWidth<s.THIN_LINE_HALF_WIDTH_THRESHOLD&&!e&&!n;this.tessellationProperties.minMaxZoom=this._minMaxZoom,i.wrapDistance=65535,i.textured=this._isDashed||this._hasPattern,i.offset=this.tessellationProperties.offset,i.halfWidth=this.tessellationProperties._halfWidth;var o=a?0:1,l=r.outlinedFill?d:y;this._lineTessellator=new(0,u.LineTessellation)(l(this.tessellationProperties,o,o),_(this.tessellationProperties),a)}},{key:"_write",value:function(e,t,r,i){var n="esriGeometryPoint"===t.geometryType;e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,n),this._writeGeometry(e,t,i,n),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,i){var n=null!=r?r:t.readLegacyGeometryForDisplay(),s=this._getLines(n,i);(0,a.isNone)(s)||this._writeVertices(e,t,s)}},{key:"_getLines",value:function(e,t){if((0,a.isNone)(e))return null;var r=e.paths||e.rings;return(0,a.isNone)(r)?null:(0,h.clipLinesMarshall)(r,t?256:16)}},{key:"_writeVertices",value:function(e,t,r){var i=t.getDisplayId(),n=e.vertexCount(),a=this.tessellationProperties,s=this._tessellationOptions;a.out=e,a.id=i,a.indexCount=0,a.vertexCount=0,a.offset=n,s.capType=this._capType,s.joinType=this._joinType;var o=c.FillMaterialKey.load(this._materialKey);this.tessellationProperties.key=o.outlinedFill?o:c.LineMaterialKey.load(this._materialKey);var l=!0,u=!1,h=void 0;try{for(var f,p=r[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var y=f.value,d=y.line,_=y.start;s.initialDistance=_%65535,this._lineTessellator.tessellate(d,s)}}catch(e){u=!0,h=e}finally{try{l||null==p.return||p.return()}finally{if(u)throw h}}}}]),r}(e);return t},y=function(e,t,r){return function(i,n,a,s,o,u,c,h,p,y,d){var _=(0,l.i1616to32)(d,Math.ceil(f*e._halfWidth)),v=(0,l.i8888to32)(Math.round(f*c),Math.round(f*h),Math.round(f*p),Math.round(f*y)),m=(0,l.i8888to32)(f*o,f*u,0,e._bitset),x=e.out;return x.vertexBounds(i,n,t,r),x.vertexWrite((0,l.i1616to32)(8*i,8*n)),x.vertexWrite(e.id),x.vertexWrite(e._fillColor),x.vertexWrite(v),x.vertexWrite(_),x.vertexWrite(e._tl),x.vertexWrite(e._br),x.vertexWrite(m),x.vertexWrite((0,l.i1616to32)(Math.ceil(f*e._halfReferenceWidth),0)),x.vertexWrite(e.minMaxZoom),x.vertexEnd(),e.offset+e.vertexCount++}},d=function(e,t,r){return function(i,n,a,s,o,u,c,h,p,y,d){var _=(0,l.i8888to32)(0,0,f*e._halfWidth,f*e._halfReferenceWidth),v=(0,l.i8888to32)(f*c+128,f*h+128,f*p+128,f*y+128),m=e.out,x=e._bitset<<24|e.id;return m.vertexBounds(i,n,t,r),m.vertexWrite((0,l.i1616to32)(8*i,8*n)),m.vertexWrite(x),m.vertexWrite(e._fillColor),e.key.simple||(m.vertexWrite(0),m.vertexWrite(0)),m.vertexWrite(_),m.vertexWrite(v),e.key.simple||m.vertexWrite(e.minMaxZoom),m.vertexEnd(),e.offset+e.vertexCount++}},_=function(e){return function(t,r,i){var n=e.out;n.indexWrite(t),n.indexWrite(r),n.indexWrite(i),e.indexCount+=3}}})),r.register("bqxun",(function(t,i){e(t.exports,"default",(function(){return c}));var n=r("8TSCy"),a=r("jHOLN"),s=r("aNOUb"),o=r("1o7Kk"),l=r("5Izwl"),u=a.default.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate"),c=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e){var i;return n.classCallCheck(this,r),(i=t.call(this))._ongoingMaterialRequestMap=new Map,i._materialCache=new Map,i._dynamicPropertyMap=new Map,i._cimLayer=e,n.possibleConstructorReturn(i)}return n.createClass(r,[{key:"analyze",value:function(e,t,r,i,n){var a=this;if(n&&0===n.length)return null;var l=n&&n.length>0,c=t.readLegacyFeature(),h=this._materialCache,f=this._cimLayer.materialHash;if(!f)return u.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);var p="function"==typeof f?f(c,r,i):f;if(h.has(p)){var y=h.get(p);return Promise.resolve(y)}var d=this._ongoingMaterialRequestMap.get(p);if(d)return d;var _=this._cimLayer,v=(0,s.analyzeCIMResource)(_.cim,this._cimLayer.materialOverrides);v.mosaicHash=p;var m=_.type,x=_.url,g={cim:v,type:m,mosaicHash:p,url:x,size:null,dashTemplate:null,text:null,fontName:null};switch(m){case"marker":g.size=(0,o.evaluateValueOrFunction)(_.size,c,r,i);break;case"line":g.dashTemplate=_.dashTemplate;break;case"text":g.text=(0,o.evaluateValueOrFunction)(_.text,c,r,i),g.fontName=(0,o.evaluateValueOrFunction)(_.fontName,c,r,i)}var M=e.getMosaicItem(g,n).then((function(e){return l||(a._ongoingMaterialRequestMap.delete(p),h.set(p,e)),e})).catch((function(e){return a._ongoingMaterialRequestMap.delete(p),u.error(".analyze()",e.message),null}));return l||this._ongoingMaterialRequestMap.set(p,M),M}}]),r}(l.default)})),r.register("bMiFr",(function(t,i){e(t.exports,"ok",(function(){return a}));var n=r("kyj08");function a(e,t){if(e&&"name"in e){var r=e;return t&&t.error(new(0,n.default)(r.name,r.message,r.details)),!1}return!0}})),r.register("lGMdi",(function(t,i){e(t.exports,"default",(function(){return d}));var n=r("8TSCy"),a=r("7qybv"),s=r("iXlXu"),o=r("hUDEJ"),l=r("4WoSm"),u=r("8lbQw"),c=r("ktHf8"),h=r("10UfI"),f=r("8q8rQ"),p=r("bqxun"),y=r("bMiFr"),d=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i,c){var f;n.classCallCheck(this,r),(f=t.call(this,e))._minMaxZoom=(0,u.i1616to32)(Math.round(i*l.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(c*l.MIN_MAX_ZOOM_PRECISION_FACTOR)),f._cimLineLayer=e;var p=0;(0,h.isFunction)(e.width)||(p=.5*(0,s.pt2px)(e.width));f._dynamicPropertyMap.set("_halfWidth",(function(t,r,i){return(0,h.isFunction)(e.width)?.5*(0,s.pt2px)(e.width(t,r,i)):p})),(0,h.isFunction)(e.cap)?f._dynamicPropertyMap.set("_capType",e.cap):f._capType=e.cap,(0,h.isFunction)(e.join)?f._dynamicPropertyMap.set("_joinType",e.join):f._joinType=e.join;var y=e.color;if((0,h.isFunction)(y)){f._dynamicPropertyMap.set("_fillColor",(function(e,t,r){return(0,o.premultiplyAlphaRGBA)(y(e,t,r))}))}else f._fillColor=y&&(0,o.premultiplyAlphaRGBA)(y)||0;var d=e.miterLimit;if((0,h.isFunction)(d)){f._dynamicPropertyMap.set("_miterLimitCosine",(function(e,t,r){return(0,h.getLimitCosine)(d(e,t,r))}))}else f._miterLimitCosine=(0,h.getLimitCosine)(d);if((0,a.isSome)(e.effects)){var _=e.effects;(0,h.isFunction)(_)?f._dynamicPropertyMap.set("_effects",_):f._effects=_}return f._scaleFactor=e.scaleFactor||1,f._isDashed=null!=e.dashTemplate,f.tessellationProperties._bitset=(e.colorLocked?1:0)|(e.scaleDash?1:0)<<1,f._materialKey=e.materialKey,f._initializeTessellator(!0),n.possibleConstructorReturn(f)}return n.createClass(r,[{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)})),this._halfWidth*=this._scaleFactor;var a=this._materialCache,s=(0,this._cimLineLayer.materialHash)(n,t,r),o=a.get(s),h=null;if(o&&(0,y.ok)(o.spriteMosaicItem)&&(h=o.spriteMosaicItem),h){this._hasPattern=!0;var f=h.rect,p=h.width,d=h.height,_=f.x+l.SPRITE_PADDING,v=f.y+l.SPRITE_PADDING,m=_+p,x=v+d;this.tessellationProperties._tl=(0,u.i1616to32)(_,v),this.tessellationProperties._br=(0,u.i1616to32)(m,x)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;var g=c.LineMaterialKey.load(this._materialKey);h&&(g.sdf=h.sdf,g.pattern=!0,g.textureBinding=h.textureBinding),this._materialKey=g.data}}],[{key:"fromCIMLine",value:function(e,t){var i=n.slicedToArray((0,h.getMinMaxZoom)(e.scaleInfo,t),2);return new r(e,i[0],i[1])}}]),r}((0,f.default)(p.default))})),r.register("2ZfpK",(function(t,i){e(t.exports,"default",(function(){return k}));var n=r("8TSCy"),a=r("kyj08"),s=r("jHOLN"),o=r("7qybv"),l=r("iXlXu"),u=r("cMCBC"),c=r("0P8XU"),h=r("6LoaD"),f=r("hUDEJ"),p=r("4WoSm"),y=r("8lbQw"),d=r("ktHf8"),_=r("10UfI"),v=r("5DWwP"),m=r("bqxun"),x=r("bMiFr"),g=(0,c.c)(),M=(0,u.c)(),b=s.default.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate"),k=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i,a){var s;n.classCallCheck(this,r),(s=t.call(this,e))._cimMarkerLayer=e,s._minMaxZoom=(0,y.i1616to32)(Math.round(i*p.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(a*p.MIN_MAX_ZOOM_PRECISION_FACTOR));var u=e.color;if((0,_.isFunction)(u)){s._dynamicPropertyMap.set("_fillColor",(function(e,t,r){return(0,f.premultiplyAlphaRGBA)(u(e,t,r))}))}else s._fillColor=(0,f.premultiplyAlphaRGBA)(u);var c=e.outlineColor;if((0,_.isFunction)(c)){s._dynamicPropertyMap.set("_outlineColor",(function(e,t,r){return(0,f.premultiplyAlphaRGBA)(c(e,t,r))}))}else s._outlineColor=(0,f.premultiplyAlphaRGBA)(c);var d=e.size;if((0,_.isFunction)(d)){s._dynamicPropertyMap.set("_size",(function(e,t,r){return(0,l.pt2px)(d(e,t,r))}))}else s._size=(0,l.pt2px)(d)||0;var v=e.scaleX;(0,_.isFunction)(v)?s._dynamicPropertyMap.set("_scaleX",v):s._scaleX=v||1;var m=e.offsetX;if((0,_.isFunction)(m)){s._dynamicPropertyMap.set("xOffset",(function(e,t,r){return(0,l.pt2px)(m(e,t,r))}))}else s.xOffset=(0,l.pt2px)(m)||0;var x=e.offsetY;if((0,_.isFunction)(x)){s._dynamicPropertyMap.set("yOffset",(function(e,t,r){return(0,l.pt2px)(x(e,t,r))}))}else s.yOffset=(0,l.pt2px)(x)||0;var g=e.outlineWidth;if((0,_.isFunction)(g)){s._dynamicPropertyMap.set("_outlineWidth",(function(e,t,r){return(0,l.pt2px)(g(e,t,r))}))}else s._outlineWidth=(0,l.pt2px)(g)||0;var M=e.rotation;if((0,_.isFunction)(M)?s._dynamicPropertyMap.set("_angle",M):s._angle=M||0,(0,o.isSome)(e.effects)){var b=e.effects;(0,_.isFunction)(b)?s._dynamicPropertyMap.set("_effects",b):s._effects=b}if((0,o.isSome)(e.markerPlacement)){var k=e.markerPlacement;(0,_.isFunction)(k)?s._dynamicPropertyMap.set("_markerPlacement",k):s._markerPlacement=k}return s._scaleFactor=(0,o.unwrapOr)(e.scaleFactor,1),s._bitSet=(e.alignment===h.Alignment.MAP?1:0)|(e.colorLocked?1:0)<<1|(e.scaleSymbolsProportionally?1:0)<<3,s._materialKey=e.materialKey,n.possibleConstructorReturn(s)}return n.createClass(r,[{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)}));var s=this._cimMarkerLayer.materialHash,o="function"==typeof s?s(n,t,r):s,u=this._materialCache.get(o);if(u&&(0,x.ok)(u.spriteMosaicItem)&&u.spriteMosaicItem){var c=u.spriteMosaicItem,h=this._cimMarkerLayer.sizeRatio,f=c.width/c.height*this._scaleX,_=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,v=this._size,m=v*f,k=this.xOffset,S=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;var T=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/(0,l.pt2px)(this._cimMarkerLayer.frameHeight):1,w=this._outlineWidth*T,I=(0,l.pt2px)(this._cimMarkerLayer.referenceSize),C=0,L=0,A=this._cimMarkerLayer.anchorPoint;A&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(C=-A.x/(this._size*f),L=A.y/this._size):(C=A.x,L=A.y)),this._sizeOutlineWidth=(0,y.i8888to32)(Math.round(Math.min(Math.sqrt(128*m),255)),Math.round(Math.min(Math.sqrt(128*v),255)),Math.round(Math.min(Math.sqrt(128*w),255)),Math.round(Math.min(Math.sqrt(128*I),255))),this.angle=_;var P=Math.round(64*h);this._bitestAndDistRatio=(0,y.i1616to32)(this._bitSet,P);var E=c.rect.x+p.SPRITE_PADDING,R=c.rect.y+p.SPRITE_PADDING,O=E+c.width,W=R+c.height;this._texUpperLeft=(0,y.i1616to32)(E,R),this._texUpperRight=(0,y.i1616to32)(O,R),this._texBottomLeft=(0,y.i1616to32)(E,W),this._texBottomRight=(0,y.i1616to32)(O,W);var G=d.MarkerMaterialKey.load(this._materialKey);G.sdf=c.sdf,G.pattern=!0,G.textureBinding=c.textureBinding,this._materialKey=G.data,this._anchorX=.5-(.5+C)*c.width/c.width,this._anchorY=.5-(.5+L)*c.height/c.height,m*=h,v*=h,m*=this._scaleFactor,v*=this._scaleFactor,m*=c.rect.width/c.width,v*=c.rect.height/c.height,this._computedWidth=m,this._computedHeight=v,this._applyTransformation(M,g),this.xOffset=k,this.yOffset=S}else b.error(new(0,a.default)("mapview-cim","Encountered an error when binding feature"))}}],[{key:"fromCIMMarker",value:function(e,t){var i=n.slicedToArray((0,_.getMinMaxZoom)(e.scaleInfo,t),2);return new r(e,i[0],i[1])}}]),r}((0,v.default)(m.default))})),r.register("ieevV",(function(i,n){e(i.exports,"default",(function(){return x}));var a=r("8TSCy"),s=r("2TvXO"),o=r("7qybv"),l=r("iXlXu"),u=r("6LoaD"),c=r("6S0qa"),h=r("hUDEJ"),f=r("4WoSm"),p=r("8lbQw"),y=r("ktHf8"),d=r("10UfI"),_=r("6aUmX"),v=r("bqxun"),m=r("4gcZA");var x=function(e){"use strict";a.inherits(i,e);var r=a.createSuper(i);function i(e,t,n){var s;a.classCallCheck(this,i),(s=r.call(this,e))._horizontalAlignment="center",s._verticalAlignment="middle",s._textToGlyphs=new Map,s._minMaxZoom=(0,p.i1616to32)(Math.round(t*f.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(n*f.MIN_MAX_ZOOM_PRECISION_FACTOR));var c=e.scaleFactor||1;s._cimTextLayer=e;var _=e.color;if((0,d.isFunction)(_)){s._dynamicPropertyMap.set("_color",(function(e,t,r){return(0,h.premultiplyAlphaRGBA)(_(e,t,r))}))}else s._color=(0,h.premultiplyAlphaRGBA)(_);var v,m=e.outlineColor;if((0,d.isFunction)(m)){s._dynamicPropertyMap.set("_haloColor",(function(e,t,r){return(0,h.premultiplyAlphaRGBA)(m(e,t,r))}))}else s._haloColor=(0,h.premultiplyAlphaRGBA)(m);(0,d.isFunction)(e.size)||(v=Math.min(Math.round((0,l.pt2px)(e.size*e.sizeRatio)),127));var x;if(s._dynamicPropertyMap.set("_size",(function(t,r,i){return(0,d.isFunction)(e.size)?Math.min(Math.round((0,l.pt2px)(e.size(t,r,i)*e.sizeRatio)),127):v})),(0,d.isFunction)(e.outlineSize)){s._dynamicPropertyMap.set("_haloSize",(function(t,r,i){return Math.min(Math.floor(5*(0,l.pt2px)(e.outlineSize(t,r,i)*e.sizeRatio)),127)}))}else s._haloSize=Math.min(Math.floor(5*(0,l.pt2px)(e.outlineSize*e.sizeRatio)),127);(0,d.isFunction)(e.offsetX)||(x=Math.round((0,l.pt2px)(e.offsetX*e.sizeRatio)));var g;s._dynamicPropertyMap.set("_xOffset",(function(t,r,i){return(0,d.isFunction)(e.offsetX)?Math.round((0,l.pt2px)(e.offsetX(t,r,i)*e.sizeRatio)):x})),(0,d.isFunction)(e.offsetY)||(g=Math.round((0,l.pt2px)(e.offsetY*e.sizeRatio)));if(s._dynamicPropertyMap.set("_yOffset",(function(t,r,i){return(0,d.isFunction)(e.offsetY)?Math.round((0,l.pt2px)(e.offsetY(t,r,i)*e.sizeRatio)):g})),(0,d.isFunction)(e.angle)?s._dynamicPropertyMap.set("_angle",e.angle):s._angle=e.angle,(0,d.isFunction)(e.horizontalAlignment)?s._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):s._horizontalAlignment=e.horizontalAlignment,(0,d.isFunction)(e.verticalAlignment)?s._dynamicPropertyMap.set("_verticalAlignment",e.verticalAlignment):s._verticalAlignment=e.verticalAlignment,(0,o.isSome)(e.effects)){var M=e.effects;(0,d.isFunction)(M)?s._dynamicPropertyMap.set("_effects",M):s._effects=M}if((0,o.isSome)(e.markerPlacement)){var b=e.markerPlacement;(0,d.isFunction)(b)?s._dynamicPropertyMap.set("_markerPlacement",b):s._textPlacement=b}(0,d.isFunction)(e.text)?s._dynamicPropertyMap.set("_text",e.text):s._text=e.text,s._scaleFactor=c;var k=Math.min(Math.round((0,l.pt2px)(e.referenceSize*e.sizeRatio)),127);s._referenceSize=Math.round(Math.sqrt(256*k)),s._materialKey=e.materialKey;var S=y.TextMaterialKey.load(s._materialKey);return S.sdf=!0,s._bitset=(e.alignment===u.Alignment.MAP?1:0)|(e.colorLocked?1:0)<<1,s._materialKey=S.data,s._decoration="none",s._lineHeight=1,s._lineWidth=512,s._isCIM=!0,a.possibleConstructorReturn(s)}return a.createClass(i,[{key:"analyze",value:function(e,r,n,o){var l=this,u=this;return a.asyncToGenerator(t(s).mark((function c(){var h,f,p;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h=r.readLegacyFeature(),s=u._cimTextLayer,c=h,y=n,d=o,f="string"==typeof s.text?s.text:"function"==typeof s.text?s.text(c,y,d):"",t.next=4,a.get(a.getPrototypeOf(i.prototype),"analyze",l).call(u,e,r,n,o,(0,m.codepoints)(f));case 4:return p=t.sent,t.abrupt("return",(p&&p.glyphMosaicItems&&u._textToGlyphs.set(f,p.glyphMosaicItems),p));case 6:case"end":return t.stop()}var s,c,y,d}),c)})))()}},{key:"bindFeature",value:function(e,t,r){var i=this,n=e.readLegacyFeature();if(this._dynamicPropertyMap.forEach((function(e,a){i[a]=e(n,t,r)})),this._text&&0!==this._text.length){this._size*=this._scaleFactor,this._scale=this._size/f.GLYPH_SIZE,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=(0,c.getXAnchorDirection)(this._horizontalAlignment||"center"),this._yAlignD=(0,c.getYAnchorDirection)(this._verticalAlignment||"baseline");var a=this._textToGlyphs.get(this._text);this.bindTextInfo(a,!1)}else this._shapingInfo=null}}],[{key:"fromCIMText",value:function(e,t){var r=a.slicedToArray((0,d.getMinMaxZoom)(e.scaleInfo,t),2);return new i(e,r[0],r[1])}}]),i}((0,_.default)(v.default))})),r.register("4gcZA",(function(t,r){function i(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}e(t.exports,"codepoints",(function(){return i}))})),r.register("cHDNQ",(function(t,i){e(t.exports,"default",(function(){return d}));var n=r("8TSCy"),a=r("iXlXu"),s=r("hUDEJ"),o=r("4WoSm"),l=r("iTfMY"),u=r("8lbQw"),c=r("ktHf8"),h=r("10UfI"),f=r("kN92c"),p=r("5Izwl"),y=128,d=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i,a,s,l,h,f,p,y,d,_,v,m,x,g,M){var b;n.classCallCheck(this,r),(b=t.call(this))._effects=x;var k=c.FillMaterialKey.load(e);return i&&(k.sdf=i.sdf,k.pattern=!0,k.textureBinding=i.textureBinding),b.fillColor=a,b.tl=s,b.br=l,b.aux2=(0,u.i8888to32)(h,f,p,y),b.aux3=(0,u.i8888to32)(d,_,v,0),b._bitset=m,b._minMaxZoom=(0,u.i1616to32)(Math.round(g*o.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(M*o.MIN_MAX_ZOOM_PRECISION_FACTOR)),b._materialKey=k.data,n.possibleConstructorReturn(b)}return n.createClass(r,null,[{key:"fromCIMFill",value:function(e,t,i){var c=e.color,f=c&&(0,s.premultiplyAlphaRGBA)(c)||0,p=e.materialKey,d=n.slicedToArray((0,h.getMinMaxZoom)(e.scaleInfo,i),2),_=d[0],v=d[1];if(!t)return new r(p,null,f,0,0,0,0,0,0,0,0,0,e.colorLocked?o.BITSET_GENERIC_LOCK_COLOR:0,e.effects,_,v);var m=t.rect,x=t.width,g=t.height,M=e.scaleX||1,b=m.x+o.SPRITE_PADDING,k=m.y+o.SPRITE_PADDING,S=b+x,T=k+g,w=e.height,I=M*w,C=Math.round(w);C>255?C=255:C<=0&&(C=T-k);var L=Math.round(I);L>255?L=255:L<=0&&(L=S-b);var A=(0,a.pt2px)(e.offsetX||0)+y;A>255&&(A=255);var P=(0,a.pt2px)(-e.offsetY||0)+y;return P>255&&(P=255),new r(p,t,f,(0,u.i1616to32)(b,k),(0,u.i1616to32)(S,T),L,C,A,P,y,y,(0,l.degToByte)(e.angle),e.colorLocked?o.BITSET_GENERIC_LOCK_COLOR:0,e.effects,_,v)}},{key:"fromSimpleFill",value:function(e,t){var i,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.color,l=a&&"esriSFSNull"!==e.style&&(0,s.premultiplyAlphaRGBAArray)(a)||0,c=n?o.BITSET_GENERIC_LOCK_COLOR:0,f=e.materialKey;if(t){var p=t.rect,d=t.width,_=t.height,v=p.x+o.SPRITE_PADDING,m=p.y+o.SPRITE_PADDING,x=v+d,g=m+_,M=(0,u.i1616to32)(v,m),b=(0,u.i1616to32)(x,g);i=new r(f,t,l,M,b,d,_,0,0,y,y,0,c,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM)}else i=new r(f,null,l,0,0,0,0,0,0,0,0,0,c,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM);return i._maybeAddLineTemplate(e),i}},{key:"fromPictureFill",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=o.PICTURE_FILL_COLOR,s=t.rect,l=t.width,c=t.height,f=s.x+o.SPRITE_PADDING,p=s.y+o.SPRITE_PADDING,d=f+l,_=p+c,v=(0,u.i1616to32)(f,p),m=(0,u.i1616to32)(d,_),x=Math.round((0,a.pt2px)(e.width));x>255&&(x=255);var g=Math.round((0,a.pt2px)(e.height));g>255&&(g=255);var M=(0,a.pt2px)(e.xoffset)+y;M>255&&(M=255);var b=(0,a.pt2px)(-e.yoffset)+y;b>255&&(b=255);var k=e.materialKey,S=i?o.BITSET_GENERIC_LOCK_COLOR:0,T=new r(k,t,n,v,m,x,g,M,b,y*e.xscale,y*e.yscale,0,S,null,h.DEFAULT_MIN_ZOOM,h.DEFAULT_MAX_ZOOM);return T._maybeAddLineTemplate(e),T}}]),r}((0,f.default)(p.default))})),r.register("hfZF0",(function(i,n){e(i.exports,"default",(function(){return l})),e(i.exports,"withLock",(function(){return u}));var a=r("8TSCy"),s=r("2TvXO"),o=r("10vEZ"),l=function(){"use strict";function e(){a.classCallCheck(this,e),this._resolver=null}return a.createClass(e,[{key:"isHeld",value:function(){return!!this._resolver}},{key:"acquire",value:function(){var e=this;return a.asyncToGenerator(t(s).mark((function r(){return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e._resolver){t.next=2;break}return t.abrupt("return",(e._resolver=(0,o.createResolver)(),Promise.resolve()));case 2:return t.next=4,e._resolver.promise;case 4:return t.next=6,e.acquire();case 6:case"end":return t.stop()}}),r)})))()}},{key:"release",value:function(){var e=this._resolver;this._resolver=null,e.resolve()}}]),e}();function u(e,t,r){return c.apply(this,arguments)}function c(){return c=a.asyncToGenerator(t(s).mark((function e(r,i,n){return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.acquire();case 3:return e.next=5,i(n);case 5:r.release(),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),r.release(),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),c.apply(this,arguments)}})),r.register("aZQjs",(function(i,n){e(i.exports,"createMatcher",(function(){return y}));var a=r("8TSCy"),s=r("2TvXO"),o=r("kyj08"),l=r("jHOLN"),u=r("crS0R"),c=r("3nnTb"),h=r("kNgwU"),f=r("2rjRQ"),p=l.default.getLogger("esri/views/2d/engine/webgl/util/Matcher");function y(e,t,r,i){return d.apply(this,arguments)}function d(){return(d=a.asyncToGenerator(t(s).mark((function e(r,i,n,a){return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r.type,e.next="simple"===e.t0?3:"map"===e.t0?4:"interval"===e.t0?5:"dictionary"===e.t0?6:"subtype"===e.t0?7:8;break;case 3:return e.abrupt("return",v.fromBasicRenderer(r,i,n,a));case 4:return e.abrupt("return",g.fromUVRenderer(r,i,n,a));case 5:return e.abrupt("return",x.fromCBRenderer(r,i,n,a));case 6:return e.abrupt("return",T.fromDictionaryRenderer(r,i,n,a));case 7:return e.abrupt("return",m.fromSubtypes(r,i,n,a));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _,v=function(){"use strict";function e(){a.classCallCheck(this,e),this.type="feature",this._defaultResult=null}return a.createClass(e,[{key:"size",value:function(){return 1}},{key:"getDefault",value:function(){return this._defaultResult}},{key:"setDefault",value:function(e){this._defaultResult=e}},{key:"match",value:function(e,t,r,i,n){return this.getDefault()}},{key:"analyze",value:function(e,r,i,n,o,l){return a.asyncToGenerator(t(s).mark((function e(){return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})))()}}],[{key:"fromBasicRenderer",value:function(r,i,n,o){return a.asyncToGenerator(t(s).mark((function a(){var l,u,c;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l=new e,!r.symbol){t.next=7;break}return t.next=4,(0,f.expandSymbol)(r.symbol,n,o);case 4:u=t.sent,c=i.createTemplateGroup(u,null),l.setDefault(c);case 7:return t.abrupt("return",l);case 8:case"end":return t.stop()}}),a)})))()}}]),e}(),m=function(e){"use strict";a.inherits(i,e);var r=a.createSuper(i);function i(e,t){var n;return a.classCallCheck(this,i),(n=r.call(this))._subMatchers=e,n._subtypeField=t,a.possibleConstructorReturn(n)}return a.createClass(i,[{key:"match",value:function(e,t,r,i,n){var a=t.readAttribute(this._subtypeField),s=this._subMatchers.get(a);return s?s.match(e,t,r,i,n):null}}],[{key:"fromSubtypes",value:function(e,r,n,o){return a.asyncToGenerator(t(s).mark((function a(){var l,u,c,h,f;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(c in l=new Map,u=[],e.renderers)a=c,h=parseInt(a,10),f=y(e.renderers[a],r,n,o).then((function(e){return l.set(h,e)})),u.push(f);return t.next=4,Promise.all(u);case 4:return t.abrupt("return",(t.sent,new i(l,e.subtypeField)));case 5:case"end":return t.stop()}var a}),a)})))()}}]),i}(v),x=function(e){"use strict";a.inherits(i,e);var r=a.createSuper(i);function i(e,t,n,s){var o;return a.classCallCheck(this,i),(o=r.call(this)).type="interval",o._intervals=[],o._isMaxInclusive=t,o._fieldIndex=s,o._field=e,o._normalizationInfo=n,a.possibleConstructorReturn(o)}return a.createClass(i,[{key:"add",value:function(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort((function(e,t){return e.interval.min-t.interval.min}))}},{key:"size",value:function(){return a.get(a.getPrototypeOf(i.prototype),"size",this).call(this)+this._intervals.length}},{key:"match",value:function(e,t,r,i,n){if(null==this._fieldIndex&&!this._field)return this.getDefault();var a=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(!a&&(null==a||isNaN(a)))return this.getDefault();for(var s=0;s<this._intervals.length;s++){var o=this._intervals[s],l=o.interval,u=o.result,c=a>=l.min,h=this._isMaxInclusive?a<=l.max:a<l.max;if(c&&h)return u}return this.getDefault()}},{key:"_needsNormalization",value:function(){var e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)}},{key:"_getValueFromField",value:function(e){var t=e.readAttribute(this._field);if(!this._needsNormalization()||null==t)return t;var r=this._normalizationInfo,i=r.normalizationField,n=r.normalizationTotal,a=r.normalizationType,s=!!i&&e.readAttribute(i);if(a)switch(a){case"esriNormalizeByField":return s?t/s:void 0;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return t/n*100;default:return void p.error("Found unknown normalization type: ".concat(a))}else p.error("Normalization is required, but no type was set!")}}],[{key:"fromCBRenderer",value:function(e,r,n,o){return a.asyncToGenerator(t(s).mark((function l(){var u,c,h,p,y,d,_,v,m;return t(s).wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return u=e.isMaxInclusive,c=e.normalizationField,h=e.normalizationTotal,p=e.normalizationType,y=e.field,d=new i(y,u,{normalizationField:c,normalizationTotal:h,normalizationType:p},e.fieldIndex),l.next=8,(0,f.expandSymbol)(e.backgroundFillSymbol,n,o);case 8:return _=l.sent,l.next=11,Promise.all(e.intervals.map(function(){var e=a.asyncToGenerator(t(s).mark((function e(i){var a,l,u;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.expandSymbol)(i.symbol,n,o);case 2:return a=e.sent,e.next=5,r.createTemplateGroup(a,_);case 5:l=e.sent,u={min:i.min,max:i.max},d.add(u,l);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return l.next=13,(0,f.expandSymbol)(e.defaultSymbol,n,o);case 13:if(!(v=l.sent)){l.next=19;break}return l.next=17,r.createTemplateGroup(v,_);case 17:m=l.sent,d.setDefault(m);case 19:return l.abrupt("return",d);case 20:case"end":return l.stop()}}),l)})))()}}]),i}(v),g=function(e){"use strict";a.inherits(i,e);var r=a.createSuper(i);function i(e,t,n){var s;return a.classCallCheck(this,i),(s=r.call(this)).type="map",s._nullResult=null,s._resultsMap=new Map,s._fieldsIndex=n,s._fields=e,s._seperator=t||"",a.possibleConstructorReturn(s)}return a.createClass(i,[{key:"setNullResult",value:function(e){this._nullResult=e}},{key:"add",value:function(e,t){this._resultsMap.set(e.toString(),t)}},{key:"size",value:function(){return a.get(a.getPrototypeOf(i.prototype),"size",this).call(this)+this._resultsMap.size}},{key:"match",value:function(e,t,r,i,n){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();var a=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==a||""===a||"<Null>"===a))return this._nullResult;if(!a&&null==a)return this.getDefault();var s=a.toString();return this._resultsMap.has(s)?this._resultsMap.get(s):this.getDefault()}},{key:"_getValueFromFields",value:function(e){var t=[],r=!0,i=!1,n=void 0;try{for(var a,s=this._fields[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value,l=e.readAttribute(o);null==l||""===l?t.push("<Null>"):t.push(l)}}catch(e){i=!0,n=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw n}}return t.join(this._seperator)}}],[{key:"fromUVRenderer",value:function(e,r,n,o){return a.asyncToGenerator(t(s).mark((function l(){var u,c,h,p,y,d;return t(s).wrap((function(l){for(;;)switch(l.prev=l.next){case 0:return u=e.fieldDelimiter,c=[e.field],e.field2&&c.push(e.field2),e.field3&&c.push(e.field3),l.next=4,(0,f.expandSymbol)(e.backgroundFillSymbol,n,o);case 4:return h=l.sent,p=new i(c,u,e.fieldIndex),l.next=8,Promise.all(e.map.map(function(){var e=a.asyncToGenerator(t(s).mark((function e(i){var a,l;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.expandSymbol)(i.symbol,n,o);case 2:return a=e.sent,e.next=5,r.createTemplateGroup(a,h);case 5:l=e.sent,"<Null>"===i.value?p.setNullResult(l):p.add(i.value,l);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return l.next=10,(0,f.expandSymbol)(e.defaultSymbol,n,o);case 10:if(!(y=l.sent)){l.next=16;break}return l.next=14,r.createTemplateGroup(y,h);case 14:d=l.sent,p.setDefault(d);case 16:return l.abrupt("return",p);case 17:case"end":return l.stop()}}),l)})))()}}]),i}(v);function M(e,t){return b.apply(this,arguments)}function b(){return(b=a.asyncToGenerator(t(s).mark((function e(r,i){var n,a;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("number"!=typeof(n=r||1)){e.next=3;break}return e.abrupt("return",(function(e,t,r){return n}));case 3:return e.next=5,(0,c.createRendererExpression)(n,i.spatialReference,i.fields);case 5:return a=e.sent,e.abrupt("return",(function(e,t,r){return(0,h.default)(a,e,{$view:r},i.geometryType,t)||1}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(){return S.apply(this,arguments)}function S(){return(S=a.asyncToGenerator(t(s).mark((function e(){return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(_||(_=r("1Z9jx")),_));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var T=function(e){"use strict";a.inherits(n,e);var i=a.createSuper(n);function n(e,t,r,s,o,l){var c;return a.classCallCheck(this,n),(c=i.call(this)).type="dictionary",c._groupIdCache=new(0,u.default)(100),c._loader=e,c._fieldMap=e.fieldMap,c._symbolFields=e.getSymbolFields(),c._templates=t,c._info=r,c._scaleFn=s,c._schemaUtilsModule=o,c._symbolOptions=l,a.possibleConstructorReturn(c)}return a.createClass(n,[{key:"_analyzeFeature",value:function(e,r,i,n,l){var u=this;return a.asyncToGenerator(t(s).mark((function c(){var h,y,d,_,v,m,x,g;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(h=e.readLegacyFeature(),y=u._scaleFn(h,i,n),d=u._attributeHash(h)+"-"+y,!(_=u._groupIdCache.get(d))){t.next=3;break}return t.abrupt("return",_);case 3:return v=a.objectSpread({},n,{spatialReference:u._info.spatialReference,abortOptions:l,fields:u._info.fields}),t.next=6,u._loader.getSymbolAsync(h,v);case 6:return m=t.sent,x=u._schemaUtilsModule.createSymbolSchema(m,u._symbolOptions),g=(0,f.expandSymbol)(x,u._info,r,l).then((function(e){if("expanded-cim"!==e.type)return p.error(new(0,o.default)("mapview-bad-type","Found unexpected type ".concat(e.type," in dictionary response"))),null;e.hash+="-"+y;var t=!0,r=!1,i=void 0;try{for(var n,a=e.layers[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var s=n.value;s.scaleFactor=y,s.templateHash+="-"+y}}catch(e){r=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw i}}return u._templates.createTemplateGroup(e,null)})),t.abrupt("return",(u._groupIdCache.put(d,g,1),g));case 10:case"end":return t.stop()}}),c)})))()}},{key:"analyze",value:function(e,r,i,n,o,l){var u=this;return a.asyncToGenerator(t(s).mark((function e(){var a,c;return t(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=r.getCursor(),c=[];a.next();)c.push(u._analyzeFeature(a,i,n,o,l));return e.abrupt("return",Promise.all(c));case 3:case"end":return e.stop()}}),e)})))()}},{key:"match",value:function(e,t,r,i,n){return null}},{key:"_attributeHash",value:function(e){var t="",r=!0,i=!1,n=void 0;try{for(var a,s=this._symbolFields[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value,l=this._fieldMap[o];l&&(t+=e.attributes[l]+"-")}}catch(e){i=!0,n=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw n}}return t}}],[{key:"fromDictionaryRenderer",value:function(e,i,o,l){return a.asyncToGenerator(t(s).mark((function l(){var u,c,h,f,p,y;return t(s).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=a,t.next=3,Promise.all([r("ivXRL"),k()]);case 3:return t.t1=t.sent,u=t.t0.slicedToArray.call(t.t0,t.t1,2),c=u[0],h=c.DictionaryLoader,f=u[1],p=new h(e.url,e.config,e.fieldMap),t.next=11,p.fetchResources({spatialReference:o.spatialReference,fields:o.fields});case 11:return t.next=13,M(e.scaleExpression,o);case 13:return y=t.sent,t.abrupt("return",new n(p,i,o,y,f,e.symbolOptions));case 15:case"end":return t.stop()}}),l)})))()}}]),n}(v)})),r.register("1Z9jx",(function(e,t){e.exports=r("4WKyX")(r("aNJCr").getBundleURL("gPWYb")+r("iE7OH").resolve("29UfA")).then((function(){return r("90RBb")}))})),r.register("4WKyX",(function(e,t){"use strict";var i=r("2prpb");e.exports=i((function(e){return new Promise((function(t,r){var i=document.getElementsByTagName("script");if([].concat(i).some((function(t){return t.src===e})))t();else{var n=document.createElement("link");n.href=e,n.rel="preload",n.as="script",document.head.appendChild(n);var a=document.createElement("script");a.async=!0,a.type="text/javascript",a.charset="utf-8",a.src=e,a.onerror=function(t){var i=new TypeError("Failed to fetch dynamically imported module: ".concat(e,". Error: ").concat(t.message));a.onerror=a.onload=null,a.remove(),r(i)},a.onload=function(){a.onerror=a.onload=null,t()},document.getElementsByTagName("head")[0].appendChild(a)}}))}))})),r.register("2prpb",(function(e,t){"use strict";var r={},i={},n={};function a(e){switch(e){case"preload":return i;case"prefetch":return n;default:return r}}e.exports=function(e,t){return function(r){var i=a(t);return i[r]?i[r]:i[r]=e.apply(null,arguments).catch((function(e){throw delete i[r],e}))}}})),r.register("aNJCr",(function(t,r){var i;e(t.exports,"getBundleURL",(function(){return i}),(function(e){return i=e}));var n={};function a(e){return(""+e).replace(/^((?:https?|file|ftp|(chrome|moz)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}i=function(e){var t=n[e];return t||(t=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp|(chrome|moz)-extension):\/\/[^)\n]+/g);if(e)return a(e[2])}return"/"}(),n[e]=t),t}})),r.register("iE7OH",(function(t,r){var i,n;e(t.exports,"register",(function(){return i}),(function(e){return i=e})),e(t.exports,"resolve",(function(){return n}),(function(e){return n=e}));var a={};i=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)a[t[r]]=e[t[r]]},n=function(e){var t=a[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),r.register("ivXRL",(function(e,t){e.exports=r("4WKyX")(r("aNJCr").getBundleURL("gPWYb")+r("iE7OH").resolve("8Epn2")).then((function(){return r("dyiP8")}))}))}();
//# sourceMappingURL=SymbolProcessor.121cad3d.js.map
