!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("bmS2f",(function(i,a){t(i.exports,"default",(function(){return m}));var n=r("8TSCy"),s=r("2TvXO"),o=r("7eJjO"),l=r("bsvXr"),u=r("6dXDO"),c=r("lKPaD"),d=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var h=r("fcwIv"),f=r("k8DEI"),p=r("2lvFe"),y=r("7nh2K"),v=r("b0IdD"),g=function(t){"use strict";n.inherits(i,t);var r=n.createSuper(i);function i(){var t;n.classCallCheck(this,i);var a=n.assertThisInitialized(t);return(t=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._loadImagery=function(e,r,i,a,n){return(0,f.loadImagery)(t.layer,e,r,i,a,n)},t._createStreamlinesMesh=function(e,r,i){return t.layer.createStreamlinesMesh({flowData:r,rendererSettings:e},{signal:i})},t.attached=!1,t.container=null,t.layer=null,t.type="flow",t.timeExtent=null,t.redrawOrRefetch=n.asyncToGenerator(e(s).mark((function t(){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a._updateVisualization();case 1:case"end":return e.stop()}}),t)}))),n.possibleConstructorReturn(t)}return n.createClass(i,[{key:"updating",get:function(){return!this._strategy||this._strategy.updating}},{key:"attach",value:function(){var e=this,t=this.layer,r=function(){e._loadImagery=function(e,r,i,a,n){return(0,f.loadImagery)(t,e,r,i,a,n)},e._updateVisualization()};"multidimensionalDefinition"in t?this.handles.add((0,c.watch)((function(){return t.multidimensionalDefinition}),r)):this.handles.add([(0,c.watch)((function(){return t.mosaicRule}),r),(0,c.watch)((function(){return t.renderingRule}),r),(0,c.watch)((function(){return t.definitionExpression}),r)]),this.container=new(0,p.default),this._strategy=new(0,y.default)({flowContainer:this.container}),this._updateVisualization()}},{key:"detach",value:function(){this._strategy.destroy(),this.container.removeAllChildren(),this.container=null,this.handles.removeAll()}},{key:"update",value:function(e){e.stationary?this._strategy.update(e):this.layerView.requestUpdate()}},{key:"hitTest",value:function(e){return new(0,l.default)({attributes:{},geometry:e.clone(),layer:this.layer})}},{key:"moveEnd",value:function(){}},{key:"doRefresh",value:function(){return n.asyncToGenerator(e(s).mark((function t(){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),t)})))()}},{key:"_updateVisualization",value:function(){if("flow"===this.layer.renderer.type){var e=new(0,v.default)(this._loadImagery,this._createStreamlinesMesh,this.layer.renderer,this.timeExtent);this.container.flowStyle=e,this.layerView.requestUpdate()}}}]),i}(u.HandleOwner);(0,o._)([(0,d.property)()],g.prototype,"_strategy",void 0),(0,o._)([(0,d.property)()],g.prototype,"attached",void 0),(0,o._)([(0,d.property)()],g.prototype,"container",void 0),(0,o._)([(0,d.property)()],g.prototype,"layer",void 0),(0,o._)([(0,d.property)()],g.prototype,"layerView",void 0),(0,o._)([(0,d.property)()],g.prototype,"type",void 0),(0,o._)([(0,d.property)()],g.prototype,"updating",null),(0,o._)([(0,d.property)()],g.prototype,"timeExtent",void 0);var m=g=(0,o._)([(0,h.subclass)("esri.views.2d.engine.flow.FlowView2D")],g)})),r.register("2lvFe",(function(e,i){t(e.exports,"default",(function(){return o}));var a=r("8TSCy"),n=r("8CQO9"),s=r("66IJZ"),o=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){var e;return a.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))).flowStyle=null,a.possibleConstructorReturn(e)}return a.createClass(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"doRender",value:function(e){a.get(a.getPrototypeOf(r.prototype),"doRender",this).call(this,e)}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"flow",brushes:[n.default],target:function(){return t.children},drawPhase:s.WGLDrawPhase.MAP});return a.toConsumableArray(a.get(a.getPrototypeOf(r.prototype),"prepareRenderPasses",this).call(this,e)).concat([i])}}]),r}(r("3FBIK").default)})),r.register("7nh2K",(function(e,i){t(e.exports,"default",(function(){return _}));var a=r("8TSCy"),n=r("7eJjO");r("2ILM8");var s=r("jymfC"),o=r("jHOLN"),l=r("iVfa0"),u=r("7qybv"),c=r("10vEZ"),d=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var h=r("fcwIv"),f=r("d1Fqh"),p=r("fIstg"),y=r("lJ9eF"),v=r("gINRd"),g=o.default.getLogger("esri.views.2d.engine.flow.FlowStrategy"),m=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(e){var i;return a.classCallCheck(this,r),(i=t.call(this,e))._flowDisplayObject=new(0,y.FlowDisplayObject),i._loading=null,a.possibleConstructorReturn(i)}return a.createClass(r,[{key:"initialize",value:function(){this.flowContainer.addChild(this._flowDisplayObject)}},{key:"destroy",value:function(){this._clear(),this.flowContainer.removeAllChildren()}},{key:"updating",get:function(){return null!=this._loading}},{key:"update",value:function(e){var t=this,r=this.flowContainer.flowStyle;if((0,u.isNone)(r))this._clear();else{var i=e.state,a=i.extent,n=i.rotation,s=i.resolution,o=i.pixelRatio,d=function(e,t){var r=new(0,f.default)({x:(e.xmax+e.xmin)/2,y:(e.ymax+e.ymin)/2,spatialReference:e.spatialReference}),i=e.xmax-e.xmin,a=e.ymax-e.ymin,n=Math.abs(Math.cos((0,l.deg2rad)(t))),s=Math.abs(Math.sin((0,l.deg2rad)(t))),o=n*i+s*a,u=s*i+n*a,c=new(0,v.default)({xmin:r.x-o/2,ymin:r.y-u/2,xmax:r.x+o/2,ymax:r.y+u/2,spatialReference:e.spatialReference});return c.centerAt(r),c}(a,n);d.expand(1.15);var h=[Math.round((d.xmax-d.xmin)/s),Math.round((d.ymax-d.ymin)/s)],y=new(0,p.default)(r,d,h,o);if((0,u.isSome)(this._loading)){if(this._loading.update(y))return;this._loading.destroy(),this._loading=null}!(0,u.isNone)(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(y)||(y.load().then((function(){t._flowDisplayObject.clear(),t._flowDisplayObject.displayData=t._loading,t._loading=null}),(function(e){(0,c.isAbortError)(e)||(g.error("A resource failed to load.",e),t._loading=null)})),this._loading=y)}}},{key:"_clear",value:function(){this._flowDisplayObject.clear(),(0,u.isSome)(this._loading)&&(this._loading.destroy(),this._loading=null)}}]),r}(s.default);(0,n._)([(0,d.property)()],m.prototype,"_loading",void 0),(0,n._)([(0,d.property)()],m.prototype,"flowContainer",void 0),(0,n._)([(0,d.property)()],m.prototype,"updating",null);var _=m=(0,n._)([(0,h.subclass)("esri.views.2d.engine.flow.FlowStrategy")],m)})),r.register("fIstg",(function(i,a){t(i.exports,"default",(function(){return l}));var n=r("8TSCy"),s=r("2TvXO"),o=r("jHOLN").default.getLogger("esri.views.2d.engine.flow.FlowDisplayData"),l=function(){"use strict";function t(e,r,i,a){n.classCallCheck(this,t),this.state={name:"created"},this.flowStyle=e,this.extent=r,this.size=i,this.pixelRatio=a}return n.createClass(t,[{key:"load",value:function(){var t=this;return n.asyncToGenerator(e(s).mark((function r(){var i,a;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new AbortController,t.state={name:"loading",abortController:i},e.next=4,t.flowStyle.loadResources({extent:t.extent,size:t.size,pixelRatio:t.pixelRatio},i.signal);case 4:a=e.sent,t.state={name:"loaded",resources:a};case 6:case"end":return e.stop()}}),r)})))()}},{key:"prepareForRendering",value:function(e){if("loaded"===this.state.name){var t=this.state.resources;t.prepareForRendering(e),this.state={name:"attached",resources:t}}else o.error("Only loaded resources can be attached.")}},{key:"destroy",value:function(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}},{key:"update",value:function(e){return!!this.flowStyle.areResourcesCompatible(e.flowStyle)&&!(!this.extent.equals(e.extent)||this.size[0]!==e.size[0]||this.size[1]!==e.size[1]||this.pixelRatio!==e.pixelRatio||(this.flowStyle=e.flowStyle,0))}}]),t}()})),r.register("lJ9eF",(function(e,i){t(e.exports,"FlowDisplayObject",(function(){return u}));var a=r("8TSCy"),n=r("iVfa0"),s=r("7qybv"),o=r("j3x2p"),l=r("eYrMi"),u=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){var e;return a.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))))._displayData=null,a.possibleConstructorReturn(e)}return a.createClass(r,[{key:"displayData",get:function(){return this._displayData},set:function(e){this._displayData=e,this.requestRender()}},{key:"clear",value:function(){(0,s.isSome)(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())}},{key:"setTransform",value:function(e){var t=this.displayData;if(!(0,s.isNone)(t)){var r=t.extent.xmin,i=t.extent.ymax,a=[0,0];e.toScreen(a,[r,i]);var l=(t.extent.xmax-t.extent.xmin)/t.size[0]/e.resolution,u=(0,n.deg2rad)(e.rotation),c=this.transforms.dvs;(0,o.l)(c,[-1,1,0]),(0,o.d)(c,c,[2/(e.size[0]*e.pixelRatio),-2/(e.size[1]*e.pixelRatio),1]),(0,o.c)(c,c,[a[0],a[1],0]),(0,o.r)(c,c,u),(0,o.d)(c,c,[l*e.pixelRatio,l*e.pixelRatio,1])}}},{key:"_createTransforms",value:function(){return{dvs:(0,l.c)()}}}]),r}(r("2qlsz").DisplayObject)})),r.register("b0IdD",(function(i,a){t(i.exports,"default",(function(){return d}));var n=r("8TSCy"),s=r("2TvXO"),o=r("7qybv"),l=r("10vEZ"),u=r("hzTjs"),c=r("jcKoJ"),d=function(){"use strict";function t(e,r,i,a){n.classCallCheck(this,t),this._loadImagery=e,this._createStreamlinesMesh=r,this._timeExtent=a,this._rendererSettings=(0,c.createFlowRendererSettings)(i)}return n.createClass(t,[{key:"animated",get:function(){return this._rendererSettings.lineSpeed>0}},{key:"renderSettings",get:function(){return this._rendererSettings}},{key:"areResourcesCompatible",value:function(e){var t=!0;return(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=t&&e._loadImagery===this._loadImagery)&&e._createStreamlinesMesh===this._createStreamlinesMesh)&&e._rendererSettings.verticesPerLine===this._rendererSettings.verticesPerLine)&&e._rendererSettings.segmentLength===this._rendererSettings.segmentLength)&&e._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing)&&e._rendererSettings.density===this._rendererSettings.density)&&e._rendererSettings.smoothing===this._rendererSettings.smoothing)&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale)&&e._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold)&&e._rendererSettings.minSpeedThreshold===this._rendererSettings.minSpeedThreshold)&&e._rendererSettings.mergeLines===this._rendererSettings.mergeLines)&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale)&&e._rendererSettings.interpolate===this._rendererSettings.interpolate)&&e._rendererSettings.lineColor.kind===this._rendererSettings.lineColor.kind)&&e._rendererSettings.lineOpacity.kind===this._rendererSettings.lineOpacity.kind)&&e._rendererSettings.lineRenderWidth.kind===this._rendererSettings.lineRenderWidth.kind)&&this._rendererSettings.mergeLines&&(t=e._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth),t&&e._timeExtent!==this._timeExtent&&(t=!(!(0,o.isSome)(e._timeExtent)||!(0,o.isSome)(this._timeExtent))&&e._timeExtent.equals(this._timeExtent)),t}},{key:"loadResources",value:function(t,r){var i=this;return n.asyncToGenerator(e(s).mark((function a(){var n,o,c,d,h,f;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.extent,o=t.size,(0,l.throwIfAborted)(r),e.next=4,i._loadImagery(n,o[0],o[1],i._timeExtent,r);case 4:return c=e.sent,e.next=7,i._createStreamlinesMesh(i._rendererSettings,c,r);case 7:return d=e.sent,h=d.vertexData,f=d.indexData,e.abrupt("return",new(0,u.default)(h,f,{lineColor:i._rendererSettings.lineColor,lineOpacity:i._rendererSettings.lineOpacity,lineRenderWidth:i._rendererSettings.lineRenderWidth}));case 11:case"end":return e.stop()}}),a)})))()}}]),t}()})),r.register("hzTjs",(function(e,i){t(e.exports,"default",(function(){return d}));var a=r("8TSCy"),n=r("iRJeW"),s=r("8JzMA"),o=r("4aQus"),l=r("LW1Aq"),u=new Map;u.set("a_positionAndSide",0),u.set("a_timeInfo",1),u.set("a_extrude",2),u.set("a_speed",3);var c={geometry:[new(0,l.VertexElementDescriptor)("a_positionAndSide",3,s.DataType.FLOAT,0,36),new(0,l.VertexElementDescriptor)("a_timeInfo",3,s.DataType.FLOAT,12,36),new(0,l.VertexElementDescriptor)("a_extrude",2,s.DataType.FLOAT,24,36),new(0,l.VertexElementDescriptor)("a_speed",1,s.DataType.FLOAT,32,36)]},d=function(){"use strict";function e(t,r,i){a.classCallCheck(this,e),this.values=i,this._vertexData=t,this._indexData=r}return a.createClass(e,[{key:"prepareForRendering",value:function(e){var t=n.BufferObject.createVertex(e,s.Usage.STATIC_DRAW,this._vertexData),r=n.BufferObject.createIndex(e,s.Usage.STATIC_DRAW,this._indexData),i=new(0,o.VertexArrayObject)(e,u,c,{geometry:t},r);this.vertexBuffer=t,this.indexBuffer=r,this.vertexArray=i,this._vertexData=null,this._indexData=null}},{key:"detach",value:function(){this.vertexArray.dispose(),this.vertexBuffer.dispose(),this.indexBuffer.dispose()}},{key:"locations",get:function(){return u}}]),e}()})),r.register("jcKoJ",(function(e,i){t(e.exports,"createFlowRendererSettings",(function(){return n}));var a=r("iXlXu");function n(e){var t,r=function(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[(0,a.pt2px)(e.trailWidth)]};var t,r=e.getVisualVariablesForType("size")[0],i=[],n=[];if(r.stops){var s=!0,o=!1,l=void 0;try{for(var u,c=r.stops[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var d=u.value;i.push(d.value),n.push(d.size)}}catch(e){o=!0,l=e}finally{try{s||null==c.return||c.return()}finally{if(o)throw l}}t=r.stops.length}else i.push(r.minDataValue,r.maxDataValue),n.push(r.minSize,r.maxSize),t=2;return{kind:"ramp",stops:i,values:n,count:t}}(e),i="constant"===(t=r).kind?t.value[0]:t.values[t.values.length-1],n=2*i;return{lineRenderWidth:r,segmentLength:n,verticesPerLine:Math.round((0,a.pt2px)(e.maxPathLength)/n)+1,lineCollisionWidth:i,lineSpacing:10,lineColor:function(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:s(e.color)};var t=e.getVisualVariablesForType("color")[0],r=[],i=[],a=!0,n=!1,o=void 0;try{for(var l,u=t.stops[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var c=l.value;r.push(c.value),Array.prototype.push.apply(i,s(c.color))}}catch(e){n=!0,o=e}finally{try{a||null==u.return||u.return()}finally{if(n)throw o}}return{kind:"ramp",stops:r,values:i,count:t.stops.length}}(e),lineOpacity:function(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};var t=e.getVisualVariablesForType("opacity")[0],r=[],i=[],a=!0,n=!1,s=void 0;try{for(var o,l=t.stops[Symbol.iterator]();!(a=(o=l.next()).done);a=!0){var u=o.value;r.push(u.value),i.push(u.opacity)}}catch(e){n=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(n)throw s}}return{kind:"ramp",stops:r,values:i,count:t.stops.length}}(e),lineSpeed:e.flowSpeed,fadeDuration:e.trailLength,density:e.density,smoothing:(0,a.pt2px)(e.smoothing),velocityScale:"flow-from"===e.flowRepresentation?1:-1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}}function s(e){var t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}})),r.register("9q7kD",(function(e,i){t(e.exports,"RasterVFDisplayObject",(function(){return y}));var a=r("8TSCy");r("2VlWd");var n=r("7qybv"),s=r("j3x2p"),o=r("eYrMi"),l=r("0P8XU"),u=r("2hwKJ"),c=r("2qlsz"),d=r("5WctK"),h=r("iRJeW"),f=r("8JzMA"),p=r("4aQus"),y=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return a.classCallCheck(this,r),(e=t.call(this))._source=null,e._symbolizerParameters=null,e._vaoInvalidated=!0,e.coordScale=[1,1],e.height=null,e.stencilRef=0,e.resolution=null,e.pixelRatio=1,e.x=0,e.y=0,e.rotation=0,e.rawPixelData=null,e.width=null,e.source=i,a.possibleConstructorReturn(e)}return a.createClass(r,[{key:"destroy",value:function(){var e,t;(0,n.isSome)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this.invalidateVAO()}},{key:"invalidateVAO",value:function(){var e,t;!this._vaoInvalidated&&(0,n.isSome)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}},{key:"updateVectorFieldVAO",value:function(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,n.isSome)(this.source)&&!(0,n.isSome)(this.vaoData))switch(this.symbolizerParameters.style){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":var t=(0,u.createVFMesh)(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:r};break;case"simple_scalar":var i=(0,u.createVFMeshScalar)(this.source,this.symbolizerParameters),a=this._createVectorFieldVAO(e.context,i);this.vaoData={scalar:a};break;case"wind_speed":var s=(0,u.createVFMesh)(this.source,this.symbolizerParameters),o=this._createVectorFieldVAO(e.context,s),l=(0,u.createVFMeshScalar)(this.source,this.symbolizerParameters),c=this._createVectorFieldVAO(e.context,l);this.vaoData={magdir:o,scalar:c}}this.ready(),this.requestRender()}}},{key:"_createTransforms",value:function(){return{dvs:(0,o.c)()}}},{key:"setTransform",value:function(e){var t=(0,s.b)(this.transforms.dvs),r=a.slicedToArray(e.toScreenNoRotation([0,0],[this.x,this.y]),2),i=r[0],n=r[1],o=this.resolution/this.pixelRatio/e.resolution,u=o*this.width,c=o*this.height,d=Math.PI*this.rotation/180;(0,s.c)(t,t,(0,l.f)(i,n)),(0,s.c)(t,t,(0,l.f)(u/2,c/2)),(0,s.r)(t,t,-d),(0,s.c)(t,t,(0,l.f)(-u/2,-c/2)),(0,s.j)(t,t,(0,l.f)(u,c)),(0,s.m)(this.transforms.dvs,e.displayViewMat3,t)}},{key:"onAttach",value:function(){this.invalidateVAO()}},{key:"onDetach",value:function(){this.invalidateVAO()}},{key:"_createVectorFieldVAO",value:function(e,t){var r=t.vertexData,i=t.indexData,a=h.BufferObject.createVertex(e,f.Usage.STATIC_DRAW,new Float32Array(r)),n=h.BufferObject.createIndex(e,f.Usage.STATIC_DRAW,new Uint32Array(i)),s=(0,d.createProgramDescriptor)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:f.DataType.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:f.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:f.DataType.FLOAT,normalized:!1}]});return{vao:new(0,p.VertexArrayObject)(e,s.attributes,s.bufferLayouts,{geometry:a},n),elementCount:i.length}}}]),r}(c.DisplayObject)}))}();
//# sourceMappingURL=ImageryLayerView2D.2f688a20.js.map
