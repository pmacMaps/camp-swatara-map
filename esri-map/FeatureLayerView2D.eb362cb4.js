!function(){function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("34Eys",(function(t,n){e(t.exports,"default",(function(){return l}));var a=r("8TSCy"),i=r("7eJjO"),o=r("bsvXr"),u=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var s=r("fcwIv"),c=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(){var e;return a.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))).isAggregate=!0,a.possibleConstructorReturn(e)}return a.createClass(r,[{key:"getEffectivePopupTemplate",value:function(){if(this.popupTemplate)return this.popupTemplate;var e=this.sourceLayer&&this.sourceLayer.featureReduction;return e&&"popupTemplate"in e&&e.popupEnabled?e.popupTemplate:null}},{key:"getObjectId",value:function(){return this.objectId}}]),r}(o.default);(0,i._)([(0,u.property)({type:Boolean})],c.prototype,"isAggregate",void 0),(0,i._)([(0,u.property)({type:Number,json:{read:!0}})],c.prototype,"objectId",void 0);var l=c=(0,i._)([(0,s.subclass)("esri.AggregateGraphic")],c)})),r.register("9B1Fz",(function(t,n){e(t.exports,"default",(function(){return d}));var a=r("8TSCy"),i=r("7eJjO"),o=r("jymfC"),u=r("2VlWd"),s=r("7qybv"),c=r("iho5X");r("lNwWH"),r("iJAIC");var l=r("fcwIv"),f=r("a4nX6"),p=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(e){var n;return a.classCallCheck(this,r),(n=t.call(this,e))._filter=null,n.duration=(0,u.default)("mapview-transitions-duration"),n._excludedEffectView=new(0,f.EffectView)(e),n._includedEffectView=new(0,f.EffectView)(e),a.possibleConstructorReturn(n)}return a.createClass(r,[{key:"excludedEffects",get:function(){return this._excludedEffectView.effects}},{key:"featureEffect",set:function(e){this._get("featureEffect")!==e&&this._transitionTo(e)}},{key:"filter",get:function(){var e;return this._filter||(null==(e=(0,s.unwrap)(this.featureEffect))?void 0:e.filter)||null}},{key:"hasEffects",get:function(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}},{key:"includedEffects",get:function(){return this._includedEffectView.effects}},{key:"scale",set:function(e){this._set("scale",e),this._excludedEffectView.scale=e,this._includedEffectView.scale=e}},{key:"transitioning",get:function(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}},{key:"transitionStep",value:function(e,t){this._set("scale",t),this.transitioning?(this._includedEffectView.transitionStep(e,t),this._excludedEffectView.transitionStep(e,t),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=t,this._includedEffectView.scale=t)}},{key:"end",value:function(){this._includedEffectView.end(),this._excludedEffectView.end(),this._filter=null}},{key:"_transitionTo",value:function(e){var t=this._get("featureEffect"),r=(0,s.unwrap)(e),n=(0,s.unwrap)(null==r?void 0:r.includedEffect),a=(0,s.unwrap)(null==r?void 0:r.excludedEffect),i=this._includedEffectView.canTransitionTo(n)&&this._excludedEffectView.canTransitionTo(a);this._includedEffectView.effect=n,this._excludedEffectView.effect=a,this._set("featureEffect",r),this._filter=(null==r?void 0:r.filter)||(null==t?void 0:t.filter)||null,i||this.end()}}]),r}(o.default);(0,i._)([(0,c.property)()],p.prototype,"_filter",void 0),(0,i._)([(0,c.property)()],p.prototype,"_excludedEffectView",void 0),(0,i._)([(0,c.property)()],p.prototype,"_includedEffectView",void 0),(0,i._)([(0,c.property)()],p.prototype,"duration",void 0),(0,i._)([(0,c.property)()],p.prototype,"excludedEffects",null),(0,i._)([(0,c.property)()],p.prototype,"featureEffect",null),(0,i._)([(0,c.property)()],p.prototype,"filter",null),(0,i._)([(0,c.property)()],p.prototype,"hasEffects",null),(0,i._)([(0,c.property)()],p.prototype,"includedEffects",null),(0,i._)([(0,c.property)({value:0})],p.prototype,"scale",null),(0,i._)([(0,c.property)()],p.prototype,"transitioning",null);var d=p=(0,i._)([(0,l.subclass)("esri.layers.effects.FeatureEffectView")],p)})),r.register("rIUZZ",(function(n,a){e(n.exports,"createOrReuseTileRenderer",(function(){return u}));var i=r("8TSCy"),o=r("2TvXO");function u(e,t){return s.apply(this,arguments)}function s(){return(s=i.asyncToGenerator(t(o).mark((function e(n,a){return t(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",null);case 2:e.t0=n.type,e.next="class-breaks"===e.t0||"simple"===e.t0||"unique-value"===e.t0||"dot-density"===e.t0||"dictionary"===e.t0?5:"heatmap"===e.t0?10:15;break;case 5:return e.next=7,r("6nLcy");case 7:return e.t1=e.sent.default,e.t2=a,e.abrupt("return",new e.t1(e.t2));case 10:return e.next=12,r("djaI6");case 12:return e.t3=e.sent.default,e.t4=a,e.abrupt("return",new e.t3(e.t4));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}})),r.register("6nLcy",(function(e,t){e.exports=Promise.all([r("4WKyX")(r("aNJCr").getBundleURL("kRbDc")+r("iE7OH").resolve("jBpnf")),r("4WKyX")(r("aNJCr").getBundleURL("kRbDc")+r("iE7OH").resolve("19UW4")),r("4WKyX")(r("aNJCr").getBundleURL("kRbDc")+r("iE7OH").resolve("ghFVP")),r("4WKyX")(r("aNJCr").getBundleURL("kRbDc")+r("iE7OH").resolve("iE50C")),r("4WKyX")(r("aNJCr").getBundleURL("kRbDc")+r("iE7OH").resolve("9t5Hg")),r("4WKyX")(r("aNJCr").getBundleURL("kRbDc")+r("iE7OH").resolve("eA7fV"))]).then((function(){return r("3VaHl")}))})),r.register("4WKyX",(function(e,t){"use strict";var n=r("2prpb");e.exports=n((function(e){return new Promise((function(t,r){var n=document.getElementsByTagName("script");if([].concat(n).some((function(t){return t.src===e})))t();else{var a=document.createElement("link");a.href=e,a.rel="preload",a.as="script",document.head.appendChild(a);var i=document.createElement("script");i.async=!0,i.type="text/javascript",i.charset="utf-8",i.src=e,i.onerror=function(t){var n=new TypeError("Failed to fetch dynamically imported module: ".concat(e,". Error: ").concat(t.message));i.onerror=i.onload=null,i.remove(),r(n)},i.onload=function(){i.onerror=i.onload=null,t()},document.getElementsByTagName("head")[0].appendChild(i)}}))}))})),r.register("2prpb",(function(e,t){"use strict";var r={},n={},a={};function i(e){switch(e){case"preload":return n;case"prefetch":return a;default:return r}}e.exports=function(e,t){return function(r){var n=i(t);return n[r]?n[r]:n[r]=e.apply(null,arguments).catch((function(e){throw delete n[r],e}))}}})),r.register("aNJCr",(function(t,r){var n;e(t.exports,"getBundleURL",(function(){return n}),(function(e){return n=e}));var a={};function i(e){return(""+e).replace(/^((?:https?|file|ftp|(chrome|moz)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}n=function(e){var t=a[e];return t||(t=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp|(chrome|moz)-extension):\/\/[^)\n]+/g);if(e)return i(e[2])}return"/"}(),a[e]=t),t}})),r.register("iE7OH",(function(t,r){var n,a;e(t.exports,"register",(function(){return n}),(function(e){return n=e})),e(t.exports,"resolve",(function(){return a}),(function(e){return a=e}));var i={};n=function(e){for(var t=Object.keys(e),r=0;r<t.length;r++)i[t[r]]=e[t[r]]},a=function(e){var t=i[e];if(null==t)throw new Error("Could not resolve bundle with id "+e);return t}})),r.register("djaI6",(function(e,t){e.exports=Promise.all([r("4WKyX")(r("aNJCr").getBundleURL("kRbDc")+r("iE7OH").resolve("jBpnf")),r("4WKyX")(r("aNJCr").getBundleURL("kRbDc")+r("iE7OH").resolve("19UW4")),r("4WKyX")(r("aNJCr").getBundleURL("kRbDc")+r("iE7OH").resolve("ghFVP")),r("4WKyX")(r("aNJCr").getBundleURL("kRbDc")+r("iE7OH").resolve("iE50C")),r("4WKyX")(r("aNJCr").getBundleURL("kRbDc")+r("iE7OH").resolve("h6ouu"))]).then((function(){return r("cqbWu")}))})),r.register("bTKCC",(function(t,n){e(t.exports,"default",(function(){return v}));var a=r("8TSCy"),i=r("7eJjO"),o=r("jymfC"),u=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var s=r("fcwIv"),c=r("incs0");function l(e){return e.some((function(e){return e.globalId}))}function f(e){return e.filter((function(e){return!e.error})).map((function(e){var t;return null!=(t=e.objectId)?t:e.globalId}))}function p(e,t){var r=new Set(e),n=!0,a=!1,i=void 0;try{for(var o,u=t.values()[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;r.add(s)}}catch(e){a=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw i}}return r}function d(e,t){var r=new Set(e),n=!0,a=!1,i=void 0;try{for(var o,u=t.values()[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var s=o.value;r.delete(s)}}catch(e){a=!0,i=e}finally{try{n||null==u.return||u.return()}finally{if(a)throw i}}return r}var y=function(e){"use strict";a.inherits(r,e);var t=a.createSuper(r);function r(e){var n;return a.classCallCheck(this,r),(n=t.call(this,e))._hasGlobalIds=!1,a.possibleConstructorReturn(n)}return a.createClass(r,[{key:"normalizeCtorArgs",value:function(e){return this._queueProcessor=new(0,c.QueueProcessor)({concurrency:1,process:e.process}),{}}},{key:"destroy",value:function(){this.clear()}},{key:"updating",get:function(){return this._queueProcessor.length>0}},{key:"clear",value:function(){this._queueProcessor.clear()}},{key:"push",value:function(e){var t=this._queueProcessor,r=t.last();switch(e.type){case"update":case"refresh":var n=this;if((null==r?void 0:r.type)===e.type)return;t.push(e).finally((function(){return n.notifyChange("updating")}));break;case"edit":var a=this,i="processed-edit"===(null==r?void 0:r.type)?r:null;i&&t.popLast();var o=this._mergeEdits(i,e),u=!0,s=!1,c=void 0;try{for(var l,f=o[Symbol.iterator]();!(u=(l=f.next()).done);u=!0){var p=l.value;t.push(p).finally((function(){return a.notifyChange("updating")}))}}catch(e){s=!0,c=e}finally{try{u||null==f.return||f.return()}finally{if(s)throw c}}}this.notifyChange("updating")}},{key:"_mergeEdits",value:function(e,t){var r,n,i=t.edits,o=i.addedFeatures,u=i.deletedFeatures,s=i.updatedFeatures;if(this._hasGlobalIds=this._hasGlobalIds||l(o)||l(s)||l(u),this._hasGlobalIds)return[e,{type:"processed-edit",edits:{addOrModified:a.toConsumableArray(o).concat(a.toConsumableArray(s)),removed:u}}];var c=new Set(f(null!=(r=null==e?void 0:e.edits.addOrModified)?r:[])),y=new Set(f(null!=(n=null==e?void 0:e.edits.removed)?n:[])),v=new Set(a.toConsumableArray(f(o)).concat(a.toConsumableArray(f(s)))),h=new Set(f(u));return[{type:"processed-edit",edits:{addOrModified:Array.from(p(d(c,h),v)).map((function(e){return{objectId:e}})),removed:Array.from(p(d(y,v),h)).map((function(e){return{objectId:e}}))}}]}}]),r}(o.default);(0,i._)([(0,u.property)({readOnly:!0})],y.prototype,"updating",null);var v=y=(0,i._)([(0,s.subclass)("esri.views.2d.layers.support.FeatureCommandQueue")],y)})),r.register("iDjnF",(function(n,a){e(n.exports,"default",(function(){return y}));var i=r("8TSCy"),o=r("2TvXO"),u=r("7eJjO"),s=r("hmHbS"),c=r("10vEZ"),l=r("gdXB3"),f=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var p=r("fcwIv");var d=function(e){"use strict";i.inherits(n,e);var r=i.createSuper(n);function n(e){var t;return i.classCallCheck(this,n),(t=r.call(this,e))._startupResolver=(0,c.createResolver)(),t.isReady=!1,i.possibleConstructorReturn(t)}return i.createClass(n,[{key:"initialize",value:function(){this._controller=new AbortController,this.addResolvingPromise(this._startWorker(this._controller.signal))}},{key:"destroy",value:function(){this._controller.abort(),this._connection&&this._connection.close()}},{key:"tileRenderer",set:function(e){this.client.tileRenderer=e}},{key:"closed",get:function(){return this._connection.closed}},{key:"startup",value:function(e,r,n,a){var u=this;return i.asyncToGenerator(t(o).mark((function i(){var s,c,l;return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.when();case 2:return s=u._controller.signal,i=n.source,c=Array.isArray(i)?{transferList:n.source,signal:s}:void 0,l={service:n,config:r,tileInfo:e.tileInfo.toJSON(),tiles:a},t.next=5,u._connection.invoke("startup",l,c);case 5:u._startupResolver.resolve(),u._set("isReady",!0);case 7:case"end":return t.stop()}var i}),i)})))()}},{key:"updateTiles",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,(0,c.ignoreAbortErrors)(r._connection.invoke("updateTiles",e))));case 3:case"end":return t.stop()}}),n)})))()}},{key:"update",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){var a;return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={config:e},t.next=3,r._startupResolver.promise;case 3:return t.abrupt("return",(t.sent,r._connection.invoke("update",a)));case 4:case"end":return t.stop()}}),n)})))()}},{key:"applyUpdate",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,r._connection.invoke("applyUpdate",e)));case 3:case"end":return t.stop()}}),n)})))()}},{key:"setHighlight",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,(0,c.ignoreAbortErrors)(r._connection.invoke("controller.setHighlight",e))));case 3:case"end":return t.stop()}}),n)})))()}},{key:"stop",value:function(){var e=this;return i.asyncToGenerator(t(o).mark((function r(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._startupResolver.promise;case 2:if(t.sent,e.closed){t.next=4;break}return t.abrupt("return",(0,c.ignoreAbortErrors)(e._connection.invoke("stop")));case 4:case"end":return t.stop()}}),r)})))()}},{key:"refresh",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,(0,c.ignoreAbortErrors)(r._connection.invoke("controller.refresh",e))));case 3:case"end":return t.stop()}}),n)})))()}},{key:"querySummaryStatistics",value:function(e,r,n){var a=this;return i.asyncToGenerator(t(o).mark((function i(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,a._connection.invoke("controller.querySummaryStatistics",{query:e.toJSON(),params:r},n)));case 3:case"end":return t.stop()}}),i)})))()}},{key:"queryUniqueValues",value:function(e,r,n){var a=this;return i.asyncToGenerator(t(o).mark((function i(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,a._connection.invoke("controller.queryUniqueValues",{query:e.toJSON(),params:r},n)));case 3:case"end":return t.stop()}}),i)})))()}},{key:"queryClassBreaks",value:function(e,r,n){var a=this;return i.asyncToGenerator(t(o).mark((function i(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,a._connection.invoke("controller.queryClassBreaks",{query:e.toJSON(),params:r},n)));case 3:case"end":return t.stop()}}),i)})))()}},{key:"queryHistogram",value:function(e,r,n){var a=this;return i.asyncToGenerator(t(o).mark((function i(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,a._connection.invoke("controller.queryHistogram",{query:e.toJSON(),params:r},n)));case 3:case"end":return t.stop()}}),i)})))()}},{key:"queryFeatures",value:function(e,r){var n=this;return i.asyncToGenerator(t(o).mark((function a(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,n._connection.invoke("controller.queryFeatures",e.toJSON(),r)));case 3:case"end":return t.stop()}}),a)})))()}},{key:"queryVisibleFeatures",value:function(e,r){var n=this;return i.asyncToGenerator(t(o).mark((function a(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,n._connection.invoke("controller.queryVisibleFeatures",e.toJSON(),r)));case 3:case"end":return t.stop()}}),a)})))()}},{key:"queryObjectIds",value:function(e,r){var n=this;return i.asyncToGenerator(t(o).mark((function a(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,n._connection.invoke("controller.queryObjectIds",e.toJSON(),r)));case 3:case"end":return t.stop()}}),a)})))()}},{key:"queryFeatureCount",value:function(e,r){var n=this;return i.asyncToGenerator(t(o).mark((function a(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,n._connection.invoke("controller.queryFeatureCount",e.toJSON(),r)));case 3:case"end":return t.stop()}}),a)})))()}},{key:"queryExtent",value:function(e,r){var n=this;return i.asyncToGenerator(t(o).mark((function a(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",n._connection.invoke("controller.queryExtent",e.toJSON(),r));case 1:case"end":return t.stop()}}),a)})))()}},{key:"queryLatestObservations",value:function(e,r){var n=this;return i.asyncToGenerator(t(o).mark((function a(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,n._connection.invoke("controller.queryLatestObservations",e.toJSON(),r)));case 3:case"end":return t.stop()}}),a)})))()}},{key:"queryStatistics",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,r._connection.invoke("controller.queryStatistics",e)));case 3:case"end":return t.stop()}}),n)})))()}},{key:"getObjectId",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,r._connection.invoke("controller.getObjectId",e)));case 3:case"end":return t.stop()}}),n)})))()}},{key:"getDisplayId",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,r._connection.invoke("controller.getDisplayId",e)));case 3:case"end":return t.stop()}}),n)})))()}},{key:"getFeatures",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,r._connection.invoke("controller.getFeatures",e)));case 3:case"end":return t.stop()}}),n)})))()}},{key:"getAggregates",value:function(){var e=this;return i.asyncToGenerator(t(o).mark((function r(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,e._connection.invoke("controller.getAggregates")));case 3:case"end":return t.stop()}}),r)})))()}},{key:"getAggregateValueRanges",value:function(){var e=this;return i.asyncToGenerator(t(o).mark((function r(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,e._connection.invoke("controller.getAggregateValueRanges")));case 3:case"end":return t.stop()}}),r)})))()}},{key:"mapValidDisplayIds",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,r._connection.invoke("controller.mapValidDisplayIds",e)));case 3:case"end":return t.stop()}}),n)})))()}},{key:"onEdits",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,(0,c.ignoreAbortErrors)(r._connection.invoke("controller.onEdits",e))));case 3:case"end":return t.stop()}}),n)})))()}},{key:"enableEvent",value:function(e,r){var n=this;return i.asyncToGenerator(t(o).mark((function a(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n._startupResolver.promise;case 2:return t.abrupt("return",(t.sent,(0,c.ignoreAbortErrors)(n._connection.invoke("controller.enableEvent",{name:e,value:r}))));case 3:case"end":return t.stop()}}),a)})))()}},{key:"pauseStream",value:function(){return(0,c.ignoreAbortErrors)(this._connection.invoke("controller.pauseStream"))}},{key:"resumeStream",value:function(){return(0,c.ignoreAbortErrors)(this._connection.invoke("controller.resumeStream"))}},{key:"_startWorker",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,l.open)("Pipeline",{client:r.client,strategy:"dedicated",signal:e});case 3:r._connection=t.sent,t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),(0,c.throwIfNotAbortError)(t.t0);case 9:case"end":return t.stop()}}),n,null,[[0,6]])})))()}}]),n}(s.EsriPromise);(0,u._)([(0,f.property)()],d.prototype,"isReady",void 0),(0,u._)([(0,f.property)()],d.prototype,"client",void 0),(0,u._)([(0,f.property)()],d.prototype,"tileRenderer",null);var y=d=(0,u._)([(0,p.subclass)("esri.views.2d.layers.support.FeatureLayerProxy")],d)})),r.register("kvL9S",(function(t,n){e(t.exports,"TileManager",(function(){return s}));var a=r("8TSCy"),i=r("7qybv"),o=r("eoIYU"),u=r("i90gL"),s=function(){"use strict";function e(t){a.classCallCheck(this,e),this._tiles=new Map,this.buffer=0,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this.buffer=t.buffer}return a.createClass(e,[{key:"destroy",value:function(){}},{key:"clear",value:function(){var e=this;this._tiles.forEach((function(t){return e._releaseTile(t)}))}},{key:"tileKeys",value:function(){var e=[];return this._tiles.forEach((function(t,r){return e.push(r)})),e}},{key:"update",value:function(e){var t=this,r=this.tileInfoView.getTileCoverage(e.state,this.buffer,"closest"),n=r.spans,a=r.lodInfo,i=a.level,s=[],c=[],l=new Set,f=new Set,p=!0,d=!1,y=void 0;try{for(var v,h=n[Symbol.iterator]();!(p=(v=h.next()).done);p=!0)for(var m=v.value,k=m.row,g=m.colFrom,b=m.colTo,w=g;w<=b;w++){var _=u.default.getId(i,k,a.normalizeCol(w),a.getWorldForColumn(w)),x=this._getOrAcquireTile(s,_);l.add(_),x.isReady?x.visible=!0:f.add(x.key)}}catch(e){d=!0,y=e}finally{try{p||null==h.return||h.return()}finally{if(d)throw y}}return f.forEach((function(e){return t._addPlaceholders(l,e)})),this._tiles.forEach((function(e){l.has(e.key.id)||(c.push(e.key.id),t._releaseTile(e))})),o.default.pool.release(r),{hasMissingTiles:f.size>0,added:s,removed:c}}},{key:"_getOrAcquireTile",value:function(e,t){if(!this._tiles.has(t)){var r=this.acquireTile(new(0,u.default)(t));e.push(t),this._tiles.set(t,r),r.visible=!1}return this._tiles.get(t)}},{key:"_getTile",value:function(e){return this._tiles.get(e)}},{key:"_releaseTile",value:function(e){this._tiles.delete(e.key.id),this.releaseTile(e)}},{key:"_addPlaceholders",value:function(e,t){var r=this._addPlaceholderChildren(e,t);Math.abs(1-r)<1e-6||this._addPlaceholderParent(e,t)||(this._getTile(t.id).visible=!0)}},{key:"_addPlaceholderChildren",value:function(e,t){var r=this,n=0;return this._tiles.forEach((function(a){n+=r._addPlaceholderChild(e,a,t)})),n}},{key:"_addPlaceholderChild",value:function(e,t,r){return t.key.level<=r.level||!t.hasData||!r.contains(t.key)?0:(t.visible=!0,e.add(t.key.id),1/(1<<2*(t.key.level-r.level)))}},{key:"_addPlaceholderParent",value:function(e,t){for(var r=t.getParentKey(),n=0,a=null;(0,i.isSome)(r);){if(e.has(r.id))return!0;var o=this._getTile(r.id);if(null!=o&&o.isReady)return o.visible=!0,e.add(o.key.id),!0;null!=o&&o.hasData&&o.patchCount>n&&(n=o.patchCount,a=o),r=r.getParentKey()}return!!a&&(a.visible=!0,e.add(a.key.id),!0)}}]),e}()})),r.register("7HdkW",(function(n,a){e(n.exports,"FeatureLayerView",(function(){return F}));var i=r("8TSCy"),o=r("2TvXO"),u=r("7eJjO"),s=r("2l1wP"),c=r("kyj08"),l=r("jHOLN"),f=r("7qybv"),p=r("10vEZ"),d=r("5qZXj"),y=r("iho5X");r("lNwWH"),r("2VlWd"),r("iJAIC");var v=r("fcwIv"),h=r("gRgX5"),m=r("ejjI5"),k=r("krMu9"),g=r("7vTUY"),b=r("cRlei"),w=r("3nnTb"),_=r("dB39e"),x=r("eMbRX"),E=l.default.getLogger("esri.views.layers.FeatureLayerView"),F=function(e){var r=function(e){"use strict";i.inherits(n,e);var r=i.createSuper(n);function n(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var o;return i.classCallCheck(this,n),(o=r.call.apply(r,[this].concat(i.toConsumableArray(t))))._updatingRequiredFieldsPromise=null,o.filter=null,o.timeExtent=null,o.layer=null,o.requiredFields=[],o.view=null,i.possibleConstructorReturn(o)}return i.createClass(n,[{key:"initialize",value:function(){var e=this;(0,d.init)(this,["layer.renderer","layer.labelingInfo","layer.elevationInfo.featureExpressionInfo","layer.displayField","filter","featureEffect","layer.timeInfo","layer.floorInfo","timeExtent"],(function(){return e._handleRequiredFieldsChange()}),!0),(0,d.on)(this,"view.floors","change",(function(){return e._handleRequiredFieldsChange()})),(0,d.on)(this,"layer.sublayer","change",(function(){return e._handleRequiredFieldsChange()}))}},{key:"availableFields",get:function(){var e=this,t=e.layer,r=e.layer.fieldsIndex,n=e.requiredFields;return"outFields"in t&&t.outFields?(0,g.fixFields)(r,i.toConsumableArray((0,g.unpackFieldNames)(r,t.outFields)).concat(i.toConsumableArray(n))):(0,g.fixFields)(r,n)}},{key:"effect",get:function(){return(0,s.deprecatedProperty)(E,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect},set:function(e){(0,s.deprecatedProperty)(E,"effect",{replacement:"featureEffect",version:"4.22"}),this.featureEffect=e}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(e){void 0!==e?this._override("featureEffect",e):this._clearOverride("featureEffect")}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(e){E.error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"highlight",value:function(e){throw new Error("missing implementation")}},{key:"createQuery",value:function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=(0,f.isSome)(this.filter)?this.filter.createQuery(e):new(0,b.default)(e);if("feature"===this.layer.type){var r=(0,x.getFloorFilterClause)(this);(0,f.isSome)(r)&&(t.where=t.where?"(".concat(t.where,") AND (").concat(r,")"):r)}return(0,f.isSome)(this.timeExtent)&&(t.timeExtent=(0,f.isSome)(t.timeExtent)?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}},{key:"queryFeatures",value:function(e,t){throw new Error("missing implementation")}},{key:"queryObjectIds",value:function(e,t){throw new Error("missing implementation")}},{key:"queryFeatureCount",value:function(e,t){throw new Error("missing implementation")}},{key:"queryExtent",value:function(e,t){throw new Error("missing implementation")}},{key:"fetchPopupFeatures",value:function(e,r){var n=this;return i.asyncToGenerator(t(o).mark((function e(){var a;return t(o).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=n.validateFetchPopupFeatures(r))){e.next=3;break}throw a;case 3:return e.abrupt("return",n.fetchClientPopupFeatures(r));case 4:case"end":return e.stop()}}),e)})))()}},{key:"_loadArcadeModules",value:function(e){if(e.get("expressionInfos.length")||Array.isArray(e.content)&&e.content.some((function(e){return"expression"===e.type})))return(0,w.loadArcade)()}},{key:"_handleRequiredFieldsChange",value:function(){var e=this,t=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",t),t.then((function(){e._updatingRequiredFieldsPromise===t&&e._set("_updatingRequiredFieldsPromise",null)}))}},{key:"_updateRequiredFields",value:function(){var e=this;return i.asyncToGenerator(t(o).mark((function r(){var n,a,i,u,s,c,l,d,y,v,h,m,k,b,w,_,x,F;return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.layer&&e.view){t.next=2;break}return t.abrupt("return");case 2:return n="3d"===e.view.type,a=e.layer,i=e.layer,u=i.fieldsIndex,s=i.objectIdField,c="renderer"in a&&a.renderer,l="orderBy"in a&&a.orderBy,d=a.featureReduction,y=new Set,t.next=13,(0,p.eachAlways)([c?c.collectRequiredFields(y,u):null,(0,g.collectLabelingFields)(y,a),n?(0,g.collectElevationFields)(y,a):null,(0,f.isSome)(e.filter)?(0,g.collectFilterFields)(y,a,e.filter):null,(0,f.isSome)(e.featureEffect)?(0,g.collectFilterFields)(y,a,e.featureEffect.filter):null,d?(0,g.collectFeatureReductionFields)(y,a,d):null,l?(0,g.collectOrderByInfos)(y,a,l):null]);case 13:if(v=t.sent,a.timeInfo&&e.timeExtent&&(0,g.collectFields)(y,a.fieldsIndex,[a.timeInfo.startField,a.timeInfo.endField]),"feature"===a.type&&a.floorInfo&&(0,g.collectFields)(y,a.fieldsIndex,[a.floorInfo.floorField]),"subtype-group"!==a.type){t.next=19;break}return(0,g.collectField)(y,u,a.subtypeField),h=a.sublayers.map((function(e){var t;return Promise.all([null==(t=e.renderer)?void 0:t.collectRequiredFields(y,u),(0,g.collectLabelingFields)(y,e)])})),t.next=19,(0,p.eachAlways)(h);case 19:for(m=!0,k=!1,b=void 0,t.prev=20,w=v[Symbol.iterator]();!(m=(_=w.next()).done);m=!0)(x=_.value).error&&E.error(x.error);t.next=28;break;case 24:t.prev=24,t.t0=t.catch(20),k=!0,b=t.t0;case 28:t.prev=28,t.prev=29,m||null==w.return||w.return();case 31:if(t.prev=31,!k){t.next=34;break}throw b;case 34:return t.finish(31);case 35:return t.finish(28);case 36:(0,g.collectField)(y,u,s),n&&"displayField"in a&&a.displayField&&(0,g.collectField)(y,u,a.displayField),F=Array.from(y).sort(),e._set("requiredFields",F);case 39:case"end":return t.stop()}}),r,null,[[20,24,28,36],[29,,31,35]])})))()}},{key:"validateFetchPopupFeatures",value:function(e){if((0,f.isNone)(e))return null;var t=!0,r=!1,n=void 0;try{for(var a,i=e.clientGraphics[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,u=o.layer;if("popupEnabled"in u&&!u.popupEnabled)return new(0,c.default)("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:u});if("popupTemplate"in u&&!(0,_.getFetchPopupTemplate)(u,e))return new(0,c.default)("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:u});if(o.isAggregate&&!(u.featureReduction&&"popupTemplate"in u.featureReduction&&u.featureReduction.popupEnabled&&u.featureReduction.popupTemplate))return new(0,c.default)("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:u})}}catch(e){r=!0,n=e}finally{try{t||null==i.return||i.return()}finally{if(r)throw n}}}},{key:"fetchClientPopupFeatures",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){var a,i,u,s,c,l,p,d,y,v,h,m,k,b,w,x,E;return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((a=(0,f.isSome)(e)?e.clientGraphics:null)&&0!==a.length){t.next=3;break}return t.abrupt("return",[]);case 3:return i=new Array(a.length),u=new Map,t.next=7,r.createPopupQuery(e);case 7:s=t.sent,c=0;case 9:if(!(c<a.length)){t.next=27;break}if(!(l=a[c]).isAggregate){t.next=14;break}return i[c]=l,t.abrupt("continue",24);case 14:if("popupEnabled"in(p=l.layer)){t.next=17;break}return t.abrupt("continue",24);case 17:if(d=(0,g.unpackFieldNames)(r.layer.fieldsIndex,s.outFields),y=(0,_.getFetchPopupTemplate)(p,e),(0,f.isSome)(y)){t.next=20;break}return t.abrupt("continue",24);case 20:return t.next=22,r._loadArcadeModules(y);case 22:(v=t.sent)&&v.arcadeUtils.hasGeometryOperations(y)||!(0,g.featureHasFields)(d,l)?u.set(l.getObjectId(),c):i[c]=l;case 24:c++,t.next=9;break;case 27:if("stream"!==r.layer.type&&0!==u.size){t.next=29;break}return t.abrupt("return",i.filter(Boolean));case 29:return s.objectIds=Array.from(u.keys()),t.prev=30,t.next=33,r.layer.queryFeatures(s);case 33:for(h=t.sent,m=!0,k=!1,b=void 0,t.prev=35,w=h.features[Symbol.iterator]();!(m=(x=w.next()).done);m=!0)E=x.value,i[u.get(E.getObjectId())]=E;t.next=43;break;case 39:t.prev=39,t.t0=t.catch(35),k=!0,b=t.t0;case 43:t.prev=43,t.prev=44,m||null==w.return||w.return();case 46:if(t.prev=46,!k){t.next=49;break}throw b;case 49:return t.finish(46);case 50:return t.finish(43);case 51:t.next=55;break;case 53:t.prev=53,t.t1=t.catch(30);case 55:return t.abrupt("return",i.filter(Boolean));case 56:case"end":return t.stop()}}),n,null,[[30,53],[35,39,43,51],[44,,46,50]])})))()}},{key:"createPopupQuery",value:function(e){var r=this;return i.asyncToGenerator(t(o).mark((function n(){var a,i,u,s,c,l,p,d,y,v,h,m,k,g,b,w,E,F,R,C,T;return t(o).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=r.layer.createQuery(),i=new Set,u=!1,s=(0,f.isSome)(e)&&e.clientGraphics?e.clientGraphics.map((function(e){return e.layer})):[r.layer],c=!0,l=!1,p=void 0,t.prev=4,d=s[Symbol.iterator]();case 6:if(c=(y=d.next()).done){t.next=41;break}if("popupEnabled"in(v=y.value)){t.next=10;break}return t.abrupt("continue",38);case 10:if(h=(0,_.getFetchPopupTemplate)(v,e),(0,f.isSome)(h)){t.next=13;break}return t.abrupt("continue",38);case 13:return t.next=15,r._loadArcadeModules(h);case 15:return m=t.sent,k=m&&m.arcadeUtils.hasGeometryOperations(h),u=!("point"!==r.layer.geometryType&&!k),t.next=20,(0,_.getRequiredFields)(r.layer,h);case 20:for(g=t.sent,b=!0,w=!1,E=void 0,t.prev=22,F=g[Symbol.iterator]();!(b=(R=F.next()).done);b=!0)C=R.value,i.add(C);t.next=30;break;case 26:t.prev=26,t.t0=t.catch(22),w=!0,E=t.t0;case 30:t.prev=30,t.prev=31,b||null==F.return||F.return();case 33:if(t.prev=33,!w){t.next=36;break}throw E;case 36:return t.finish(33);case 37:return t.finish(30);case 38:c=!0,t.next=6;break;case 41:t.next=47;break;case 43:t.prev=43,t.t1=t.catch(4),l=!0,p=t.t1;case 47:t.prev=47,t.prev=48,c||null==d.return||d.return();case 50:if(t.prev=50,!l){t.next=53;break}throw p;case 53:return t.finish(50);case 54:return t.finish(47);case 55:return a.returnGeometry=u,a.returnZ=u,a.returnM=u,a.outFields=Array.from(i),a.outSpatialReference=r.view.spatialReference,"feature"===r.layer.type&&(T=(0,x.getFloorFilterClause)(r),(0,f.isSome)(T)&&(a.where=a.where?"(".concat(a.where,") AND (").concat(T,")"):T)),t.abrupt("return",a);case 57:case"end":return t.stop()}}),n,null,[[4,43,47,55],[22,26,30,38],[31,,33,37],[48,,50,54]])})))()}},{key:"canResume",value:function(){return!(!i.get(i.getPrototypeOf(n.prototype),"canResume",this).call(this)||(0,f.isSome)(this.timeExtent)&&this.timeExtent.isEmpty)}}]),n}(e);return(0,u._)([(0,y.property)()],r.prototype,"_updatingRequiredFieldsPromise",void 0),(0,u._)([(0,y.property)({readOnly:!0})],r.prototype,"availableFields",null),(0,u._)([(0,y.property)()],r.prototype,"effect",null),(0,u._)([(0,y.property)({type:m.default})],r.prototype,"featureEffect",null),(0,u._)([(0,y.property)({type:k.default})],r.prototype,"filter",void 0),(0,u._)([(0,y.property)(h.combinedViewLayerTimeExtentProperty)],r.prototype,"timeExtent",void 0),(0,u._)([(0,y.property)()],r.prototype,"layer",void 0),(0,u._)([(0,y.property)({type:Number})],r.prototype,"maximumNumberOfFeatures",null),(0,u._)([(0,y.property)({readOnly:!0,type:Boolean})],r.prototype,"maximumNumberOfFeaturesExceeded",null),(0,u._)([(0,y.property)({readOnly:!0})],r.prototype,"requiredFields",void 0),(0,u._)([(0,y.property)()],r.prototype,"suspended",void 0),(0,u._)([(0,y.property)()],r.prototype,"view",void 0),r=(0,u._)([(0,v.subclass)("esri.views.layers.FeatureLayerView")],r)}}))}();
//# sourceMappingURL=FeatureLayerView2D.eb362cb4.js.map
