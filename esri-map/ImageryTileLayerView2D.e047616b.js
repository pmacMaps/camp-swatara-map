function e(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("l4MVC",(function(r,i){var s;s=r.exports,Object.defineProperty(s,"__esModule",{value:!0,configurable:!0}),e(r.exports,"default",(function(){return _}));var n=t("j6uz9"),a=t("EvxpF"),o=t("6TszD"),l=t("lHg4e"),u=t("cc23H"),c=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var h=t("qA6zg"),p=t("ceRhn"),y=t("35vaU"),d=t("9xyOc"),f=t("l0KI8"),g=t("8it4a"),v=t("54zEM"),m=t("YRjSC"),x=t("aDxLR");const b=o.default.getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let w=class extends((0,v.default)((0,x.default)((0,y.LayerView2DMixin)(m.default)))){get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}update(e){this.subview.update(e),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.handles.add([(0,u.watch)((()=>{const{layer:e}=this;return{bandIds:e.bandIds,renderer:e.renderer,interpolation:e.interpolation,multidimensionalDefinition:e.multidimensionalDefinition}}),((e,t)=>{const r=e.interpolation!==t.interpolation&&("majority"===e.interpolation||"majority"===t.interpolation)&&(0,g.canUseMajorityInterpolationOnDataSource)(this.layer),i=e.renderer!==t.renderer&&t.renderer?.type!==e.renderer?.type;i&&this._updateSubview();const s=e.multidimensionalDefinition!==t.multidimensionalDefinition||r||i;this.subview.redrawOrRefetch(s).catch((e=>{(0,l.isAbortError)(e)||b.error(e)})),this.notifyChange("updating")})),(0,u.watch)((()=>this.layer.blendMode??"normal"),(e=>{this.subview.container.blendMode=e}),u.syncAndInitial),(0,u.watch)((()=>this.layer.effect??null),(e=>{this.subview.container.effect=e}),u.syncAndInitial),(0,u.watch)((()=>this.timeExtent),(()=>{this.subview.timeExtent=this.timeExtent,this.subview.redrawOrRefetch(!0).catch((e=>{(0,l.isAbortError)(e)||b.error(e)}))}),u.initial)],"attach")}detach(){this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),this.subview?.destroy(),this.subview=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}async hitTest(e,t){return[{type:"graphic",layer:this.layer,mapPoint:e,graphic:new(0,a.default)({attributes:{},geometry:e.clone()})}]}doRefresh(){return this.subview.doRefresh()}_updateSubview(){const e="vector-field"===this.layer.renderer.type?"rasterVF":"flow"===this.layer.renderer.type?"flow":"raster";if(this.subview){if(this.subview.type===e)return void this._attachSubview(this.subview);this._detachSubview(this.subview),this.subview?.destroy(),this.subview=null}const{layer:t}=this;let r;r="rasterVF"===e?new(0,f.default)({layer:t,layerView:this}):"flow"===e?new(0,p.default)({layer:t,layerView:this}):new(0,d.default)({layer:t,layerView:this}),"useWebGLForProcessing"in r&&(r.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in r&&(r.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in r&&(r.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD),this._attachSubview(r),this.subview=r,this.requestUpdate()}_attachSubview(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0),e.container.blendMode=this.layer.blendMode,e.container.effect=this.layer.effect)}_detachSubview(e){e?.attached&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this.subview=null}};(0,n._)([(0,c.property)()],w.prototype,"subview",void 0),(0,n._)([(0,c.property)()],w.prototype,"useWebGLForProcessing",null),(0,n._)([(0,c.property)()],w.prototype,"useProgressiveUpdate",null),w=(0,n._)([(0,h.subclass)("esri.views.2d.layers.ImageryTileLayerView2D")],w);const _=w})),t.register("9xyOc",(function(r,i){e(r.exports,"default",(function(){return p}));var s=t("j6uz9"),n=t("1CpCt"),a=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var o=t("qA6zg"),l=t("igD0m"),u=t("1cBNT"),c=t("8it4a");let h=class extends u.BaseImageryTileSubView2D{attach(){super.attach(),this.container=new(0,l.RasterTileContainer)(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme}detach(){super.detach(),this.container.removeAllChildren(),this.container=null}canUseWebGLForProcessing(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&(0,c.canUseMajorityInterpolationOnDataSource)(this.layer))}fetchTile(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}async updateTileSource(e,t){const{bandIds:r}=this.layer,i=this._getLayerInterpolation(),s=this.canUseWebGLForProcessing(),{source:a,globalSymbolizerParams:o,suspended:l,coords:u,resolution:c}=t,h=this.layerView.hasTilingEffects?o:t.symbolizerParams,{bitmap:p}=e;if([p.x,p.y]=u,p.resolution=c,a&&(0,n.isSome)(a)&&(0,n.isSome)(a.pixelBlock)){const e={extent:a.extent,pixelBlock:a.pixelBlock};if(p.rawPixelData=e,s)p.source=a.pixelBlock,p.isRendereredSource=!1;else{const t=await this.layer.applyRenderer(e,"stretch"===o?.type?o:null);p.source=t,p.isRendereredSource=!0}p.symbolizerParameters=s?h:null,s?p.transformGrid||(p.transformGrid=a.transformGrid):p.transformGrid=null}else{const e=this.createEmptyTilePixelBlock();p.source=e,p.symbolizerParameters=s?h:null,p.transformGrid=null}p.bandIds=s?r:null,p.width=this._tileInfoView.tileInfo.size[0],p.height=this._tileInfoView.tileInfo.size[1],p.interpolation=i,p.suspended=l,p.invalidateTexture()}async updateTileSymbolizerParameters(e,t){const{local:r,global:i}=t,{bandIds:s}=this.layer,a=this._getLayerInterpolation(),o=this.canUseWebGLForProcessing(),{bitmap:l}=e,{rawPixelData:u}=l;!o&&(0,n.isSome)(u)?(l.source=await this.layer.applyRenderer(u,"stretch"===i?.type?i:null),l.isRendereredSource=!0):(l.isRendereredSource&&(0,n.isSome)(u)&&(l.source=u.pixelBlock),l.isRendereredSource=!1),l.symbolizerParameters=o?this.layerView.hasTilingEffects?i:r:null,l.bandIds=o?s:null,l.interpolation=a,l.suspended=!1}_getLayerInterpolation(){const e=this.layer.renderer.type;if("raster-colormap"===e||"unique-value"===e||"class-breaks"===e)return"nearest";const{interpolation:t}=this.layer,{renderer:r}=this.layer;return"raster-stretch"===r.type&&null!=r.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}constructor(){super(...arguments),this.container=null,this.layer=null,this.type="raster"}};(0,s._)([(0,a.property)()],h.prototype,"container",void 0),(0,s._)([(0,a.property)()],h.prototype,"layer",void 0),(0,s._)([(0,a.property)()],h.prototype,"type",void 0),h=(0,s._)([(0,o.subclass)("esri.views.2d.layers.imagery.ImageryTileView2D")],h);const p=h})),t.register("igD0m",(function(r,i){e(r.exports,"RasterTileContainer",(function(){return c}));var s=t("19dbe"),n=t("6MGuH"),a=t("4ZNdX"),o=t("dKqeB"),l=t("eyQUy"),u=t("htRPC");class c extends u.default{createTile(e){const t=this._getTileBounds(e),[r,i]=this._tileInfoView.tileInfo.size;return new(0,o.RasterTile)(e,t[0],t[3],r,i)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (tile)",brushes:[a.brushes.raster],target:()=>this.children.map((e=>e.bitmap)),drawPhase:l.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===l.WGLDrawPhase.MAP&&super.doRender(e)}_getTileBounds(e){const t=this._tileInfoView.getTileBounds((0,s.create)(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:r}=this._tileInfoView,i=(0,n.getWorldWidth)(r.spatialReference);if(i){const{resolution:s}=r.lodAt(e.level),n=i/s%r.size[0],a=n?(r.size[0]-n)*s:0;t[0]-=a*e.world,t[2]-=a*e.world}}return t}constructor(){super(...arguments),this.isCustomTilingScheme=!1}}})),t.register("dKqeB",(function(r,i){e(r.exports,"RasterTile",(function(){return o}));var s=t("jsolS"),n=t("e0kjQ"),a=t("033AK");class o extends a.TiledDisplayObject{destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e,t){super.setTransform(e,t),this.bitmap.transforms.dvs=this.transforms.dvs}_createTransforms(){return{dvs:(0,s.c)(),tileMat3:(0,s.c)()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}constructor(e,t,r,i,s,a=null){super(e,t,r,i,s),this.bitmap=new(0,n.RasterBitmap)(a,null,null),this.bitmap.coordScale=[i,s],this.bitmap.once("isReady",(()=>this.ready()))}}})),t.register("033AK",(function(r,i){e(r.exports,"TiledDisplayObject",(function(){return o}));var s=t("52822"),n=t("5aS5k"),a=t("fdGvv");class o extends n.DisplayObject{destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e,t){const r=t/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[n,a]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,l=this.height/this.rangeY*r;(0,s.s)(i,o,0,0,0,l,0,n,a,1),(0,s.m)(this.transforms.dvs,e.displayViewMat3,i)}constructor(e,t,r,i,s,n=i,o=s){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new(0,a.default)(e),this.x=t,this.y=r,this.width=i,this.height=s,this.rangeX=n,this.rangeY=o}}})),t.register("htRPC",(function(r,i){e(r.exports,"default",(function(){return c}));var s=t("5HTPH"),n=t("eyQUy"),a=t("eqJSJ"),o=t("c48sV"),l=t("bVXM2");const u=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class c extends a.default{get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(u),this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,r=super.createRenderParams(e);return r.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,r.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),r}prepareRenderPasses(e){const t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[l.default],drawPhase:n.WGLDrawPhase.DEBUG|n.WGLDrawPhase.MAP|n.WGLDrawPhase.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,s.default)("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[o.default],drawPhase:n.WGLDrawPhase.DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}updateTransforms(e){for(const t of this.children){const r=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,r)}}setStencilReference(e){let t=1;for(const e of this.children)e.stencilRef=t++}constructor(e){super(),this._tileInfoView=e}}})),t.register("1cBNT",(function(r,i){e(r.exports,"BaseImageryTileSubView2D",(function(){return S}));var s=t("j6uz9");t("ixrNB");var n=t("8Y9g8"),a=t("6TszD"),o=t("1CpCt"),l=t("lHg4e"),u=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var c=t("qA6zg"),h=t("dZxPT"),p=t("1wOrp"),y=t("hCr3P"),d=t("2ia6n"),f=t("2wUG0"),g=t("2WfpR");t("liS5B");var v=t("9foJ7");t("fdGvv");var m=t("iuoYy"),x=t("hidC2"),b=t("8r0sl"),w=t("2WnyR");const _=[0,0],T=a.default.getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let S=class extends n.HandleOwner{get useWebGLForProcessing(){return this._get("useWebGLForProcessing")??!0}set useWebGLForProcessing(e){this._set("useWebGLForProcessing",e)}get useProgressiveUpdate(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();const t=this._getCacheSize(e);this._tileStrategy=new(0,x.default)({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:r,scale:i}=e.state,s=this._tileInfoView.getClosestInfoForScale(i);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[s.level],i=t.toJSON?t:w.default.fromJSON(t);(0,d.update)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,i,r,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,this.previousLOD?.level!==s.level&&(this.previousLOD=s,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()})));const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.layerView.requestUpdate()}get updating(){return this._fetchQueue?.updating||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}attach(){(0,b.getWebGLCapabilities)("2d").supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new(0,v.default)(this.layerView.tileInfo,this.layerView.fullExtent);const e=this._computeFetchConcurrency();this._fetchQueue=new(0,m.default)({tileInfoView:this._tileInfoView,concurrency:e,process:(e,t)=>this._fetchTile1(e,t)});const t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new(0,x.default)({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,d.unregister)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(e){const t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",(()=>{e.destroy(),this.layerView.requestUpdate()})),this.layerView.requestUpdate()}createEmptyTilePixelBlock(e=null){const t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&(0,o.isSome)(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const[r,i]=e,s=new(0,p.default)({width:r,height:i,pixels:[new Uint8Array(r*i)],mask:new Uint8Array(r*i),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=s),s}_fetchTile1(e,t){const r=(0,o.isSome)(t)&&t.signal,i=this.canUseWebGLForProcessing(),{layerView:s}=this,n=!s.tileInfo.isWrappable&&(0,o.isSome)((0,g.getWorldWidth)(s.view.spatialReference)),a={allowPartialFill:!0,datumTransformation:s.datumTransformation,interpolation:i?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:i,signal:(0,o.unwrap)(r),srcResolution:this._srcResolutions[e.level],timeExtent:s.timeExtent,tileInfo:s.tileInfo,disableWrapAround:n};return this.fetchTile(e,a)}_getCacheSize(e){return e?40:0}_initializeTileInfo(){const e=this.layerView.view.spatialReference,t=new(0,h.default)({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:e}),{scales:r,srcResolutions:i,isCustomTilingScheme:s}=(0,g.computeProjectedScales)(this.layer.rasterInfo,e),n=y.default.create({spatialReference:e,size:512,scales:r});(0===n.origin.x||n.origin.x>t.x)&&(n.origin=t),this._isCustomTilingScheme=s,this.layerView.set("tileInfo",n),this._srcResolutions=i??[]}_computeFetchConcurrency(){const{blockBoundary:e}=this.layer.rasterInfo.storageInfo,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}async _enqueueTileFetch(e,t){this.updatingHandles.addPromise(this._enqueueTileFetch1(e,t))}async _enqueueTileFetch1(e,t){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key),{bandIds:r}=this.layer;let i=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){i=!1;try{await this._redrawImage(this._abortController&&this._abortController.signal)}catch(e){(0,l.isAbortError)(e)&&T.error(e)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const s=this._tileInfoView.getTileCoords(_,e.key),n=this._tileInfoView.getTileResolution(e.key);await this.updateTileSource(e,{source:t,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:i,bandIds:r,coords:s,resolution:n}),e.once("attach",(()=>this.layerView.requestUpdate())),this.container.addChild(e)}catch(e){(0,l.isAbortError)(e)||T.error(e)}this.layerView.requestUpdate()}}async _redrawImage(e){if(0===this.container.children.length)return;await this.layer.updateRenderer(),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const t=this.container.children.map((async e=>this.updateTileSymbolizerParameters(e,{local:this._symbolizerParams,global:this._globalSymbolizerParams})));await(0,l.eachAlways)(t),this.container.requestRender()}async _updateGlobalSymbolizerParams(e){const t={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:e},r=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,t);if(!r||!r.pixelBlock)return;const i=this.layer.symbolizer.generateWebGLParameters({pixelBlock:(0,f.extractBands)(r.pixelBlock,this.layer.bandIds),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds});!this.canUseWebGLForProcessing()&&i&&"stretch"===i.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(i.factor=i.factor.map((e=>255*e)),i.outMin=Math.round(255*i.outMin),i.outMax=Math.round(255*i.outMax)),this._globalSymbolizerParams=i}_updateSymbolizerParams(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})}_updateBlockCacheRegistry(e=!1){const{url:t,rasterInfo:r,raster:i}=this.layer,{multidimensionalDefinition:s}=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent}),n=r?.multidimensionalInfo?i.getSliceIndex(s):null,a=(0,d.getRasterId)(t,n);if(a!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,d.unregister)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,d.register)(a,this.layer.raster.rasterInfo),e){const e=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),t=this._srcResolutions[e.level];(0,d.update)(a,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,t,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=a}}async doRefresh(){await this.layer.updateRenderer(),this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset();const e=[];this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,this._tileStrategy.tiles.forEach((t=>e.push(this._enqueueTileFetch(t)))),await(0,l.eachAlways)(e)}constructor(){super(...arguments),this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=null,this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._globalUpdateRequested=!1,this.attached=!1,this.container=null,this.layer=null,this.timeExtent=null,this.redrawOrRefetch=(0,l.debounce)(((e,t)=>!this.previousLOD||this.layerView.suspended?Promise.resolve():e?this.updatingHandles.addPromise(this.doRefresh()):this.updatingHandles.addPromise(this._redrawImage(t))))}};(0,s._)([(0,u.property)()],S.prototype,"_fetchQueue",void 0),(0,s._)([(0,u.property)()],S.prototype,"_globalUpdateRequested",void 0),(0,s._)([(0,u.property)()],S.prototype,"attached",void 0),(0,s._)([(0,u.property)()],S.prototype,"container",void 0),(0,s._)([(0,u.property)()],S.prototype,"layer",void 0),(0,s._)([(0,u.property)()],S.prototype,"layerView",void 0),(0,s._)([(0,u.property)()],S.prototype,"type",void 0),(0,s._)([(0,u.property)()],S.prototype,"useWebGLForProcessing",null),(0,s._)([(0,u.property)()],S.prototype,"useProgressiveUpdate",null),(0,s._)([(0,u.property)()],S.prototype,"timeExtent",void 0),(0,s._)([(0,u.property)()],S.prototype,"updating",null),S=(0,s._)([(0,c.subclass)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],S)})),t.register("2ia6n",(function(r,i){e(r.exports,"getRasterId",(function(){return c})),e(r.exports,"register",(function(){return h})),e(r.exports,"unregister",(function(){return p})),e(r.exports,"decreaseRefCount",(function(){return y})),e(r.exports,"getBlock",(function(){return d})),e(r.exports,"putBlock",(function(){return f})),e(r.exports,"deleteBlock",(function(){return g})),e(r.exports,"update",(function(){return v})),t("ixrNB");var s=t("1CpCt"),n=t("230S6"),a=t("2WfpR"),o=t("dZxPT");const l=new Map,u=new(0,n.default);function c(e,t){return null==t?e:`${e}?sliceId=${t}`}function h(e,t){const r={extent:null,rasterInfo:t,cache:new Map};if(l.has(e)){const t=l.get(e);return t.push(r),t.length-1}return l.set(e,[r]),0}function p(e,t){if(l.has(e)){const r=l.get(e);r[t]=null,r.some((e=>null!=e))||l.delete(e)}}function y(e,t,r){if(!l.has(e))return null==t?u.decreaseRefCount(e,r):0;const i=l.get(e);if(null==i[t])return u.decreaseRefCount(e,r);const s=i[t].cache;if(s.has(r)){const e=s.get(r);if(e.refCount--,0===e.refCount){s.delete(r);for(let e=0;e<i.length;e++)i[e]&&i[e].cache.has(r)&&i[e].cache.delete(r);e.controller&&e.controller.abort()}return e.refCount}return 0}function d(e,t,r){if(!l.has(e))return null==t?u.getBlock(e,r):null;const i=l.get(e);if(null==i[t]){for(let e=0;e<i.length;e++)if(i[e]&&i[e].cache.has(r)){const t=i[e].cache.get(r);return t.refCount++,t.block}return u.getBlock(e,r)}const s=i[t].cache;if(s.has(r)){const e=s.get(r);return e.refCount++,e.block}for(let e=0;e<i.length;e++)if(e!==t&&i[e]&&i[e]&&i[e].cache.has(r)){const t=i[e].cache.get(r);return t.refCount++,s.set(r,t),t.block}return null}function f(e,t,r,i,s=null){if(!l.has(e))return void(null==t&&u.putBlock(e,r,i,s));const n=l.get(e);if(null==n[t])return void u.putBlock(e,r,i,s);const a={refCount:1,block:i,isResolved:!1,isRejected:!1,controller:s};i.then((()=>a.isResolved=!0)).catch((()=>a.isRejected=!0)),n[t].cache.set(r,a)}function g(e,t,r){if(!l.has(e))return void(null==t&&u.deleteBlock(e,r));const i=l.get(e);null!=i[t]?i[t].cache.delete(r):u.deleteBlock(e,r)}function v(e,t,r,i,n,u,c=null){const h=function(e,t){if(!l.has(e))return null;const r=l.get(e);return null==r[t]?null:r[t]}(e,t),p=h.extent,{cache:y,rasterInfo:d}=h;if(p&&p.xmin===r.xmin&&p.xmax===r.xmax&&p.ymin===r.ymin&&p.ymax===r.ymax)return;const f=r.clone().normalize(),{spatialReference:g,transform:v}=d,m=new Set;for(let e=0;e<f.length;e++){const t=f[e];if(t.xmax-t.xmin<=i||t.ymax-t.ymin<=i)continue;let r=(0,a.projectExtent)(t,g,c);(0,s.isSome)(v)&&(r=v.inverseTransform(r));const l=new(0,o.default)({x:i,y:i,spatialReference:t.spatialReference});if(null==n&&!(n=(0,a.projectResolution)(l,g,t,c)))return;const{pyramidLevel:h,pyramidResolution:p,excessiveReading:y}=(0,a.snapPyramid)(n,d,u||"closest");if(y)return;const{storageInfo:x}=d,{origin:b}=x,w={x:Math.max(0,Math.floor((r.xmin-b.x)/p.x)),y:Math.max(0,Math.floor((b.y-r.ymax)/p.y))},_=Math.ceil((r.xmax-r.xmin)/p.x-.1),T=Math.ceil((r.ymax-r.ymin)/p.y-.1),S=h>0?x.pyramidBlockWidth:x.blockWidth,V=h>0?x.pyramidBlockHeight:x.blockHeight,P=1,L=Math.max(0,Math.floor(w.x/S)-P),I=Math.max(0,Math.floor(w.y/V)-P),R=Math.floor((w.x+_-1)/S)+P,C=Math.floor((w.y+T-1)/V)+P;for(let e=I;e<=C;e++)for(let t=L;t<=R;t++)m.add(`${h}/${e}/${t}`)}y.forEach(((e,t)=>{if(!m.has(t)){const e=y.get(t);(null==e||e.isResolved||e.isRejected)&&y.delete(t)}})),h.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}})),t.register("230S6",(function(t,r){e(t.exports,"default",(function(){return i}));class i{decreaseRefCount(e,t){const r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){const e=i.get(r);return e.refCount--,e.refCount<=0&&(i.delete(r),e.controller&&e.controller.abort()),e.refCount}return 0}getBlock(e,t){const r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){const e=i.get(r);return e.ts=Date.now(),e.refCount++,i.delete(r),i.set(r,e),e.block}return null}putBlock(e,t,r,i=null){const s=this._cachedBlocks,n=e+"/"+t;if(s.has(n)){const e=s.get(n);e.ts=Date.now(),e.refCount++}else s.set(n,{block:r,ts:Date.now(),refCount:1,controller:i});this._trim(),this._updateTimer()}deleteBlock(e,t){const r=this._cachedBlocks,i=e+"/"+t;r.has(i)&&r.delete(i)}updateMaxSize(e){this._size=e,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval((()=>{const t=Array.from(e),r=Date.now();for(let i=0;i<t.length&&t[i][1].ts<=r-this._duration;i++)e.delete(t[i][0]);0===e.size&&this._clearTimer()}),this._interval)}_trim(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const t=Array.from(e);for(let r=0;r<t.length-this._size;r++)e.delete(t[r][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}constructor(e=15e3,t=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}}})),t.register("8it4a",(function(r,i){e(r.exports,"toJSONGeometryType",(function(){return n})),e(r.exports,"canUseMajorityInterpolationOnDataSource",(function(){return a}));const s=new(0,t("4jlRt").JSONMap)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function n(e){return s.toJSON(e)}function a(e){const{bandCount:t,attributeTable:r,colormap:i,pixelType:s}=e.rasterInfo;return 1===t&&(null!=r||null!=i||"u8"===s||"s8"===s)}})),t.register("l0KI8",(function(r,i){e(r.exports,"default",(function(){return y}));var s=t("j6uz9"),n=t("1CpCt"),a=t("cc23H"),o=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var l=t("qA6zg"),u=t("dqihR"),c=t("1fseN"),h=t("1cBNT");let p=class extends h.BaseImageryTileSubView2D{canUseWebGLForProcessing(){return!1}async fetchTile(e,t){t={...t,interpolation:"nearest",requestProjectedLocalDirections:!0};const r=await this.layer.fetchTile(e.level,e.row,e.col,t);return"vector-magdir"===this.layer.rasterInfo.dataType&&r?.pixelBlock&&(r.pixelBlock=await this.layer.convertVectorFieldData(r.pixelBlock,t)),r}updateTileSource(e,t){const r=t.symbolizerParams,{tileData:i}=e;i.key=e.key,i.width=this._tileInfoView.tileInfo.size[0],i.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:s}=r,{source:a}=t;if(i.offset=this._getTileSymbolOffset(i.key,s),(0,n.isSome)(a)&&(0,n.isSome)(a.pixelBlock)){const e={extent:a.extent,pixelBlock:a.pixelBlock};i.rawPixelData=e,i.symbolizerParameters=r,i.source=this._sampleVectorFieldData(a.pixelBlock,r,i.offset)}else{const e=[Math.round((this._tileInfoView.tileInfo[0]-i.offset[0])/s),Math.round((this._tileInfoView.tileInfo[1]-i.offset[1])/s)],t=this.createEmptyTilePixelBlock(e);i.source=t,i.symbolizerParameters=r}return i.invalidateVAO(),Promise.resolve(null)}updateTileSymbolizerParameters(e,t){const r=t.local,{symbolTileSize:i}=r,{tileData:s}=e;s.offset=this._getTileSymbolOffset(s.key,i);const a=s.symbolizerParameters.symbolTileSize;return s.symbolizerParameters=r,(0,n.isSome)(s.rawPixelData?.pixelBlock)&&a!==i&&(s.source=this._sampleVectorFieldData(s.rawPixelData.pixelBlock,s.symbolizerParameters,s.offset)),Promise.resolve(null)}attach(){super.attach(),this.container=new(0,c.RasterVFTileContainer)(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=(0,a.watch)((()=>this.layer.renderer),(e=>this._updateSymbolType(e)))}detach(){super.detach(),this.container.removeAllChildren(),this._handle.remove(),this._handle=null}_getTileSymbolOffset(e,t){const r=e.col*this._tileInfoView.tileInfo.size[0]%t,i=e.row*this._tileInfoView.tileInfo.size[1]%t;return[r>t/2?t-r:-r,i>t/2?t-i:-i]}_sampleVectorFieldData(e,t,r){const{symbolTileSize:i}=t;return(0,u.sampleVectorField)(e,"vector-uv",i,r)}_updateSymbolType(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}constructor(){super(...arguments),this._handle=null,this.container=null,this.layer=null,this.type="rasterVF"}};(0,s._)([(0,o.property)()],p.prototype,"container",void 0),(0,s._)([(0,o.property)()],p.prototype,"layer",void 0),(0,s._)([(0,o.property)()],p.prototype,"type",void 0),p=(0,s._)([(0,l.subclass)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],p);const y=p})),t.register("1fseN",(function(r,i){e(r.exports,"RasterVFTileContainer",(function(){return u}));var s=t("19dbe"),n=t("adROs"),a=t("dcBDi"),o=t("eyQUy"),l=t("htRPC");class u extends l.default{createTile(e){const t=this._tileInfoView.getTileBounds((0,s.create)(),e),[r,i]=this._tileInfoView.tileInfo.size;return new(0,a.RasterVFTile)(e,t[0],t[3],r,i)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (vf tile)",brushes:[n.default],target:()=>this.children.map((e=>e.tileData)),drawPhase:o.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===o.WGLDrawPhase.MAP&&this.symbolTypes.forEach((t=>{e.renderPass=t,super.doRender(e)}))}constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}}})),t.register("dcBDi",(function(r,i){e(r.exports,"RasterVFTile",(function(){return l}));var s=t("52822"),n=t("jsolS"),a=t("fYJER"),o=t("033AK");class l extends o.TiledDisplayObject{destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(e){this.tileData.stencilRef=e}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{dvs:(0,n.c)(),tileMat3:(0,n.c)()}}setTransform(e,t){super.setTransform(e,t);const r=t/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[n,a]=this.tileData.offset,o=[this.x+n*t,this.y-a*t],[l,u]=e.toScreenNoRotation([0,0],o),{symbolTileSize:c}=this.tileData.symbolizerParameters,h=Math.round((this.width-this.tileData.offset[0])/c)*c,p=Math.round((this.height-this.tileData.offset[1])/c)*c,y=h/this.rangeX*r,d=p/this.rangeY*r;(0,s.s)(i,y,0,0,0,d,0,l,u,1),(0,s.m)(this.transforms.dvs,e.displayViewMat3,i),this.tileData.transforms.dvs=this.transforms.dvs}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}constructor(e,t,r,i,s,n=null){super(e,t,r,i,s),this.tileData=new(0,a.RasterVFDisplayObject)(n),this.tileData.coordScale=[i,s],this.tileData.once("isReady",(()=>this.ready()))}}})),t.register("54zEM",(function(r,i){e(r.exports,"default",(function(){return y}));var s=t("j6uz9"),n=t("EvxpF"),a=t("bPmsI"),o=t("1CpCt"),l=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var u=t("qA6zg"),c=t("lixLM"),h=t("2WfpR"),p=t("6hadY");const y=e=>{let t=class extends e{get fullExtent(){return this._getfullExtent()}_getfullExtent(){return this.projectFullExtent(this.view.spatialReference)}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}get datumTransformation(){return(0,h.getDefaultDatumTransformationForDataset)((0,o.unwrap)(this.layer.fullExtent),this.view.spatialReference,!0)}supportsSpatialReference(e){return!!this.projectFullExtent(e)}projectFullExtent(e){const t=(0,o.unwrap)(this.layer.fullExtent),r=(0,h.getDefaultDatumTransformationForDataset)(t,e,!1);return(0,h.projectExtent)(t,e,r)}async fetchPopupFeatures(e,t){const{layer:r}=this;if(!e)throw new(0,a.default)("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:r});const{popupEnabled:i}=r,s=(0,p.getFetchPopupTemplate)(r,t);if(!i||(0,o.isNone)(s))throw new(0,a.default)("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:i,popupTemplate:s});const l=[],{value:u,magdirValue:c}=await r.identify(e,{timeExtent:this.timeExtent});let h="";if(u&&u.length){h="imagery-tile"===r.type&&r.hasStandardTime()&&null!=u[0]?u.map((e=>r.getStandardTimeValue(e))).join(", "):u.join(", ");const e={ObjectId:0},t="Raster.ServicePixelValue";e[t]=this._formatAttributeValue(h,t);const i=r.rasterInfo?.attributeTable?.features;if(i&&i.length>0){const t=i.filter((e=>{const t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===h}));if(t.length>0){const r=t[0];if(r)for(const t in r.attributes)if(r.attributes.hasOwnProperty(t)){const i=this._rasterFieldPrefix+t;e[i]=this._formatAttributeValue(r.attributes[t],i)}}}const s=r.rasterInfo.dataType;"vector-magdir"!==s&&"vector-uv"!==s||(e["Raster.Magnitude"]=c?.[0],e["Raster.Direction"]=c?.[1]);const a=new(0,n.default)(this.fullExtent.clone(),null,e);a.layer=r,a.sourceLayer=a.layer,l.push(a)}return l}_formatAttributeValue(e,t){if("string"==typeof e){const r=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,i=this._getFieldInfo(r,t),s=i&&i.format;if(s){let t,r;return e.trim().includes(",")?(t=",",r=t+" ",this._formatDelimitedString(e,t,r,s)):e.trim().includes(" ")?(t=r=" ",this._formatDelimitedString(e,t,r,s)):this._formatNumberFromString(e,s)}}return e}_getFieldInfo(e,t){if(!e||!e.length||!t)return;const r=t.toLowerCase();let i;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==r&&e.fieldName.toLowerCase()!==r.replace(/ /g,"_")||(i=e,0)))),i}_formatDelimitedString(e,t,r,i){return e&&t&&r&&i?e.trim().split(t).map((e=>this._formatNumberFromString(e,i))).join(r):e}_formatNumberFromString(e,t){if(!e||!t)return e;const r=Number(e);return isNaN(r)?e:t.format(r)}constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}};return(0,s._)([(0,l.property)()],t.prototype,"layer",void 0),(0,s._)([(0,l.property)(c.combinedViewLayerTimeExtentProperty)],t.prototype,"timeExtent",void 0),(0,s._)([(0,l.property)()],t.prototype,"view",void 0),(0,s._)([(0,l.property)()],t.prototype,"fullExtent",null),(0,s._)([(0,l.property)()],t.prototype,"tileInfo",void 0),(0,s._)([(0,l.property)({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=(0,s._)([(0,u.subclass)("esri.views.layers.ImageryTileLayerView")],t),t}})),t.register("6hadY",(function(r,i){e(r.exports,"getRequiredFields",(function(){return a})),e(r.exports,"getFetchPopupTemplate",(function(){return o}));var s=t("1CpCt"),n=t("15IfA");async function a(e,t=e.popupTemplate){if((0,s.isNone)(t))return[];const r=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:i}=t,{objectIdField:a,typeIdField:o,globalIdField:l,relationships:u}=e;if(r.includes("*"))return["*"];const c=i?await(0,n.getFeatureEditFields)(e):[],h=(0,n.fixFields)(e.fieldsIndex,[...r,...c]);return o&&h.push(o),h&&a&&e.fieldsIndex.has(a)&&!h.includes(a)&&h.push(a),h&&l&&e.fieldsIndex.has(l)&&!h.includes(l)&&h.push(l),u&&u.forEach((t=>{const{keyField:r}=t;h&&r&&e.fieldsIndex.has(r)&&!h.includes(r)&&h.push(r)})),h}function o(e,t){return e.popupTemplate?e.popupTemplate:(0,s.isSome)(t)&&t.defaultPopupTemplateEnabled&&(0,s.isSome)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}})),t.register("aDxLR",(function(r,i){e(r.exports,"default",(function(){return c}));var s=t("j6uz9"),n=t("6TszD"),a=t("lHg4e"),o=t("cc23H"),l=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var u=t("qA6zg");const c=e=>{let t=class extends e{initialize(){this.handles.add((0,o.on)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{(0,a.isAbortError)(e)||n.default.getLogger(this.declaredClass).error(e)}))})),"RefreshableLayerView")}};return(0,s._)([(0,l.property)()],t.prototype,"layer",void 0),t=(0,s._)([(0,u.subclass)("esri.layers.mixins.RefreshableLayerView")],t),t}})),t.register("3mbeV",(function(t,r){e(t.exports,"u32to4Xu8",(function(){return s})),e(t.exports,"i1616to32",(function(){return n})),e(t.exports,"i8888to32",(function(){return a}));const i=new Float32Array(1);new Uint32Array(i.buffer);function s(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function n(e,t){return 65535&e|t<<16}function a(e,t,r,i){return 255&e|(255&t)<<8|(255&r)<<16|i<<24}})),t.register("bVIMy",(function(t,r){var i,s,n;function a(e){switch(e){case"left":return i.Left;case"right":return i.Right;case"center":return i.Center}}function o(e){switch(e){case"top":return s.Top;case"middle":return s.Center;case"baseline":return s.Baseline;case"bottom":return s.Bottom}}function l(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return[i.Right,s.Bottom];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return[i.Center,s.Bottom];case"above-right":case"esriServerPointLabelPlacementAboveRight":return[i.Left,s.Bottom];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return[i.Right,s.Center];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return[i.Center,s.Center];case"center-right":case"esriServerPointLabelPlacementCenterRight":return[i.Left,s.Center];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return[i.Right,s.Top];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return[i.Center,s.Top];case"below-right":case"esriServerPointLabelPlacementBelowRight":return[i.Left,s.Top];default:return console.debug(`Found invalid placement type ${e}`),[i.Center,s.Center]}}function u(e){switch(e){case i.Right:return-1;case i.Center:return 0;case i.Left:return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}}function c(e){switch(e){case s.Top:return 1;case s.Center:return 0;case s.Bottom:case s.Baseline:return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}}function h(e){switch(e){case"left":return i.Left;case"right":return i.Right;case"center":return i.Center}}function p(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}e(t.exports,"HAlign",(function(){return i})),e(t.exports,"VAlign",(function(){return s})),e(t.exports,"getXAnchorDirection",(function(){return a})),e(t.exports,"getYAnchorDirection",(function(){return o})),e(t.exports,"getAlignmentFromPlacement",(function(){return l})),e(t.exports,"getXDirection",(function(){return u})),e(t.exports,"getYDirection",(function(){return c})),e(t.exports,"getJustification",(function(){return h})),e(t.exports,"isMapAligned",(function(){return p})),(n=i||(i={}))[n.Left=-1]="Left",n[n.Center=0]="Center",n[n.Right=1]="Right",function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(s||(s={}))})),t.register("eDdav",(function(r,i){e(r.exports,"isOutlineFillSymbology",(function(){return l})),e(r.exports,"hasSimpleSymbology",(function(){return u})),e(r.exports,"hasOutlineFillSymbology",(function(){return c})),e(r.exports,"createMaterialKey",(function(){return h})),e(r.exports,"FillMaterialKey",(function(){return m})),e(r.exports,"LineMaterialKey",(function(){return b})),e(r.exports,"MarkerMaterialKey",(function(){return x})),e(r.exports,"TextMaterialKey",(function(){return w})),e(r.exports,"LabelMaterialKey",(function(){return _})),e(r.exports,"hydrateMaterialKey",(function(){return p})),e(r.exports,"MaterialKeyBase",(function(){return y}));var s=t("bPmsI"),n=t("bVIMy"),a=t("eyQUy");const o=Object.keys(a.WGLSymbologyType).filter((e=>"number"==typeof a.WGLSymbologyType[e])).reduce(((e,t)=>({...e,[t]:a.WGLSymbologyType[t]})),{});function l(e){return e===a.WGLSymbologyType.OUTLINE_FILL||e===a.WGLSymbologyType.OUTLINE_FILL_SIMPLE}function u(e){return function(e){return e===a.WGLSymbologyType.SIMPLE||e===a.WGLSymbologyType.OUTLINE_FILL_SIMPLE}(e.symbologyType)}function c(e){return l(e.symbologyType)}function h(e,t){switch(e){case a.WGLGeometryType.FILL:return m.from(t);case a.WGLGeometryType.LINE:return b.from(t);case a.WGLGeometryType.MARKER:return x.from(t);case a.WGLGeometryType.TEXT:return w.from(t);case a.WGLGeometryType.LABEL:return _.from(t);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${e}`)}}function p(e){switch(y.load(e).geometryType){case a.WGLGeometryType.MARKER:return new x(e);case a.WGLGeometryType.FILL:return new m(e);case a.WGLGeometryType.LINE:return new b(e);case a.WGLGeometryType.TEXT:return new w(e);case a.WGLGeometryType.LABEL:return new _(e)}}class y{static load(e){const t=this.shared;return t.data=e,t}set data(e){this._data=e}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(e){this.setBits(e,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(e){this.setBit(20,e)}get sdf(){return!!this.bit(11)}set sdf(e){this.setBit(11,e)}get pattern(){return!!this.bit(12)}set pattern(e){this.setBit(12,e)}get textureBinding(){return this.bits(0,8)}set textureBinding(e){this.setBits(e,0,8)}get symbologyType(){return this.bits(21,26)}set symbologyType(e){this.setBits(e,21,26)}get geometryTypeString(){switch(this.geometryType){case a.WGLGeometryType.FILL:return"fill";case a.WGLGeometryType.MARKER:return"marker";case a.WGLGeometryType.LINE:return"line";case a.WGLGeometryType.TEXT:return"text";case a.WGLGeometryType.LABEL:return"label";default:throw new(0,s.default)(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(e,t){const r=1<<e;t?this._data|=r:this._data&=~r}bit(e){return(this._data&1<<e)>>e}setBits(e,t,r){for(let i=t,s=0;i<r;i++,s++)this.setBit(i,0!=(e&1<<s))}bits(e,t){let r=0;for(let i=e,s=0;i<t;i++,s++)r|=this.bit(i)<<s;return r}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf,symbologyType:{value:a.WGLSymbologyType[this.symbologyType],options:o,namespace:"SYMBOLOGY_TYPE"}}}getVariationHash(){return this._data&~(7&this.textureBinding)}constructor(e){this._data=0,this._data=e}}y.shared=new y(0);const d=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(e){this.setBit(16,e)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(e){this.setBit(17,e)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(e){this.setBit(18,e)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(e){this.setBit(19,e)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(e,t){super.setVV(e,t);const r=function(e,t,r){const i=a.WGLVVFlag.SIZE_FIELD_STOPS|a.WGLVVFlag.SIZE_MINMAX_VALUE|a.WGLVVFlag.SIZE_SCALE_STOPS|a.WGLVVFlag.SIZE_UNIT_VALUE,s=(t&(a.WGLVVTarget.FIELD_TARGETS_OUTLINE|a.WGLVVTarget.MINMAX_TARGETS_OUTLINE|a.WGLVVTarget.SCALE_TARGETS_OUTLINE|a.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return e===a.WGLGeometryType.LINE&&r.isOutline||e===a.WGLGeometryType.FILL&&l(r.symbologyType)?i&s:i&~s}(this.geometryType,e,t)&e;this.vvSizeMinMaxValue=!!(r&a.WGLVVFlag.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(r&a.WGLVVFlag.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(r&a.WGLVVFlag.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(r&a.WGLVVFlag.SIZE_SCALE_STOPS)}},f=e=>class extends e{get vvRotation(){return 0!==this.bit(15)}set vvRotation(e){this.setBit(15,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t.isOutline&&!!(e&a.WGLVVFlag.ROTATION)}},g=e=>class extends e{get vvColor(){return 0!==this.bit(13)}set vvColor(e){this.setBit(13,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t.isOutline&&!!(e&a.WGLVVFlag.COLOR)}},v=e=>class extends e{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(e){this.setBit(14,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t.isOutline&&!!(e&a.WGLVVFlag.OPACITY)}};class m extends(g(v(d(y)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const{symbologyType:t,vvFlags:r}=e,i=this.load(0);return i.geometryType=a.WGLGeometryType.FILL,i.symbologyType=t,t!==a.WGLSymbologyType.DOT_DENSITY&&i.setVV(r,e),i.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}m.shared=new m(0);class x extends(g(v(f(d(y))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const{symbologyType:t,vvFlags:r}=e,i=this.load(0);return i.geometryType=a.WGLGeometryType.MARKER,i.symbologyType=t,t!==a.WGLSymbologyType.HEATMAP&&i.setVV(r,e),i.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}x.shared=new x(0);class b extends(g(v(d(y)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.LINE,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}b.shared=new b(0);class w extends(g(v(f(d(y))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.TEXT,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}w.shared=new w(0);class _ extends(d(y)){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.LABEL,t.symbologyType=e.symbologyType,t.setVV(e.vvFlags,e),t.mapAligned=(0,n.isMapAligned)(e.placement),t.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}_.shared=new _(0)})),t.register("c4cvq",(function(t,r){e(t.exports,"radToByte",(function(){return o})),e(t.exports,"degToByte",(function(){return l})),e(t.exports,"log2",(function(){return u})),e(t.exports,"between",(function(){return c}));Number.POSITIVE_INFINITY;const i=Math.PI,s=128/i,n=1/Math.LN2;function a(e,t){return(e%=t)>=0?e:e+t}function o(e){return a(e*s,256)}function l(e){return a(.7111111111111111*e,256)}function u(e){return Math.log(e)*n}function c(e,t,r){return e>=t&&e<=r||e>=r&&e<=t}})),t.register("3Icya",(function(t,r){e(t.exports,"e",(function(){return a}));var i,s,n={exports:{}};i=n,void 0!==(s=function(){function e(e,r,s){s=s||2;var n,a,o,u,c,h,p,y=r&&r.length,d=y?r[0]*s:e.length,f=t(e,0,d,s,!0),g=[];if(!f||f.next===f.prev)return g;if(y&&(f=l(e,r,f,s)),e.length>80*s){n=o=e[0],a=u=e[1];for(var v=s;v<d;v+=s)(c=e[v])<n&&(n=c),(h=e[v+1])<a&&(a=h),c>o&&(o=c),h>u&&(u=h);p=0!==(p=Math.max(o-n,u-a))?1/p:0}return i(f,g,s,n,a,p),g}function t(e,t,r,i,s){var n,a;if(s===I(e,t,r,i)>0)for(n=t;n<r;n+=i)a=V(n,e[n],e[n+1],a);else for(n=r-i;n>=t;n-=i)a=V(n,e[n],e[n+1],a);if(a&&x(a,a.next)){var o=a.next;P(a),a=o}return a}function r(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!x(i,i.next)&&0!==m(i.prev,i,i.next))i=i.next;else{var s=i.prev;if(P(i),(i=t=s)===i.next)break;r=!0}}while(r||i!==t);return t}function i(e,t,l,u,c,h,p){if(e){!p&&h&&y(e,u,c,h);for(var d,f,g=e;e.prev!==e.next;)if(d=e.prev,f=e.next,h?n(e,u,c,h):s(e))t.push(d.i/l),t.push(e.i/l),t.push(f.i/l),P(e),e=f.next,g=f.next;else if((e=f)===g){p?1===p?i(e=a(r(e),t,l),t,l,u,c,h,2):2===p&&o(e,t,l,u,c,h):i(r(e),t,l,u,c,h,1);break}}}function s(e){var t=e.prev,r=e,i=e.next;if(m(t,r,i)>=0)return!1;for(var s=e.next.next;s!==e.prev;){if(g(t.x,t.y,r.x,r.y,i.x,i.y,s.x,s.y)&&m(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function n(e,t,r,i){var s=e.prev,n=e,a=e.next;if(m(s,n,a)>=0)return!1;for(var o=s.x<n.x?s.x<a.x?s.x:a.x:n.x<a.x?n.x:a.x,l=s.y<n.y?s.y<a.y?s.y:a.y:n.y<a.y?n.y:a.y,u=s.x>n.x?s.x>a.x?s.x:a.x:n.x>a.x?n.x:a.x,c=s.y>n.y?s.y>a.y?s.y:a.y:n.y>a.y?n.y:a.y,h=d(o,l,t,r,i),p=d(u,c,t,r,i),y=e.prevZ,f=e.nextZ;y&&y.z>=h&&f&&f.z<=p;){if(y!==e.prev&&y!==e.next&&g(s.x,s.y,n.x,n.y,a.x,a.y,y.x,y.y)&&m(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,f!==e.prev&&f!==e.next&&g(s.x,s.y,n.x,n.y,a.x,a.y,f.x,f.y)&&m(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;y&&y.z>=h;){if(y!==e.prev&&y!==e.next&&g(s.x,s.y,n.x,n.y,a.x,a.y,y.x,y.y)&&m(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;f&&f.z<=p;){if(f!==e.prev&&f!==e.next&&g(s.x,s.y,n.x,n.y,a.x,a.y,f.x,f.y)&&m(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function a(e,t,i){var s=e;do{var n=s.prev,a=s.next.next;!x(n,a)&&b(n,s,s.next,a)&&T(n,a)&&T(a,n)&&(t.push(n.i/i),t.push(s.i/i),t.push(a.i/i),P(s),P(s.next),s=e=a),s=s.next}while(s!==e);return r(s)}function o(e,t,s,n,a,o){var l=e;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&v(l,u)){var c=S(l,u);return l=r(l,l.next),c=r(c,c.next),i(l,t,s,n,a,o),void i(c,t,s,n,a,o)}u=u.next}l=l.next}while(l!==e)}function l(e,i,s,n){var a,o,l,c=[];for(a=0,o=i.length;a<o;a++)(l=t(e,i[a]*n,a<o-1?i[a+1]*n:e.length,n,!1))===l.next&&(l.steiner=!0),c.push(f(l));for(c.sort(u),a=0;a<c.length;a++)s=r(s=h(c[a],s),s.next);return s}function u(e,t){return e.x-t.x}function c(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function h(e,t){var i=function(e,t){var r,i=t,s=e.x,n=e.y,a=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var o=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=s&&o>a){if(a=o,o===s){if(n===i.y)return i;if(n===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(s===a)return r;var l,u=r,c=r.x,h=r.y,y=1/0;i=r;do{s>=i.x&&i.x>=c&&s!==i.x&&g(n<h?s:a,n,c,h,n<h?a:s,n,i.x,i.y)&&(l=Math.abs(n-i.y)/(s-i.x),T(i,e)&&(l<y||l===y&&(i.x>r.x||i.x===r.x&&p(r,i)))&&(r=i,y=l)),i=i.next}while(i!==u);return r}(e,t);if(!i)return t;var s=S(i,e),n=r(i,i.next);let a=c(s);return r(a,a.next),n=c(n),c(t===i?n:t)}function p(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}function y(e,t,r,i){var s=e;do{null===s.z&&(s.z=d(s.x,s.y,t,r,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){var t,r,i,s,n,a,o,l,u=1;do{for(r=e,e=null,n=null,a=0;r;){for(a++,i=r,o=0,t=0;t<u&&(o++,i=i.nextZ);t++);for(l=u;o>0||l>0&&i;)0!==o&&(0===l||!i||r.z<=i.z)?(s=r,r=r.nextZ,o--):(s=i,i=i.nextZ,l--),n?n.nextZ=s:e=s,s.prevZ=n,n=s;r=i}n.nextZ=null,u*=2}while(a>1)}(s)}function d(e,t,r,i,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function g(e,t,r,i,s,n,a,o){return(s-a)*(t-o)-(e-a)*(n-o)>=0&&(e-a)*(i-o)-(r-a)*(t-o)>=0&&(r-a)*(n-o)-(s-a)*(i-o)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&b(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(T(e,t)&&T(t,e)&&function(e,t){var r=e,i=!1,s=(e.x+t.x)/2,n=(e.y+t.y)/2;do{r.y>n!=r.next.y>n&&r.next.y!==r.y&&s<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||x(e,t)&&m(e.prev,e,e.next)>0&&m(t.prev,t,t.next)>0)}function m(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,r,i){var s=_(m(e,t,r)),n=_(m(e,t,i)),a=_(m(r,i,e)),o=_(m(r,i,t));return s!==n&&a!==o||!(0!==s||!w(e,r,t))||!(0!==n||!w(e,i,t))||!(0!==a||!w(r,e,i))||!(0!==o||!w(r,t,i))}function w(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function _(e){return e>0?1:e<0?-1:0}function T(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function S(e,t){var r=new L(e.i,e.x,e.y),i=new L(t.i,t.x,t.y),s=e.next,n=t.prev;return e.next=t,t.prev=e,r.next=s,s.prev=r,i.next=r,r.prev=i,n.next=i,i.prev=n,i}function V(e,t,r,i){var s=new L(e,t,r);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function P(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function L(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(e,t,r,i){for(var s=0,n=t,a=r-i;n<r;n+=i)s+=(e[a]-e[n])*(e[n+1]+e[a+1]),a=n;return s}return e.deviation=function(e,t,r,i){var s=t&&t.length,n=s?t[0]*r:e.length,a=Math.abs(I(e,0,n,r));if(s)for(var o=0,l=t.length;o<l;o++){var u=t[o]*r,c=o<l-1?t[o+1]*r:e.length;a-=Math.abs(I(e,u,c,r))}var h=0;for(o=0;o<i.length;o+=3){var p=i[o]*r,y=i[o+1]*r,d=i[o+2]*r;h+=Math.abs((e[p]-e[d])*(e[y+1]-e[p+1])-(e[p]-e[y])*(e[d+1]-e[p+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,s=0;s<e.length;s++){for(var n=0;n<e[s].length;n++)for(var a=0;a<t;a++)r.vertices.push(e[s][n][a]);s>0&&(i+=e[s-1].length,r.holes.push(i))}return r},e}())&&(i.exports=s);const a=n.exports})),t.register("iqtPh",(function(t,r){e(t.exports,"DECLUTTER_TILES",(function(){return i})),e(t.exports,"COLLISION_GRID_CELL_SIZE",(function(){return s})),e(t.exports,"DECLUTTER_BUDGET",(function(){return n})),e(t.exports,"FADE_DURATION",(function(){return a}));const i=!0,s=32,n=1.5,a=200}));
//# sourceMappingURL=ImageryTileLayerView2D.e047616b.js.map
