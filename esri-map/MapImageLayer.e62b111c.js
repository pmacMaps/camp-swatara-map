var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;e.register("8aVVa",(function(r,t){var i,a,o,s,l;i=r.exports,Object.defineProperty(i,"__esModule",{value:!0,configurable:!0}),a=r.exports,o="default",s=function(){return V},Object.defineProperty(a,o,{get:s,set:l,enumerable:!0,configurable:!0});var n=e("j6uz9"),p=e("bYA0c"),u=e("kURdk"),y=e("bPmsI"),d=e("8Y9g8"),c=e("lq7ZL"),h=e("1CpCt"),m=e("2IJVS"),g=e("lHg4e"),f=e("hTI69");e("aX9sh"),e("5HTPH");var b=e("gHCNy"),v=e("bzBbJ"),S=e("qA6zg"),x=e("g9601"),I=e("74iZY"),w=e("2WnyR"),O=e("bxT91"),P=e("iGP99"),_=e("bJ9E7"),M=e("g4KDY"),T=e("lPKJW"),L=e("90xN9"),E=e("8u5kg"),A=e("ctxhN"),R=e("54ioU"),J=e("eOpMC"),j=e("5lb2Y"),N=e("lsqS0"),q=e("6rQbA"),U=e("lixLM"),k=e("zvJvP"),z=e("jAugz"),F=e("8rwj2"),C=e("5UwzK");let H=class extends((0,L.BlendLayer)((0,q.TemporalLayer)((0,j.ScaleRangeLayer)((0,N.SublayersOwner)((0,M.ArcGISMapService)((0,T.ArcGISService)((0,A.OperationalLayer)((0,R.PortalLayer)((0,m.MultiOriginJSONMixin)((0,J.RefreshableLayer)((0,_.APIKeyMixin)((0,E.CustomParametersMixin)((0,d.HandleOwnerMixin)(P.default)))))))))))))){normalizeCtorArgs(e,r){return"string"==typeof e?{url:e,...r}:e}load(e){const r=(0,h.isSome)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(g.throwIfAbortError).then((()=>this._fetchService(r)))),Promise.resolve(this)}readImageFormat(e,r){const t=r.supportedImageFormatTypes;return t&&t.indexOf("PNG32")>-1?"png32":"png24"}writeSublayers(e,r,t,i){if(!this.loaded||!e)return;const a=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let o=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=(0,I.nameToId)(i.origin);if(e===I.OriginId.PORTAL_ITEM){const e=this.createSublayersForOrigin("service").sublayers;o=(0,F.shouldWriteSublayerStructure)(a,e,I.OriginId.SERVICE)}else if(e>I.OriginId.PORTAL_ITEM){const e=this.createSublayersForOrigin("portal-item");o=(0,F.shouldWriteSublayerStructure)(a,e.sublayers,(0,I.nameToId)(e.origin))}}const s=[],l={writeSublayerStructure:o,...i};let n=o;a.forEach((e=>{const r=e.write({},l);s.push(r),n=n||"user"===e.originOf("visible")})),s.some((e=>Object.keys(e).length>1))&&(r.layers=s),n&&(r.visibleLayers=a.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,r,t,i){const a=i&&i.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const o=new(0,k.ExportImageParameters)({layer:this,floors:null==i?void 0:i.floors,scale:(0,O.getScale)({extent:e,width:r})*a}),s=o.toJSON();o.destroy();const l=!i||!i.rotation||this.version<10.3?{}:{rotation:-i.rotation},n=e&&e.spatialReference,p=n.wkid||JSON.stringify(n.toJSON());s.dpi*=a;const u={};if(null!=i&&i.timeExtent){const{start:e,end:r}=i.timeExtent.toJSON();u.time=e&&r&&e===r?""+e:`${null==e?"null":e},${null==r?"null":r}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(u.time="null,null");return{bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:p,imageSR:p,size:r+","+t,...s,...l,...u}}async fetchImage(e,r,t,i){var a;const o={responseType:"image",signal:null!=(a=null==i?void 0:i.signal)?a:null,query:{...this.parsedUrl.query,...this.createExportImageParameters(e,r,t,i),f:"image",...this.refreshParameters,...this.customParameters,token:this.apiKey}},s=this.parsedUrl.path+"/export";return null==o.query.dynamicLayers||this.capabilities.exportMap.supportsDynamicLayers?(0,p.default)(s,o).then((e=>e.data)).catch((e=>{if((0,g.isAbortError)(e))throw e;throw new(0,y.default)("mapimagelayer:image-fetch-error",`Unable to load image: ${s}`,{error:e})})):Promise.reject(new(0,y.default)("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:o.query}))}async fetchRecomputedExtents(e={}){const r={...e,query:{returnUpdates:!0,f:"json",...this.customParameters,token:this.apiKey}},{data:t}=await(0,p.default)(this.url,r),{extent:i,fullExtent:a,timeExtent:o}=t,s=i||a;return{fullExtent:s&&w.default.fromJSON(s),timeExtent:o&&u.default.fromJSON({start:o[0],end:o[1]})}}loadAll(){return(0,c.loadAll)(this,(e=>{e(this.allSublayers)}))}serviceSupportsSpatialReference(e){return(0,C.serviceSupportsSpatialReference)(this,e)}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});const{data:r,ssl:t}=await(0,p.default)(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},signal:e});t&&(this.url=this.url.replace(/^http:/i,"https:")),this.sourceJSON=r,this.read(r,{origin:"service",url:this.parsedUrl})}constructor(...e){super(...e),this.datesInUnknownTimezone=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat="png24",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.isReference=null,this.labelsVisible=!1,this.operationalLayerType="ArcGISMapServiceLayer",this.sourceJSON=null,this.sublayers=null,this.type="map-image",this.url=null}};(0,n._)([(0,f.property)({type:Boolean})],H.prototype,"datesInUnknownTimezone",void 0),(0,n._)([(0,f.property)()],H.prototype,"dpi",void 0),(0,n._)([(0,f.property)()],H.prototype,"gdbVersion",void 0),(0,n._)([(0,f.property)()],H.prototype,"imageFormat",void 0),(0,n._)([(0,v.reader)("imageFormat",["supportedImageFormatTypes"])],H.prototype,"readImageFormat",null),(0,n._)([(0,f.property)({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],H.prototype,"imageMaxHeight",void 0),(0,n._)([(0,f.property)({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],H.prototype,"imageMaxWidth",void 0),(0,n._)([(0,f.property)()],H.prototype,"imageTransparency",void 0),(0,n._)([(0,f.property)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],H.prototype,"isReference",void 0),(0,n._)([(0,f.property)({json:{read:!1,write:!1}})],H.prototype,"labelsVisible",void 0),(0,n._)([(0,f.property)({type:["ArcGISMapServiceLayer"]})],H.prototype,"operationalLayerType",void 0),(0,n._)([(0,f.property)({json:{read:!1,write:!1}})],H.prototype,"popupEnabled",void 0),(0,n._)([(0,f.property)()],H.prototype,"sourceJSON",void 0),(0,n._)([(0,f.property)({json:{write:{ignoreOrigin:!0}}})],H.prototype,"sublayers",void 0),(0,n._)([(0,x.writer)("sublayers",{layers:{type:[z.default]},visibleLayers:{type:[b.Integer]}})],H.prototype,"writeSublayers",null),(0,n._)([(0,f.property)({type:["show","hide","hide-children"]})],H.prototype,"listMode",void 0),(0,n._)([(0,f.property)({json:{read:!1},readOnly:!0,value:"map-image"})],H.prototype,"type",void 0),(0,n._)([(0,f.property)(U.url)],H.prototype,"url",void 0),H=(0,n._)([(0,S.subclass)("esri.layers.MapImageLayer")],H);const V=H}));
//# sourceMappingURL=MapImageLayer.e62b111c.js.map
