!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}var n=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;n.register("7gr2y",(function(r,a){var i;i=r.exports,Object.defineProperty(i,"__esModule",{value:!0,configurable:!0}),t(r.exports,"ElevationQuery",(function(){return k})),t(r.exports,"GeometryDescriptor",(function(){return w})),t(r.exports,"getFinestLodIndex",(function(){return _})),t(r.exports,"default",(function(){return k}));var o=n("8TSCy"),l=n("2TvXO"),s=n("dqkq5"),u=n("kyj08"),c=n("7qybv"),f=n("10vEZ"),v=n("5vzSQ"),p=n("eaHvJ"),h=n("d1Fqh"),y=n("95Tg0"),d=n("7RvA5"),m=n("8TwEW"),x=n("4UKmJ"),T=n("3ZmPA"),k=function(){"use strict";function t(){o.classCallCheck(this,t)}return o.createClass(t,[{key:"queryAll",value:function(t,n,r){var a=this;return o.asyncToGenerator(e(l).mark((function i(){var s,c,f,v,p;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=r&&r.ignoreInvisibleLayers?t.filter((function(e){return e.visible})):t.slice()).length){e.next=2;break}throw new(0,u.default)("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");case 2:return s=w.fromGeometry(n),c=!1,r&&r.returnSampleInfo||(c=!0),f=o.objectSpread({},C,r,{returnSampleInfo:!0}),e.next=8,a.query(t[t.length-1],s,f);case 8:return v=e.sent,e.next=11,a._queryAllContinue(t,v,f);case 11:return p=e.sent,e.abrupt("return",(p.geometry=p.geometry.export(),c&&delete p.sampleInfo,p));case 13:case"end":return e.stop()}}),i)})))()}},{key:"query",value:function(t,n,r){var a=this;return o.asyncToGenerator(e(l).mark((function i(){var s,c,f;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new(0,u.default)("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");case 2:if(n&&(n instanceof w||"point"===n.type||"multipoint"===n.type||"polyline"===n.type)){e.next=4;break}throw new(0,u.default)("elevation-query:invalid-geometry","Only point, polyline and multipoint geometries can be used to query elevation");case 4:return s=o.objectSpread({},C,r),c=new b(t,n.spatialReference,s),f=s.signal,e.next=7,t.load({signal:f});case 7:return e.next=9,a._createGeometryDescriptor(c,n,f);case 9:return e.next=11,a._selectTiles(c,f);case 11:return e.next=13,a._populateElevationTiles(c,f);case 13:return a._sampleGeometryWithElevation(c),e.abrupt("return",(e.sent,e.sent,e.sent,e.sent,a._createQueryResult(c,f)));case 15:case"end":return e.stop()}}),i)})))()}},{key:"createSampler",value:function(t,n,r){var a=this;return o.asyncToGenerator(e(l).mark((function i(){var s;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new(0,u.default)("elevation-query:invalid-layer","Elevation queries require an elevation layer to fetch tiles from");case 2:if(n&&"extent"===n.type){e.next=4;break}throw new(0,u.default)("elevation-query:invalid-extent","Invalid or undefined extent");case 4:return s=o.objectSpread({},C,r),e.abrupt("return",a._createSampler(t,n,s));case 6:case"end":return e.stop()}}),i)})))()}},{key:"createSamplerAll",value:function(t,n,r){var a=this;return o.asyncToGenerator(e(l).mark((function i(){var s,c;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=r&&r.ignoreInvisibleLayers?t.filter((function(e){return e.visible})):t.slice()).length){e.next=2;break}throw new(0,u.default)("elevation-query:invalid-layer","Elevation queries require at least one elevation layer to fetch tiles from");case 2:if(n&&"extent"===n.type){e.next=4;break}throw new(0,u.default)("elevation-query:invalid-extent","Invalid or undefined extent");case 4:return s=o.objectSpread({},C,r,{returnSampleInfo:!0}),e.next=7,a._createSampler(t[t.length-1],n,s);case 7:return c=e.sent,e.abrupt("return",a._createSamplerAllContinue(t,n,c,s));case 9:case"end":return e.stop()}}),i)})))()}},{key:"_createSampler",value:function(t,n,r,a){var i=this;return o.asyncToGenerator(e(l).mark((function o(){var s,u,c,f;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.signal,e.next=3,t.load({signal:s});case 3:if(u=n.spatialReference,c=t.tileInfo.spatialReference,e.t0=u.equals(c),e.t0){e.next=9;break}return e.next=8,(0,d.initializeProjection)([{source:u,dest:c}],{signal:s});case 8:n=(0,d.project)(n,c);case 9:return f=new R(t,n,r,a),e.next=12,i._selectTiles(f,s);case 12:return e.next=14,i._populateElevationTiles(f,s);case 14:return e.abrupt("return",(e.sent,e.sent,new(0,x.MultiTileElevationSampler)(f.elevationTiles,f.layer.tileInfo,f.options.noDataValue)));case 15:case"end":return e.stop()}}),o)})))()}},{key:"_createSamplerAllContinue",value:function(t,n,r,a){var i=this;return o.asyncToGenerator(e(l).mark((function o(){var s,u,c,f;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.pop(),t.length){e.next=2;break}return e.abrupt("return",r);case 2:return s=r.samplers.map((function(e){return(0,m.fromExtent)(e.extent)})),e.next=5,i._createSampler(t[t.length-1],n,a,s);case 5:if(0!==(u=e.sent).samplers.length){e.next=8;break}return e.abrupt("return",r);case 8:return c=r.samplers.concat(u.samplers),f=new(0,x.MultiTileElevationSampler)(c,a.noDataValue),e.abrupt("return",i._createSamplerAllContinue(t,n,f,a));case 10:case"end":return e.stop()}}),o)})))()}},{key:"_queryAllContinue",value:function(t,n,r){var a=this;return o.asyncToGenerator(e(l).mark((function i(){var o,s,u,c,f,v,p,h;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=t.pop(),s=n.geometry.coordinates,u=[],c=[],f=0;f<s.length;f++)(v=n.sampleInfo[f]).demResolution>=0?v.source||(v.source=o):t.length&&(u.push(s[f]),c.push(f));if(t.length&&0!==u.length){e.next=4;break}return e.abrupt("return",n);case 4:return p=n.geometry.clone(u),e.next=7,a.query(t[t.length-1],p,r);case 7:return h=e.sent,e.abrupt("return",(c.forEach((function(e,t){s[e].z=h.geometry.coordinates[t].z,n.sampleInfo[e].demResolution=h.sampleInfo[t].demResolution})),a._queryAllContinue(t,n,r)));case 9:case"end":return e.stop()}}),i)})))()}},{key:"_createQueryResult",value:function(t,n){var r=this;return o.asyncToGenerator(e(l).mark((function a(){var i;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.geometry.project(t.outSpatialReference,n);case 2:return e.t0=e.sent.export(),e.t1=t.options.noDataValue,i={geometry:e.t0,noDataValue:e.t1},e.abrupt("return",(t.options.returnSampleInfo&&(i.sampleInfo=r._extractSampleInfo(t)),t.geometry.coordinates.forEach((function(e){e.tile=null,e.elevationTile=null})),i));case 6:case"end":return e.stop()}}),a)})))()}},{key:"_createGeometryDescriptor",value:function(t,n,r){return o.asyncToGenerator(e(l).mark((function a(){var i,o;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.layer.tileInfo.spatialReference,!(n instanceof w)){e.next=8;break}return e.next=5,n.project(o,r);case 5:i=e.sent,e.next=11;break;case 8:return e.next=10,(0,d.initializeProjection)([{source:n.spatialReference,dest:o}],{signal:r});case 10:i=(0,d.project)(n,o);case 11:if(i){e.next=13;break}throw new(0,u.default)("elevation-query:spatial-reference-mismatch","Cannot query elevation in '".concat(n.spatialReference.wkid,"' on an elevation service in '").concat(o.wkid,"'"));case 13:t.geometry=w.fromGeometry(i);case 14:case"end":return e.stop()}}),a)})))()}},{key:"_selectTiles",value:function(t,n){var r=this;return o.asyncToGenerator(e(l).mark((function a(){var i;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.options.demResolution,"geometry"===t.type&&r._preselectOutsideLayerExtent(t),"number"!=typeof i){e.next=5;break}r._selectTilesClosestResolution(t),e.next=14;break;case 5:if("finest-contiguous"!==i){e.next=10;break}return e.next=8,r._selectTilesFinestContiguous(t,n);case 8:e.next=14;break;case 10:if("auto"===i){e.next=12;break}throw new(0,u.default)("elevation-query:invalid-dem-resolution","Invalid dem resolution value '".concat(i,'\', expected a number, "finest-contiguous" or "auto"'));case 12:return e.next=14,r._selectTilesAuto(t,n);case 14:case"end":return e.stop()}}),a)})))()}},{key:"_preselectOutsideLayerExtent",value:function(e){if(!(0,c.isNone)(e.layer.fullExtent)){var t=new(0,T.ElevationTile)(null);t.sample=function(){return e.options.noDataValue},e.outsideExtentTile=t;var n=e.layer.fullExtent;e.geometry.coordinates.forEach((function(e){var r=e.x,a=e.y;(r<n.xmin||r>n.xmax||a<n.ymin||a>n.ymax)&&(e.elevationTile=t)}))}}},{key:"_selectTilesClosestResolution",value:function(e){var t=e.layer.tileInfo,n=this._findNearestDemResolutionLODIndex(t,e.options.demResolution);e.selectTilesAtLOD(n)}},{key:"_findNearestDemResolutionLODIndex",value:function(e,t){for(var n=t/(0,v.getMetersPerUnitForSR)(e.spatialReference),r=e.lods[0],a=0,i=1;i<e.lods.length;i++){var o=e.lods[i];Math.abs(o.resolution-n)<Math.abs(r.resolution-n)&&(r=o,a=i)}return a}},{key:"_selectTilesFinestContiguous",value:function(t,n){var r=this;return o.asyncToGenerator(e(l).mark((function a(){var i;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=_(t.layer.tileInfo,t.options.minDemResolution),e.next=3,r._selectTilesFinestContiguousAt(t,i,n);case 3:case"end":return e.stop()}}),a)})))()}},{key:"_selectTilesFinestContiguousAt",value:function(t,n,r){var a=this;return o.asyncToGenerator(e(l).mark((function i(){var o,s,c;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.layer,t.selectTilesAtLOD(n),!(n<0)){e.next=3;break}return e.abrupt("return");case 3:if(s=o.tilemapCache,c=t.getTilesToFetch(),e.prev=4,!s){e.next=10;break}return e.next=8,(0,f.whenOrAbort)(Promise.all(c.map((function(e){return s.fetchAvailability(e.level,e.row,e.col,{signal:r})}))),r);case 8:e.next=14;break;case 10:return e.next=12,a._populateElevationTiles(t,r);case 12:if(e.sent,t.allElevationTilesFetched()){e.next=14;break}throw t.clearElevationTiles(),new(0,u.default)("elevation-query:has-unavailable-tiles");case 14:e.next=21;break;case 16:return e.prev=16,e.t0=e.catch(4),(0,f.throwIfAbortError)(e.t0),e.next=21,a._selectTilesFinestContiguousAt(t,n-1,r);case 21:case"end":return e.stop()}}),i,null,[[4,16]])})))()}},{key:"_populateElevationTiles",value:function(t,n){return o.asyncToGenerator(e(l).mark((function r(){var a,i,s,u,v;return e(l).wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=t.getTilesToFetch(),i={},s=t.options.cache,u=t.options.noDataValue,v=a.map(function(){var r=o.asyncToGenerator(e(l).mark((function r(a){var o,f,v;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="".concat(t.layer.uid,":").concat(a.id,":").concat(u),f=(0,c.isSome)(s)?s.get(o):null,!(0,c.isSome)(f)){e.next=6;break}e.t0=f,e.next=9;break;case 6:return e.next=8,t.layer.fetchTile(a.level,a.row,a.col,{noDataValue:u,signal:n});case 8:e.t0=e.sent;case 9:v=e.t0,(0,c.isSome)(s)&&s.put(o,v),i[a.id]=new(0,T.ElevationTile)(a,v);case 11:case"end":return e.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()),r.next=3,(0,f.whenOrAbort)((0,f.eachAlways)(v),n);case 3:t.populateElevationTiles(i);case 4:case"end":return r.stop()}}),r)})))()}},{key:"_selectTilesAuto",value:function(t,n){var r=this;return o.asyncToGenerator(e(l).mark((function a(){var i,u,c,v;return e(l).wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(r._selectTilesAutoFinest(t),r._reduceTilesForMaximumRequests(t),i=t.layer.tilemapCache){a.next=4;break}return a.abrupt("return",r._selectTilesAutoPrefetchUpsample(t,n));case 4:return u=t.getTilesToFetch(),c={},v=u.map(function(){var t=o.asyncToGenerator(e(l).mark((function t(r){var a,o;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={id:null,level:0,row:0,col:0,extent:(0,m.create)()},e.next=3,(0,s.result)(i.fetchAvailabilityUpsample(r.level,r.row,r.col,a,{signal:n}));case 3:!1===(o=e.sent).ok?(0,f.throwIfAbortError)(o.error):c[r.id]=a;case 5:case"end":return e.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),a.next=7,(0,f.whenOrAbort)(Promise.all(v),n);case 7:t.remapTiles(c);case 8:case"end":return a.stop()}}),a)})))()}},{key:"_reduceTilesForMaximumRequests",value:function(e){var t=e.layer.tileInfo,n=0,r={},a=function(e){e.id in r?r[e.id]++:(r[e.id]=1,n++)},i=function(e){var t=r[e.id];1===t?(delete r[e.id],n--):r[e.id]=t-1};e.forEachTileToFetch(a,i);for(var o=!0;o&&(o=!1,e.forEachTileToFetch((function(r){n<=e.options.maximumAutoTileRequests||(i(r),t.upsampleTile(r)&&(o=!0),a(r))}),i),o););}},{key:"_selectTilesAutoFinest",value:function(e){var t=_(e.layer.tileInfo,e.options.minDemResolution);e.selectTilesAtLOD(t,e.options.maximumAutoTileRequests)}},{key:"_selectTilesAutoPrefetchUpsample",value:function(t,n){var r=this;return o.asyncToGenerator(e(l).mark((function a(){var i,o;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.layer.tileInfo,e.next=3,r._populateElevationTiles(t,n);case 3:if(o=!1,t.forEachTileToFetch((function(e,t){i.upsampleTile(e)?o=!0:t()})),e.t0=o,!e.t0){e.next=9;break}return e.next=9,r._selectTilesAutoPrefetchUpsample(t,n);case 9:case"end":return e.stop()}}),a)})))()}},{key:"_sampleGeometryWithElevation",value:function(e){e.geometry.coordinates.forEach((function(t){var n=t.elevationTile,r=e.options.noDataValue;if(n){var a=n.sample(t.x,t.y);(0,c.isSome)(a)?r=a:t.elevationTile=null}t.z=r}))}},{key:"_extractSampleInfo",value:function(e){var t=e.layer.tileInfo,n=(0,v.getMetersPerUnitForSR)(t.spatialReference);return e.geometry.coordinates.map((function(r){var a=-1;return r.elevationTile&&r.elevationTile!==e.outsideExtentTile&&(a=t.lodAt(r.elevationTile.tile.level).resolution*n),{demResolution:a}}))}}]),t}(),w=function(){"use strict";function t(){o.classCallCheck(this,t)}return o.createClass(t,[{key:"export",value:function(){return this._exporter(this.coordinates,this.spatialReference)}},{key:"clone",value:function(e){var n=this,r=new t;return r.geometry=this.geometry,r.spatialReference=this.spatialReference,r.coordinates=e||this.coordinates.map((function(e){return n._cloneCoordinate(e)})),r._exporter=this._exporter,r}},{key:"project",value:function(t,n){var r=this;return o.asyncToGenerator(e(l).mark((function a(){var i,o,s,u;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.spatialReference.equals(t)){e.next=2;break}return e.abrupt("return",r.clone());case 2:return e.next=4,(0,d.initializeProjection)([{source:r.spatialReference,dest:t}],{signal:n});case 4:if(i=new(0,p.default)({spatialReference:r.spatialReference,points:r.coordinates.map((function(e){return[e.x,e.y]}))}),o=(0,d.project)(i,t)){e.next=7;break}return e.abrupt("return",null);case 7:return s=r.coordinates.map((function(e,t){var n=r._cloneCoordinate(e),a=o.points[t];return n.x=a[0],n.y=a[1],n})),u=r.clone(s),e.abrupt("return",(u.spatialReference=t,u));case 9:case"end":return e.stop()}}),a)})))()}},{key:"_cloneCoordinate",value:function(e){return{x:e.x,y:e.y,z:e.z,m:e.m,tile:null,elevationTile:null}}}],[{key:"fromGeometry",value:function(e){var n=new t;if(n.geometry=e,n.spatialReference=e.spatialReference,e instanceof t)n.coordinates=e.coordinates.map((function(e){return n._cloneCoordinate(e)})),n._exporter=function(t,n){var r=e.clone(t);return r.spatialReference=n,r};else switch(e.type){case"point":var r=e,a=r.hasZ,i=r.hasM;n.coordinates=a&&i?[{x:r.x,y:r.y,z:r.z,m:r.m}]:a?[{x:r.x,y:r.y,z:r.z}]:i?[{x:r.x,y:r.y,m:r.m}]:[{x:r.x,y:r.y}],n._exporter=function(t,n){return e.hasM?new(0,h.default)(t[0].x,t[0].y,t[0].z,t[0].m,n):new(0,h.default)(t[0].x,t[0].y,t[0].z,n)};break;case"multipoint":var o=e,l=o.hasZ,s=o.hasM;n.coordinates=l&&s?o.points.map((function(e){return{x:e[0],y:e[1],z:e[2],m:e[3]}})):l?o.points.map((function(e){return{x:e[0],y:e[1],z:e[2]}})):s?o.points.map((function(e){return{x:e[0],y:e[1],m:e[2]}})):o.points.map((function(e){return{x:e[0],y:e[1]}})),n._exporter=function(t,n){return e.hasM?new(0,p.default)({points:t.map((function(e){return[e.x,e.y,e.z,e.m]})),hasZ:!0,hasM:!0,spatiaReference:n}):new(0,p.default)(t.map((function(e){return[e.x,e.y,e.z]})),n)};break;case"polyline":var u=e,c=[],f=[],v=e.hasZ,d=e.hasM,m=0,x=!0,T=!1,k=void 0,w=!0,g=!1,b=void 0,R=!0,_=!1,C=void 0,E=!0,S=!1,q=void 0,A=!0,I=!1,D=void 0;try{for(var M,F=u.paths[Symbol.iterator]();!(A=(M=F.next()).done);A=!0){var z=M.value;if(f.push([m,m+z.length]),m+=z.length,v&&d)try{for(var G,j=z[Symbol.iterator]();!(x=(G=j.next()).done);x=!0){var O=G.value;c.push({x:O[0],y:O[1],z:O[2],m:O[3]})}}catch(e){T=!0,k=e}finally{try{x||null==j.return||j.return()}finally{if(T)throw k}}else if(v)try{for(var V,P=z[Symbol.iterator]();!(w=(V=P.next()).done);w=!0){var L=V.value;c.push({x:L[0],y:L[1],z:L[2]})}}catch(e){g=!0,b=e}finally{try{w||null==P.return||P.return()}finally{if(g)throw b}}else if(d)try{for(var N,Z=z[Symbol.iterator]();!(R=(N=Z.next()).done);R=!0){var U=N.value;c.push({x:U[0],y:U[1],m:U[2]})}}catch(e){_=!0,C=e}finally{try{R||null==Z.return||Z.return()}finally{if(_)throw C}}else try{for(var W,Q=z[Symbol.iterator]();!(E=(W=Q.next()).done);E=!0){var J=W.value;c.push({x:J[0],y:J[1]})}}catch(e){S=!0,q=e}finally{try{E||null==Q.return||Q.return()}finally{if(S)throw q}}}}catch(e){I=!0,D=e}finally{try{A||null==F.return||F.return()}finally{if(I)throw D}}n.coordinates=c,n._exporter=function(t,n){var r=e.hasM?t.map((function(e){return[e.x,e.y,e.z,e.m]})):t.map((function(e){return[e.x,e.y,e.z]})),a=f.map((function(e){return r.slice(e[0],e[1])}));return new(0,y.default)({paths:a,hasM:e.hasM,hasZ:!0,spatialReference:n})}}return n}}]),t}(),g=function e(t,n){"use strict";o.classCallCheck(this,e),this.layer=t,this.options=n},b=function(e){"use strict";o.inherits(n,e);var t=o.createSuper(n);function n(e,r,a){var i;return o.classCallCheck(this,n),(i=t.call(this,e,a)).outSpatialReference=r,i.type="geometry",o.possibleConstructorReturn(i)}return o.createClass(n,[{key:"selectTilesAtLOD",value:function(e){if(e<0)this.geometry.coordinates.forEach((function(e){return e.tile=null}));else{var t=this.layer.tileInfo,n=t.lods[e].level;this.geometry.coordinates.forEach((function(e){e.tile=t.tileAt(n,e.x,e.y)}))}}},{key:"allElevationTilesFetched",value:function(){return!this.geometry.coordinates.some((function(e){return!e.elevationTile}))}},{key:"clearElevationTiles",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.geometry.coordinates[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value;i.elevationTile!==this.outsideExtentTile&&(i.elevationTile=null)}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:"populateElevationTiles",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.geometry.coordinates[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;!o.elevationTile&&o.tile&&(o.elevationTile=e[o.tile.id])}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"remapTiles",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.geometry.coordinates[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;o.tile=e[o.tile.id]}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"getTilesToFetch",value:function(){var e={},t=[],n=!0,r=!1,a=void 0;try{for(var i,o=this.geometry.coordinates[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var l=i.value,s=l.tile;l.elevationTile||!l.tile||e[s.id]||(e[s.id]=s,t.push(s))}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return t}},{key:"forEachTileToFetch",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=function(t,n){var r=n.value;r.tile&&!r.elevationTile&&e(r.tile,(function(){return r.tile=null}))},o=this.geometry.coordinates[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)i(0,a)}catch(e){n=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw r}}}}]),n}(g),R=function(e){"use strict";o.inherits(n,e);var t=o.createSuper(n);function n(e,r,a,i){var l;return o.classCallCheck(this,n),(l=t.call(this,e,a)).type="extent",l.elevationTiles=[],l.candidateTiles=[],l.fetchedCandidates=new Set,l.extent=r.intersection(e.fullExtent),l.maskExtents=i,o.possibleConstructorReturn(l)}return o.createClass(n,[{key:"selectTilesAtLOD",value:function(e,t){var n=this._maximumLodForRequests(t),r=Math.min(n,e);r<0?this.candidateTiles.length=0:this._selectCandidateTilesCoveringExtentAt(r)}},{key:"_maximumLodForRequests",value:function(e){var t=this.layer.tileInfo;if(!e)return t.lods.length-1;var n=this.extent;if((0,c.isNone)(n))return-1;for(var r=t.lods.length-1;r>=0;r--){var a=t.lods[r],i=a.resolution*t.size[0],o=a.resolution*t.size[1];if(Math.ceil(n.width/i)*Math.ceil(n.height/o)<=e)return r}return-1}},{key:"allElevationTilesFetched",value:function(){return this.candidateTiles.length===this.elevationTiles.length}},{key:"clearElevationTiles",value:function(){this.elevationTiles.length=0,this.fetchedCandidates.clear()}},{key:"populateElevationTiles",value:function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=this.candidateTiles[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value,l=e[o.id];l&&(this.fetchedCandidates.add(o),this.elevationTiles.push(l))}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}},{key:"remapTiles",value:function(e){this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles.map((function(t){return e[t.id]})))}},{key:"getTilesToFetch",value:function(){return this.candidateTiles}},{key:"forEachTileToFetch",value:function(e,t){var n=this,r=this.candidateTiles;this.candidateTiles=[],r.forEach((function(r){if(n.fetchedCandidates.has(r))t&&t(r);else{var a=!1;e(r,(function(){return a=!0})),a?t&&t(r):n.candidateTiles.push(r)}})),this.candidateTiles=this._uniqueNonOverlappingTiles(this.candidateTiles,t)}},{key:"_uniqueNonOverlappingTiles",value:function(e,t){var n={},r=[],a=!0,i=!1,o=void 0;try{for(var l,s=e[Symbol.iterator]();!(a=(l=s.next()).done);a=!0){var u=l.value;n[u.id]?t&&t(u):(n[u.id]=u,r.push(u))}}catch(e){i=!0,o=e}finally{try{a||null==s.return||s.return()}finally{if(i)throw o}}var c=r.sort((function(e,t){return e.level-t.level}));return c.filter((function(e,n){for(var r=0;r<n;r++)if((0,m.contains)(c[r].extent,e.extent))return t&&t(e),!1;return!0}))}},{key:"_selectCandidateTilesCoveringExtentAt",value:function(e){this.candidateTiles.length=0;var t=this.extent;if(!(0,c.isNone)(t))for(var n=this.layer.tileInfo,r=n.lods[e],a=n.tileAt(r.level,t.xmin,t.ymin),i=r.resolution*n.size[0],o=r.resolution*n.size[1],l=Math.ceil((t.xmax-a.extent[0])/i),s=Math.ceil((t.ymax-a.extent[1])/o),u=0;u<s;u++)for(var f=0;f<l;f++){var v={id:null,level:a.level,row:a.row-u,col:a.col+f};n.updateTileInfo(v),this._tileIsMasked(v)||this.candidateTiles.push(v)}}},{key:"_tileIsMasked",value:function(e){return!!this.maskExtents&&this.maskExtents.some((function(t){return(0,m.contains)(t,e.extent)}))}}]),n}(g);function _(e,t){var n=e.lods.length-1;if(t>0){var r=e.lods.findIndex((function(e){return e.resolution<t}));0===r?n=0:r>0&&(n=r-1)}return n}var C={maximumAutoTileRequests:20,noDataValue:0,returnSampleInfo:!1,demResolution:"auto",minDemResolution:0}})),n.register("4UKmJ",(function(e,r){t(e.exports,"MultiTileElevationSampler",(function(){return y}));var a=n("8TSCy");n("2ILM8"),n("2VlWd");var i=n("jHOLN"),o=n("7qybv"),l=n("5vzSQ"),s=n("8TwEW"),u=n("8Iadx"),c=n("eF88h"),f=n("d1Fqh"),v=i.default.getLogger("esri.layers.support.ElevationSampler"),p=function(){"use strict";function e(){a.classCallCheck(this,e)}return a.createClass(e,[{key:"queryElevation",value:function(e){return function(e,t){var n=d(e,t.spatialReference);if(!n)return null;switch(e.type){case"point":r=n,a=t,e.z=(0,o.unwrapOr)(a.elevationAt(r),0);break;case"polyline":!function(e,t,n){m.spatialReference=t.spatialReference;for(var r=e.hasM&&!e.hasZ,a=0;a<e.paths.length;a++)for(var i=e.paths[a],l=t.paths[a],s=0;s<i.length;s++){var u=i[s],c=l[s];m.x=c[0],m.y=c[1],r&&(u[3]=u[2]),u[2]=(0,o.unwrapOr)(n.elevationAt(m),0)}e.hasZ=!0}(e,n,t);break;case"multipoint":!function(e,t,n){m.spatialReference=t.spatialReference;for(var r=e.hasM&&!e.hasZ,a=0;a<e.points.length;a++){var i=e.points[a],l=t.points[a];m.x=l[0],m.y=l[1],r&&(i[3]=i[2]),i[2]=(0,o.unwrapOr)(n.elevationAt(m),0)}e.hasZ=!0}(e,n,t)}var r,a;return e}(e.clone(),this)}},{key:"on",value:function(){return x}},{key:"projectIfRequired",value:function(e,t){return d(e,t)}}]),e}(),h=function(e){"use strict";a.inherits(n,e);var t=a.createSuper(n);function n(e,r,i){var o;a.classCallCheck(this,n),(o=t.call(this)).tile=e,o.noDataValue=i,o.extent=(0,s.toExtent)(e.tile.extent,r.spatialReference);var u=(0,l.getMetersPerUnitForSR)(r.spatialReference),c=r.lodAt(e.tile.level).resolution*u;return o.demResolution={min:c,max:c},a.possibleConstructorReturn(o)}return a.createClass(n,[{key:"spatialReference",get:function(){return this.extent.spatialReference}},{key:"contains",value:function(e){var t=this.projectIfRequired(e,this.spatialReference);return(0,u.extentContainsPoint)(this.extent,t)}},{key:"elevationAt",value:function(e){var t=this.projectIfRequired(e,this.spatialReference);if((0,o.isNone)(t))return null;if(!this.contains(e)){var n=this.extent,r="".concat(n.xmin,", ").concat(n.ymin,", ").concat(n.xmax,", ").concat(n.ymax);return v.warn("#elevationAt()","Point used to sample elevation (".concat(e.x,", ").concat(e.y,") is outside of the sampler extent (").concat(r,")")),this.noDataValue}return this.tile.sample(t.x,t.y)}}]),n}(p),y=function(e){"use strict";a.inherits(n,e);var t=a.createSuper(n);function n(e,r,i){var o,l;a.classCallCheck(this,n),o=t.call(this),"number"==typeof r?(o.noDataValue=r,l=null):(l=r,o.noDataValue=i),o.samplers=l?e.map((function(e){return new h(e,l,o.noDataValue)})):e;var u=o.samplers[0];if(u){o.extent=u.extent.clone();var c=u.demResolution,f=c.min,v=c.max;o.demResolution={min:f,max:v};for(var p=1;p<o.samplers.length;p++){var y=o.samplers[p];o.extent.union(y.extent),o.demResolution.min=Math.min(o.demResolution.min,y.demResolution.min),o.demResolution.max=Math.max(o.demResolution.max,y.demResolution.max)}}else o.extent=(0,s.toExtent)((0,s.create)(),l.spatialReference),o.demResolution={min:0,max:0};return a.possibleConstructorReturn(o)}return a.createClass(n,[{key:"spatialReference",get:function(){return this.extent.spatialReference}},{key:"elevationAt",value:function(e){var t=this.projectIfRequired(e,this.spatialReference);if(!t)return null;var n=!0,r=!1,a=void 0;try{for(var i,o=this.samplers[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var l=i.value;if(l.contains(t))return l.elevationAt(t)}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return v.warn("#elevationAt()","Point used to sample elevation (".concat(e.x,", ").concat(e.y,") is outside of the sampler")),this.noDataValue}}]),n}(p);function d(e,t){if((0,o.isNone)(e))return null;var n=e.spatialReference;if(n.equals(t))return e;var r=(0,c.project)(e,t);return r||v.error("Cannot project geometry spatial reference (wkid:".concat(n.wkid,") to elevation sampler spatial reference (wkid:").concat(t.wkid,")")),r}var m=new(0,f.default),x={remove:function(){}}})),n.register("3ZmPA",(function(e,r){t(e.exports,"ElevationTile",(function(){return o}));var a=n("8TSCy"),i=n("7qybv"),o=function(){"use strict";function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(a.classCallCheck(this,e),this.tile=t,(0,i.isSome)(n)){var r=t.extent;this.samplerData={pixelData:n.values,width:n.width,height:n.height,safeWidth:.99999999*(n.width-1),noDataValue:n.noDataValue,dx:(n.width-1)/(r[2]-r[0]),dy:(n.width-1)/(r[3]-r[1]),x0:r[0],y1:r[3]}}}return a.createClass(e,[{key:"sample",value:function(e,t){if(!(0,i.isNone)(this.samplerData)){var n=this.samplerData,r=n.safeWidth,a=n.width,o=n.pixelData,s=n.noDataValue,u=n.dx,c=n.dy,f=n.y1,v=n.x0,p=l(c*(f-t),0,r),h=l(u*(e-v),0,r),y=Math.floor(p),d=Math.floor(h),m=y*a+d,x=m+a,T=o[m],k=o[x],w=o[m+1],g=o[x+1];if(T!==s&&k!==s&&w!==s&&g!==s){var b=h-d,R=T+(w-T)*b;return R+(k+(g-k)*b-R)*(p-y)}}}}]),e}();function l(e,t,n){return e<t?t:e>n?n:e}}))}();
//# sourceMappingURL=ElevationQuery.d8a1665d.js.map
