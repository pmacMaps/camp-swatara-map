function e(e,r,t,n){Object.defineProperty(e,r,{get:t,set:n,enumerable:!0,configurable:!0})}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("gfFNw",(function(t,n){e(t.exports,"functionHelper",(function(){return oe})),e(t.exports,"extend",(function(){return ae})),e(t.exports,"executeScript",(function(){return ie})),e(t.exports,"extractFieldLiterals",(function(){return se})),e(t.exports,"validateScript",(function(){return le})),e(t.exports,"referencesMember",(function(){return ce})),e(t.exports,"referencesFunction",(function(){return ue})),e(t.exports,"findFunctionCalls",(function(){return fe}));var o=r("7e1Ja"),a=r("8dj34"),i=r("lz1nc"),s=r("2mxq8"),l=r("8MibT"),c=r("k6igO"),u=r("b2JWg"),f=r("hyHkL"),d=r("fXK0z"),p=r("gDYGn"),w=r("effkN"),h=r("jB7L7"),g=r("fVx77"),E=r("aIasu"),v=r("7lxsX"),m=r("4jvWz"),y=r("2WnyR"),N=r("eqMhf"),I=r("5vMQI"),b=r("dZxPT"),T=r("etknW"),R=r("7blCc"),M=r("jaaCV");function S(e){return e&&"function"==typeof e.then}const O=100;async function x(e,r){const t=[];for(let n=0;n<r.arguments.length;n++)t.push(await U(e,r.arguments[n]));return t}async function C(e,r,t){return!0===r.preparsed?t(e,null,r.arguments):t(e,r,await x(e,r))}async function A(e,r,t){if(!0===r.preparsed){const n=t(e,null,r.arguments);return S(n),n}const n=t(e,r,await x(e,r));return S(n),n}async function U(e,r,t){if(r.breakpoint&&!0!==t){const t=r.breakpoint();return await t,U(e,r,!0)}switch(r.type){case"VariableDeclarator":return async function(e,r){let t=null;if(t=null===r.init?null:await U(e,r.init),null!==e.localScope){if(t===f.v&&(t=null),"Identifier"!==r.id.type)throw new Error("Can only assign a regular variable");const n=r.id.name.toLowerCase();return e.localScope[n]={value:t,valueset:!0,node:r.init},f.v}if("Identifier"!==r.id.type)throw new Error("Can only assign a regular variable");const n=r.id.name.toLowerCase();return t===f.v&&(t=null),e.globalScope[n]={value:t,valueset:!0,node:r.init},f.v}(e,r);case"VariableDeclaration":return Y(e,r,0);case"BlockStatement":return async function(e,r){return V(e,r,0)}(e,r);case"FunctionDeclaration":return async function(e,r){const t=r.id.name.toLowerCase();return e.globalScope[t]={valueset:!0,node:null,value:new(0,l.default)(r,e)},f.v}(e,r);case"ReturnStatement":return async function(e,r){if(null===r.argument)return new(0,f.R)(f.v);const t=await U(e,r.argument);return new(0,f.R)(t)}(e,r);case"IfStatement":return async function(e,r){if("AssignmentExpression"===r.test.type||"UpdateExpression"===r.test.type)throw new Error((0,d.nodeErrorMessage)(r.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const t=await U(e,r.test);if(!0===t)return U(e,r.consequent);if(!1===t)return null!==r.alternate?U(e,r.alternate):f.v;throw new Error((0,d.nodeErrorMessage)(r.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}(e,r);case"ExpressionStatement":return async function(e,r){if("AssignmentExpression"===r.expression.type)return U(e,r.expression);if("CallExpression"===r.expression.type){const t=await U(e,r.expression);return t===f.v?f.v:new(0,f.I)(t)}const t=await U(e,r.expression);return t===f.v?f.v:new(0,f.I)(t)}(e,r);case"UpdateExpression":return async function(e,r){const t=r.argument;if("MemberExpression"===t.type){const n={t:null},o=await U(e,t.object);let a=null;n.t=o,!0===t.computed?a=await U(e,t.property):"Identifier"===t.property.type&&(a=t.property.name);const s=n.t;let l;if((0,f.l)(s)){if(!(0,f.a)(a))throw new Error("Invalid Parameter");if(a<0&&(a=s.length+a),a<0||a>=s.length)throw new Error("Assignment outside of array bounds");l=(0,f.f)(s[a]),s[a]="++"===r.operator?l+1:l-1}else if(s instanceof i.default){if(!1===(0,f.b)(a))throw new Error("Dictionary accessor must be a string");if(!0!==s.hasField(a))throw new Error("Invalid Parameter");l=(0,f.f)(s.field(a)),s.setField(a,"++"===r.operator?l+1:l-1)}else{if(!(0,f.s)(s))throw(0,f.n)(s)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===(0,f.b)(a))throw new Error("Feature accessor must be a string");if(!0!==s.hasField(a))throw new Error("Invalid Parameter");l=(0,f.f)(s.field(a)),s.setField(a,"++"===r.operator?l+1:l-1)}return!1===r.prefix?l:"++"===r.operator?l+1:l-1}const n="Identifier"===r.argument.type?r.argument.name.toLowerCase():"";if(!n)throw new Error("Invalid identifier");let o;if(null!==e.localScope&&void 0!==e.localScope[n])return o=(0,f.f)(e.localScope[n].value),e.localScope[n]={value:"++"===r.operator?o+1:o-1,valueset:!0,node:r},!1===r.prefix?o:"++"===r.operator?o+1:o-1;if(void 0!==e.globalScope[n])return o=(0,f.f)(e.globalScope[n].value),e.globalScope[n]={value:"++"===r.operator?o+1:o-1,valueset:!0,node:r},!1===r.prefix?o:"++"===r.operator?o+1:o-1;throw new Error("Variable not recognised")}(e,r);case"AssignmentExpression":return async function(e,r){const t=r.left;if("MemberExpression"===t.type){const n=await U(e,r.right),o=await U(e,t.object);let a=null;if(!0===t.computed)a=await U(e,t.property);else{if("Identifier"!==t.property.type)throw new Error("Expected computed or identifier for assignemnt target");a=t.property.name}if((0,f.l)(o)){if(!(0,f.a)(a))throw new Error("Invalid Parameter");if(a<0&&(a=o.length+a),a<0||a>o.length)throw new Error("Assignment outside of array bounds");if(a===o.length){if("="!==r.operator)throw new Error("Invalid Parameter");o[a]=j(n,r.operator,o[a],r)}else o[a]=j(n,r.operator,o[a],r)}else if(o instanceof i.default){if(!1===(0,f.b)(a))throw new Error("Dictionary accessor must be a string");if(!0===o.hasField(a))o.setField(a,j(n,r.operator,o.field(a),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");o.setField(a,j(n,r.operator,null,r))}}else{if(!(0,f.s)(o))throw(0,f.n)(o)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===(0,f.b)(a))throw new Error("Feature accessor must be a string");if(!0===o.hasField(a))o.setField(a,j(n,r.operator,o.field(a),r));else{if("="!==r.operator)throw new Error("Invalid Parameter");o.setField(a,j(n,r.operator,null,r))}}return f.v}const n=t.name.toLowerCase();if(null!==e.localScope&&void 0!==e.localScope[n]){const t=await U(e,r.right);return e.localScope[n]={value:j(t,r.operator,e.localScope[n].value,r),valueset:!0,node:r.right},f.v}if(void 0!==e.globalScope[n]){const t=await U(e,r.right);return e.globalScope[n]={value:j(t,r.operator,e.globalScope[n].value,r),valueset:!0,node:r.right},f.v}throw new Error("Cannot assign undeclared variable")}(e,r);case"ForStatement":return function(e,r){try{return null!==r.init?U(e,r.init).then((()=>new Promise(((t,n)=>{P(e,r,{testResult:!0,lastAction:f.v},(e=>{t(e)}),(e=>{n(e)}),0)})))):new Promise(((t,n)=>{P(e,r,{testResult:!0,lastAction:f.v},(e=>{t(e)}),(e=>{n(e)}),0)}))}catch(e){return Promise.reject(e)}}(e,r);case"ForInStatement":return async function(e,r){return new Promise(((t,n)=>{U(e,r.right).then((o=>{try{let a=null;a="VariableDeclaration"===r.left.type?U(e,r.left):Promise.resolve(),a.then((()=>{try{let a="";if("VariableDeclaration"===r.left.type){const e=r.left.declarations[0].id;"Identifier"===e.type&&(a=e.name)}else"Identifier"===r.left.type&&(a=r.left.name);if(!a)throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","INVALIDVARIABLE"));a=a.toLowerCase();let s=null;if(null!==e.localScope&&void 0!==e.localScope[a]&&(s=e.localScope[a]),null===s&&void 0!==e.globalScope[a]&&(s=e.globalScope[a]),null===s)return void n(new Error((0,d.nodeErrorMessage)(r,"RUNTIME","VARIABLENOTDECLARED")));(0,f.l)(o)||(0,f.b)(o)?k(e,r,o,{reject:n,resolve:t},s):(0,f.n)(o)?function(e,r,t,n,o,a){try{if(void 0===a&&(a="i"),0===t.length)return void n.resolve(f.v);L(e,r,t,o,0,a,(e=>{n.resolve(e)}),(e=>{n.reject(e)}),0)}catch(e){n.reject(e)}}(e,r,o,{reject:n,resolve:t},s):o instanceof i.default||(0,f.s)(o)?function(e,r,t,n,o){try{k(e,r,t.keys(),n,o,"k")}catch(e){n.reject(e)}}(e,r,o,{reject:n,resolve:t},s):(0,f.y)(o)?_(o.iterator(e.abortSignal),e,r,o,s,(e=>{t(e)}),(e=>{n(e)}),0):k(e,r,[],{reject:n,resolve:t},s)}catch(e){n(e)}}),n)}catch(e){n(e)}}),n)}))}(e,r);case"BreakStatement":return f.w;case"EmptyStatement":return f.v;case"ContinueStatement":return f.x;case"TemplateElement":return async function(e,r){return r.value?r.value.cooked:""}(0,r);case"TemplateLiteral":return async function(e,r){const t=[];for(let n=0;n<r.expressions.length;n++){const o=await U(e,r.expressions[n]);t[n]=(0,f.h)(o)}let n="",o=0;for(const e of r.quasis)n+=e.value?e.value.cooked:"",!1===e.tail&&(n+=t[o]?t[o]:"",o++);return n}(e,r);case"Identifier":return z(e,r);case"MemberExpression":return async function(e,r){const t=await U(e,r.object);if(null===t)throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","NOTFOUND"));if(!1===r.computed){if("Identifier"===r.property.type){if(t instanceof i.default||(0,f.s)(t))return t.field(r.property.name);if(t instanceof N.default)return G(t,r.property.name,e,r);throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","INVALIDTYPE"))}throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","INVALIDTYPE"))}let n=await U(e,r.property);if(t instanceof i.default||(0,f.s)(t)){if((0,f.b)(n))return t.field(n);throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","INVALIDTYPE"))}if(t instanceof N.default){if((0,f.b)(n))return G(t,n,e,r);throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","INVALIDTYPE"))}if((0,f.l)(t)){if((0,f.a)(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=t.length+n),n>=t.length||n<0)throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","OUTOFBOUNDS"));return t[n]}throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","INVALIDTYPE"))}if((0,f.n)(t)){if((0,f.a)(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=t.length()+n),n>=t.length()||n<0)throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","OUTOFBOUNDS"));return t.get(n)}throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","INVALIDTYPE"))}if((0,f.b)(t)){if((0,f.a)(n)&&isFinite(n)&&Math.floor(n)===n){if(n<0&&(n=t.length+n),n>=t.length||n<0)throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","OUTOFBOUNDS"));return t[n]}throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","INVALIDTYPE"))}throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","INVALIDTYPE"))}(e,r);case"Literal":return r.value;case"CallExpression":return async function(e,r){if("Identifier"!==r.callee.type)throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[r.callee.name.toLowerCase()]){const t=e.localScope[r.callee.name.toLowerCase()];if(t.value instanceof f.N)return t.value.fn(e,r);if(t.value instanceof l.default)return $(e,r,t.value.definition);throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[r.callee.name.toLowerCase()]){const t=e.globalScope[r.callee.name.toLowerCase()];if(t.value instanceof f.N)return t.value.fn(e,r);if(t.value instanceof l.default)return $(e,r,t.value.definition);throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","NOTAFUNCTION"))}throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","NOTFOUND"))}(e,r);case"UnaryExpression":return async function(e,r){const t=await U(e,r.argument);if((0,f.i)(t)){if("!"===r.operator)return!t;if("-"===r.operator)return-1*(0,f.f)(t);if("+"===r.operator)return 1*(0,f.f)(t);if("~"===r.operator)return~(0,f.f)(t);throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}if("-"===r.operator)return-1*(0,f.f)(t);if("+"===r.operator)return 1*(0,f.f)(t);if("~"===r.operator)return~(0,f.f)(t);throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}(e,r);case"BinaryExpression":return async function(e,r){const t=[];t[0]=await U(e,r.left),t[1]=await U(e,r.right);const n=t[0],o=t[1];switch(r.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return(0,f.r)((0,f.f)(n),(0,f.f)(o),r.operator);case"==":return(0,f.m)(n,o);case"!=":return!(0,f.m)(n,o);case"<":case">":case"<=":case">=":return(0,f.q)(n,o,r.operator);case"+":return(0,f.b)(n)||(0,f.b)(o)?(0,f.h)(n)+(0,f.h)(o):(0,f.f)(n)+(0,f.f)(o);case"-":return(0,f.f)(n)-(0,f.f)(o);case"*":return(0,f.f)(n)*(0,f.f)(o);case"/":return(0,f.f)(n)/(0,f.f)(o);case"%":return(0,f.f)(n)%(0,f.f)(o);default:throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","OPERATORNOTRECOGNISED"))}}(e,r);case"LogicalExpression":return async function(e,r){if("AssignmentExpression"===r.left.type||"UpdateExpression"===r.left.type)throw new Error((0,d.nodeErrorMessage)(r.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===r.right.type||"UpdateExpression"===r.right.type)throw new Error((0,d.nodeErrorMessage)(r.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const t=await U(e,r.left);let n=null;if(!(0,f.i)(t))throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","ONLYBOOLEAN"));switch(r.operator){case"||":if(!0===t)return t;if(n=await U(e,r.right),(0,f.i)(n))return n;throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","ONLYORORAND"));case"&&":if(!1===t)return t;if(n=await U(e,r.right),(0,f.i)(n))return n;throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","ONLYORORAND"));default:throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","ONLYORORAND"))}}(e,r);case"ArrayExpression":return async function(e,r){const t=[];for(let n=0;n<r.elements.length;n++)t.push(await U(e,r.elements[n]));for(let e=0;e<t.length;e++){if((0,f.o)(t[e]))throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","FUNCTIONCONTEXTILLEGAL"));t[e]===f.v&&(t[e]=null)}return t}(e,r);case"ObjectExpression":return async function(e,r){const t=[];for(let n=0;n<r.properties.length;n++)t[n]=await U(e,r.properties[n]);const n={};for(let e=0;e<t.length;e++){const r=t[e];if((0,f.o)(r.value))throw new Error("Illegal Argument");if(!1===(0,f.b)(r.key))throw new Error("Illegal Argument");r.value===f.v?n[r.key.toString()]=null:n[r.key.toString()]=r.value}const o=new(0,i.default)(n);return o.immutable=!1,o}(e,r);case"Property":return async function(e,r){const t=await U(e,r.value);return"Identifier"===r.key.type?{key:r.key.name,value:t}:{key:await U(e,r.key),value:t}}(e,r);default:throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","UNREOGNISED"))}}async function F(e,r,t){const n=await U(e,r.body);return t.lastAction=n,t.lastAction===f.w||t.lastAction instanceof f.R?(t.testResult=!1,t):null!==r.update?(await U(e,r.update),t):t}function P(e,r,t,n,o,a){try{(async function(e,r,t){if(null!==r.test){const n=await U(e,r.test);if(!0===e.abortSignal.aborted)throw new Error("Cancelled");if(t.testResult=n,!1===t.testResult)return t;if(!0!==t.testResult)throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"));return F(e,r,t)}return F(e,r,t)})(e,r,t).then((()=>{try{!0===t.testResult?++a>O?(a=0,setTimeout((()=>{P(e,r,t,n,o,a)}),0)):P(e,r,t,n,o,a):t.lastAction instanceof f.R?n(t.lastAction):n(f.v)}catch(e){o(e)}}),(e=>{o(e)}))}catch(e){o(e)}}function D(e,r,t,n,o,a,i,s,l,c){try{if(n<=a)return void s(f.v);o.value="k"===i?t[a]:a,U(e,r.body).then((u=>{try{u instanceof f.R?s(u):u===f.w?s(f.v):++c>O?(c=0,setTimeout((()=>{D(e,r,t,n,o,a+1,i,s,l,c)}),0)):D(e,r,t,n,o,a+1,i,s,l,c)}catch(e){l(e)}}),(e=>{l(e)}))}catch(e){l(e)}}function L(e,r,t,n,o,a,i,s,l){try{if(t.length()<=o)return void i(f.v);n.value="k"===a?t.get(o):o,U(e,r.body).then((c=>{c instanceof f.R?i(c):c===f.w?i(f.v):++l>O?(l=0,setTimeout((()=>{L(e,r,t,n,o+1,a,i,s,l)}),0)):L(e,r,t,n,o+1,a,i,s,l)}),(e=>{s(e)}))}catch(e){s(e)}}function k(e,r,t,n,o,a){try{if(void 0===a&&(a="i"),0===t.length)return void n.resolve(f.v);D(e,r,t,t.length,o,0,a,(e=>{n.resolve(e)}),(e=>{n.reject(e)}),0)}catch(e){n.reject(e)}}function _(e,r,t,n,o,a,i,l){try{e.next().then((c=>{try{if(null===c)a(f.v);else{const u=s.default.createFromGraphicLikeObject(c.geometry,c.attributes,n);u._underlyingGraphic=c,o.value=u,U(r,t.body).then((s=>{try{s===f.w?a(f.v):s instanceof f.R?a(s):++l>O?(l=0,setTimeout((()=>{_(e,r,t,n,o,a,i,l)}),0)):_(e,r,t,n,o,a,i,l)}catch(e){i(e)}}),(e=>{i(e)}))}}catch(e){i(e)}}),(e=>{i(e)}))}catch(e){i(e)}}function j(e,r,t,n){switch(r){case"=":return e===f.v?null:e;case"/=":return(0,f.f)(t)/(0,f.f)(e);case"*=":return(0,f.f)(t)*(0,f.f)(e);case"-=":return(0,f.f)(t)-(0,f.f)(e);case"+=":return(0,f.b)(t)||(0,f.b)(e)?(0,f.h)(t)+(0,f.h)(e):(0,f.f)(t)+(0,f.f)(e);case"%=":return(0,f.f)(t)%(0,f.f)(e);default:throw new Error((0,d.nodeErrorMessage)(n,"RUNTIME","OPERATORNOTRECOGNISED"))}}async function V(e,r,t){if(t>=r.body.length)return f.v;const n=await U(e,r.body[t]);return n instanceof f.R||n===f.w||n===f.x||t===r.body.length-1?n:V(e,r,t+1)}async function Y(e,r,t){return t>=r.declarations.length||(await U(e,r.declarations[t]),t===r.declarations.length-1||await Y(e,r,t+1)),f.v}let B=0;function G(e,r,t,n){let o;switch(r=r.toLowerCase()){case"hasz":{const r=e.hasZ;return void 0!==r&&r}case"hasm":{const r=e.hasM;return void 0!==r&&r}case"spatialreference":{let r=e.spatialReference._arcadeCacheId;if(void 0===r){let t=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(t=!1),t&&(B++,e.spatialReference._arcadeCacheId=B,r=B)}const t=new(0,i.default)({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==r&&(t._arcadeCacheId="SPREF"+r.toString()),t}}switch(e.type){case"extent":switch(r){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const t=e[r];return void 0!==t?t:null}case"type":return"Extent"}break;case"polygon":switch(r){case"rings":return o=e.cache._arcadeCacheId,void 0===o&&(B++,o=B,e.cache._arcadeCacheId=o),new(0,c.default)(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polygon"}break;case"point":switch(r){case"x":case"y":case"z":case"m":return void 0!==e[r]?e[r]:null;case"type":return"Point"}break;case"polyline":switch(r){case"paths":return o=e.cache._arcadeCacheId,void 0===o&&(B++,o=B,e.cache._arcadeCacheId=o),new(0,c.default)(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,o);case"type":return"Polyline"}break;case"multipoint":switch(r){case"points":return o=e.cache._arcadeCacheId,void 0===o&&(B++,o=B,e.cache._arcadeCacheId=o),new(0,u.default)(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,o,1);case"type":return"Multipoint"}}throw new Error((0,d.nodeErrorMessage)(n,"RUNTIME","PROPERTYNOTFOUND"))}async function z(e,r){const t=r.name.toLowerCase();if(null!==e.localScope&&void 0!==e.localScope[t]){const r=e.localScope[t];if(!0===r.valueset)return r.value;if(null!==r.d)return r.d;r.d=U(e,r.node);const n=await r.d;return r.value=n,r.valueset=!0,n}if(void 0!==e.globalScope[t]){const r=e.globalScope[t];if(!0===r.valueset)return r.value;if(null!==r.d)return r.d;r.d=U(e,r.node);const n=await r.d;return r.value=n,r.valueset=!0,n}throw new Error((0,d.nodeErrorMessage)(r,"RUNTIME","VARIABLENOTFOUND"))}const q={};function H(e){return null===e?"":(0,f.l)(e)||(0,f.n)(e)?"Array":(0,f.j)(e)?"Date":(0,f.b)(e)?"String":(0,f.i)(e)?"Boolean":(0,f.a)(e)?"Number":e instanceof a.default?"Attachment":e instanceof o.default?"Portal":e instanceof i.default?"Dictionary":(0,f.s)(e)?"Feature":e instanceof b.default?"Point":e instanceof T.default?"Polygon":e instanceof R.default?"Polyline":e instanceof I.default?"Multipoint":e instanceof y.default?"Extent":(0,f.o)(e)?"Function":(0,f.y)(e)?"FeatureSet":(0,f.z)(e)?"FeatureSetCollection":e===f.v?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}async function W(e,r,t,n){const o=await U(e,r.arguments[t]);if((0,f.m)(o,n))return U(e,r.arguments[t+1]);const a=r.arguments.length-t;return 1===a?U(e,r.arguments[t]):2===a?null:3===a?U(e,r.arguments[t+2]):W(e,r,t+2,n)}async function Z(e,r,t,n){if(!0===n)return U(e,r.arguments[t+1]);if(3==r.arguments.length-t)return U(e,r.arguments[t+2]);const o=await U(e,r.arguments[t+2]);if(!1===(0,f.i)(o))throw new Error("WHEN needs boolean test conditions");return Z(e,r,t+2,o)}async function X(e,r){const t=e.length,n=Math.floor(t/2);if(0===t)return[];if(1===t)return[e[0]];const o=[X(e.slice(0,n),r),X(e.slice(n,t),r)],a=await Promise.all(o);return J(a[0],a[1],r,[])}async function J(e,r,t,n){const o=n;if(!(e.length>0||r.length>0))return n;if(e.length>0&&r.length>0){let a=await t(e[0],r[0]);return isNaN(a)&&(a=1),a<=0?(o.push(e[0]),e=e.slice(1)):(o.push(r[0]),r=r.slice(1)),J(e,r,t,n)}return e.length>0?(o.push(e[0]),J(e=e.slice(1),r,t,n)):r.length>0?(o.push(r[0]),J(e,r=r.slice(1),t,n)):void 0}function K(e,r){const t=e.length,n=Math.floor(t/2);return r||(r=function(e,r){return e<r?-1:e===r?0:1}),0===t?[]:1===t?[e[0]]:function(e,r,t){const n=[];for(;e.length>0||r.length>0;)if(e.length>0&&r.length>0){let o=t(e[0],r[0]);isNaN(o)&&(o=1),o<=0?(n.push(e[0]),e=e.slice(1)):(n.push(r[0]),r=r.slice(1))}else e.length>0?(n.push(e[0]),e=e.slice(1)):r.length>0&&(n.push(r[0]),r=r.slice(1));return n}(K(e.slice(0,n),r),K(e.slice(n,t),r),r)}async function Q(e,r,t){const n=e.body;if(t.length!==e.params.length)throw new Error("Invalid Parameter calls to function.");for(let n=0;n<t.length;n++){const o=e.params[n];"Identifier"===o.type&&(r.localScope[o.name.toLowerCase()]={d:null,value:t[n],valueset:!0,node:null})}const o=await U(r,n);if(o instanceof f.R)return o.value;if(o===f.w)throw new Error("Cannot Break from a Function");if(o===f.x)throw new Error("Cannot Continue from a Function");return o instanceof f.I?o.value:o}function $(e,r,t){return A(e,r,(function(r,n,o){const a={spatialReference:e.spatialReference,services:e.services,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:e.depthCounter+1};if(a.depthCounter>64)throw new Error("Exceeded maximum function depth");return Q(t,a,o)}))}function ee(e){return function(){const r={abortSignal:e.context.abortSignal,spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,interceptor:e.context.interceptor,services:e.context.services,localScope:{},globalScope:e.context.globalScope,depthCounter:e.context.depthCounter+1};if(r.depthCounter>64)throw new Error("Exceeded maximum function depth");return Q(e.definition,r,arguments)}}(0,w.registerFunctions)(q,C),(0,m.registerFunctions)(q,C),(0,E.registerFunctions)(q,C),(0,g.registerFunctions)(q,C),(0,v.registerFunctions)(q,C),(0,h.registerFunctions)({functions:q,compiled:!1,signatures:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:C,standardFunctionAsync:A}),q.typeof=function(e,r){return C(e,r,(function(e,r,t){(0,f.p)(t,1,1);const n=H(t[0]);if("Unrecognised Type"===n)throw new Error("Unrecognised Type");return n}))},q.iif=async function(e,r){(0,f.p)(null===r.arguments?[]:r.arguments,3,3);const t=await U(e,r.arguments[0]);if(!1===(0,f.i)(t))throw new Error("IF Function must have a boolean test condition");const n=[];return n[0]=await U(e,r.arguments[1]),n[1]=await U(e,r.arguments[2]),t?n[0]:n[1]},q.decode=async function(e,r){if(r.arguments.length<2)throw new Error("Missing Parameters");if(2===r.arguments.length)return U(e,r.arguments[1]);if((r.arguments.length-1)%2==0)throw new Error("Must have a default value result.");return W(e,r,1,await U(e,r.arguments[0]))},q.when=async function(e,r){if(r.arguments.length<3)throw new Error("Missing Parameters");if(r.arguments.length%2==0)throw new Error("Must have a default value result.");const t=await U(e,r.arguments[0]);if(!1===(0,f.i)(t))throw new Error("WHEN needs boolean test conditions");return Z(e,r,0,t)},q.sort=function(e,r){return A(e,r,(async function(e,r,t){(0,f.p)(t,1,2);let n=t[0];if((0,f.n)(n)&&(n=n.toArray()),!1===(0,f.l)(n))throw new Error("Illegal Argument");if(t.length>1){if(!1===(0,f.o)(t[1]))throw new Error("Illegal Argument");return X(n,ee(t[1]))}let o=n;if(0===o.length)return[];const a={};for(let e=0;e<o.length;e++){const r=H(o[e]);""!==r&&(a[r]=!0)}if(!0===a.Array||!0===a.Dictionary||!0===a.Feature||!0===a.Point||!0===a.Polygon||!0===a.Polyline||!0===a.Multipoint||!0===a.Extent||!0===a.Function)return o.slice(0);let i=0,s="";for(const e in a)i++,s=e;return i>1||"String"===s?o=K(o,(function(e,r){if(null==e||e===f.v)return null==r||r===f.v?0:1;if(null==r||r===f.v)return-1;const t=(0,f.h)(e),n=(0,f.h)(r);return t<n?-1:t===n?0:1})):"Number"===s?o=K(o,(function(e,r){return e-r})):"Boolean"===s?o=K(o,(function(e,r){return e===r?0:r?-1:1})):"Date"===s&&(o=K(o,(function(e,r){return r-e}))),o}))};const re={fixSpatialReference:f.A,parseArguments:x,standardFunction:C,standardFunctionAsync:A,evaluateIdentifier:z,arcadeCustomFunction:ee};for(const e in q)q[e]={value:new(0,f.N)(q[e]),valueset:!0,node:null};const te=function(){};function ne(e){console.log(e)}(te.prototype=q).infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},te.prototype.pi={value:Math.PI,valueset:!0,node:null};const oe=re;function ae(e){const r={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:C,standardFunctionAsync:A,evaluateIdentifier:z,arcadeCustomFunctionHandler:ee};for(let t=0;t<e.length;t++)e[t].registerFunctions(r);for(const e in r.functions)q[e]={value:new(0,f.N)(r.functions[e]),valueset:!0,node:null},te.prototype[e]=q[e];for(let e=0;e<r.signatures.length;e++)(0,d.addFunctionDeclaration)(r.signatures[e],"async")}async function ie(e,r){let t=r.spatialReference;null==t&&(t=new(0,M.default)({wkid:102100}));const n=function(e,r){const t=new te;null==e&&(e={}),null==r&&(r={});const n=new(0,i.default)({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});n.immutable=!1,t.textformatting={value:n,valueset:!0,node:null};for(const e in r)t[e]={value:new(0,f.N)(r[e]),native:!0,valueset:!0,node:null};for(const r in e)e[r]&&"esri.Graphic"===e[r].declaredClass?t[r]={value:s.default.createFromGraphic(e[r]),valueset:!0,node:null}:t[r]={value:e[r],valueset:!0,node:null};return t}(r.vars,r.customfunctions),o={spatialReference:t,services:r.services,abortSignal:void 0===r.abortSignal||null===r.abortSignal?{aborted:!1}:r.abortSignal,globalScope:n,console:r.console?r.console:ne,lrucache:r.lrucache,interceptor:r.interceptor,localScope:null,depthCounter:1};let a=await U(o,e.body[0].body);if(a instanceof f.R&&(a=a.value),a instanceof f.I&&(a=a.value),a===f.v&&(a=null),a===f.w)throw new Error("Cannot return BREAK");if(a===f.x)throw new Error("Cannot return CONTINUE");if(a instanceof f.N)throw new Error("Cannot return FUNCTION");if(a instanceof l.default)throw new Error("Cannot return FUNCTION");return a}function se(e,r){return(0,d.findFieldLiterals)(e)}function le(e,r){return(0,d.validateScript)(e,r,"full")}function ce(e,r){return(0,d.referencesMember)(e,r)}function ue(e,r){return(0,d.referencesFunction)(e,r)}function fe(e){return(0,d.findFunctionCalls)(e)}ae([p.A])}));
//# sourceMappingURL=arcadeAsyncRuntime.63bcaec8.js.map
