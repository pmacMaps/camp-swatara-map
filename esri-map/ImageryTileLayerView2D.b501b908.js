function e(e,t,i,r){Object.defineProperty(e,t,{get:i,set:r,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;t.register("l4MVC",(function(i,r){var s;s=i.exports,Object.defineProperty(s,"__esModule",{value:!0,configurable:!0}),e(i.exports,"default",(function(){return S}));var n=t("j6uz9"),a=t("EvxpF"),o=t("6TszD"),l=t("lHg4e"),u=t("cc23H"),h=t("dxCr0"),c=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var d=t("qA6zg"),p=t("ceRhn"),f=t("35vaU"),y=t("9xyOc"),v=t("l0KI8"),g=t("8it4a"),m=t("54zEM"),x=t("YRjSC"),b=t("aDxLR");const _=o.default.getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let w=class extends((0,m.ImageryTileLayerView)((0,b.RefreshableLayerView)((0,f.LayerView2DMixin)(x.default)))){get useWebGLForProcessing(){return this._useWebGLForProcessing}set useWebGLForProcessing(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}get useProgressiveUpdate(){return this._useWebGLForProcessing}set useProgressiveUpdate(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}update(e){this.subview.update(e),this.notifyChange("updating")}isUpdating(){return!this.subview||this.subview.updating}attach(){this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.handles.add([(0,h.watch)(this.layer,["bandIds","renderer","interpolation","multidimensionalDefinition"],((e,t,i)=>{const r="multidimensionalDefinition"===i,s="interpolation"===i&&("majority"===e||"majority"===t)&&(0,g.canUseMajorityInterpolationOnDataSource)(this.layer),n="renderer"===i&&t.type!==e.type;n&&this._updateSubview();const a=r||s||n;this.subview.redrawOrRefetch(a).catch((e=>{(0,l.isAbortError)(e)||_.error(e)})),this.notifyChange("updating")})),(0,u.watch)((()=>{var e;return null!=(e=this.layer.blendMode)?e:"normal"}),(e=>{this.subview.container.blendMode=e}),u.syncAndInitial),(0,u.watch)((()=>{var e;return null!=(e=this.layer.effect)?e:null}),(e=>{this.subview.container.effect=e}),u.syncAndInitial),(0,u.watch)((()=>this.timeExtent),(()=>{this.subview.timeExtent=this.timeExtent,this.subview.redrawOrRefetch(!0).catch((e=>{(0,l.isAbortError)(e)||_.error(e)}))}),u.initial)],"attach")}detach(){var e;this.handles.remove("attach"),this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),null==(e=this.subview)||e.destroy(),this.subview=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.subview.moveEnd()}async hitTest(e,t){return[new(0,a.default)({attributes:{},geometry:e.clone()})]}doRefresh(){return this.subview.doRefresh()}_updateSubview(){const e="vector-field"===this.layer.renderer.type?"rasterVF":"flow"===this.layer.renderer.type?"flow":"raster";if(this.subview){var t;if(this.subview.type===e)return void this._attachSubview(this.subview);this._detachSubview(this.subview),null==(t=this.subview)||t.destroy(),this.subview=null}const{layer:i}=this;let r;r="rasterVF"===e?new(0,v.default)({layer:i,layerView:this}):"flow"===e?new(0,p.default)({layer:i,layerView:this}):new(0,y.default)({layer:i,layerView:this}),"useWebGLForProcessing"in r&&(r.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in r&&(r.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in r&&(r.previousLOD=this.subview&&"previousLOD"in this.subview&&this.subview.previousLOD),this._attachSubview(r),this.subview=r,this.requestUpdate()}_attachSubview(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0),e.container.blendMode=this.layer.blendMode,e.container.effect=this.layer.effect)}_detachSubview(e){null!=e&&e.attached&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}constructor(){super(...arguments),this._useWebGLForProcessing=!0,this._useProgressiveUpdate=!0,this.subview=null}};(0,n._)([(0,c.property)()],w.prototype,"subview",void 0),(0,n._)([(0,c.property)()],w.prototype,"useWebGLForProcessing",null),(0,n._)([(0,c.property)()],w.prototype,"useProgressiveUpdate",null),w=(0,n._)([(0,d.subclass)("esri.views.2d.layers.ImageryTileLayerView2D")],w);const S=w})),t.register("9xyOc",(function(i,r){e(i.exports,"default",(function(){return d}));var s=t("j6uz9"),n=t("1CpCt"),a=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var o=t("qA6zg"),l=t("igD0m"),u=t("1cBNT"),h=t("8it4a");let c=class extends u.BaseImageryTileSubView2D{attach(){super.attach(),this.container=new(0,l.RasterTileContainer)(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme}detach(){super.detach(),this.container.removeAllChildren(),this.container=null}canUseWebGLForProcessing(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&(0,h.canUseMajorityInterpolationOnDataSource)(this.layer))}fetchTile(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}async updateTileSource(e,t){const{bandIds:i}=this.layer,r=this._getLayerInterpolation(),s=this.canUseWebGLForProcessing(),{source:a,symbolizerParams:o,globalSymbolizerParams:l,suspended:u,coords:h,resolution:c}=t,{bitmap:d}=e;if([d.x,d.y]=h,d.resolution=c,a&&(0,n.isSome)(a)&&(0,n.isSome)(a.pixelBlock)){const e={extent:a.extent,pixelBlock:a.pixelBlock};if(d.rawPixelData=e,s)d.source=a.pixelBlock,d.isRendereredSource=!1;else{const t=await this.layer.applyRenderer(e,"stretch"===(null==l?void 0:l.type)?l:null);d.source=t,d.isRendereredSource=!0}d.symbolizerParameters=s?o:null,s?d.transformGrid||(d.transformGrid=a.transformGrid):d.transformGrid=null}else{const e=this.createEmptyTilePixelBlock();d.source=e,d.symbolizerParameters=s?o:null,d.transformGrid=null}d.bandIds=s?i:null,d.width=this._tileInfoView.tileInfo.size[0],d.height=this._tileInfoView.tileInfo.size[1],d.interpolation=r,d.suspended=u,d.invalidateTexture()}async updateTileSymbolizerParameters(e,t){const{local:i,global:r}=t,{bandIds:s}=this.layer,a=this._getLayerInterpolation(),o=this.canUseWebGLForProcessing(),{bitmap:l}=e,{rawPixelData:u}=l;!o&&(0,n.isSome)(u)?(l.source=await this.layer.applyRenderer(u,"stretch"===(null==r?void 0:r.type)?r:null),l.isRendereredSource=!0):(l.isRendereredSource&&(0,n.isSome)(u)&&(l.source=u.pixelBlock),l.isRendereredSource=!1),l.symbolizerParameters=o?r||i:null,l.bandIds=o?s:null,l.interpolation=a,l.suspended=!1}_getLayerInterpolation(){const e=this.layer.renderer.type;if("raster-colormap"===e||"unique-value"===e||"class-breaks"===e)return"nearest";const{interpolation:t}=this.layer,{renderer:i}=this.layer;return"raster-stretch"===i.type&&null!=i.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}constructor(){super(...arguments),this.container=null,this.layer=null,this.type="raster"}};(0,s._)([(0,a.property)()],c.prototype,"container",void 0),(0,s._)([(0,a.property)()],c.prototype,"layer",void 0),(0,s._)([(0,a.property)()],c.prototype,"type",void 0),c=(0,s._)([(0,o.subclass)("esri.views.2d.layers.imagery.ImageryTileView2D")],c);const d=c})),t.register("igD0m",(function(i,r){e(i.exports,"RasterTileContainer",(function(){return h}));var s=t("19dbe"),n=t("6MGuH"),a=t("4ZNdX"),o=t("dKqeB"),l=t("eyQUy"),u=t("htRPC");class h extends u.default{createTile(e){const t=this._getTileBounds(e),[i,r]=this._tileInfoView.tileInfo.size;return new(0,o.RasterTile)(e,t[0],t[3],i,r)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (tile)",brushes:[a.brushes.raster],target:()=>this.children.map((e=>e.bitmap)),drawPhase:l.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===l.WGLDrawPhase.MAP&&super.doRender(e)}_getTileBounds(e){const t=this._tileInfoView.getTileBounds((0,s.create)(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:i}=this._tileInfoView,r=(0,n.getWorldWidth)(i.spatialReference);if(r){const{resolution:s}=i.lodAt(e.level),n=r/s%i.size[0],a=n?(i.size[0]-n)*s:0;t[0]-=a*e.world,t[2]-=a*e.world}}return t}constructor(){super(...arguments),this.isCustomTilingScheme=!1}}})),t.register("dKqeB",(function(i,r){e(i.exports,"RasterTile",(function(){return o}));var s=t("jsolS"),n=t("e0kjQ"),a=t("033AK");class o extends a.TiledDisplayObject{destroy(){super.destroy(),this.bitmap.destroy(),this.bitmap=null,this.stage=null}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}setTransform(e,t){super.setTransform(e,t),this.bitmap.transforms.dvs=this.transforms.dvs}_createTransforms(){return{dvs:(0,s.c)(),tileMat3:(0,s.c)()}}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap.stage=null}constructor(e,t,i,r,s,a=null){super(e,t,i,r,s),this.bitmap=new(0,n.RasterBitmap)(a,null,null),this.bitmap.coordScale=[r,s],this.bitmap.once("isReady",(()=>this.ready()))}}})),t.register("033AK",(function(i,r){e(i.exports,"TiledDisplayObject",(function(){return o}));var s=t("52822"),n=t("5aS5k"),a=t("fdGvv");class o extends n.DisplayObject{destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e,t){const i=t/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,a]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,l=this.height/this.rangeY*i;(0,s.s)(r,o,0,0,0,l,0,n,a,1),(0,s.m)(this.transforms.dvs,e.displayViewMat3,r)}constructor(e,t,i,r,s,n=r,o=s){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new(0,a.default)(e),this.x=t,this.y=i,this.width=r,this.height=s,this.rangeX=n,this.rangeY=o}}})),t.register("5aS5k",(function(i,r){e(i.exports,"DisplayObject",(function(){return u}));var s=t("cS4u3"),n=t("5HTPH"),a=t("1CpCt"),o=t("lHg4e");const l=1/(0,n.default)("mapview-transitions-duration");class u extends s.default{get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return(0,a.isNone)(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=(0,o.createResolver)(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=(0,o.createResolver)(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;null==(e=this.parent)||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,t){if(this.fadeTransitionEnabled){const t=this._fadeOutResolver||!this.visible?0:this.opacity,i=this.computedOpacity;if(i===t)this.computedVisible=this.visible;else{const r=e*l;this.computedOpacity=i>t?Math.max(t,i-r):Math.min(t,i+r),this.computedVisible=this.computedOpacity>0;const s=t===this.computedOpacity;this.inFadeTransition=!s,s||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}}})),t.register("htRPC",(function(i,r){e(i.exports,"default",(function(){return h}));var s=t("5HTPH"),n=t("eyQUy"),a=t("eqJSJ"),o=t("c48sV"),l=t("bVXM2");const u=(e,t)=>e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col;class h extends a.default{get requiresDedicatedFBO(){return!1}renderChildren(e){this.sortChildren(u),this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,i=super.createRenderParams(e);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),i}prepareRenderPasses(e){const t=super.prepareRenderPasses(e);return t.push(e.registerRenderPass({name:"stencil",brushes:[l.default],drawPhase:n.WGLDrawPhase.DEBUG|n.WGLDrawPhase.MAP|n.WGLDrawPhase.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,s.default)("esri-tiles-debug")&&t.push(e.registerRenderPass({name:"tileInfo",brushes:[o.default],drawPhase:n.WGLDrawPhase.DEBUG,target:()=>this.children})),t}getStencilTarget(){return this.children}updateTransforms(e){for(const t of this.children){const i=this._tileInfoView.getTileResolution(t.key);t.setTransform(e,i)}}setStencilReference(e){let t=1;for(const e of this.children)e.stencilRef=t++}constructor(e){super(),this._tileInfoView=e}}})),t.register("1cBNT",(function(i,r){e(i.exports,"BaseImageryTileSubView2D",(function(){return T}));var s=t("j6uz9");t("ixrNB");var n=t("8Y9g8"),a=t("6TszD"),o=t("1CpCt"),l=t("lHg4e"),u=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var h=t("qA6zg"),c=t("dZxPT"),d=t("1wOrp"),p=t("hCr3P"),f=t("2ia6n"),y=t("2wUG0"),v=t("2WfpR");t("liS5B");var g=t("9foJ7");t("fdGvv");var m=t("iuoYy"),x=t("hidC2"),b=t("8r0sl"),_=t("2WnyR");const w=[0,0],S=a.default.getLogger("esri.views.2d.layers.ImageryTileLayerView2D");let T=class extends n.HandleOwner{get useWebGLForProcessing(){var e;return null==(e=this._get("useWebGLForProcessing"))||e}set useWebGLForProcessing(e){this._set("useWebGLForProcessing",e)}get useProgressiveUpdate(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")}set useProgressiveUpdate(e){if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();const t=this._getCacheSize(e);this._tileStrategy=new(0,x.default)({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();const{extent:t,resolution:i,scale:r}=e.state,s=this._tileInfoView.getClosestInfoForScale(r);if(this.layer.raster){var n;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const e=this._srcResolutions[s.level],r=t.toJSON?t:_.default.fromJSON(t);(0,f.update)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,r,i,e,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null==(n=this.previousLOD)?void 0:n.level)!==s.level&&(this.previousLOD=s,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}moveEnd(){!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((()=>{this._globalUpdateRequested=!1,this.layerView.requestUpdate()})));const e=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(e),this.layerView.requestUpdate()}get updating(){return this._fetchQueue.updating||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}attach(){(0,b.getWebGL1Capabilities)().supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new(0,g.default)(this.layerView.tileInfo,this.layerView.fullExtent);const e=this._computeFetchConcurrency();this._fetchQueue=new(0,m.default)({tileInfoView:this._tileInfoView,concurrency:e,process:(e,t)=>this._fetchTile1(e,t)});const t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new(0,x.default)({cachePolicy:"purge",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),cacheSize:t,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}detach(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,f.unregister)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}acquireTile(e){const t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}releaseTile(e){this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",(()=>{e.destroy(),this.layerView.requestUpdate()})),this.layerView.requestUpdate()}createEmptyTilePixelBlock(e=null){const t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&(0,o.isSome)(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;e=e||this._tileInfoView.tileInfo.size;const[i,r]=e,s=new(0,d.default)({width:i,height:r,pixels:[new Uint8Array(i*r)],mask:new Uint8Array(i*r),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=s),s}_fetchTile1(e,t){const i=!(0,o.isNone)(t)&&t.signal,r=this.canUseWebGLForProcessing(),{layerView:s}=this,n=!s.tileInfo.isWrappable&&(0,o.isSome)((0,v.getWorldWidth)(s.view.spatialReference)),a={allowPartialFill:!0,datumTransformation:s.datumTransformation,interpolation:r?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:r,signal:(0,o.unwrap)(i),srcResolution:this._srcResolutions[e.level],timeExtent:s.timeExtent,tileInfo:s.tileInfo,disableWrapAround:n};return this.fetchTile(e,a)}_getCacheSize(e){return e?40:0}_initializeTileInfo(){const e=this.layerView.view.spatialReference,t=new(0,c.default)({x:this.layerView.fullExtent.xmin,y:this.layerView.fullExtent.ymax,spatialReference:e}),{scales:i,srcResolutions:r,isCustomTilingScheme:s}=(0,v.computeProjectedScales)(this.layer.rasterInfo,e),n=p.default.create({spatialReference:e,size:512,scales:i});(0===n.origin.x||n.origin.x>t.x)&&(n.origin=t),this._isCustomTilingScheme=s,this.layerView.set("tileInfo",n),this._srcResolutions=null!=r?r:[]}_computeFetchConcurrency(){const{blockBoundary:e}=this.layer.rasterInfo.storageInfo,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}async _enqueueTileFetch(e,t){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key),{bandIds:i}=this.layer;let r=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){r=!1;try{await this._redrawImage(this._abortController&&this._abortController.signal)}catch(e){(0,l.isAbortError)(e)&&S.error(e)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const s=this._tileInfoView.getTileCoords(w,e.key),n=this._tileInfoView.getTileResolution(e.key);await this.updateTileSource(e,{source:t,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:r,bandIds:i,coords:s,resolution:n}),e.once("attach",(()=>this.layerView.requestUpdate())),this.container.addChild(e)}catch(e){(0,l.isAbortError)(e)||S.error(e)}this.layerView.requestUpdate()}}async _redrawImage(e){if(0===this.container.children.length)return;await this.updatingHandles.addPromise(this.layer.updateRenderer()),this.layerView.hasTilingEffects?await this._updateGlobalSymbolizerParams(e):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null);const t=this.container.children.map((async e=>this.updateTileSymbolizerParameters(e,{local:this._symbolizerParams,global:this._globalSymbolizerParams})));await(0,l.eachAlways)(t),this.container.requestRender()}async _updateGlobalSymbolizerParams(e){const t={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:e},i=await this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,t);if(!i||!i.pixelBlock)return;const r=this.layer.symbolizer.generateWebGLParameters({pixelBlock:(0,y.extractBands)(i.pixelBlock,this.layer.bandIds),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds});!this.canUseWebGLForProcessing()&&r&&"stretch"===r.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(r.factor=r.factor.map((e=>255*e)),r.outMin=Math.round(255*r.outMin),r.outMax=Math.round(255*r.outMax)),this._globalSymbolizerParams=r}_updateSymbolizerParams(){this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:this.previousLOD.resolution,y:this.previousLOD.resolution},bandIds:this.layer.bandIds})}_updateBlockCacheRegistry(e=!1){const{url:t,rasterInfo:i,raster:r}=this.layer,{multidimensionalDefinition:s}=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:this.layer.multidimensionalDefinition,timeExtent:this.layerView.timeExtent}),n=null!=i&&i.multidimensionalInfo?r.getSliceIndex(s):null,a=(0,f.getRasterId)(t,n);if(a!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,f.unregister)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,f.register)(a,this.layer.raster.rasterInfo),e){const e=this._tileInfoView.getClosestInfoForScale(this.layerView.view.scale),t=this._srcResolutions[e.level];(0,f.update)(a,this._blockCacheRegistryId,this.layerView.view.extent,this.layerView.view.resolution,t,this.layer.raster.ioConfig.sampling)}this._blockCacheRegistryUrl=a}}async doRefresh(){await this.updatingHandles.addPromise(this.layer.updateRenderer()),this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset();const e=[];this._tileStrategy.tiles.forEach((t=>e.push(this._enqueueTileFetch(t)))),await(0,l.eachAlways)(e)}constructor(){super(...arguments),this._emptyTilePixelBlock=null,this._tileStrategy=null,this._tileInfoView=null,this._fetchQueue=null,this._blockCacheRegistryUrl=null,this._blockCacheRegistryId=null,this._srcResolutions=null,this.previousLOD=null,this._needBlockCacheUpdate=!1,this._globalSymbolizerParams=null,this._symbolizerParams=null,this._abortController=null,this._isCustomTilingScheme=!1,this._globalUpdateRequested=!1,this.attached=!1,this.container=null,this.layer=null,this.timeExtent=null,this.redrawOrRefetch=(0,l.debounce)(((e,t)=>!this.previousLOD||this.layerView.suspended?Promise.resolve():e?this.doRefresh():this._redrawImage(t)))}};(0,s._)([(0,u.property)()],T.prototype,"_fetchQueue",void 0),(0,s._)([(0,u.property)()],T.prototype,"_globalUpdateRequested",void 0),(0,s._)([(0,u.property)()],T.prototype,"attached",void 0),(0,s._)([(0,u.property)()],T.prototype,"container",void 0),(0,s._)([(0,u.property)()],T.prototype,"layer",void 0),(0,s._)([(0,u.property)()],T.prototype,"layerView",void 0),(0,s._)([(0,u.property)()],T.prototype,"type",void 0),(0,s._)([(0,u.property)()],T.prototype,"useWebGLForProcessing",null),(0,s._)([(0,u.property)()],T.prototype,"useProgressiveUpdate",null),(0,s._)([(0,u.property)()],T.prototype,"timeExtent",void 0),(0,s._)([(0,u.property)()],T.prototype,"updating",null),T=(0,s._)([(0,h.subclass)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],T)})),t.register("2ia6n",(function(i,r){e(i.exports,"getRasterId",(function(){return h})),e(i.exports,"register",(function(){return c})),e(i.exports,"unregister",(function(){return d})),e(i.exports,"decreaseRefCount",(function(){return p})),e(i.exports,"getBlock",(function(){return f})),e(i.exports,"putBlock",(function(){return y})),e(i.exports,"deleteBlock",(function(){return v})),e(i.exports,"update",(function(){return g})),t("ixrNB");var s=t("1CpCt"),n=t("230S6"),a=t("2WfpR"),o=t("dZxPT");const l=new Map,u=new(0,n.default);function h(e,t){return null==t?e:`${e}?sliceId=${t}`}function c(e,t){const i={extent:null,rasterInfo:t,cache:new Map};if(l.has(e)){const t=l.get(e);return t.push(i),t.length-1}return l.set(e,[i]),0}function d(e,t){if(l.has(e)){const i=l.get(e);i[t]=null,i.some((e=>null!=e))||l.delete(e)}}function p(e,t,i){if(!l.has(e))return null==t?u.decreaseRefCount(e,i):0;const r=l.get(e);if(null==r[t])return u.decreaseRefCount(e,i);const s=r[t].cache;if(s.has(i)){const e=s.get(i);if(e.refCount--,0===e.refCount){s.delete(i);for(let e=0;e<r.length;e++)r[e]&&r[e].cache.has(i)&&r[e].cache.delete(i);e.controller&&e.controller.abort()}return e.refCount}return 0}function f(e,t,i){if(!l.has(e))return null==t?u.getBlock(e,i):null;const r=l.get(e);if(null==r[t]){for(let e=0;e<r.length;e++)if(r[e]&&r[e].cache.has(i)){const t=r[e].cache.get(i);return t.refCount++,t.block}return u.getBlock(e,i)}const s=r[t].cache;if(s.has(i)){const e=s.get(i);return e.refCount++,e.block}for(let e=0;e<r.length;e++)if(e!==t&&r[e]&&r[e]&&r[e].cache.has(i)){const t=r[e].cache.get(i);return t.refCount++,s.set(i,t),t.block}return null}function y(e,t,i,r,s=null){if(!l.has(e))return void(null==t&&u.putBlock(e,i,r,s));const n=l.get(e);if(null==n[t])return void u.putBlock(e,i,r,s);const a={refCount:1,block:r,isResolved:!1,isRejected:!1,controller:s};r.then((()=>a.isResolved=!0)).catch((()=>a.isRejected=!0)),n[t].cache.set(i,a)}function v(e,t,i){if(!l.has(e))return void(null==t&&u.deleteBlock(e,i));const r=l.get(e);null!=r[t]?r[t].cache.delete(i):u.deleteBlock(e,i)}function g(e,t,i,r,n,u,h=null){const c=function(e,t){if(!l.has(e))return null;const i=l.get(e);return null==i[t]?null:i[t]}(e,t),d=c.extent,{cache:p,rasterInfo:f}=c;if(d&&d.xmin===i.xmin&&d.xmax===i.xmax&&d.ymin===i.ymin&&d.ymax===i.ymax)return;const y=i.clone().normalize(),{spatialReference:v,transform:g}=f,m=new Set;for(let e=0;e<y.length;e++){const t=y[e];if(t.xmax-t.xmin<=r||t.ymax-t.ymin<=r)continue;let i=(0,a.projectExtent)(t,v,h);(0,s.isSome)(g)&&(i=g.inverseTransform(i));const l=new(0,o.default)({x:r,y:r,spatialReference:t.spatialReference});if(null==n&&!(n=(0,a.projectResolution)(l,v,t,h)))return;const{pyramidLevel:c,pyramidResolution:d,excessiveReading:p}=(0,a.snapPyramid)(n,f,u||"closest");if(p)return;const{storageInfo:x}=f,{origin:b}=x,_={x:Math.max(0,Math.floor((i.xmin-b.x)/d.x)),y:Math.max(0,Math.floor((b.y-i.ymax)/d.y))},w=Math.ceil((i.xmax-i.xmin)/d.x-.1),S=Math.ceil((i.ymax-i.ymin)/d.y-.1),T=c>0?x.pyramidBlockWidth:x.blockWidth,V=c>0?x.pyramidBlockHeight:x.blockHeight,R=1,P=Math.max(0,Math.floor(_.x/T)-R),I=Math.max(0,Math.floor(_.y/V)-R),C=Math.floor((_.x+w-1)/T)+R,L=Math.floor((_.y+S-1)/V)+R;for(let e=I;e<=L;e++)for(let t=P;t<=C;t++)m.add(`${c}/${e}/${t}`)}p.forEach(((e,t)=>{if(!m.has(t)){const e=p.get(t);(null==e||e.isResolved||e.isRejected)&&p.delete(t)}})),c.extent={xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax}}})),t.register("230S6",(function(t,i){e(t.exports,"default",(function(){return r}));class r{decreaseRefCount(e,t){const i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){const e=r.get(i);return e.refCount--,e.refCount<=0&&(r.delete(i),e.controller&&e.controller.abort()),e.refCount}return 0}getBlock(e,t){const i=e+"/"+t,r=this._cachedBlocks;if(r.has(i)){const e=r.get(i);return e.ts=Date.now(),e.refCount++,r.delete(i),r.set(i,e),e.block}return null}putBlock(e,t,i,r=null){const s=this._cachedBlocks,n=e+"/"+t;if(s.has(n)){const e=s.get(n);e.ts=Date.now(),e.refCount++}else s.set(n,{block:i,ts:Date.now(),refCount:1,controller:r});this._trim(),this._updateTimer()}deleteBlock(e,t){const i=this._cachedBlocks,r=e+"/"+t;i.has(r)&&i.delete(r)}updateMaxSize(e){this._size=e,this._trim()}empty(){this._cachedBlocks.clear(),this._clearTimer()}getCurrentSize(){return this._cachedBlocks.size}_updateTimer(){if(null!=this._timer)return;const e=this._cachedBlocks;this._timer=setInterval((()=>{const t=Array.from(e),i=Date.now();for(let r=0;r<t.length&&t[r][1].ts<=i-this._duration;r++)e.delete(t[r][0]);0===e.size&&this._clearTimer()}),this._interval)}_trim(){const e=this._cachedBlocks;if(-1===this._size||this._size>=e.size)return;const t=Array.from(e);for(let i=0;i<t.length-this._size;i++)e.delete(t[i][0])}_clearTimer(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}constructor(e=15e3,t=5e3){this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=e,this._interval=Math.min(e,t)}}})),t.register("8it4a",(function(i,r){e(i.exports,"toJSONGeometryType",(function(){return n})),e(i.exports,"canUseMajorityInterpolationOnDataSource",(function(){return a}));const s=new(0,t("4jlRt").JSONMap)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function n(e){return s.toJSON(e)}function a(e){const{bandCount:t,attributeTable:i,colormap:r,pixelType:s}=e.rasterInfo;return 1===t&&(null!=i||null!=r||"u8"===s||"s8"===s)}})),t.register("l0KI8",(function(i,r){e(i.exports,"default",(function(){return p}));var s=t("j6uz9"),n=t("1CpCt"),a=t("cc23H"),o=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var l=t("qA6zg"),u=t("dqihR"),h=t("1fseN"),c=t("1cBNT");let d=class extends c.BaseImageryTileSubView2D{canUseWebGLForProcessing(){return!1}async fetchTile(e,t){t={...t,interpolation:"nearest",requestProjectedLocalDirections:!0};const i=await this.layer.fetchTile(e.level,e.row,e.col,t);return"vector-magdir"===this.layer.rasterInfo.dataType&&null!=i&&i.pixelBlock&&(i.pixelBlock=await this.layer.convertVectorFieldData(i.pixelBlock,t)),i}updateTileSource(e,t){const i=t.symbolizerParams,{tileData:r}=e;r.key=e.key,r.width=this._tileInfoView.tileInfo.size[0],r.height=this._tileInfoView.tileInfo.size[1];const{symbolTileSize:s}=i,{source:a}=t;if(r.offset=this._getTileSymbolOffset(r.key,s),(0,n.isSome)(a)&&(0,n.isSome)(a.pixelBlock)){const e={extent:a.extent,pixelBlock:a.pixelBlock};r.rawPixelData=e,r.symbolizerParameters=i,r.source=this._sampleVectorFieldData(a.pixelBlock,i,r.offset)}else{const e=[Math.round((this._tileInfoView.tileInfo[0]-r.offset[0])/s),Math.round((this._tileInfoView.tileInfo[1]-r.offset[1])/s)],t=this.createEmptyTilePixelBlock(e);r.source=t,r.symbolizerParameters=i}return r.invalidateVAO(),Promise.resolve(null)}updateTileSymbolizerParameters(e,t){var i;const r=t.local,{symbolTileSize:s}=r,{tileData:a}=e;a.offset=this._getTileSymbolOffset(a.key,s);const o=a.symbolizerParameters.symbolTileSize;return a.symbolizerParameters=r,(0,n.isSome)(null==(i=a.rawPixelData)?void 0:i.pixelBlock)&&o!==s&&(a.source=this._sampleVectorFieldData(a.rawPixelData.pixelBlock,a.symbolizerParameters,a.offset)),Promise.resolve(null)}attach(){super.attach(),this.container=new(0,h.RasterVFTileContainer)(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=(0,a.watch)((()=>this.layer.renderer),(e=>this._updateSymbolType(e)))}detach(){super.detach(),this.container.removeAllChildren(),this._handle.remove(),this._handle=null}_getTileSymbolOffset(e,t){const i=e.col*this._tileInfoView.tileInfo.size[0]%t,r=e.row*this._tileInfoView.tileInfo.size[1]%t;return[i>t/2?t-i:-i,r>t/2?t-r:-r]}_sampleVectorFieldData(e,t,i){const{symbolTileSize:r}=t;return(0,u.sampleVectorField)(e,"vector-uv",r,i)}_updateSymbolType(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}constructor(){super(...arguments),this._handle=null,this.container=null,this.layer=null,this.type="rasterVF"}};(0,s._)([(0,o.property)()],d.prototype,"container",void 0),(0,s._)([(0,o.property)()],d.prototype,"layer",void 0),(0,s._)([(0,o.property)()],d.prototype,"type",void 0),d=(0,s._)([(0,l.subclass)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],d);const p=d})),t.register("1fseN",(function(i,r){e(i.exports,"RasterVFTileContainer",(function(){return u}));var s=t("19dbe"),n=t("adROs"),a=t("dcBDi"),o=t("eyQUy"),l=t("htRPC");class u extends l.default{createTile(e){const t=this._tileInfoView.getTileBounds((0,s.create)(),e),[i,r]=this._tileInfoView.tileInfo.size;return new(0,a.RasterVFTile)(e,t[0],t[3],i,r)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"imagery (vf tile)",brushes:[n.default],target:()=>this.children.map((e=>e.tileData)),drawPhase:o.WGLDrawPhase.MAP});return[...super.prepareRenderPasses(e),t]}doRender(e){this.visible&&e.drawPhase===o.WGLDrawPhase.MAP&&this.symbolTypes.forEach((t=>{e.renderPass=t,super.doRender(e)}))}constructor(){super(...arguments),this.isCustomTilingScheme=!1,this.symbolTypes=["triangle"]}}})),t.register("dcBDi",(function(i,r){e(i.exports,"RasterVFTile",(function(){return l}));var s=t("52822"),n=t("jsolS"),a=t("fYJER"),o=t("033AK");class l extends o.TiledDisplayObject{destroy(){super.destroy(),this.tileData.destroy(),this.tileData=null,this.stage=null}set stencilRef(e){this.tileData.stencilRef=e}get stencilRef(){return this.tileData.stencilRef}_createTransforms(){return{dvs:(0,n.c)(),tileMat3:(0,n.c)()}}setTransform(e,t){super.setTransform(e,t);const i=t/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,a]=this.tileData.offset,o=[this.x+n*t,this.y-a*t],[l,u]=e.toScreenNoRotation([0,0],o),{symbolTileSize:h}=this.tileData.symbolizerParameters,c=Math.round((this.width-this.tileData.offset[0])/h)*h,d=Math.round((this.height-this.tileData.offset[1])/h)*h,p=c/this.rangeX*i,f=d/this.rangeY*i;(0,s.s)(r,p,0,0,0,f,0,l,u,1),(0,s.m)(this.transforms.dvs,e.displayViewMat3,r),this.tileData.transforms.dvs=this.transforms.dvs}onAttach(){this.tileData.stage=this.stage}onDetach(){this.tileData.stage=null}constructor(e,t,i,r,s,n=null){super(e,t,i,r,s),this.tileData=new(0,a.RasterVFDisplayObject)(n),this.tileData.coordScale=[r,s],this.tileData.once("isReady",(()=>this.ready()))}}})),t.register("54zEM",(function(i,r){e(i.exports,"ImageryTileLayerView",(function(){return p}));var s=t("j6uz9"),n=t("EvxpF"),a=t("bPmsI"),o=t("1CpCt"),l=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var u=t("qA6zg"),h=t("lixLM"),c=t("2WfpR"),d=t("6hadY");const p=e=>{let t=class extends e{get fullExtent(){return this._getfullExtent()}_getfullExtent(){return this.projectFullExtent(this.view.spatialReference)}get hasTilingEffects(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}get datumTransformation(){return(0,c.getDefaultDatumTransformationForDataset)((0,o.unwrap)(this.layer.fullExtent),this.view.spatialReference,!0)}supportsSpatialReference(e){return!!this.projectFullExtent(e)}projectFullExtent(e){const t=(0,o.unwrap)(this.layer.fullExtent),i=(0,c.getDefaultDatumTransformationForDataset)(t,e,!1);return(0,c.projectExtent)(t,e,i)}async fetchPopupFeatures(e,t){const{layer:i}=this;if(!e)return Promise.reject(new(0,a.default)("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:i}));const{popupEnabled:r}=i,s=(0,d.getFetchPopupTemplate)(i,t);if(!r||!(0,o.isSome)(s))throw new(0,a.default)("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:r,popupTemplate:s});const l=[],{value:u,magdirValue:h}=await i.identify(e,{timeExtent:this.timeExtent});let c="";if(u&&u.length){var p,f;c="imagery-tile"===i.type&&i.hasStandardTime()&&null!=u[0]?u.map((e=>i.getStandardTimeValue(e))).join(", "):u.join(", ");const e={ObjectId:0},t="Raster.ServicePixelValue";e[t]=this._formatAttributeValue(c,t);const r=null==(p=i.rasterInfo)||null==(f=p.attributeTable)?void 0:f.features;if(r&&r.length>0){const t=r.filter((e=>{const t=e.attributes.value||e.attributes.Value||e.attributes.VALUE;return String(t)===c}));if(t.length>0){const i=t[0];if(i)for(const t in i.attributes)if(i.attributes.hasOwnProperty(t)){const r=this._rasterFieldPrefix+t;e[r]=this._formatAttributeValue(i.attributes[t],r)}}}const s=i.rasterInfo.dataType;"vector-magdir"!==s&&"vector-uv"!==s||(e["Raster.Magnitude"]=null==h?void 0:h[0],e["Raster.Direction"]=null==h?void 0:h[1]);const a=new(0,n.default)(this.fullExtent.clone(),null,e);a.layer=i,a.sourceLayer=a.layer,l.push(a)}return l}_formatAttributeValue(e,t){if("string"==typeof e){const i=this.layer.popupTemplate&&this.layer.popupTemplate.fieldInfos,r=this._getFieldInfo(i,t),s=r&&r.format;if(s){let t,i;return e.trim().indexOf(",")>-1?(t=",",i=t+" ",this._formatDelimitedString(e,t,i,s)):e.trim().indexOf(" ")>-1?(t=i=" ",this._formatDelimitedString(e,t,i,s)):this._formatNumberFromString(e,s)}}return e}_getFieldInfo(e,t){if(!e||!e.length||!t)return;const i=t.toLowerCase();let r;return e.some((e=>!(!e.fieldName||e.fieldName.toLowerCase()!==i&&e.fieldName.toLowerCase()!==i.replace(/ /g,"_")||(r=e,0)))),r}_formatDelimitedString(e,t,i,r){return e&&t&&i&&r?e.trim().split(t).map((e=>this._formatNumberFromString(e,r))).join(i):e}_formatNumberFromString(e,t){if(!e||!t)return e;const i=Number(e);return isNaN(i)?e:t.format(i)}constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}};return(0,s._)([(0,l.property)()],t.prototype,"layer",void 0),(0,s._)([(0,l.property)(h.combinedViewLayerTimeExtentProperty)],t.prototype,"timeExtent",void 0),(0,s._)([(0,l.property)()],t.prototype,"view",void 0),(0,s._)([(0,l.property)()],t.prototype,"fullExtent",null),(0,s._)([(0,l.property)()],t.prototype,"tileInfo",void 0),(0,s._)([(0,l.property)({readOnly:!0})],t.prototype,"hasTilingEffects",null),t=(0,s._)([(0,u.subclass)("esri.views.layers.ImageryTileLayerView")],t),t}})),t.register("6hadY",(function(i,r){e(i.exports,"getRequiredFields",(function(){return a})),e(i.exports,"getFetchPopupTemplate",(function(){return o}));var s=t("1CpCt"),n=t("15IfA");async function a(e,t=e.popupTemplate){if(!(0,s.isSome)(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:r}=t,{objectIdField:a,typeIdField:o,globalIdField:l,relationships:u}=e;if(i.includes("*"))return["*"];const h=r?await(0,n.getFeatureEditFields)(e):[],c=(0,n.fixFields)(e.fieldsIndex,[...i,...h]);return o&&c.push(o),c&&a&&e.fieldsIndex.has(a)&&-1===c.indexOf(a)&&c.push(a),c&&l&&e.fieldsIndex.has(l)&&-1===c.indexOf(l)&&c.push(l),u&&u.forEach((t=>{const{keyField:i}=t;c&&i&&e.fieldsIndex.has(i)&&-1===c.indexOf(i)&&c.push(i)})),c}function o(e,t){return e.popupTemplate?e.popupTemplate:(0,s.isSome)(t)&&t.defaultPopupTemplateEnabled&&(0,s.isSome)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}})),t.register("aDxLR",(function(i,r){e(i.exports,"RefreshableLayerView",(function(){return h}));var s=t("j6uz9"),n=t("6TszD"),a=t("lHg4e"),o=t("cc23H"),l=t("hTI69");t("aX9sh"),t("5HTPH"),t("gHCNy");var u=t("qA6zg");const h=e=>{let t=class extends e{initialize(){this.handles.add((0,o.on)((()=>this.layer),"refresh",(e=>{this.doRefresh(e.dataChanged).catch((e=>{(0,a.isAbortError)(e)||n.default.getLogger(this.declaredClass).error(e)}))})),"RefreshableLayerView")}};return(0,s._)([(0,l.property)()],t.prototype,"layer",void 0),t=(0,s._)([(0,u.subclass)("esri.layers.mixins.RefreshableLayerView")],t),t}})),t.register("3mbeV",(function(t,i){e(t.exports,"u32to4Xu8",(function(){return s})),e(t.exports,"i1616to32",(function(){return n})),e(t.exports,"i8888to32",(function(){return a}));const r=new Float32Array(1);new Uint32Array(r.buffer);function s(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function n(e,t){return 65535&e|t<<16}function a(e,t,i,r){return 255&e|(255&t)<<8|(255&i)<<16|r<<24}})),t.register("bVIMy",(function(t,i){var r,s,n,a;function o(e){switch(e){case"left":return r.Left;case"right":return r.Right;case"center":case"justify":return r.Center}}function l(e){switch(e){case"top":return s.Top;case"middle":return s.Center;case"baseline":return s.Baseline;case"bottom":return s.Bottom}}function u(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return[r.Right,s.Bottom];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return[r.Center,s.Bottom];case"above-right":case"esriServerPointLabelPlacementAboveRight":return[r.Left,s.Bottom];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return[r.Right,s.Center];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return[r.Center,s.Center];case"center-right":case"esriServerPointLabelPlacementCenterRight":return[r.Left,s.Center];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return[r.Right,s.Top];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return[r.Center,s.Top];case"below-right":case"esriServerPointLabelPlacementBelowRight":return[r.Left,s.Top];default:return console.debug(`Found invalid placement type ${e}`),[r.Center,s.Center]}}function h(e){switch(e){case r.Right:return-1;case r.Center:return 0;case r.Left:return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}}function c(e){switch(e){case s.Top:return 1;case s.Center:return 0;case s.Bottom:case s.Baseline:return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}}function d(e){switch(e){case"left":return r.Left;case"right":return r.Right;case"center":case"justify":return r.Center}}function p(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}e(t.exports,"HAlign",(function(){return r})),e(t.exports,"VAlign",(function(){return s})),e(t.exports,"getXAnchorDirection",(function(){return o})),e(t.exports,"getYAnchorDirection",(function(){return l})),e(t.exports,"getAlignmentFromPlacement",(function(){return u})),e(t.exports,"getXDirection",(function(){return h})),e(t.exports,"getYDirection",(function(){return c})),e(t.exports,"getJustification",(function(){return d})),e(t.exports,"isMapAligned",(function(){return p})),(a=r||(r={}))[a.Left=-1]="Left",a[a.Center=0]="Center",a[a.Right=1]="Right",(n=s||(s={}))[n.Top=1]="Top",n[n.Center=0]="Center",n[n.Bottom=-1]="Bottom",n[n.Baseline=2]="Baseline"})),t.register("eDdav",(function(i,r){e(i.exports,"createMaterialKey",(function(){return o})),e(i.exports,"FillMaterialKey",(function(){return p})),e(i.exports,"LineMaterialKey",(function(){return y})),e(i.exports,"MarkerMaterialKey",(function(){return f})),e(i.exports,"TextMaterialKey",(function(){return v})),e(i.exports,"LabelMaterialKey",(function(){return g})),e(i.exports,"MaterialKeyBase",(function(){return l}));var s=t("bPmsI"),n=t("bVIMy"),a=t("eyQUy");function o(e,t){switch(e){case a.WGLGeometryType.FILL:return p.from(t);case a.WGLGeometryType.LINE:return y.from(t);case a.WGLGeometryType.MARKER:return f.from(t);case a.WGLGeometryType.TEXT:return v.from(t);case a.WGLGeometryType.LABEL:return g.from(t);default:throw new Error(`Unable to createMaterialKey for unknown geometryType ${e}`)}}class l{static load(e){const t=this.shared;return t.data=e,t}set data(e){this._data=e}get data(){return this._data}get geometryType(){return this.bits(8,11)}set geometryType(e){this.setBits(e,8,11)}get mapAligned(){return!!this.bit(20)}set mapAligned(e){this.setBit(20,e)}get sdf(){return!!this.bit(11)}set sdf(e){this.setBit(11,e)}get pattern(){return!!this.bit(12)}set pattern(e){this.setBit(12,e)}get textureBinding(){return this.bits(0,8)}set textureBinding(e){this.setBits(e,0,8)}get geometryTypeString(){switch(this.geometryType){case a.WGLGeometryType.FILL:return"fill";case a.WGLGeometryType.MARKER:return"marker";case a.WGLGeometryType.LINE:return"line";case a.WGLGeometryType.TEXT:return"text";case a.WGLGeometryType.LABEL:return"label";default:throw new(0,s.default)(`Unable to handle unknown geometryType: ${this.geometryType}`)}}setBit(e,t){const i=1<<e;t?this._data|=i:this._data&=~i}bit(e){return(this._data&1<<e)>>e}setBits(e,t,i){for(let r=t,s=0;r<i;r++,s++)this.setBit(r,0!=(e&1<<s))}bits(e,t){let i=0;for(let r=e,s=0;r<t;r++,s++)i|=this.bit(r)<<s;return i}hasVV(){return!1}setVV(e,t){}getVariation(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}getVariationHash(){return this._data&~(7&this.textureBinding)}constructor(e){this._data=0,this._data=e}}l.shared=new l(0);const u=e=>class extends e{get vvSizeMinMaxValue(){return 0!==this.bit(16)}set vvSizeMinMaxValue(e){this.setBit(16,e)}get vvSizeScaleStops(){return 0!==this.bit(17)}set vvSizeScaleStops(e){this.setBit(17,e)}get vvSizeFieldStops(){return 0!==this.bit(18)}set vvSizeFieldStops(e){this.setBit(18,e)}get vvSizeUnitValue(){return 0!==this.bit(19)}set vvSizeUnitValue(e){this.setBit(19,e)}hasVV(){return super.hasVV()||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}setVV(e,t){super.setVV(e,t);const i=function(e,t){const i=a.WGLVVFlag.SIZE_FIELD_STOPS|a.WGLVVFlag.SIZE_MINMAX_VALUE|a.WGLVVFlag.SIZE_SCALE_STOPS|a.WGLVVFlag.SIZE_UNIT_VALUE,r=(e&(a.WGLVVTarget.FIELD_TARGETS_OUTLINE|a.WGLVVTarget.MINMAX_TARGETS_OUTLINE|a.WGLVVTarget.SCALE_TARGETS_OUTLINE|a.WGLVVTarget.UNIT_TARGETS_OUTLINE))>>>4;return t.isOutline||t.isOutlinedFill?i&r:i&~r}(e,t)&e;this.vvSizeMinMaxValue=!!(i&a.WGLVVFlag.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(i&a.WGLVVFlag.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(i&a.WGLVVFlag.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(i&a.WGLVVFlag.SIZE_SCALE_STOPS)}},h=e=>class extends e{get vvRotation(){return 0!==this.bit(15)}set vvRotation(e){this.setBit(15,e)}hasVV(){return super.hasVV()||this.vvRotation}setVV(e,t){super.setVV(e,t),this.vvRotation=!t.isOutline&&!!(e&a.WGLVVFlag.ROTATION)}},c=e=>class extends e{get vvColor(){return 0!==this.bit(13)}set vvColor(e){this.setBit(13,e)}hasVV(){return super.hasVV()||this.vvColor}setVV(e,t){super.setVV(e,t),this.vvColor=!t.isOutline&&!!(e&a.WGLVVFlag.COLOR)}},d=e=>class extends e{get vvOpacity(){return 0!==this.bit(14)}set vvOpacity(e){this.setBit(14,e)}hasVV(){return super.hasVV()||this.vvOpacity}setVV(e,t){super.setVV(e,t),this.vvOpacity=!t.isOutline&&!!(e&a.WGLVVFlag.OPACITY)}};class p extends(c(d(u(l)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.FILL,t.dotDensity="dot-density"===e.stride.fill,t.simple="simple"===e.stride.fill,t.outlinedFill=e.isOutlinedFill,t.dotDensity||t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),dotDensity:this.dotDensity,outlinedFill:this.outlinedFill,simple:this.simple,vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}get dotDensity(){return!!this.bit(15)}set dotDensity(e){this.setBit(15,e)}get simple(){return!!this.bit(22)}set simple(e){this.setBit(22,e)}get outlinedFill(){return!!this.bit(21)}set outlinedFill(e){this.setBit(21,e)}}p.shared=new p(0);class f extends(c(d(h(u(l))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.MARKER,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}f.shared=new f(0);class y extends(c(d(u(l)))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.LINE,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}y.shared=new y(0);class v extends(c(d(h(u(l))))){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.TEXT,t.setVV(e.vvFlags,e),t.data}getVariation(){return{...super.getVariation(),vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}v.shared=new v(0);class g extends(u(l)){static load(e){const t=this.shared;return t.data=e,t}static from(e){const t=this.load(0);return t.geometryType=a.WGLGeometryType.LABEL,t.setVV(e.vvFlags,e),t.mapAligned=(0,n.isMapAligned)(e.placement),t.data}getVariation(){return{...super.getVariation(),vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue}}}g.shared=new g(0)})),t.register("c4cvq",(function(t,i){e(t.exports,"radToByte",(function(){return o})),e(t.exports,"degToByte",(function(){return l})),e(t.exports,"log2",(function(){return u})),e(t.exports,"between",(function(){return h}));Number.POSITIVE_INFINITY;const r=Math.PI,s=128/r,n=1/Math.LN2;function a(e,t){return(e%=t)>=0?e:e+t}function o(e){return a(e*s,256)}function l(e){return a(.7111111111111111*e,256)}function u(e){return Math.log(e)*n}function h(e,t,i){return e>=t&&e<=i||e>=i&&e<=t}})),t.register("3Icya",(function(t,i){e(t.exports,"e",(function(){return a}));var r,s,n={exports:{}};r=n,void 0!==(s=function(){function e(e,s,n){n=n||2;var a,o,u,c,d,f,y,v=s&&s.length,g=v?s[0]*n:e.length,m=t(e,0,g,n,!0),x=[];if(!m||m.next===m.prev)return x;if(v&&(m=function(e,r,s,n){var a,o,u,c=[];for(a=0,o=r.length;a<o;a++)(u=t(e,r[a]*n,a<o-1?r[a+1]*n:e.length,n,!1))===u.next&&(u.steiner=!0),c.push(p(u));for(c.sort(l),a=0;a<c.length;a++)s=i(s=h(c[a],s),s.next);return s}(e,s,m,n)),e.length>80*n){a=u=e[0],o=c=e[1];for(var b=n;b<g;b+=n)(d=e[b])<a&&(a=d),(f=e[b+1])<o&&(o=f),d>u&&(u=d),f>c&&(c=f);y=0!==(y=Math.max(u-a,c-o))?1/y:0}return r(m,x,n,a,o,y),x}function t(e,t,i,r,s){var n,a;if(s===V(e,t,i,r)>0)for(n=t;n<i;n+=r)a=w(n,e[n],e[n+1],a);else for(n=i-r;n>=t;n-=r)a=w(n,e[n],e[n+1],a);if(a&&v(a,a.next)){var o=a.next;S(a),a=o}return a}function i(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!v(r,r.next)&&0!==y(r.prev,r,r.next))r=r.next;else{var s=r.prev;if(S(r),(r=t=s)===r.next)break;i=!0}}while(i||r!==t);return t}function r(e,t,l,u,h,c,p){if(e){!p&&c&&function(e,t,i,r){var s=e;do{null===s.z&&(s.z=d(s.x,s.y,t,i,r)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){var t,i,r,s,n,a,o,l,u=1;do{for(i=e,e=null,n=null,a=0;i;){for(a++,r=i,o=0,t=0;t<u&&(o++,r=r.nextZ);t++);for(l=u;o>0||l>0&&r;)0!==o&&(0===l||!r||i.z<=r.z)?(s=i,i=i.nextZ,o--):(s=r,r=r.nextZ,l--),n?n.nextZ=s:e=s,s.prevZ=n,n=s;i=r}n.nextZ=null,u*=2}while(a>1)}(s)}(e,u,h,c);for(var f,y,v=e;e.prev!==e.next;)if(f=e.prev,y=e.next,c?n(e,u,h,c):s(e))t.push(f.i/l),t.push(e.i/l),t.push(y.i/l),S(e),e=y.next,v=y.next;else if((e=y)===v){p?1===p?r(e=a(i(e),t,l),t,l,u,h,c,2):2===p&&o(e,t,l,u,h,c):r(i(e),t,l,u,h,c,1);break}}}function s(e){var t=e.prev,i=e,r=e.next;if(y(t,i,r)>=0)return!1;for(var s=e.next.next;s!==e.prev;){if(f(t.x,t.y,i.x,i.y,r.x,r.y,s.x,s.y)&&y(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function n(e,t,i,r){var s=e.prev,n=e,a=e.next;if(y(s,n,a)>=0)return!1;for(var o=s.x<n.x?s.x<a.x?s.x:a.x:n.x<a.x?n.x:a.x,l=s.y<n.y?s.y<a.y?s.y:a.y:n.y<a.y?n.y:a.y,u=s.x>n.x?s.x>a.x?s.x:a.x:n.x>a.x?n.x:a.x,h=s.y>n.y?s.y>a.y?s.y:a.y:n.y>a.y?n.y:a.y,c=d(o,l,t,i,r),p=d(u,h,t,i,r),v=e.prevZ,g=e.nextZ;v&&v.z>=c&&g&&g.z<=p;){if(v!==e.prev&&v!==e.next&&f(s.x,s.y,n.x,n.y,a.x,a.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,g!==e.prev&&g!==e.next&&f(s.x,s.y,n.x,n.y,a.x,a.y,g.x,g.y)&&y(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;v&&v.z>=c;){if(v!==e.prev&&v!==e.next&&f(s.x,s.y,n.x,n.y,a.x,a.y,v.x,v.y)&&y(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;g&&g.z<=p;){if(g!==e.prev&&g!==e.next&&f(s.x,s.y,n.x,n.y,a.x,a.y,g.x,g.y)&&y(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function a(e,t,r){var s=e;do{var n=s.prev,a=s.next.next;!v(n,a)&&g(n,s,s.next,a)&&b(n,a)&&b(a,n)&&(t.push(n.i/r),t.push(s.i/r),t.push(a.i/r),S(s),S(s.next),s=e=a),s=s.next}while(s!==e);return i(s)}function o(e,t,s,n,a,o){var l,u,h=e;do{for(var c=h.next.next;c!==h.prev;){if(h.i!==c.i&&(u=c,(l=h).next.i!==u.i&&l.prev.i!==u.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&g(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(l,u)&&(b(l,u)&&b(u,l)&&function(e,t){var i=e,r=!1,s=(e.x+t.x)/2,n=(e.y+t.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&s<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(l,u)&&(y(l.prev,l,u.prev)||y(l,u.prev,u))||v(l,u)&&y(l.prev,l,l.next)>0&&y(u.prev,u,u.next)>0))){var d=_(h,c);return h=i(h,h.next),d=i(d,d.next),r(h,t,s,n,a,o),void r(d,t,s,n,a,o)}c=c.next}h=h.next}while(h!==e)}function l(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function h(e,t){var r=function(e,t){var i,r=t,s=e.x,n=e.y,a=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var o=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=s&&o>a){if(a=o,o===s){if(n===r.y)return r;if(n===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(s===a)return i;var l,u=i,h=i.x,d=i.y,p=1/0;r=i;do{s>=r.x&&r.x>=h&&s!==r.x&&f(n<d?s:a,n,h,d,n<d?a:s,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(s-r.x),b(r,e)&&(l<p||l===p&&(r.x>i.x||r.x===i.x&&c(i,r)))&&(i=r,p=l)),r=r.next}while(r!==u);return i}(e,t);if(!r)return t;var s=_(r,e),n=i(r,r.next);let a=u(s);return i(a,a.next),n=u(n),u(t===r?n:t)}function c(e,t){return y(e.prev,e,t.prev)<0&&y(t.next,e,e.next)<0}function d(e,t,i,r,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function f(e,t,i,r,s,n,a,o){return(s-a)*(t-o)-(e-a)*(n-o)>=0&&(e-a)*(r-o)-(i-a)*(t-o)>=0&&(i-a)*(n-o)-(s-a)*(r-o)>=0}function y(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function g(e,t,i,r){var s=x(y(e,t,i)),n=x(y(e,t,r)),a=x(y(i,r,e)),o=x(y(i,r,t));return s!==n&&a!==o||!(0!==s||!m(e,i,t))||!(0!==n||!m(e,r,t))||!(0!==a||!m(i,e,r))||!(0!==o||!m(i,t,r))}function m(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function x(e){return e>0?1:e<0?-1:0}function b(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function _(e,t){var i=new T(e.i,e.x,e.y),r=new T(t.i,t.x,t.y),s=e.next,n=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,r.next=i,i.prev=r,n.next=r,r.prev=n,r}function w(e,t,i,r){var s=new T(e,t,i);return r?(s.next=r.next,s.prev=r,r.next.prev=s,r.next=s):(s.prev=s,s.next=s),s}function S(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function V(e,t,i,r){for(var s=0,n=t,a=i-r;n<i;n+=r)s+=(e[a]-e[n])*(e[n+1]+e[a+1]),a=n;return s}return e.deviation=function(e,t,i,r){var s=t&&t.length,n=s?t[0]*i:e.length,a=Math.abs(V(e,0,n,i));if(s)for(var o=0,l=t.length;o<l;o++){var u=t[o]*i,h=o<l-1?t[o+1]*i:e.length;a-=Math.abs(V(e,u,h,i))}var c=0;for(o=0;o<r.length;o+=3){var d=r[o]*i,p=r[o+1]*i,f=r[o+2]*i;c+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},e.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,s=0;s<e.length;s++){for(var n=0;n<e[s].length;n++)for(var a=0;a<t;a++)i.vertices.push(e[s][n][a]);s>0&&(r+=e[s-1].length,i.holes.push(r))}return i},e}())&&(r.exports=s);const a=n.exports})),t.register("iqtPh",(function(t,i){e(t.exports,"DECLUTTER_TILES",(function(){return r})),e(t.exports,"COLLISION_GRID_CELL_SIZE",(function(){return s})),e(t.exports,"DECLUTTER_BUDGET",(function(){return n})),e(t.exports,"FADE_DURATION",(function(){return a}));const r=!0,s=32,n=1.5,a=200})),t.register("jrPhy",(function(i,r){e(i.exports,"Container",(function(){return o}));var s=t("jsolS"),n=t("coJUt"),a=t("5aS5k");class o extends a.DisplayObject{get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender()}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach((t=>t.clips=e))}get computedEffects(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effects)?e:null}get effect(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effect)?e:""}set effect(e){(this._effectView||e)&&(this._effectView||(this._effectView=new(0,n.EffectView)),this._effectView.effect=e,this.requestRender())}updateTransitionProperties(e,t){super.updateTransitionProperties(e,t),this._effectView&&(this._effectView.transitionStep(e,t),this._effectView.transitioning&&this.requestRender())}doRender(e){const t=this.createRenderParams(e);this.renderChildren(t)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;const i=e.parent;return i&&i!==this&&i.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}contains(e){return this._childrenSet.has(e)}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;const t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}sortChildren(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}_createTransforms(){return{dvs:(0,s.c)()}}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){for(const t of this.children)t.beforeRender(e);for(const t of this.children)t.processRender(e);for(const t of this.children)t.afterRender(e)}createRenderParams(e){return{...e,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition}}constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this.children=[],this._effectView=null}}}));
//# sourceMappingURL=ImageryTileLayerView2D.b501b908.js.map
