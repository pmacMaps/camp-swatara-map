!function(){function e(e){return e&&e.__esModule?e.default:e}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("2CGtF",(function(t,a){var o,i,n,s,l;o=t.exports,Object.defineProperty(o,"__esModule",{value:!0,configurable:!0}),i=t.exports,n="default",s=function(){return X},Object.defineProperty(i,n,{get:s,set:l,enumerable:!0,configurable:!0});var u=r("8TSCy"),p=r("2TvXO"),c=r("7eJjO"),y=r("9pNSx"),d=r("9DeZf"),f=r("kyj08"),v=r("6dXDO"),m=r("9MlGz"),g=r("7qybv"),b=r("8NioF"),h=r("10vEZ"),S=r("iho5X");r("lNwWH"),r("2VlWd");var x=r("iJAIC"),w=r("eB8sj"),I=r("fcwIv"),O=r("kced1"),k=r("Ej9Ns"),_=r("gINRd"),j=r("k0Vu4"),M=r("4LDxK"),T=r("jy0BF"),L=r("ds6X2"),R=r("aLy89"),E=r("gIXJ2"),A=r("cv2jJ"),P=r("5N5S1"),N=r("9bAYR"),J=r("13Qxf"),F=r("3GzOb"),q=r("bMJ3b"),C=r("2t08e"),G=r("gRgX5"),U=r("7vAR5"),W=r("5qsk3"),V=r("dL9AF"),z=r("iaMRW"),D=function(r){"use strict";u.inherits(a,r);var t=u.createSuper(a);function a(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];var i;return u.classCallCheck(this,a),(i=t.call.apply(t,[this].concat(u.toConsumableArray(r)))).datesInUnknownTimezone=!1,i.dpi=96,i.gdbVersion=null,i.imageFormat="png24",i.imageMaxHeight=2048,i.imageMaxWidth=2048,i.imageTransparency=!0,i.isReference=null,i.labelsVisible=!1,i.operationalLayerType="ArcGISMapServiceLayer",i.sourceJSON=null,i.sublayers=null,i.type="map-image",i.url=null,u.possibleConstructorReturn(i)}return u.createClass(a,[{key:"normalizeCtorArgs",value:function(e,r){return"string"==typeof e?u.objectSpread({url:e},r):e}},{key:"load",value:function(e){var r=this,t=(0,g.isSome)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},e).catch(h.throwIfAbortError).then((function(){return r._fetchService(t)}))),Promise.resolve(this)}},{key:"readImageFormat",value:function(e,r){var t=r.supportedImageFormatTypes;return t&&t.indexOf("PNG32")>-1?"png32":"png24"}},{key:"writeSublayers",value:function(e,r,t,a){if(this.loaded&&e){var o=e.slice().reverse().flatten((function(e){var r=e.sublayers;return r&&r.toArray().reverse()})).toArray(),i=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){var n=(0,k.nameToId)(a.origin);if(n===k.OriginId.PORTAL_ITEM){var s=this.createSublayersForOrigin("service").sublayers;i=(0,V.shouldWriteSublayerStructure)(o,s,k.OriginId.SERVICE)}else if(n>k.OriginId.PORTAL_ITEM){var l=this.createSublayersForOrigin("portal-item");i=(0,V.shouldWriteSublayerStructure)(o,l.sublayers,(0,k.nameToId)(l.origin))}}var p=[],c=u.objectSpread({writeSublayerStructure:i},a),y=i;o.forEach((function(e){var r=e.write({},c);p.push(r),y=y||"user"===e.originOf("visible")})),p.some((function(e){return Object.keys(e).length>1}))&&(r.layers=p),y&&(r.visibleLayers=o.filter((function(e){return e.visible})).map((function(e){return e.id})))}}},{key:"createExportImageParameters",value:function(e,r,t,a){var o=a&&a.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());var i=new(0,U.ExportImageParameters)({layer:this,floors:null==a?void 0:a.floors,scale:(0,j.getScale)({extent:e,width:r})*o}),n=i.toJSON();i.destroy();var s=!a||!a.rotation||this.version<10.3?{}:{rotation:-a.rotation},l=e&&e.spatialReference,p=l.wkid||JSON.stringify(l.toJSON());n.dpi*=o;var c={};if(null!=a&&a.timeExtent){var y=a.timeExtent.toJSON(),d=y.start,f=y.end;c.time=d&&f&&d===f?""+d:"".concat(null==d?"null":d,",").concat(null==f?"null":f)}else this.timeInfo&&!this.timeInfo.hasLiveData&&(c.time="null,null");return u.objectSpread({bbox:e&&e.xmin+","+e.ymin+","+e.xmax+","+e.ymax,bboxSR:p,imageSR:p,size:r+","+t},n,s,c)}},{key:"fetchImage",value:function(r,t,a,o){var i=this;return u.asyncToGenerator(e(p).mark((function n(){var s,l,c;return e(p).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l={responseType:"image",signal:null!=(s=null==o?void 0:o.signal)?s:null,query:u.objectSpread({},i.parsedUrl.query,i.createExportImageParameters(r,t,a,o),{f:"image"},i.refreshParameters,i.customParameters,{token:i.apiKey})},c=i.parsedUrl.path+"/export",null==l.query.dynamicLayers||i.capabilities.exportMap.supportsDynamicLayers){e.next=4;break}return e.abrupt("return",Promise.reject(new(0,f.default)("mapimagelayer:dynamiclayer-not-supported","service ".concat(i.url," doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source."),{query:l.query})));case 4:return e.abrupt("return",(0,y.default)(c,l).then((function(e){return e.data})).catch((function(e){if((0,h.isAbortError)(e))throw e;throw new(0,f.default)("mapimagelayer:image-fetch-error","Unable to load image: ".concat(c),{error:e})})));case 5:case"end":return e.stop()}}),n)})))()}},{key:"fetchRecomputedExtents",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this;return u.asyncToGenerator(e(p).mark((function a(){var o,i,n,s,l,c,f;return e(p).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=u.objectSpread({},r,{query:u.objectSpread({returnUpdates:!0,f:"json"},t.customParameters,{token:t.apiKey})}),e.next=3,(0,y.default)(t.url,o);case 3:return i=e.sent,n=i.data,s=n.extent,l=n.fullExtent,c=n.timeExtent,f=s||l,e.abrupt("return",{fullExtent:f&&_.default.fromJSON(f),timeExtent:c&&d.default.fromJSON({start:c[0],end:c[1]})});case 10:case"end":return e.stop()}}),a)})))()}},{key:"loadAll",value:function(){var e=this;return(0,m.loadAll)(this,(function(r){r(e.allSublayers)}))}},{key:"serviceSupportsSpatialReference",value:function(e){return(0,z.serviceSupportsSpatialReference)(this,e)}},{key:"_fetchService",value:function(r){var t=this;return u.asyncToGenerator(e(p).mark((function a(){var o,i;return e(p).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.sourceJSON){e.next=2;break}return e.abrupt("return",void t.read(t.sourceJSON,{origin:"service",url:t.parsedUrl}));case 2:return e.next=4,(0,y.default)(t.parsedUrl.path,{query:u.objectSpread({f:"json"},t.parsedUrl.query,t.customParameters,{token:t.apiKey}),signal:r});case 4:o=e.sent,i=o.data,o.ssl&&(t.url=t.url.replace(/^http:/i,"https:")),t.sourceJSON=i,t.read(i,{origin:"service",url:t.parsedUrl});case 8:case"end":return e.stop()}}),a)})))()}}]),a}((0,E.BlendLayer)((0,C.TemporalLayer)((0,F.ScaleRangeLayer)((0,q.SublayersOwner)((0,L.ArcGISMapService)((0,R.ArcGISService)((0,P.OperationalLayer)((0,N.PortalLayer)((0,b.MultiOriginJSONMixin)((0,J.RefreshableLayer)((0,T.APIKeyMixin)((0,A.CustomParametersMixin)((0,v.HandleOwnerMixin)(M.default))))))))))))));(0,c._)([(0,S.property)({type:Boolean})],D.prototype,"datesInUnknownTimezone",void 0),(0,c._)([(0,S.property)()],D.prototype,"dpi",void 0),(0,c._)([(0,S.property)()],D.prototype,"gdbVersion",void 0),(0,c._)([(0,S.property)()],D.prototype,"imageFormat",void 0),(0,c._)([(0,w.reader)("imageFormat",["supportedImageFormatTypes"])],D.prototype,"readImageFormat",null),(0,c._)([(0,S.property)({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],D.prototype,"imageMaxHeight",void 0),(0,c._)([(0,S.property)({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],D.prototype,"imageMaxWidth",void 0),(0,c._)([(0,S.property)()],D.prototype,"imageTransparency",void 0),(0,c._)([(0,S.property)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],D.prototype,"isReference",void 0),(0,c._)([(0,S.property)({json:{read:!1,write:!1}})],D.prototype,"labelsVisible",void 0),(0,c._)([(0,S.property)({type:["ArcGISMapServiceLayer"]})],D.prototype,"operationalLayerType",void 0),(0,c._)([(0,S.property)({json:{read:!1,write:!1}})],D.prototype,"popupEnabled",void 0),(0,c._)([(0,S.property)()],D.prototype,"sourceJSON",void 0),(0,c._)([(0,S.property)({json:{write:{ignoreOrigin:!0}}})],D.prototype,"sublayers",void 0),(0,c._)([(0,O.writer)("sublayers",{layers:{type:[W.default]},visibleLayers:{type:[x.Integer]}})],D.prototype,"writeSublayers",null),(0,c._)([(0,S.property)({type:["show","hide","hide-children"]})],D.prototype,"listMode",void 0),(0,c._)([(0,S.property)({json:{read:!1},readOnly:!0,value:"map-image"})],D.prototype,"type",void 0),(0,c._)([(0,S.property)(G.url)],D.prototype,"url",void 0);var X=D=(0,c._)([(0,I.subclass)("esri.layers.MapImageLayer")],D)}))}();
//# sourceMappingURL=MapImageLayer.c8b5b12c.js.map
