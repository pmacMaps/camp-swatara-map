!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}var r=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire594f;r.register("61EJF",(function(i,n){var a;a=i.exports,Object.defineProperty(a,"__esModule",{value:!0,configurable:!0}),t(i.exports,"default",(function(){return M}));var s=r("8TSCy"),l=r("2TvXO"),o=r("7eJjO"),u=r("bsvXr"),c=r("flPLJ"),h=r("jHOLN"),y=r("7qybv"),f=r("10vEZ"),d=r("lKPaD"),v=r("iho5X");r("iJAIC");var p=r("fcwIv"),_=r("9doMy"),g=r("8TwEW"),m=r("eY5Yp"),x=r("acBaq"),b=r("bJoNB"),S=r("fLYZp"),w=r("eRRWP"),k=r("3VnGQ"),T=r("3QHnF"),C=r("cXGy9"),R=r("7dqtP"),I=r("dIFqf"),A=r("hPupt"),P=r("5lu47"),D=r("eX6AZ"),B=r("30vBn"),L=h.default.getLogger("esri.views.2d.layers.VectorTileLayerView2D"),O=function(t){"use strict";s.inherits(i,t);var r=s.createSuper(i);function i(){var e;return s.classCallCheck(this,i),(e=r.call.apply(r,[this].concat(Array.prototype.slice.call(arguments))))._styleChanges=[],e._fetchQueue=null,e._parseQueue=null,e._isTileHandlerReady=!1,e.fading=!1,s.possibleConstructorReturn(e)}return s.createClass(i,[{key:"hitTest",value:function(t,r){var i=this;return s.asyncToGenerator(e(l).mark((function t(){var n,a,s,o,c,h;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i._tileHandlerPromise){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,i._tileHandlerPromise;case 4:return e.next=6,i._vectorTileContainer.hitTest(r);case 6:if((n=e.sent)&&0!==n.length){e.next=9;break}return e.abrupt("return",null);case 9:if(a=n[0]-1,s=i._styleRepository,o=s.getStyleLayerByUID(a)){e.next=12;break}return e.abrupt("return",null);case 12:return c=s.getStyleLayerIndex(o.id),h=new(0,u.default)({attributes:{layerId:c,layerName:o.id,layerUID:a}}),e.abrupt("return",(h.layer=i.layer,h.sourceLayer=i.layer,[h]));case 14:case"end":return e.stop()}}),t)})))()}},{key:"update",value:function(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}},{key:"attach",value:function(){var e=this,t=this.layer.currentStyleInfo.style;this._styleRepository=new(0,R.default)(t),this._tileInfoView=new(0,P.default)(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new(0,k.VectorTileContainer)(this._tileInfoView),this._tileHandler=new(0,b.TileHandler)(this.layer,this._styleRepository,window.devicePixelRatio||1),this.container.addChild(this._vectorTileContainer),this._start(),this.handles.add([this._vectorTileContainer.on("fade-start",(function(){e.fading=!0,e.notifyChange("updating"),e.requestUpdate()})),this._vectorTileContainer.on("fade-complete",(function(){var t;null==(t=e._collisionBoxesDisplay)||t.requestRender(),e.fading=!1,e.notifyChange("updating"),e.requestUpdate()})),(0,d.watch)((function(){return e.layer.symbolCollisionBoxesVisible}),(function(t){var r=e;t?(e._collisionBoxesDisplay=new(0,A.Display)({render:function(e){return r._renderCollisionBoxes(e.context)}}),e.container.addChild(e._collisionBoxesDisplay)):(e.container.removeChild(e._collisionBoxesDisplay),e._collisionBoxesDisplay=null)}),d.initial),this.layer.on("paint-change",(function(t){if(t.isDataDriven)e._styleChanges.push({type:x.StyleUpdateType.PAINTER_CHANGED,data:t}),e.notifyChange("updating"),e.requestUpdate();else{var r=e._styleRepository,i=r.getLayerById(t.layer);if(!i)return;var n=i.type===C.StyleLayerType.SYMBOL;r.setPaintProperties(t.layer,t.paint),n&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender()}})),this.layer.on("layout-change",(function(t){var r=e._styleRepository,i=r.getLayerById(t.layer);if(i){var n=(0,_.diff)(i.layout,t.layout);if(!(0,y.isNone)(n)){if((0,_.hasDiff)(n,"visibility")&&1===function(e){if((0,y.isNone)(e))return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(n))return r.setLayoutProperties(t.layer,t.layout),i.type===C.StyleLayerType.SYMBOL&&e._vectorTileContainer.restartDeclutter(),void e._vectorTileContainer.requestRender();e._styleChanges.push({type:x.StyleUpdateType.LAYOUT_CHANGED,data:t}),e.notifyChange("updating"),e.requestUpdate()}}})),this.layer.on("style-layer-visibility-change",(function(t){var r=e._styleRepository,i=r.getLayerById(t.layer);i&&(r.setStyleLayerVisibility(t.layer,t.visibility),i.type===C.StyleLayerType.SYMBOL&&e._vectorTileContainer.restartDeclutter(),e._vectorTileContainer.requestRender())})),this.layer.on("style-layer-change",(function(t){e._styleChanges.push({type:x.StyleUpdateType.LAYER_CHANGED,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("delete-style-layer",(function(t){e._styleChanges.push({type:x.StyleUpdateType.LAYER_REMOVED,data:t}),e.notifyChange("updating"),e.requestUpdate()})),this.layer.on("load-style",(function(){return e._loadStyle()})),this.layer.on("spriteSource-change",(function(t){e._newSpriteSource=t.spriteSource,e._styleChanges.push({type:x.StyleUpdateType.SPRITES_CHANGED,data:null});var r=e._styleRepository.layers,i=!0,n=!1,a=void 0;try{for(var s,l=r[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var o=s.value;switch(o.type){case C.StyleLayerType.SYMBOL:o.getLayoutProperty("icon-image")&&e._styleChanges.push({type:x.StyleUpdateType.LAYOUT_CHANGED,data:{layer:o.id,layout:o.layout}});break;case C.StyleLayerType.LINE:o.getPaintProperty("line-pattern")&&e._styleChanges.push({type:x.StyleUpdateType.PAINTER_CHANGED,data:{layer:o.id,paint:o.paint,isDataDriven:o.isPainterDataDriven()}});break;case C.StyleLayerType.FILL:o.getLayoutProperty("fill-pattern")&&e._styleChanges.push({type:x.StyleUpdateType.PAINTER_CHANGED,data:{layer:o.id,paint:o.paint,isDataDriven:o.isPainterDataDriven()}})}}}catch(e){n=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(n)throw a}}e.notifyChange("updating"),e.requestUpdate()}))],this.declaredClass)}},{key:"detach",value:function(){var e,t;this._stop(),this.container.removeAllChildren(),null==(e=this._vectorTileContainer)||e.destroy(),this._vectorTileContainer=null,null==(t=this._tileHandler)||t.destroy(),this._tileHandler=null,this.handles.remove(this.declaredClass)}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this._collisionBoxesDisplay&&this._vectorTileContainer.restartDeclutter(),this.requestUpdate()}},{key:"supportsSpatialReference",value:function(e){var t;return(0,m.equals)(null==(t=this.layer.tileInfo)?void 0:t.spatialReference,e)}},{key:"canResume",value:function(){var e=s.get(s.getPrototypeOf(i.prototype),"canResume",this).call(this),t=this.layer.currentStyleInfo;if(e&&null!=t&&t.layerDefinition){var r=this.view.scale,n=t.layerDefinition,a=n.minScale,l=n.maxScale;t&&t.layerDefinition&&(a&&a<r&&(e=!1),l&&l>r&&(e=!1))}return e}},{key:"isUpdating",value:function(){var e=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||e.length>0&&e.filter((function(e){return e.invalidating})).length>0||this.fading}},{key:"acquireTile",value:function(e){var t=this,r=this._createVectorTile(e);return this._tileHandlerPromise.then((function(){var e=t;t._fetchQueue.push(r.key).then((function(t){return e._parseQueue.push({key:r.key,data:t})})).then((function(t){var i=e;r.once("attach",(function(){return i.requestUpdate()})),r.setData(t),e.requestUpdate(),e.notifyChange("updating")})).catch((function(t){e.notifyChange("updating"),(0,f.isAbortError)(t)||L.error(t)}))})),r}},{key:"releaseTile",value:function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}},{key:"_start",value:function(){var e=this;if(this._stop(),this._tileManager=new(0,S.TileManager)({acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:this._tileInfoView},this._vectorTileContainer),this.layer.currentStyleInfo){var t=new AbortController,r=this._tileHandler.start({signal:t.signal}).then((function(){var t=e;e._fetchQueue=new(0,D.default)({tileInfoView:e._tileInfoView,process:function(e,r){return t._getTileData(e,r)},concurrency:15}),e._parseQueue=new(0,D.default)({tileInfoView:e._tileInfoView,process:function(e,r){return t._parseTileData(e,r)},concurrency:8}),e.requestUpdate(),e._isTileHandlerReady=!0}));this._tileHandler.spriteMosaic.then((function(t){e._vectorTileContainer.setStyleResources(t,e._tileHandler.glyphMosaic,e._styleRepository),e.requestUpdate()})),this._tileHandlerAbortController=t,this._tileHandlerPromise=r}}},{key:"_stop",value:function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue&&(this._fetchQueue.destroy(),this._fetchQueue=null),this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null),this._tileManager&&(this._tileManager.destroy(),this._tileManager=null),this._vectorTileContainer.removeAllChildren()}}},{key:"_getTileData",value:function(t,r){var i=this;return s.asyncToGenerator(e(l).mark((function n(){var a;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i._tileHandler.fetchTileData(t,r);case 2:return a=e.sent,e.abrupt("return",(i.notifyChange("updating"),a));case 4:case"end":return e.stop()}}),n)})))()}},{key:"_parseTileData",value:function(t,r){var i=this;return s.asyncToGenerator(e(l).mark((function n(){return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i._tileHandler.parseTileData(t,r));case 1:case"end":return e.stop()}}),n)})))()}},{key:"_applyStyleChanges",value:function(){var t=this;return s.asyncToGenerator(e(l).mark((function r(){var i,n,a,s,o,u,c,h,y,f,d,v,p,_,g,m,b,S,w;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t._isTileHandlerReady=!1,t._fetchQueue.pause(),t._parseQueue.pause(),t._fetchQueue.clear(),t._parseQueue.clear(),t._tileManager.clearCache(),i=t._styleChanges,e.prev=2,e.next=5,t._tileHandler.updateStyle(i);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),L.error("error applying vector-tiles style update",e.t0.message),t._fetchQueue.resume(),t._parseQueue.resume(),t._isTileHandlerReady=!0;case 10:if(n=t._styleRepository,a=[],i.forEach((function(e){if(e.type===x.StyleUpdateType.LAYER_REMOVED){var t=e.data,r=n.getLayerById(t.layer);r&&a.push(r.uid)}})),s=[],i.forEach((function(e){var r=e.type,i=e.data;switch(r){case x.StyleUpdateType.PAINTER_CHANGED:n.setPaintProperties(i.layer,i.paint),o=i.layer;break;case x.StyleUpdateType.LAYOUT_CHANGED:n.setLayoutProperties(i.layer,i.layout),o=i.layer;break;case x.StyleUpdateType.LAYER_REMOVED:return void n.deleteStyleLayer(i.layer);case x.StyleUpdateType.LAYER_CHANGED:n.setStyleLayer(i.layer,i.index),o=i.layer.id;break;case x.StyleUpdateType.SPRITES_CHANGED:t._vectorTileContainer.setSpriteMosaic(t._tileHandler.setSpriteSource(t._newSpriteSource)),t._newSpriteSource=null,o=null}var a=n.getLayerById(o);a&&s.push(a.uid)})),u=t._vectorTileContainer.children,!(a.length>0)){e.next=35;break}for(t._vectorTileContainer.deleteStyleLayers(a),c=!0,h=!1,y=void 0,e.prev=19,f=u[Symbol.iterator]();!(c=(d=f.next()).done);c=!0)d.value.deleteLayerData(a);e.next=27;break;case 23:e.prev=23,e.t1=e.catch(19),h=!0,y=e.t1;case 27:e.prev=27,e.prev=28,c||null==f.return||f.return();case 30:if(e.prev=30,!h){e.next=33;break}throw y;case 33:return e.finish(30);case 34:return e.finish(27);case 35:if(t._fetchQueue.resume(),t._parseQueue.resume(),!(s.length>0)){e.next=56;break}for(v=[],p=!0,_=!1,g=void 0,e.prev=38,m=u[Symbol.iterator]();!(p=(b=m.next()).done);p=!0)S=b.value,w=t._fetchQueue.push(S.key).then((function(e){return t._parseQueue.push({key:S.key,data:e,styleLayerUIDs:s})})).then((function(e){return S.setData(e)})),v.push(w);e.next=46;break;case 42:e.prev=42,e.t2=e.catch(38),_=!0,g=e.t2;case 46:e.prev=46,e.prev=47,p||null==m.return||m.return();case 49:if(e.prev=49,!_){e.next=52;break}throw g;case 52:return e.finish(49);case 53:return e.finish(46);case 54:return e.next=56,Promise.all(v);case 56:t._styleChanges=[],t._isTileHandlerReady=!0,t.notifyChange("updating"),t.requestUpdate();case 57:case"end":return e.stop()}}),r,null,[[2,7],[19,23,27,35],[28,,30,34],[38,42,46,54],[47,,49,53]])})))()}},{key:"_loadStyle",value:function(){var t=this;return s.asyncToGenerator(e(l).mark((function r(){var i,n,a,s,o,u;return e(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.layer.currentStyleInfo,n=i.style,a=(0,c.clone)(n),t._isTileHandlerReady=!1,t._fetchQueue.pause(),t._parseQueue.pause(),t._fetchQueue.clear(),t._parseQueue.clear(),t.notifyChange("updating"),t._styleRepository=new(0,R.default)(a),t._vectorTileContainer.destroy(),t._tileManager.clear(),t._tileHandlerAbortController.abort(),t._tileHandlerAbortController=new AbortController,s=t._tileHandlerAbortController,o=s.signal,e.prev=3,t._tileHandlerPromise=t._tileHandler.setStyle(t._styleRepository,a),e.next=7,t._tileHandlerPromise;case 7:e.next=13;break;case 9:if(e.prev=9,e.t0=e.catch(3),(0,f.isAbortError)(e.t0)){e.next=13;break}throw e.t0;case 13:if(!o.aborted){e.next=15;break}return e.abrupt("return",(t._fetchQueue.resume(),t._parseQueue.resume(),t._isTileHandlerReady=!0,t.notifyChange("updating"),void t.requestUpdate()));case 15:return e.next=17,t._tileHandler.spriteMosaic;case 17:u=e.sent,t._vectorTileContainer.setStyleResources(u,t._tileHandler.glyphMosaic,t._styleRepository),t._fetchQueue.resume(),t._parseQueue.resume(),t._isTileHandlerReady=!0,t.notifyChange("updating"),t.requestUpdate();case 19:case"end":return e.stop()}}),r,null,[[3,9]])})))()}},{key:"_createVectorTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,g.create)(),e);return new(0,w.VectorTile)(e,t[0],t[3],512,512,this._styleRepository)}},{key:"_renderCollisionBoxes",value:function(e){var t=!0,r=!1,i=void 0;try{for(var n,a=this._vectorTileContainer.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var l=n.value;if(l.symbols){var o,u=[],c=!0,h=!1,y=void 0;try{for(var f,d=l.symbols[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var v=s.slicedToArray(f.value,2),p=(v[0],v[1]);(o=u).push.apply(o,s.toConsumableArray(p))}}catch(e){h=!0,y=e}finally{try{c||null==d.return||d.return()}finally{if(h)throw y}}(0,T.drawColliders)(e,u)}}}catch(e){r=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw i}}}}]),i}((0,I.LayerView2DMixin)(B.default));(0,o._)([(0,v.property)()],O.prototype,"_fetchQueue",void 0),(0,o._)([(0,v.property)()],O.prototype,"_parseQueue",void 0),(0,o._)([(0,v.property)()],O.prototype,"_isTileHandlerReady",void 0),(0,o._)([(0,v.property)()],O.prototype,"fading",void 0);var M=O=(0,o._)([(0,p.subclass)("esri.views.2d.layers.VectorTileLayerView2D")],O)})),r.register("bJoNB",(function(i,n){t(i.exports,"TileHandler",(function(){return v}));var a=r("8TSCy"),s=r("2TvXO"),l=r("10vEZ"),o=r("kYueh"),u=r("gdXB3"),c=r("gBSb1"),h=r("ikjMp"),y=r("kwLYa"),f=r("3QHnF"),d=r("i90gL"),v=function(){"use strict";function t(e,r,i){a.classCallCheck(this,t),this._layer=e,this._styleRepository=r,this.devicePixelRatio=i,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null}return a.createClass(t,[{key:"destroy",value:function(){this._connection&&(this._connection.close(),this._connection=null),this._styleRepository=null,this._layer=null,this._spriteMosaic&&(this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic=null)}},{key:"spriteMosaic",get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"start",value:function(t){var r=this;return a.asyncToGenerator(e(s).mark((function i(){var n;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r._spriteSourcePromise=r._layer.loadSpriteSource(r.devicePixelRatio,t),r._spriteSourcePromise.then((function(e){r._spriteMosaic=new(0,y.default)(1024,1024,250),r._spriteMosaic.setSpriteSource(e)})),n=new(0,h.default)(r._layer.currentStyleInfo.glyphsUrl?(0,o.addQueryParameters)(r._layer.currentStyleInfo.glyphsUrl,a.objectSpread({},r._layer.customParameters,{token:r._layer.apiKey})):null),r._glyphMosaic=new(0,c.default)(1024,1024,n),r._broadcastPromise=(0,u.open)("WorkerTileHandler",{client:r,schedule:t.schedule,signal:t.signal}).then((function(e){return r._connection=e,Promise.all(r._connection.broadcast("setStyle",r._layer.currentStyleInfo.style,t))}));case 3:case"end":return e.stop()}}),i)})))()}},{key:"updateStyle",value:function(t){var r=this;return a.asyncToGenerator(e(s).mark((function i(){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._broadcastPromise;case 2:return r._broadcastPromise=Promise.all(r._connection.broadcast("updateStyle",t)),e.abrupt("return",(e.sent,r._broadcastPromise));case 4:case"end":return e.stop()}}),i)})))()}},{key:"setSpriteSource",value:function(e){var t=new(0,y.default)(1024,1024,250);return t.setSpriteSource(e),this._spriteMosaic=t,this._spriteSourcePromise=Promise.resolve(e),t}},{key:"setStyle",value:function(t,r){var i=this;return a.asyncToGenerator(e(s).mark((function n(){var l;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i._broadcastPromise;case 2:return i._styleRepository=t,i._spriteSourcePromise=i._layer.loadSpriteSource(i.devicePixelRatio,null),i._spriteSourcePromise.then((function(e){i._spriteMosaic=new(0,y.default)(1024,1024,250),i._spriteMosaic.setSpriteSource(e)})),l=new(0,h.default)(i._layer.currentStyleInfo.glyphsUrl?(0,o.addQueryParameters)(i._layer.currentStyleInfo.glyphsUrl,a.objectSpread({},i._layer.customParameters,{token:i._layer.apiKey})):null),e.abrupt("return",(i._glyphMosaic=new(0,c.default)(1024,1024,l),i._broadcastPromise=Promise.all(i._connection.broadcast("setStyle",r)),i._broadcastPromise));case 7:case"end":return e.stop()}}),n)})))()}},{key:"fetchTileData",value:function(e,t){var r=this;return this._getRefKeys(e,t).then((function(e){var i=r._layer.sourceNameToSource,n=[];for(var a in i)n.push(a);return r._getSourcesData(n,e,t)}))}},{key:"parseTileData",value:function(e,t){var r=this,i=e&&e.data;if(!i)return Promise.resolve(null);var n=i.sourceName2DataAndRefKey,s=i.transferList;return 0===Object.keys(n).length?Promise.resolve(null):this._broadcastPromise.then((function(){return r._connection.getAvailableClient().then((function(r){return r.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:n,styleLayerUIDs:e.styleLayerUIDs},a.objectSpread({},t,{transferList:s}))}))}))}},{key:"getSprites",value:function(t){var r=this;return a.asyncToGenerator(e(s).mark((function i(){return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r._spriteSourcePromise;case 2:return e.abrupt("return",(e.sent,r._spriteMosaic.getSpriteItems(t)));case 3:case"end":return e.stop()}}),i)})))()}},{key:"getGlyphs",value:function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}},{key:"perfReport",value:function(e){var t=e.key,r=e.milliseconds;(0,f.perfAdd)(t,r,"ms")}},{key:"_getTilePayload",value:function(t,r,i){var n=this;return a.asyncToGenerator(e(s).mark((function a(){var o,u,c,h,y;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=d.default.pool.acquire(t.id),u=n._layer.sourceNameToSource[r],c=o.level,h=o.row,y=o.col,d.default.pool.release(o),e.prev=2,e.next=5,u.requestTile(c,h,y,i);case 5:return e.t0=e.sent,e.t1=r,e.abrupt("return",{protobuff:e.t0,sourceName:e.t1});case 10:if(e.prev=10,e.t2=e.catch(2),!(0,l.isAbortError)(e.t2)){e.next=14;break}throw e.t2;case 14:return e.abrupt("return",{protobuff:null,sourceName:r});case 15:case"end":return e.stop()}}),a,null,[[2,10]])})))()}},{key:"_getRefKeys",value:function(e,t){var r=this._layer.sourceNameToSource,i=new Array;for(var n in r){var a=r[n].getRefKey(e,t);i.push(a)}return(0,l.eachAlways)(i)}},{key:"_getSourcesData",value:function(e,t,r){for(var i=[],n=0;n<t.length;n++)if(null==t[n].value||null==e[n])i.push(null);else{var a=this._getTilePayload(t[n].value,e[n],r);i.push(a)}return(0,l.eachAlways)(i).then((function(e){for(var r={},i=[],n=0;n<e.length;n++)if(e[n].value&&e[n].value&&e[n].value.protobuff&&e[n].value.protobuff.byteLength>0){var a=t[n].value.id;r[e[n].value.sourceName]={refKey:a,protobuff:e[n].value.protobuff},i.push(e[n].value.protobuff)}return{sourceName2DataAndRefKey:r,transferList:i}}))}}]),t}()})),r.register("gBSb1",(function(e,i){t(e.exports,"default",(function(){return u}));var n=r("8TSCy"),a=r("4bLnk"),s=r("fl9Q8"),l=r("8JzMA"),o=r("8aBT4"),u=function(){"use strict";function e(t,r,i){n.classCallCheck(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=r,this._glyphSource=i,this._binPack=new(0,a.default)(t-4,r-4),this._glyphData.push(new Uint8Array(t*r)),this._dirties.push(!0),this._textures.push(void 0)}return n.createClass(e,[{key:"getGlyphItems",value:function(e,t){var r=this,i=[],n=this._glyphSource,l=new Set,o=!0,u=!1,c=void 0;try{for(var h,y=t[Symbol.iterator]();!(o=(h=y.next()).done);o=!0){var f=h.value,d=Math.floor(.00390625*f);l.add(d)}}catch(e){u=!0,c=e}finally{try{o||null==y.return||y.return()}finally{if(u)throw c}}var v=[];return l.forEach((function(t){if(t<=256){var i=e+t;if(r._rangePromises.has(i))v.push(r._rangePromises.get(i));else{var a=r,s=n.getRange(e,t).then((function(){a._rangePromises.delete(i)}),(function(){a._rangePromises.delete(i)}));r._rangePromises.set(i,s),v.push(s)}}})),Promise.all(v).then((function(){var l=r._glyphIndex[e];l||(l={},r._glyphIndex[e]=l);var o=!0,u=!1,c=void 0;try{for(var h,y=t[Symbol.iterator]();!(o=(h=y.next()).done);o=!0){var f=h.value,d=l[f];if(d)i[f]={sdf:!0,rect:d.rect,metrics:d.metrics,page:d.page,code:f};else{var v=n.getGlyph(e,f);if(v&&v.metrics){var p=v.metrics,_=void 0;if(0===p.width)_=new(0,s.default)(0,0,0,0);else{var g=p.width+6,m=p.height+6,x=g%4?4-g%4:4,b=m%4?4-m%4:4;1===x&&(x=5),1===b&&(b=5),(_=r._binPack.allocate(g+x,m+b)).isEmpty&&(r._dirties[r._currentPage]||(r._glyphData[r._currentPage]=null),r._currentPage=r._glyphData.length,r._glyphData.push(new Uint8Array(r.width*r.height)),r._dirties.push(!0),r._textures.push(void 0),r._binPack=new(0,a.default)(r.width-4,r.height-4),_=r._binPack.allocate(g+x,m+b));var S=r._glyphData[r._currentPage],w=v.bitmap,k=void 0,T=void 0;if(w)for(var C=0;C<m;C++){k=g*C,T=r.width*(_.y+C+1)+_.x;for(var R=0;R<g;R++)S[T+R+1]=w[k+R]}}l[f]={rect:_,metrics:p,tileIDs:null,page:r._currentPage},i[f]={sdf:!0,rect:_,metrics:p,page:r._currentPage,code:f},r._dirties[r._currentPage]=!0}}}}catch(e){u=!0,c=e}finally{try{o||null==y.return||y.return()}finally{if(u)throw c}}return i}))}},{key:"removeGlyphs",value:function(e){for(var t in this._glyphIndex){var r=this._glyphIndex[t];if(r){var i=void 0;for(var n in r)if((i=r[n]).tileIDs.delete(e),0===i.tileIDs.size){for(var a=this._glyphData[i.page],s=i.rect,l=void 0,o=void 0,u=0;u<s.height;u++)for(l=this.width*(s.y+u)+s.x,o=0;o<s.width;o++)a[l+o]=0;delete r[n],this._dirties[i.page]=!0}}}}},{key:"bind",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[r]||(this._textures[r]=new(0,o.Texture)(e,{pixelFormat:l.PixelFormat.ALPHA,dataType:l.PixelType.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var n=this._textures[r];n.setSamplingMode(t),this._dirties[r]&&n.setData(this._glyphData[r]),e.bindTexture(n,i),this._dirties[r]=!1}},{key:"dispose",value:function(){this._binPack=null;var e=!0,t=!1,r=void 0;try{for(var i,n=this._textures[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var a=i.value;a&&a.dispose()}}catch(e){t=!0,r=e}finally{try{e||null==n.return||n.return()}finally{if(t)throw r}}this._textures.length=0}}]),e}()})),r.register("4bLnk",(function(e,i){t(e.exports,"default",(function(){return s}));var n=r("8TSCy"),a=r("fl9Q8"),s=function(){"use strict";function e(t,r){n.classCallCheck(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=r,this._free.push(new(0,a.default)(0,0,t,r))}return n.createClass(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new(0,a.default);for(var r=null,i=-1,n=0;n<this._free.length;++n){var s=this._free[n];e<=s.width&&t<=s.height&&(null===r||s.y<=r.y&&s.x<=r.x)&&(r=s,i=n)}return null===r?new(0,a.default):(this._free.splice(i,1),r.width<r.height?(r.width>e&&this._free.push(new(0,a.default)(r.x+e,r.y,r.width-e,t)),r.height>t&&this._free.push(new(0,a.default)(r.x,r.y+t,r.width,r.height-t))):(r.width>e&&this._free.push(new(0,a.default)(r.x+e,r.y,r.width-e,r.height)),r.height>t&&this._free.push(new(0,a.default)(r.x,r.y+t,e,r.height-t))),new(0,a.default)(r.x,r.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var r=this._free[t];if(r.y===e.y&&r.height===e.height&&r.x+r.width===e.x)r.width+=e.width;else if(r.x===e.x&&r.width===e.width&&r.y+r.height===e.y)r.height+=e.height;else if(e.y===r.y&&e.height===r.height&&e.x+e.width===r.x)r.x=e.x,r.width+=e.width;else{if(e.x!==r.x||e.width!==r.width||e.y+e.height!==r.y)continue;r.y=e.y,r.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}()})),r.register("ikjMp",(function(e,i){t(e.exports,"default",(function(){return u}));var n=r("8TSCy"),a=r("9pNSx"),s=r("acan7"),l=function(){"use strict";function e(t){if(n.classCallCheck(this,e),this._metrics=[],this._bitmaps=[],t)for(;t.next();)if(1===t.tag()){for(var r=t.getMessage();r.next();)if(3===r.tag()){for(var i=r.getMessage(),a=void 0,s=void 0,l=void 0,o=void 0,u=void 0,c=void 0,h=void 0;i.next();)switch(i.tag()){case 1:a=i.getUInt32();break;case 2:s=i.getBytes();break;case 3:l=i.getUInt32();break;case 4:o=i.getUInt32();break;case 5:u=i.getSInt32();break;case 6:c=i.getSInt32();break;case 7:h=i.getUInt32();break;default:i.skip()}i.release(),a&&(this._metrics[a]={width:l,height:o,left:u,top:c,advance:h},this._bitmaps[a]=s)}else r.skip();r.release()}else t.skip()}return n.createClass(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){return this._bitmaps[e]}}]),e}(),o=function(){"use strict";function e(){n.classCallCheck(this,e),this._ranges=[]}return n.createClass(e,[{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),u=function(){"use strict";function e(t){n.classCallCheck(this,e),this._glyphInfo={},this._baseURL=t}return n.createClass(e,[{key:"getRange",value:function(e,t){var r=this._getFontStack(e);if(r.getRange(t))return Promise.resolve();var i=256*t,n=i+255,o=this._baseURL.replace("{fontstack}",e).replace("{range}",i+"-"+n);return(0,a.default)(o,{responseType:"array-buffer"}).then((function(e){r.addRange(t,new l(new(0,s.default)(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){r.addRange(t,new l)}))}},{key:"getGlyph",value:function(e,t){var r=this._getFontStack(e);if(r){var i=Math.floor(t/256);if(!(i>256)){var n=r.getRange(i);return n?{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}:void 0}}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new o),t}}]),e}()})),r.register("kwLYa",(function(e,i){t(e.exports,"default",(function(){return h}));var n=r("8TSCy"),a=r("4FBKO"),s=r("4bLnk"),l=r("fl9Q8"),o=r("8JzMA"),u=r("8aBT4"),c="dasharray-",h=function(){"use strict";function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n.classCallCheck(this,e),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||r<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=r,i>0&&(this._maxItemSize=i),this._binPack=new(0,s.default)(t-4,r-4)}return n.createClass(e,[{key:"dispose",value:function(){this._binPack=null,this._mosaicRects={};var e=!0,t=!1,r=void 0;try{for(var i,n=this._textures[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var a=i.value;a&&a.dispose()}}catch(e){t=!0,r=e}finally{try{e||null==n.return||n.return()}finally{if(t)throw r}}this._textures.length=0}},{key:"getWidth",value:function(e){return e>=this._size.length?-1:this._size[e][0]}},{key:"getHeight",value:function(e){return e>=this._size.length?-1:this._size[e][1]}},{key:"getPageSize",value:function(e){return e>=this._size.length?null:this._size[e]}},{key:"setSpriteSource",value:function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new(0,s.default)(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),r=Math.floor(this._pageHeight),i=new Uint32Array(t*r);this._mosaicsData[0]=i,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}},{key:"getSpriteItem",value:function(e){var t,r,i,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=this._mosaicRects[e];if(s)return s;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith(c)?(t=(i=n.slicedToArray(this._rasterizeDash(e),2))[0],r=i[1],a=!0):t=this._sprites.getSpriteInfo(e),!t||!t.width||!t.height||t.width<0||t.height<0)return null;var l=t.width,o=t.height,u=n.slicedToArray(this._allocateImage(l,o),3),h=u[0],y=u[1],f=u[2];return h.width<=0?null:(this._copy(h,t,y,f,a,r),s={rect:h,width:l,height:o,sdf:t.sdf,simplePattern:!1,pixelRatio:t.pixelRatio,page:y},this._mosaicRects[e]=s,s)}},{key:"getSpriteItems",value:function(e){var t={},r=!0,i=!1,n=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value;t[l.name]=this.getSpriteItem(l.name,l.repeat)}}catch(e){i=!0,n=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw n}}return t}},{key:"getMosaicItemPosition",value:function(e,t){var r=this.getSpriteItem(e,t),i=r&&r.rect;if(!i)return null;i.width=r.width,i.height=r.height;var n=r.width,a=r.height;return{tl:[i.x+2,i.y+2],br:[i.x+2+n,i.y+2+a],page:r.page}}},{key:"bind",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._textures[r]||(this._textures[r]=new(0,u.Texture)(e,{pixelFormat:o.PixelFormat.RGBA,dataType:o.PixelType.UNSIGNED_BYTE,wrapMode:o.TextureWrapMode.CLAMP_TO_EDGE,width:this._size[r][0],height:this._size[r][1]},new Uint8Array(this._mosaicsData[r].buffer)));var n=this._textures[r];n.setSamplingMode(t),this._dirties[r]&&n.setData(new Uint8Array(this._mosaicsData[r].buffer)),e.bindTexture(n,i),this._dirties[r]=!1}},{key:"_copy",value:function(t,r,i,n,a,s){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(i>=this._mosaicsData.length)){var l=new Uint32Array(s?s.buffer:this._sprites.image.buffer),o=this._mosaicsData[i];o&&l||console.error("Source or target images are uninitialized!");var u=s?r.width:this._sprites.width;e._copyBits(l,u,r.x,r.y,o,n[0],t.x+2,t.y+2,r.width,r.height,a),this._dirties[i]=!0}}},{key:"_allocateImage",value:function(e,t){e+=2,t+=2;var r=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<r){var i=new(0,l.default)(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[e,t]]}var n=e%4?4-e%4:4,a=t%4?4-t%4:4;1===n&&(n=5),1===a&&(a=5);var o=this._binPack.allocate(e+n,t+a);return o.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new(0,s.default)(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[o,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_rasterizeDash",value:function(e){var t=e.match(/\[(.*?)\]/);if(!t)return null;var r=t[1].split(",").map(Number),i=e.slice(e.lastIndexOf("-")+1),s=n.slicedToArray(a.SymbolHelper.rasterizeDash(r,i),3),l=s[0];return[{x:0,y:0,width:s[1],height:s[2],sdf:!0,pixelRatio:1},new Uint8Array(l.buffer)]}}],[{key:"_copyBits",value:function(e,t,r,i,n,a,s,l,o,u,c){var h=i*t+r,y=l*a+s;if(c){y-=a;for(var f=-1;f<=u;h=((++f+u)%u+i)*t+r,y+=a)for(var d=-1;d<=o;d++)n[y+d]=e[h+(d+o)%o]}else for(var v=0;v<u;v++){for(var p=0;p<o;p++)n[y+p]=e[h+p];h+=t,y+=a}}}]),e}()})),r.register("3QHnF",(function(e,r){function i(e,t,r,i,n,a){e.fillStyle=t,e.fillRect(r,i,n,a)}function n(e,t){for(var r,n,a,s,l,o,u=window.COLLISION_XRAY,c=0;c<t.length;++c){var h=!t[c].unique.show,y=!0,f=!1,d=void 0;if(u||!h)try{for(var v,p=t[c].colliders[Symbol.iterator]();!(y=(v=p.next()).done);y=!0){var _=v.value;if(_.enabled){var g=!t[c].unique.parts[_.partIndex].show;if(u||!g){var m=_.xScreen,x=_.yScreen,b=_.dxScreen,S=_.dyScreen;e.globalAlpha=h||g?.2:1,i(e,"green",m-1,x-1,3,3),r=e,n="red",a=m+b,s=x+S,l=_.width,o=_.height,r.strokeStyle=n,r.strokeRect(a,s,l,o),i(e,"blue",m+b-1,x+S-1,3,3),e.globalAlpha=1}}}}catch(e){f=!0,d=e}finally{try{y||null==p.return||p.return()}finally{if(f)throw d}}}}function a(e,t,r){if(window.PERFORMANCE_RECORDING_STORAGE){var i=window.PERFORMANCE_RECORDING_STORAGE;i.perf=i.perf||{};var n=i.perf;n[e]=n[e]||{start:null,time:0,min:void 0,max:void 0,samples:[],unit:r},n[e].time+=t,n[e].samples.push(t),(null==n[e].min||t<n[e].min)&&(n[e].min=t),(null==n[e].max||t>n[e].max)&&(n[e].max=t)}}t(e.exports,"drawColliders",(function(){return n})),t(e.exports,"perfAdd",(function(){return a}))})),r.register("fLYZp",(function(e,i){t(e.exports,"TileManager",(function(){return c}));var n=r("8TSCy"),a=r("crS0R"),s=r("7qybv"),l=r("eoIYU"),o=r("i90gL"),u=function(e,t){return e+1/(1<<2*t)},c=function(){"use strict";function e(t,r){n.classCallCheck(this,e),this._tiles=new Map,this._tileCache=new(0,a.default)(40,(function(e){return e.dispose()})),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this._container=r}return n.createClass(e,[{key:"destroy",value:function(){var e=!0,t=!1,r=void 0;try{for(var i,a=this._tiles[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var s=n.slicedToArray(i.value,2);s[0];s[1].dispose()}}catch(e){t=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}this._tiles=null,this._tileCache.clear(),this._tileCache=null}},{key:"update",value:function(e){this._updateCacheSize(e);var t=this.tileInfoView,r=t.getTileCoverage(e.state,0,"smallest"),i=r.spans,a=r.lodInfo,s=a.level,u=this._tiles,c=new Set,h=new Set,y=!0,f=!1,d=void 0;try{for(var v,p=i[Symbol.iterator]();!(y=(v=p.next()).done);y=!0)for(var _=v.value,g=_.row,m=_.colFrom,x=_.colTo,b=m;b<=x;b++){var S=o.default.getId(s,g,a.normalizeCol(b),a.getWorldForColumn(b)),w=this._getOrAcquireTile(S);c.add(S),w.processed()?this._addToContainer(w):h.add(new(0,o.default)(S))}}catch(e){f=!0,d=e}finally{try{y||null==p.return||p.return()}finally{if(f)throw d}}var k=!0,T=!1,C=void 0;try{for(var R,I=u[Symbol.iterator]();!(k=(R=I.next()).done);k=!0){var A=n.slicedToArray(R.value,2),P=A[0];A[1].isCoverage=c.has(P)}}catch(e){T=!0,C=e}finally{try{k||null==I.return||I.return()}finally{if(T)throw C}}var D=!0,B=!1,L=void 0;try{for(var O,M=h[Symbol.iterator]();!(D=(O=M.next()).done);D=!0){var U=O.value;this._findPlaceholdersForMissingTiles(U,c)}}catch(e){B=!0,L=e}finally{try{D||null==M.return||M.return()}finally{if(B)throw L}}var V=!1,E=!0,q=!1,z=void 0;try{for(var F,H=u[Symbol.iterator]();!(E=(F=H.next()).done);E=!0){var N=n.slicedToArray(F.value,2),G=N[0],j=N[1];j.neededForCoverage=c.has(G),j.neededForCoverage||j.isHoldingForFade&&t.intersects(r,j.key)&&c.add(G),j.isFading&&(V=!0)}}catch(e){q=!0,z=e}finally{try{E||null==H.return||H.return()}finally{if(q)throw z}}var W=!0,Q=!1,Y=void 0;try{for(var J,Z=this._tiles[Symbol.iterator]();!(W=(J=Z.next()).done);W=!0){var X=n.slicedToArray(J.value,2),K=X[0];X[1];c.has(K)||this._releaseTile(K)}}catch(e){Q=!0,Y=e}finally{try{W||null==Z.return||Z.return()}finally{if(Q)throw Y}}return l.default.pool.release(r),!V}},{key:"clear",value:function(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}},{key:"clearCache",value:function(){this._tileCache.clear()}},{key:"_findPlaceholdersForMissingTiles",value:function(e,t){var r=[],i=!0,a=!1,s=void 0;try{for(var l,o=this._tiles[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var c=n.slicedToArray(l.value,2),h=(c[0],c[1]);this._addPlaceholderChild(r,h,e,t)}}catch(e){a=!0,s=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw s}}var y=r.reduce(u,0);Math.abs(1-y)<1e-6||this._addPlaceholderParent(e.id,t)}},{key:"_addPlaceholderChild",value:function(e,t,r,i){var n,a,s;t.key.level<=r.level||!t.hasData()||(n=r,a=t.key,s=a.level-n.level,n.row===a.row>>s&&n.col===a.col>>s&&n.world===a.world&&(this._addToContainer(t),i.add(t.id),e.push(t.key.level-r.level)))}},{key:"_addPlaceholderParent",value:function(e,t){for(var r,i,a,s,l,o,u,c=this._tiles,h=e;;){if(r=h,i=void 0,a=void 0,s=void 0,l=void 0,o=void 0,u=void 0,i=n.slicedToArray(r.split("/"),4),a=i[0],s=i[1],l=i[2],o=i[3],!(h=0===(u=parseInt(a,10))?null:"".concat(u-1,"/").concat(parseInt(s,10)>>1,"/").concat(parseInt(l,10)>>1,"/").concat(parseInt(o,10)))||t.has(h))return;var y=c.get(h);if(y&&y.hasData())return this._addToContainer(y),void t.add(y.id)}}},{key:"_getOrAcquireTile",value:function(e){var t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))||(t=this.acquireTile(new(0,o.default)(e))),this._tiles.set(e,t),t)}},{key:"_releaseTile",value:function(e){var t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}},{key:"_addToContainer",value:function(e){var t,r=[],i=this._container;if(!i.contains(e)){var a=this._visibleTiles,l=!0,o=!1,u=void 0;try{for(var c,h=a[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var y=n.slicedToArray(c.value,2),f=(y[0],y[1]);this._canConnectDirectly(e,f)&&r.push(f),(0,s.isNone)(t)&&this._canConnectDirectly(f,e)&&(t=f)}}catch(e){o=!0,u=e}finally{try{l||null==h.return||h.return()}finally{if(o)throw u}}var d=!0,v=!1,p=void 0;if((0,s.isSome)(t)){var _=!0,g=!1,m=void 0;try{for(var x,b=r[Symbol.iterator]();!(_=(x=b.next()).done);_=!0){var S=x.value;t.childrenTiles.delete(S),e.childrenTiles.add(S),S.parentTile=e}}catch(e){g=!0,m=e}finally{try{_||null==b.return||b.return()}finally{if(g)throw m}}t.childrenTiles.add(e),e.parentTile=t}else try{for(var w,k=r[Symbol.iterator]();!(d=(w=k.next()).done);d=!0){var T=w.value;e.childrenTiles.add(T),T.parentTile=e}}catch(e){v=!0,p=e}finally{try{d||null==k.return||k.return()}finally{if(v)throw p}}a.set(e.id,e),i.addChild(e)}}},{key:"_removeFromContainer",value:function(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),(0,s.isSome)(e.parentTile)){e.parentTile.childrenTiles.delete(e);var t=!0,r=!1,i=void 0;try{for(var n,a=e.childrenTiles[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var l=n.value;(0,s.isSome)(e.parentTile)&&e.parentTile.childrenTiles.add(l)}}catch(e){r=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw i}}}var o=!0,u=!1,c=void 0;try{for(var h,y=e.childrenTiles[Symbol.iterator]();!(o=(h=y.next()).done);o=!0){h.value.parentTile=e.parentTile}}catch(e){u=!0,c=e}finally{try{o||null==y.return||y.return()}finally{if(u)throw c}}e.parentTile=null,e.childrenTiles.clear()}},{key:"_canConnectDirectly",value:function(e,t){for(var r=e.key,i=t.key,n=i.level,a=i.row,s=i.col,l=i.world,o=this._visibleTiles;n>0;){if(n--,a>>=1,s>>=1,r.level===n&&r.row===a&&r.col===s&&r.world===l)return!0;if(o.has("".concat(n,"/").concat(a,"/").concat(s,"/").concat(l)))return!1}return!1}},{key:"_updateCacheSize",value:function(e){var t=e.state.size;if(t[0]!==this._viewSize[0]||t[1]!==this._viewSize[1]){var r=Math.ceil(t[0]/512)+1,i=Math.ceil(t[1]/512)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*r*i}}}]),e}()})),r.register("eRRWP",(function(e,i){t(e.exports,"VectorTile",(function(){return h}));var n=r("8TSCy"),a=r("7qybv"),s=r("j3x2p"),l=r("eYrMi"),o=r("acBaq"),u=r("cGt56"),c=r("ebEEs"),h=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i,a,s,l,o){var u,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return n.classCallCheck(this,r),(u=t.call(this,e,i,a,s,l,4096,4096))._memCache=c,u.type="vector-tile",u._referenced=0,u._hasSymbolBuckets=!1,u._memoryUsedByLayerData=0,u.layerData=new Map,u.layerCount=0,u.status="loading",u.allSymbolsFadingOut=!1,u.lastOpacityUpdate=0,u.symbols=new Map,u.isCoverage=!1,u.neededForCoverage=!1,u.decluttered=!1,u.invalidating=!1,u.parentTile=null,u.childrenTiles=new Set,u._processed=!1,u._referenced=1,u.styleRepository=o,u.id=e.id,n.possibleConstructorReturn(u)}return n.createClass(r,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<c.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<c.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"setData",value:function(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}},{key:"deleteLayerData",value:function(e){var t=!1,r=!0,i=!1,n=void 0;try{for(var s,l=e[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var u=s.value;if(this.layerData.has(u)){var c=this.layerData.get(u);this._memoryUsedByLayerData-=c.memoryUsed,c.type===o.BucketType.SYMBOL&&this.symbols.has(u)&&(this.symbols.delete(u),t=!0),c.destroy(),this.layerData.delete(u),this.layerCount--}}}catch(e){i=!0,n=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw n}}(0,a.isSome)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),t&&this.emit("symbols-changed"),this.requestRender()}},{key:"processed",value:function(){return this._processed}},{key:"hasData",value:function(){return this.layerCount>0}},{key:"dispose",value:function(){"unloaded"!==this.status&&(y.delete(this),r._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}},{key:"release",value:function(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}},{key:"retain",value:function(){++this._referenced}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}},{key:"changeDataImpl",value:function(e){var t=!1;if(e){var r=e.bucketsWithData,i=e.emptyBuckets,s=this._createRenderBuckets(r);if(i&&i.byteLength>0){var l=new Uint32Array(i),u=!0,c=!1,h=void 0;try{for(var y,f=l[Symbol.iterator]();!(u=(y=f.next()).done);u=!0){var d=y.value;this._deleteLayerData(d)}}catch(e){c=!0,h=e}finally{try{u||null==f.return||f.return()}finally{if(c)throw h}}}var v=!0,p=!1,_=void 0;try{for(var g,m=s[Symbol.iterator]();!(v=(g=m.next()).done);v=!0){var x=n.slicedToArray(g.value,2),b=x[0],S=x[1];this._deleteLayerData(b),S.type===o.BucketType.SYMBOL&&(this.symbols.set(b,S.symbols),t=!0),this._memoryUsedByLayerData+=S.memoryUsed,this.layerData.set(b,S),this.layerCount++}}catch(e){p=!0,_=e}finally{try{v||null==m.return||m.return()}finally{if(p)throw _}}(0,a.isSome)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;var w=!0,k=!1,T=void 0;try{for(var C,R=this.layerData[Symbol.iterator]();!(w=(C=R.next()).done);w=!0){var I=n.slicedToArray(C.value,2);I[0];I[1].type===o.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0)}}catch(e){k=!0,T=e}finally{try{w||null==R.return||R.return()}finally{if(k)throw T}}t&&this.emit("symbols-changed")}},{key:"attachWithContext",value:function(e){this.stage={context:e,trashDisplayObject:function(e){e.processDetach()},untrashDisplayObject:function(){return!1}}}},{key:"setTransform",value:function(e,t){n.get(n.getPrototypeOf(r.prototype),"setTransform",this).call(this,e,t);var i=t/(e.resolution*e.pixelRatio),a=this.width/this.rangeX*i,l=this.height/this.rangeY*i,o=[0,0];e.toScreen(o,[this.x,this.y]);var u=this.transforms.tileUnitsToPixels;(0,s.b)(u),(0,s.c)(u,u,o),(0,s.r)(u,u,Math.PI*e.rotation/180),(0,s.d)(u,u,[a,l,1])}},{key:"_createTransforms",value:function(){return{dvs:(0,l.c)(),tileMat3:(0,l.c)(),tileUnitsToPixels:(0,l.c)()}}},{key:"_createRenderBuckets",value:function(e){var t=new Map,r=new Map,i=!0,n=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var o=s.value,u=this._deserializeBucket(o,r),c=!0,h=!1,y=void 0;try{for(var f,d=u.layerUIDs[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var v=f.value;t.set(v,u)}}catch(e){h=!0,y=e}finally{try{c||null==d.return||d.return()}finally{if(h)throw y}}}}catch(e){n=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(n)throw a}}return t}},{key:"_deserializeBucket",value:function(e,t){var r=t.get(e);if(r)return r;switch(new Uint32Array(e)[0]){case o.BucketType.FILL:r=new(0,u.FillRenderBucket)(e,this.styleRepository);break;case o.BucketType.LINE:r=new(0,u.LineRenderBucket)(e,this.styleRepository);break;case o.BucketType.SYMBOL:r=new(0,u.SymbolRenderBucket)(e,this.styleRepository,this);break;case o.BucketType.CIRCLE:r=new(0,u.CircleRenderBucket)(e,this.styleRepository)}return t.set(e,r),r}},{key:"_deleteLayerData",value:function(e){if(this.layerData.has(e)){var t=this.layerData.get(e);this._memoryUsedByLayerData-=t.memoryUsed,t.destroy(),this.layerData.delete(e),this.layerCount--}}}],[{key:"_destroyRenderBuckets",value:function(e){if(e){var t=new Set;e.forEach((function(e){t.has(e)||(e.destroy(),t.add(e))})),e.clear()}}}]),r}(r("8eM7H").TiledDisplayObject),y=new Map})),r.register("cGt56",(function(e,i){t(e.exports,"LineRenderBucket",(function(){return y})),t(e.exports,"FillRenderBucket",(function(){return f})),t(e.exports,"SymbolRenderBucket",(function(){return d})),t(e.exports,"CircleRenderBucket",(function(){return v}));var n=r("8TSCy"),a=r("7qybv"),s=r("acBaq"),l=r("99iYp"),o=r("iRJeW"),u=r("8JzMA"),c=r("4aQus"),h=function(){"use strict";function e(t,r){n.classCallCheck(this,e),this.layerUIDs=[],this.isDestroyed=!1,this.data=t,this.memoryUsed=t.byteLength;var i=1,a=new Uint32Array(t);this.layerUIDs=[];for(var s=a[i++],l=0;l<s;l++)this.layerUIDs[l]=a[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}return n.createClass(e,[{key:"isPreparedForRendering",get:function(){return(0,a.isNone)(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}},{key:"destroy",value:function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}},{key:"prepareForRendering",value:function(e){(0,a.isNone)(this.data)||(this.doPrepareForRendering(e,this.data,this.bufferDataOffset),this.data=null)}}]),e}(),y=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i){var a;n.classCallCheck(this,r),(a=t.call(this,e,i)).type=s.BucketType.LINE,a.lineIndexStart=0,a.lineIndexCount=0;var l=new Uint32Array(e),o=a.bufferDataOffset;a.lineIndexStart=l[o++],a.lineIndexCount=l[o++];var u=l[o++];if(u>0){for(var c=new Map,h=0;h<u;h++){var y=l[o++],f=l[o++],d=l[o++];c.set(y,[f,d])}a.patternMap=c}return a.bufferDataOffset=o,n.possibleConstructorReturn(a)}return n.createClass(r,[{key:"hasData",value:function(){return this.lineIndexCount>0}},{key:"triangleCount",value:function(){return this.lineIndexCount/3}},{key:"doDestroy",value:function(){(0,a.isSome)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),(0,a.isSome)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),(0,a.isSome)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),a=i[r++];this.lineVertexBuffer=o.BufferObject.createVertex(e,u.Usage.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;var s=i[r++];this.lineIndexBuffer=o.BufferObject.createIndex(e,u.Usage.STATIC_DRAW,new Uint32Array(i.buffer,4*r,s)),r+=s;var l=this.layer.lineMaterial;this.lineVertexArrayObject=new(0,c.VertexArrayObject)(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}]),r}(h),f=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i){var a;n.classCallCheck(this,r),(a=t.call(this,e,i)).type=s.BucketType.FILL,a.fillIndexStart=0,a.fillIndexCount=0,a.outlineIndexStart=0,a.outlineIndexCount=0;var l=new Uint32Array(e),o=a.bufferDataOffset;a.fillIndexStart=l[o++],a.fillIndexCount=l[o++],a.outlineIndexStart=l[o++],a.outlineIndexCount=l[o++];var u=l[o++];if(u>0){for(var c=new Map,h=0;h<u;h++){var y=l[o++],f=l[o++],d=l[o++];c.set(y,[f,d])}a.patternMap=c}return a.bufferDataOffset=o,n.possibleConstructorReturn(a)}return n.createClass(r,[{key:"hasData",value:function(){return this.fillIndexCount>0||this.outlineIndexCount>0}},{key:"triangleCount",value:function(){return(this.fillIndexCount+this.outlineIndexCount)/3}},{key:"doDestroy",value:function(){(0,a.isSome)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),(0,a.isSome)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),(0,a.isSome)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,(0,a.isSome)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),(0,a.isSome)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),(0,a.isSome)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),a=i[r++];this.fillVertexBuffer=o.BufferObject.createVertex(e,u.Usage.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;var s=i[r++];this.fillIndexBuffer=o.BufferObject.createIndex(e,u.Usage.STATIC_DRAW,new Uint32Array(i.buffer,4*r,s)),r+=s;var l=i[r++];this.outlineVertexBuffer=o.BufferObject.createVertex(e,u.Usage.STATIC_DRAW,new Int32Array(n.buffer,4*r,l)),r+=l;var h=i[r++];this.outlineIndexBuffer=o.BufferObject.createIndex(e,u.Usage.STATIC_DRAW,new Uint32Array(i.buffer,4*r,h)),r+=h;var y=this.layer,f=y.fillMaterial,d=y.outlineMaterial;this.fillVertexArrayObject=new(0,c.VertexArrayObject)(e,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new(0,c.VertexArrayObject)(e,d.getAttributeLocations(),d.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}]),r}(h),d=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i,a){var o;n.classCallCheck(this,r),(o=t.call(this,e,i)).type=s.BucketType.SYMBOL,o.iconPerPageElementsMap=new Map,o.glyphPerPageElementsMap=new Map,o.symbolInstances=[],o.isIconSDF=!1,o.opacityChanged=!1,o.lastOpacityUpdate=0,o.symbols=[];var u=new Uint32Array(e),c=new Int32Array(e),h=new Float32Array(e),y=o.bufferDataOffset;o.isIconSDF=!!u[y++];for(var f=u[y++],d=0;d<f;d++){var v=u[y++],p=u[y++],_=u[y++];o.iconPerPageElementsMap.set(v,[p,_])}for(var g=u[y++],m=0;m<g;m++){var x=u[y++],b=u[y++],S=u[y++];o.glyphPerPageElementsMap.set(x,[b,S])}var w=u[y++],k=u[y++];return o.iconOpacity=new Int32Array(w),o.textOpacity=new Int32Array(k),y=(0,l.deserializeSymbols)(u,c,h,y,o.symbols,a),o.bufferDataOffset=y,n.possibleConstructorReturn(o)}return n.createClass(r,[{key:"hasData",value:function(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}},{key:"triangleCount",value:function(){var e=0,t=!0,r=!1,i=void 0;try{for(var a,s=this.iconPerPageElementsMap[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var l=n.slicedToArray(a.value,2);l[0];e+=l[1][1]}}catch(e){r=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(r)throw i}}var o=!0,u=!1,c=void 0;try{for(var h,y=this.glyphPerPageElementsMap[Symbol.iterator]();!(o=(h=y.next()).done);o=!0){var f=n.slicedToArray(h.value,2);f[0];e+=f[1][1]}}catch(e){u=!0,c=e}finally{try{o||null==y.return||y.return()}finally{if(u)throw c}}return e/3}},{key:"doDestroy",value:function(){(0,a.isSome)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),(0,a.isSome)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),(0,a.isSome)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),(0,a.isSome)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,(0,a.isSome)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),(0,a.isSome)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),(0,a.isSome)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),(0,a.isSome)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}},{key:"updateOpacityInfo",value:function(){if(this.opacityChanged){this.opacityChanged=!1;var e=(0,a.unwrap)(this.iconOpacity),t=(0,a.unwrap)(this.iconOpacityBuffer);e.length>0&&e.byteLength===t.size&&t.setSubData(e);var r=(0,a.unwrap)(this.textOpacity),i=(0,a.unwrap)(this.textOpacityBuffer);r.length>0&&r.byteLength===i.size&&i.setSubData(r)}}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),s=i[r++];this.iconVertexBuffer=o.BufferObject.createVertex(e,u.Usage.STATIC_DRAW,new Int32Array(n.buffer,4*r,s)),r+=s;var l=i[r++];this.iconIndexBuffer=o.BufferObject.createIndex(e,u.Usage.STATIC_DRAW,new Uint32Array(i.buffer,4*r,l)),r+=l;var h=i[r++];this.textVertexBuffer=o.BufferObject.createVertex(e,u.Usage.STATIC_DRAW,new Int32Array(n.buffer,4*r,h)),r+=h;var y=i[r++];this.textIndexBuffer=o.BufferObject.createIndex(e,u.Usage.STATIC_DRAW,new Uint32Array(i.buffer,4*r,y)),r+=y,this.iconOpacityBuffer=o.BufferObject.createVertex(e,u.Usage.STATIC_DRAW,(0,a.unwrap)(this.iconOpacity).buffer),this.textOpacityBuffer=o.BufferObject.createVertex(e,u.Usage.STATIC_DRAW,(0,a.unwrap)(this.textOpacity).buffer);var f=this.layer,d=f.iconMaterial,v=f.textMaterial;this.iconVertexArrayObject=new(0,c.VertexArrayObject)(e,d.getAttributeLocations(),d.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new(0,c.VertexArrayObject)(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}]),r}(h),v=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i){var a;n.classCallCheck(this,r),(a=t.call(this,e,i)).type=s.BucketType.CIRCLE,a.circleIndexStart=0,a.circleIndexCount=0;var l=new Uint32Array(e),o=a.bufferDataOffset;return a.circleIndexStart=l[o++],a.circleIndexCount=l[o++],a.bufferDataOffset=o,n.possibleConstructorReturn(a)}return n.createClass(r,[{key:"hasData",value:function(){return this.circleIndexCount>0}},{key:"triangleCount",value:function(){return this.circleIndexCount/3}},{key:"doDestroy",value:function(){(0,a.isSome)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),(0,a.isSome)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),(0,a.isSome)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}},{key:"doPrepareForRendering",value:function(e,t,r){var i=new Uint32Array(t),n=new Int32Array(i.buffer),a=i[r++];this.circleVertexBuffer=o.BufferObject.createVertex(e,u.Usage.STATIC_DRAW,new Int32Array(n.buffer,4*r,a)),r+=a;var s=i[r++];this.circleIndexBuffer=o.BufferObject.createIndex(e,u.Usage.STATIC_DRAW,new Uint32Array(i.buffer,4*r,s)),r+=s;var l=this.layer.circleMaterial;this.circleVertexArrayObject=new(0,c.VertexArrayObject)(e,l.getAttributeLocations(),l.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}]),r}(h)})),r.register("99iYp",(function(e,i){t(e.exports,"tileCoordChange",(function(){return l})),t(e.exports,"GridIndex",(function(){return o})),t(e.exports,"deserializeSymbols",(function(){return u})),t(e.exports,"writeOpacityToBuffers",(function(){return c}));var n=r("8TSCy"),a=(r("7qybv"),r("acBaq")),s=r("hrbqb");function l(e,t,r,i,n,a){var s=r-n;if(s>=0)return(t>>s)+(i-(a<<s))*(e>>s);var l=-s;return t-(a-(i<<l))*(e>>l)<<l}var o=function(){"use strict";function e(t,r,i){n.classCallCheck(this,e),this._rows=Math.ceil(r/i),this._columns=Math.ceil(t/i),this._cellSize=i,this.cells=new Array(this._rows);for(var a=0;a<this._rows;a++){this.cells[a]=new Array(this._columns);for(var s=0;s<this._columns;s++)this.cells[a][s]=[]}}return n.createClass(e,[{key:"getCell",value:function(e,t){var r=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),i=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[r]&&this.cells[r][i]||null}},{key:"getCellSpan",value:function(e,t,r,i){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.rows-1)]}},{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]),e}();function u(e,t,r,i,n,a){for(var l=t[i++],o=0;o<l;o++){var u=new(0,s.VTLSymbol)(a);u.xTile=t[i++],u.yTile=t[i++],u.hash=t[i++],u.priority=t[i++];for(var c=t[i++],h=0;h<c;h++){var y=t[i++],f=t[i++],d=t[i++],v=t[i++],p=!!t[i++],_=t[i++],g=r[i++],m=r[i++],x=t[i++],b=t[i++];u.colliders.push({xTile:y,yTile:f,dxPixels:d,dyPixels:v,hard:p,partIndex:_,width:x,height:b,minLod:g,maxLod:m})}for(var S=e[i++],w=0;w<S;w++)u.textVertexRanges.push([e[i++],e[i++]]);for(var k=e[i++],T=0;T<k;T++)u.iconVertexRanges.push([e[i++],e[i++]]);n.push(u)}return i}function c(e,t,r){var i=!0,a=!1,s=void 0;try{for(var l,o=e.symbols[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var u=n.slicedToArray(l.value,2),c=u[0];h(e,t,r,u[1],c)}}catch(e){a=!0,s=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw s}}}function h(e,t,r,i,s){var l=e.layerData.get(s);if(l.type===a.BucketType.SYMBOL){var o=!0,u=!1,c=void 0;try{for(var h,y=i[Symbol.iterator]();!(o=(h=y.next()).done);o=!0){var f=h.value,d=f.unique,v=void 0;if(f.selectedForRendering){var p=d.parts[0],_=p.startOpacity,g=p.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===g;var m=r?Math.floor(127*_)|g<<7:g?255:0;v=m<<24|m<<16|m<<8|m}else v=0;var x=!0,b=!1,S=void 0;try{for(var w,k=f.iconVertexRanges[Symbol.iterator]();!(x=(w=k.next()).done);x=!0)for(var T=n.slicedToArray(w.value,2),C=T[0],R=T[1],I=C;I<C+R;I+=4)l.iconOpacity[I/4]=v}catch(e){b=!0,S=e}finally{try{x||null==k.return||k.return()}finally{if(b)throw S}}if(f.selectedForRendering){var A=d.parts[1],P=A.startOpacity,D=A.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===D;var B=r?Math.floor(127*P)|D<<7:D?255:0;v=B<<24|B<<16|B<<8|B}else v=0;var L=!0,O=!1,M=void 0;try{for(var U,V=f.textVertexRanges[Symbol.iterator]();!(L=(U=V.next()).done);L=!0)for(var E=n.slicedToArray(U.value,2),q=E[0],z=E[1],F=q;F<q+z;F+=4)l.textOpacity[F/4]=v}catch(e){O=!0,M=e}finally{try{L||null==V.return||V.return()}finally{if(O)throw M}}}}catch(e){u=!0,c=e}finally{try{o||null==y.return||y.return()}finally{if(u)throw c}}l.lastOpacityUpdate=t,l.opacityChanged=!0}}})),r.register("hrbqb",(function(e,i){t(e.exports,"VTLSymbol",(function(){return a})),t(e.exports,"VTLUniqueSymbol",(function(){return s}));var n=r("8TSCy"),a=function e(t){"use strict";n.classCallCheck(this,e),this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t},s=function e(){"use strict";n.classCallCheck(this,e),this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}})),r.register("ebEEs",(function(e,r){t(e.exports,"DECLUTTER_TILES",(function(){return i})),t(e.exports,"COLLISION_GRID_CELL_SIZE",(function(){return n})),t(e.exports,"DECLUTTER_BUDGET",(function(){return a})),t(e.exports,"FADE_DURATION",(function(){return s}));var i=!0,n=32,a=1.5,s=200})),r.register("8eM7H",(function(e,i){t(e.exports,"TiledDisplayObject",(function(){return o}));var n=r("8TSCy"),a=r("j3x2p"),s=r("2qlsz"),l=r("i90gL"),o=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i,a,s,o){var u,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:s,h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o;return n.classCallCheck(this,r),(u=t.call(this)).triangleCountReportedInDebug=0,u.triangleCount=0,u.texture=null,u.key=new(0,l.default)(e),u.x=i,u.y=a,u.width=s,u.height=o,u.rangeX=c,u.rangeY=h,n.possibleConstructorReturn(u)}return n.createClass(r,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"setTransform",value:function(e,t){var r=t/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,s=n.slicedToArray(e.toScreenNoRotation([0,0],[this.x,this.y]),2),l=s[0],o=s[1],u=this.width/this.rangeX*r,c=this.height/this.rangeY*r;(0,a.s)(i,u,0,0,0,c,0,l,o,1),(0,a.m)(this.transforms.dvs,e.displayViewMat3,i)}}]),r}(s.DisplayObject)})),r.register("2qlsz",(function(e,i){t(e.exports,"DisplayObject",(function(){return c}));var n=r("8TSCy"),a=r("amfHf"),s=r("2VlWd"),l=r("7qybv"),o=r("10vEZ"),u=1/(0,s.default)("mapview-transitions-duration"),c=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(){var e;return n.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))))._fadeOutResolver=null,e._fadeInResolver=null,e._clips=null,e.computedVisible=!0,e.computedOpacity=1,e.fadeTransitionEnabled=!1,e.inFadeTransition=!1,e._isReady=!1,e._opacity=1,e._stage=null,e._visible=!0,n.possibleConstructorReturn(e)}return n.createClass(r,[{key:"clips",get:function(){return this._clips},set:function(e){this._clips=e,this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(e){if(this._stage!==e){var t=this._stage;this._stage=e,e?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t.trashDisplayObject(this)}}},{key:"transforms",get:function(){return this._getTransforms()}},{key:"_getTransforms",value:function(){return(0,l.isNone)(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible!==e&&(this._visible=e,this.requestRender())}},{key:"fadeIn",value:function(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=(0,o.createResolver)(),this.requestRender()),this._fadeInResolver.promise}},{key:"fadeOut",value:function(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=(0,o.createResolver)(),this.requestRender()),this._fadeOutResolver.promise}},{key:"beforeRender",value:function(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}},{key:"afterRender",value:function(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}},{key:"remove",value:function(){var e;null==(e=this.parent)||e.removeChild(this)}},{key:"setTransform",value:function(e){}},{key:"processRender",value:function(e){this.stage&&this.computedVisible&&this.doRender(e)}},{key:"requestRender",value:function(){this.stage&&this.stage.requestRender()}},{key:"processDetach",value:function(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}},{key:"updateTransitionProperties",value:function(e,t){if(this.fadeTransitionEnabled){var r=this._fadeOutResolver||!this.visible?0:this.opacity,i=this.computedOpacity;if(i===r)this.computedVisible=this.visible;else{var n=e*u;this.computedOpacity=i>r?Math.max(r,i-n):Math.min(r,i+n),this.computedVisible=this.computedOpacity>0;var a=r===this.computedOpacity;this.inFadeTransition=!a,a||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}},{key:"onAttach",value:function(){}},{key:"onDetach",value:function(){}},{key:"doRender",value:function(e){}},{key:"ready",value:function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}]),r}(a.default)})),r.register("3VnGQ",(function(i,n){t(i.exports,"VectorTileContainer",(function(){return x}));var a=r("8TSCy"),s=r("2TvXO"),l=r("7qybv"),o=r("10vEZ"),u=r("8TwEW"),c=r("aNIG8"),h=r("cXGy9"),y=r("66IJZ"),f=r("faBGm"),d=r("3v0eQ"),v=r("eoIYU"),p=r("i90gL"),_=r("8JzMA"),g=1e-6;function m(e,t){if(e){var r=e.getLayoutProperty("visibility");if(!r||r.getValue()!==h.Visibility.NONE&&(void 0===e.minzoom||e.minzoom<t+g)&&(void 0===e.maxzoom||e.maxzoom>=t-g))return!0}return!1}var x=function(t){"use strict";a.inherits(i,t);var r=a.createSuper(i);function i(e){var t;return a.classCallCheck(this,i),(t=r.call(this,e))._backgroundTiles=[],t._pointToCallbacks=new Map,a.possibleConstructorReturn(t)}return a.createClass(i,[{key:"destroy",value:function(){this.removeAllChildren(),this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null),(0,l.isSome)(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[],this._pointToCallbacks.clear()}},{key:"setStyleResources",value:function(e,t,r){if(this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=r,(0,l.isNone)(this._symbolFader)){var i=this,n=new(0,c.SymbolFader)(this._styleRepository,this.children);n.on("fade-start",(function(){i.emit("fade-start"),i.requestRender()})),n.on("fade-complete",(function(){i.emit("fade-complete"),i.requestRender()})),this._symbolFader=n}(0,l.unwrap)(this._symbolFader).styleRepository=r}},{key:"setSpriteMosaic",value:function(e){this._spriteMosaic.dispose(),this._spriteMosaic=e}},{key:"deleteStyleLayers",value:function(e){(0,l.isSome)(this._symbolFader)&&this._symbolFader.deleteStyleLayers(e)}},{key:"hitTest",value:function(t){var r=this;return a.asyncToGenerator(e(s).mark((function i(){var n;return e(s).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,o.createResolver)(),e.abrupt("return",(r._pointToCallbacks.set(t,n),r.requestRender(),n.promise));case 2:case"end":return e.stop()}}),i)})))()}},{key:"enterTileInvalidation",value:function(){var e=!0,t=!1,r=void 0;try{for(var i,n=this.children[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){i.value.invalidating=!0}}catch(e){t=!0,r=e}finally{try{e||null==n.return||n.return()}finally{if(t)throw r}}}},{key:"createRenderParams",value:function(e){return a.objectSpread({},a.get(a.getPrototypeOf(i.prototype),"createRenderParams",this).call(this,e),{renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos})}},{key:"doRender",value:function(e){!this.visible||e.drawPhase!==y.WGLDrawPhase.MAP&&e.drawPhase!==y.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||a.get(a.getPrototypeOf(i.prototype),"doRender",this).call(this,e)}},{key:"addChild",value:function(e){return a.get(a.getPrototypeOf(i.prototype),"addChild",this).call(this,e),(0,l.isSome)(this._symbolFader)?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}},{key:"removeChild",value:function(e){return(0,l.isSome)(this._symbolFader)&&this._symbolFader.removeTile(e),this.requestRender(),a.get(a.getPrototypeOf(i.prototype),"removeChild",this).call(this,e)}},{key:"renderChildren",value:function(e){var t=e.drawPhase;if(t!==y.WGLDrawPhase.DEBUG){if(this._doRender(e),this._pointToCallbacks.size>0){e.drawPhase=y.WGLDrawPhase.HITTEST;var r=e.painter.effects.hittestVTL;r.bind(e),this._doRender(e),r.draw(e,this._pointToCallbacks),r.unbind(e),e.drawPhase=t}}else a.get(a.getPrototypeOf(i.prototype),"renderChildren",this).call(this,e)}},{key:"removeAllChildren",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];(0,l.isSome)(this._symbolFader)&&this._symbolFader.removeTile(t),t.dispose()}a.get(a.getPrototypeOf(i.prototype),"removeAllChildren",this).call(this)}},{key:"getStencilTarget",value:function(){return this.children.filter((function(e){return e.neededForCoverage&&e.hasData()}))}},{key:"restartDeclutter",value:function(){(0,l.isSome)(this._symbolFader)&&this._symbolFader.restartDeclutter()}},{key:"_doRender",value:function(e){var t=e.context,r=this._styleRepository;if(r){var n=r.layers,s=!0;e.drawPhase===y.WGLDrawPhase.HITTEST&&(s=!1),r.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,r.backgroundBucketIds)),a.get(a.getPrototypeOf(i.prototype),"renderChildren",this).call(this,e),e.drawPhase===y.WGLDrawPhase.MAP&&this._fade(e.displayLevel,e.state);var l=this.children.filter((function(e){return e.visible&&e.hasData()}));if(!l||0===l.length)return t.bindVAO(),t.setStencilTestEnabled(!0),void t.setBlendingEnabled(!0);var o=!0,u=!1,c=void 0;try{for(var h,f=l[Symbol.iterator]();!(o=(h=f.next()).done);o=!0){h.value.triangleCount=0}}catch(e){u=!0,c=e}finally{try{o||null==f.return||f.return()}finally{if(u)throw c}}t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(_.StencilOperation.KEEP,_.StencilOperation.KEEP,_.StencilOperation.REPLACE),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(_.CompareFunction.LEQUAL),t.setClearDepth(1),t.clear(t.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(var d=n.length-1;d>=0;d--)this._renderStyleLayer(n[d],e,l);t.setDepthWriteEnabled(!1),t.setBlendingEnabled(s),t.setBlendFunctionSeparate(_.BlendFactor.ONE,_.BlendFactor.ONE_MINUS_SRC_ALPHA,_.BlendFactor.ONE,_.BlendFactor.ONE_MINUS_SRC_ALPHA),e.renderPass="translucent";for(var v=0;v<n.length;v++)this._renderStyleLayer(n[v],e,l);t.setDepthTestEnabled(!1),e.renderPass="symbol";for(var p=0;p<n.length;p++)this._renderStyleLayer(n[p],e,l);t.bindVAO(),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!0)}}},{key:"_fade",value:function(e,t){(0,l.isSome)(this._symbolFader)&&(this._symbolFader.update(e,t)||this.requestRender())}},{key:"_renderStyleLayer",value:function(e,t,r){var i=t.painter,n=t.renderPass;if(void 0!==e){var a=e.getLayoutProperty("visibility");if(!a||a.getValue()!==h.Visibility.NONE){var s;switch(e.type){case h.StyleLayerType.BACKGROUND:return;case h.StyleLayerType.FILL:if("opaque"!==n&&"translucent"!==t.renderPass)return;s="vtlFill";break;case h.StyleLayerType.LINE:if("translucent"!==n)return;s="vtlLine";break;case h.StyleLayerType.CIRCLE:if("symbol"!==n)return;s="vtlCircle";break;case h.StyleLayerType.SYMBOL:if("symbol"!==n)return;s="vtlSymbol"}if(r=e.type===h.StyleLayerType.SYMBOL?r.filter((function(e){return e.decluttered})):r.filter((function(e){return e.neededForCoverage})),"vtlSymbol"!==s){var l=t.displayLevel;if(0===r.length||void 0!==e.minzoom&&e.minzoom>=l+g||void 0!==e.maxzoom&&e.maxzoom<l-g)return}var o=e.uid;t.styleLayerUID=o,t.styleLayer=e;var u=!0,c=!1,y=void 0;try{for(var f,d=r[Symbol.iterator]();!(u=(f=d.next()).done);u=!0){if(f.value.layerData.has(o)){i.renderObjects(t,r,s);break}}}catch(e){c=!0,y=e}finally{try{u||null==d.return||d.return()}finally{if(c)throw y}}}}}},{key:"_renderBackgroundLayers",value:function(e,t){var r=e.context,i=e.displayLevel,n=e.painter,a=e.state,s=this._styleRepository,o=!1,c=!0,d=!1,g=void 0;try{for(var x,b=t[Symbol.iterator]();!(c=(x=b.next()).done);c=!0){var S=x.value;if(s.getLayerById(S).type===h.StyleLayerType.BACKGROUND&&m(s.getLayerById(S),i)){o=!0;break}}}catch(e){d=!0,g=e}finally{try{c||null==b.return||b.return()}finally{if(d)throw g}}if(o){var w=this._tileInfoView.getTileCoverage(e.state,0,"smallest"),k=w.spans,T=w.lodInfo,C=T.level,R=(0,u.create)(),I=[];if(this._renderPasses){var A=this._renderPasses[0];(0,l.isSome)(this._clippingInfos)&&(A.brushes[0].prepareState(e,this._clippingInfos[0]),A.brushes[0].drawMany(e,this._clippingInfos))}var P,D=this._backgroundTiles,B=0,L=!0,O=!1,M=void 0;try{for(var U,V=k[Symbol.iterator]();!(L=(U=V.next()).done);L=!0)for(var E=U.value,q=E.row,z=E.colFrom,F=E.colTo,H=z;H<=F;H++){if(B<D.length)(P=D[B]).key.set(C,q,T.normalizeCol(H),T.getWorldForColumn(H)),this._tileInfoView.getTileBounds(R,P.key,!1),P.x=R[0],P.y=R[3];else{var N=new(0,p.default)(C,q,T.normalizeCol(H),T.getWorldForColumn(H)),G=this._tileInfoView.getTileBounds((0,u.create)(),N);P=new(0,f.RenderableTile)(N,G[0],G[3],512,512,4096,4096),D.push(P)}P.setTransform(a,this._tileInfoView.getTileResolution(P.key)),I.push(P),B++}}catch(e){O=!0,M=e}finally{try{L||null==V.return||V.return()}finally{if(O)throw M}}r.setStencilWriteMask(0),r.setColorMask(!0,!0,!0,!0),r.setStencilOp(_.StencilOperation.KEEP,_.StencilOperation.KEEP,_.StencilOperation.REPLACE),r.setStencilFunction(_.CompareFunction.EQUAL,0,255);var j=!0;e.drawPhase===y.WGLDrawPhase.HITTEST&&(j=!1),r.setStencilTestEnabled(j);var W=!0,Q=!1,Y=void 0;try{for(var J,Z=t[Symbol.iterator]();!(W=(J=Z.next()).done);W=!0){var X=J.value,K=s.getLayerById(X);K.type===h.StyleLayerType.BACKGROUND&&m(K,i)&&(e.styleLayerUID=K.uid,e.styleLayer=K,n.renderObjects(e,I,"vtlBackground"))}}catch(e){Q=!0,Y=e}finally{try{W||null==Z.return||Z.return()}finally{if(Q)throw Y}}v.default.pool.release(w)}}}]),i}(d.default)})),r.register("aNIG8",(function(e,i){t(e.exports,"SymbolFader",(function(){return v}));var n=r("8TSCy"),a=r("amfHf"),s=r("7qybv"),l=r("ebEEs"),o=r("hrbqb"),u=r("cG7Uz"),c=r("jXNn1"),h=r("bQZMG"),y=r("99iYp"),f=r("cXGy9"),d=1e-6,v=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e,i){var a;return n.classCallCheck(this,r),(a=t.call(this)).styleRepository=e,a._tileToHandle=new Map,a._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},a._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},a._completed=!1,a._symbolRepository=new(0,h.SymbolRepository)(4096,i,(function(){return new(0,o.VTLUniqueSymbol)})),a._symbolDeclutterer=new(0,c.SymbolDeclutterer)(i,a._symbolRepository,(function(e,t,r){return new(0,u.CollisionJob)(e,t,r,a.styleRepository,a._zoom,a._viewState.rotation)}),(function(e,t){e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,(0,y.writeOpacityToBuffers)(e,t,!0),e.decluttered=!0,e.requestRender()}),(function(e,t){return a.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-a.styleRepository.getStyleLayerByUID(t.styleLayerUID).z}),(function(e){var t=a.styleRepository.getStyleLayerByUID(e);if(a._zoom+d<t.minzoom||a._zoom-d>=t.maxzoom)return!1;var r=t.getLayoutProperty("visibility");return!r||r.getValue()!==f.Visibility.NONE})),n.possibleConstructorReturn(a)}return n.createClass(r,[{key:"addTile",value:function(e){var t=this;e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",(function(){t._symbolRepository.add(e),t.restartDeclutter()}))),this._symbolRepository.add(e),this.restartDeclutter()}},{key:"removeTile",value:function(e){var t=this._tileToHandle.get(e);t&&(this._symbolRepository.removeTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}},{key:"update",value:function(e,t){return this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]},this._continueDeclutter(),this._completed}},{key:"restartDeclutter",value:function(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}},{key:"clear",value:function(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((function(e){return e.remove()})),this._tileToHandle.clear()}},{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}},{key:"deleteStyleLayers",value:function(e){this._symbolRepository.deleteStyleLayers(e)}},{key:"_continueDeclutter",value:function(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(l.DECLUTTER_BUDGET),this._completed&&this._scheduleNotifyStable())}},{key:"_scheduleNotifyStable",value:function(){var e=this;(0,s.isSome)(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((function(){e._stableNotificationHandle=null,e.emit("fade-complete")}),1.5*l.FADE_DURATION)}},{key:"_notifyUnstable",value:function(){(0,s.isSome)(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this.emit("fade-start")}}]),r}(a.default)})),r.register("cG7Uz",(function(e,i){t(e.exports,"CollisionJob",(function(){return c}));var n=r("8TSCy"),a=r("eYrMi"),s=r("ebEEs"),l=r("99iYp"),o=r("cXGy9");function u(e,t,r,i,a,s){var l=i.iconRotationAlignment,u=i.textRotationAlignment,c=i.iconTranslate,h=i.iconTranslateAnchor,y=i.textTranslate,f=i.textTranslateAnchor,d=0,v=!0,p=!1,_=void 0;try{for(var g,m=e.colliders[Symbol.iterator]();!(v=(g=m.next()).done);v=!0){var x=g.value,b=n.slicedToArray(0===x.partIndex?c:y,2),S=b[0],w=b[1],k=0===x.partIndex?h:f,T=x.minLod<=s&&s<=x.maxLod;d+=T?0:1,x.enabled=T,x.xScreen=x.xTile*a[0]+x.yTile*a[3]+a[6],x.yScreen=x.xTile*a[1]+x.yTile*a[4]+a[7],k===o.TranslateAnchor.MAP?(x.xScreen+=r*S-t*w,x.yScreen+=t*S+r*w):(x.xScreen+=S,x.yScreen+=w),o.RotationAlignment.VIEWPORT===(0===x.partIndex?l:u)?(x.dxScreen=x.dxPixels,x.dyScreen=x.dyPixels):(x.dxScreen=r*(x.dxPixels+x.width/2)-t*(x.dyPixels+x.height/2)-x.width/2,x.dyScreen=t*(x.dxPixels+x.width/2)+r*(x.dyPixels+x.height/2)-x.height/2)}}catch(e){p=!0,_=e}finally{try{v||null==m.return||m.return()}finally{if(p)throw _}}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}var c=function(){"use strict";function e(t,r,i,o,u,c){n.classCallCheck(this,e),this._symbols=t,this._styleRepository=o,this._zoom=u,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new(0,l.GridIndex)(r,i,s.COLLISION_GRID_CELL_SIZE),this._si=Math.sin(Math.PI*c/180),this._co=Math.cos(Math.PI*c/180);var h=!0,y=!1,f=void 0,d=!0,v=!1,p=void 0;try{for(var _,g=t[Symbol.iterator]();!(d=(_=g.next()).done);d=!0){var m=_.value;try{for(var x,b=m.symbols[Symbol.iterator]();!(h=(x=b.next()).done);h=!0){var S=x.value;this._allNeededMatrices.has(S.tile)||this._allNeededMatrices.set(S.tile,(0,a.a)(S.tile.transforms.tileUnitsToPixels))}}catch(e){y=!0,f=e}finally{try{h||null==b.return||b.return()}finally{if(y)throw f}}}}catch(e){v=!0,p=e}finally{try{d||null==g.return||g.return()}finally{if(v)throw p}}}return n.createClass(e,[{key:"work",value:function(e){var t=this._gridIndex;function r(e){for(var r=e.xScreen+e.dxScreen,i=e.yScreen+e.dyScreen,a=r+e.width,s=i+e.height,l=n.slicedToArray(t.getCellSpan(r,i,a,s),4),o=l[0],u=l[1],c=l[2],h=l[3],y=u;y<=h;y++)for(var f=o;f<=c;f++){var d=t.cells[y][f],v=!0,p=!1,_=void 0;try{for(var g,m=d[Symbol.iterator]();!(v=(g=m.next()).done);v=!0){var x=g.value,b=x.xScreen+x.dxScreen,S=x.yScreen+x.dyScreen,w=b+x.width,k=S+x.height;if(!(a<b||r>w||s<S||i>k))return!0}}catch(e){p=!0,_=e}finally{try{v||null==m.return||m.return()}finally{if(p)throw _}}}return!1}for(var i=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var a=this._symbols[this._currentLayerCursor],s=this._getProperties(a.styleLayerUID);this._currentSymbolCursor<a.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-i>e)return!1;var l=a.symbols[this._currentSymbolCursor];if(l.unique.show){u(l,this._si,this._co,s,this._allNeededMatrices.get(l.tile),this._zoom);var o=l.unique;if(o.show){var c=s.iconAllowOverlap,h=s.iconIgnorePlacement,y=s.textAllowOverlap,f=s.textIgnorePlacement,d=!0,v=!1,p=void 0;try{for(var _,g=l.colliders[Symbol.iterator]();!(d=(_=g.next()).done);d=!0){var m=_.value;if(m.enabled){var x=o.parts[m.partIndex];x.show&&!(m.partIndex?y:c)&&r(m)&&(m.hard?o.show=!1:x.show=!1)}}}catch(e){v=!0,p=e}finally{try{d||null==g.return||g.return()}finally{if(v)throw p}}var b=!0,S=!1,w=void 0;if(o.show)try{for(var k,T=l.colliders[Symbol.iterator]();!(b=(k=T.next()).done);b=!0){var C=k.value;if(C.enabled&&(!(C.partIndex?f:h)&&o.parts[C.partIndex].show))for(var R=C.xScreen+C.dxScreen,I=C.yScreen+C.dyScreen,A=R+C.width,P=I+C.height,D=n.slicedToArray(this._gridIndex.getCellSpan(R,I,A,P),4),B=D[0],L=D[1],O=D[2],M=D[3],U=L;U<=M;U++)for(var V=B;V<=O;V++)this._gridIndex.cells[U][V].push(C)}}catch(e){S=!0,w=e}finally{try{b||null==T.return||T.return()}finally{if(S)throw w}}}}}return!0}},{key:"_getProperties",value:function(e){var t=this._styleProps.get(e);if(t)return t;var r=this._zoom,i=this._styleRepository.getStyleLayerByUID(e),n=i.getLayoutValue("symbol-placement",r)!==o.SymbolPlacement.POINT,a=i.getLayoutValue("icon-rotation-alignment",r);a===o.RotationAlignment.AUTO&&(a=n?o.RotationAlignment.MAP:o.RotationAlignment.VIEWPORT);var s=i.getLayoutValue("text-rotation-alignment",r);s===o.RotationAlignment.AUTO&&(s=n?o.RotationAlignment.MAP:o.RotationAlignment.VIEWPORT);var l=i.getPaintValue("icon-translate",r),u=i.getPaintValue("icon-translate-anchor",r),c=i.getPaintValue("text-translate",r),h=i.getPaintValue("text-translate-anchor",r),y={iconAllowOverlap:i.getLayoutValue("icon-allow-overlap",r),iconIgnorePlacement:i.getLayoutValue("icon-ignore-placement",r),textAllowOverlap:i.getLayoutValue("text-allow-overlap",r),textIgnorePlacement:i.getLayoutValue("text-ignore-placement",r),iconRotationAlignment:a,textRotationAlignment:s,iconTranslateAnchor:u,iconTranslate:l,textTranslateAnchor:h,textTranslate:c};return this._styleProps.set(e,y),y}}]),e}()})),r.register("jXNn1",(function(e,i){t(e.exports,"SymbolDeclutterer",(function(){return o}));var n=r("8TSCy"),a=r("7qybv"),s=r("ebEEs");function l(e,t){if(e.priority-t.priority)return e.priority-t.priority;var r=e.tile.key,i=t.tile.key;return r.world-i.world?r.world-i.world:r.level-i.level?r.level-i.level:r.row-i.row?r.row-i.row:r.col-i.col?r.col-i.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}var o=function(){"use strict";function e(t,r,i,a,s,l){n.classCallCheck(this,e),this._visibleTiles=t,this._symbolRepository=r,this._createCollisionJob=i,this._assignTileSymbolsOpacity=a,this._symbolLayerSorter=s,this._isLayerVisible=l,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}return n.createClass(e,[{key:"running",get:function(){return this._running}},{key:"setScreenSize",value:function(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}},{key:"restart",value:function(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}},{key:"continue",value:function(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var r=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-r))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var i=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}return this._running=!1,!0}},{key:"_createSelectionJob",value:function(){for(var e=this._symbolRepository.uniqueSymbols,t=0;t<e.length;t++)for(var r=e[t],i=0;i<r.uniqueSymbols.length;i++){var n=r.uniqueSymbols[i],a=!0,s=!1,o=void 0;try{for(var u,c=n.tileSymbols[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){u.value.selectedForRendering=!1}}catch(e){s=!0,o=e}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}}var h=[],y=0,f=0,d=this._isLayerVisible;var v=this._symbolLayerSorter;return{work:function(t){for(var r,i=performance.now();f<e.length;f++,y=0){var n=e[f],a=n.styleLayerUID;if(d(a)){h[f]=h[f]||{styleLayerUID:a,symbols:[]};for(var s=h[f];y<n.uniqueSymbols.length;y++){if(r=n.uniqueSymbols[y],y%100==99&&performance.now()-i>t)return!1;var o=null,u=!1,c=!1,v=!0,p=!1,_=void 0;try{for(var g,m=r.tileSymbols[Symbol.iterator]();!(v=(g=m.next()).done);v=!0){var x=g.value;if(!c||!u){var b=x.tile;(!o||b.isCoverage||b.neededForCoverage&&!u)&&(o=x,(b.neededForCoverage||b.isCoverage)&&(c=!0),b.isCoverage&&(u=!0))}}}catch(e){p=!0,_=e}finally{try{v||null==m.return||m.return()}finally{if(p)throw _}}if(o.selectedForRendering=!0,c){s.symbols.push(o),r.show=!0;var S=!0,w=!1,k=void 0;try{for(var T,C=r.parts[Symbol.iterator]();!(S=(T=C.next()).done);S=!0){T.value.show=!0}}catch(e){w=!0,k=e}finally{try{S||null==C.return||C.return()}finally{if(w)throw k}}}else r.show=!1}}else h[f]||(h[f]={styleLayerUID:a,symbols:[]})}var R=!0,I=!1,A=void 0;try{for(var P,D=h[Symbol.iterator]();!(R=(P=D.next()).done);R=!0){P.value.symbols.sort(l)}}catch(e){I=!0,A=e}finally{try{R||null==D.return||D.return()}finally{if(I)throw A}}return!0},get sortedSymbols(){return h.sort(v)}}}},{key:"_createOpacityJob",value:function(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,r=0;function i(t,r){var a=t.symbols,s=!0,l=!1,o=void 0;try{for(var c,h=a[Symbol.iterator]();!(s=(c=h.next()).done);s=!0){var y=n.slicedToArray(c.value,2);y[0];u(y[1],r)}}catch(e){l=!0,o=e}finally{try{s||null==h.return||h.return()}finally{if(l)throw o}}e(t,r);var f=!0,d=!1,v=void 0;try{for(var p,_=t.childrenTiles[Symbol.iterator]();!(f=(p=_.next()).done);f=!0){i(p.value,r)}}catch(e){d=!0,v=e}finally{try{f||null==_.return||_.return()}finally{if(d)throw v}}}return{work:function(e){for(var n=performance.now();r<t.length;r++){if(performance.now()-n>e)return!1;var s=t[r];(0,a.isSome)(s.parentTile)||i(s,performance.now())}return!0}}}}]),e}();function u(e,t){var r=!0,i=!1,n=void 0;try{for(var a,l=e[Symbol.iterator]();!(r=(a=l.next()).done);r=!0){var o=a.value.unique,u=!0,c=!1,h=void 0;try{for(var y,f=o.parts[Symbol.iterator]();!(u=(y=f.next()).done);u=!0){var d=y.value,v=d.targetOpacity>.5?1:-1;d.startOpacity+=v*((t-d.startTime)/s.FADE_DURATION),d.startOpacity=Math.min(Math.max(d.startOpacity,0),1),d.startTime=t,d.targetOpacity=o.show&&d.show?1:0}}catch(e){c=!0,h=e}finally{try{u||null==f.return||f.return()}finally{if(c)throw h}}}}catch(e){i=!0,n=e}finally{try{r||null==l.return||l.return()}finally{if(i)throw n}}}})),r.register("bQZMG",(function(e,i){t(e.exports,"SymbolRepository",(function(){return l}));var n=r("8TSCy"),a=r("7qybv"),s=r("99iYp"),l=function(){"use strict";function e(t,r,i){n.classCallCheck(this,e),this.tileCoordRange=t,this._visibleTiles=r,this._createUnique=i,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}return n.createClass(e,[{key:"uniqueSymbols",get:function(){return(0,a.isNone)(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}},{key:"add",value:function(e,t){this._uniqueSymbolLayerArray=null;var r=this._tiles.get(e.id);r||(r={symbols:new Map},this._tiles.set(e.id,r));var i=new Map,a=!0,l=!1,o=void 0,u=!0,c=!1,h=void 0;if(t)try{for(var y,f=t[Symbol.iterator]();!(a=(y=f.next()).done);a=!0){var d=y.value;r.symbols.has(d)&&(i.set(d,r.symbols.get(d)),r.symbols.delete(d))}}catch(e){l=!0,o=e}finally{try{a||null==f.return||f.return()}finally{if(l)throw o}}else try{for(var v,p=e.layerData[Symbol.iterator]();!(u=(v=p.next()).done);u=!0){var _=n.slicedToArray(v.value,2),g=_[0],m=_[1];r.symbols.has(g)&&(i.set(g,r.symbols.get(g)),r.symbols.delete(g))}}catch(e){c=!0,h=e}finally{try{u||null==p.return||p.return()}finally{if(c)throw h}}this._removeSymbols(i);var x=e.symbols,b=new Map,S=!0,w=!1,k=void 0;try{for(var T,C=x[Symbol.iterator]();!(S=(T=C.next()).done);S=!0){var R=n.slicedToArray(T.value,2),I=R[0],A=R[1],P=A.length;if(P>=m){var D=this.tileCoordRange;do{D/=2,P/=4}while(P>8&&D>64);var B=new(0,s.GridIndex)(this.tileCoordRange,this.tileCoordRange,D);b.set(I,{flat:A,index:B}),r.symbols.set(I,{flat:A,index:B});var L=!0,O=!1,M=void 0;try{for(var U,V=A[Symbol.iterator]();!(L=(U=V.next()).done);L=!0){var E=U.value;B.getCell(E.xTile,E.yTile).push(E)}}catch(e){O=!0,M=e}finally{try{L||null==V.return||V.return()}finally{if(O)throw M}}}else b.set(I,{flat:A}),r.symbols.set(I,{flat:A})}}catch(e){w=!0,k=e}finally{try{S||null==C.return||C.return()}finally{if(w)throw k}}this._addSymbols(e.key,x)}},{key:"deleteStyleLayers",value:function(e){this._uniqueSymbolLayerArray=null;var t=!0,r=!1,i=void 0;try{for(var a,s=this._tiles[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var l=n.slicedToArray(a.value,2),o=l[0],u=l[1],c=new Map,h=!0,y=!1,f=void 0;try{for(var d,v=e[Symbol.iterator]();!(h=(d=v.next()).done);h=!0){var p=d.value;u.symbols.has(p)&&(c.set(p,u.symbols.get(p)),u.symbols.delete(p))}}catch(e){y=!0,f=e}finally{try{h||null==v.return||v.return()}finally{if(y)throw f}}this._removeSymbols(c),0===u.symbols.size&&this._tiles.delete(o)}}catch(e){r=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(r)throw i}}}},{key:"removeTile",value:function(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var r=new Map,i=!0,a=!1,s=void 0;try{for(var l,o=e.symbols[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var u=n.slicedToArray(l.value,2),c=u[0];u[1];t.symbols.has(c)&&(r.set(c,t.symbols.get(c)),t.symbols.delete(c))}}catch(e){a=!0,s=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw s}}this._removeSymbols(r),0===t.symbols.size&&this._tiles.delete(e.id)}}},{key:"_removeSymbols",value:function(e){var t=!0,r=!1,i=void 0,a=!0,s=!1,l=void 0;try{for(var o,u=e[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var c=n.slicedToArray(o.value,2),h=c[0],y=c[1].flat;try{for(var f,d=y[Symbol.iterator]();!(t=(f=d.next()).done);t=!0){for(var v=f.value,p=v.unique,_=p.tileSymbols,g=_.length-1,m=0;m<g;m++)if(_[m]===v){_[m]=_[g];break}if(_.length=g,0===g){var x=this._uniqueSymbolsReferences.get(h);x.delete(p),0===x.size&&this._uniqueSymbolsReferences.delete(h)}v.unique=null}}catch(e){r=!0,i=e}finally{try{t||null==d.return||d.return()}finally{if(r)throw i}}}}catch(e){s=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}}},{key:"_addSymbols",value:function(e,t){if(0!==t.size){var r=this._visibleTiles,i=!0,s=!1,l=void 0;try{for(var o,u=r[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var c=o.value;c.parentTile||c.key.world!==e.world||c.key.level===e.level&&!c.key.equals(e)||this._matchSymbols(c,e,t)}}catch(e){s=!0,l=e}finally{try{i||null==u.return||u.return()}finally{if(s)throw l}}var h=!0,y=!1,f=void 0,d=!0,v=!1,p=void 0;try{for(var _,g=t[Symbol.iterator]();!(d=(_=g.next()).done);d=!0){var m=n.slicedToArray(_.value,2),x=m[0],b=m[1];try{for(var S,w=b[Symbol.iterator]();!(h=(S=w.next()).done);h=!0){var k=S.value;if((0,a.isNone)(k.unique)){var T=this._createUnique();k.unique=T,T.tileSymbols.push(k);var C=this._uniqueSymbolsReferences.get(x);C||(C=new Set,this._uniqueSymbolsReferences.set(x,C)),C.add(T)}}}catch(e){y=!0,f=e}finally{try{h||null==w.return||w.return()}finally{if(y)throw f}}}}catch(e){v=!0,p=e}finally{try{d||null==g.return||g.return()}finally{if(v)throw p}}}}},{key:"_matchSymbols",value:function(e,t,r){if(e.key.level>t.level){var i=e.key.level-t.level;if(e.key.row>>i!==t.row||e.key.col>>i!==t.col)return}if(t.level>e.key.level){var l=t.level-e.key.level;if(t.row>>l!==e.key.row||t.col>>l!==e.key.col)return}if(t.equals(e.key)){var o=!0,u=!1,c=void 0;try{for(var h,y=e.childrenTiles[Symbol.iterator]();!(o=(h=y.next()).done);o=!0){var f=h.value;this._matchSymbols(f,t,r)}}catch(e){u=!0,c=e}finally{try{o||null==y.return||y.return()}finally{if(u)throw c}}}else{var d=new Map,v=!0,p=!1,_=void 0;try{for(var g,m=r[Symbol.iterator]();!(v=(g=m.next()).done);v=!0){var x=n.slicedToArray(g.value,2),b=x[0],S=x[1],w=[],k=!0,T=!1,C=void 0;try{for(var R,I=S[Symbol.iterator]();!(k=(R=I.next()).done);k=!0){var A=R.value,P=(0,s.tileCoordChange)(this.tileCoordRange,A.xTile,t.level,t.col,e.key.level,e.key.col),D=(0,s.tileCoordChange)(this.tileCoordRange,A.yTile,t.level,t.row,e.key.level,e.key.row);P>=0&&P<this.tileCoordRange&&D>=0&&D<this.tileCoordRange&&w.push({symbol:A,xTransformed:P,yTransformed:D})}}catch(e){T=!0,C=e}finally{try{k||null==I.return||I.return()}finally{if(T)throw C}}var B=[],L=e.key.level<t.level?1:1<<e.key.level-t.level,O=this._tiles.get(e.id).symbols.get(b);if(O){var M=O.flat,U=!0,V=!1,E=void 0;try{for(var q,z=w[Symbol.iterator]();!(U=(q=z.next()).done);U=!0){var F=q.value,H=void 0,N=!1,G=F.xTransformed,j=F.yTransformed;H=(0,a.isSome)(O.index)?O.index.getCell(G,j):M;var W=F.symbol,Q=W.hash,Y=!0,J=!1,Z=void 0;try{for(var X,K=H[Symbol.iterator]();!(Y=(X=K.next()).done);Y=!0){var $=X.value;if(Q===$.hash&&Math.abs(G-$.xTile)<=L&&Math.abs(j-$.yTile)<=L){var ee=$.unique;W.unique=ee,ee.tileSymbols.push(W),N=!0;break}}}catch(e){J=!0,Z=e}finally{try{Y||null==K.return||K.return()}finally{if(J)throw Z}}N||B.push(W)}}catch(e){V=!0,E=e}finally{try{U||null==z.return||z.return()}finally{if(V)throw E}}}B.length>0&&d.set(b,B)}}catch(e){p=!0,_=e}finally{try{v||null==m.return||m.return()}finally{if(p)throw _}}var te=!0,re=!1,ie=void 0;try{for(var ne,ae=e.childrenTiles[Symbol.iterator]();!(te=(ne=ae.next()).done);te=!0){var se=ne.value;this._matchSymbols(se,t,d)}}catch(e){re=!0,ie=e}finally{try{te||null==ae.return||ae.return()}finally{if(re)throw ie}}}}},{key:"_createUniqueSymbolLayerArray",value:function(){var e,t=this._uniqueSymbolsReferences,r=new Array(t.size),i=0,a=!0,s=!1,l=void 0;try{for(var o,u=t[Symbol.iterator]();!(a=(o=u.next()).done);a=!0){var c=n.slicedToArray(o.value,2),h=c[0],y=c[1],f=new Array(y.size);e=0;var d=!0,v=!1,p=void 0;try{for(var _,g=y[Symbol.iterator]();!(d=(_=g.next()).done);d=!0){var m=_.value;f[e++]=m}}catch(e){v=!0,p=e}finally{try{d||null==g.return||g.return()}finally{if(v)throw p}}r[i]={styleLayerUID:h,uniqueSymbols:f},i++}}catch(e){s=!0,l=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}return r}}]),e}()})),r.register("faBGm",(function(e,i){t(e.exports,"RenderableTile",(function(){return s}));var n=r("8TSCy"),a=r("eYrMi"),s=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(){return n.classCallCheck(this,r),t.apply(this,arguments)}return n.createClass(r,[{key:"_createTransforms",value:function(){return{dvs:(0,a.c)(),tileMat3:(0,a.c)()}}}]),r}(r("8eM7H").TiledDisplayObject)})),r.register("3v0eQ",(function(e,i){t(e.exports,"default",(function(){return h}));var n=r("8TSCy"),a=r("2VlWd"),s=r("66IJZ"),l=r("3FBIK"),o=r("cq8Fg"),u=r("ht01f"),c=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},h=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e){var i;return n.classCallCheck(this,r),(i=t.call(this))._tileInfoView=e,n.possibleConstructorReturn(i)}return n.createClass(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(c),this.setStencilReference(e),n.get(n.getPrototypeOf(r.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,i=n.get(n.getPrototypeOf(r.prototype),"createRenderParams",this).call(this,e);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),i}},{key:"prepareRenderPasses",value:function(e){var t=this,i=n.get(n.getPrototypeOf(r.prototype),"prepareRenderPasses",this).call(this,e);return i.push(e.registerRenderPass({name:"stencil",brushes:[u.default],drawPhase:s.WGLDrawPhase.DEBUG|s.WGLDrawPhase.MAP|s.WGLDrawPhase.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),(0,a.default)("esri-tiles-debug")&&i.push(e.registerRenderPass({name:"tileInfo",brushes:[o.default],drawPhase:s.WGLDrawPhase.DEBUG,target:function(){return t.children}})),i}},{key:"getStencilTarget",value:function(){return this.children}},{key:"updateTransforms",value:function(e){var t=!0,r=!1,i=void 0;try{for(var n,a=this.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var s=n.value,l=this._tileInfoView.getTileResolution(s.key);s.setTransform(e,l)}}catch(e){r=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw i}}}},{key:"setStencilReference",value:function(e){var t=1,r=!0,i=!1,n=void 0;try{for(var a,s=this.children[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){a.value.stencilRef=t++}}catch(e){i=!0,n=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw n}}}}]),r}(l.default)})),r.register("hPupt",(function(e,i){t(e.exports,"Display",(function(){return s}));var n=r("8TSCy"),a=r("1ScYs"),s=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(e){var i;return n.classCallCheck(this,r),(i=t.call(this)).requestRender=i.requestRender.bind(n.assertThisInitialized(i)),i._layerView=e,i._canvas=document.createElement("canvas"),i._context=i._canvas.getContext("2d"),i._bitmap=new(0,a.Bitmap)(null,"standard",!1),i.addChild(i._bitmap),n.possibleConstructorReturn(i)}return n.createClass(r,[{key:"doRender",value:function(e){var t=e.state,i=this._createCustomRenderParams(e),a=this._canvas,s=this._bitmap,l=window.devicePixelRatio;a.width=t.size[0]*l,a.height=t.size[1]*l,s.resolution=t.resolution;var o=t.clone();o.pixelRatio=l,s.pixelRatio=l,i.state=o,s.x=t.viewpoint.targetGeometry.x-Math.abs(t.extent.xmax-t.extent.xmin)/2,s.y=t.viewpoint.targetGeometry.y+Math.abs(t.extent.ymax-t.extent.ymin)/2,this._layerView.render(i),s.source=a,s.rotation=t.rotation,n.get(n.getPrototypeOf(r.prototype),"doRender",this).call(this,n.objectSpread({},e,{state:o}))}},{key:"_createCustomRenderParams",value:function(e){return{globalOpacity:e.globalOpacity,state:e.state,stationary:e.stationary,pixelRatio:window.devicePixelRatio,context:this._context}}}]),r}(r("1UuUA").BitmapContainer)})),r.register("1ScYs",(function(e,i){t(e.exports,"Bitmap",(function(){return d}));var n=r("8TSCy"),a=r("7qybv"),s=r("j3x2p"),l=r("eYrMi"),o=r("0P8XU"),u=r("2qlsz"),c=r("9rklz"),h=r("8JzMA"),y=r("8aBT4");function f(e,t,r){var i={target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,internalFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE};return t&&r&&(i.width=t,i.height=r),new(0,y.Texture)(e,i)}var d=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1?arguments[1]:void 0,s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return n.classCallCheck(this,r),(e=t.call(this)).requestRenderOnSourceChangedEnabled=s,e._textureInvalidated=!0,e.stencilRef=0,e.coordScale=[1,1],e._height=void 0,e.pixelRatio=1,e.resolution=0,e.rotation=0,e._source=null,e._width=void 0,e.x=0,e.y=0,e.blendFunction=a,e.source=i,e.requestRender=e.requestRender.bind(n.assertThisInitialized(e)),n.possibleConstructorReturn(e)}return n.createClass(r,[{key:"destroy",value:function(){this._texture&&(this._texture.dispose(),this._texture=null)}},{key:"isSourceScaled",get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}},{key:"height",get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(e){this._height=e}},{key:"source",get:function(){return this._source},set:function(e){this._source=e,this.invalidateTexture()}},{key:"sourceHeight",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}},{key:"sourceWidth",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}},{key:"width",get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(e){this._width=e}},{key:"beforeRender",value:function(e){n.get(n.getPrototypeOf(r.prototype),"beforeRender",this).call(this,e),this.updateTexture(e.context)}},{key:"invalidateTexture",value:function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())}},{key:"_createTransforms",value:function(){return{dvs:(0,l.c)()}}},{key:"setTransform",value:function(e){var t=(0,s.b)(this.transforms.dvs),r=n.slicedToArray(e.toScreenNoRotation([0,0],[this.x,this.y]),2),i=r[0],a=r[1],l=this.resolution/this.pixelRatio/e.resolution,u=l*this.width,c=l*this.height,h=Math.PI*this.rotation/180;(0,s.c)(t,t,(0,o.f)(i,a)),(0,s.c)(t,t,(0,o.f)(u/2,c/2)),(0,s.r)(t,t,-h),(0,s.c)(t,t,(0,o.f)(-u/2,-c/2)),(0,s.j)(t,t,(0,o.f)(u,c)),(0,s.m)(this.transforms.dvs,e.displayViewMat3,t)}},{key:"setSamplingProfile",value:function(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}},{key:"bind",value:function(e,t){this._texture&&e.bindTexture(this._texture,t)}},{key:"updateTexture",value:function(e){var t;if(!this.stage)return null==(t=this._texture)||t.dispose(),void(this._texture=null);if(this._textureInvalidated){this._textureInvalidated=!1,this._texture||(this.source?this._texture=f(e,this.sourceWidth,this.sourceHeight):this._texture=f(e));var r,i,n,s,l=this.source;if(l){if(this._texture.resize(this.sourceWidth,this.sourceHeight),(s=l)&&"render"in s)if(l instanceof c.default){var o=l.getRenderedRasterPixels();this._texture.setData((0,a.isSome)(o)?o.renderedRasterPixels:null)}else this._texture.setData((i=l,(n=document.createElement("canvas")).width=i.width,n.height=i.height,i.render(n.getContext("2d")),n));else(r=l)&&!("render"in r)&&this._texture.setData(l);this.ready()}else this._texture.setData(null)}}},{key:"onAttach",value:function(){this.invalidateTexture()}},{key:"onDetach",value:function(){this.invalidateTexture()}}]),r}(u.DisplayObject)})),r.register("9rklz",(function(e,i){t(e.exports,"default",(function(){return s}));var n=r("8TSCy"),a=r("7qybv"),s=function(){"use strict";function e(t,r,i){n.classCallCheck(this,e),this.pixelBlock=t,this.extent=r,this.originalPixelBlock=i}return n.createClass(e,[{key:"width",get:function(){return(0,a.isSome)(this.pixelBlock)?this.pixelBlock.width:0}},{key:"height",get:function(){return(0,a.isSome)(this.pixelBlock)?this.pixelBlock.height:0}},{key:"render",value:function(e){var t=this.pixelBlock;if(!(0,a.isNone)(t)){var r=this.filter({pixelBlock:t});if(!(0,a.isNone)(r.pixelBlock)){var i=r.pixelBlock.getAsRGBA(),n=e.createImageData(r.pixelBlock.width,r.pixelBlock.height);n.data.set(i),e.putImageData(n,0,0)}}}},{key:"getRenderedRasterPixels",value:function(){var e=this.filter({pixelBlock:this.pixelBlock});return(0,a.isNone)(e.pixelBlock)?null:{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)}}}]),e}()})),r.register("1UuUA",(function(e,i){t(e.exports,"BitmapContainer",(function(){return l}));var n=r("8TSCy"),a=r("jhrt5"),s=r("66IJZ"),l=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(){return n.classCallCheck(this,r),t.apply(this,arguments)}return n.createClass(r,[{key:"requiresDedicatedFBO",get:function(){return this.children.some((function(e){return"additive"===e.blendFunction}))}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"bitmap",brushes:[a.brushes.bitmap],target:function(){return t.children},drawPhase:s.WGLDrawPhase.MAP});return n.toConsumableArray(n.get(n.getPrototypeOf(r.prototype),"prepareRenderPasses",this).call(this,e)).concat([i])}}]),r}(r("3FBIK").default)})),r.register("5lu47",(function(e,i){t(e.exports,"default",(function(){return o}));var n=r("8TSCy"),a=r("xQ42o"),s=r("cqGfY"),l=r("i90gL"),o=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(){var e;return n.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))))._fullCacheLodInfos=null,e._levelByScale={},n.possibleConstructorReturn(e)}return n.createClass(r,[{key:"getTileParentId",value:function(e){var t=l.default.pool.acquire(e),r=0===t.level?null:l.default.getId(t.level-1,t.row>>1,t.col>>1,t.world);return l.default.pool.release(t),r}},{key:"getTileCoverage",value:function(e,t,i){var a=n.get(n.getPrototypeOf(r.prototype),"getTileCoverage",this).call(this,e,t,i);if(!a)return a;var s=1<<a.lodInfo.level;return a.spans=a.spans.filter((function(e){return e.row>=0&&e.row<s})),a}},{key:"scaleToLevel",value:function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t,r,i=this._fullCacheLodInfos;if(e>i[0].scale)return i[0].level;for(var n=0;n<i.length-1;n++)if(e>(r=i[n+1]).scale)return(t=i[n]).level+(t.scale-e)/(t.scale-r.scale);return i[i.length-1].level}},{key:"_initializeFullCacheLODs",value:function(e){var t;if(0===e[0].level)t=e.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}));else{var r=this.tileInfo.size[0],i=this.tileInfo.spatialReference;t=a.default.create({size:r,spatialReference:i}).lods.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}))}for(var n=0;n<t.length;n++)this._levelByScale[t[n].scale]=t[n].level;this._fullCacheLodInfos=t}}]),r}(s.default)})),r.register("8lbQw",(function(e,r){t(e.exports,"u32to4Xu8",(function(){return n})),t(e.exports,"i1616to32",(function(){return a})),t(e.exports,"i8888to32",(function(){return s}));var i=new Float32Array(1);new Uint32Array(i.buffer);function n(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]}function a(e,t){return 65535&e|t<<16}function s(e,t,r,i){return 255&e|(255&t)<<8|(255&r)<<16|i<<24}})),r.register("6S0qa",(function(e,r){var i,n,a,s;function l(e){switch(e){case"left":return i.Left;case"right":return i.Right;case"center":case"justify":return i.Center}}function o(e){switch(e){case"top":return n.Top;case"middle":return n.Center;case"baseline":return n.Baseline;case"bottom":return n.Bottom}}function u(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return[i.Right,n.Bottom];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return[i.Center,n.Bottom];case"above-right":case"esriServerPointLabelPlacementAboveRight":return[i.Left,n.Bottom];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return[i.Right,n.Center];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return[i.Center,n.Center];case"center-right":case"esriServerPointLabelPlacementCenterRight":return[i.Left,n.Center];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return[i.Right,n.Top];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return[i.Center,n.Top];case"below-right":case"esriServerPointLabelPlacementBelowRight":return[i.Left,n.Top];default:return console.debug("Found invalid placement type ".concat(e)),[i.Center,n.Center]}}function c(e){switch(e){case i.Right:return-1;case i.Center:return 0;case i.Left:return 1;default:return console.debug("Found invalid horizontal alignment ".concat(e)),0}}function h(e){switch(e){case n.Top:return 1;case n.Center:return 0;case n.Bottom:case n.Baseline:return-1;default:return console.debug("Found invalid vertical alignment ".concat(e)),0}}function y(e){switch(e){case"left":return i.Left;case"right":return i.Right;case"center":case"justify":return i.Center}}function f(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}t(e.exports,"HAlign",(function(){return i})),t(e.exports,"VAlign",(function(){return n})),t(e.exports,"getXAnchorDirection",(function(){return l})),t(e.exports,"getYAnchorDirection",(function(){return o})),t(e.exports,"getAlignmentFromPlacement",(function(){return u})),t(e.exports,"getXDirection",(function(){return c})),t(e.exports,"getYDirection",(function(){return h})),t(e.exports,"getJustification",(function(){return y})),t(e.exports,"isMapAligned",(function(){return f})),(s=i||(i={}))[s.Left=-1]="Left",s[s.Center=0]="Center",s[s.Right=1]="Right",(a=n||(n={}))[a.Top=1]="Top",a[a.Center=0]="Center",a[a.Bottom=-1]="Bottom",a[a.Baseline=2]="Baseline"})),r.register("iTfMY",(function(e,r){t(e.exports,"radToByte",(function(){return l})),t(e.exports,"degToByte",(function(){return o})),t(e.exports,"log2",(function(){return u})),t(e.exports,"between",(function(){return c}));Number.POSITIVE_INFINITY;var i=Math.PI,n=128/i,a=1/Math.LN2;function s(e,t){return(e%=t)>=0?e:e+t}function l(e){return s(e*n,256)}function o(e){return s(.7111111111111111*e,256)}function u(e){return Math.log(e)*a}function c(e,t,r){return e>=t&&e<=r||e>=r&&e<=t}})),r.register("2ndsO",(function(e,r){t(e.exports,"e",(function(){return s}));var i,n,a={exports:{}};i=a,void 0!==(n=function(){function e(e,n,a){a=a||2;var s,l,u,h,y,d,v,p=n&&n.length,_=p?n[0]*a:e.length,g=t(e,0,_,a,!0),m=[];if(!g||g.next===g.prev)return m;if(p&&(g=function(e,i,n,a){var s,l,u,h=[];for(s=0,l=i.length;s<l;s++)(u=t(e,i[s]*a,s<l-1?i[s+1]*a:e.length,a,!1))===u.next&&(u.steiner=!0),h.push(f(u));for(h.sort(o),s=0;s<h.length;s++)n=r(n=c(h[s],n),n.next);return n}(e,n,g,a)),e.length>80*a){s=u=e[0],l=h=e[1];for(var x=a;x<_;x+=a)(y=e[x])<s&&(s=y),(d=e[x+1])<l&&(l=d),y>u&&(u=y),d>h&&(h=d);v=0!==(v=Math.max(u-s,h-l))?1/v:0}return i(g,m,a,s,l,v),m}function t(e,t,r,i,n){var a,s;if(n===C(e,t,r,i)>0)for(a=t;a<r;a+=i)s=w(a,e[a],e[a+1],s);else for(a=r-i;a>=t;a-=i)s=w(a,e[a],e[a+1],s);if(s&&_(s,s.next)){var l=s.next;k(s),s=l}return s}function r(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!_(i,i.next)&&0!==p(i.prev,i,i.next))i=i.next;else{var n=i.prev;if(k(i),(i=t=n)===i.next)break;r=!0}}while(r||i!==t);return t}function i(e,t,o,u,c,h,f){if(e){!f&&h&&function(e,t,r,i){var n=e;do{null===n.z&&(n.z=y(n.x,n.y,t,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,r,i,n,a,s,l,o,u=1;do{for(r=e,e=null,a=null,s=0;r;){for(s++,i=r,l=0,t=0;t<u&&(l++,i=i.nextZ);t++);for(o=u;l>0||o>0&&i;)0!==l&&(0===o||!i||r.z<=i.z)?(n=r,r=r.nextZ,l--):(n=i,i=i.nextZ,o--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;r=i}a.nextZ=null,u*=2}while(s>1)}(n)}(e,u,c,h);for(var d,v,p=e;e.prev!==e.next;)if(d=e.prev,v=e.next,h?a(e,u,c,h):n(e))t.push(d.i/o),t.push(e.i/o),t.push(v.i/o),k(e),e=v.next,p=v.next;else if((e=v)===p){f?1===f?i(e=s(r(e),t,o),t,o,u,c,h,2):2===f&&l(e,t,o,u,c,h):i(r(e),t,o,u,c,h,1);break}}}function n(e){var t=e.prev,r=e,i=e.next;if(p(t,r,i)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(d(t.x,t.y,r.x,r.y,i.x,i.y,n.x,n.y)&&p(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function a(e,t,r,i){var n=e.prev,a=e,s=e.next;if(p(n,a,s)>=0)return!1;for(var l=n.x<a.x?n.x<s.x?n.x:s.x:a.x<s.x?a.x:s.x,o=n.y<a.y?n.y<s.y?n.y:s.y:a.y<s.y?a.y:s.y,u=n.x>a.x?n.x>s.x?n.x:s.x:a.x>s.x?a.x:s.x,c=n.y>a.y?n.y>s.y?n.y:s.y:a.y>s.y?a.y:s.y,h=y(l,o,t,r,i),f=y(u,c,t,r,i),v=e.prevZ,_=e.nextZ;v&&v.z>=h&&_&&_.z<=f;){if(v!==e.prev&&v!==e.next&&d(n.x,n.y,a.x,a.y,s.x,s.y,v.x,v.y)&&p(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,_!==e.prev&&_!==e.next&&d(n.x,n.y,a.x,a.y,s.x,s.y,_.x,_.y)&&p(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;v&&v.z>=h;){if(v!==e.prev&&v!==e.next&&d(n.x,n.y,a.x,a.y,s.x,s.y,v.x,v.y)&&p(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;_&&_.z<=f;){if(_!==e.prev&&_!==e.next&&d(n.x,n.y,a.x,a.y,s.x,s.y,_.x,_.y)&&p(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function s(e,t,i){var n=e;do{var a=n.prev,s=n.next.next;!_(a,s)&&g(a,n,n.next,s)&&b(a,s)&&b(s,a)&&(t.push(a.i/i),t.push(n.i/i),t.push(s.i/i),k(n),k(n.next),n=e=s),n=n.next}while(n!==e);return r(n)}function l(e,t,n,a,s,l){var o=e;do{for(var u=o.next.next;u!==o.prev;){if(o.i!==u.i&&v(o,u)){var c=S(o,u);return o=r(o,o.next),c=r(c,c.next),i(o,t,n,a,s,l),void i(c,t,n,a,s,l)}u=u.next}o=o.next}while(o!==e)}function o(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;for(var t=e;;){var r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function c(e,t){var i=function(e,t){var r,i=t,n=e.x,a=e.y,s=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var l=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(l<=n&&l>s){if(s=l,l===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===s)return r;var o,u=r,c=r.x,y=r.y,f=1/0;i=r;do{n>=i.x&&i.x>=c&&n!==i.x&&d(a<y?n:s,a,c,y,a<y?s:n,a,i.x,i.y)&&(o=Math.abs(a-i.y)/(n-i.x),b(i,e)&&(o<f||o===f&&(i.x>r.x||i.x===r.x&&h(r,i)))&&(r=i,f=o)),i=i.next}while(i!==u);return r}(e,t);if(!i)return t;var n=S(i,e),a=r(i,i.next),s=u(n);return r(s,s.next),a=u(a),u(t===i?a:t)}function h(e,t){return p(e.prev,e,t.prev)<0&&p(t.next,e,e.next)<0}function y(e,t,r,i,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function d(e,t,r,i,n,a,s,l){return(n-s)*(t-l)-(e-s)*(a-l)>=0&&(e-s)*(i-l)-(r-s)*(t-l)>=0&&(r-s)*(a-l)-(n-s)*(i-l)>=0}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&g(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(b(e,t)&&b(t,e)&&function(e,t){var r=e,i=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(p(e.prev,e,t.prev)||p(e,t.prev,t))||_(e,t)&&p(e.prev,e,e.next)>0&&p(t.prev,t,t.next)>0)}function p(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function _(e,t){return e.x===t.x&&e.y===t.y}function g(e,t,r,i){var n=x(p(e,t,r)),a=x(p(e,t,i)),s=x(p(r,i,e)),l=x(p(r,i,t));return n!==a&&s!==l||!(0!==n||!m(e,r,t))||!(0!==a||!m(e,i,t))||!(0!==s||!m(r,e,i))||!(0!==l||!m(r,t,i))}function m(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function x(e){return e>0?1:e<0?-1:0}function b(e,t){return p(e.prev,e,e.next)<0?p(e,t,e.next)>=0&&p(e,e.prev,t)>=0:p(e,t,e.prev)<0||p(e,e.next,t)<0}function S(e,t){var r=new T(e.i,e.x,e.y),i=new T(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function w(e,t,r,i){var n=new T(e,t,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function k(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function T(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,r,i){for(var n=0,a=t,s=r-i;a<r;a+=i)n+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return n}return e.deviation=function(e,t,r,i){var n=t&&t.length,a=n?t[0]*r:e.length,s=Math.abs(C(e,0,a,r));if(n)for(var l=0,o=t.length;l<o;l++){var u=t[l]*r,c=l<o-1?t[l+1]*r:e.length;s-=Math.abs(C(e,u,c,r))}var h=0;for(l=0;l<i.length;l+=3){var y=i[l]*r,f=i[l+1]*r,d=i[l+2]*r;h+=Math.abs((e[y]-e[d])*(e[f+1]-e[y+1])-(e[y]-e[f])*(e[d+1]-e[y+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},e.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var s=0;s<t;s++)r.vertices.push(e[n][a][s]);n>0&&(i+=e[n-1].length,r.holes.push(i))}return r},e}())&&(i.exports=n);var s=a.exports})),r.register("cOrC4",(function(e,i){t(e.exports,"Container",(function(){return l}));var n=r("8TSCy"),a=r("eYrMi"),s=r("a4nX6"),l=function(e){"use strict";n.inherits(r,e);var t=n.createSuper(r);function r(){var e;return n.classCallCheck(this,r),(e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments))))._childrenSet=new Set,e._needsSort=!1,e.children=[],e._effectView=null,n.possibleConstructorReturn(e)}return n.createClass(r,[{key:"blendMode",get:function(){return this._blendMode},set:function(e){this._blendMode=e,this.requestRender()}},{key:"clips",get:function(){return this._clips},set:function(e){this._clips=e,this.children.forEach((function(t){return t.clips=e}))}},{key:"computedEffects",get:function(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effects)?e:null}},{key:"effect",get:function(){var e,t;return null!=(e=null==(t=this._effectView)?void 0:t.effect)?e:""},set:function(e){(this._effectView||e)&&(this._effectView||(this._effectView=new(0,s.EffectView)),this._effectView.effect=e,this.requestRender())}},{key:"updateTransitionProperties",value:function(e,t){n.get(n.getPrototypeOf(r.prototype),"updateTransitionProperties",this).call(this,e,t),this._effectView&&(this._effectView.transitionStep(e,t),this._effectView.transitioning&&this.requestRender())}},{key:"doRender",value:function(e){var t=this.createRenderParams(e);this.renderChildren(t)}},{key:"addChild",value:function(e){return this.addChildAt(e,this.children.length)}},{key:"addChildAt",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.children.length;if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;var r=e.parent;return r&&r!==this&&r.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),e}},{key:"contains",value:function(e){return this._childrenSet.has(e)}},{key:"removeAllChildren",value:function(){this._childrenSet.clear(),this._needsSort=!0;var e=!0,t=!1,r=void 0;try{for(var i,n=this.children[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var a=i.value;this!==this.stage&&(a.clips=null),a.stage=null,a.parent=null}}catch(e){t=!0,r=e}finally{try{e||null==n.return||n.return()}finally{if(t)throw r}}this.children.length=0}},{key:"removeChild",value:function(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}},{key:"removeChildAt",value:function(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;var t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,t}},{key:"sortChildren",value:function(e){this._needsSort&&(this.children.sort(e),this._needsSort=!1)}},{key:"_createTransforms",value:function(){return{dvs:(0,a.c)()}}},{key:"onAttach",value:function(){n.get(n.getPrototypeOf(r.prototype),"onAttach",this).call(this);var e=this.stage,t=!0,i=!1,a=void 0;try{for(var s,l=this.children[Symbol.iterator]();!(t=(s=l.next()).done);t=!0){s.value.stage=e}}catch(e){i=!0,a=e}finally{try{t||null==l.return||l.return()}finally{if(i)throw a}}}},{key:"onDetach",value:function(){n.get(n.getPrototypeOf(r.prototype),"onDetach",this).call(this);var e=!0,t=!1,i=void 0;try{for(var a,s=this.children[Symbol.iterator]();!(e=(a=s.next()).done);e=!0){a.value.stage=null}}catch(e){t=!0,i=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw i}}}},{key:"renderChildren",value:function(e){var t=!0,r=!1,i=void 0;try{for(var n,a=this.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.beforeRender(e)}}catch(e){r=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(r)throw i}}var s=!0,l=!1,o=void 0;try{for(var u,c=this.children[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){u.value.processRender(e)}}catch(e){l=!0,o=e}finally{try{s||null==c.return||c.return()}finally{if(l)throw o}}var h=!0,y=!1,f=void 0;try{for(var d,v=this.children[Symbol.iterator]();!(h=(d=v.next()).done);h=!0){d.value.afterRender(e)}}catch(e){y=!0,f=e}finally{try{h||null==v.return||v.return()}finally{if(y)throw f}}}},{key:"createRenderParams",value:function(e){return n.objectSpread({},e,{blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition})}}]),r}(r("2qlsz").DisplayObject)}))}();
//# sourceMappingURL=VectorTileLayerView2D.4b776889.js.map
